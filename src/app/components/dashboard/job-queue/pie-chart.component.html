<svg
  [attr.viewBox]="legend ? '0 0 200 115' : '0 0 100 115'"
  xmlns="http://www.w3.org/2000/svg"
  preserveAspectRatio="xMidYMid meet"
  width="100%"
  height="100%"
>
  <!-- Background circle -->
  <circle cx="50" cy="50" r="50" fill="#f0f0f0" />

  <!-- Show "Empty" label if no data -->
  <text
    *ngIf="isEmpty && title"
    x="50"
    y="50"
    text-anchor="middle"
    dominant-baseline="middle"
    font-size="6px"
    font-family="sans-serif"
    fill="#999"
  >
    {{ title }}
  </text>

  <!-- Wedges -->
  <ng-container *ngFor="let wedge of getWedges()">
    <circle
      [attr.r]="25"
      cx="50"
      cy="50"
      fill="transparent"
      [attr.stroke]="wedge.color"
      stroke-width="50"
      [attr.stroke-dasharray]="
        (wedge.arcLength / 360) * 2 * 3.141596 * 25 +
        ' ' +
        ((360 - wedge.arcLength) / 360) * 2 * 3.141596 * 25
      "
      [attr.transform]="'rotate(' + (-90 + wedge.start) + ' 50 50)'"
    />
    <text
      *ngIf="wedge.label"
      [attr.x]="50 - 25 * 1.25 * Math.sin(-radians(wedge.start + wedge.arcLength / 2))"
      [attr.y]="50 - 25 * 1.25 * Math.cos(-radians(wedge.start + wedge.arcLength / 2))"
      text-anchor="middle"
      dominant-baseline="middle"
      font-size="10px"
      font-family="sans-serif"
      [attr.fill]="wedge.textColor"
    >
      {{ wedge.label }}
    </text>
  </ng-container>

  <!-- Legend -->
  <g *ngIf="labels?.length && legend">
    <ng-container *ngFor="let label of labels; let i = index">
      <rect
        [attr.x]="110"
        [attr.y]="2 + 8 * i"
        width="4"
        height="4"
        [attr.fill]="colors[i % colors.length]"
      />
      <text
        [attr.x]="118"
        [attr.y]="4 + 8 * i"
        dominant-baseline="middle"
        font-size="4px"
        font-family="sans-serif"
        fill="black"
      >
        {{ label }}
      </text>
    </ng-container>
  </g>

  <!-- Title -->
  <text
    *ngIf="title && !isEmpty"
    x="50"
    y="109"
    text-anchor="middle"
    dominant-baseline="middle"
    font-size="6px"
    font-family="sans-serif"
    fill="black"
  >
    {{ title }}
  </text>
</svg>
