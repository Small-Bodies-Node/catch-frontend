<div class="queries-container">
  <div class="header-section">
    <h2 class="mat-headline-5">Queries</h2>
    <button
      mat-icon-button
      (click)="refreshQueries()"
      [disabled]="isRefreshing"
      matTooltip="Refresh queries"
    >
      <mat-icon [class.spinning]="isRefreshing">refresh</mat-icon>
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div *ngIf="isError" class="error-container">
    <mat-card appearance="outlined" class="error-card">
      <mat-card-content>
        <p>Error: {{ errorMessage }}</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="!isLoading && !isError && queriesData" class="queries-content">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <mat-card appearance="outlined" class="summary-card">
        <mat-card-content>
          <div class="summary-number">{{ getTotalJobs() }}</div>
          <div class="summary-label">Total Jobs</div>
        </mat-card-content>
      </mat-card>

      <mat-card appearance="outlined" class="summary-card">
        <mat-card-content>
          <div class="summary-number">{{ getTotalCached() }}</div>
          <div class="summary-label">Cached Searches</div>
        </mat-card-content>
      </mat-card>

      <mat-card appearance="outlined" class="summary-card">
        <mat-card-content>
          <div class="summary-number">{{ getTotalErrored() }}</div>
          <div class="summary-label">Errored</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Detailed List -->
    <mat-card appearance="outlined" class="queries-card">
      <mat-card-content>
        <h3 class="mat-subtitle-1">Query History</h3>
        <mat-list>
          <mat-list-item *ngFor="let entry of queriesData">
            <div matLine>
              {{ entry.jobs }} jobs in the past
              {{ entry.days === 1 ? 'day' : entry.days + ' days' }}
            </div>
            <div matLine class="mat-line-secondary">
              {{ entry.cached }} searches by source
              <ng-container *ngIf="entry.errored > 0">
                <span class="errored-text">({{ entry.errored }} errored)</span>
              </ng-container>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>
</div>
