var JS9Prefs={globalOpts:{helperType:"nodejs",helperPort:2718,helperCGI:"./cgi-bin/js9/js9Helper.cgi",debug:0,loadProxy:!0,workDir:"./tmp",workDirQuota:100,dataPath:"$HOME/Desktop:$HOME/data",analysisPlugins:"./analysis-plugins",analysisWrappers:"./analysis-wrappers"},imageOpts:{colormap:"grey",scale:"linear"}};function sprintf(){var e=arguments,t=0,s=function(a,l,c,d){return c||(c=" "),l=a.length>=l?"":Array(1+l-a.length>>>0).join(c),d?a+l:l+a},o=function(a,l,c,d,h,p){var g=d-a.length;return 0<g&&(a=c||!h?s(a,d,p,c):a.slice(0,l.length)+s("",g,"0",!0)+a.slice(l.length)),a},n=function(a,l,c,d,h,p,g){return a>>>=0,a=(c=c&&a&&{2:"0b",8:"0",16:"0x"}[l]||"")+s(a.toString(l),p||0,"0",!1),o(a,c,d,h,g)};return e[t++].replace(/%%|%(\d+\$)?([-+'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g,function(a,l,c,d,h,p,g){if("%%"==a)return"%";for(var v=!1,r="",u=h=!1,f=" ",m=c.length,b=0;c&&b<m;b++)switch(c.charAt(b)){case" ":r=" ";break;case"+":r="+";break;case"-":v=!0;break;case"'":f=c.charAt(b+1);break;case"0":h=!0;break;case"#":u=!0}if(0>(d=d?"*"==d?+e[t++]:"*"==d.charAt(0)?+e[d.slice(1,-1)]:+d:0)&&(d=-d,v=!0),!isFinite(d))throw Error("sprintf: (minimum-)width must be finite");switch(p=p?"*"==p?+e[t++]:"*"==p.charAt(0)?+e[p.slice(1,-1)]:+p:-1<"fFeE".indexOf(g)?6:"d"==g?0:void 0,l=l?e[l.slice(0,-1)]:e[t++],g){case"s":return g=String(l),null!=p&&(g=g.slice(0,p)),o(g,"",v,d,h,f);case"c":return g=String.fromCharCode(+l),null!=p&&(g=g.slice(0,p)),o(g,"",v,d,h,void 0);case"b":return n(l,2,u,v,d,p,h);case"o":return n(l,8,u,v,d,p,h);case"x":return n(l,16,u,v,d,p,h);case"X":return n(l,16,u,v,d,p,h).toUpperCase();case"u":return n(l,10,u,v,d,p,h);case"i":case"d":return l=(a=0>(f=0|+l)?"-":r)+s(String(Math.abs(f)),p,"0",!1),o(l,a,v,d,h);case"e":case"E":case"f":case"F":case"g":case"G":return a=0>(f=+l)?"-":r,r=["toExponential","toFixed","toPrecision"]["efg".indexOf(g.toLowerCase())],g=["toString","toUpperCase"]["eEfFgG".indexOf(g)%2],l=a+Math.abs(f)[r](p),o(l,a,v,d,h)[g]();default:return a}})}"object"==typeof module&&(window.module=module,module=void 0),function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(s){if(!s.document)throw new Error("jQuery requires a window with a document");return t(s)}:t(e)}(typeof window<"u"?window:this,function(e,t){"use strict";var s=[],o=Object.getPrototypeOf,n=s.slice,a=s.flat?function(k){return s.flat.call(k)}:function(k){return s.concat.apply([],k)},l=s.push,c=s.indexOf,d={},h=d.toString,p=d.hasOwnProperty,g=p.toString,v=g.call(Object),r={},u=function(k){return"function"==typeof k&&"number"!=typeof k.nodeType},f=function(k){return null!=k&&k===k.window},m=e.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function w(k,T,F){var j,U,X=(F=F||m).createElement("script");if(X.text=k,T)for(j in b)(U=T[j]||T.getAttribute&&T.getAttribute(j))&&X.setAttribute(j,U);F.head.appendChild(X).parentNode.removeChild(X)}function A(k){return null==k?k+"":"object"==typeof k||"function"==typeof k?d[h.call(k)]||"object":typeof k}var x="3.5.0",y=function(k,T){return new y.fn.init(k,T)};function S(k){var T=!!k&&"length"in k&&k.length,F=A(k);return!u(k)&&!f(k)&&("array"===F||0===T||"number"==typeof T&&0<T&&T-1 in k)}y.fn=y.prototype={jquery:x,constructor:y,length:0,toArray:function(){return n.call(this)},get:function(k){return null==k?n.call(this):k<0?this[k+this.length]:this[k]},pushStack:function(k){var T=y.merge(this.constructor(),k);return T.prevObject=this,T},each:function(k){return y.each(this,k)},map:function(k){return this.pushStack(y.map(this,function(T,F){return k.call(T,F,T)}))},slice:function(){return this.pushStack(n.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(y.grep(this,function(k,T){return(T+1)%2}))},odd:function(){return this.pushStack(y.grep(this,function(k,T){return T%2}))},eq:function(k){var T=this.length,F=+k+(k<0?T:0);return this.pushStack(0<=F&&F<T?[this[F]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:s.sort,splice:s.splice},y.extend=y.fn.extend=function(){var k,T,F,j,U,X,V=arguments[0]||{},re=1,ue=arguments.length,ge=!1;for("boolean"==typeof V&&(ge=V,V=arguments[re]||{},re++),"object"==typeof V||u(V)||(V={}),re===ue&&(V=this,re--);re<ue;re++)if(null!=(k=arguments[re]))for(T in k)j=k[T],"__proto__"!==T&&V!==j&&(ge&&j&&(y.isPlainObject(j)||(U=Array.isArray(j)))?(F=V[T],X=U&&!Array.isArray(F)?[]:U||y.isPlainObject(F)?F:{},U=!1,V[T]=y.extend(ge,X,j)):void 0!==j&&(V[T]=j));return V},y.extend({expando:"jQuery"+(x+Math.random()).replace(/\D/g,""),isReady:!0,error:function(k){throw new Error(k)},noop:function(){},isPlainObject:function(k){var T,F;return!(!k||"[object Object]"!==h.call(k)||(T=o(k))&&("function"!=typeof(F=p.call(T,"constructor")&&T.constructor)||g.call(F)!==v))},isEmptyObject:function(k){var T;for(T in k)return!1;return!0},globalEval:function(k,T,F){w(k,{nonce:T&&T.nonce},F)},each:function(k,T){var F,j=0;if(S(k))for(F=k.length;j<F&&!1!==T.call(k[j],j,k[j]);j++);else for(j in k)if(!1===T.call(k[j],j,k[j]))break;return k},makeArray:function(k,T){var F=T||[];return null!=k&&(S(Object(k))?y.merge(F,"string"==typeof k?[k]:k):l.call(F,k)),F},inArray:function(k,T,F){return null==T?-1:c.call(T,k,F)},merge:function(k,T){for(var F=+T.length,j=0,U=k.length;j<F;j++)k[U++]=T[j];return k.length=U,k},grep:function(k,T,F){for(var j=[],U=0,X=k.length,V=!F;U<X;U++)!T(k[U],U)!==V&&j.push(k[U]);return j},map:function(k,T,F){var j,U,X=0,V=[];if(S(k))for(j=k.length;X<j;X++)null!=(U=T(k[X],X,F))&&V.push(U);else for(X in k)null!=(U=T(k[X],X,F))&&V.push(U);return a(V)},guid:1,support:r}),"function"==typeof Symbol&&(y.fn[Symbol.iterator]=s[Symbol.iterator]),y.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(k,T){d["[object "+T+"]"]=T.toLowerCase()});var _=function(k){var T,F,j,U,X,V,re,ue,ge,Ie,Fe,Ce,Me,Xe,Ze,Ve,vt,Mt,Ut,gt="sizzle"+1*new Date,at=k.document,Ht=0,ht=0,bt=Ti(),wi=Ti(),ki=Ti(),Jt=Ti(),ui=function(Z,ae){return Z===ae&&(Fe=!0),0},gi={}.hasOwnProperty,Bt=[],mi=Bt.pop,Vt=Bt.push,xt=Bt.push,Gt=Bt.slice,qt=function(Z,ae){for(var fe=0,Le=Z.length;fe<Le;fe++)if(Z[fe]===ae)return fe;return-1},ai="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",rt="[\\x20\\t\\r\\n\\f]",dt="(?:\\\\[\\da-fA-F]{1,6}"+rt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Ot="\\["+rt+"*("+dt+")(?:"+rt+"*([*^$|!~]?=)"+rt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+dt+"))|)"+rt+"*\\]",Xt=":("+dt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+Ot+")*)|.*)\\)|)",_t=new RegExp(rt+"+","g"),Yt=new RegExp("^"+rt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+rt+"+$","g"),yi=new RegExp("^"+rt+"*,"+rt+"*"),_i=new RegExp("^"+rt+"*([>+~]|"+rt+")"+rt+"*"),zs=new RegExp(rt+"|>"),Hs=new RegExp(Xt),Bs=new RegExp("^"+dt+"$"),Ii={ID:new RegExp("^#("+dt+")"),CLASS:new RegExp("^\\.("+dt+")"),TAG:new RegExp("^("+dt+"|[*])"),ATTR:new RegExp("^"+Ot),PSEUDO:new RegExp("^"+Xt),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+rt+"*(even|odd|(([+-]|)(\\d*)n|)"+rt+"*(?:([+-]|)"+rt+"*(\\d+)|))"+rt+"*\\)|)","i"),bool:new RegExp("^(?:"+ai+")$","i"),needsContext:new RegExp("^"+rt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+rt+"*((?:-\\d)?\\d*)"+rt+"*\\)|)(?=[^-]|$)","i")},Ws=/HTML$/i,Us=/^(?:input|select|textarea|button)$/i,Js=/^h\d$/i,Ai=/^[^{]+\{\s*\[native \w/,Gs=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Bi=/[+~]/,oi=new RegExp("\\\\[\\da-fA-F]{1,6}"+rt+"?|\\\\([^\\r\\n\\f])","g"),li=function(Z,ae){var fe="0x"+Z.slice(1)-65536;return ae||(fe<0?String.fromCharCode(fe+65536):String.fromCharCode(fe>>10|55296,1023&fe|56320))},ds=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ps=function(Z,ae){return ae?"\0"===Z?"\ufffd":Z.slice(0,-1)+"\\"+Z.charCodeAt(Z.length-1).toString(16)+" ":"\\"+Z},fs=function(){Ce()},qs=Oi(function(Z){return!0===Z.disabled&&"fieldset"===Z.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{xt.apply(Bt=Gt.call(at.childNodes),at.childNodes)}catch{xt={apply:Bt.length?function(ae,fe){Vt.apply(ae,Gt.call(fe))}:function(ae,fe){for(var Le=ae.length,ye=0;ae[Le++]=fe[ye++];);ae.length=Le-1}}}function mt(Z,ae,fe,Le){var ye,Re,je,Ue,qe,nt,tt,it=ae&&ae.ownerDocument,ct=ae?ae.nodeType:9;if(fe=fe||[],"string"!=typeof Z||!Z||1!==ct&&9!==ct&&11!==ct)return fe;if(!Le&&(Ce(ae),ae=ae||Me,Ze)){if(11!==ct&&(qe=Gs.exec(Z)))if(ye=qe[1]){if(9===ct){if(!(je=ae.getElementById(ye)))return fe;if(je.id===ye)return fe.push(je),fe}else if(it&&(je=it.getElementById(ye))&&Ut(ae,je)&&je.id===ye)return fe.push(je),fe}else{if(qe[2])return xt.apply(fe,ae.getElementsByTagName(Z)),fe;if((ye=qe[3])&&F.getElementsByClassName&&ae.getElementsByClassName)return xt.apply(fe,ae.getElementsByClassName(ye)),fe}if(F.qsa&&!Jt[Z+" "]&&(!Ve||!Ve.test(Z))&&(1!==ct||"object"!==ae.nodeName.toLowerCase())){if(tt=Z,it=ae,1===ct&&(zs.test(Z)||_i.test(Z))){for((it=Bi.test(Z)&&Ui(ae.parentNode)||ae)===ae&&F.scope||((Ue=ae.getAttribute("id"))?Ue=Ue.replace(ds,ps):ae.setAttribute("id",Ue=gt)),Re=(nt=V(Z)).length;Re--;)nt[Re]=(Ue?"#"+Ue:":scope")+" "+Mi(nt[Re]);tt=nt.join(",")}try{return xt.apply(fe,it.querySelectorAll(tt)),fe}catch{Jt(Z,!0)}finally{Ue===gt&&ae.removeAttribute("id")}}}return ue(Z.replace(Yt,"$1"),ae,fe,Le)}function Ti(){var Z=[];return function ae(fe,Le){return Z.push(fe+" ")>j.cacheLength&&delete ae[Z.shift()],ae[fe+" "]=Le}}function ei(Z){return Z[gt]=!0,Z}function ti(Z){var ae=Me.createElement("fieldset");try{return!!Z(ae)}catch{return!1}finally{ae.parentNode&&ae.parentNode.removeChild(ae),ae=null}}function Wi(Z,ae){for(var fe=Z.split("|"),Le=fe.length;Le--;)j.attrHandle[fe[Le]]=ae}function gs(Z,ae){var fe=ae&&Z,Le=fe&&1===Z.nodeType&&1===ae.nodeType&&Z.sourceIndex-ae.sourceIndex;if(Le)return Le;if(fe)for(;fe=fe.nextSibling;)if(fe===ae)return-1;return Z?1:-1}function Xs(Z){return function(ae){return"input"===ae.nodeName.toLowerCase()&&ae.type===Z}}function Ys(Z){return function(ae){var fe=ae.nodeName.toLowerCase();return("input"===fe||"button"===fe)&&ae.type===Z}}function ms(Z){return function(ae){return"form"in ae?ae.parentNode&&!1===ae.disabled?"label"in ae?"label"in ae.parentNode?ae.parentNode.disabled===Z:ae.disabled===Z:ae.isDisabled===Z||ae.isDisabled!==!Z&&qs(ae)===Z:ae.disabled===Z:"label"in ae&&ae.disabled===Z}}function di(Z){return ei(function(ae){return ae=+ae,ei(function(fe,Le){for(var ye,Re=Z([],fe.length,ae),je=Re.length;je--;)fe[ye=Re[je]]&&(fe[ye]=!(Le[ye]=fe[ye]))})})}function Ui(Z){return Z&&typeof Z.getElementsByTagName<"u"&&Z}for(T in F=mt.support={},X=mt.isXML=function(Z){var fe=(Z.ownerDocument||Z).documentElement;return!Ws.test(Z.namespaceURI||fe&&fe.nodeName||"HTML")},Ce=mt.setDocument=function(Z){var ae,fe,Le=Z?Z.ownerDocument||Z:at;return Le!=Me&&9===Le.nodeType&&Le.documentElement&&(Xe=(Me=Le).documentElement,Ze=!X(Me),at!=Me&&(fe=Me.defaultView)&&fe.top!==fe&&(fe.addEventListener?fe.addEventListener("unload",fs,!1):fe.attachEvent&&fe.attachEvent("onunload",fs)),F.scope=ti(function(ye){return Xe.appendChild(ye).appendChild(Me.createElement("div")),typeof ye.querySelectorAll<"u"&&!ye.querySelectorAll(":scope fieldset div").length}),F.attributes=ti(function(ye){return ye.className="i",!ye.getAttribute("className")}),F.getElementsByTagName=ti(function(ye){return ye.appendChild(Me.createComment("")),!ye.getElementsByTagName("*").length}),F.getElementsByClassName=Ai.test(Me.getElementsByClassName),F.getById=ti(function(ye){return Xe.appendChild(ye).id=gt,!Me.getElementsByName||!Me.getElementsByName(gt).length}),F.getById?(j.filter.ID=function(ye){var Re=ye.replace(oi,li);return function(je){return je.getAttribute("id")===Re}},j.find.ID=function(ye,Re){if(typeof Re.getElementById<"u"&&Ze){var je=Re.getElementById(ye);return je?[je]:[]}}):(j.filter.ID=function(ye){var Re=ye.replace(oi,li);return function(je){var Ue=typeof je.getAttributeNode<"u"&&je.getAttributeNode("id");return Ue&&Ue.value===Re}},j.find.ID=function(ye,Re){if(typeof Re.getElementById<"u"&&Ze){var je,Ue,qe,nt=Re.getElementById(ye);if(nt){if((je=nt.getAttributeNode("id"))&&je.value===ye)return[nt];for(qe=Re.getElementsByName(ye),Ue=0;nt=qe[Ue++];)if((je=nt.getAttributeNode("id"))&&je.value===ye)return[nt]}return[]}}),j.find.TAG=F.getElementsByTagName?function(ye,Re){return typeof Re.getElementsByTagName<"u"?Re.getElementsByTagName(ye):F.qsa?Re.querySelectorAll(ye):void 0}:function(ye,Re){var je,Ue=[],qe=0,nt=Re.getElementsByTagName(ye);if("*"===ye){for(;je=nt[qe++];)1===je.nodeType&&Ue.push(je);return Ue}return nt},j.find.CLASS=F.getElementsByClassName&&function(ye,Re){if(typeof Re.getElementsByClassName<"u"&&Ze)return Re.getElementsByClassName(ye)},vt=[],Ve=[],(F.qsa=Ai.test(Me.querySelectorAll))&&(ti(function(ye){var Re;Xe.appendChild(ye).innerHTML="<a id='"+gt+"'></a><select id='"+gt+"-\r\\' msallowcapture=''><option selected=''></option></select>",ye.querySelectorAll("[msallowcapture^='']").length&&Ve.push("[*^$]="+rt+"*(?:''|\"\")"),ye.querySelectorAll("[selected]").length||Ve.push("\\["+rt+"*(?:value|"+ai+")"),ye.querySelectorAll("[id~="+gt+"-]").length||Ve.push("~="),(Re=Me.createElement("input")).setAttribute("name",""),ye.appendChild(Re),ye.querySelectorAll("[name='']").length||Ve.push("\\["+rt+"*name"+rt+"*="+rt+"*(?:''|\"\")"),ye.querySelectorAll(":checked").length||Ve.push(":checked"),ye.querySelectorAll("a#"+gt+"+*").length||Ve.push(".#.+[+~]"),ye.querySelectorAll("\\\f"),Ve.push("[\\r\\n\\f]")}),ti(function(ye){ye.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var Re=Me.createElement("input");Re.setAttribute("type","hidden"),ye.appendChild(Re).setAttribute("name","D"),ye.querySelectorAll("[name=d]").length&&Ve.push("name"+rt+"*[*^$|!~]?="),2!==ye.querySelectorAll(":enabled").length&&Ve.push(":enabled",":disabled"),Xe.appendChild(ye).disabled=!0,2!==ye.querySelectorAll(":disabled").length&&Ve.push(":enabled",":disabled"),ye.querySelectorAll("*,:x"),Ve.push(",.*:")})),(F.matchesSelector=Ai.test(Mt=Xe.matches||Xe.webkitMatchesSelector||Xe.mozMatchesSelector||Xe.oMatchesSelector||Xe.msMatchesSelector))&&ti(function(ye){F.disconnectedMatch=Mt.call(ye,"*"),Mt.call(ye,"[s!='']:x"),vt.push("!=",Xt)}),Ve=Ve.length&&new RegExp(Ve.join("|")),vt=vt.length&&new RegExp(vt.join("|")),ae=Ai.test(Xe.compareDocumentPosition),Ut=ae||Ai.test(Xe.contains)?function(ye,Re){var je=9===ye.nodeType?ye.documentElement:ye,Ue=Re&&Re.parentNode;return ye===Ue||!(!Ue||1!==Ue.nodeType||!(je.contains?je.contains(Ue):ye.compareDocumentPosition&&16&ye.compareDocumentPosition(Ue)))}:function(ye,Re){if(Re)for(;Re=Re.parentNode;)if(Re===ye)return!0;return!1},ui=ae?function(ye,Re){if(ye===Re)return Fe=!0,0;var je=!ye.compareDocumentPosition-!Re.compareDocumentPosition;return je||(1&(je=(ye.ownerDocument||ye)==(Re.ownerDocument||Re)?ye.compareDocumentPosition(Re):1)||!F.sortDetached&&Re.compareDocumentPosition(ye)===je?ye==Me||ye.ownerDocument==at&&Ut(at,ye)?-1:Re==Me||Re.ownerDocument==at&&Ut(at,Re)?1:Ie?qt(Ie,ye)-qt(Ie,Re):0:4&je?-1:1)}:function(ye,Re){if(ye===Re)return Fe=!0,0;var je,Ue=0,qe=ye.parentNode,nt=Re.parentNode,tt=[ye],it=[Re];if(!qe||!nt)return ye==Me?-1:Re==Me?1:qe?-1:nt?1:Ie?qt(Ie,ye)-qt(Ie,Re):0;if(qe===nt)return gs(ye,Re);for(je=ye;je=je.parentNode;)tt.unshift(je);for(je=Re;je=je.parentNode;)it.unshift(je);for(;tt[Ue]===it[Ue];)Ue++;return Ue?gs(tt[Ue],it[Ue]):tt[Ue]==at?-1:it[Ue]==at?1:0}),Me},mt.matches=function(Z,ae){return mt(Z,null,null,ae)},mt.matchesSelector=function(Z,ae){if(Ce(Z),F.matchesSelector&&Ze&&!Jt[ae+" "]&&(!vt||!vt.test(ae))&&(!Ve||!Ve.test(ae)))try{var fe=Mt.call(Z,ae);if(fe||F.disconnectedMatch||Z.document&&11!==Z.document.nodeType)return fe}catch{Jt(ae,!0)}return 0<mt(ae,Me,null,[Z]).length},mt.contains=function(Z,ae){return(Z.ownerDocument||Z)!=Me&&Ce(Z),Ut(Z,ae)},mt.attr=function(Z,ae){(Z.ownerDocument||Z)!=Me&&Ce(Z);var fe=j.attrHandle[ae.toLowerCase()],Le=fe&&gi.call(j.attrHandle,ae.toLowerCase())?fe(Z,ae,!Ze):void 0;return void 0!==Le?Le:F.attributes||!Ze?Z.getAttribute(ae):(Le=Z.getAttributeNode(ae))&&Le.specified?Le.value:null},mt.escape=function(Z){return(Z+"").replace(ds,ps)},mt.error=function(Z){throw new Error("Syntax error, unrecognized expression: "+Z)},mt.uniqueSort=function(Z){var ae,fe=[],Le=0,ye=0;if(Fe=!F.detectDuplicates,Ie=!F.sortStable&&Z.slice(0),Z.sort(ui),Fe){for(;ae=Z[ye++];)ae===Z[ye]&&(Le=fe.push(ye));for(;Le--;)Z.splice(fe[Le],1)}return Ie=null,Z},U=mt.getText=function(Z){var ae,fe="",Le=0,ye=Z.nodeType;if(ye){if(1===ye||9===ye||11===ye){if("string"==typeof Z.textContent)return Z.textContent;for(Z=Z.firstChild;Z;Z=Z.nextSibling)fe+=U(Z)}else if(3===ye||4===ye)return Z.nodeValue}else for(;ae=Z[Le++];)fe+=U(ae);return fe},(j=mt.selectors={cacheLength:50,createPseudo:ei,match:Ii,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Z){return Z[1]=Z[1].replace(oi,li),Z[3]=(Z[3]||Z[4]||Z[5]||"").replace(oi,li),"~="===Z[2]&&(Z[3]=" "+Z[3]+" "),Z.slice(0,4)},CHILD:function(Z){return Z[1]=Z[1].toLowerCase(),"nth"===Z[1].slice(0,3)?(Z[3]||mt.error(Z[0]),Z[4]=+(Z[4]?Z[5]+(Z[6]||1):2*("even"===Z[3]||"odd"===Z[3])),Z[5]=+(Z[7]+Z[8]||"odd"===Z[3])):Z[3]&&mt.error(Z[0]),Z},PSEUDO:function(Z){var ae,fe=!Z[6]&&Z[2];return Ii.CHILD.test(Z[0])?null:(Z[3]?Z[2]=Z[4]||Z[5]||"":fe&&Hs.test(fe)&&(ae=V(fe,!0))&&(ae=fe.indexOf(")",fe.length-ae)-fe.length)&&(Z[0]=Z[0].slice(0,ae),Z[2]=fe.slice(0,ae)),Z.slice(0,3))}},filter:{TAG:function(Z){var ae=Z.replace(oi,li).toLowerCase();return"*"===Z?function(){return!0}:function(fe){return fe.nodeName&&fe.nodeName.toLowerCase()===ae}},CLASS:function(Z){var ae=bt[Z+" "];return ae||(ae=new RegExp("(^|"+rt+")"+Z+"("+rt+"|$)"))&&bt(Z,function(fe){return ae.test("string"==typeof fe.className&&fe.className||typeof fe.getAttribute<"u"&&fe.getAttribute("class")||"")})},ATTR:function(Z,ae,fe){return function(Le){var ye=mt.attr(Le,Z);return null==ye?"!="===ae:!ae||(ye+="","="===ae?ye===fe:"!="===ae?ye!==fe:"^="===ae?fe&&0===ye.indexOf(fe):"*="===ae?fe&&-1<ye.indexOf(fe):"$="===ae?fe&&ye.slice(-fe.length)===fe:"~="===ae?-1<(" "+ye.replace(_t," ")+" ").indexOf(fe):"|="===ae&&(ye===fe||ye.slice(0,fe.length+1)===fe+"-"))}},CHILD:function(Z,ae,fe,Le,ye){var Re="nth"!==Z.slice(0,3),je="last"!==Z.slice(-4),Ue="of-type"===ae;return 1===Le&&0===ye?function(qe){return!!qe.parentNode}:function(qe,nt,tt){var it,ct,Ct,ot,Pt,Et,jt=Re!==je?"nextSibling":"previousSibling",yt=qe.parentNode,ri=Ue&&qe.nodeName.toLowerCase(),$t=!tt&&!Ue,It=!1;if(yt){if(Re){for(;jt;){for(ot=qe;ot=ot[jt];)if(Ue?ot.nodeName.toLowerCase()===ri:1===ot.nodeType)return!1;Et=jt="only"===Z&&!Et&&"nextSibling"}return!0}if(Et=[je?yt.firstChild:yt.lastChild],je&&$t){for(It=(Pt=(it=(ct=(Ct=(ot=yt)[gt]||(ot[gt]={}))[ot.uniqueID]||(Ct[ot.uniqueID]={}))[Z]||[])[0]===Ht&&it[1])&&it[2],ot=Pt&&yt.childNodes[Pt];ot=++Pt&&ot&&ot[jt]||(It=Pt=0)||Et.pop();)if(1===ot.nodeType&&++It&&ot===qe){ct[Z]=[Ht,Pt,It];break}}else if($t&&(It=Pt=(it=(ct=(Ct=(ot=qe)[gt]||(ot[gt]={}))[ot.uniqueID]||(Ct[ot.uniqueID]={}))[Z]||[])[0]===Ht&&it[1]),!1===It)for(;(ot=++Pt&&ot&&ot[jt]||(It=Pt=0)||Et.pop())&&((Ue?ot.nodeName.toLowerCase()!==ri:1!==ot.nodeType)||!++It||($t&&((ct=(Ct=ot[gt]||(ot[gt]={}))[ot.uniqueID]||(Ct[ot.uniqueID]={}))[Z]=[Ht,It]),ot!==qe)););return(It-=ye)===Le||It%Le==0&&0<=It/Le}}},PSEUDO:function(Z,ae){var fe,Le=j.pseudos[Z]||j.setFilters[Z.toLowerCase()]||mt.error("unsupported pseudo: "+Z);return Le[gt]?Le(ae):1<Le.length?(fe=[Z,Z,"",ae],j.setFilters.hasOwnProperty(Z.toLowerCase())?ei(function(ye,Re){for(var je,Ue=Le(ye,ae),qe=Ue.length;qe--;)ye[je=qt(ye,Ue[qe])]=!(Re[je]=Ue[qe])}):function(ye){return Le(ye,0,fe)}):Le}},pseudos:{not:ei(function(Z){var ae=[],fe=[],Le=re(Z.replace(Yt,"$1"));return Le[gt]?ei(function(ye,Re,je,Ue){for(var qe,nt=Le(ye,null,Ue,[]),tt=ye.length;tt--;)(qe=nt[tt])&&(ye[tt]=!(Re[tt]=qe))}):function(ye,Re,je){return ae[0]=ye,Le(ae,null,je,fe),ae[0]=null,!fe.pop()}}),has:ei(function(Z){return function(ae){return 0<mt(Z,ae).length}}),contains:ei(function(Z){return Z=Z.replace(oi,li),function(ae){return-1<(ae.textContent||U(ae)).indexOf(Z)}}),lang:ei(function(Z){return Bs.test(Z||"")||mt.error("unsupported lang: "+Z),Z=Z.replace(oi,li).toLowerCase(),function(ae){var fe;do{if(fe=Ze?ae.lang:ae.getAttribute("xml:lang")||ae.getAttribute("lang"))return(fe=fe.toLowerCase())===Z||0===fe.indexOf(Z+"-")}while((ae=ae.parentNode)&&1===ae.nodeType);return!1}}),target:function(Z){var ae=k.location&&k.location.hash;return ae&&ae.slice(1)===Z.id},root:function(Z){return Z===Xe},focus:function(Z){return Z===Me.activeElement&&(!Me.hasFocus||Me.hasFocus())&&!!(Z.type||Z.href||~Z.tabIndex)},enabled:ms(!1),disabled:ms(!0),checked:function(Z){var ae=Z.nodeName.toLowerCase();return"input"===ae&&!!Z.checked||"option"===ae&&!!Z.selected},selected:function(Z){return!0===Z.selected},empty:function(Z){for(Z=Z.firstChild;Z;Z=Z.nextSibling)if(Z.nodeType<6)return!1;return!0},parent:function(Z){return!j.pseudos.empty(Z)},header:function(Z){return Js.test(Z.nodeName)},input:function(Z){return Us.test(Z.nodeName)},button:function(Z){var ae=Z.nodeName.toLowerCase();return"input"===ae&&"button"===Z.type||"button"===ae},text:function(Z){var ae;return"input"===Z.nodeName.toLowerCase()&&"text"===Z.type&&(null==(ae=Z.getAttribute("type"))||"text"===ae.toLowerCase())},first:di(function(){return[0]}),last:di(function(Z,ae){return[ae-1]}),eq:di(function(Z,ae,fe){return[fe<0?fe+ae:fe]}),even:di(function(Z,ae){for(var fe=0;fe<ae;fe+=2)Z.push(fe);return Z}),odd:di(function(Z,ae){for(var fe=1;fe<ae;fe+=2)Z.push(fe);return Z}),lt:di(function(Z,ae,fe){for(var Le=fe<0?fe+ae:ae<fe?ae:fe;0<=--Le;)Z.push(Le);return Z}),gt:di(function(Z,ae,fe){for(var Le=fe<0?fe+ae:fe;++Le<ae;)Z.push(Le);return Z})}}).pseudos.nth=j.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})j.pseudos[T]=Xs(T);for(T in{submit:!0,reset:!0})j.pseudos[T]=Ys(T);function ys(){}function Mi(Z){for(var ae=0,fe=Z.length,Le="";ae<fe;ae++)Le+=Z[ae].value;return Le}function Oi(Z,ae,fe){var Le=ae.dir,ye=ae.next,Re=ye||Le,je=fe&&"parentNode"===Re,Ue=ht++;return ae.first?function(qe,nt,tt){for(;qe=qe[Le];)if(1===qe.nodeType||je)return Z(qe,nt,tt);return!1}:function(qe,nt,tt){var it,ct,Ct,ot=[Ht,Ue];if(tt){for(;qe=qe[Le];)if((1===qe.nodeType||je)&&Z(qe,nt,tt))return!0}else for(;qe=qe[Le];)if(1===qe.nodeType||je)if(ct=(Ct=qe[gt]||(qe[gt]={}))[qe.uniqueID]||(Ct[qe.uniqueID]={}),ye&&ye===qe.nodeName.toLowerCase())qe=qe[Le]||qe;else{if((it=ct[Re])&&it[0]===Ht&&it[1]===Ue)return ot[2]=it[2];if((ct[Re]=ot)[2]=Z(qe,nt,tt))return!0}return!1}}function Ji(Z){return 1<Z.length?function(ae,fe,Le){for(var ye=Z.length;ye--;)if(!Z[ye](ae,fe,Le))return!1;return!0}:Z[0]}function Pi(Z,ae,fe,Le,ye){for(var Re,je=[],Ue=0,qe=Z.length,nt=null!=ae;Ue<qe;Ue++)(Re=Z[Ue])&&(fe&&!fe(Re,Le,ye)||(je.push(Re),nt&&ae.push(Ue)));return je}function Gi(Z,ae,fe,Le,ye,Re){return Le&&!Le[gt]&&(Le=Gi(Le)),ye&&!ye[gt]&&(ye=Gi(ye,Re)),ei(function(je,Ue,qe,nt){var tt,it,ct,Ct=[],ot=[],Pt=Ue.length,Et=je||function(ri,$t,It){for(var ii=0,Di=$t.length;ii<Di;ii++)mt(ri,$t[ii],It);return It}(ae||"*",qe.nodeType?[qe]:qe,[]),jt=!Z||!je&&ae?Et:Pi(Et,Ct,Z,qe,nt),yt=fe?ye||(je?Z:Pt||Le)?[]:Ue:jt;if(fe&&fe(jt,yt,qe,nt),Le)for(tt=Pi(yt,ot),Le(tt,[],qe,nt),it=tt.length;it--;)(ct=tt[it])&&(yt[ot[it]]=!(jt[ot[it]]=ct));if(je){if(ye||Z){if(ye){for(tt=[],it=yt.length;it--;)(ct=yt[it])&&tt.push(jt[it]=ct);ye(null,yt=[],tt,nt)}for(it=yt.length;it--;)(ct=yt[it])&&-1<(tt=ye?qt(je,ct):Ct[it])&&(je[tt]=!(Ue[tt]=ct))}}else yt=Pi(yt===Ue?yt.splice(Pt,yt.length):yt),ye?ye(null,Ue,yt,nt):xt.apply(Ue,yt)})}function qi(Z){for(var ae,fe,Le,ye=Z.length,Re=j.relative[Z[0].type],je=Re||j.relative[" "],Ue=Re?1:0,qe=Oi(function(it){return it===ae},je,!0),nt=Oi(function(it){return-1<qt(ae,it)},je,!0),tt=[function(it,ct,Ct){var ot=!Re&&(Ct||ct!==ge)||((ae=ct).nodeType?qe(it,ct,Ct):nt(it,ct,Ct));return ae=null,ot}];Ue<ye;Ue++)if(fe=j.relative[Z[Ue].type])tt=[Oi(Ji(tt),fe)];else{if((fe=j.filter[Z[Ue].type].apply(null,Z[Ue].matches))[gt]){for(Le=++Ue;Le<ye&&!j.relative[Z[Le].type];Le++);return Gi(1<Ue&&Ji(tt),1<Ue&&Mi(Z.slice(0,Ue-1).concat({value:" "===Z[Ue-2].type?"*":""})).replace(Yt,"$1"),fe,Ue<Le&&qi(Z.slice(Ue,Le)),Le<ye&&qi(Z=Z.slice(Le)),Le<ye&&Mi(Z))}tt.push(fe)}return Ji(tt)}return ys.prototype=j.filters=j.pseudos,j.setFilters=new ys,V=mt.tokenize=function(Z,ae){var fe,Le,ye,Re,je,Ue,qe,nt=wi[Z+" "];if(nt)return ae?0:nt.slice(0);for(je=Z,Ue=[],qe=j.preFilter;je;){for(Re in fe&&!(Le=yi.exec(je))||(Le&&(je=je.slice(Le[0].length)||je),Ue.push(ye=[])),fe=!1,(Le=_i.exec(je))&&(fe=Le.shift(),ye.push({value:fe,type:Le[0].replace(Yt," ")}),je=je.slice(fe.length)),j.filter)!(Le=Ii[Re].exec(je))||qe[Re]&&!(Le=qe[Re](Le))||(fe=Le.shift(),ye.push({value:fe,type:Re,matches:Le}),je=je.slice(fe.length));if(!fe)break}return ae?je.length:je?mt.error(Z):wi(Z,Ue).slice(0)},re=mt.compile=function(Z,ae){var fe,Le,ye,Re,je,Ue,qe=[],nt=[],tt=ki[Z+" "];if(!tt){for(ae||(ae=V(Z)),fe=ae.length;fe--;)(tt=qi(ae[fe]))[gt]?qe.push(tt):nt.push(tt);(tt=ki(Z,(Le=nt,Re=0<(ye=qe).length,je=0<Le.length,Ue=function(it,ct,Ct,ot,Pt){var Et,jt,yt,ri=0,$t="0",It=it&&[],ii=[],Di=ge,vs=it||je&&j.find.TAG("*",Pt),bs=Ht+=null==Di?1:Math.random()||.1,Vs=vs.length;for(Pt&&(ge=ct==Me||ct||Pt);$t!==Vs&&null!=(Et=vs[$t]);$t++){if(je&&Et){for(jt=0,ct||Et.ownerDocument==Me||(Ce(Et),Ct=!Ze);yt=Le[jt++];)if(yt(Et,ct||Me,Ct)){ot.push(Et);break}Pt&&(Ht=bs)}Re&&((Et=!yt&&Et)&&ri--,it&&It.push(Et))}if(ri+=$t,Re&&$t!==ri){for(jt=0;yt=ye[jt++];)yt(It,ii,ct,Ct);if(it){if(0<ri)for(;$t--;)It[$t]||ii[$t]||(ii[$t]=mi.call(ot));ii=Pi(ii)}xt.apply(ot,ii),Pt&&!it&&0<ii.length&&1<ri+ye.length&&mt.uniqueSort(ot)}return Pt&&(Ht=bs,ge=Di),It},Re?ei(Ue):Ue))).selector=Z}return tt},ue=mt.select=function(Z,ae,fe,Le){var ye,Re,je,Ue,qe,nt="function"==typeof Z&&Z,tt=!Le&&V(Z=nt.selector||Z);if(fe=fe||[],1===tt.length){if(2<(Re=tt[0]=tt[0].slice(0)).length&&"ID"===(je=Re[0]).type&&9===ae.nodeType&&Ze&&j.relative[Re[1].type]){if(!(ae=(j.find.ID(je.matches[0].replace(oi,li),ae)||[])[0]))return fe;nt&&(ae=ae.parentNode),Z=Z.slice(Re.shift().value.length)}for(ye=Ii.needsContext.test(Z)?0:Re.length;ye--&&!j.relative[Ue=(je=Re[ye]).type];)if((qe=j.find[Ue])&&(Le=qe(je.matches[0].replace(oi,li),Bi.test(Re[0].type)&&Ui(ae.parentNode)||ae))){if(Re.splice(ye,1),!(Z=Le.length&&Mi(Re)))return xt.apply(fe,Le),fe;break}}return(nt||re(Z,tt))(Le,ae,!Ze,fe,!ae||Bi.test(Z)&&Ui(ae.parentNode)||ae),fe},F.sortStable=gt.split("").sort(ui).join("")===gt,F.detectDuplicates=!!Fe,Ce(),F.sortDetached=ti(function(Z){return 1&Z.compareDocumentPosition(Me.createElement("fieldset"))}),ti(function(Z){return Z.innerHTML="<a href='#'></a>","#"===Z.firstChild.getAttribute("href")})||Wi("type|href|height|width",function(Z,ae,fe){if(!fe)return Z.getAttribute(ae,"type"===ae.toLowerCase()?1:2)}),F.attributes&&ti(function(Z){return Z.innerHTML="<input/>",Z.firstChild.setAttribute("value",""),""===Z.firstChild.getAttribute("value")})||Wi("value",function(Z,ae,fe){if(!fe&&"input"===Z.nodeName.toLowerCase())return Z.defaultValue}),ti(function(Z){return null==Z.getAttribute("disabled")})||Wi(ai,function(Z,ae,fe){var Le;if(!fe)return!0===Z[ae]?ae.toLowerCase():(Le=Z.getAttributeNode(ae))&&Le.specified?Le.value:null}),mt}(e);y.find=_,y.expr=_.selectors,y.expr[":"]=y.expr.pseudos,y.uniqueSort=y.unique=_.uniqueSort,y.text=_.getText,y.isXMLDoc=_.isXML,y.contains=_.contains,y.escapeSelector=_.escape;var C=function(k,T,F){for(var j=[],U=void 0!==F;(k=k[T])&&9!==k.nodeType;)if(1===k.nodeType){if(U&&y(k).is(F))break;j.push(k)}return j},I=function(k,T){for(var F=[];k;k=k.nextSibling)1===k.nodeType&&k!==T&&F.push(k);return F},L=y.expr.match.needsContext;function D(k,T){return k.nodeName&&k.nodeName.toLowerCase()===T.toLowerCase()}var O=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function M(k,T,F){return u(T)?y.grep(k,function(j,U){return!!T.call(j,U,j)!==F}):T.nodeType?y.grep(k,function(j){return j===T!==F}):"string"!=typeof T?y.grep(k,function(j){return-1<c.call(T,j)!==F}):y.filter(T,k,F)}y.filter=function(k,T,F){var j=T[0];return F&&(k=":not("+k+")"),1===T.length&&1===j.nodeType?y.find.matchesSelector(j,k)?[j]:[]:y.find.matches(k,y.grep(T,function(U){return 1===U.nodeType}))},y.fn.extend({find:function(k){var T,F,j=this.length,U=this;if("string"!=typeof k)return this.pushStack(y(k).filter(function(){for(T=0;T<j;T++)if(y.contains(U[T],this))return!0}));for(F=this.pushStack([]),T=0;T<j;T++)y.find(k,U[T],F);return 1<j?y.uniqueSort(F):F},filter:function(k){return this.pushStack(M(this,k||[],!1))},not:function(k){return this.pushStack(M(this,k||[],!0))},is:function(k){return!!M(this,"string"==typeof k&&L.test(k)?y(k):k||[],!1).length}});var E,R=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(y.fn.init=function(k,T,F){var j,U;if(!k)return this;if(F=F||E,"string"==typeof k){if(!(j="<"===k[0]&&">"===k[k.length-1]&&3<=k.length?[null,k,null]:R.exec(k))||!j[1]&&T)return!T||T.jquery?(T||F).find(k):this.constructor(T).find(k);if(j[1]){if(y.merge(this,y.parseHTML(j[1],(T=T instanceof y?T[0]:T)&&T.nodeType?T.ownerDocument||T:m,!0)),O.test(j[1])&&y.isPlainObject(T))for(j in T)u(this[j])?this[j](T[j]):this.attr(j,T[j]);return this}return(U=m.getElementById(j[2]))&&(this[0]=U,this.length=1),this}return k.nodeType?(this[0]=k,this.length=1,this):u(k)?void 0!==F.ready?F.ready(k):k(y):y.makeArray(k,this)}).prototype=y.fn,E=y(m);var H=/^(?:parents|prev(?:Until|All))/,N={children:!0,contents:!0,next:!0,prev:!0};function B(k,T){for(;(k=k[T])&&1!==k.nodeType;);return k}y.fn.extend({has:function(k){var T=y(k,this),F=T.length;return this.filter(function(){for(var j=0;j<F;j++)if(y.contains(this,T[j]))return!0})},closest:function(k,T){var F,j=0,U=this.length,X=[],V="string"!=typeof k&&y(k);if(!L.test(k))for(;j<U;j++)for(F=this[j];F&&F!==T;F=F.parentNode)if(F.nodeType<11&&(V?-1<V.index(F):1===F.nodeType&&y.find.matchesSelector(F,k))){X.push(F);break}return this.pushStack(1<X.length?y.uniqueSort(X):X)},index:function(k){return k?"string"==typeof k?c.call(y(k),this[0]):c.call(this,k.jquery?k[0]:k):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(k,T){return this.pushStack(y.uniqueSort(y.merge(this.get(),y(k,T))))},addBack:function(k){return this.add(null==k?this.prevObject:this.prevObject.filter(k))}}),y.each({parent:function(k){var T=k.parentNode;return T&&11!==T.nodeType?T:null},parents:function(k){return C(k,"parentNode")},parentsUntil:function(k,T,F){return C(k,"parentNode",F)},next:function(k){return B(k,"nextSibling")},prev:function(k){return B(k,"previousSibling")},nextAll:function(k){return C(k,"nextSibling")},prevAll:function(k){return C(k,"previousSibling")},nextUntil:function(k,T,F){return C(k,"nextSibling",F)},prevUntil:function(k,T,F){return C(k,"previousSibling",F)},siblings:function(k){return I((k.parentNode||{}).firstChild,k)},children:function(k){return I(k.firstChild)},contents:function(k){return null!=k.contentDocument&&o(k.contentDocument)?k.contentDocument:(D(k,"template")&&(k=k.content||k),y.merge([],k.childNodes))}},function(k,T){y.fn[k]=function(F,j){var U=y.map(this,T,F);return"Until"!==k.slice(-5)&&(j=F),j&&"string"==typeof j&&(U=y.filter(j,U)),1<this.length&&(N[k]||y.uniqueSort(U),H.test(k)&&U.reverse()),this.pushStack(U)}});var P=/[^\x20\t\r\n\f]+/g;function z(k){return k}function J(k){throw k}function q(k,T,F,j){var U;try{k&&u(U=k.promise)?U.call(k).done(T).fail(F):k&&u(U=k.then)?U.call(k,T,F):T.apply(void 0,[k].slice(j))}catch(X){F.apply(void 0,[X])}}y.Callbacks=function(k){var F;k="string"==typeof k?(F={},y.each(k.match(P)||[],function(Ce,Me){F[Me]=!0}),F):y.extend({},k);var j,U,X,V,re=[],ue=[],ge=-1,Ie=function(){for(V=V||k.once,X=j=!0;ue.length;ge=-1)for(U=ue.shift();++ge<re.length;)!1===re[ge].apply(U[0],U[1])&&k.stopOnFalse&&(ge=re.length,U=!1);k.memory||(U=!1),j=!1,V&&(re=U?[]:"")},Fe={add:function(){return re&&(U&&!j&&(ge=re.length-1,ue.push(U)),function Ce(Me){y.each(Me,function(Xe,Ze){u(Ze)?k.unique&&Fe.has(Ze)||re.push(Ze):Ze&&Ze.length&&"string"!==A(Ze)&&Ce(Ze)})}(arguments),U&&!j&&Ie()),this},remove:function(){return y.each(arguments,function(Ce,Me){for(var Xe;-1<(Xe=y.inArray(Me,re,Xe));)re.splice(Xe,1),Xe<=ge&&ge--}),this},has:function(Ce){return Ce?-1<y.inArray(Ce,re):0<re.length},empty:function(){return re&&(re=[]),this},disable:function(){return V=ue=[],re=U="",this},disabled:function(){return!re},lock:function(){return V=ue=[],U||j||(re=U=""),this},locked:function(){return!!V},fireWith:function(Ce,Me){return V||(Me=[Ce,(Me=Me||[]).slice?Me.slice():Me],ue.push(Me),j||Ie()),this},fire:function(){return Fe.fireWith(this,arguments),this},fired:function(){return!!X}};return Fe},y.extend({Deferred:function(k){var T=[["notify","progress",y.Callbacks("memory"),y.Callbacks("memory"),2],["resolve","done",y.Callbacks("once memory"),y.Callbacks("once memory"),0,"resolved"],["reject","fail",y.Callbacks("once memory"),y.Callbacks("once memory"),1,"rejected"]],F="pending",j={state:function(){return F},always:function(){return U.done(arguments).fail(arguments),this},catch:function(X){return j.then(null,X)},pipe:function(){var X=arguments;return y.Deferred(function(V){y.each(T,function(re,ue){var ge=u(X[ue[4]])&&X[ue[4]];U[ue[1]](function(){var Ie=ge&&ge.apply(this,arguments);Ie&&u(Ie.promise)?Ie.promise().progress(V.notify).done(V.resolve).fail(V.reject):V[ue[0]+"With"](this,ge?[Ie]:arguments)})}),X=null}).promise()},then:function(X,V,re){var ue=0;function ge(Ie,Fe,Ce,Me){return function(){var Xe=this,Ze=arguments,Ve=function(){var Mt,Ut;if(!(Ie<ue)){if((Mt=Ce.apply(Xe,Ze))===Fe.promise())throw new TypeError("Thenable self-resolution");u(Ut=Mt&&("object"==typeof Mt||"function"==typeof Mt)&&Mt.then)?Me?Ut.call(Mt,ge(ue,Fe,z,Me),ge(ue,Fe,J,Me)):(ue++,Ut.call(Mt,ge(ue,Fe,z,Me),ge(ue,Fe,J,Me),ge(ue,Fe,z,Fe.notifyWith))):(Ce!==z&&(Xe=void 0,Ze=[Mt]),(Me||Fe.resolveWith)(Xe,Ze))}},vt=Me?Ve:function(){try{Ve()}catch(Mt){y.Deferred.exceptionHook&&y.Deferred.exceptionHook(Mt,vt.stackTrace),ue<=Ie+1&&(Ce!==J&&(Xe=void 0,Ze=[Mt]),Fe.rejectWith(Xe,Ze))}};Ie?vt():(y.Deferred.getStackHook&&(vt.stackTrace=y.Deferred.getStackHook()),e.setTimeout(vt))}}return y.Deferred(function(Ie){T[0][3].add(ge(0,Ie,u(re)?re:z,Ie.notifyWith)),T[1][3].add(ge(0,Ie,u(X)?X:z)),T[2][3].add(ge(0,Ie,u(V)?V:J))}).promise()},promise:function(X){return null!=X?y.extend(X,j):j}},U={};return y.each(T,function(X,V){var re=V[2],ue=V[5];j[V[1]]=re.add,ue&&re.add(function(){F=ue},T[3-X][2].disable,T[3-X][3].disable,T[0][2].lock,T[0][3].lock),re.add(V[3].fire),U[V[0]]=function(){return U[V[0]+"With"](this===U?void 0:this,arguments),this},U[V[0]+"With"]=re.fireWith}),j.promise(U),k&&k.call(U,U),U},when:function(k){var T=arguments.length,F=T,j=Array(F),U=n.call(arguments),X=y.Deferred(),V=function(re){return function(ue){j[re]=this,U[re]=1<arguments.length?n.call(arguments):ue,--T||X.resolveWith(j,U)}};if(T<=1&&(q(k,X.done(V(F)).resolve,X.reject,!T),"pending"===X.state()||u(U[F]&&U[F].then)))return X.then();for(;F--;)q(U[F],V(F),X.reject);return X.promise()}});var G=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;y.Deferred.exceptionHook=function(k,T){e.console&&e.console.warn&&k&&G.test(k.name)&&e.console.warn("jQuery.Deferred exception: "+k.message,k.stack,T)},y.readyException=function(k){e.setTimeout(function(){throw k})};var ee=y.Deferred();function le(){m.removeEventListener("DOMContentLoaded",le),e.removeEventListener("load",le),y.ready()}y.fn.ready=function(k){return ee.then(k).catch(function(T){y.readyException(T)}),this},y.extend({isReady:!1,readyWait:1,ready:function(k){(!0===k?--y.readyWait:y.isReady)||(y.isReady=!0)!==k&&0<--y.readyWait||ee.resolveWith(m,[y])}}),y.ready.then=ee.then,"complete"===m.readyState||"loading"!==m.readyState&&!m.documentElement.doScroll?e.setTimeout(y.ready):(m.addEventListener("DOMContentLoaded",le),e.addEventListener("load",le));var te=function(k,T,F,j,U,X,V){var re=0,ue=k.length,ge=null==F;if("object"===A(F))for(re in U=!0,F)te(k,T,re,F[re],!0,X,V);else if(void 0!==j&&(U=!0,u(j)||(V=!0),ge&&(V?(T.call(k,j),T=null):(ge=T,T=function(Ie,Fe,Ce){return ge.call(y(Ie),Ce)})),T))for(;re<ue;re++)T(k[re],F,V?j:j.call(k[re],re,T(k[re],F)));return U?k:ge?T.call(k):ue?T(k[0],F):X},Q=/^-ms-/,de=/-([a-z])/g;function xe(k,T){return T.toUpperCase()}function ce(k){return k.replace(Q,"ms-").replace(de,xe)}var he=function(k){return 1===k.nodeType||9===k.nodeType||!+k.nodeType};function Pe(){this.expando=y.expando+Pe.uid++}Pe.uid=1,Pe.prototype={cache:function(k){var T=k[this.expando];return T||(T=Object.create(null),he(k)&&(k.nodeType?k[this.expando]=T:Object.defineProperty(k,this.expando,{value:T,configurable:!0}))),T},set:function(k,T,F){var j,U=this.cache(k);if("string"==typeof T)U[ce(T)]=F;else for(j in T)U[ce(j)]=T[j];return U},get:function(k,T){return void 0===T?this.cache(k):k[this.expando]&&k[this.expando][ce(T)]},access:function(k,T,F){return void 0===T||T&&"string"==typeof T&&void 0===F?this.get(k,T):(this.set(k,T,F),void 0!==F?F:T)},remove:function(k,T){var F,j=k[this.expando];if(void 0!==j){if(void 0!==T)for((F=(T=Array.isArray(T)?T.map(ce):(T=ce(T))in j?[T]:T.match(P)||[]).length);F--;)delete j[T[F]];(void 0===T||y.isEmptyObject(j))&&(k.nodeType?k[this.expando]=void 0:delete k[this.expando])}},hasData:function(k){var T=k[this.expando];return void 0!==T&&!y.isEmptyObject(T)}};var Se=new Pe,Y=new Pe,ie=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,be=/[A-Z]/g;function ke(k,T,F){var j,U;if(void 0===F&&1===k.nodeType)if(j="data-"+T.replace(be,"-$&").toLowerCase(),"string"==typeof(F=k.getAttribute(j))){try{F="true"===(U=F)||"false"!==U&&("null"===U?null:U===+U+""?+U:ie.test(U)?JSON.parse(U):U)}catch{}Y.set(k,T,F)}else F=void 0;return F}y.extend({hasData:function(k){return Y.hasData(k)||Se.hasData(k)},data:function(k,T,F){return Y.access(k,T,F)},removeData:function(k,T){Y.remove(k,T)},_data:function(k,T,F){return Se.access(k,T,F)},_removeData:function(k,T){Se.remove(k,T)}}),y.fn.extend({data:function(k,T){var F,j,U,X=this[0],V=X&&X.attributes;if(void 0===k){if(this.length&&(U=Y.get(X),1===X.nodeType&&!Se.get(X,"hasDataAttrs"))){for(F=V.length;F--;)V[F]&&0===(j=V[F].name).indexOf("data-")&&(j=ce(j.slice(5)),ke(X,j,U[j]));Se.set(X,"hasDataAttrs",!0)}return U}return"object"==typeof k?this.each(function(){Y.set(this,k)}):te(this,function(re){var ue;if(X&&void 0===re)return void 0!==(ue=Y.get(X,k))||void 0!==(ue=ke(X,k))?ue:void 0;this.each(function(){Y.set(this,k,re)})},null,T,1<arguments.length,null,!0)},removeData:function(k){return this.each(function(){Y.remove(this,k)})}}),y.extend({queue:function(k,T,F){var j;if(k)return j=Se.get(k,T=(T||"fx")+"queue"),F&&(!j||Array.isArray(F)?j=Se.access(k,T,y.makeArray(F)):j.push(F)),j||[]},dequeue:function(k,T){var F=y.queue(k,T=T||"fx"),j=F.length,U=F.shift(),X=y._queueHooks(k,T);"inprogress"===U&&(U=F.shift(),j--),U&&("fx"===T&&F.unshift("inprogress"),delete X.stop,U.call(k,function(){y.dequeue(k,T)},X)),!j&&X&&X.empty.fire()},_queueHooks:function(k,T){var F=T+"queueHooks";return Se.get(k,F)||Se.access(k,F,{empty:y.Callbacks("once memory").add(function(){Se.remove(k,[T+"queue",F])})})}}),y.fn.extend({queue:function(k,T){var F=2;return"string"!=typeof k&&(T=k,k="fx",F--),arguments.length<F?y.queue(this[0],k):void 0===T?this:this.each(function(){var j=y.queue(this,k,T);y._queueHooks(this,k),"fx"===k&&"inprogress"!==j[0]&&y.dequeue(this,k)})},dequeue:function(k){return this.each(function(){y.dequeue(this,k)})},clearQueue:function(k){return this.queue(k||"fx",[])},promise:function(k,T){var F,j=1,U=y.Deferred(),X=this,V=this.length,re=function(){--j||U.resolveWith(X,[X])};for("string"!=typeof k&&(T=k,k=void 0),k=k||"fx";V--;)(F=Se.get(X[V],k+"queueHooks"))&&F.empty&&(j++,F.empty.add(re));return re(),U.promise(T)}});var Ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,$e=new RegExp("^(?:([+-])=|)("+Ee+")([a-z%]*)$","i"),Ge=["Top","Right","Bottom","Left"],Ye=m.documentElement,W=function(k){return y.contains(k.ownerDocument,k)},K={composed:!0};Ye.getRootNode&&(W=function(k){return y.contains(k.ownerDocument,k)||k.getRootNode(K)===k.ownerDocument});var ne=function(k,T){return"none"===(k=T||k).style.display||""===k.style.display&&W(k)&&"none"===y.css(k,"display")};function oe(k,T,F,j){var U,X,V=20,re=j?function(){return j.cur()}:function(){return y.css(k,T,"")},ue=re(),ge=F&&F[3]||(y.cssNumber[T]?"":"px"),Ie=k.nodeType&&(y.cssNumber[T]||"px"!==ge&&+ue)&&$e.exec(y.css(k,T));if(Ie&&Ie[3]!==ge){for(ge=ge||Ie[3],Ie=+(ue/=2)||1;V--;)y.style(k,T,Ie+ge),(1-X)*(1-(X=re()/ue||.5))<=0&&(V=0),Ie/=X;y.style(k,T,(Ie*=2)+ge),F=F||[]}return F&&(Ie=+Ie||+ue||0,U=F[1]?Ie+(F[1]+1)*F[2]:+F[2],j&&(j.unit=ge,j.start=Ie,j.end=U)),U}var se={};function ve(k,T){for(var F,j,U,X,V,re,ue,ge=[],Ie=0,Fe=k.length;Ie<Fe;Ie++)(j=k[Ie]).style&&(F=j.style.display,T?("none"===F&&(ge[Ie]=Se.get(j,"display")||null,ge[Ie]||(j.style.display="")),""===j.style.display&&ne(j)&&(ge[Ie]=(ue=V=X=void 0,V=(U=j).ownerDocument,(ue=se[re=U.nodeName])||(X=V.body.appendChild(V.createElement(re)),ue=y.css(X,"display"),X.parentNode.removeChild(X),"none"===ue&&(ue="block"),se[re]=ue)))):"none"!==F&&(ge[Ie]="none",Se.set(j,"display",F)));for(Ie=0;Ie<Fe;Ie++)null!=ge[Ie]&&(k[Ie].style.display=ge[Ie]);return k}y.fn.extend({show:function(){return ve(this,!0)},hide:function(){return ve(this)},toggle:function(k){return"boolean"==typeof k?k?this.show():this.hide():this.each(function(){ne(this)?y(this).show():y(this).hide()})}});var pe,Ae,we=/^(?:checkbox|radio)$/i,me=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,De=/^$|^module$|\/(?:java|ecma)script/i;pe=m.createDocumentFragment().appendChild(m.createElement("div")),(Ae=m.createElement("input")).setAttribute("type","radio"),Ae.setAttribute("checked","checked"),Ae.setAttribute("name","t"),pe.appendChild(Ae),r.checkClone=pe.cloneNode(!0).cloneNode(!0).lastChild.checked,pe.innerHTML="<textarea>x</textarea>",r.noCloneChecked=!!pe.cloneNode(!0).lastChild.defaultValue,pe.innerHTML="<option></option>",r.option=!!pe.lastChild;var Ne={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function He(k,T){var F;return F=typeof k.getElementsByTagName<"u"?k.getElementsByTagName(T||"*"):typeof k.querySelectorAll<"u"?k.querySelectorAll(T||"*"):[],void 0===T||T&&D(k,T)?y.merge([k],F):F}function Je(k,T){for(var F=0,j=k.length;F<j;F++)Se.set(k[F],"globalEval",!T||Se.get(T[F],"globalEval"))}Ne.tbody=Ne.tfoot=Ne.colgroup=Ne.caption=Ne.thead,Ne.th=Ne.td,r.option||(Ne.optgroup=Ne.option=[1,"<select multiple='multiple'>","</select>"]);var st=/<|&#?\w+;/;function Te(k,T,F,j,U){for(var X,V,re,ue,ge,Ie,Fe=T.createDocumentFragment(),Ce=[],Me=0,Xe=k.length;Me<Xe;Me++)if((X=k[Me])||0===X)if("object"===A(X))y.merge(Ce,X.nodeType?[X]:X);else if(st.test(X)){for(V=V||Fe.appendChild(T.createElement("div")),re=(me.exec(X)||["",""])[1].toLowerCase(),V.innerHTML=(ue=Ne[re]||Ne._default)[1]+y.htmlPrefilter(X)+ue[2],Ie=ue[0];Ie--;)V=V.lastChild;y.merge(Ce,V.childNodes),(V=Fe.firstChild).textContent=""}else Ce.push(T.createTextNode(X));for(Fe.textContent="",Me=0;X=Ce[Me++];)if(j&&-1<y.inArray(X,j))U&&U.push(X);else if(ge=W(X),V=He(Fe.appendChild(X),"script"),ge&&Je(V),F)for(Ie=0;X=V[Ie++];)De.test(X.type||"")&&F.push(X);return Fe}var _e=/^key/,Oe=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ze=/^([^.]*)(?:\.(.+)|)/;function Be(){return!0}function Qe(){return!1}function lt(k,T){return k===function(){try{return m.activeElement}catch{}}()==("focus"===T)}function wt(k,T,F,j,U,X){var V,re;if("object"==typeof T){for(re in"string"!=typeof F&&(j=j||F,F=void 0),T)wt(k,re,F,j,T[re],X);return k}if(null==j&&null==U?(U=F,j=F=void 0):null==U&&("string"==typeof F?(U=j,j=void 0):(U=j,j=F,F=void 0)),!1===U)U=Qe;else if(!U)return k;return 1===X&&(V=U,(U=function(ue){return y().off(ue),V.apply(this,arguments)}).guid=V.guid||(V.guid=y.guid++)),k.each(function(){y.event.add(this,T,U,j,F)})}function ut(k,T,F){F?(Se.set(k,T,!1),y.event.add(k,T,{namespace:!1,handler:function(j){var U,X,V=Se.get(this,T);if(1&j.isTrigger&&this[T]){if(V.length)(y.event.special[T]||{}).delegateType&&j.stopPropagation();else if(V=n.call(arguments),Se.set(this,T,V),U=F(this,T),this[T](),V!==(X=Se.get(this,T))||U?Se.set(this,T,!1):X={},V!==X)return j.stopImmediatePropagation(),j.preventDefault(),X.value}else V.length&&(Se.set(this,T,{value:y.event.trigger(y.extend(V[0],y.Event.prototype),V.slice(1),this)}),j.stopImmediatePropagation())}})):void 0===Se.get(k,T)&&y.event.add(k,T,Be)}y.event={global:{},add:function(k,T,F,j,U){var X,V,re,ue,ge,Ie,Fe,Ce,Me,Xe,Ze,Ve=Se.get(k);if(he(k))for(F.handler&&(F=(X=F).handler,U=X.selector),U&&y.find.matchesSelector(Ye,U),F.guid||(F.guid=y.guid++),(ue=Ve.events)||(ue=Ve.events=Object.create(null)),(V=Ve.handle)||(V=Ve.handle=function(vt){return typeof y<"u"&&y.event.triggered!==vt.type?y.event.dispatch.apply(k,arguments):void 0}),ge=(T=(T||"").match(P)||[""]).length;ge--;)Me=Ze=(re=ze.exec(T[ge])||[])[1],Xe=(re[2]||"").split(".").sort(),Me&&(Fe=y.event.special[Me]||{},Fe=y.event.special[Me=(U?Fe.delegateType:Fe.bindType)||Me]||{},Ie=y.extend({type:Me,origType:Ze,data:j,handler:F,guid:F.guid,selector:U,needsContext:U&&y.expr.match.needsContext.test(U),namespace:Xe.join(".")},X),(Ce=ue[Me])||((Ce=ue[Me]=[]).delegateCount=0,Fe.setup&&!1!==Fe.setup.call(k,j,Xe,V)||k.addEventListener&&k.addEventListener(Me,V)),Fe.add&&(Fe.add.call(k,Ie),Ie.handler.guid||(Ie.handler.guid=F.guid)),U?Ce.splice(Ce.delegateCount++,0,Ie):Ce.push(Ie),y.event.global[Me]=!0)},remove:function(k,T,F,j,U){var X,V,re,ue,ge,Ie,Fe,Ce,Me,Xe,Ze,Ve=Se.hasData(k)&&Se.get(k);if(Ve&&(ue=Ve.events)){for(ge=(T=(T||"").match(P)||[""]).length;ge--;)if(Me=Ze=(re=ze.exec(T[ge])||[])[1],Xe=(re[2]||"").split(".").sort(),Me){for(Fe=y.event.special[Me]||{},Ce=ue[Me=(j?Fe.delegateType:Fe.bindType)||Me]||[],re=re[2]&&new RegExp("(^|\\.)"+Xe.join("\\.(?:.*\\.|)")+"(\\.|$)"),V=X=Ce.length;X--;)Ie=Ce[X],!U&&Ze!==Ie.origType||F&&F.guid!==Ie.guid||re&&!re.test(Ie.namespace)||j&&j!==Ie.selector&&("**"!==j||!Ie.selector)||(Ce.splice(X,1),Ie.selector&&Ce.delegateCount--,Fe.remove&&Fe.remove.call(k,Ie));V&&!Ce.length&&(Fe.teardown&&!1!==Fe.teardown.call(k,Xe,Ve.handle)||y.removeEvent(k,Me,Ve.handle),delete ue[Me])}else for(Me in ue)y.event.remove(k,Me+T[ge],F,j,!0);y.isEmptyObject(ue)&&Se.remove(k,"handle events")}},dispatch:function(k){var T,F,j,U,X,V,re=new Array(arguments.length),ue=y.event.fix(k),ge=(Se.get(this,"events")||Object.create(null))[ue.type]||[],Ie=y.event.special[ue.type]||{};for(re[0]=ue,T=1;T<arguments.length;T++)re[T]=arguments[T];if(ue.delegateTarget=this,!Ie.preDispatch||!1!==Ie.preDispatch.call(this,ue)){for(V=y.event.handlers.call(this,ue,ge),T=0;(U=V[T++])&&!ue.isPropagationStopped();)for(ue.currentTarget=U.elem,F=0;(X=U.handlers[F++])&&!ue.isImmediatePropagationStopped();)ue.rnamespace&&!1!==X.namespace&&!ue.rnamespace.test(X.namespace)||(ue.handleObj=X,ue.data=X.data,void 0!==(j=((y.event.special[X.origType]||{}).handle||X.handler).apply(U.elem,re))&&!1===(ue.result=j)&&(ue.preventDefault(),ue.stopPropagation()));return Ie.postDispatch&&Ie.postDispatch.call(this,ue),ue.result}},handlers:function(k,T){var F,j,U,X,V,re=[],ue=T.delegateCount,ge=k.target;if(ue&&ge.nodeType&&!("click"===k.type&&1<=k.button))for(;ge!==this;ge=ge.parentNode||this)if(1===ge.nodeType&&("click"!==k.type||!0!==ge.disabled)){for(X=[],V={},F=0;F<ue;F++)void 0===V[U=(j=T[F]).selector+" "]&&(V[U]=j.needsContext?-1<y(U,this).index(ge):y.find(U,this,null,[ge]).length),V[U]&&X.push(j);X.length&&re.push({elem:ge,handlers:X})}return ge=this,ue<T.length&&re.push({elem:ge,handlers:T.slice(ue)}),re},addProp:function(k,T){Object.defineProperty(y.Event.prototype,k,{enumerable:!0,configurable:!0,get:u(T)?function(){if(this.originalEvent)return T(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[k]},set:function(F){Object.defineProperty(this,k,{enumerable:!0,configurable:!0,writable:!0,value:F})}})},fix:function(k){return k[y.expando]?k:new y.Event(k)},special:{load:{noBubble:!0},click:{setup:function(k){var T=this||k;return we.test(T.type)&&T.click&&D(T,"input")&&ut(T,"click",Be),!1},trigger:function(k){var T=this||k;return we.test(T.type)&&T.click&&D(T,"input")&&ut(T,"click"),!0},_default:function(k){var T=k.target;return we.test(T.type)&&T.click&&D(T,"input")&&Se.get(T,"click")||D(T,"a")}},beforeunload:{postDispatch:function(k){void 0!==k.result&&k.originalEvent&&(k.originalEvent.returnValue=k.result)}}}},y.removeEvent=function(k,T,F){k.removeEventListener&&k.removeEventListener(T,F)},y.Event=function(k,T){if(!(this instanceof y.Event))return new y.Event(k,T);k&&k.type?(this.originalEvent=k,this.type=k.type,this.isDefaultPrevented=k.defaultPrevented||void 0===k.defaultPrevented&&!1===k.returnValue?Be:Qe,this.target=k.target&&3===k.target.nodeType?k.target.parentNode:k.target,this.currentTarget=k.currentTarget,this.relatedTarget=k.relatedTarget):this.type=k,T&&y.extend(this,T),this.timeStamp=k&&k.timeStamp||Date.now(),this[y.expando]=!0},y.Event.prototype={constructor:y.Event,isDefaultPrevented:Qe,isPropagationStopped:Qe,isImmediatePropagationStopped:Qe,isSimulated:!1,preventDefault:function(){var k=this.originalEvent;this.isDefaultPrevented=Be,k&&!this.isSimulated&&k.preventDefault()},stopPropagation:function(){var k=this.originalEvent;this.isPropagationStopped=Be,k&&!this.isSimulated&&k.stopPropagation()},stopImmediatePropagation:function(){var k=this.originalEvent;this.isImmediatePropagationStopped=Be,k&&!this.isSimulated&&k.stopImmediatePropagation(),this.stopPropagation()}},y.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(k){var T=k.button;return null==k.which&&_e.test(k.type)?null!=k.charCode?k.charCode:k.keyCode:!k.which&&void 0!==T&&Oe.test(k.type)?1&T?1:2&T?3:4&T?2:0:k.which}},y.event.addProp),y.each({focus:"focusin",blur:"focusout"},function(k,T){y.event.special[k]={setup:function(){return ut(this,k,lt),!1},trigger:function(){return ut(this,k),!0},delegateType:T}}),y.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(k,T){y.event.special[k]={delegateType:T,bindType:T,handle:function(F){var j,U=F.relatedTarget,X=F.handleObj;return U&&(U===this||y.contains(this,U))||(F.type=X.origType,j=X.handler.apply(this,arguments),F.type=T),j}}}),y.fn.extend({on:function(k,T,F,j){return wt(this,k,T,F,j)},one:function(k,T,F,j){return wt(this,k,T,F,j,1)},off:function(k,T,F){var j,U;if(k&&k.preventDefault&&k.handleObj)return j=k.handleObj,y(k.delegateTarget).off(j.namespace?j.origType+"."+j.namespace:j.origType,j.selector,j.handler),this;if("object"==typeof k){for(U in k)this.off(U,T,k[U]);return this}return!1!==T&&"function"!=typeof T||(F=T,T=void 0),!1===F&&(F=Qe),this.each(function(){y.event.remove(this,k,F,T)})}});var Dt=/<script|<style|<link/i,Lt=/checked\s*(?:[^=]|=\s*.checked.)/i,Tt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function zt(k,T){return D(k,"table")&&D(11!==T.nodeType?T:T.firstChild,"tr")&&y(k).children("tbody")[0]||k}function kt(k){return k.type=(null!==k.getAttribute("type"))+"/"+k.type,k}function At(k){return"true/"===(k.type||"").slice(0,5)?k.type=k.type.slice(5):k.removeAttribute("type"),k}function pt(k,T){var F,j,U,X,V,re;if(1===T.nodeType){if(Se.hasData(k)&&(re=Se.get(k).events))for(U in Se.remove(T,"handle events"),re)for(F=0,j=re[U].length;F<j;F++)y.event.add(T,U,re[U][F]);Y.hasData(k)&&(X=Y.access(k),V=y.extend({},X),Y.set(T,V))}}function ft(k,T,F,j){T=a(T);var U,X,V,re,ue,ge,Ie=0,Fe=k.length,Ce=Fe-1,Me=T[0],Xe=u(Me);if(Xe||1<Fe&&"string"==typeof Me&&!r.checkClone&&Lt.test(Me))return k.each(function(Ze){var Ve=k.eq(Ze);Xe&&(T[0]=Me.call(this,Ze,Ve.html())),ft(Ve,T,F,j)});if(Fe&&(X=(U=Te(T,k[0].ownerDocument,!1,k,j)).firstChild,1===U.childNodes.length&&(U=X),X||j)){for(re=(V=y.map(He(U,"script"),kt)).length;Ie<Fe;Ie++)ue=U,Ie!==Ce&&(ue=y.clone(ue,!0,!0),re&&y.merge(V,He(ue,"script"))),F.call(k[Ie],ue,Ie);if(re)for(ge=V[V.length-1].ownerDocument,y.map(V,At),Ie=0;Ie<re;Ie++)De.test((ue=V[Ie]).type||"")&&!Se.access(ue,"globalEval")&&y.contains(ge,ue)&&(ue.src&&"module"!==(ue.type||"").toLowerCase()?y._evalUrl&&!ue.noModule&&y._evalUrl(ue.src,{nonce:ue.nonce||ue.getAttribute("nonce")},ge):w(ue.textContent.replace(Tt,""),ue,ge))}return k}function Nt(k,T,F){for(var j,U=T?y.filter(T,k):k,X=0;null!=(j=U[X]);X++)F||1!==j.nodeType||y.cleanData(He(j)),j.parentNode&&(F&&W(j)&&Je(He(j,"script")),j.parentNode.removeChild(j));return k}y.extend({htmlPrefilter:function(k){return k},clone:function(k,T,F){var j,U,X,V,re,ue,ge,Ie=k.cloneNode(!0),Fe=W(k);if(!(r.noCloneChecked||1!==k.nodeType&&11!==k.nodeType||y.isXMLDoc(k)))for(V=He(Ie),j=0,U=(X=He(k)).length;j<U;j++)re=X[j],"input"===(ge=(ue=V[j]).nodeName.toLowerCase())&&we.test(re.type)?ue.checked=re.checked:"input"!==ge&&"textarea"!==ge||(ue.defaultValue=re.defaultValue);if(T)if(F)for(X=X||He(k),V=V||He(Ie),j=0,U=X.length;j<U;j++)pt(X[j],V[j]);else pt(k,Ie);return 0<(V=He(Ie,"script")).length&&Je(V,!Fe&&He(k,"script")),Ie},cleanData:function(k){for(var T,F,j,U=y.event.special,X=0;void 0!==(F=k[X]);X++)if(he(F)){if(T=F[Se.expando]){if(T.events)for(j in T.events)U[j]?y.event.remove(F,j):y.removeEvent(F,j,T.handle);F[Se.expando]=void 0}F[Y.expando]&&(F[Y.expando]=void 0)}}}),y.fn.extend({detach:function(k){return Nt(this,k,!0)},remove:function(k){return Nt(this,k)},text:function(k){return te(this,function(T){return void 0===T?y.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=T)})},null,k,arguments.length)},append:function(){return ft(this,arguments,function(k){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||zt(this,k).appendChild(k)})},prepend:function(){return ft(this,arguments,function(k){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var T=zt(this,k);T.insertBefore(k,T.firstChild)}})},before:function(){return ft(this,arguments,function(k){this.parentNode&&this.parentNode.insertBefore(k,this)})},after:function(){return ft(this,arguments,function(k){this.parentNode&&this.parentNode.insertBefore(k,this.nextSibling)})},empty:function(){for(var k,T=0;null!=(k=this[T]);T++)1===k.nodeType&&(y.cleanData(He(k,!1)),k.textContent="");return this},clone:function(k,T){return k=null!=k&&k,T=T??k,this.map(function(){return y.clone(this,k,T)})},html:function(k){return te(this,function(T){var F=this[0]||{},j=0,U=this.length;if(void 0===T&&1===F.nodeType)return F.innerHTML;if("string"==typeof T&&!Dt.test(T)&&!Ne[(me.exec(T)||["",""])[1].toLowerCase()]){T=y.htmlPrefilter(T);try{for(;j<U;j++)1===(F=this[j]||{}).nodeType&&(y.cleanData(He(F,!1)),F.innerHTML=T);F=0}catch{}}F&&this.empty().append(T)},null,k,arguments.length)},replaceWith:function(){var k=[];return ft(this,arguments,function(T){var F=this.parentNode;y.inArray(this,k)<0&&(y.cleanData(He(this)),F&&F.replaceChild(T,this))},k)}}),y.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(k,T){y.fn[k]=function(F){for(var j,U=[],X=y(F),V=X.length-1,re=0;re<=V;re++)j=re===V?this:this.clone(!0),y(X[re])[T](j),l.apply(U,j.get());return this.pushStack(U)}});var Ft=new RegExp("^("+Ee+")(?!px)[a-z%]+$","i"),si=function(k){var T=k.ownerDocument.defaultView;return T&&T.opener||(T=e),T.getComputedStyle(k)},Rt=function(k,T,F){var j,U,X={};for(U in T)X[U]=k.style[U],k.style[U]=T[U];for(U in j=F.call(k),T)k.style[U]=X[U];return j},Zt=new RegExp(Ge.join("|"),"i");function ni(k,T,F){var j,U,X,V,re=k.style;return(F=F||si(k))&&(""!==(V=F.getPropertyValue(T)||F[T])||W(k)||(V=y.style(k,T)),!r.pixelBoxStyles()&&Ft.test(V)&&Zt.test(T)&&(j=re.width,U=re.minWidth,X=re.maxWidth,re.minWidth=re.maxWidth=re.width=V,V=F.width,re.width=j,re.minWidth=U,re.maxWidth=X)),void 0!==V?V+"":V}function We(k,T){return{get:function(){if(!k())return(this.get=T).apply(this,arguments);delete this.get}}}!function(){function k(){if(ge){ue.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",ge.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Ye.appendChild(ue).appendChild(ge);var Ie=e.getComputedStyle(ge);F="1%"!==Ie.top,re=12===T(Ie.marginLeft),ge.style.right="60%",X=36===T(Ie.right),j=36===T(Ie.width),ge.style.position="absolute",U=12===T(ge.offsetWidth/3),Ye.removeChild(ue),ge=null}}function T(Ie){return Math.round(parseFloat(Ie))}var F,j,U,X,V,re,ue=m.createElement("div"),ge=m.createElement("div");ge.style&&(ge.style.backgroundClip="content-box",ge.cloneNode(!0).style.backgroundClip="",r.clearCloneStyle="content-box"===ge.style.backgroundClip,y.extend(r,{boxSizingReliable:function(){return k(),j},pixelBoxStyles:function(){return k(),X},pixelPosition:function(){return k(),F},reliableMarginLeft:function(){return k(),re},scrollboxSize:function(){return k(),U},reliableTrDimensions:function(){var Ie,Fe,Ce,Me;return null==V&&(Ie=m.createElement("table"),Fe=m.createElement("tr"),Ce=m.createElement("div"),Ie.style.cssText="position:absolute;left:-11111px",Fe.style.height="1px",Ce.style.height="9px",Ye.appendChild(Ie).appendChild(Fe).appendChild(Ce),Me=e.getComputedStyle(Fe),V=3<parseInt(Me.height),Ye.removeChild(Ie)),V}}))}();var Ke=["Webkit","Moz","ms"],et=m.createElement("div").style,St={};function Wt(k){return y.cssProps[k]||St[k]||(k in et?k:St[k]=function(F){for(var j=F[0].toUpperCase()+F.slice(1),U=Ke.length;U--;)if((F=Ke[U]+j)in et)return F}(k)||k)}var xs=/^(none|table(?!-c[ea]).+)/,Xi=/^--/,ws={position:"absolute",visibility:"hidden",display:"block"},Yi={letterSpacing:"0",fontWeight:"400"};function Vi(k,T,F){var j=$e.exec(T);return j?Math.max(0,j[2]-(F||0))+(j[3]||"px"):T}function Ei(k,T,F,j,U,X){var V="width"===T?1:0,re=0,ue=0;if(F===(j?"border":"content"))return 0;for(;V<4;V+=2)"margin"===F&&(ue+=y.css(k,F+Ge[V],!0,U)),j?("content"===F&&(ue-=y.css(k,"padding"+Ge[V],!0,U)),"margin"!==F&&(ue-=y.css(k,"border"+Ge[V]+"Width",!0,U))):(ue+=y.css(k,"padding"+Ge[V],!0,U),"padding"!==F?ue+=y.css(k,"border"+Ge[V]+"Width",!0,U):re+=y.css(k,"border"+Ge[V]+"Width",!0,U));return!j&&0<=X&&(ue+=Math.max(0,Math.ceil(k["offset"+T[0].toUpperCase()+T.slice(1)]-X-ue-re-.5))||0),ue}function Zi(k,T,F){var j=si(k),U=(!r.boxSizingReliable()||F)&&"border-box"===y.css(k,"boxSizing",!1,j),X=U,V=ni(k,T,j),re="offset"+T[0].toUpperCase()+T.slice(1);if(Ft.test(V)){if(!F)return V;V="auto"}return(!r.boxSizingReliable()&&U||!r.reliableTrDimensions()&&D(k,"tr")||"auto"===V||!parseFloat(V)&&"inline"===y.css(k,"display",!1,j))&&k.getClientRects().length&&(U="border-box"===y.css(k,"boxSizing",!1,j),(X=re in k)&&(V=k[re])),(V=parseFloat(V)||0)+Ei(k,T,F||(U?"border":"content"),X,j,V)+"px"}function Qt(k,T,F,j,U){return new Qt.prototype.init(k,T,F,j,U)}y.extend({cssHooks:{opacity:{get:function(k,T){if(T){var F=ni(k,"opacity");return""===F?"1":F}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(k,T,F,j){if(k&&3!==k.nodeType&&8!==k.nodeType&&k.style){var U,X,V,re=ce(T),ue=Xi.test(T),ge=k.style;if(ue||(T=Wt(re)),V=y.cssHooks[T]||y.cssHooks[re],void 0===F)return V&&"get"in V&&void 0!==(U=V.get(k,!1,j))?U:ge[T];"string"==(X=typeof F)&&(U=$e.exec(F))&&U[1]&&(F=oe(k,T,U),X="number"),null!=F&&F==F&&("number"!==X||ue||(F+=U&&U[3]||(y.cssNumber[re]?"":"px")),r.clearCloneStyle||""!==F||0!==T.indexOf("background")||(ge[T]="inherit"),V&&"set"in V&&void 0===(F=V.set(k,F,j))||(ue?ge.setProperty(T,F):ge[T]=F))}},css:function(k,T,F,j){var U,X,V,re=ce(T);return Xi.test(T)||(T=Wt(re)),(V=y.cssHooks[T]||y.cssHooks[re])&&"get"in V&&(U=V.get(k,!0,F)),void 0===U&&(U=ni(k,T,j)),"normal"===U&&T in Yi&&(U=Yi[T]),""===F||F?(X=parseFloat(U),!0===F||isFinite(X)?X||0:U):U}}),y.each(["height","width"],function(k,T){y.cssHooks[T]={get:function(F,j,U){if(j)return!xs.test(y.css(F,"display"))||F.getClientRects().length&&F.getBoundingClientRect().width?Zi(F,T,U):Rt(F,ws,function(){return Zi(F,T,U)})},set:function(F,j,U){var X,V=si(F),re=!r.scrollboxSize()&&"absolute"===V.position,ue=(re||U)&&"border-box"===y.css(F,"boxSizing",!1,V),ge=U?Ei(F,T,U,ue,V):0;return ue&&re&&(ge-=Math.ceil(F["offset"+T[0].toUpperCase()+T.slice(1)]-parseFloat(V[T])-Ei(F,T,"border",!1,V)-.5)),ge&&(X=$e.exec(j))&&"px"!==(X[3]||"px")&&(F.style[T]=j,j=y.css(F,T)),Vi(0,j,ge)}}}),y.cssHooks.marginLeft=We(r.reliableMarginLeft,function(k,T){if(T)return(parseFloat(ni(k,"marginLeft"))||k.getBoundingClientRect().left-Rt(k,{marginLeft:0},function(){return k.getBoundingClientRect().left}))+"px"}),y.each({margin:"",padding:"",border:"Width"},function(k,T){y.cssHooks[k+T]={expand:function(F){for(var j=0,U={},X="string"==typeof F?F.split(" "):[F];j<4;j++)U[k+Ge[j]+T]=X[j]||X[j-2]||X[0];return U}},"margin"!==k&&(y.cssHooks[k+T].set=Vi)}),y.fn.extend({css:function(k,T){return te(this,function(F,j,U){var X,V,re={},ue=0;if(Array.isArray(j)){for(X=si(F),V=j.length;ue<V;ue++)re[j[ue]]=y.css(F,j[ue],!1,X);return re}return void 0!==U?y.style(F,j,U):y.css(F,j)},k,T,1<arguments.length)}}),((y.Tween=Qt).prototype={constructor:Qt,init:function(k,T,F,j,U,X){this.elem=k,this.prop=F,this.easing=U||y.easing._default,this.options=T,this.start=this.now=this.cur(),this.end=j,this.unit=X||(y.cssNumber[F]?"":"px")},cur:function(){var k=Qt.propHooks[this.prop];return k&&k.get?k.get(this):Qt.propHooks._default.get(this)},run:function(k){var T,F=Qt.propHooks[this.prop];return this.pos=T=this.options.duration?y.easing[this.easing](k,this.options.duration*k,0,1,this.options.duration):k,this.now=(this.end-this.start)*T+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),F&&F.set?F.set(this):Qt.propHooks._default.set(this),this}}).init.prototype=Qt.prototype,(Qt.propHooks={_default:{get:function(k){var T;return 1!==k.elem.nodeType||null!=k.elem[k.prop]&&null==k.elem.style[k.prop]?k.elem[k.prop]:(T=y.css(k.elem,k.prop,""))&&"auto"!==T?T:0},set:function(k){y.fx.step[k.prop]?y.fx.step[k.prop](k):1!==k.elem.nodeType||!y.cssHooks[k.prop]&&null==k.elem.style[Wt(k.prop)]?k.elem[k.prop]=k.now:y.style(k.elem,k.prop,k.now+k.unit)}}}).scrollTop=Qt.propHooks.scrollLeft={set:function(k){k.elem.nodeType&&k.elem.parentNode&&(k.elem[k.prop]=k.now)}},y.easing={linear:function(k){return k},swing:function(k){return.5-Math.cos(k*Math.PI)/2},_default:"swing"},y.fx=Qt.prototype.init,y.fx.step={};var pi,Si,fi,Qi,As=/^(?:toggle|show|hide)$/,Ss=/queueHooks$/;function Li(){Si&&(!1===m.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(Li):e.setTimeout(Li,y.fx.interval),y.fx.tick())}function Ki(){return e.setTimeout(function(){pi=void 0}),pi=Date.now()}function Ci(k,T){var F,j=0,U={height:k};for(T=T?1:0;j<4;j+=2-T)U["margin"+(F=Ge[j])]=U["padding"+F]=k;return T&&(U.opacity=U.width=k),U}function es(k,T,F){for(var j,U=(Kt.tweeners[T]||[]).concat(Kt.tweeners["*"]),X=0,V=U.length;X<V;X++)if(j=U[X].call(F,T,k))return j}function Kt(k,T,F){var j,U,X=0,V=Kt.prefilters.length,re=y.Deferred().always(function(){delete ue.elem}),ue=function(){if(U)return!1;for(var Fe=pi||Ki(),Ce=Math.max(0,ge.startTime+ge.duration-Fe),Me=1-(Ce/ge.duration||0),Xe=0,Ze=ge.tweens.length;Xe<Ze;Xe++)ge.tweens[Xe].run(Me);return re.notifyWith(k,[ge,Me,Ce]),Me<1&&Ze?Ce:(Ze||re.notifyWith(k,[ge,1,0]),re.resolveWith(k,[ge]),!1)},ge=re.promise({elem:k,props:y.extend({},T),opts:y.extend(!0,{specialEasing:{},easing:y.easing._default},F),originalProperties:T,originalOptions:F,startTime:pi||Ki(),duration:F.duration,tweens:[],createTween:function(Fe,Ce){var Me=y.Tween(k,ge.opts,Fe,Ce,ge.opts.specialEasing[Fe]||ge.opts.easing);return ge.tweens.push(Me),Me},stop:function(Fe){var Ce=0,Me=Fe?ge.tweens.length:0;if(U)return this;for(U=!0;Ce<Me;Ce++)ge.tweens[Ce].run(1);return Fe?(re.notifyWith(k,[ge,1,0]),re.resolveWith(k,[ge,Fe])):re.rejectWith(k,[ge,Fe]),this}}),Ie=ge.props;for(function(Fe,Ce){var Me,Xe,Ze,Ve,vt;for(Me in Fe)if(Ze=Ce[Xe=ce(Me)],Ve=Fe[Me],Array.isArray(Ve)&&(Ze=Ve[1],Ve=Fe[Me]=Ve[0]),Me!==Xe&&(Fe[Xe]=Ve,delete Fe[Me]),(vt=y.cssHooks[Xe])&&"expand"in vt)for(Me in Ve=vt.expand(Ve),delete Fe[Xe],Ve)Me in Fe||(Fe[Me]=Ve[Me],Ce[Me]=Ze);else Ce[Xe]=Ze}(Ie,ge.opts.specialEasing);X<V;X++)if(j=Kt.prefilters[X].call(ge,k,Ie,ge.opts))return u(j.stop)&&(y._queueHooks(ge.elem,ge.opts.queue).stop=j.stop.bind(j)),j;return y.map(Ie,es,ge),u(ge.opts.start)&&ge.opts.start.call(k,ge),ge.progress(ge.opts.progress).done(ge.opts.done,ge.opts.complete).fail(ge.opts.fail).always(ge.opts.always),y.fx.timer(y.extend(ue,{elem:k,anim:ge,queue:ge.opts.queue})),ge}y.Animation=y.extend(Kt,{tweeners:{"*":[function(k,T){var F=this.createTween(k,T);return oe(F.elem,k,$e.exec(T),F),F}]},tweener:function(k,T){u(k)?(T=k,k=["*"]):k=k.match(P);for(var F,j=0,U=k.length;j<U;j++)(Kt.tweeners[F=k[j]]=Kt.tweeners[F]||[]).unshift(T)},prefilters:[function(k,T,F){var j,U,X,V,re,ue,ge,Ie,Fe="width"in T||"height"in T,Ce=this,Me={},Xe=k.style,Ze=k.nodeType&&ne(k),Ve=Se.get(k,"fxshow");for(j in F.queue||(null==(V=y._queueHooks(k,"fx")).unqueued&&(V.unqueued=0,re=V.empty.fire,V.empty.fire=function(){V.unqueued||re()}),V.unqueued++,Ce.always(function(){Ce.always(function(){V.unqueued--,y.queue(k,"fx").length||V.empty.fire()})})),T)if(As.test(U=T[j])){if(delete T[j],X=X||"toggle"===U,U===(Ze?"hide":"show")){if("show"!==U||!Ve||void 0===Ve[j])continue;Ze=!0}Me[j]=Ve&&Ve[j]||y.style(k,j)}if((ue=!y.isEmptyObject(T))||!y.isEmptyObject(Me))for(j in Fe&&1===k.nodeType&&(F.overflow=[Xe.overflow,Xe.overflowX,Xe.overflowY],null==(ge=Ve&&Ve.display)&&(ge=Se.get(k,"display")),"none"===(Ie=y.css(k,"display"))&&(ge?Ie=ge:(ve([k],!0),ge=k.style.display||ge,Ie=y.css(k,"display"),ve([k]))),("inline"===Ie||"inline-block"===Ie&&null!=ge)&&"none"===y.css(k,"float")&&(ue||(Ce.done(function(){Xe.display=ge}),null==ge&&(ge="none"===(Ie=Xe.display)?"":Ie)),Xe.display="inline-block")),F.overflow&&(Xe.overflow="hidden",Ce.always(function(){Xe.overflow=F.overflow[0],Xe.overflowX=F.overflow[1],Xe.overflowY=F.overflow[2]})),ue=!1,Me)ue||(Ve?"hidden"in Ve&&(Ze=Ve.hidden):Ve=Se.access(k,"fxshow",{display:ge}),X&&(Ve.hidden=!Ze),Ze&&ve([k],!0),Ce.done(function(){for(j in Ze||ve([k]),Se.remove(k,"fxshow"),Me)y.style(k,j,Me[j])})),ue=es(Ze?Ve[j]:0,j,Ce),j in Ve||(Ve[j]=ue.start,Ze&&(ue.end=ue.start,ue.start=0))}],prefilter:function(k,T){T?Kt.prefilters.unshift(k):Kt.prefilters.push(k)}}),y.speed=function(k,T,F){var j=k&&"object"==typeof k?y.extend({},k):{complete:F||!F&&T||u(k)&&k,duration:k,easing:F&&T||T&&!u(T)&&T};return y.fx.off?j.duration=0:"number"!=typeof j.duration&&(j.duration=j.duration in y.fx.speeds?y.fx.speeds[j.duration]:y.fx.speeds._default),null!=j.queue&&!0!==j.queue||(j.queue="fx"),j.old=j.complete,j.complete=function(){u(j.old)&&j.old.call(this),j.queue&&y.dequeue(this,j.queue)},j},y.fn.extend({fadeTo:function(k,T,F,j){return this.filter(ne).css("opacity",0).show().end().animate({opacity:T},k,F,j)},animate:function(k,T,F,j){var U=y.isEmptyObject(k),X=y.speed(T,F,j),V=function(){var re=Kt(this,y.extend({},k),X);(U||Se.get(this,"finish"))&&re.stop(!0)};return V.finish=V,U||!1===X.queue?this.each(V):this.queue(X.queue,V)},stop:function(k,T,F){var j=function(U){var X=U.stop;delete U.stop,X(F)};return"string"!=typeof k&&(F=T,T=k,k=void 0),T&&this.queue(k||"fx",[]),this.each(function(){var U=!0,X=null!=k&&k+"queueHooks",V=y.timers,re=Se.get(this);if(X)re[X]&&re[X].stop&&j(re[X]);else for(X in re)re[X]&&re[X].stop&&Ss.test(X)&&j(re[X]);for(X=V.length;X--;)V[X].elem!==this||null!=k&&V[X].queue!==k||(V[X].anim.stop(F),U=!1,V.splice(X,1));!U&&F||y.dequeue(this,k)})},finish:function(k){return!1!==k&&(k=k||"fx"),this.each(function(){var T,F=Se.get(this),j=F[k+"queue"],U=F[k+"queueHooks"],X=y.timers,V=j?j.length:0;for(F.finish=!0,y.queue(this,k,[]),U&&U.stop&&U.stop.call(this,!0),T=X.length;T--;)X[T].elem===this&&X[T].queue===k&&(X[T].anim.stop(!0),X.splice(T,1));for(T=0;T<V;T++)j[T]&&j[T].finish&&j[T].finish.call(this);delete F.finish})}}),y.each(["toggle","show","hide"],function(k,T){var F=y.fn[T];y.fn[T]=function(j,U,X){return null==j||"boolean"==typeof j?F.apply(this,arguments):this.animate(Ci(T,!0),j,U,X)}}),y.each({slideDown:Ci("show"),slideUp:Ci("hide"),slideToggle:Ci("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(k,T){y.fn[k]=function(F,j,U){return this.animate(T,F,j,U)}}),y.timers=[],y.fx.tick=function(){var k,T=0,F=y.timers;for(pi=Date.now();T<F.length;T++)(k=F[T])()||F[T]!==k||F.splice(T--,1);F.length||y.fx.stop(),pi=void 0},y.fx.timer=function(k){y.timers.push(k),y.fx.start()},y.fx.interval=13,y.fx.start=function(){Si||(Si=!0,Li())},y.fx.stop=function(){Si=null},y.fx.speeds={slow:600,fast:200,_default:400},y.fn.delay=function(k,T){return k=y.fx&&y.fx.speeds[k]||k,this.queue(T=T||"fx",function(F,j){var U=e.setTimeout(F,k);j.stop=function(){e.clearTimeout(U)}})},fi=m.createElement("input"),Qi=m.createElement("select").appendChild(m.createElement("option")),fi.type="checkbox",r.checkOn=""!==fi.value,r.optSelected=Qi.selected,(fi=m.createElement("input")).value="t",fi.type="radio",r.radioValue="t"===fi.value;var ts,vi=y.expr.attrHandle;y.fn.extend({attr:function(k,T){return te(this,y.attr,k,T,1<arguments.length)},removeAttr:function(k){return this.each(function(){y.removeAttr(this,k)})}}),y.extend({attr:function(k,T,F){var j,U,X=k.nodeType;if(3!==X&&8!==X&&2!==X)return typeof k.getAttribute>"u"?y.prop(k,T,F):(1===X&&y.isXMLDoc(k)||(U=y.attrHooks[T.toLowerCase()]||(y.expr.match.bool.test(T)?ts:void 0)),void 0!==F?null===F?void y.removeAttr(k,T):U&&"set"in U&&void 0!==(j=U.set(k,F,T))?j:(k.setAttribute(T,F+""),F):U&&"get"in U&&null!==(j=U.get(k,T))?j:null==(j=y.find.attr(k,T))?void 0:j)},attrHooks:{type:{set:function(k,T){if(!r.radioValue&&"radio"===T&&D(k,"input")){var F=k.value;return k.setAttribute("type",T),F&&(k.value=F),T}}}},removeAttr:function(k,T){var F,j=0,U=T&&T.match(P);if(U&&1===k.nodeType)for(;F=U[j++];)k.removeAttribute(F)}}),ts={set:function(k,T,F){return!1===T?y.removeAttr(k,F):k.setAttribute(F,F),F}},y.each(y.expr.match.bool.source.match(/\w+/g),function(k,T){var F=vi[T]||y.find.attr;vi[T]=function(j,U,X){var V,re,ue=U.toLowerCase();return X||(re=vi[ue],vi[ue]=V,V=null!=F(j,U,X)?ue:null,vi[ue]=re),V}});var Cs=/^(?:input|select|textarea|button)$/i,ks=/^(?:a|area)$/i;function ci(k){return(k.match(P)||[]).join(" ")}function hi(k){return k.getAttribute&&k.getAttribute("class")||""}function Fi(k){return Array.isArray(k)?k:"string"==typeof k&&k.match(P)||[]}y.fn.extend({prop:function(k,T){return te(this,y.prop,k,T,1<arguments.length)},removeProp:function(k){return this.each(function(){delete this[y.propFix[k]||k]})}}),y.extend({prop:function(k,T,F){var j,U,X=k.nodeType;if(3!==X&&8!==X&&2!==X)return 1===X&&y.isXMLDoc(k)||(U=y.propHooks[T=y.propFix[T]||T]),void 0!==F?U&&"set"in U&&void 0!==(j=U.set(k,F,T))?j:k[T]=F:U&&"get"in U&&null!==(j=U.get(k,T))?j:k[T]},propHooks:{tabIndex:{get:function(k){var T=y.find.attr(k,"tabindex");return T?parseInt(T,10):Cs.test(k.nodeName)||ks.test(k.nodeName)&&k.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),r.optSelected||(y.propHooks.selected={get:function(k){return null},set:function(k){}}),y.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){y.propFix[this.toLowerCase()]=this}),y.fn.extend({addClass:function(k){var T,F,j,U,X,V,re,ue=0;if(u(k))return this.each(function(ge){y(this).addClass(k.call(this,ge,hi(this)))});if((T=Fi(k)).length)for(;F=this[ue++];)if(U=hi(F),j=1===F.nodeType&&" "+ci(U)+" "){for(V=0;X=T[V++];)j.indexOf(" "+X+" ")<0&&(j+=X+" ");U!==(re=ci(j))&&F.setAttribute("class",re)}return this},removeClass:function(k){var T,F,j,U,X,V,re,ue=0;if(u(k))return this.each(function(ge){y(this).removeClass(k.call(this,ge,hi(this)))});if(!arguments.length)return this.attr("class","");if((T=Fi(k)).length)for(;F=this[ue++];)if(U=hi(F),j=1===F.nodeType&&" "+ci(U)+" "){for(V=0;X=T[V++];)for(;-1<j.indexOf(" "+X+" ");)j=j.replace(" "+X+" "," ");U!==(re=ci(j))&&F.setAttribute("class",re)}return this},toggleClass:function(k,T){var F=typeof k,j="string"===F||Array.isArray(k);return"boolean"==typeof T&&j?T?this.addClass(k):this.removeClass(k):u(k)?this.each(function(U){y(this).toggleClass(k.call(this,U,hi(this),T),T)}):this.each(function(){var U,X,V,re;if(j)for(X=0,V=y(this),re=Fi(k);U=re[X++];)V.hasClass(U)?V.removeClass(U):V.addClass(U);else void 0!==k&&"boolean"!==F||((U=hi(this))&&Se.set(this,"__className__",U),this.setAttribute&&this.setAttribute("class",U||!1===k?"":Se.get(this,"__className__")||""))})},hasClass:function(k){var T,F,j=0;for(T=" "+k+" ";F=this[j++];)if(1===F.nodeType&&-1<(" "+ci(hi(F))+" ").indexOf(T))return!0;return!1}});var _s=/\r/g;y.fn.extend({val:function(k){var T,F,j,U=this[0];return arguments.length?(j=u(k),this.each(function(X){var V;1===this.nodeType&&(null==(V=j?k.call(this,X,y(this).val()):k)?V="":"number"==typeof V?V+="":Array.isArray(V)&&(V=y.map(V,function(re){return null==re?"":re+""})),(T=y.valHooks[this.type]||y.valHooks[this.nodeName.toLowerCase()])&&"set"in T&&void 0!==T.set(this,V,"value")||(this.value=V))})):U?(T=y.valHooks[U.type]||y.valHooks[U.nodeName.toLowerCase()])&&"get"in T&&void 0!==(F=T.get(U,"value"))?F:"string"==typeof(F=U.value)?F.replace(_s,""):F??"":void 0}}),y.extend({valHooks:{option:{get:function(k){return y.find.attr(k,"value")??ci(y.text(k))}},select:{get:function(k){var T,F,j,U=k.options,X=k.selectedIndex,V="select-one"===k.type,re=V?null:[],ue=V?X+1:U.length;for(j=X<0?ue:V?X:0;j<ue;j++)if(((F=U[j]).selected||j===X)&&!F.disabled&&(!F.parentNode.disabled||!D(F.parentNode,"optgroup"))){if(T=y(F).val(),V)return T;re.push(T)}return re},set:function(k,T){for(var F,j,U=k.options,X=y.makeArray(T),V=U.length;V--;)((j=U[V]).selected=-1<y.inArray(y.valHooks.option.get(j),X))&&(F=!0);return F||(k.selectedIndex=-1),X}}}}),y.each(["radio","checkbox"],function(){y.valHooks[this]={set:function(k,T){if(Array.isArray(T))return k.checked=-1<y.inArray(y(k).val(),T)}},r.checkOn||(y.valHooks[this].get=function(k){return null===k.getAttribute("value")?"on":k.value})}),r.focusin="onfocusin"in e;var is=/^(?:focusinfocus|focusoutblur)$/,ss=function(k){k.stopPropagation()};y.extend(y.event,{trigger:function(k,T,F,j){var U,X,V,re,ue,ge,Ie,Fe,Ce=[F||m],Me=p.call(k,"type")?k.type:k,Xe=p.call(k,"namespace")?k.namespace.split("."):[];if(X=Fe=V=F=F||m,3!==F.nodeType&&8!==F.nodeType&&!is.test(Me+y.event.triggered)&&(-1<Me.indexOf(".")&&(Me=(Xe=Me.split(".")).shift(),Xe.sort()),ue=Me.indexOf(":")<0&&"on"+Me,(k=k[y.expando]?k:new y.Event(Me,"object"==typeof k&&k)).isTrigger=j?2:3,k.namespace=Xe.join("."),k.rnamespace=k.namespace?new RegExp("(^|\\.)"+Xe.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,k.result=void 0,k.target||(k.target=F),T=null==T?[k]:y.makeArray(T,[k]),Ie=y.event.special[Me]||{},j||!Ie.trigger||!1!==Ie.trigger.apply(F,T))){if(!j&&!Ie.noBubble&&!f(F)){for(is.test((re=Ie.delegateType||Me)+Me)||(X=X.parentNode);X;X=X.parentNode)Ce.push(X),V=X;V===(F.ownerDocument||m)&&Ce.push(V.defaultView||V.parentWindow||e)}for(U=0;(X=Ce[U++])&&!k.isPropagationStopped();)Fe=X,k.type=1<U?re:Ie.bindType||Me,(ge=(Se.get(X,"events")||Object.create(null))[k.type]&&Se.get(X,"handle"))&&ge.apply(X,T),(ge=ue&&X[ue])&&ge.apply&&he(X)&&(k.result=ge.apply(X,T),!1===k.result&&k.preventDefault());return k.type=Me,j||k.isDefaultPrevented()||Ie._default&&!1!==Ie._default.apply(Ce.pop(),T)||!he(F)||ue&&u(F[Me])&&!f(F)&&((V=F[ue])&&(F[ue]=null),y.event.triggered=Me,k.isPropagationStopped()&&Fe.addEventListener(Me,ss),F[Me](),k.isPropagationStopped()&&Fe.removeEventListener(Me,ss),y.event.triggered=void 0,V&&(F[ue]=V)),k.result}},simulate:function(k,T,F){var j=y.extend(new y.Event,F,{type:k,isSimulated:!0});y.event.trigger(j,null,T)}}),y.fn.extend({trigger:function(k,T){return this.each(function(){y.event.trigger(k,T,this)})},triggerHandler:function(k,T){var F=this[0];if(F)return y.event.trigger(k,T,F,!0)}}),r.focusin||y.each({focus:"focusin",blur:"focusout"},function(k,T){var F=function(j){y.event.simulate(T,j.target,y.event.fix(j))};y.event.special[T]={setup:function(){var j=this.ownerDocument||this.document||this,U=Se.access(j,T);U||j.addEventListener(k,F,!0),Se.access(j,T,(U||0)+1)},teardown:function(){var j=this.ownerDocument||this.document||this,U=Se.access(j,T)-1;U?Se.access(j,T,U):(j.removeEventListener(k,F,!0),Se.remove(j,T))}}});var bi=e.location,ns={guid:Date.now()},Ri=/\?/;y.parseXML=function(k){var T;if(!k||"string"!=typeof k)return null;try{T=(new e.DOMParser).parseFromString(k,"text/xml")}catch{T=void 0}return T&&!T.getElementsByTagName("parsererror").length||y.error("Invalid XML: "+k),T};var Is=/\[\]$/,as=/\r?\n/g,Ts=/^(?:submit|button|image|reset|file)$/i,Ms=/^(?:input|select|textarea|keygen)/i;function $i(k,T,F,j){var U;if(Array.isArray(T))y.each(T,function(X,V){F||Is.test(k)?j(k,V):$i(k+"["+("object"==typeof V&&null!=V?X:"")+"]",V,F,j)});else if(F||"object"!==A(T))j(k,T);else for(U in T)$i(k+"["+U+"]",T[U],F,j)}y.param=function(k,T){var F,j=[],U=function(X,V){var re=u(V)?V():V;j[j.length]=encodeURIComponent(X)+"="+encodeURIComponent(re??"")};if(null==k)return"";if(Array.isArray(k)||k.jquery&&!y.isPlainObject(k))y.each(k,function(){U(this.name,this.value)});else for(F in k)$i(F,k[F],T,U);return j.join("&")},y.fn.extend({serialize:function(){return y.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var k=y.prop(this,"elements");return k?y.makeArray(k):this}).filter(function(){var k=this.type;return this.name&&!y(this).is(":disabled")&&Ms.test(this.nodeName)&&!Ts.test(k)&&(this.checked||!we.test(k))}).map(function(k,T){var F=y(this).val();return null==F?null:Array.isArray(F)?y.map(F,function(j){return{name:T.name,value:j.replace(as,"\r\n")}}):{name:T.name,value:F.replace(as,"\r\n")}}).get()}});var Os=/%20/g,Ps=/#.*$/,Ds=/([?&])_=[^&]*/,Es=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ls=/^(?:GET|HEAD)$/,Fs=/^\/\//,rs={},Ni={},os="*/".concat("*"),ji=m.createElement("a");function ls(k){return function(T,F){"string"!=typeof T&&(F=T,T="*");var j,U=0,X=T.toLowerCase().match(P)||[];if(u(F))for(;j=X[U++];)"+"===j[0]?(j=j.slice(1)||"*",(k[j]=k[j]||[]).unshift(F)):(k[j]=k[j]||[]).push(F)}}function cs(k,T,F,j){var U={},X=k===Ni;function V(re){var ue;return U[re]=!0,y.each(k[re]||[],function(ge,Ie){var Fe=Ie(T,F,j);return"string"!=typeof Fe||X||U[Fe]?X?!(ue=Fe):void 0:(T.dataTypes.unshift(Fe),V(Fe),!1)}),ue}return V(T.dataTypes[0])||!U["*"]&&V("*")}function zi(k,T){var F,j,U=y.ajaxSettings.flatOptions||{};for(F in T)void 0!==T[F]&&((U[F]?k:j||(j={}))[F]=T[F]);return j&&y.extend(!0,k,j),k}ji.href=bi.href,y.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bi.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bi.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":os,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":y.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(k,T){return T?zi(zi(k,y.ajaxSettings),T):zi(y.ajaxSettings,k)},ajaxPrefilter:ls(rs),ajaxTransport:ls(Ni),ajax:function(k,T){"object"==typeof k&&(T=k,k=void 0);var F,j,U,X,V,re,ue,ge,Ie,Fe,Ce=y.ajaxSetup({},T=T||{}),Me=Ce.context||Ce,Xe=Ce.context&&(Me.nodeType||Me.jquery)?y(Me):y.event,Ze=y.Deferred(),Ve=y.Callbacks("once memory"),vt=Ce.statusCode||{},Mt={},Ut={},gt="canceled",at={readyState:0,getResponseHeader:function(ht){var bt;if(ue){if(!X)for(X={};bt=Es.exec(U);)X[bt[1].toLowerCase()+" "]=(X[bt[1].toLowerCase()+" "]||[]).concat(bt[2]);bt=X[ht.toLowerCase()+" "]}return null==bt?null:bt.join(", ")},getAllResponseHeaders:function(){return ue?U:null},setRequestHeader:function(ht,bt){return null==ue&&(ht=Ut[ht.toLowerCase()]=Ut[ht.toLowerCase()]||ht,Mt[ht]=bt),this},overrideMimeType:function(ht){return null==ue&&(Ce.mimeType=ht),this},statusCode:function(ht){var bt;if(ht)if(ue)at.always(ht[at.status]);else for(bt in ht)vt[bt]=[vt[bt],ht[bt]];return this},abort:function(ht){var bt=ht||gt;return F&&F.abort(bt),Ht(0,bt),this}};if(Ze.promise(at),Ce.url=((k||Ce.url||bi.href)+"").replace(Fs,bi.protocol+"//"),Ce.type=T.method||T.type||Ce.method||Ce.type,Ce.dataTypes=(Ce.dataType||"*").toLowerCase().match(P)||[""],null==Ce.crossDomain){re=m.createElement("a");try{re.href=Ce.url,re.href=re.href,Ce.crossDomain=ji.protocol+"//"+ji.host!=re.protocol+"//"+re.host}catch{Ce.crossDomain=!0}}if(Ce.data&&Ce.processData&&"string"!=typeof Ce.data&&(Ce.data=y.param(Ce.data,Ce.traditional)),cs(rs,Ce,T,at),ue)return at;for(Ie in(ge=y.event&&Ce.global)&&0==y.active++&&y.event.trigger("ajaxStart"),Ce.type=Ce.type.toUpperCase(),Ce.hasContent=!Ls.test(Ce.type),j=Ce.url.replace(Ps,""),Ce.hasContent?Ce.data&&Ce.processData&&0===(Ce.contentType||"").indexOf("application/x-www-form-urlencoded")&&(Ce.data=Ce.data.replace(Os,"+")):(Fe=Ce.url.slice(j.length),Ce.data&&(Ce.processData||"string"==typeof Ce.data)&&(j+=(Ri.test(j)?"&":"?")+Ce.data,delete Ce.data),!1===Ce.cache&&(j=j.replace(Ds,"$1"),Fe=(Ri.test(j)?"&":"?")+"_="+ns.guid+++Fe),Ce.url=j+Fe),Ce.ifModified&&(y.lastModified[j]&&at.setRequestHeader("If-Modified-Since",y.lastModified[j]),y.etag[j]&&at.setRequestHeader("If-None-Match",y.etag[j])),(Ce.data&&Ce.hasContent&&!1!==Ce.contentType||T.contentType)&&at.setRequestHeader("Content-Type",Ce.contentType),at.setRequestHeader("Accept",Ce.dataTypes[0]&&Ce.accepts[Ce.dataTypes[0]]?Ce.accepts[Ce.dataTypes[0]]+("*"!==Ce.dataTypes[0]?", "+os+"; q=0.01":""):Ce.accepts["*"]),Ce.headers)at.setRequestHeader(Ie,Ce.headers[Ie]);if(Ce.beforeSend&&(!1===Ce.beforeSend.call(Me,at,Ce)||ue))return at.abort();if(gt="abort",Ve.add(Ce.complete),at.done(Ce.success),at.fail(Ce.error),F=cs(Ni,Ce,T,at)){if(at.readyState=1,ge&&Xe.trigger("ajaxSend",[at,Ce]),ue)return at;Ce.async&&0<Ce.timeout&&(V=e.setTimeout(function(){at.abort("timeout")},Ce.timeout));try{ue=!1,F.send(Mt,Ht)}catch(ht){if(ue)throw ht;Ht(-1,ht)}}else Ht(-1,"No Transport");function Ht(ht,bt,wi,ki){var Jt,ui,gi,Bt,mi,Vt=bt;ue||(ue=!0,V&&e.clearTimeout(V),F=void 0,U=ki||"",at.readyState=0<ht?4:0,Jt=200<=ht&&ht<300||304===ht,wi&&(Bt=function(xt,Gt,qt){for(var ai,rt,dt,Ot,Xt=xt.contents,_t=xt.dataTypes;"*"===_t[0];)_t.shift(),void 0===ai&&(ai=xt.mimeType||Gt.getResponseHeader("Content-Type"));if(ai)for(rt in Xt)if(Xt[rt]&&Xt[rt].test(ai)){_t.unshift(rt);break}if(_t[0]in qt)dt=_t[0];else{for(rt in qt){if(!_t[0]||xt.converters[rt+" "+_t[0]]){dt=rt;break}Ot||(Ot=rt)}dt=dt||Ot}if(dt)return dt!==_t[0]&&_t.unshift(dt),qt[dt]}(Ce,at,wi)),!Jt&&-1<y.inArray("script",Ce.dataTypes)&&(Ce.converters["text script"]=function(){}),Bt=function(xt,Gt,qt,ai){var rt,dt,Ot,Xt,_t,Yt={},yi=xt.dataTypes.slice();if(yi[1])for(Ot in xt.converters)Yt[Ot.toLowerCase()]=xt.converters[Ot];for(dt=yi.shift();dt;)if(xt.responseFields[dt]&&(qt[xt.responseFields[dt]]=Gt),!_t&&ai&&xt.dataFilter&&(Gt=xt.dataFilter(Gt,xt.dataType)),_t=dt,dt=yi.shift())if("*"===dt)dt=_t;else if("*"!==_t&&_t!==dt){if(!(Ot=Yt[_t+" "+dt]||Yt["* "+dt]))for(rt in Yt)if((Xt=rt.split(" "))[1]===dt&&(Ot=Yt[_t+" "+Xt[0]]||Yt["* "+Xt[0]])){!0===Ot?Ot=Yt[rt]:!0!==Yt[rt]&&(dt=Xt[0],yi.unshift(Xt[1]));break}if(!0!==Ot)if(Ot&&xt.throws)Gt=Ot(Gt);else try{Gt=Ot(Gt)}catch(_i){return{state:"parsererror",error:Ot?_i:"No conversion from "+_t+" to "+dt}}}return{state:"success",data:Gt}}(Ce,Bt,at,Jt),Jt?(Ce.ifModified&&((mi=at.getResponseHeader("Last-Modified"))&&(y.lastModified[j]=mi),(mi=at.getResponseHeader("etag"))&&(y.etag[j]=mi)),204===ht||"HEAD"===Ce.type?Vt="nocontent":304===ht?Vt="notmodified":(Vt=Bt.state,ui=Bt.data,Jt=!(gi=Bt.error))):(gi=Vt,!ht&&Vt||(Vt="error",ht<0&&(ht=0))),at.status=ht,at.statusText=(bt||Vt)+"",Jt?Ze.resolveWith(Me,[ui,Vt,at]):Ze.rejectWith(Me,[at,Vt,gi]),at.statusCode(vt),vt=void 0,ge&&Xe.trigger(Jt?"ajaxSuccess":"ajaxError",[at,Ce,Jt?ui:gi]),Ve.fireWith(Me,[at,Vt]),ge&&(Xe.trigger("ajaxComplete",[at,Ce]),--y.active||y.event.trigger("ajaxStop")))}return at},getJSON:function(k,T,F){return y.get(k,T,F,"json")},getScript:function(k,T){return y.get(k,void 0,T,"script")}}),y.each(["get","post"],function(k,T){y[T]=function(F,j,U,X){return u(j)&&(X=X||U,U=j,j=void 0),y.ajax(y.extend({url:F,type:T,dataType:X,data:j,success:U},y.isPlainObject(F)&&F))}}),y.ajaxPrefilter(function(k){var T;for(T in k.headers)"content-type"===T.toLowerCase()&&(k.contentType=k.headers[T]||"")}),y._evalUrl=function(k,T,F){return y.ajax({url:k,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(j){y.globalEval(j,T,F)}})},y.fn.extend({wrapAll:function(k){var T;return this[0]&&(u(k)&&(k=k.call(this[0])),T=y(k,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&T.insertBefore(this[0]),T.map(function(){for(var F=this;F.firstElementChild;)F=F.firstElementChild;return F}).append(this)),this},wrapInner:function(k){return u(k)?this.each(function(T){y(this).wrapInner(k.call(this,T))}):this.each(function(){var T=y(this),F=T.contents();F.length?F.wrapAll(k):T.append(k)})},wrap:function(k){var T=u(k);return this.each(function(F){y(this).wrapAll(T?k.call(this,F):k)})},unwrap:function(k){return this.parent(k).not("body").each(function(){y(this).replaceWith(this.childNodes)}),this}}),y.expr.pseudos.hidden=function(k){return!y.expr.pseudos.visible(k)},y.expr.pseudos.visible=function(k){return!!(k.offsetWidth||k.offsetHeight||k.getClientRects().length)},y.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var Rs={0:200,1223:204},xi=y.ajaxSettings.xhr();r.cors=!!xi&&"withCredentials"in xi,r.ajax=xi=!!xi,y.ajaxTransport(function(k){var T,F;if(r.cors||xi&&!k.crossDomain)return{send:function(j,U){var X,V=k.xhr();if(V.open(k.type,k.url,k.async,k.username,k.password),k.xhrFields)for(X in k.xhrFields)V[X]=k.xhrFields[X];for(X in k.mimeType&&V.overrideMimeType&&V.overrideMimeType(k.mimeType),k.crossDomain||j["X-Requested-With"]||(j["X-Requested-With"]="XMLHttpRequest"),j)V.setRequestHeader(X,j[X]);T=function(re){return function(){T&&(T=F=V.onload=V.onerror=V.onabort=V.ontimeout=V.onreadystatechange=null,"abort"===re?V.abort():"error"===re?"number"!=typeof V.status?U(0,"error"):U(V.status,V.statusText):U(Rs[V.status]||V.status,V.statusText,"text"!==(V.responseType||"text")||"string"!=typeof V.responseText?{binary:V.response}:{text:V.responseText},V.getAllResponseHeaders()))}},V.onload=T(),F=V.onerror=V.ontimeout=T("error"),void 0!==V.onabort?V.onabort=F:V.onreadystatechange=function(){4===V.readyState&&e.setTimeout(function(){T&&F()})},T=T("abort");try{V.send(k.hasContent&&k.data||null)}catch(re){if(T)throw re}},abort:function(){T&&T()}}}),y.ajaxPrefilter(function(k){k.crossDomain&&(k.contents.script=!1)}),y.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(k){return y.globalEval(k),k}}}),y.ajaxPrefilter("script",function(k){void 0===k.cache&&(k.cache=!1),k.crossDomain&&(k.type="GET")}),y.ajaxTransport("script",function(k){var T,F;if(k.crossDomain||k.scriptAttrs)return{send:function(j,U){T=y("<script>").attr(k.scriptAttrs||{}).prop({charset:k.scriptCharset,src:k.url}).on("load error",F=function(X){T.remove(),F=null,X&&U("error"===X.type?404:200,X.type)}),m.head.appendChild(T[0])},abort:function(){F&&F()}}});var hs,us=[],Hi=/(=)\?(?=&|$)|\?\?/;y.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var k=us.pop()||y.expando+"_"+ns.guid++;return this[k]=!0,k}}),y.ajaxPrefilter("json jsonp",function(k,T,F){var j,U,X,V=!1!==k.jsonp&&(Hi.test(k.url)?"url":"string"==typeof k.data&&0===(k.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hi.test(k.data)&&"data");if(V||"jsonp"===k.dataTypes[0])return j=k.jsonpCallback=u(k.jsonpCallback)?k.jsonpCallback():k.jsonpCallback,V?k[V]=k[V].replace(Hi,"$1"+j):!1!==k.jsonp&&(k.url+=(Ri.test(k.url)?"&":"?")+k.jsonp+"="+j),k.converters["script json"]=function(){return X||y.error(j+" was not called"),X[0]},k.dataTypes[0]="json",U=e[j],e[j]=function(){X=arguments},F.always(function(){void 0===U?y(e).removeProp(j):e[j]=U,k[j]&&(k.jsonpCallback=T.jsonpCallback,us.push(j)),X&&u(U)&&U(X[0]),X=U=void 0}),"script"}),r.createHTMLDocument=((hs=m.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===hs.childNodes.length),y.parseHTML=function(k,T,F){return"string"!=typeof k?[]:("boolean"==typeof T&&(F=T,T=!1),T||(r.createHTMLDocument?((j=(T=m.implementation.createHTMLDocument("")).createElement("base")).href=m.location.href,T.head.appendChild(j)):T=m),X=!F&&[],(U=O.exec(k))?[T.createElement(U[1])]:(U=Te([k],T,X),X&&X.length&&y(X).remove(),y.merge([],U.childNodes)));var j,U,X},y.fn.load=function(k,T,F){var j,U,X,V=this,re=k.indexOf(" ");return-1<re&&(j=ci(k.slice(re)),k=k.slice(0,re)),u(T)?(F=T,T=void 0):T&&"object"==typeof T&&(U="POST"),0<V.length&&y.ajax({url:k,type:U||"GET",dataType:"html",data:T}).done(function(ue){X=arguments,V.html(j?y("<div>").append(y.parseHTML(ue)).find(j):ue)}).always(F&&function(ue,ge){V.each(function(){F.apply(this,X||[ue.responseText,ge,ue])})}),this},y.expr.pseudos.animated=function(k){return y.grep(y.timers,function(T){return k===T.elem}).length},y.offset={setOffset:function(k,T,F){var j,U,X,V,re,ue,ge=y.css(k,"position"),Ie=y(k),Fe={};"static"===ge&&(k.style.position="relative"),re=Ie.offset(),X=y.css(k,"top"),ue=y.css(k,"left"),("absolute"===ge||"fixed"===ge)&&-1<(X+ue).indexOf("auto")?(V=(j=Ie.position()).top,U=j.left):(V=parseFloat(X)||0,U=parseFloat(ue)||0),u(T)&&(T=T.call(k,F,y.extend({},re))),null!=T.top&&(Fe.top=T.top-re.top+V),null!=T.left&&(Fe.left=T.left-re.left+U),"using"in T?T.using.call(k,Fe):("number"==typeof Fe.top&&(Fe.top+="px"),"number"==typeof Fe.left&&(Fe.left+="px"),Ie.css(Fe))}},y.fn.extend({offset:function(k){if(arguments.length)return void 0===k?this:this.each(function(U){y.offset.setOffset(this,k,U)});var T,F,j=this[0];return j?j.getClientRects().length?{top:(T=j.getBoundingClientRect()).top+(F=j.ownerDocument.defaultView).pageYOffset,left:T.left+F.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var k,T,F,j=this[0],U={top:0,left:0};if("fixed"===y.css(j,"position"))T=j.getBoundingClientRect();else{for(T=this.offset(),F=j.ownerDocument,k=j.offsetParent||F.documentElement;k&&(k===F.body||k===F.documentElement)&&"static"===y.css(k,"position");)k=k.parentNode;k&&k!==j&&1===k.nodeType&&((U=y(k).offset()).top+=y.css(k,"borderTopWidth",!0),U.left+=y.css(k,"borderLeftWidth",!0))}return{top:T.top-U.top-y.css(j,"marginTop",!0),left:T.left-U.left-y.css(j,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var k=this.offsetParent;k&&"static"===y.css(k,"position");)k=k.offsetParent;return k||Ye})}}),y.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(k,T){var F="pageYOffset"===T;y.fn[k]=function(j){return te(this,function(U,X,V){var re;if(f(U)?re=U:9===U.nodeType&&(re=U.defaultView),void 0===V)return re?re[T]:U[X];re?re.scrollTo(F?re.pageXOffset:V,F?V:re.pageYOffset):U[X]=V},k,j,arguments.length)}}),y.each(["top","left"],function(k,T){y.cssHooks[T]=We(r.pixelPosition,function(F,j){if(j)return j=ni(F,T),Ft.test(j)?y(F).position()[T]+"px":j})}),y.each({Height:"height",Width:"width"},function(k,T){y.each({padding:"inner"+k,content:T,"":"outer"+k},function(F,j){y.fn[j]=function(U,X){var V=arguments.length&&(F||"boolean"!=typeof U),re=F||(!0===U||!0===X?"margin":"border");return te(this,function(ue,ge,Ie){var Fe;return f(ue)?0===j.indexOf("outer")?ue["inner"+k]:ue.document.documentElement["client"+k]:9===ue.nodeType?(Fe=ue.documentElement,Math.max(ue.body["scroll"+k],Fe["scroll"+k],ue.body["offset"+k],Fe["offset"+k],Fe["client"+k])):void 0===Ie?y.css(ue,ge,re):y.style(ue,ge,Ie,re)},T,V?U:void 0,V)}})}),y.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(k,T){y.fn[T]=function(F){return this.on(T,F)}}),y.fn.extend({bind:function(k,T,F){return this.on(k,null,T,F)},unbind:function(k,T){return this.off(k,null,T)},delegate:function(k,T,F,j){return this.on(T,k,F,j)},undelegate:function(k,T,F){return 1===arguments.length?this.off(k,"**"):this.off(T,k||"**",F)},hover:function(k,T){return this.mouseenter(k).mouseleave(T||k)}}),y.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(k,T){y.fn[T]=function(F,j){return 0<arguments.length?this.on(T,null,F,j):this.trigger(T)}});var $s=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;y.proxy=function(k,T){var F,j,U;if("string"==typeof T&&(F=k[T],T=k,k=F),u(k))return j=n.call(arguments,2),(U=function(){return k.apply(T||this,j.concat(n.call(arguments)))}).guid=k.guid=k.guid||y.guid++,U},y.holdReady=function(k){k?y.readyWait++:y.ready(!0)},y.isArray=Array.isArray,y.parseJSON=JSON.parse,y.nodeName=D,y.isFunction=u,y.isWindow=f,y.camelCase=ce,y.type=A,y.now=Date.now,y.isNumeric=function(k){var T=y.type(k);return("number"===T||"string"===T)&&!isNaN(k-parseFloat(k))},y.trim=function(k){return null==k?"":(k+"").replace($s,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return y});var Ns=e.jQuery,js=e.$;return y.noConflict=function(k){return e.$===y&&(e.$=js),k&&e.jQuery===y&&(e.jQuery=Ns),y},typeof t>"u"&&(e.jQuery=e.$=y),y}),($jscomp=$jscomp||{}).scope={},$jscomp.findInternal=function(e,t,s){e instanceof String&&(e=String(e));for(var o=e.length,n=0;n<o;n++){var a=e[n];if(t.call(s,a,n,e))return{i:n,v:a}}return{i:-1,v:void 0}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){e!=Array.prototype&&e!=Object.prototype&&(e[t]=s.value)},$jscomp.getGlobal=function(e){return typeof window<"u"&&window===e?e:typeof global<"u"&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,s,o){if(t){for(s=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var n=e[o];n in s||(s[n]={}),s=s[n]}(t=t(o=s[e=e[e.length-1]]))!=o&&null!=t&&$jscomp.defineProperty(s,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(t,s){return $jscomp.findInternal(this,t,s).v}},"es6","es3"),$jscomp.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}},$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.SymbolClass=function(e,t){this.$jscomp$symbol$id_=e,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:t})},$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_},$jscomp.Symbol=function(){var t=0;return function e(s){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(s||"")+"_"+t++,s)}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}}),$jscomp.initSymbolIterator=function(){}},$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator")),$jscomp.initSymbolAsyncIterator=function(){}},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.iteratorFromArray=function(e,t){$jscomp.initSymbolIterator(),e instanceof String&&(e+="");var s=0,o={next:function(){if(s<e.length){var n=s++;return{value:t(n,e[n]),done:!1}}return o.next=function(){return{done:!0,value:void 0}},o.next()}};return o[Symbol.iterator]=function(){return o},o},$jscomp.polyfill("Array.prototype.values",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(t,s){return s})}},"es8","es3"),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._inDialog=this._datepickerShowing=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:"January February March April May June July August September October November December".split(" "),monthNamesShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),dayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),dayNamesMin:"Su Mo Tu We Th Fr Sa".split(" "),weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=o(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function o(r){return r.on("mouseout","button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).on("mouseover","button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a",n)}function n(){e.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function a(r,u){for(var f in e.extend(r,u),u)null==u[f]&&(r[f]=u[f]);return r}function l(r){return function(){var u=this.element.val();r.apply(this,arguments),this._refresh(),u!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.ui.version="1.12.1";var r,c=0,d=Array.prototype.slice;e.cleanData=(r=e.cleanData,function(u){var f,m,b;for(b=0;null!=(m=u[b]);b++)try{(f=e._data(m,"events"))&&f.remove&&e(m).triggerHandler("remove")}catch{}r(u)}),e.widget=function(r,u,f){var m={},b=r.split(".")[0],w=b+"-"+(r=r.split(".")[1]);f||(f=u,u=e.Widget),e.isArray(f)&&(f=e.extend.apply(null,[{}].concat(f))),e.expr[":"][w.toLowerCase()]=function(S){return!!e.data(S,w)},e[b]=e[b]||{};var A=e[b][r],x=e[b][r]=function(S,_){if(!this._createWidget)return new x(S,_);arguments.length&&this._createWidget(S,_)};e.extend(x,A,{version:f.version,_proto:e.extend({},f),_childConstructors:[]});var y=new u;return y.options=e.widget.extend({},y.options),e.each(f,function(S,_){m[S]=e.isFunction(_)?function(){function C(){return u.prototype[S].apply(this,arguments)}function I(L){return u.prototype[S].apply(this,L)}return function(){var L=this._super,D=this._superApply;this._super=C,this._superApply=I;var O=_.apply(this,arguments);return this._super=L,this._superApply=D,O}}():_}),x.prototype=e.widget.extend(y,{widgetEventPrefix:A&&y.widgetEventPrefix||r},m,{constructor:x,namespace:b,widgetName:r,widgetFullName:w}),A?(e.each(A._childConstructors,function(S,_){e.widget((S=_.prototype).namespace+"."+S.widgetName,x,_._proto)}),delete A._childConstructors):u._childConstructors.push(x),e.widget.bridge(r,x),x},e.widget.extend=function(r){for(var b,w,u=d.call(arguments,1),f=0,m=u.length;f<m;f++)for(b in u[f])w=u[f][b],u[f].hasOwnProperty(b)&&void 0!==w&&(r[b]=e.isPlainObject(w)?e.isPlainObject(r[b])?e.widget.extend({},r[b],w):e.widget.extend({},w):w);return r},e.widget.bridge=function(r,u){var f=u.prototype.widgetFullName||r;e.fn[r]=function(m){var b="string"==typeof m,w=d.call(arguments,1),A=this;return b?this.length||"instance"!==m?this.each(function(){var x=e.data(this,f);if("instance"===m)return A=x,!1;if(!x)return e.error("cannot call methods on "+r+" prior to initialization; attempted to call method '"+m+"'");if(!e.isFunction(x[m])||"_"===m.charAt(0))return e.error("no such method '"+m+"' for "+r+" widget instance");var y=x[m].apply(x,w);return y!==x&&void 0!==y?(A=y&&y.jquery?A.pushStack(y.get()):y,!1):void 0}):A=void 0:(w.length&&(m=e.widget.extend.apply(null,[m].concat(w))),this.each(function(){var x=e.data(this,f);x?(x.option(m||{}),x._init&&x._init()):e.data(this,f,new u(m,this))})),A}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(r,u){u=e(u||this.defaultElement||this)[0],this.element=e(u),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},u!==this&&(e.data(u,this.widgetFullName,this),this._on(!0,this.element,{remove:function(f){f.target===u&&this.destroy()}}),this.document=e(u.style?u.ownerDocument:u.document||u),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),r),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var r=this;this._destroy(),e.each(this.classesElementLookup,function(u,f){r._removeClass(f,u)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(r,u){var m,f=r;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof r){f={};var b=r.split(".");if(r=b.shift(),b.length){var w=f[r]=e.widget.extend({},this.options[r]);for(m=0;m<b.length-1;m++)w[b[m]]=w[b[m]]||{},w=w[b[m]];if(r=b.pop(),1===arguments.length)return void 0===w[r]?null:w[r];w[r]=u}else{if(1===arguments.length)return void 0===this.options[r]?null:this.options[r];f[r]=u}}return this._setOptions(f),this},_setOptions:function(r){for(var u in r)this._setOption(u,r[u]);return this},_setOption:function(r,u){return"classes"===r&&this._setOptionClasses(u),this.options[r]=u,"disabled"===r&&this._setOptionDisabled(u),this},_setOptionClasses:function(r){var u;for(u in r){var f=this.classesElementLookup[u];if(r[u]!==this.options.classes[u]&&f&&f.length){var m=e(f.get());this._removeClass(f,u),m.addClass(this._classes({element:m,keys:u,classes:r,add:!0}))}}},_setOptionDisabled:function(r){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!r),r&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(r){function u(b,w){var A;for(A=0;A<b.length;A++){var x=m.classesElementLookup[b[A]]||e();x=e(r.add?e.unique(x.get().concat(r.element.get())):x.not(r.element).get()),m.classesElementLookup[b[A]]=x,f.push(b[A]),w&&r.classes[b[A]]&&f.push(r.classes[b[A]])}}var f=[],m=this;return r=e.extend({element:this.element,classes:this.options.classes||{}},r),this._on(r.element,{remove:"_untrackClassesElement"}),r.keys&&u(r.keys.match(/\S+/g)||[],!0),r.extra&&u(r.extra.match(/\S+/g)||[]),f.join(" ")},_untrackClassesElement:function(r){var u=this;e.each(u.classesElementLookup,function(f,m){-1!==e.inArray(r.target,m)&&(u.classesElementLookup[f]=e(m.not(r.target).get()))})},_removeClass:function(r,u,f){return this._toggleClass(r,u,f,!1)},_addClass:function(r,u,f){return this._toggleClass(r,u,f,!0)},_toggleClass:function(r,u,f,m){var b="string"==typeof r||null===r;return(r={extra:b?u:f,keys:b?r:u,element:b?this.element:r,add:m="boolean"==typeof m?m:f}).element.toggleClass(this._classes(r),m),this},_on:function(r,u,f){var m,b=this;"boolean"!=typeof r&&(f=u,u=r,r=!1),f?(u=m=e(u),this.bindings=this.bindings.add(u)):(f=u,u=this.element,m=this.widget()),e.each(f,function(w,A){function x(){if(r||!0!==b.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof A?b[A]:A).apply(b,arguments)}"string"!=typeof A&&(x.guid=A.guid=A.guid||x.guid||e.guid++);var y=w.match(/^([\w:-]*)\s*(.*)$/);w=y[1]+b.eventNamespace,(y=y[2])?m.on(w,y,x):u.on(w,x)})},_off:function(r,u){u=(u||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,r.off(u).off(u),this.bindings=e(this.bindings.not(r).get()),this.focusable=e(this.focusable.not(r).get()),this.hoverable=e(this.hoverable.not(r).get())},_delay:function(r,u){var f=this;return setTimeout(function(){return("string"==typeof r?f[r]:r).apply(f,arguments)},u||0)},_hoverable:function(r){this.hoverable=this.hoverable.add(r),this._on(r,{mouseenter:function(u){this._addClass(e(u.currentTarget),null,"ui-state-hover")},mouseleave:function(u){this._removeClass(e(u.currentTarget),null,"ui-state-hover")}})},_focusable:function(r){this.focusable=this.focusable.add(r),this._on(r,{focusin:function(u){this._addClass(e(u.currentTarget),null,"ui-state-focus")},focusout:function(u){this._removeClass(e(u.currentTarget),null,"ui-state-focus")}})},_trigger:function(r,u,f){var m,b=this.options[r];if(f=f||{},(u=e.Event(u)).type=(r===this.widgetEventPrefix?r:this.widgetEventPrefix+r).toLowerCase(),u.target=this.element[0],r=u.originalEvent)for(m in r)m in u||(u[m]=r[m]);return this.element.trigger(u,f),!(e.isFunction(b)&&!1===b.apply(this.element[0],[u].concat(f))||u.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(r,u){e.Widget.prototype["_"+r]=function(f,m,b){"string"==typeof m&&(m={effect:m});var w=m?!0===m||"number"==typeof m?u:m.effect||u:r;"number"==typeof(m=m||{})&&(m={duration:m});var A=!e.isEmptyObject(m);m.complete=b,m.delay&&f.delay(m.delay),A&&e.effects&&e.effects.effect[w]?f[r](m):w!==r&&f[w]?f[w](m.duration,m.easing,b):f.queue(function(x){e(this)[r](),b&&b.call(f[0]),x()})}}),function(){function r(C,I,L){return[parseFloat(C[0])*(S.test(C[0])?I/100:1),parseFloat(C[1])*(S.test(C[1])?L/100:1)]}function u(C){var I=C[0];return 9===I.nodeType?{width:C.width(),height:C.height(),offset:{top:0,left:0}}:e.isWindow(I)?{width:C.width(),height:C.height(),offset:{top:C.scrollTop(),left:C.scrollLeft()}}:I.preventDefault?{width:0,height:0,offset:{top:I.pageY,left:I.pageX}}:{width:C.outerWidth(),height:C.outerHeight(),offset:C.offset()}}var f,m=Math.max,b=Math.abs,w=/left|center|right/,A=/top|center|bottom/,x=/[\+\-]\d+(\.[\d]+)?%?/,y=/^\w+/,S=/%$/,_=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==f)return f;var C=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),I=C.children()[0];e("body").append(C);var L=I.offsetWidth;return C.css("overflow","scroll"),L===(I=I.offsetWidth)&&(I=C[0].clientWidth),C.remove(),f=L-I},getScrollInfo:function(C){var I=C.isWindow||C.isDocument?"":C.element.css("overflow-x"),L=C.isWindow||C.isDocument?"":C.element.css("overflow-y");return I="scroll"===I||"auto"===I&&C.width<C.element[0].scrollWidth,{width:"scroll"===L||"auto"===L&&C.height<C.element[0].scrollHeight?e.position.scrollbarWidth():0,height:I?e.position.scrollbarWidth():0}},getWithinInfo:function(C){var I=e(C||window),L=e.isWindow(I[0]),D=!!I[0]&&9===I[0].nodeType;return{element:I,isWindow:L,isDocument:D,offset:L||D?{left:0,top:0}:e(C).offset(),scrollLeft:I.scrollLeft(),scrollTop:I.scrollTop(),width:I.outerWidth(),height:I.outerHeight()}}},e.fn.position=function(C){if(!C||!C.of)return _.apply(this,arguments);C=e.extend({},C);var I=e(C.of),L=e.position.getWithinInfo(C.within),D=e.position.getScrollInfo(L),O=(C.collision||"flip").split(" "),M={},E=u(I);I[0].preventDefault&&(C.at="left top");var R=E.width,H=E.height,N=E.offset,B=e.extend({},N);e.each(["my","at"],function(){var z=(C[this]||"").split(" ");1===z.length&&(z=w.test(z[0])?z.concat(["center"]):A.test(z[0])?["center"].concat(z):["center","center"]),z[0]=w.test(z[0])?z[0]:"center",z[1]=A.test(z[1])?z[1]:"center";var J=x.exec(z[0]),q=x.exec(z[1]);M[this]=[J?J[0]:0,q?q[0]:0],C[this]=[y.exec(z[0])[0],y.exec(z[1])[0]]}),1===O.length&&(O[1]=O[0]),"right"===C.at[0]?B.left+=R:"center"===C.at[0]&&(B.left+=R/2),"bottom"===C.at[1]?B.top+=H:"center"===C.at[1]&&(B.top+=H/2);var P=r(M.at,R,H);return B.left+=P[0],B.top+=P[1],this.each(function(){var z,J=e(this),q=J.outerWidth(),G=J.outerHeight(),ee=parseInt(e.css(this,"marginLeft"),10)||0,le=parseInt(e.css(this,"marginTop"),10)||0,te=q+ee+(parseInt(e.css(this,"marginRight"),10)||0)+D.width,Q=G+le+(parseInt(e.css(this,"marginBottom"),10)||0)+D.height,de=e.extend({},B),xe=r(M.my,J.outerWidth(),J.outerHeight());"right"===C.my[0]?de.left-=q:"center"===C.my[0]&&(de.left-=q/2),"bottom"===C.my[1]?de.top-=G:"center"===C.my[1]&&(de.top-=G/2),de.left+=xe[0],de.top+=xe[1];var ce={marginLeft:ee,marginTop:le};e.each(["left","top"],function(he,Pe){e.ui.position[O[he]]&&e.ui.position[O[he]][Pe](de,{targetWidth:R,targetHeight:H,elemWidth:q,elemHeight:G,collisionPosition:ce,collisionWidth:te,collisionHeight:Q,offset:[P[0]+xe[0],P[1]+xe[1]],my:C.my,at:C.at,within:L,elem:J})}),C.using&&(z=function(he){var Pe=N.left-de.left,Se=Pe+R-q,Y=N.top-de.top,ie=Y+H-G,be={target:{element:I,left:N.left,top:N.top,width:R,height:H},element:{element:J,left:de.left,top:de.top,width:q,height:G},horizontal:0>Se?"left":0<Pe?"right":"center",vertical:0>ie?"top":0<Y?"bottom":"middle"};R<q&&b(Pe+Se)<R&&(be.horizontal="center"),H<G&&b(Y+ie)<H&&(be.vertical="middle"),be.important=m(b(Pe),b(Se))>m(b(Y),b(ie))?"horizontal":"vertical",C.using.call(this,he,be)}),J.offset(e.extend(de,{using:z}))})},e.ui.position={fit:{left:function(C,I){var L=I.within,D=L.isWindow?L.scrollLeft:L.offset.left,O=L.width,M=C.left-I.collisionPosition.marginLeft;L=D-M;var E=M+I.collisionWidth-O-D;I.collisionWidth>O?0<L&&0>=E?C.left+=L-(I=C.left+L+I.collisionWidth-O-D):C.left=0<E&&0>=L?D:L>E?D+O-I.collisionWidth:D:C.left=0<L?C.left+L:0<E?C.left-E:m(C.left-M,C.left)},top:function(C,I){var L=I.within,D=L.isWindow?L.scrollTop:L.offset.top,O=I.within.height,M=C.top-I.collisionPosition.marginTop;L=D-M;var E=M+I.collisionHeight-O-D;I.collisionHeight>O?0<L&&0>=E?C.top+=L-(I=C.top+L+I.collisionHeight-O-D):C.top=0<E&&0>=L?D:L>E?D+O-I.collisionHeight:D:C.top=0<L?C.top+L:0<E?C.top-E:m(C.top-M,C.top)}},flip:{left:function(C,I){var L=I.within,D=L.offset.left+L.scrollLeft,O=L.width,M=L.isWindow?L.scrollLeft:L.offset.left,E=C.left-I.collisionPosition.marginLeft;L=E-M;var R=E+I.collisionWidth-O-M;E="left"===I.my[0]?-I.elemWidth:"right"===I.my[0]?I.elemWidth:0;var H="left"===I.at[0]?I.targetWidth:"right"===I.at[0]?-I.targetWidth:0,N=-2*I.offset[0];0>L?(0>(I=C.left+E+H+N+I.collisionWidth-O-D)||I<b(L))&&(C.left+=E+H+N):0<R&&(0<(I=C.left-I.collisionPosition.marginLeft+E+H+N-M)||b(I)<R)&&(C.left+=E+H+N)},top:function(C,I){var L=I.within,D=L.offset.top+L.scrollTop,O=L.height,M=L.isWindow?L.scrollTop:L.offset.top,E=C.top-I.collisionPosition.marginTop;L=E-M;var R=E+I.collisionHeight-O-M;E="top"===I.my[1]?-I.elemHeight:"bottom"===I.my[1]?I.elemHeight:0;var H="top"===I.at[1]?I.targetHeight:"bottom"===I.at[1]?-I.targetHeight:0,N=-2*I.offset[1];0>L?(0>(I=C.top+E+H+N+I.collisionHeight-O-D)||I<b(L))&&(C.top+=E+H+N):0<R&&(0<(I=C.top-I.collisionPosition.marginTop+E+H+N-M)||b(I)<R)&&(C.top+=E+H+N)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(r){return function(u){return!!e.data(u,r)}}):function(r,u,f){return!!e.data(r,f[3])}}),e.fn.extend({disableSelection:function(){var r="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(r+".ui-disableSelection",function(u){u.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}}),e.ui.focusable=function(r,u){var f=r.nodeName.toLowerCase();if("area"===f)return f=(u=r.parentNode).name,!(!r.href||!f||"map"!==u.nodeName.toLowerCase())&&0<(r=e("img[usemap='#"+f+"']")).length&&r.is(":visible");if(/^(input|select|textarea|button|object)$/.test(f)?(u=!r.disabled)&&(f=e(r).closest("fieldset")[0])&&(u=!f.disabled):u="a"===f&&r.href||u,u=u&&e(r).is(":visible")){for(u=(r=e(r)).css("visibility");"inherit"===u;)u=(r=r.parent()).css("visibility");u="hidden"!==u}return u},e.extend(e.expr[":"],{focusable:function(r){return e.ui.focusable(r,null!=e.attr(r,"tabindex"))}}),e.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):e(this[0].form)},e.ui.formResetMixin={_formResetHandler:function(){var r=e(this);setTimeout(function(){var u=r.data("ui-form-reset-instances");e.each(u,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var r=this.form.data("ui-form-reset-instances")||[];r.length||this.form.on("reset.ui-form-reset",this._formResetHandler),r.push(this),this.form.data("ui-form-reset-instances",r)}},_unbindFormResetHandler:function(){if(this.form.length){var r=this.form.data("ui-form-reset-instances");r.splice(e.inArray(this,r),1),r.length?this.form.data("ui-form-reset-instances",r):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===e.fn.jquery.substring(0,3)&&(e.each(["Width","Height"],function(r,u){function f(A,x,y,S){return e.each(m,function(){x-=parseFloat(e.css(A,"padding"+this))||0,y&&(x-=parseFloat(e.css(A,"border"+this+"Width"))||0),S&&(x-=parseFloat(e.css(A,"margin"+this))||0)}),x}var m="Width"===u?["Left","Right"]:["Top","Bottom"],b=u.toLowerCase(),w={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+u]=function(A){return void 0===A?w["inner"+u].call(this):this.each(function(){e(this).css(b,f(this,A)+"px")})},e.fn["outer"+u]=function(A,x){return"number"!=typeof A?w["outer"+u].call(this,A):this.each(function(){e(this).css(b,f(this,A,!0,x)+"px")})}}),e.fn.addBack=function(r){return this.add(null==r?this.prevObject:this.prevObject.filter(r))}),e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},e.ui.escapeSelector=function(){var r=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(u){return u.replace(r,"\\$1")}}(),e.fn.labels=function(){var r;if(this[0].labels&&this[0].labels.length)return this.pushStack(this[0].labels);var u=this.eq(0).parents("label");if(r=this.attr("id")){var f=this.eq(0).parents().last();f=f.add(f.length?f.siblings():this.siblings()),r="label[for='"+e.ui.escapeSelector(r)+"']",u=u.add(f.find(r).addBack(r))}return this.pushStack(u)},e.fn.scrollParent=function(r){var u=this.css("position"),f="absolute"===u,m=r?/(auto|scroll|hidden)/:/(auto|scroll)/;return r=this.parents().filter(function(){var b=e(this);return(!f||"static"!==b.css("position"))&&m.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0),"fixed"!==u&&r.length?r:e(this[0].ownerDocument||document)},e.extend(e.expr[":"],{tabbable:function(r){var u=e.attr(r,"tabindex"),f=null!=u;return(!f||0<=u)&&e.ui.focusable(r,f)}}),e.fn.extend({uniqueId:function(){var r=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var h=!1;e(document).on("mouseup",function(){h=!1}),e.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var r=this;this.element.on("mousedown."+this.widgetName,function(u){return r._mouseDown(u)}).on("click."+this.widgetName,function(u){if(!0===e.data(u.target,r.widgetName+".preventClickEvent"))return e.removeData(u.target,r.widgetName+".preventClickEvent"),u.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(r){if(!h){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(r),this._mouseDownEvent=r;var u=this,f=1===r.which,m=!("string"!=typeof this.options.cancel||!r.target.nodeName)&&e(r.target).closest(this.options.cancel).length;return!(f&&!m&&this._mouseCapture(r))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){u.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(r)&&this._mouseDelayMet(r)&&(this._mouseStarted=!1!==this._mouseStart(r),!this._mouseStarted)?(r.preventDefault(),!0):(!0===e.data(r.target,this.widgetName+".preventClickEvent")&&e.removeData(r.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(b){return u._mouseMove(b)},this._mouseUpDelegate=function(b){return u._mouseUp(b)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),r.preventDefault(),h=!0))}},_mouseMove:function(r){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!r.button)return this._mouseUp(r);if(!r.which)if(r.originalEvent.altKey||r.originalEvent.ctrlKey||r.originalEvent.metaKey||r.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(r)}return(r.which||r.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(r),r.preventDefault()):(this._mouseDistanceMet(r)&&this._mouseDelayMet(r)&&((this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,r))?this._mouseDrag(r):this._mouseUp(r)),!this._mouseStarted)},_mouseUp:function(r){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,r.target===this._mouseDownEvent.target&&e.data(r.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(r)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),h=this.ignoreMissingWhich=!1,r.preventDefault()},_mouseDistanceMet:function(r){return Math.max(Math.abs(this._mouseDownEvent.pageX-r.pageX),Math.abs(this._mouseDownEvent.pageY-r.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.ui.plugin={add:function(r,u,f){var m;for(m in r=e.ui[r].prototype,f)r.plugins[m]=r.plugins[m]||[],r.plugins[m].push([u,f[m]])},call:function(r,u,f,m){if((u=r.plugins[u])&&(m||r.element[0].parentNode&&11!==r.element[0].parentNode.nodeType))for(m=0;m<u.length;m++)r.options[u[m][0]]&&u[m][1].apply(r.element,f)}},e.ui.safeActiveElement=function(r){try{var u=r.activeElement}catch{u=r.body}return u||(u=r.body),u.nodeName||(u=r.body),u},e.ui.safeBlur=function(r){r&&"body"!==r.nodeName.toLowerCase()&&e(r).trigger("blur")},e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(r,u){this._super(r,u),"handle"===r&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(r){var u=this.options;return!(this.helper||u.disabled||0<e(r.target).closest(".ui-resizable-handle").length||(this.handle=this._getHandle(r),!this.handle)||(this._blurActiveElement(r),this._blockFrames(!0===u.iframeFix?"iframe":u.iframeFix),0))},_blockFrames:function(r){this.iframeBlocks=this.document.find(r).map(function(){var u=e(this);return e("<div>").css("position","absolute").appendTo(u.parent()).outerWidth(u.outerWidth()).outerHeight(u.outerHeight()).offset(u.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(r){var u=e.ui.safeActiveElement(this.document[0]);e(r.target).closest(u).length||e.ui.safeBlur(u)},_mouseStart:function(r){var u=this.options;return this.helper=this._createHelper(r),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=0<this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length,this.positionAbs=this.element.offset(),this._refreshOffsets(r),this.originalPosition=this.position=this._generatePosition(r,!1),this.originalPageX=r.pageX,this.originalPageY=r.pageY,u.cursorAt&&this._adjustOffsetFromHelper(u.cursorAt),this._setContainment(),!1===this._trigger("start",r)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!u.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,r),this._mouseDrag(r,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,r),!0)},_refreshOffsets:function(r){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:r.pageX-this.offset.left,top:r.pageY-this.offset.top}},_mouseDrag:function(r,u){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(r,!0),this.positionAbs=this._convertPositionTo("absolute"),!u){if(u=this._uiHash(),!1===this._trigger("drag",r,u))return this._mouseUp(new e.Event("mouseup",r)),!1;this.position=u.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,r),!1},_mouseStop:function(r){var u=this,f=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(f=e.ui.ddmanager.drop(this,r)),this.dropped&&(f=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!f||"valid"===this.options.revert&&f||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,f)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==u._trigger("stop",r)&&u._clear()}):!1!==this._trigger("stop",r)&&this._clear(),!1},_mouseUp:function(r){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,r),this.handleElement.is(r.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,r)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(r){return!this.options.handle||!!e(r.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(r){var u=this.options,f=e.isFunction(u.helper);return(r=f?e(u.helper.apply(this.element[0],[r])):"clone"===u.helper?this.element.clone().removeAttr("id"):this.element).parents("body").length||r.appendTo("parent"===u.appendTo?this.element[0].parentNode:u.appendTo),f&&r[0]===this.element[0]&&this._setPositionRelative(),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(r){"string"==typeof r&&(r=r.split(" ")),e.isArray(r)&&(r={left:+r[0],top:+r[1]||0}),"left"in r&&(this.offset.click.left=r.left+this.margins.left),"right"in r&&(this.offset.click.left=this.helperProportions.width-r.right+this.margins.left),"top"in r&&(this.offset.click.top=r.top+this.margins.top),"bottom"in r&&(this.offset.click.top=this.helperProportions.height-r.bottom+this.margins.top)},_isRootNode:function(r){return/(html|body)/i.test(r.tagName)||r===this.document[0]},_getParentOffset:function(){var r=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(r.left+=this.scrollParent.scrollLeft(),r.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(r={top:0,left:0}),{top:r.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:r.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var r=this.element.position(),u=this._isRootNode(this.scrollParent[0]);return{top:r.top-(parseInt(this.helper.css("top"),10)||0)+(u?0:this.scrollParent.scrollTop()),left:r.left-(parseInt(this.helper.css("left"),10)||0)+(u?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var r,u=this.options,f=this.document[0];this.relativeContainer=null,u.containment?"window"===u.containment?this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:"document"===u.containment?this.containment=[0,0,e(f).width()-this.helperProportions.width-this.margins.left,(e(f).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:u.containment.constructor===Array?this.containment=u.containment:("parent"===u.containment&&(u.containment=this.helper[0].parentNode),(r=(f=e(u.containment))[0])&&(u=/(scroll|auto)/.test(f.css("overflow")),this.containment=[(parseInt(f.css("borderLeftWidth"),10)||0)+(parseInt(f.css("paddingLeft"),10)||0),(parseInt(f.css("borderTopWidth"),10)||0)+(parseInt(f.css("paddingTop"),10)||0),(u?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(f.css("borderRightWidth"),10)||0)-(parseInt(f.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(u?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(f.css("borderBottomWidth"),10)||0)-(parseInt(f.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=f)):this.containment=null},_convertPositionTo:function(r,u){u||(u=this.position),r="absolute"===r?1:-1;var f=this._isRootNode(this.scrollParent[0]);return{top:u.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.offset.scroll.top:f?0:this.offset.scroll.top)*r,left:u.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.offset.scroll.left:f?0:this.offset.scroll.left)*r}},_generatePosition:function(r,u){var f=this.options,m=this._isRootNode(this.scrollParent[0]),b=r.pageX,w=r.pageY;if(m&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),u){if(this.containment){if(this.relativeContainer){var A=this.relativeContainer.offset();A=[this.containment[0]+A.left,this.containment[1]+A.top,this.containment[2]+A.left,this.containment[3]+A.top]}else A=this.containment;r.pageX-this.offset.click.left<A[0]&&(b=A[0]+this.offset.click.left),r.pageY-this.offset.click.top<A[1]&&(w=A[1]+this.offset.click.top),r.pageX-this.offset.click.left>A[2]&&(b=A[2]+this.offset.click.left),r.pageY-this.offset.click.top>A[3]&&(w=A[3]+this.offset.click.top)}f.grid&&(w=f.grid[1]?this.originalPageY+Math.round((w-this.originalPageY)/f.grid[1])*f.grid[1]:this.originalPageY,w=A?w-this.offset.click.top>=A[1]||w-this.offset.click.top>A[3]?w:w-this.offset.click.top>=A[1]?w-f.grid[1]:w+f.grid[1]:w,b=f.grid[0]?this.originalPageX+Math.round((b-this.originalPageX)/f.grid[0])*f.grid[0]:this.originalPageX,b=A?b-this.offset.click.left>=A[0]||b-this.offset.click.left>A[2]?b:b-this.offset.click.left>=A[0]?b-f.grid[0]:b+f.grid[0]:b),"y"===f.axis&&(b=this.originalPageX),"x"===f.axis&&(w=this.originalPageY)}return{top:w-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:m?0:this.offset.scroll.top),left:b-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:m?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(r,u,f){return f=f||this._uiHash(),e.ui.plugin.call(this,r,[u,f,this],!0),/^(drag|start|stop)/.test(r)&&(this.positionAbs=this._convertPositionTo("absolute"),f.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,r,u,f)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(r,u,f){var m=e.extend({},u,{item:f.element});f.sortables=[],e(f.options.connectToSortable).each(function(){var b=e(this).sortable("instance");b&&!b.options.disabled&&(f.sortables.push(b),b.refreshPositions(),b._trigger("activate",r,m))})},stop:function(r,u,f){var m=e.extend({},u,{item:f.element});f.cancelHelperRemoval=!1,e.each(f.sortables,function(){this.isOver?(this.isOver=0,f.cancelHelperRemoval=!0,this.cancelHelperRemoval=!1,this._storedCSS={position:this.placeholder.css("position"),top:this.placeholder.css("top"),left:this.placeholder.css("left")},this._mouseStop(r),this.options.helper=this.options._helper):(this.cancelHelperRemoval=!0,this._trigger("deactivate",r,m))})},drag:function(r,u,f){e.each(f.sortables,function(){var m=!1,b=this;b.positionAbs=f.positionAbs,b.helperProportions=f.helperProportions,b.offset.click=f.offset.click,b._intersectsWith(b.containerCache)&&(m=!0,e.each(f.sortables,function(){return this.positionAbs=f.positionAbs,this.helperProportions=f.helperProportions,this.offset.click=f.offset.click,this!==b&&this._intersectsWith(this.containerCache)&&e.contains(b.element[0],this.element[0])&&(m=!1),m})),m?(b.isOver||(b.isOver=1,f._parent=u.helper.parent(),b.currentItem=u.helper.appendTo(b.element).data("ui-sortable-item",!0),b.options._helper=b.options.helper,b.options.helper=function(){return u.helper[0]},r.target=b.currentItem[0],b._mouseCapture(r,!0),b._mouseStart(r,!0,!0),b.offset.click.top=f.offset.click.top,b.offset.click.left=f.offset.click.left,b.offset.parent.left-=f.offset.parent.left-b.offset.parent.left,b.offset.parent.top-=f.offset.parent.top-b.offset.parent.top,f._trigger("toSortable",r),f.dropped=b.element,e.each(f.sortables,function(){this.refreshPositions()}),f.currentItem=f.element,b.fromOutside=f),b.currentItem&&(b._mouseDrag(r),u.position=b.position)):b.isOver&&(b.isOver=0,b.cancelHelperRemoval=!0,b.options._revert=b.options.revert,b.options.revert=!1,b._trigger("out",r,b._uiHash(b)),b._mouseStop(r,!0),b.options.revert=b.options._revert,b.options.helper=b.options._helper,b.placeholder&&b.placeholder.remove(),u.helper.appendTo(f._parent),f._refreshOffsets(r),u.position=f._generatePosition(r,!0),f._trigger("fromSortable",r),f.dropped=!1,e.each(f.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(r,u,f){r=e("body"),f=f.options,r.css("cursor")&&(f._cursor=r.css("cursor")),r.css("cursor",f.cursor)},stop:function(r,u,f){(r=f.options)._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(r,u,f){r=e(u.helper),f=f.options,r.css("opacity")&&(f._opacity=r.css("opacity")),r.css("opacity",f.opacity)},stop:function(r,u,f){(r=f.options)._opacity&&e(u.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(r,u,f){f.scrollParentNotHidden||(f.scrollParentNotHidden=f.helper.scrollParent(!1)),f.scrollParentNotHidden[0]!==f.document[0]&&"HTML"!==f.scrollParentNotHidden[0].tagName&&(f.overflowOffset=f.scrollParentNotHidden.offset())},drag:function(r,u,f){u=f.options;var m=!1,b=f.scrollParentNotHidden[0],w=f.document[0];b!==w&&"HTML"!==b.tagName?(u.axis&&"x"===u.axis||(f.overflowOffset.top+b.offsetHeight-r.pageY<u.scrollSensitivity?b.scrollTop=m=b.scrollTop+u.scrollSpeed:r.pageY-f.overflowOffset.top<u.scrollSensitivity&&(b.scrollTop=m=b.scrollTop-u.scrollSpeed)),u.axis&&"y"===u.axis||(f.overflowOffset.left+b.offsetWidth-r.pageX<u.scrollSensitivity?b.scrollLeft=m=b.scrollLeft+u.scrollSpeed:r.pageX-f.overflowOffset.left<u.scrollSensitivity&&(b.scrollLeft=m=b.scrollLeft-u.scrollSpeed))):(u.axis&&"x"===u.axis||(r.pageY-e(w).scrollTop()<u.scrollSensitivity?m=e(w).scrollTop(e(w).scrollTop()-u.scrollSpeed):e(window).height()-(r.pageY-e(w).scrollTop())<u.scrollSensitivity&&(m=e(w).scrollTop(e(w).scrollTop()+u.scrollSpeed))),u.axis&&"y"===u.axis||(r.pageX-e(w).scrollLeft()<u.scrollSensitivity?m=e(w).scrollLeft(e(w).scrollLeft()-u.scrollSpeed):e(window).width()-(r.pageX-e(w).scrollLeft())<u.scrollSensitivity&&(m=e(w).scrollLeft(e(w).scrollLeft()+u.scrollSpeed)))),!1!==m&&e.ui.ddmanager&&!u.dropBehaviour&&e.ui.ddmanager.prepareOffsets(f,r)}}),e.ui.plugin.add("draggable","snap",{start:function(r,u,f){r=f.options,f.snapElements=[],e(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each(function(){var m=e(this),b=m.offset();this!==f.element[0]&&f.snapElements.push({item:this,width:m.outerWidth(),height:m.outerHeight(),top:b.top,left:b.left})})},drag:function(r,u,f){var m,b=f.options,w=b.snapTolerance,A=u.offset.left,x=A+f.helperProportions.width,y=u.offset.top,S=y+f.helperProportions.height;for(m=f.snapElements.length-1;0<=m;m--){var _=f.snapElements[m].left-f.margins.left,C=_+f.snapElements[m].width,I=f.snapElements[m].top-f.margins.top,L=I+f.snapElements[m].height;if(x<_-w||A>C+w||S<I-w||y>L+w||!e.contains(f.snapElements[m].item.ownerDocument,f.snapElements[m].item))f.snapElements[m].snapping&&f.options.snap.release&&f.options.snap.release.call(f.element,r,e.extend(f._uiHash(),{snapItem:f.snapElements[m].item})),f.snapElements[m].snapping=!1;else{if("inner"!==b.snapMode){var D=Math.abs(I-S)<=w,O=Math.abs(L-y)<=w,M=Math.abs(_-x)<=w,E=Math.abs(C-A)<=w;D&&(u.position.top=f._convertPositionTo("relative",{top:I-f.helperProportions.height,left:0}).top),O&&(u.position.top=f._convertPositionTo("relative",{top:L,left:0}).top),M&&(u.position.left=f._convertPositionTo("relative",{top:0,left:_-f.helperProportions.width}).left),E&&(u.position.left=f._convertPositionTo("relative",{top:0,left:C}).left)}var R=D||O||M||E;"outer"!==b.snapMode&&(D=Math.abs(I-y)<=w,O=Math.abs(L-S)<=w,M=Math.abs(_-A)<=w,E=Math.abs(C-x)<=w,D&&(u.position.top=f._convertPositionTo("relative",{top:I,left:0}).top),O&&(u.position.top=f._convertPositionTo("relative",{top:L-f.helperProportions.height,left:0}).top),M&&(u.position.left=f._convertPositionTo("relative",{top:0,left:_}).left),E&&(u.position.left=f._convertPositionTo("relative",{top:0,left:C-f.helperProportions.width}).left)),!f.snapElements[m].snapping&&(D||O||M||E||R)&&f.options.snap.snap&&f.options.snap.snap.call(f.element,r,e.extend(f._uiHash(),{snapItem:f.snapElements[m].item})),f.snapElements[m].snapping=D||O||M||E||R}}}}),e.ui.plugin.add("draggable","stack",{start:function(r,u,f){if((r=e.makeArray(e(f.options.stack)).sort(function(b,w){return(parseInt(e(b).css("zIndex"),10)||0)-(parseInt(e(w).css("zIndex"),10)||0)})).length){var m=parseInt(e(r[0]).css("zIndex"),10)||0;e(r).each(function(b){e(this).css("zIndex",m+b)}),this.css("zIndex",m+r.length)}}}),e.ui.plugin.add("draggable","zIndex",{start:function(r,u,f){r=e(u.helper),f=f.options,r.css("zIndex")&&(f._zIndex=r.css("zIndex")),r.css("zIndex",f.zIndex)},stop:function(r,u,f){(r=f.options)._zIndex&&e(u.helper).css("zIndex",r._zIndex)}}),e.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var r,u=this.options,f=u.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(f)?f:function(m){return m.is(f)},this.proportions=function(){if(!arguments.length)return r||(r={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});r=arguments[0]},this._addToManager(u.scope),u.addClasses&&this._addClass("ui-droppable")},_addToManager:function(r){e.ui.ddmanager.droppables[r]=e.ui.ddmanager.droppables[r]||[],e.ui.ddmanager.droppables[r].push(this)},_splice:function(r){for(var u=0;u<r.length;u++)r[u]===this&&r.splice(u,1)},_destroy:function(){this._splice(e.ui.ddmanager.droppables[this.options.scope])},_setOption:function(r,u){"accept"===r?this.accept=e.isFunction(u)?u:function(f){return f.is(u)}:"scope"===r&&(this._splice(e.ui.ddmanager.droppables[this.options.scope]),this._addToManager(u)),this._super(r,u)},_activate:function(r){var u=e.ui.ddmanager.current;this._addActiveClass(),u&&this._trigger("activate",r,this.ui(u))},_deactivate:function(r){var u=e.ui.ddmanager.current;this._removeActiveClass(),u&&this._trigger("deactivate",r,this.ui(u))},_over:function(r){var u=e.ui.ddmanager.current;u&&(u.currentItem||u.element)[0]!==this.element[0]&&this.accept.call(this.element[0],u.currentItem||u.element)&&(this._addHoverClass(),this._trigger("over",r,this.ui(u)))},_out:function(r){var u=e.ui.ddmanager.current;u&&(u.currentItem||u.element)[0]!==this.element[0]&&this.accept.call(this.element[0],u.currentItem||u.element)&&(this._removeHoverClass(),this._trigger("out",r,this.ui(u)))},_drop:function(r,u){var f=u||e.ui.ddmanager.current,m=!1;return!(!f||(f.currentItem||f.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var b=e(this).droppable("instance");if(b.options.greedy&&!b.options.disabled&&b.options.scope===f.options.scope&&b.accept.call(b.element[0],f.currentItem||f.element)&&p(f,e.extend(b,{offset:b.element.offset()}),b.options.tolerance,r))return m=!0,!1}),!m&&!!this.accept.call(this.element[0],f.currentItem||f.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",r,this.ui(f)),this.element))},ui:function(r){return{draggable:r.currentItem||r.element,helper:r.helper,position:r.position,offset:r.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var p=e.ui.intersect=function(r,u,f,m){if(!u.offset)return!1;var b=(r.positionAbs||r.position.absolute).left+r.margins.left,w=(r.positionAbs||r.position.absolute).top+r.margins.top,A=b+r.helperProportions.width,x=w+r.helperProportions.height,y=u.offset.left,S=u.offset.top,_=y+u.proportions().width,C=S+u.proportions().height;switch(f){case"fit":return y<=b&&A<=_&&S<=w&&x<=C;case"intersect":return y<b+r.helperProportions.width/2&&A-r.helperProportions.width/2<_&&S<w+r.helperProportions.height/2&&x-r.helperProportions.height/2<C;case"pointer":return r=m.pageY,f=u.proportions().height,(S=r>=S&&r<S+f)&&(m=m.pageX,u=u.proportions().width,S=m>=y&&m<y+u),S;case"touch":return(w>=S&&w<=C||x>=S&&x<=C||w<S&&x>C)&&(b>=y&&b<=_||A>=y&&A<=_||b<y&&A>_);default:return!1}};e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(r,u){var f,m=e.ui.ddmanager.droppables[r.options.scope]||[],b=u?u.type:null,w=(r.currentItem||r.element).find(":data(ui-droppable)").addBack(),A=0;e:for(;A<m.length;A++)if(!(m[A].options.disabled||r&&!m[A].accept.call(m[A].element[0],r.currentItem||r.element))){for(f=0;f<w.length;f++)if(w[f]===m[A].element[0]){m[A].proportions().height=0;continue e}m[A].visible="none"!==m[A].element.css("display"),m[A].visible&&("mousedown"===b&&m[A]._activate.call(m[A],u),m[A].offset=m[A].element.offset(),m[A].proportions({width:m[A].element[0].offsetWidth,height:m[A].element[0].offsetHeight}))}},drop:function(r,u){var f=!1;return e.each((e.ui.ddmanager.droppables[r.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&p(r,this,this.options.tolerance,u)&&(f=this._drop.call(this,u)||f),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],r.currentItem||r.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,u)))}),f},dragStart:function(r,u){r.element.parentsUntil("body").on("scroll.droppable",function(){r.options.refreshPositions||e.ui.ddmanager.prepareOffsets(r,u)})},drag:function(r,u){r.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(r,u),e.each(e.ui.ddmanager.droppables[r.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var f=p(r,this,this.options.tolerance,u),m=!f&&this.isover?"isout":f&&!this.isover?"isover":null;if(m){if(this.options.greedy){var b=this.options.scope;if((f=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===b})).length){var w=e(f[0]).droppable("instance");w.greedyChild="isover"===m}}w&&"isover"===m&&(w.isover=!1,w.isout=!0,w._out.call(w,u)),this[m]=!0,this["isout"===m?"isover":"isout"]=!1,this["isover"===m?"_over":"_out"].call(this,u),w&&"isout"===m&&(w.isout=!1,w.isover=!0,w._over.call(w,u))}}})},dragStop:function(r,u){r.element.parentsUntil("body").off("scroll.droppable"),r.options.refreshPositions||e.ui.ddmanager.prepareOffsets(r,u)}},!1!==e.uiBackCompat&&e.widget("ui.droppable",e.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),e.widget("ui.resizable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(r){return parseFloat(r)||0},_isNumber:function(r){return!isNaN(parseFloat(r))},_hasScroll:function(r,u){if("hidden"===e(r).css("overflow"))return!1;if(0<r[u=u&&"left"===u?"scrollLeft":"scrollTop"])return!0;r[u]=1;var f=0<r[u];return r[u]=0,f},_create:function(){var r=this.options,u=this;if(this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)){this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0;var f={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")};this.element.css(f),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(f),this._proportionallyResize()}this._setupHandles(),r.autoHide&&e(this.element).on("mouseenter",function(){r.disabled||(u._removeClass("ui-resizable-autohide"),u._handles.show())}).on("mouseleave",function(){r.disabled||u.resizing||(u._addClass("ui-resizable-autohide"),u._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var r=function(f){e(f).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){r(this.element);var u=this.element;this.originalElement.css({position:u.css("position"),width:u.outerWidth(),height:u.outerHeight(),top:u.css("top"),left:u.css("left")}).insertAfter(u),u.remove()}return this.originalElement.css("resize",this.originalResizeStyle),r(this.originalElement),this},_setOption:function(r,u){"handles"===(this._super(r,u),r)&&(this._removeHandles(),this._setupHandles())},_setupHandles:function(){var u,r=this.options,f=this;if(this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String){"all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var m=this.handles.split(",");for(this.handles={},u=0;u<m.length;u++){var b=e.trim(m[u]),w="ui-resizable-"+b,A=e("<div>");this._addClass(A,"ui-resizable-handle "+w),A.css({zIndex:r.zIndex}),this.handles[b]=".ui-resizable-"+b,this.element.append(A)}}this._renderAxis=function(x){var y;for(y in x=x||this.element,this.handles){if(this.handles[y].constructor===String?this.handles[y]=this.element.children(this.handles[y]).first().show():(this.handles[y].jquery||this.handles[y].nodeType)&&(this.handles[y]=e(this.handles[y]),this._on(this.handles[y],{mousedown:f._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)){var S=e(this.handles[y],this.element),_=/sw|ne|nw|se|n|s/.test(y)?S.outerHeight():S.outerWidth();S=["padding",/ne|nw|n/.test(y)?"Top":/se|sw|s/.test(y)?"Bottom":/^e$/.test(y)?"Right":"Left"].join(""),x.css(S,_),this._proportionallyResize()}this._handles=this._handles.add(this.handles[y])}},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){f.resizing||(this.className&&(A=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),f.axis=A&&A[1]?A[1]:"se")}),r.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(r){var u,f=!1;for(u in this.handles){var m=e(this.handles[u])[0];(m===r.target||e.contains(m,r.target))&&(f=!0)}return!this.options.disabled&&f},_mouseStart:function(r){var u=this.options,f=this.element;this.resizing=!0,this._renderProxy();var m=this._num(this.helper.css("left")),b=this._num(this.helper.css("top"));return u.containment&&(m+=e(u.containment).scrollLeft()||0,b+=e(u.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:m,top:b},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:f.width(),height:f.height()},this.originalSize=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()},this.sizeDiff={width:f.outerWidth()-f.width(),height:f.outerHeight()-f.height()},this.originalPosition={left:m,top:b},this.originalMousePosition={left:r.pageX,top:r.pageY},this.aspectRatio="number"==typeof u.aspectRatio?u.aspectRatio:this.originalSize.width/this.originalSize.height||1,m=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===m?this.axis+"-resize":m),this._addClass("ui-resizable-resizing"),this._propagate("start",r),!0},_mouseDrag:function(r){var u=this.originalMousePosition,f=r.pageX-u.left||0;u=r.pageY-u.top||0;var m=this._change[this.axis];return this._updatePrevProperties(),m&&(f=m.apply(this,[r,f,u]),this._updateVirtualBoundaries(r.shiftKey),(this._aspectRatio||r.shiftKey)&&(f=this._updateRatio(f,r)),f=this._respectSize(f,r),this._updateCache(f),this._propagate("resize",r),f=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(f)||(this._updatePrevProperties(),this._trigger("resize",r,this.ui()),this._applyChanges())),!1},_mouseStop:function(r){this.resizing=!1;var u,f=this.options;if(this._helper){var m=this._proportionallyResizeElements;m=(u=m.length&&/textarea/i.test(m[0].nodeName))&&this._hasScroll(m[0],"left")?0:this.sizeDiff.height,u=u?0:this.sizeDiff.width,u={width:this.helper.width()-u,height:this.helper.height()-m},m=parseFloat(this.element.css("left"))+(this.position.left-this.originalPosition.left)||null;var b=parseFloat(this.element.css("top"))+(this.position.top-this.originalPosition.top)||null;f.animate||this.element.css(e.extend(u,{top:b,left:m})),this.helper.height(this.size.height),this.helper.width(this.size.width),this._helper&&!f.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",r),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var r={};return this.position.top!==this.prevPosition.top&&(r.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(r.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(r.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(r.height=this.size.height+"px"),this.helper.css(r),r},_updateVirtualBoundaries:function(r){var u=this.options;if(u={minWidth:this._isNumber(u.minWidth)?u.minWidth:0,maxWidth:this._isNumber(u.maxWidth)?u.maxWidth:1/0,minHeight:this._isNumber(u.minHeight)?u.minHeight:0,maxHeight:this._isNumber(u.maxHeight)?u.maxHeight:1/0},this._aspectRatio||r){var f=u.minWidth/this.aspectRatio,m=u.maxHeight*this.aspectRatio,b=u.maxWidth/this.aspectRatio;(r=u.minHeight*this.aspectRatio)>u.minWidth&&(u.minWidth=r),f>u.minHeight&&(u.minHeight=f),m<u.maxWidth&&(u.maxWidth=m),b<u.maxHeight&&(u.maxHeight=b)}this._vBoundaries=u},_updateCache:function(r){this.offset=this.helper.offset(),this._isNumber(r.left)&&(this.position.left=r.left),this._isNumber(r.top)&&(this.position.top=r.top),this._isNumber(r.height)&&(this.size.height=r.height),this._isNumber(r.width)&&(this.size.width=r.width)},_updateRatio:function(r){var u=this.position,f=this.size,m=this.axis;return this._isNumber(r.height)?r.width=r.height*this.aspectRatio:this._isNumber(r.width)&&(r.height=r.width/this.aspectRatio),"sw"===m&&(r.left=u.left+(f.width-r.width),r.top=null),"nw"===m&&(r.top=u.top+(f.height-r.height),r.left=u.left+(f.width-r.width)),r},_respectSize:function(r){var u=this._vBoundaries,f=this.axis,m=this._isNumber(r.width)&&u.maxWidth&&u.maxWidth<r.width,b=this._isNumber(r.height)&&u.maxHeight&&u.maxHeight<r.height,w=this._isNumber(r.width)&&u.minWidth&&u.minWidth>r.width,A=this._isNumber(r.height)&&u.minHeight&&u.minHeight>r.height,x=this.originalPosition.left+this.originalSize.width,y=this.originalPosition.top+this.originalSize.height,S=/sw|nw|w/.test(f);return f=/nw|ne|n/.test(f),w&&(r.width=u.minWidth),A&&(r.height=u.minHeight),m&&(r.width=u.maxWidth),b&&(r.height=u.maxHeight),w&&S&&(r.left=x-u.minWidth),m&&S&&(r.left=x-u.maxWidth),A&&f&&(r.top=y-u.minHeight),b&&f&&(r.top=y-u.maxHeight),r.width||r.height||r.left||!r.top?r.width||r.height||r.top||!r.left||(r.left=null):r.top=null,r},_getPaddingPlusBorderDimensions:function(r){var u=0,f=[],m=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")];for(r=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")];4>u;u++)f[u]=parseFloat(m[u])||0,f[u]+=parseFloat(r[u])||0;return{height:f[0]+f[2],width:f[1]+f[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var r,u=0,f=this.helper||this.element;u<this._proportionallyResizeElements.length;u++)r=this._proportionallyResizeElements[u],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(r)),r.css({height:f.height()-this.outerDimensions.height||0,width:f.width()-this.outerDimensions.width||0})},_renderProxy:function(){var r=this.options;this.elementOffset=this.element.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++r.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(r,u){return{width:this.originalSize.width+u}},w:function(r,u){return{left:this.originalPosition.left+u,width:this.originalSize.width-u}},n:function(r,u,f){return{top:this.originalPosition.top+f,height:this.originalSize.height-f}},s:function(r,u,f){return{height:this.originalSize.height+f}},se:function(r,u,f){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[r,u,f]))},sw:function(r,u,f){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[r,u,f]))},ne:function(r,u,f){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[r,u,f]))},nw:function(r,u,f){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[r,u,f]))}},_propagate:function(r,u){e.ui.plugin.call(this,r,[u,this.ui()]),"resize"!==r&&this._trigger(r,u,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(r){var u=e(this).resizable("instance"),f=u.options,m=u._proportionallyResizeElements,b=m.length&&/textarea/i.test(m[0].nodeName),w=b&&u._hasScroll(m[0],"left")?0:u.sizeDiff.height;b={width:u.size.width-(b?0:u.sizeDiff.width),height:u.size.height-w},w=parseFloat(u.element.css("left"))+(u.position.left-u.originalPosition.left)||null;var A=parseFloat(u.element.css("top"))+(u.position.top-u.originalPosition.top)||null;u.element.animate(e.extend(b,A&&w?{top:A,left:w}:{}),{duration:f.animateDuration,easing:f.animateEasing,step:function(){var x={width:parseFloat(u.element.css("width")),height:parseFloat(u.element.css("height")),top:parseFloat(u.element.css("top")),left:parseFloat(u.element.css("left"))};m&&m.length&&e(m[0]).css({width:x.width,height:x.height}),u._updateCache(x),u._propagate("resize",r)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var r=e(this).resizable("instance"),u=r.element,f=r.options.containment;if(u=f instanceof e?f.get(0):/parent/.test(f)?u.parent().get(0):f)if(r.containerElement=e(u),/document/.test(f)||f===document)r.containerOffset={left:0,top:0},r.containerPosition={left:0,top:0},r.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var m=e(u),b=[];e(["Top","Right","Left","Bottom"]).each(function(x,y){b[x]=r._num(m.css("padding"+y))}),r.containerOffset=m.offset(),r.containerPosition=m.position(),r.containerSize={height:m.innerHeight()-b[3],width:m.innerWidth()-b[1]},f=r.containerOffset;var w=r.containerSize.height,A=r.containerSize.width;A=r._hasScroll(u,"left")?u.scrollWidth:A,w=r._hasScroll(u)?u.scrollHeight:w,r.parentData={element:u,left:f.left,top:f.top,width:A,height:w}}},resize:function(r){var u=e(this).resizable("instance"),f=u.options,m=u.containerOffset,b=u.position;r=u._aspectRatio||r.shiftKey;var w={top:0,left:0},A=u.containerElement,x=!0;A[0]!==document&&/static/.test(A.css("position"))&&(w=m),b.left<(u._helper?m.left:0)&&(u.size.width+=u._helper?u.position.left-m.left:u.position.left-w.left,r&&(u.size.height=u.size.width/u.aspectRatio,x=!1),u.position.left=f.helper?m.left:0),b.top<(u._helper?m.top:0)&&(u.size.height+=u._helper?u.position.top-m.top:u.position.top,r&&(u.size.width=u.size.height*u.aspectRatio,x=!1),u.position.top=u._helper?m.top:0),f=u.containerElement.get(0)===u.element.parent().get(0),b=/relative|absolute/.test(u.containerElement.css("position")),f&&b?(u.offset.left=u.parentData.left+u.position.left,u.offset.top=u.parentData.top+u.position.top):(u.offset.left=u.element.offset().left,u.offset.top=u.element.offset().top),f=Math.abs(u.sizeDiff.width+(u._helper?u.offset.left-w.left:u.offset.left-m.left)),m=Math.abs(u.sizeDiff.height+(u._helper?u.offset.top-w.top:u.offset.top-m.top)),f+u.size.width>=u.parentData.width&&(u.size.width=u.parentData.width-f,r&&(u.size.height=u.size.width/u.aspectRatio,x=!1)),m+u.size.height>=u.parentData.height&&(u.size.height=u.parentData.height-m,r&&(u.size.width=u.size.height*u.aspectRatio,x=!1)),x||(u.position.left=u.prevPosition.left,u.position.top=u.prevPosition.top,u.size.width=u.prevSize.width,u.size.height=u.prevSize.height)},stop:function(){var r=e(this).resizable("instance"),u=r.options,f=r.containerOffset,m=r.containerPosition,b=r.containerElement,w=e(r.helper),A=w.offset(),x=w.outerWidth()-r.sizeDiff.width;w=w.outerHeight()-r.sizeDiff.height,r._helper&&!u.animate&&/relative/.test(b.css("position"))&&e(this).css({left:A.left-m.left-f.left,width:x,height:w}),r._helper&&!u.animate&&/static/.test(b.css("position"))&&e(this).css({left:A.left-m.left-f.left,width:x,height:w})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var r=e(this).resizable("instance").options;e(r.alsoResize).each(function(){var u=e(this);u.data("ui-resizable-alsoresize",{width:parseFloat(u.width()),height:parseFloat(u.height()),left:parseFloat(u.css("left")),top:parseFloat(u.css("top"))})})},resize:function(r,u){var f=(r=e(this).resizable("instance")).originalSize,m=r.originalPosition,b={height:r.size.height-f.height||0,width:r.size.width-f.width||0,top:r.position.top-m.top||0,left:r.position.left-m.left||0};e(r.options.alsoResize).each(function(){var w=e(this),A=e(this).data("ui-resizable-alsoresize"),x={},y=w.parents(u.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(y,function(S,_){(S=(A[_]||0)+(b[_]||0))&&0<=S&&(x[_]=S||null)}),w.css(x)})},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var r=e(this).resizable("instance"),u=r.size;r.ghost=r.originalElement.clone(),r.ghost.css({opacity:.25,display:"block",position:"relative",height:u.height,width:u.width,margin:0,left:0,top:0}),r._addClass(r.ghost,"ui-resizable-ghost"),!1!==e.uiBackCompat&&"string"==typeof r.options.ghost&&r.ghost.addClass(this.options.ghost),r.ghost.appendTo(r.helper)},resize:function(){var r=e(this).resizable("instance");r.ghost&&r.ghost.css({position:"relative",height:r.size.height,width:r.size.width})},stop:function(){var r=e(this).resizable("instance");r.ghost&&r.helper&&r.helper.get(0).removeChild(r.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var r=e(this).resizable("instance"),u=r.options,f=r.size,m=r.originalSize,b=r.originalPosition,w=r.axis,A="number"==typeof u.grid?[u.grid,u.grid]:u.grid,x=A[0]||1,y=A[1]||1,S=Math.round((f.width-m.width)/x)*x;f=Math.round((f.height-m.height)/y)*y;var _=m.width+S,C=m.height+f,I=u.maxWidth&&u.maxWidth<_,L=u.maxHeight&&u.maxHeight<C,D=u.minWidth&&u.minWidth>_,O=u.minHeight&&u.minHeight>C;if(u.grid=A,D&&(_+=x),O&&(C+=y),I&&(_-=x),L&&(C-=y),/^(se|s|e)$/.test(w))r.size.width=_,r.size.height=C;else if(/^(ne)$/.test(w))r.size.width=_,r.size.height=C,r.position.top=b.top-f;else if(/^(sw)$/.test(w))r.size.width=_,r.size.height=C,r.position.left=b.left-S;else{if(0>=C-y||0>=_-x)var M=r._getPaddingPlusBorderDimensions(this);0<C-y?(r.size.height=C,r.position.top=b.top-f):(r.size.height=C=y-M.height,r.position.top=b.top+m.height-C),0<_-x?(r.size.width=_,r.position.left=b.left-S):(r.size.width=_=x-M.width,r.position.left=b.left+m.width-_)}}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var r=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){r.elementPos=e(r.element[0]).offset(),r.selectees=e(r.options.filter,r.element[0]),r._addClass(r.selectees,"ui-selectee"),r.selectees.each(function(){var u=e(this),f=u.offset(),m=f.left-r.elementPos.left;e.data(this,"selectable-item",{element:this,$element:u,left:m,top:f=f.top-r.elementPos.top,right:m+u.outerWidth(),bottom:f+u.outerHeight(),startselected:!1,selected:u.hasClass("ui-selected"),selecting:u.hasClass("ui-selecting"),unselecting:u.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=e("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(r){var u=this,f=this.options;this.opos=[r.pageX,r.pageY],this.elementPos=e(this.element[0]).offset(),this.options.disabled||(this.selectees=e(f.filter,this.element[0]),this._trigger("start",r),e(f.appendTo).append(this.helper),this.helper.css({left:r.pageX,top:r.pageY,width:0,height:0}),f.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var m=e.data(this,"selectable-item");m.startselected=!0,r.metaKey||r.ctrlKey||(u._removeClass(m.$element,"ui-selected"),m.selected=!1,u._addClass(m.$element,"ui-unselecting"),m.unselecting=!0,u._trigger("unselecting",r,{unselecting:m.element}))}),e(r.target).parents().addBack().each(function(){var m=e.data(this,"selectable-item");if(m){var b=!r.metaKey&&!r.ctrlKey||!m.$element.hasClass("ui-selected");return u._removeClass(m.$element,b?"ui-unselecting":"ui-selected")._addClass(m.$element,b?"ui-selecting":"ui-unselecting"),m.unselecting=!b,m.selecting=b,(m.selected=b)?u._trigger("selecting",r,{selecting:m.element}):u._trigger("unselecting",r,{unselecting:m.element}),!1}}))},_mouseDrag:function(r){if(this.dragged=!0,!this.options.disabled){var u=this,f=this.options,m=this.opos[0],b=this.opos[1],w=r.pageX,A=r.pageY;if(m>w){var x=w;w=m,m=x}return b>A&&(x=A,A=b,b=x),this.helper.css({left:m,top:b,width:w-m,height:A-b}),this.selectees.each(function(){var y=e.data(this,"selectable-item"),S=!1;if(y&&y.element!==u.element[0]){var _=y.left+u.elementPos.left,C=y.right+u.elementPos.left,I=y.top+u.elementPos.top,L=y.bottom+u.elementPos.top;"touch"===f.tolerance?S=!(_>w||C<m||I>A||L<b):"fit"===f.tolerance&&(S=_>m&&C<w&&I>b&&L<A),S?(y.selected&&(u._removeClass(y.$element,"ui-selected"),y.selected=!1),y.unselecting&&(u._removeClass(y.$element,"ui-unselecting"),y.unselecting=!1),y.selecting||(u._addClass(y.$element,"ui-selecting"),y.selecting=!0,u._trigger("selecting",r,{selecting:y.element}))):(y.selecting&&((r.metaKey||r.ctrlKey)&&y.startselected?(u._removeClass(y.$element,"ui-selecting"),y.selecting=!1,u._addClass(y.$element,"ui-selected"),y.selected=!0):(u._removeClass(y.$element,"ui-selecting"),y.selecting=!1,y.startselected&&(u._addClass(y.$element,"ui-unselecting"),y.unselecting=!0),u._trigger("unselecting",r,{unselecting:y.element}))),!y.selected||r.metaKey||r.ctrlKey||y.startselected||(u._removeClass(y.$element,"ui-selected"),y.selected=!1,u._addClass(y.$element,"ui-unselecting"),y.unselecting=!0,u._trigger("unselecting",r,{unselecting:y.element})))}}),!1}},_mouseStop:function(r){var u=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var f=e.data(this,"selectable-item");u._removeClass(f.$element,"ui-unselecting"),f.unselecting=!1,f.startselected=!1,u._trigger("unselected",r,{unselected:f.element})}),e(".ui-selecting",this.element[0]).each(function(){var f=e.data(this,"selectable-item");u._removeClass(f.$element,"ui-selecting")._addClass(f.$element,"ui-selected"),f.selecting=!1,f.selected=!0,f.startselected=!0,u._trigger("selected",r,{selected:f.element})}),this._trigger("stop",r),this.helper.remove(),!1}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(r,u,f){return r>=u&&r<u+f},_isFloating:function(r){return/left|right/.test(r.css("float"))||/inline|table-cell/.test(r.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(r,u){this._super(r,u),"handle"===r&&this._setHandleClassName()},_setHandleClassName:function(){var r=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),e.each(this.items,function(){r._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var r=this.items.length-1;0<=r;r--)this.items[r].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(r,u){var f=null,m=!1,b=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(r),e(r.target).parents().each(function(){if(e.data(this,b.widgetName+"-item")===b)return f=e(this),!1}),e.data(r.target,b.widgetName+"-item")===b&&(f=e(r.target)),!f||this.options.handle&&!u&&(e(this.options.handle,f).find("*").addBack().each(function(){this===r.target&&(m=!0)}),!m))||(this.currentItem=f,this._removeCurrentsFromItems(),0))},_mouseStart:function(r,u,f){if(u=this.options,this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(r),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:r.pageX-this.offset.left,top:r.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(r),this.originalPageX=r.pageX,this.originalPageY=r.pageY,u.cursorAt&&this._adjustOffsetFromHelper(u.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),u.containment&&this._setContainment(),u.cursor&&"auto"!==u.cursor){var m=this.document.find("body");this.storedCursor=m.css("cursor"),m.css("cursor",u.cursor),this.storedStylesheet=e("<style>*{ cursor: "+u.cursor+" !important; }</style>").appendTo(m)}if(u.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",u.opacity)),u.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",u.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",r,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!f)for(f=this.containers.length-1;0<=f;f--)this.containers[f]._trigger("activate",r,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!u.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,r),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(r),!0},_mouseDrag:function(r){var u,f=this.options,m=!1;for(this.position=this._generatePosition(r),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-r.pageY<f.scrollSensitivity?this.scrollParent[0].scrollTop=m=this.scrollParent[0].scrollTop+f.scrollSpeed:r.pageY-this.overflowOffset.top<f.scrollSensitivity&&(this.scrollParent[0].scrollTop=m=this.scrollParent[0].scrollTop-f.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-r.pageX<f.scrollSensitivity?this.scrollParent[0].scrollLeft=m=this.scrollParent[0].scrollLeft+f.scrollSpeed:r.pageX-this.overflowOffset.left<f.scrollSensitivity&&(this.scrollParent[0].scrollLeft=m=this.scrollParent[0].scrollLeft-f.scrollSpeed)):(r.pageY-this.document.scrollTop()<f.scrollSensitivity?m=this.document.scrollTop(this.document.scrollTop()-f.scrollSpeed):this.window.height()-(r.pageY-this.document.scrollTop())<f.scrollSensitivity&&(m=this.document.scrollTop(this.document.scrollTop()+f.scrollSpeed)),r.pageX-this.document.scrollLeft()<f.scrollSensitivity?m=this.document.scrollLeft(this.document.scrollLeft()-f.scrollSpeed):this.window.width()-(r.pageX-this.document.scrollLeft())<f.scrollSensitivity&&(m=this.document.scrollLeft(this.document.scrollLeft()+f.scrollSpeed))),!1!==m&&e.ui.ddmanager&&!f.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,r)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),f=this.items.length-1;0<=f;f--){var b=(m=this.items[f]).item[0];if((u=this._intersectsWithPointer(m))&&m.instance===this.currentContainer&&b!==this.currentItem[0]&&this.placeholder[1===u?"next":"prev"]()[0]!==b&&!e.contains(this.placeholder[0],b)&&("semi-dynamic"!==this.options.type||!e.contains(this.element[0],b))){if(this.direction=1===u?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(m))break;this._rearrange(r,m),this._trigger("change",r,this._uiHash());break}}return this._contactContainers(r),e.ui.ddmanager&&e.ui.ddmanager.drag(this,r),this._trigger("sort",r,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(r,u){if(r){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,r),this.options.revert){var f=this;u=this.placeholder.offset();var m=this.options.axis,b={};m&&"x"!==m||(b.left=u.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),m&&"y"!==m||(b.top=u.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(b,parseInt(this.options.revert,10)||500,function(){f._clear(r)})}else this._clear(r,u);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new e.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var r=this.containers.length-1;0<=r;r--)this.containers[r]._trigger("deactivate",null,this._uiHash(this)),this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",null,this._uiHash(this)),this.containers[r].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(r){var u=this._getItemsAsjQuery(r&&r.connected),f=[];return r=r||{},e(u).each(function(){var m=(e(r.item||this).attr(r.attribute||"id")||"").match(r.expression||/(.+)[\-=_](.+)/);m&&f.push((r.key||m[1]+"[]")+"="+(r.key&&r.expression?m[1]:m[2]))}),!f.length&&r.key&&f.push(r.key+"="),f.join("&")},toArray:function(r){var u=this._getItemsAsjQuery(r&&r.connected),f=[];return r=r||{},u.each(function(){f.push(e(r.item||this).attr(r.attribute||"id")||"")}),f},_intersectsWith:function(r){var u=this.positionAbs.left,m=this.positionAbs.top,w=r.left,A=w+r.width,x=r.top,y=x+r.height,S=this.offset.click.top,_=this.offset.click.left;return S="x"===this.options.axis||m+S>x&&m+S<y,_="y"===this.options.axis||u+_>w&&u+_<A,"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>r[this.floating?"width":"height"]?S&&_:w<u+this.helperProportions.width/2&&u+this.helperProportions.width-this.helperProportions.width/2<A&&x<m+this.helperProportions.height/2&&m+this.helperProportions.height-this.helperProportions.height/2<y},_intersectsWithPointer:function(r){var u="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,r.top,r.height);return r="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,r.left,r.width),!(!u||!r)&&(u=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection(),this.floating?"right"===r||"down"===u?2:1:u&&("down"===u?2:1))},_intersectsWithSides:function(r){var u=this._isOverAxis(this.positionAbs.top+this.offset.click.top,r.top+r.height/2,r.height);r=this._isOverAxis(this.positionAbs.left+this.offset.click.left,r.left+r.width/2,r.width);var f=this._getDragVerticalDirection(),m=this._getDragHorizontalDirection();return this.floating&&m?"right"===m&&r||"left"===m&&!r:f&&("down"===f&&u||"up"===f&&!u)},_getDragVerticalDirection:function(){var r=this.positionAbs.top-this.lastPositionAbs.top;return 0!==r&&(0<r?"down":"up")},_getDragHorizontalDirection:function(){var r=this.positionAbs.left-this.lastPositionAbs.left;return 0!==r&&(0<r?"right":"left")},refresh:function(r){return this._refreshItems(r),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var r=this.options;return r.connectWith.constructor===String?[r.connectWith]:r.connectWith},_getItemsAsjQuery:function(r){function u(){b.push(this)}var f,m,b=[],w=[],A=this._connectWith();if(A&&r)for(r=A.length-1;0<=r;r--){var x=e(A[r],this.document[0]);for(f=x.length-1;0<=f;f--)(m=e.data(x[f],this.widgetFullName))&&m!==this&&!m.options.disabled&&w.push([e.isFunction(m.options.items)?m.options.items.call(m.element):e(m.options.items,m.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),m])}for(w.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=w.length-1;0<=r;r--)w[r][0].each(u);return e(b)},_removeCurrentsFromItems:function(){var r=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(u){for(var f=0;f<r.length;f++)if(r[f]===u.item[0])return!1;return!0})},_refreshItems:function(r){this.items=[],this.containers=[this];var u,f,m,b,w=this.items,A=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],r,{item:this.currentItem}):e(this.options.items,this.element),this]];if((b=this._connectWith())&&this.ready)for(u=b.length-1;0<=u;u--){var x=e(b[u],this.document[0]);for(f=x.length-1;0<=f;f--)(m=e.data(x[f],this.widgetFullName))&&m!==this&&!m.options.disabled&&(A.push([e.isFunction(m.options.items)?m.options.items.call(m.element[0],r,{item:this.currentItem}):e(m.options.items,m.element),m]),this.containers.push(m))}for(u=A.length-1;0<=u;u--)for(r=A[u][1],f=0,b=(x=A[u][0]).length;f<b;f++)(m=e(x[f])).data(this.widgetName+"-item",r),w.push({item:m,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(r){var u;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),u=this.items.length-1;0<=u;u--){var f=this.items[u];if(f.instance===this.currentContainer||!this.currentContainer||f.item[0]===this.currentItem[0]){var m=this.options.toleranceElement?e(this.options.toleranceElement,f.item):f.item;r||(f.width=m.outerWidth(),f.height=m.outerHeight()),m=m.offset(),f.left=m.left,f.top=m.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(u=this.containers.length-1;0<=u;u--)m=this.containers[u].element.offset(),this.containers[u].containerCache.left=m.left,this.containers[u].containerCache.top=m.top,this.containers[u].containerCache.width=this.containers[u].element.outerWidth(),this.containers[u].containerCache.height=this.containers[u].element.outerHeight();return this},_createPlaceholder:function(r){var u=(r=r||this).options;if(!u.placeholder||u.placeholder.constructor===String){var f=u.placeholder;u.placeholder={element:function(){var m=r.currentItem[0].nodeName.toLowerCase(),b=e("<"+m+">",r.document[0]);return r._addClass(b,"ui-sortable-placeholder",f||r.currentItem[0].className)._removeClass(b,"ui-sortable-helper"),"tbody"===m?r._createTrPlaceholder(r.currentItem.find("tr").eq(0),e("<tr>",r.document[0]).appendTo(b)):"tr"===m?r._createTrPlaceholder(r.currentItem,b):"img"===m&&b.attr("src",r.currentItem.attr("src")),f||b.css("visibility","hidden"),b},update:function(m,b){(!f||u.forcePlaceholderSize)&&(b.height()||b.height(r.currentItem.innerHeight()-parseInt(r.currentItem.css("paddingTop")||0,10)-parseInt(r.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(r.currentItem.innerWidth()-parseInt(r.currentItem.css("paddingLeft")||0,10)-parseInt(r.currentItem.css("paddingRight")||0,10)))}}}r.placeholder=e(u.placeholder.element.call(r.element,r.currentItem)),r.currentItem.after(r.placeholder),u.placeholder.update(r,r.placeholder)},_createTrPlaceholder:function(r,u){var f=this;r.children().each(function(){e("<td>&#160;</td>",f.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(u)})},_contactContainers:function(r){var u,f,m,b=m=null;for(u=this.containers.length-1;0<=u;u--)e.contains(this.currentItem[0],this.containers[u].element[0])||(this._intersectsWith(this.containers[u].containerCache)?m&&e.contains(this.containers[u].element[0],m.element[0])||(m=this.containers[u],b=u):this.containers[u].containerCache.over&&(this.containers[u]._trigger("out",r,this._uiHash(this)),this.containers[u].containerCache.over=0));if(m)if(1===this.containers.length)this.containers[b].containerCache.over||(this.containers[b]._trigger("over",r,this._uiHash(this)),this.containers[b].containerCache.over=1);else{u=1e4;var w=null;m=(f=m.floating||this._isFloating(this.currentItem))?"left":"top";var A=f?"width":"height",x=f?"pageX":"pageY";for(f=this.items.length-1;0<=f;f--)if(e.contains(this.containers[b].element[0],this.items[f].item[0])&&this.items[f].item[0]!==this.currentItem[0]){var y=this.items[f].item.offset()[m],S=!1;r[x]-y>this.items[f][A]/2&&(S=!0),Math.abs(r[x]-y)<u&&(u=Math.abs(r[x]-y),w=this.items[f],this.direction=S?"up":"down")}(w||this.options.dropOnEmpty)&&(this.currentContainer===this.containers[b]?this.currentContainer.containerCache.over||(this.containers[b]._trigger("over",r,this._uiHash()),this.currentContainer.containerCache.over=1):(w?this._rearrange(r,w,null,!0):this._rearrange(r,null,this.containers[b].element,!0),this._trigger("change",r,this._uiHash()),this.containers[b]._trigger("change",r,this._uiHash(this)),this.currentContainer=this.containers[b],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[b]._trigger("over",r,this._uiHash(this)),this.containers[b].containerCache.over=1))}},_createHelper:function(r){var u=this.options;return(r=e.isFunction(u.helper)?e(u.helper.apply(this.element[0],[r,this.currentItem])):"clone"===u.helper?this.currentItem.clone():this.currentItem).parents("body").length||e("parent"!==u.appendTo?u.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),r[0].style.width&&!u.forceHelperSize||r.width(this.currentItem.width()),r[0].style.height&&!u.forceHelperSize||r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(r){"string"==typeof r&&(r=r.split(" ")),e.isArray(r)&&(r={left:+r[0],top:+r[1]||0}),"left"in r&&(this.offset.click.left=r.left+this.margins.left),"right"in r&&(this.offset.click.left=this.helperProportions.width-r.right+this.margins.left),"top"in r&&(this.offset.click.top=r.top+this.margins.top),"bottom"in r&&(this.offset.click.top=this.helperProportions.height-r.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var r=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(r.left+=this.scrollParent.scrollLeft(),r.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(r={top:0,left:0}),{top:r.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:r.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var r=this.currentItem.position();return{top:r.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:r.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var r=this.options;if("parent"===r.containment&&(r.containment=this.helper[0].parentNode),("document"===r.containment||"window"===r.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===r.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===r.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(r.containment)){var u=e(r.containment)[0];r=e(r.containment).offset();var f="hidden"!==e(u).css("overflow");this.containment=[r.left+(parseInt(e(u).css("borderLeftWidth"),10)||0)+(parseInt(e(u).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(u).css("borderTopWidth"),10)||0)+(parseInt(e(u).css("paddingTop"),10)||0)-this.margins.top,r.left+(f?Math.max(u.scrollWidth,u.offsetWidth):u.offsetWidth)-(parseInt(e(u).css("borderLeftWidth"),10)||0)-(parseInt(e(u).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(f?Math.max(u.scrollHeight,u.offsetHeight):u.offsetHeight)-(parseInt(e(u).css("borderTopWidth"),10)||0)-(parseInt(e(u).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(r,u){u||(u=this.position),r="absolute"===r?1:-1;var f="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,m=/(html|body)/i.test(f[0].tagName);return{top:u.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():m?0:f.scrollTop())*r,left:u.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():m?0:f.scrollLeft())*r}},_generatePosition:function(r){var u=this.options,f=r.pageX,m=r.pageY,b="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,w=/(html|body)/i.test(b[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(r.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),r.pageY-this.offset.click.top<this.containment[1]&&(m=this.containment[1]+this.offset.click.top),r.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),r.pageY-this.offset.click.top>this.containment[3]&&(m=this.containment[3]+this.offset.click.top)),u.grid&&(m=this.originalPageY+Math.round((m-this.originalPageY)/u.grid[1])*u.grid[1],m=this.containment?m-this.offset.click.top>=this.containment[1]&&m-this.offset.click.top<=this.containment[3]?m:m-this.offset.click.top>=this.containment[1]?m-u.grid[1]:m+u.grid[1]:m,f=this.originalPageX+Math.round((f-this.originalPageX)/u.grid[0])*u.grid[0],f=this.containment?f-this.offset.click.left>=this.containment[0]&&f-this.offset.click.left<=this.containment[2]?f:f-this.offset.click.left>=this.containment[0]?f-u.grid[0]:f+u.grid[0]:f)),{top:m-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():w?0:b.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():w?0:b.scrollLeft())}},_rearrange:function(r,u,f,m){f?f[0].appendChild(this.placeholder[0]):u.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?u.item[0]:u.item[0].nextSibling);var b=this.counter=this.counter?++this.counter:1;this._delay(function(){b===this.counter&&this.refreshPositions(!m)})},_clear:function(r,u){function f(w,A,x){return function(y){x._trigger(w,y,A._uiHash(A))}}this.reverting=!1;var m,b=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(m in this._storedCSS)("auto"===this._storedCSS[m]||"static"===this._storedCSS[m])&&(this._storedCSS[m]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!u&&b.push(function(w){this._trigger("receive",w,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||u||b.push(function(w){this._trigger("update",w,this._uiHash())}),this===this.currentContainer||u||(b.push(function(w){this._trigger("remove",w,this._uiHash())}),b.push(function(w){return function(A){w._trigger("receive",A,this._uiHash(this))}}.call(this,this.currentContainer)),b.push(function(w){return function(A){w._trigger("update",A,this._uiHash(this))}}.call(this,this.currentContainer))),m=this.containers.length-1;0<=m;m--)u||b.push(f("deactivate",this,this.containers[m])),this.containers[m].containerCache.over&&(b.push(f("out",this,this.containers[m])),this.containers[m].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,u||this._trigger("beforeStop",r,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!u){for(m=0;m<b.length;m++)b[m].call(this,r);this._trigger("stop",r,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(r){var u=r||this;return{helper:u.helper,placeholder:u.placeholder||e([]),position:u.position,originalPosition:u.originalPosition,offset:u.positionAbs,item:u.currentItem,sender:r?r.element:null}}}),e.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var r=this.options;this.prevShow=this.prevHide=e(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),r.collapsible||!1!==r.active&&null!=r.active||(r.active=0),this._processPanels(),0>r.active&&(r.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var r=this.options.icons;if(r){var u=e("<span>");this._addClass(u,"ui-accordion-header-icon","ui-icon "+r.header),u.prependTo(this.headers),u=this.active.children(".ui-accordion-header-icon"),this._removeClass(u,r.header)._addClass(u,null,r.activeHeader)._addClass(this.headers,"ui-accordion-icons")}},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons();var r=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId();"content"!==this.options.heightStyle&&r.css("height","")},_setOption:function(r,u){"active"===r?this._activate(u):("event"===r&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(u)),this._super(r,u),"collapsible"!==r||u||!1!==this.options.active||this._activate(0),"icons"===r&&(this._destroyIcons(),u&&this._createIcons()))},_setOptionDisabled:function(r){this._super(r),this.element.attr("aria-disabled",r),this._toggleClass(null,"ui-state-disabled",!!r),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!r)},_keydown:function(r){if(!r.altKey&&!r.ctrlKey){var u=e.ui.keyCode,f=this.headers.length,m=this.headers.index(r.target),b=!1;switch(r.keyCode){case u.RIGHT:case u.DOWN:b=this.headers[(m+1)%f];break;case u.LEFT:case u.UP:b=this.headers[(m-1+f)%f];break;case u.SPACE:case u.ENTER:this._eventHandler(r);break;case u.HOME:b=this.headers[0];break;case u.END:b=this.headers[f-1]}b&&(e(r.target).attr("tabIndex",-1),e(b).attr("tabIndex",0),e(b).trigger("focus"),r.preventDefault())}},_panelKeyDown:function(r){r.keyCode===e.ui.keyCode.UP&&r.ctrlKey&&e(r.currentTarget).prev().trigger("focus")},refresh:function(){var r=this.options;this._processPanels(),!1===r.active&&!0===r.collapsible||!this.headers.length?(r.active=!1,this.active=e()):!1===r.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(r.active=!1,this.active=e()):this._activate(Math.max(0,r.active-1)):r.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var r=this.headers,u=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),u&&(this._off(r.not(this.headers)),this._off(u.not(this.panels)))},_refresh:function(){var r=this.options,u=r.heightStyle,f=this.element.parent();if(this.active=this._findActive(r.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var b=e(this),w=b.uniqueId().attr("id"),A=b.next(),x=A.uniqueId().attr("id");b.attr("aria-controls",x),A.attr("aria-labelledby",w)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(r.event),"fill"===u){var m=f.height();this.element.siblings(":visible").each(function(){var b=e(this),w=b.css("position");"absolute"!==w&&"fixed"!==w&&(m-=b.outerHeight(!0))}),this.headers.each(function(){m-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,m-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")}else"auto"===u&&(m=0,this.headers.next().each(function(){var b=e(this).is(":visible");b||e(this).show(),m=Math.max(m,e(this).css("height","").height()),b||e(this).hide()}).height(m))},_activate:function(r){(r=this._findActive(r)[0])!==this.active[0]&&this._eventHandler({target:r=r||this.active[0],currentTarget:r,preventDefault:e.noop})},_findActive:function(r){return"number"==typeof r?this.headers.eq(r):e()},_setupEvents:function(r){var u={keydown:"_keydown"};r&&e.each(r.split(" "),function(f,m){u[m]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,u),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(r){var u,f=this.options,m=this.active,b=e(r.currentTarget),w=(u=b[0]===m[0])&&f.collapsible,A=w?e():b.next(),x=m.next();A={oldHeader:m,oldPanel:x,newHeader:w?e():b,newPanel:A},r.preventDefault(),u&&!f.collapsible||!1===this._trigger("beforeActivate",r,A)||(f.active=!w&&this.headers.index(b),this.active=u?e():b,this._toggle(A),this._removeClass(m,"ui-accordion-header-active","ui-state-active"),f.icons&&(r=m.children(".ui-accordion-header-icon"),this._removeClass(r,null,f.icons.activeHeader)._addClass(r,null,f.icons.header)),u||(this._removeClass(b,"ui-accordion-header-collapsed")._addClass(b,"ui-accordion-header-active","ui-state-active"),f.icons&&(u=b.children(".ui-accordion-header-icon"),this._removeClass(u,null,f.icons.header)._addClass(u,null,f.icons.activeHeader)),this._addClass(b.next(),"ui-accordion-content-active")))},_toggle:function(r){var u=r.newPanel,f=this.prevShow.length?this.prevShow:r.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=u,this.prevHide=f,this.options.animate?this._animate(u,f,r):(f.hide(),u.show(),this._toggleComplete(r)),f.attr({"aria-hidden":"true"}),f.prev().attr({"aria-selected":"false","aria-expanded":"false"}),u.length&&f.length?f.prev().attr({tabIndex:-1,"aria-expanded":"false"}):u.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),u.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(r,u,f){var m,b,w=this,A=0,x=r.css("box-sizing"),y=r.length&&(!u.length||r.index()<u.index()),S=this.options.animate||{},_=function(){w._toggleComplete(f)};if("number"==typeof(y=y&&S.down||S)&&(b=y),"string"==typeof y&&(m=y),m=m||y.easing||S.easing,b=b||y.duration||S.duration,!u.length)return r.animate(this.showProps,b,m,_);if(!r.length)return u.animate(this.hideProps,b,m,_);var C=r.show().outerHeight();u.animate(this.hideProps,{duration:b,easing:m,step:function(I,L){L.now=Math.round(I)}}),r.hide().animate(this.showProps,{duration:b,easing:m,complete:_,step:function(I,L){L.now=Math.round(I),"height"!==L.prop?"content-box"===x&&(A+=L.now):"content"!==w.options.heightStyle&&(L.now=Math.round(C-u.outerHeight()-A),A=0)}})},_toggleComplete:function(r){var u=r.oldPanel,f=u.prev();this._removeClass(u,"ui-accordion-content-active"),this._removeClass(f,"ui-accordion-header-active")._addClass(f,"ui-accordion-header-collapsed"),u.length&&(u.parent()[0].className=u.parent()[0].className),this._trigger("activate",null,r)}}),e.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(r){r.preventDefault()},"click .ui-menu-item":function(r){var u=e(r.target),f=e(e.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&u.not(".ui-state-disabled").length&&(this.select(r),r.isPropagationStopped()||(this.mouseHandled=!0),u.has(".ui-menu").length?this.expand(r):!this.element.is(":focus")&&f.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(r){if(!this.previousFilter){var u=e(r.target).closest(".ui-menu-item"),f=e(r.currentTarget);u[0]===f[0]&&(this._removeClass(f.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(r,f))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(r,u){var f=this.active||this.element.find(this.options.items).eq(0);u||this.focus(r,f)},blur:function(r){this._delay(function(){e.contains(this.element[0],e.ui.safeActiveElement(this.document[0]))||this.collapseAll(r)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(r){this._closeOnDocumentClick(r)&&this.collapseAll(r),this.mouseHandled=!1}})},_destroy:function(){var r=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),r.children().each(function(){var u=e(this);u.data("ui-menu-submenu-caret")&&u.remove()})},_keydown:function(r){var u=!0;switch(r.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(r);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(r);break;case e.ui.keyCode.HOME:this._move("first","first",r);break;case e.ui.keyCode.END:this._move("last","last",r);break;case e.ui.keyCode.UP:this.previous(r);break;case e.ui.keyCode.DOWN:this.next(r);break;case e.ui.keyCode.LEFT:this.collapse(r);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(r);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(r);break;case e.ui.keyCode.ESCAPE:this.collapse(r);break;default:u=!1;var f=this.previousFilter||"",m=!1,b=96<=r.keyCode&&105>=r.keyCode?(r.keyCode-96).toString():String.fromCharCode(r.keyCode);clearTimeout(this.filterTimer),b===f?m=!0:b=f+b,f=this._filterMenuItems(b),(f=m&&-1!==f.index(this.active.next())?this.active.nextAll(".ui-menu-item"):f).length||(b=String.fromCharCode(r.keyCode),f=this._filterMenuItems(b)),f.length?(this.focus(r,f),this.previousFilter=b,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}u&&r.preventDefault()},_activate:function(r){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(r):this.select(r))},refresh:function(){var r=this,u=this.options.icons.submenu,f=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length);var m=f.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var w=e(this),A=w.prev(),x=e("<span>").data("ui-menu-submenu-caret",!0);r._addClass(x,"ui-menu-icon","ui-icon "+u),A.attr("aria-haspopup","true").prepend(x),w.attr("aria-labelledby",A.attr("id"))});this._addClass(m,"ui-menu","ui-widget ui-widget-content ui-front"),(m=f.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var w=e(this);r._isDivider(w)&&r._addClass(w,"ui-menu-divider","ui-widget-content")});var b=(f=m.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()});this._addClass(f,"ui-menu-item")._addClass(b,"ui-menu-item-wrapper"),m.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(r,u){if("icons"===r){var f=this.element.find(".ui-menu-icon");this._removeClass(f,null,this.options.icons.submenu)._addClass(f,null,u.submenu)}this._super(r,u)},_setOptionDisabled:function(r){this._super(r),this.element.attr("aria-disabled",String(r)),this._toggleClass(null,"ui-state-disabled",!!r)},focus:function(r,u){this.blur(r,r&&"focus"===r.type),this._scrollIntoView(u),this.active=u.first();var f=this.active.children(".ui-menu-item-wrapper");this._addClass(f,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",f.attr("id")),f=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(f,null,"ui-state-active"),r&&"keydown"===r.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(f=u.children(".ui-menu")).length&&r&&/^mouse/.test(r.type)&&this._startOpening(f),this.activeMenu=u.parent(),this._trigger("focus",r,{item:u})},_scrollIntoView:function(r){if(this._hasScroll()){var u=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,f=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0;u=r.offset().top-this.activeMenu.offset().top-u-f,f=this.activeMenu.scrollTop();var m=this.activeMenu.height();r=r.outerHeight(),0>u?this.activeMenu.scrollTop(f+u):u+r>m&&this.activeMenu.scrollTop(f+u-m+r)}},blur:function(r,u){u||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",r,{item:this.active}),this.active=null)},_startOpening:function(r){clearTimeout(this.timer),"true"===r.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(r)},this.delay))},_open:function(r){var u=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(r.parents(".ui-menu")).hide().attr("aria-hidden","true"),r.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(u)},collapseAll:function(r,u){clearTimeout(this.timer),this.timer=this._delay(function(){var f=u?this.element:e(r&&r.target).closest(this.element.find(".ui-menu"));f.length||(f=this.element),this._close(f),this.blur(r),this._removeClass(f.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=f},this.delay)},_close:function(r){r||(r=this.active?this.active.parent():this.element),r.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(r){return!e(r.target).closest(".ui-menu").length},_isDivider:function(r){return!/[^\-\u2014\u2013\s]/.test(r.text())},collapse:function(r){var u=this.active&&this.active.parent().closest(".ui-menu-item",this.element);u&&u.length&&(this._close(),this.focus(r,u))},expand:function(r){var u=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();u&&u.length&&(this._open(u.parent()),this._delay(function(){this.focus(r,u)}))},next:function(r){this._move("next","first",r)},previous:function(r){this._move("prev","last",r)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(r,u,f){var m;this.active&&(m="first"===r||"last"===r?this.active["first"===r?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[r+"All"](".ui-menu-item").eq(0)),m&&m.length&&this.active||(m=this.activeMenu.find(this.options.items)[u]()),this.focus(f,m)},nextPage:function(r){var u;if(this.active){if(!this.isLastItem())if(this._hasScroll()){var f=this.active.offset().top,m=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){return 0>(u=e(this)).offset().top-f-m}),this.focus(r,u)}else this.focus(r,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())}else this.next(r)},previousPage:function(r){var u;if(this.active){if(!this.isFirstItem())if(this._hasScroll()){var f=this.active.offset().top,m=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){return 0<(u=e(this)).offset().top-f+m}),this.focus(r,u)}else this.focus(r,this.activeMenu.find(this.options.items).first())}else this.next(r)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(r){this.active=this.active||e(r.target).closest(".ui-menu-item");var u={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(r,!0),this._trigger("select",r,u)},_filterMenuItems:function(r){r=r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");var u=new RegExp("^"+r,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return u.test(e.trim(e(this).children(".ui-menu-item-wrapper").text()))})}}),e.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var r,u,f,m=this.element[0].nodeName.toLowerCase(),b="textarea"===m;m="input"===m,this.isMultiLine=b||!m&&this._isContentEditable(this.element),this.valueMethod=this.element[b||m?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(w){if(this.element.prop("readOnly"))u=f=r=!0;else{u=f=r=!1;var A=e.ui.keyCode;switch(w.keyCode){case A.PAGE_UP:r=!0,this._move("previousPage",w);break;case A.PAGE_DOWN:r=!0,this._move("nextPage",w);break;case A.UP:r=!0,this._keyEvent("previous",w);break;case A.DOWN:r=!0,this._keyEvent("next",w);break;case A.ENTER:this.menu.active&&(r=!0,w.preventDefault(),this.menu.select(w));break;case A.TAB:this.menu.active&&this.menu.select(w);break;case A.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(w),w.preventDefault());break;default:u=!0,this._searchTimeout(w)}}},keypress:function(w){if(r)r=!1,this.isMultiLine&&!this.menu.element.is(":visible")||w.preventDefault();else if(!u){var A=e.ui.keyCode;switch(w.keyCode){case A.PAGE_UP:this._move("previousPage",w);break;case A.PAGE_DOWN:this._move("nextPage",w);break;case A.UP:this._keyEvent("previous",w);break;case A.DOWN:this._keyEvent("next",w)}}},input:function(w){f?(f=!1,w.preventDefault()):this._searchTimeout(w)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(w){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(w),this._change(w))}}),this._initSource(),this.menu=e("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(w){w.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==e.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(w,A){if(this.isNewMenu&&(this.isNewMenu=!1,w.originalEvent&&/^mouse/.test(w.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(w.target).trigger(w.originalEvent)});var x=A.item.data("ui-autocomplete-item");!1!==this._trigger("focus",w,{item:x})&&w.originalEvent&&/^key/.test(w.originalEvent.type)&&this._value(x.value),(A=A.item.attr("aria-label")||x.value)&&e.trim(A).length&&(this.liveRegion.children().hide(),e("<div>").text(A).appendTo(this.liveRegion))},menuselect:function(w,A){var x=A.item.data("ui-autocomplete-item"),y=this.previous;this.element[0]!==e.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=y,this._delay(function(){this.previous=y,this.selectedItem=x})),!1!==this._trigger("select",w,{item:x})&&this._value(x.value),this.term=this._value(),this.close(w),this.selectedItem=x}}),this.liveRegion=e("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(r,u){this._super(r,u),"source"===r&&this._initSource(),"appendTo"===r&&this.menu.element.appendTo(this._appendTo()),"disabled"===r&&u&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(r){var u=this.menu.element[0];return r.target===this.element[0]||r.target===u||e.contains(u,r.target)},_closeOnClickOutside:function(r){this._isEventTargetInWidget(r)||this.close()},_appendTo:function(){var r=this.options.appendTo;return r&&(r=r.jquery||r.nodeType?e(r):this.document.find(r).eq(0)),r&&r[0]||(r=this.element.closest(".ui-front, dialog")),r.length||(r=this.document[0].body),r},_initSource:function(){var r=this;if(e.isArray(this.options.source)){var u=this.options.source;this.source=function(m,b){b(e.ui.autocomplete.filter(u,m.term))}}else if("string"==typeof this.options.source){var f=this.options.source;this.source=function(m,b){r.xhr&&r.xhr.abort(),r.xhr=e.ajax({url:f,data:m,dataType:"json",success:function(w){b(w)},error:function(){b([])}})}}else this.source=this.options.source},_searchTimeout:function(r){clearTimeout(this.searching),this.searching=this._delay(function(){var u=this.term===this._value(),f=this.menu.element.is(":visible");(!u||u&&!f&&!(r.altKey||r.ctrlKey||r.metaKey||r.shiftKey))&&(this.selectedItem=null,this.search(null,r))},this.options.delay)},search:function(r,u){return r=r??this._value(),this.term=this._value(),r.length<this.options.minLength?this.close(u):!1!==this._trigger("search",u)?this._search(r):void 0},_search:function(r){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:r},this._response())},_response:function(){var r=++this.requestIndex;return e.proxy(function(u){r===this.requestIndex&&this.__response(u),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(r){r&&(r=this._normalize(r)),this._trigger("response",null,{content:r}),!this.options.disabled&&r&&r.length&&!this.cancelSearch?(this._suggest(r),this._trigger("open")):this._close()},close:function(r){this.cancelSearch=!0,this._close(r)},_close:function(r){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",r))},_change:function(r){this.previous!==this._value()&&this._trigger("change",r,{item:this.selectedItem})},_normalize:function(r){return r.length&&r[0].label&&r[0].value?r:e.map(r,function(u){return"string"==typeof u?{label:u,value:u}:e.extend({},u,{label:u.label||u.value,value:u.value||u.label})})},_suggest:function(r){var u=this.menu.element.empty();this._renderMenu(u,r),this.isNewMenu=!0,this.menu.refresh(),u.show(),this._resizeMenu(),u.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var r=this.menu.element;r.outerWidth(Math.max(r.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(r,u){var f=this;e.each(u,function(m,b){f._renderItemData(r,b)})},_renderItemData:function(r,u){return this._renderItem(r,u).data("ui-autocomplete-item",u)},_renderItem:function(r,u){return e("<li>").append(e("<div>").text(u.label)).appendTo(r)},_move:function(r,u){this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(r)||this.menu.isLastItem()&&/^next/.test(r)?(this.isMultiLine||this._value(this.term),this.menu.blur()):this.menu[r](u):this.search(null,u)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(r,u){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(r,u),u.preventDefault())},_isContentEditable:function(r){if(!r.length)return!1;var u=r.prop("contentEditable");return"inherit"===u?this._isContentEditable(r.parent()):"true"===u}}),e.extend(e.ui.autocomplete,{escapeRegex:function(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(r,u){var f=new RegExp(e.ui.autocomplete.escapeRegex(u),"i");return e.grep(r,function(m){return f.test(m.label||m.value||m)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(r){return r+(1<r?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(r){if(this._superApply(arguments),!this.options.disabled&&!this.cancelSearch){var u=r&&r.length?this.options.messages.results(r.length):this.options.messages.noResults;this.liveRegion.children().hide(),e("<div>").text(u).appendTo(this.liveRegion)}}});var v,g=/ui-corner-([a-z]){2,6}/g;e.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var r=this,u=[];e.each(this.options.items,function(f,m){var b={};m&&("controlgroupLabel"===f?((m=r.element.find(m)).each(function(){var w=e(this);w.children(".ui-controlgroup-label-contents").length||w.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),r._addClass(m,null,"ui-widget ui-widget-content ui-state-default"),u=u.concat(m.get())):e.fn[f]&&(b=r["_"+f+"Options"]?r["_"+f+"Options"]("middle"):{classes:{}},r.element.find(m).each(function(){var w=e(this),A=w[f]("instance"),x=e.widget.extend({},b);"button"===f&&w.parent(".ui-spinner").length||(A||(A=w[f]()[f]("instance")),A&&(x.classes=r._resolveClassesValues(x.classes,A)),w[f](x),x=w[f]("widget"),e.data(x[0],"ui-controlgroup-data",A||w[f]("instance")),u.push(x[0]))})))}),this.childWidgets=e(e.unique(u)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(r){this.childWidgets.each(function(){var u=e(this).data("ui-controlgroup-data");u&&u[r]&&u[r]()})},_updateCornerClass:function(r,u){u=this._buildSimpleOptions(u,"label").classes.label,this._removeClass(r,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(r,null,u)},_buildSimpleOptions:function(r,u){var f="vertical"===this.options.direction,m={classes:{}};return m.classes[u]={middle:"",first:"ui-corner-"+(f?"top":"left"),last:"ui-corner-"+(f?"bottom":"right"),only:"ui-corner-all"}[r],m},_spinnerOptions:function(r){return(r=this._buildSimpleOptions(r,"ui-spinner")).classes["ui-spinner-up"]="",r.classes["ui-spinner-down"]="",r},_buttonOptions:function(r){return this._buildSimpleOptions(r,"ui-button")},_checkboxradioOptions:function(r){return this._buildSimpleOptions(r,"ui-checkboxradio-label")},_selectmenuOptions:function(r){var u="vertical"===this.options.direction;return{width:!!u&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(u?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(u?"top":"left")},last:{"ui-selectmenu-button-open":u?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(u?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[r]}},_resolveClassesValues:function(r,u){var f={};return e.each(r,function(m){var b=u.options.classes[m]||"";b=e.trim(b.replace(g,"")),f[m]=(b+" "+r[m]).replace(/\s+/g," ")}),f},_setOption:function(r,u){"direction"===r&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(r,u),"disabled"===r?this._callChildMethod(u?"disable":"enable"):this.refresh()},refresh:function(){var r=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets();var u=this.childWidgets;this.options.onlyVisible&&(u=u.filter(":visible")),u.length&&(e.each(["first","last"],function(f,m){(f=u[m]().data("ui-controlgroup-data"))&&r["_"+f.widgetName+"Options"]?((m=r["_"+f.widgetName+"Options"](1===u.length?"only":m)).classes=r._resolveClassesValues(m.classes,f),f.element[f.widgetName](m)):r._updateCornerClass(u[m](),m)}),this._callChildMethod("refresh"))}}),e.widget("ui.checkboxradio",[e.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var r=this,u=this._super()||{};this._readType();var f=this.element.labels();return this.label=e(f[f.length-1]),this.label.length||e.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){r.originalLabel+=3===this.nodeType?e(this).text():this.outerHTML}),this.originalLabel&&(u.label=this.originalLabel),null!=(f=this.element[0].disabled)&&(u.disabled=f),u},_create:function(){var r=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),r&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var r=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===r&&/radio|checkbox/.test(this.type)||e.error("Can't create checkboxradio on element.nodeName="+r+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var r=this.element[0].name,u="input[name='"+e.ui.escapeSelector(r)+"']";return r?(this.form.length?e(this.form[0].elements).filter(u):e(u).filter(function(){return 0===e(this).form().length})).not(this.element):e([])},_toggleClasses:function(){var r=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",r),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",r)._toggleClass(this.icon,null,"ui-icon-blank",!r),"radio"===this.type&&this._getRadioGroup().each(function(){var u=e(this).checkboxradio("instance");u&&u._removeClass(u.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(r,u){("label"!==r||u)&&(this._super(r,u),"disabled"===r?(this._toggleClass(this.label,null,"ui-state-disabled",u),this.element[0].disabled=u):this.refresh())},_updateIcon:function(r){var u="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=e("<span>"),this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(u+=r?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,r?"ui-icon-blank":"ui-icon-check")):u+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",u),r||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var r=this.label.contents().not(this.element[0]);this.icon&&(r=r.not(this.icon[0])),this.iconSpace&&(r=r.not(this.iconSpace[0])),r.remove(),this.label.append(this.options.label)},refresh:function(){var r=this.element[0].checked,u=this.element[0].disabled;this._updateIcon(r),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",r),null!==this.options.label&&this._updateLabel(),u!==this.options.disabled&&this._setOptions({disabled:u})}}]),e.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var r=this._super()||{};this.isInput=this.element.is("input");var u=this.element[0].disabled;return null!=u&&(r.disabled=u),(this.originalLabel=this.isInput?this.element.val():this.element.html())&&(r.label=this.originalLabel),r},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(r){r.keyCode===e.ui.keyCode.SPACE&&(r.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(r,u){var f=(r="iconPosition"!==r)?this.options.iconPosition:u,m="top"===f||"bottom"===f;this.icon?r&&this._removeClass(this.icon,null,this.options.icon):(this.icon=e("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),r&&this._addClass(this.icon,null,u),this._attachIcon(f),m?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(f))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(r){this.icon[/^(?:end|bottom)/.test(r)?"before":"after"](this.iconSpace)},_attachIcon:function(r){this.element[/^(?:end|bottom)/.test(r)?"append":"prepend"](this.icon)},_setOptions:function(r){(void 0===r.showLabel?this.options.showLabel:r.showLabel)||(void 0===r.icon?this.options.icon:r.icon)||(r.showLabel=!0),this._super(r)},_setOption:function(r,u){"icon"===r&&(u?this._updateIcon(r,u):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===r&&this._updateIcon(r,u),"showLabel"===r&&(this._toggleClass("ui-button-icon-only",null,!u),this._updateTooltip()),"label"===r&&(this.isInput?this.element.val(u):(this.element.html(u),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(r,u),"disabled"===r&&(this._toggleClass(null,"ui-state-disabled",u),(this.element[0].disabled=u)&&this.element.blur())},refresh:function(){var r=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");r!==this.options.disabled&&this._setOptions({disabled:r}),this._updateTooltip()}}),!1!==e.uiBackCompat&&(e.widget("ui.button",e.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(r,u){"text"===r?this._super("showLabel",u):("showLabel"===r&&(this.options.text=u),"icon"===r&&(this.options.icons.primary=u),"icons"===r&&(u.primary?(this._super("icon",u.primary),this._super("iconPosition","beginning")):u.secondary&&(this._super("icon",u.secondary),this._super("iconPosition","end"))),this._superApply(arguments))}}),e.fn.button=function(r){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?r.apply(this,arguments):(e.ui.checkboxradio||e.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(e.fn.button),e.fn.buttonset=function(){return e.ui.controlgroup||e.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),e.extend(e.ui,{datepicker:{version:"1.12.1"}}),e.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(r){return a(this._defaults,r||{}),this},_attachDatepicker:function(r,u){var f=r.nodeName.toLowerCase(),m="div"===f||"span"===f;r.id||(this.uuid+=1,r.id="dp"+this.uuid);var b=this._newInst(e(r),m);b.settings=e.extend({},u||{}),"input"===f?this._connectDatepicker(r,b):m&&this._inlineDatepicker(r,b)},_newInst:function(r,u){return{id:r[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:r,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:u,dpDiv:u?o(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(r,u){var f=e(r);u.append=e([]),u.trigger=e([]),f.hasClass(this.markerClassName)||(this._attachments(f,u),f.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(u),e.data(r,"datepicker",u),u.settings.disabled&&this._disableDatepicker(r))},_attachments:function(r,u){var f=this._get(u,"appendText"),m=this._get(u,"isRTL");if(u.append&&u.append.remove(),f&&(u.append=e("<span class='"+this._appendClass+"'>"+f+"</span>"),r[m?"before":"after"](u.append)),r.off("focus",this._showDatepicker),u.trigger&&u.trigger.remove(),("focus"===(f=this._get(u,"showOn"))||"both"===f)&&r.on("focus",this._showDatepicker),"button"===f||"both"===f){f=this._get(u,"buttonText");var b=this._get(u,"buttonImage");u.trigger=e(this._get(u,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:b,alt:f,title:f}):e("<button type='button'></button>").addClass(this._triggerClass).html(b?e("<img/>").attr({src:b,alt:f,title:f}):f)),r[m?"before":"after"](u.trigger),u.trigger.on("click",function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===r[0]?e.datepicker._hideDatepicker():(e.datepicker._datepickerShowing&&e.datepicker._lastInput!==r[0]&&e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(r[0])),!1})}},_autoSize:function(r){if(this._get(r,"autoSize")&&!r.inline){var u,f,m,b=new Date(2009,11,20),w=this._get(r,"dateFormat");if(w.match(/[DM]/)){var A=function(x){for(m=f=u=0;m<x.length;m++)x[m].length>u&&(u=x[m].length,f=m);return f};b.setMonth(A(this._get(r,w.match(/MM/)?"monthNames":"monthNamesShort"))),b.setDate(A(this._get(r,w.match(/DD/)?"dayNames":"dayNamesShort"))+20-b.getDay())}r.input.attr("size",this._formatDate(r,b).length)}},_inlineDatepicker:function(r,u){var f=e(r);f.hasClass(this.markerClassName)||(f.addClass(this.markerClassName).append(u.dpDiv),e.data(r,"datepicker",u),this._setDate(u,this._getDefaultDate(u),!0),this._updateDatepicker(u),this._updateAlternate(u),u.settings.disabled&&this._disableDatepicker(r),u.dpDiv.css("display","block"))},_dialogDatepicker:function(r,u,f,m,b){if((r=this._dialogInst)||(this.uuid+=1,this._dialogInput=e("<input type='text' id='"+(r="dp"+this.uuid)+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),e("body").append(this._dialogInput),(r=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",r)),a(r.settings,m||{}),u=u&&u.constructor===Date?this._formatDate(r,u):u,this._dialogInput.val(u),this._pos=b?b.length?b:[b.pageX,b.pageY]:null,!this._pos){u=document.documentElement.clientWidth,m=document.documentElement.clientHeight,b=document.documentElement.scrollLeft||document.body.scrollLeft;var w=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[u/2-100+b,m/2-150+w]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),r.settings.onSelect=f,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",r),this},_destroyDatepicker:function(r){var u=e(r),f=e.data(r,"datepicker");if(u.hasClass(this.markerClassName)){var m=r.nodeName.toLowerCase();e.removeData(r,"datepicker"),"input"===m?(f.append.remove(),f.trigger.remove(),u.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):"div"!==m&&"span"!==m||u.removeClass(this.markerClassName).empty(),v===f&&(v=null)}},_enableDatepicker:function(r){var u=e(r),f=e.data(r,"datepicker");if(u.hasClass(this.markerClassName)){var m=r.nodeName.toLowerCase();"input"===m?(r.disabled=!1,f.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===m||"span"===m)&&((m=u.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),m.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(b){return b===r?null:b})}},_disableDatepicker:function(r){var u=e(r),f=e.data(r,"datepicker");if(u.hasClass(this.markerClassName)){var m=r.nodeName.toLowerCase();"input"===m?(r.disabled=!0,f.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===m||"span"===m)&&((m=u.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),m.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(b){return b===r?null:b}),this._disabledInputs[this._disabledInputs.length]=r}},_isDisabledDatepicker:function(r){if(!r)return!1;for(var u=0;u<this._disabledInputs.length;u++)if(this._disabledInputs[u]===r)return!0;return!1},_getInst:function(r){try{return e.data(r,"datepicker")}catch{throw"Missing instance data for this datepicker"}},_optionDatepicker:function(r,u,f){var m=this._getInst(r);if(2===arguments.length&&"string"==typeof u)return"defaults"===u?e.extend({},e.datepicker._defaults):m?"all"===u?e.extend({},m.settings):this._get(m,u):null;var b=u||{};if("string"==typeof u&&((b={})[u]=f),m){this._curInst===m&&this._hideDatepicker();var w=this._getDateDatepicker(r,!0),A=this._getMinMaxDate(m,"min"),x=this._getMinMaxDate(m,"max");a(m.settings,b),null!==A&&void 0!==b.dateFormat&&void 0===b.minDate&&(m.settings.minDate=this._formatDate(m,A)),null!==x&&void 0!==b.dateFormat&&void 0===b.maxDate&&(m.settings.maxDate=this._formatDate(m,x)),"disabled"in b&&(b.disabled?this._disableDatepicker(r):this._enableDatepicker(r)),this._attachments(e(r),m),this._autoSize(m),this._setDate(m,w),this._updateAlternate(m),this._updateDatepicker(m)}},_changeDatepicker:function(r,u,f){this._optionDatepicker(r,u,f)},_refreshDatepicker:function(r){(r=this._getInst(r))&&this._updateDatepicker(r)},_setDateDatepicker:function(r,u){(r=this._getInst(r))&&(this._setDate(r,u),this._updateDatepicker(r),this._updateAlternate(r))},_getDateDatepicker:function(r,u){return(r=this._getInst(r))&&!r.inline&&this._setDateFromField(r,u),r?this._getDate(r):null},_doKeyDown:function(r){var u=e.datepicker._getInst(r.target),f=!0,m=u.dpDiv.is(".ui-datepicker-rtl");if(u._keyEvent=!0,e.datepicker._datepickerShowing)switch(r.keyCode){case 9:e.datepicker._hideDatepicker(),f=!1;break;case 13:return(f=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",u.dpDiv))[0]&&e.datepicker._selectDay(r.target,u.selectedMonth,u.selectedYear,f[0]),(r=e.datepicker._get(u,"onSelect"))?(f=e.datepicker._formatDate(u),r.apply(u.input?u.input[0]:null,[f,u])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(r.target,r.ctrlKey?-e.datepicker._get(u,"stepBigMonths"):-e.datepicker._get(u,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(r.target,r.ctrlKey?+e.datepicker._get(u,"stepBigMonths"):+e.datepicker._get(u,"stepMonths"),"M");break;case 35:(r.ctrlKey||r.metaKey)&&e.datepicker._clearDate(r.target),f=r.ctrlKey||r.metaKey;break;case 36:(r.ctrlKey||r.metaKey)&&e.datepicker._gotoToday(r.target),f=r.ctrlKey||r.metaKey;break;case 37:(r.ctrlKey||r.metaKey)&&e.datepicker._adjustDate(r.target,m?1:-1,"D"),f=r.ctrlKey||r.metaKey,r.originalEvent.altKey&&e.datepicker._adjustDate(r.target,r.ctrlKey?-e.datepicker._get(u,"stepBigMonths"):-e.datepicker._get(u,"stepMonths"),"M");break;case 38:(r.ctrlKey||r.metaKey)&&e.datepicker._adjustDate(r.target,-7,"D"),f=r.ctrlKey||r.metaKey;break;case 39:(r.ctrlKey||r.metaKey)&&e.datepicker._adjustDate(r.target,m?-1:1,"D"),f=r.ctrlKey||r.metaKey,r.originalEvent.altKey&&e.datepicker._adjustDate(r.target,r.ctrlKey?+e.datepicker._get(u,"stepBigMonths"):+e.datepicker._get(u,"stepMonths"),"M");break;case 40:(r.ctrlKey||r.metaKey)&&e.datepicker._adjustDate(r.target,7,"D"),f=r.ctrlKey||r.metaKey;break;default:f=!1}else 36===r.keyCode&&r.ctrlKey?e.datepicker._showDatepicker(this):f=!1;f&&(r.preventDefault(),r.stopPropagation())},_doKeyPress:function(r){var u=e.datepicker._getInst(r.target);if(e.datepicker._get(u,"constrainInput")){u=e.datepicker._possibleChars(e.datepicker._get(u,"dateFormat"));var f=String.fromCharCode(r.charCode??r.keyCode);return r.ctrlKey||r.metaKey||" ">f||!u||-1<u.indexOf(f)}},_doKeyUp:function(r){if((r=e.datepicker._getInst(r.target)).input.val()!==r.lastVal)try{e.datepicker.parseDate(e.datepicker._get(r,"dateFormat"),r.input?r.input.val():null,e.datepicker._getFormatConfig(r))&&(e.datepicker._setDateFromField(r),e.datepicker._updateAlternate(r),e.datepicker._updateDatepicker(r))}catch{}return!0},_showDatepicker:function(r){if("input"!==(r=r.target||r).nodeName.toLowerCase()&&(r=e("input",r.parentNode)[0]),!e.datepicker._isDisabledDatepicker(r)&&e.datepicker._lastInput!==r){var u=e.datepicker._getInst(r);e.datepicker._curInst&&e.datepicker._curInst!==u&&(e.datepicker._curInst.dpDiv.stop(!0,!0),u&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0]));var f=(f=e.datepicker._get(u,"beforeShow"))?f.apply(r,[r,u]):{};if(!1!==f){a(u.settings,f),u.lastVal=null,e.datepicker._lastInput=r,e.datepicker._setDateFromField(u),e.datepicker._inDialog&&(r.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(r),e.datepicker._pos[1]+=r.offsetHeight);var m=!1;if(e(r).parents().each(function(){return!(m|="fixed"===e(this).css("position"))}),f={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,u.dpDiv.empty(),u.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(u),f=e.datepicker._checkOffset(u,f,m),u.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":m?"fixed":"absolute",display:"none",left:f.left+"px",top:f.top+"px"}),!u.inline){f=e.datepicker._get(u,"showAnim");var b=e.datepicker._get(u,"duration");u.dpDiv.css("z-index",function t(r){for(var u;r.length&&r[0]!==document;){if(("absolute"===(u=r.css("position"))||"relative"===u||"fixed"===u)&&(u=parseInt(r.css("zIndex"),10),!isNaN(u)&&0!==u))return u;r=r.parent()}return 0}(e(r))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[f]?u.dpDiv.show(f,e.datepicker._get(u,"showOptions"),b):u.dpDiv[f||"show"](f?b:null),e.datepicker._shouldFocusInput(u)&&u.input.trigger("focus"),e.datepicker._curInst=u}}}},_updateDatepicker:function(r){this.maxRows=4,v=r,r.dpDiv.empty().append(this._generateHTML(r)),this._attachHandlers(r);var u=this._getNumberOfMonths(r),f=u[1],m=r.dpDiv.find("."+this._dayOverClass+" a");if(0<m.length&&n.apply(m.get(0)),r.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),1<f&&r.dpDiv.addClass("ui-datepicker-multi-"+f).css("width",17*f+"em"),r.dpDiv[(1!==u[0]||1!==u[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),r.dpDiv[(this._get(r,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),r===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(r)&&r.input.trigger("focus"),r.yearshtml){var b=r.yearshtml;setTimeout(function(){b===r.yearshtml&&r.yearshtml&&r.dpDiv.find("select.ui-datepicker-year:first").replaceWith(r.yearshtml),b=r.yearshtml=null},0)}},_shouldFocusInput:function(r){return r.input&&r.input.is(":visible")&&!r.input.is(":disabled")&&!r.input.is(":focus")},_checkOffset:function(r,u,f){var m=r.dpDiv.outerWidth(),b=r.dpDiv.outerHeight(),w=r.input?r.input.outerWidth():0,A=r.input?r.input.outerHeight():0,x=document.documentElement.clientWidth+(f?0:e(document).scrollLeft()),y=document.documentElement.clientHeight+(f?0:e(document).scrollTop());return u.left-=this._get(r,"isRTL")?m-w:0,u.left-=f&&u.left===r.input.offset().left?e(document).scrollLeft():0,u.top-=f&&u.top===r.input.offset().top+A?e(document).scrollTop():0,u.left-=Math.min(u.left,u.left+m>x&&x>m?Math.abs(u.left+m-x):0),u.top-=Math.min(u.top,u.top+b>y&&y>b?Math.abs(b+A):0),u},_findPos:function(r){var u=this._getInst(r);for(u=this._get(u,"isRTL");r&&("hidden"===r.type||1!==r.nodeType||e.expr.filters.hidden(r));)r=r[u?"previousSibling":"nextSibling"];return[(r=e(r).offset()).left,r.top]},_hideDatepicker:function(r){var u=this._curInst;if(u&&(!r||u===e.data(r,"datepicker"))&&this._datepickerShowing){r=this._get(u,"showAnim");var f=this._get(u,"duration"),m=function(){e.datepicker._tidyDialog(u)};e.effects&&(e.effects.effect[r]||e.effects[r])?u.dpDiv.hide(r,e.datepicker._get(u,"showOptions"),f,m):u.dpDiv["slideDown"===r?"slideUp":"fadeIn"===r?"fadeOut":"hide"](r?f:null,m),r||m(),this._datepickerShowing=!1,(r=this._get(u,"onClose"))&&r.apply(u.input?u.input[0]:null,[u.input?u.input.val():"",u]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(r){r.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(r){if(e.datepicker._curInst){r=e(r.target);var u=e.datepicker._getInst(r[0]);(!(r[0].id===e.datepicker._mainDivId||0!==r.parents("#"+e.datepicker._mainDivId).length||r.hasClass(e.datepicker.markerClassName)||r.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)||r.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==u)&&e.datepicker._hideDatepicker()}},_adjustDate:function(r,u,f){r=e(r);var m=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(m,u+("M"===f?this._get(m,"showCurrentAtPos"):0),f),this._updateDatepicker(m))},_gotoToday:function(r){var u=e(r),f=this._getInst(u[0]);this._get(f,"gotoCurrent")&&f.currentDay?(f.selectedDay=f.currentDay,f.drawMonth=f.selectedMonth=f.currentMonth,f.drawYear=f.selectedYear=f.currentYear):(r=new Date,f.selectedDay=r.getDate(),f.drawMonth=f.selectedMonth=r.getMonth(),f.drawYear=f.selectedYear=r.getFullYear()),this._notifyChange(f),this._adjustDate(u)},_selectMonthYear:function(r,u,f){r=e(r);var m=this._getInst(r[0]);m["selected"+("M"===f?"Month":"Year")]=m["draw"+("M"===f?"Month":"Year")]=parseInt(u.options[u.selectedIndex].value,10),this._notifyChange(m),this._adjustDate(r)},_selectDay:function(r,u,f,m){var b=e(r);e(m).hasClass(this._unselectableClass)||this._isDisabledDatepicker(b[0])||((b=this._getInst(b[0])).selectedDay=b.currentDay=e("a",m).html(),b.selectedMonth=b.currentMonth=u,b.selectedYear=b.currentYear=f,this._selectDate(r,this._formatDate(b,b.currentDay,b.currentMonth,b.currentYear)))},_clearDate:function(r){r=e(r),this._selectDate(r,"")},_selectDate:function(r,u){r=e(r);var f=this._getInst(r[0]);u=u??this._formatDate(f),f.input&&f.input.val(u),this._updateAlternate(f),(r=this._get(f,"onSelect"))?r.apply(f.input?f.input[0]:null,[u,f]):f.input&&f.input.trigger("change"),f.inline?this._updateDatepicker(f):(this._hideDatepicker(),this._lastInput=f.input[0],"object"!=typeof f.input[0]&&f.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(r){var u=this._get(r,"altField");if(u){var f=this._get(r,"altFormat")||this._get(r,"dateFormat"),m=this._getDate(r);r=this.formatDate(f,m,this._getFormatConfig(r)),e(u).val(r)}},noWeekends:function(r){return[0<(r=r.getDay())&&6>r,""]},iso8601Week:function(r){var u=new Date(r.getTime());return u.setDate(u.getDate()+4-(u.getDay()||7)),r=u.getTime(),u.setMonth(0),u.setDate(1),Math.floor(Math.round((r-u)/864e5)/7)+1},parseDate:function(r,u,f){if(null==r||null==u)throw"Invalid arguments";if(""===(u="object"==typeof u?u.toString():u+""))return null;var m,b=0,w=(f?f.shortYearCutoff:null)||this._defaults.shortYearCutoff;w="string"!=typeof w?w:(new Date).getFullYear()%100+parseInt(w,10);var A=(f?f.dayNamesShort:null)||this._defaults.dayNamesShort,x=(f?f.dayNames:null)||this._defaults.dayNames,y=(f?f.monthNamesShort:null)||this._defaults.monthNamesShort,S=(f?f.monthNames:null)||this._defaults.monthNames,_=f=-1,C=-1,I=-1,L=!1,D=function(H){return(H=m+1<r.length&&r.charAt(m+1)===H)&&m++,H},O=function(H){var N=D(H);if(N="@"===H?14:"!"===H?20:"y"===H&&N?4:"o"===H?3:2,H=new RegExp("^\\d{"+("y"===H?N:1)+","+N+"}"),!(H=u.substring(b).match(H)))throw"Missing number at position "+b;return b+=H[0].length,parseInt(H[0],10)},M=function(H,N,B){var P=-1;if(H=e.map(D(H)?B:N,function(z,J){return[[J,z]]}).sort(function(z,J){return-(z[1].length-J[1].length)}),e.each(H,function(z,J){if(u.substr(b,(z=J[1]).length).toLowerCase()===z.toLowerCase())return P=J[0],b+=z.length,!1}),-1!==P)return P+1;throw"Unknown name at position "+b},E=function(){if(u.charAt(b)!==r.charAt(m))throw"Unexpected literal at position "+b;b++};for(m=0;m<r.length;m++)if(L)"'"!==r.charAt(m)||D("'")?E():L=!1;else switch(r.charAt(m)){case"d":C=O("d");break;case"D":M("D",A,x);break;case"o":I=O("o");break;case"m":_=O("m");break;case"M":_=M("M",y,S);break;case"y":f=O("y");break;case"@":var R=new Date(O("@"));f=R.getFullYear(),_=R.getMonth()+1,C=R.getDate();break;case"!":f=(R=new Date((O("!")-this._ticksTo1970)/1e4)).getFullYear(),_=R.getMonth()+1,C=R.getDate();break;case"'":D("'")?E():L=!0;break;default:E()}if(b<u.length&&(A=u.substr(b),!/^\s+/.test(A)))throw"Extra/unparsed characters found in date: "+A;if(-1===f?f=(new Date).getFullYear():100>f&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(f<=w?0:-100)),-1<I)for(_=1,C=I;!(C<=(w=this._getDaysInMonth(f,_-1)));)_++,C-=w;if((R=this._daylightSavingAdjust(new Date(f,_-1,C))).getFullYear()!==f||R.getMonth()+1!==_||R.getDate()!==C)throw"Invalid date";return R},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:621355968e9,formatDate:function(r,u,f){if(!u)return"";var m,b=(f?f.dayNamesShort:null)||this._defaults.dayNamesShort,w=(f?f.dayNames:null)||this._defaults.dayNames,A=(f?f.monthNamesShort:null)||this._defaults.monthNamesShort;f=(f?f.monthNames:null)||this._defaults.monthNames;var x=function(I){return(I=m+1<r.length&&r.charAt(m+1)===I)&&m++,I},y=function(I,L,D){if(L=""+L,x(I))for(;L.length<D;)L="0"+L;return L},S=function(I,L,D,O){return x(I)?O[L]:D[L]},_="",C=!1;if(u)for(m=0;m<r.length;m++)if(C)"'"!==r.charAt(m)||x("'")?_+=r.charAt(m):C=!1;else switch(r.charAt(m)){case"d":_+=y("d",u.getDate(),2);break;case"D":_+=S("D",u.getDay(),b,w);break;case"o":_+=y("o",Math.round((new Date(u.getFullYear(),u.getMonth(),u.getDate()).getTime()-new Date(u.getFullYear(),0,0).getTime())/864e5),3);break;case"m":_+=y("m",u.getMonth()+1,2);break;case"M":_+=S("M",u.getMonth(),A,f);break;case"y":_+=x("y")?u.getFullYear():(10>u.getFullYear()%100?"0":"")+u.getFullYear()%100;break;case"@":_+=u.getTime();break;case"!":_+=1e4*u.getTime()+this._ticksTo1970;break;case"'":x("'")?_+="'":C=!0;break;default:_+=r.charAt(m)}return _},_possibleChars:function(r){var u,f="",m=!1,b=function(w){return(w=u+1<r.length&&r.charAt(u+1)===w)&&u++,w};for(u=0;u<r.length;u++)if(m)"'"!==r.charAt(u)||b("'")?f+=r.charAt(u):m=!1;else switch(r.charAt(u)){case"d":case"m":case"y":case"@":f+="0123456789";break;case"D":case"M":return null;case"'":b("'")?f+="'":m=!0;break;default:f+=r.charAt(u)}return f},_get:function(r,u){return void 0!==r.settings[u]?r.settings[u]:this._defaults[u]},_setDateFromField:function(r,u){if(r.input.val()!==r.lastVal){var f=this._get(r,"dateFormat"),m=r.lastVal=r.input?r.input.val():null,b=this._getDefaultDate(r),w=b,A=this._getFormatConfig(r);try{w=this.parseDate(f,m,A)||b}catch{m=u?"":m}r.selectedDay=w.getDate(),r.drawMonth=r.selectedMonth=w.getMonth(),r.drawYear=r.selectedYear=w.getFullYear(),r.currentDay=m?w.getDate():0,r.currentMonth=m?w.getMonth():0,r.currentYear=m?w.getFullYear():0,this._adjustInstDate(r)}},_getDefaultDate:function(r){return this._restrictMinMax(r,this._determineDate(r,this._get(r,"defaultDate"),new Date))},_determineDate:function(r,u,f){var w,A;return(u=(u=null==u||""===u?f:"string"==typeof u?function(w){try{return e.datepicker.parseDate(e.datepicker._get(r,"dateFormat"),w,e.datepicker._getFormatConfig(r))}catch{}var A=(w.toLowerCase().match(/^c/)?e.datepicker._getDate(r):null)||new Date,x=A.getFullYear(),y=A.getMonth();A=A.getDate();for(var S=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,_=S.exec(w);_;){switch(_[2]||"d"){case"d":case"D":A+=parseInt(_[1],10);break;case"w":case"W":A+=7*parseInt(_[1],10);break;case"m":case"M":y+=parseInt(_[1],10),A=Math.min(A,e.datepicker._getDaysInMonth(x,y));break;case"y":case"Y":x+=parseInt(_[1],10),A=Math.min(A,e.datepicker._getDaysInMonth(x,y))}_=S.exec(w)}return new Date(x,y,A)}(u):"number"==typeof u?isNaN(u)?f:(w=u,(A=new Date).setDate(A.getDate()+w),A):new Date(u.getTime()))&&"Invalid Date"===u.toString()?f:u)&&(u.setHours(0),u.setMinutes(0),u.setSeconds(0),u.setMilliseconds(0)),this._daylightSavingAdjust(u)},_daylightSavingAdjust:function(r){return r?(r.setHours(12<r.getHours()?r.getHours()+2:0),r):null},_setDate:function(r,u,f){var m=!u,b=r.selectedMonth,w=r.selectedYear;u=this._restrictMinMax(r,this._determineDate(r,u,new Date)),r.selectedDay=r.currentDay=u.getDate(),r.drawMonth=r.selectedMonth=r.currentMonth=u.getMonth(),r.drawYear=r.selectedYear=r.currentYear=u.getFullYear(),b===r.selectedMonth&&w===r.selectedYear||f||this._notifyChange(r),this._adjustInstDate(r),r.input&&r.input.val(m?"":this._formatDate(r))},_getDate:function(r){return!r.currentYear||r.input&&""===r.input.val()?null:this._daylightSavingAdjust(new Date(r.currentYear,r.currentMonth,r.currentDay))},_attachHandlers:function(r){var u=this._get(r,"stepMonths"),f="#"+r.id.replace(/\\\\/g,"\\");r.dpDiv.find("[data-handler]").map(function(){e(this).on(this.getAttribute("data-event"),{prev:function(){e.datepicker._adjustDate(f,-u,"M")},next:function(){e.datepicker._adjustDate(f,+u,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(f)},selectDay:function(){return e.datepicker._selectDay(f,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(f,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(f,this,"Y"),!1}}[this.getAttribute("data-handler")])})},_generateHTML:function(r){var u,f,m,b,w=new Date;w=this._daylightSavingAdjust(new Date(w.getFullYear(),w.getMonth(),w.getDate()));var A=this._get(r,"isRTL"),x=this._get(r,"showButtonPanel"),y=this._get(r,"hideIfNoPrevNext"),S=this._get(r,"navigationAsDateFormat"),_=this._getNumberOfMonths(r),C=this._get(r,"showCurrentAtPos"),I=this._get(r,"stepMonths"),L=1!==_[0]||1!==_[1],D=this._daylightSavingAdjust(r.currentDay?new Date(r.currentYear,r.currentMonth,r.currentDay):new Date(9999,9,9)),O=this._getMinMaxDate(r,"min"),M=this._getMinMaxDate(r,"max"),E=r.drawYear;if(0>(C=r.drawMonth-C)&&(C+=12,E--),M){var R=this._daylightSavingAdjust(new Date(M.getFullYear(),M.getMonth()-_[0]*_[1]+1,M.getDate()));for(R=O&&R<O?O:R;this._daylightSavingAdjust(new Date(E,C,1))>R;)0>--C&&(C=11,E--)}r.drawMonth=C,r.drawYear=E,R=this._get(r,"prevText"),R=S?this.formatDate(R,this._daylightSavingAdjust(new Date(E,C-I,1)),this._getFormatConfig(r)):R,R=this._canAdjustMonth(r,-1,E,C)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+R+"'><span class='ui-icon ui-icon-circle-triangle-"+(A?"e":"w")+"'>"+R+"</span></a>":y?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+R+"'><span class='ui-icon ui-icon-circle-triangle-"+(A?"e":"w")+"'>"+R+"</span></a>";var H=this._get(r,"nextText");H=S?this.formatDate(H,this._daylightSavingAdjust(new Date(E,C+I,1)),this._getFormatConfig(r)):H,y=this._canAdjustMonth(r,1,E,C)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+H+"'><span class='ui-icon ui-icon-circle-triangle-"+(A?"w":"e")+"'>"+H+"</span></a>":y?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+H+"'><span class='ui-icon ui-icon-circle-triangle-"+(A?"w":"e")+"'>"+H+"</span></a>",I=this._get(r,"currentText"),H=this._get(r,"gotoCurrent")&&r.currentDay?D:w,I=S?this.formatDate(I,H,this._getFormatConfig(r)):I,S=r.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(r,"closeText")+"</button>",x=x?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(A?S:"")+(this._isInRange(r,H)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+I+"</button>":"")+(A?"":S)+"</div>":"",S=parseInt(this._get(r,"firstDay"),10),S=isNaN(S)?0:S,I=this._get(r,"showWeek"),H=this._get(r,"dayNames");var N=this._get(r,"dayNamesMin"),B=this._get(r,"monthNames"),P=this._get(r,"monthNamesShort"),z=this._get(r,"beforeShowDay"),J=this._get(r,"showOtherMonths"),q=this._get(r,"selectOtherMonths"),G=this._getDefaultDate(r),ee="";for(u=0;u<_[0];u++){var le="";for(this.maxRows=4,f=0;f<_[1];f++){var te=this._daylightSavingAdjust(new Date(E,C,r.selectedDay)),Q=" ui-corner-all",de="";if(L){if(de+="<div class='ui-datepicker-group",1<_[1])switch(f){case 0:de+=" ui-datepicker-group-first",Q=" ui-corner-"+(A?"right":"left");break;case _[1]-1:de+=" ui-datepicker-group-last",Q=" ui-corner-"+(A?"left":"right");break;default:de+=" ui-datepicker-group-middle",Q=""}de+="'>"}de+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+Q+"'>"+(/all|left/.test(Q)&&0===u?A?y:R:"")+(/all|right/.test(Q)&&0===u?A?R:y:"")+this._generateMonthYearHeader(r,C,E,O,M,0<u||0<f,B,P)+"</div><table class='ui-datepicker-calendar'><thead><tr>";var xe=I?"<th class='ui-datepicker-week-col'>"+this._get(r,"weekHeader")+"</th>":"";for(Q=0;7>Q;Q++){var ce=(Q+S)%7;xe+="<th scope='col'"+(5<=(Q+S+6)%7?" class='ui-datepicker-week-end'":"")+"><span title='"+H[ce]+"'>"+N[ce]+"</span></th>"}for(de+=xe+"</tr></thead><tbody>",xe=this._getDaysInMonth(E,C),E===r.selectedYear&&C===r.selectedMonth&&(r.selectedDay=Math.min(r.selectedDay,xe)),Q=(this._getFirstDayOfMonth(E,C)-S+7)%7,xe=Math.ceil((Q+xe)/7),this.maxRows=xe=L&&this.maxRows>xe?this.maxRows:xe,ce=this._daylightSavingAdjust(new Date(E,C,1-Q)),m=0;m<xe;m++){de+="<tr>";var he=I?"<td class='ui-datepicker-week-col'>"+this._get(r,"calculateWeek")(ce)+"</td>":"";for(Q=0;7>Q;Q++){var Pe=z?z.apply(r.input?r.input[0]:null,[ce]):[!0,""],Se=(b=ce.getMonth()!==C)&&!q||!Pe[0]||O&&ce<O||M&&ce>M;he+="<td class='"+(5<=(Q+S+6)%7?" ui-datepicker-week-end":"")+(b?" ui-datepicker-other-month":"")+(ce.getTime()===te.getTime()&&C===r.selectedMonth&&r._keyEvent||G.getTime()===ce.getTime()&&G.getTime()===te.getTime()?" "+this._dayOverClass:"")+(Se?" "+this._unselectableClass+" ui-state-disabled":"")+(b&&!J?"":" "+Pe[1]+(ce.getTime()===D.getTime()?" "+this._currentClass:"")+(ce.getTime()===w.getTime()?" ui-datepicker-today":""))+"'"+(b&&!J||!Pe[2]?"":" title='"+Pe[2].replace(/'/g,"&#39;")+"'")+(Se?"":" data-handler='selectDay' data-event='click' data-month='"+ce.getMonth()+"' data-year='"+ce.getFullYear()+"'")+">"+(b&&!J?"&#xa0;":Se?"<span class='ui-state-default'>"+ce.getDate()+"</span>":"<a class='ui-state-default"+(ce.getTime()===w.getTime()?" ui-state-highlight":"")+(ce.getTime()===D.getTime()?" ui-state-active":"")+(b?" ui-priority-secondary":"")+"' href='#'>"+ce.getDate()+"</a>")+"</td>",ce.setDate(ce.getDate()+1),ce=this._daylightSavingAdjust(ce)}de+=he+"</tr>"}11<++C&&(C=0,E++),le+=de+="</tbody></table>"+(L?"</div>"+(0<_[0]&&f===_[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}ee+=le}return r._keyEvent=!1,ee+x},_generateMonthYearHeader:function(r,u,f,m,b,w,A,x){var y,S=this._get(r,"changeMonth"),_=this._get(r,"changeYear"),C=this._get(r,"showMonthAfterYear"),I="<div class='ui-datepicker-title'>",L="";if(w||!S)L+="<span class='ui-datepicker-month'>"+A[u]+"</span>";else{A=m&&m.getFullYear()===f;var D=b&&b.getFullYear()===f;for(L+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",y=0;12>y;y++)(!A||y>=m.getMonth())&&(!D||y<=b.getMonth())&&(L+="<option value='"+y+"'"+(y===u?" selected='selected'":"")+">"+x[y]+"</option>");L+="</select>"}if(C||(I+=L+(!w&&S&&_?"":"&#xa0;")),!r.yearshtml)if(r.yearshtml="",w||!_)I+="<span class='ui-datepicker-year'>"+f+"</span>";else{x=this._get(r,"yearRange").split(":");var O=(new Date).getFullYear();for(u=(A=function(M){return M=M.match(/c[+\-].*/)?f+parseInt(M.substring(1),10):M.match(/[+\-].*/)?O+parseInt(M,10):parseInt(M,10),isNaN(M)?O:M})(x[0]),x=Math.max(u,A(x[1]||"")),u=m?Math.max(u,m.getFullYear()):u,x=b?Math.min(x,b.getFullYear()):x,r.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";u<=x;u++)r.yearshtml+="<option value='"+u+"'"+(u===f?" selected='selected'":"")+">"+u+"</option>";r.yearshtml+="</select>",I+=r.yearshtml,r.yearshtml=null}return I+=this._get(r,"yearSuffix"),C&&(I+=(!w&&S&&_?"":"&#xa0;")+L),I+"</div>"},_adjustInstDate:function(r,u,f){var m=r.selectedYear+("Y"===f?u:0),b=r.selectedMonth+("M"===f?u:0);u=Math.min(r.selectedDay,this._getDaysInMonth(m,b))+("D"===f?u:0),m=this._restrictMinMax(r,this._daylightSavingAdjust(new Date(m,b,u))),r.selectedDay=m.getDate(),r.drawMonth=r.selectedMonth=m.getMonth(),r.drawYear=r.selectedYear=m.getFullYear(),"M"!==f&&"Y"!==f||this._notifyChange(r)},_restrictMinMax:function(r,u){var f=this._getMinMaxDate(r,"min");return u=f&&u<f?f:u,(r=this._getMinMaxDate(r,"max"))&&u>r?r:u},_notifyChange:function(r){var u=this._get(r,"onChangeMonthYear");u&&u.apply(r.input?r.input[0]:null,[r.selectedYear,r.selectedMonth+1,r])},_getNumberOfMonths:function(r){return null==(r=this._get(r,"numberOfMonths"))?[1,1]:"number"==typeof r?[1,r]:r},_getMinMaxDate:function(r,u){return this._determineDate(r,this._get(r,u+"Date"),null)},_getDaysInMonth:function(r,u){return 32-this._daylightSavingAdjust(new Date(r,u,32)).getDate()},_getFirstDayOfMonth:function(r,u){return new Date(r,u,1).getDay()},_canAdjustMonth:function(r,u,f,m){var b=this._getNumberOfMonths(r);return f=this._daylightSavingAdjust(new Date(f,m+(0>u?u:b[0]*b[1]),1)),0>u&&f.setDate(this._getDaysInMonth(f.getFullYear(),f.getMonth())),this._isInRange(r,f)},_isInRange:function(r,u){var f=this._getMinMaxDate(r,"min"),m=this._getMinMaxDate(r,"max"),b=null,w=null;if(r=this._get(r,"yearRange")){r=r.split(":");var A=(new Date).getFullYear();b=parseInt(r[0],10),w=parseInt(r[1],10),r[0].match(/[+\-].*/)&&(b+=A),r[1].match(/[+\-].*/)&&(w+=A)}return(!f||u.getTime()>=f.getTime())&&(!m||u.getTime()<=m.getTime())&&(!b||u.getFullYear()>=b)&&(!w||u.getFullYear()<=w)},_getFormatConfig:function(r){var u=this._get(r,"shortYearCutoff");return{shortYearCutoff:u="string"!=typeof u?u:(new Date).getFullYear()%100+parseInt(u,10),dayNamesShort:this._get(r,"dayNamesShort"),dayNames:this._get(r,"dayNames"),monthNamesShort:this._get(r,"monthNamesShort"),monthNames:this._get(r,"monthNames")}},_formatDate:function(r,u,f,m){return u||(r.currentDay=r.selectedDay,r.currentMonth=r.selectedMonth,r.currentYear=r.selectedYear),u=u?"object"==typeof u?u:this._daylightSavingAdjust(new Date(m,f,u)):this._daylightSavingAdjust(new Date(r.currentYear,r.currentMonth,r.currentDay)),this.formatDate(this._get(r,"dateFormat"),u,this._getFormatConfig(r))}}),e.fn.datepicker=function(r){if(!this.length)return this;e.datepicker.initialized||(e(document).on("mousedown",e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var u=Array.prototype.slice.call(arguments,1);return"string"==typeof r&&("isDisabled"===r||"getDate"===r||"widget"===r)||"option"===r&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+r+"Datepicker"].apply(e.datepicker,[this[0]].concat(u)):this.each(function(){"string"==typeof r?e.datepicker["_"+r+"Datepicker"].apply(e.datepicker,[this].concat(u)):e.datepicker._attachDatepicker(this,r)})},e.datepicker=new s,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.12.1",e.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(r){var u=e(this).css(r).offset().top;0>u&&e(this).css("top",r.top-u)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var r=this.options.appendTo;return r&&(r.jquery||r.nodeType)?e(r):this.document.find(r||"body").eq(0)},_destroy:function(){var r=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle);var u=r.parent.children().eq(r.index);u.length&&u[0]!==this.element[0]?u.before(this.element):r.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(r){var u=this;this._isOpen&&!1!==this._trigger("beforeClose",r)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||e.ui.safeBlur(e.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){u._trigger("close",r)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(r,u){var f=!1,m=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get();return(m=Math.max.apply(null,m))>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",m+1),f=!0),f&&!u&&this._trigger("focus",r),f},open:function(){var r=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=e(e.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){r._focusTabbable(),r._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"))},_focusTabbable:function(){var r=this._focusedElement;r||(r=this.element.find("[autofocus]")),r.length||(r=this.element.find(":tabbable")),r.length||(r=this.uiDialogButtonPane.find(":tabbable")),r.length||(r=this.uiDialogTitlebarClose.filter(":tabbable")),r.length||(r=this.uiDialog),r.eq(0).trigger("focus")},_keepFocus:function(r){function u(){var f=e.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===f||e.contains(this.uiDialog[0],f)||this._focusTabbable()}r.preventDefault(),u.call(this),this._delay(u)},_createWrapper:function(){this.uiDialog=e("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(r){if(this.options.closeOnEscape&&!r.isDefaultPrevented()&&r.keyCode&&r.keyCode===e.ui.keyCode.ESCAPE)r.preventDefault(),this.close(r);else if(r.keyCode===e.ui.keyCode.TAB&&!r.isDefaultPrevented()){var u=this.uiDialog.find(":tabbable"),f=u.filter(":first"),m=u.filter(":last");r.target!==m[0]&&r.target!==this.uiDialog[0]||r.shiftKey?r.target!==f[0]&&r.target!==this.uiDialog[0]||!r.shiftKey||(this._delay(function(){m.trigger("focus")}),r.preventDefault()):(this._delay(function(){f.trigger("focus")}),r.preventDefault())}},mousedown:function(r){this._moveToTop(r)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){this.uiDialogTitlebar=e("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(u){e(u.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:e("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(u){u.preventDefault(),this.close(u)}});var r=e("<span>").uniqueId().prependTo(this.uiDialogTitlebar);this._addClass(r,"ui-dialog-title"),this._title(r),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":r.attr("id")})},_title:function(r){this.options.title?r.text(this.options.title):r.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var r=this,u=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(u)||e.isArray(u)&&!u.length?this._removeClass(this.uiDialog,"ui-dialog-buttons"):(e.each(u,function(f,m){m=e.isFunction(m)?{click:m,text:f}:m;var b=(m=e.extend({type:"button"},m)).click;f={icon:m.icon,iconPosition:m.iconPosition,showLabel:m.showLabel,icons:m.icons,text:m.text},delete m.click,delete m.icon,delete m.iconPosition,delete m.showLabel,delete m.icons,"boolean"==typeof m.text&&delete m.text,e("<button></button>",m).button(f).appendTo(r.uiButtonSet).on("click",function(){b.apply(r.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function r(m){return{position:m.position,offset:m.offset}}var u=this,f=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(m,b){u._addClass(e(this),"ui-dialog-dragging"),u._blockFrames(),u._trigger("dragStart",m,r(b))},drag:function(m,b){u._trigger("drag",m,r(b))},stop:function(m,b){var w=b.offset.left-u.document.scrollLeft(),A=b.offset.top-u.document.scrollTop();f.position={my:"left top",at:"left"+(0<=w?"+":"")+w+" top"+(0<=A?"+":"")+A,of:u.window},u._removeClass(e(this),"ui-dialog-dragging"),u._unblockFrames(),u._trigger("dragStop",m,r(b))}})},_makeResizable:function(){function r(w){return{originalPosition:w.originalPosition,originalSize:w.originalSize,position:w.position,size:w.size}}var u=this,f=this.options,m=f.resizable,b=this.uiDialog.css("position");m="string"==typeof m?m:"n,e,s,w,se,sw,ne,nw",this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:f.maxWidth,maxHeight:f.maxHeight,minWidth:f.minWidth,minHeight:this._minHeight(),handles:m,start:function(w,A){u._addClass(e(this),"ui-dialog-resizing"),u._blockFrames(),u._trigger("resizeStart",w,r(A))},resize:function(w,A){u._trigger("resize",w,r(A))},stop:function(w,A){var x=u.uiDialog.offset(),y=x.left-u.document.scrollLeft();x=x.top-u.document.scrollTop(),f.height=u.uiDialog.height(),f.width=u.uiDialog.width(),f.position={my:"left top",at:"left"+(0<=y?"+":"")+y+" top"+(0<=x?"+":"")+x,of:u.window},u._removeClass(e(this),"ui-dialog-resizing"),u._unblockFrames(),u._trigger("resizeStop",w,r(A))}}).css("position",b)},_trackFocus:function(){this._on(this.widget(),{focusin:function(r){this._makeFocusTarget(),this._focusedElement=e(r.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var r=this._trackingInstances(),u=e.inArray(this,r);-1!==u&&r.splice(u,1)},_trackingInstances:function(){var r=this.document.data("ui-dialog-instances");return r||this.document.data("ui-dialog-instances",r=[]),r},_minHeight:function(){var r=this.options;return"auto"===r.height?r.minHeight:Math.min(r.minHeight,r.height)},_position:function(){var r=this.uiDialog.is(":visible");r||this.uiDialog.show(),this.uiDialog.position(this.options.position),r||this.uiDialog.hide()},_setOptions:function(r){var u=this,f=!1,m={};e.each(r,function(b,w){u._setOption(b,w),b in u.sizeRelatedOptions&&(f=!0),b in u.resizableRelatedOptions&&(m[b]=w)}),f&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",m)},_setOption:function(r,u){var f,m=this.uiDialog;"disabled"!==r&&(this._super(r,u),"appendTo"===r&&this.uiDialog.appendTo(this._appendTo()),"buttons"===r&&this._createButtons(),"closeText"===r&&this.uiDialogTitlebarClose.button({label:e("<a>").text(""+this.options.closeText).html()}),"draggable"===r&&((f=m.is(":data(ui-draggable)"))&&!u&&m.draggable("destroy"),!f&&u&&this._makeDraggable()),"position"===r&&this._position(),"resizable"===r&&((f=m.is(":data(ui-resizable)"))&&!u&&m.resizable("destroy"),f&&"string"==typeof u&&m.resizable("option","handles",u),f||!1===u||this._makeResizable()),"title"===r&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth);var u=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),f=Math.max(0,r.minHeight-u),m="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-u):"none";"auto"===r.height?this.element.css({minHeight:f,maxHeight:m,height:"auto"}):this.element.height(Math.max(0,r.height-u)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var r=e(this);return e("<div>").css({position:"absolute",width:r.outerWidth(),height:r.outerHeight()}).appendTo(r.parent()).offset(r.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(r){return!!e(r.target).closest(".ui-dialog").length||!!e(r.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var r=!0;this._delay(function(){r=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(u){r||this._allowInteraction(u)||(u.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var r=this.document.data("ui-dialog-overlays")-1;r?this.document.data("ui-dialog-overlays",r):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!1!==e.uiBackCompat&&e.widget("ui.dialog",e.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(r,u){"dialogClass"===r&&this.uiDialog.removeClass(this.options.dialogClass).addClass(u),this._superApply(arguments)}}),e.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=e("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(r){if(void 0===r)return this.options.value;this.options.value=this._constrainedValue(r),this._refreshValue()},_constrainedValue:function(r){return void 0===r&&(r=this.options.value),this.indeterminate=!1===r,"number"!=typeof r&&(r=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,r))},_setOptions:function(r){var u=r.value;delete r.value,this._super(r),this.options.value=this._constrainedValue(u),this._refreshValue()},_setOption:function(r,u){"max"===r&&(u=Math.max(this.min,u)),this._super(r,u)},_setOptionDisabled:function(r){this._super(r),this.element.attr("aria-disabled",r),this._toggleClass(null,"ui-state-disabled",!!r)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var r=this.options.value,u=this._percentage();this.valueDiv.toggle(this.indeterminate||r>this.min).width(u.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,r===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":r}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==r&&(this.oldValue=r,this._trigger("change")),r===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectmenu",[e.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var r=this.element.uniqueId().attr("id");this.ids={element:r,button:r+"-button",menu:r+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=e()},_drawButton:function(){var r=this,u=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(m){this.button.focus(),m.preventDefault()}}),this.element.hide(),this.button=e("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget");var f=e("<span>").appendTo(this.button);this._addClass(f,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(u).appendTo(this.button),!1!==this.options.width&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){r._rendered||r._refreshMenu()})},_drawMenu:function(){var r=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(u,f){u.preventDefault(),r._setSelection(),r._select(f.item.data("ui-selectmenu-item"),u)},focus:function(u,f){f=f.item.data("ui-selectmenu-item"),null!=r.focusIndex&&f.index!==r.focusIndex&&(r._trigger("focus",u,{item:f}),r.isOpen||r._select(f,u)),r.focusIndex=f.index,r.button.attr("aria-activedescendant",r.menuItems.eq(f.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var r=this.element.find("option");this.menu.empty(),this._parseOptions(r),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,r.length&&(r=this._getSelectedItem(),this.menuInstance.focus(null,r),this._setAria(r.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(r){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",r)))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(r){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",r))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(r){var u=e("<span>");return this._setText(u,r.label),this._addClass(u,"ui-selectmenu-text"),u},_renderMenu:function(r,u){var f=this,m="";e.each(u,function(b,w){w.optgroup!==m&&(b=e("<li>",{text:w.optgroup}),f._addClass(b,"ui-selectmenu-optgroup","ui-menu-divider"+(w.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),b.appendTo(r),m=w.optgroup),f._renderItemData(r,w)})},_renderItemData:function(r,u){return this._renderItem(r,u).data("ui-selectmenu-item",u)},_renderItem:function(r,u){var f=e("<li>"),m=e("<div>",{title:u.element.attr("title")});return u.disabled&&this._addClass(f,null,"ui-state-disabled"),this._setText(m,u.label),f.append(m).appendTo(r)},_setText:function(r,u){u?r.text(u):r.html("&#160;")},_move:function(r,u){var f=".ui-menu-item";if(this.isOpen)var m=this.menuItems.eq(this.focusIndex).parent("li");else m=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),f+=":not(.ui-state-disabled)";(r="first"===r||"last"===r?m["first"===r?"prevAll":"nextAll"](f).eq(-1):m[r+"All"](f).eq(0)).length&&this.menuInstance.focus(u,r)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(r){this[this.isOpen?"close":"open"](r)},_setSelection:function(){if(this.range){if(window.getSelection){var r=window.getSelection();r.removeAllRanges(),r.addRange(this.range)}else this.range.select();this.button.focus()}},_documentClick:{mousedown:function(r){this.isOpen&&(e(r.target).closest(".ui-selectmenu-menu, #"+e.ui.escapeSelector(this.ids.button)).length||this.close(r))}},_buttonEvents:{mousedown:function(){if(window.getSelection){var r=window.getSelection();r.rangeCount&&(this.range=r.getRangeAt(0))}else this.range=document.selection.createRange()},click:function(r){this._setSelection(),this._toggle(r)},keydown:function(r){var u=!0;switch(r.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(r),u=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(r);break;case e.ui.keyCode.UP:r.altKey?this._toggle(r):this._move("prev",r);break;case e.ui.keyCode.DOWN:r.altKey?this._toggle(r):this._move("next",r);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(r):this._toggle(r);break;case e.ui.keyCode.LEFT:this._move("prev",r);break;case e.ui.keyCode.RIGHT:this._move("next",r);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",r);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",r);break;default:this.menu.trigger(r),u=!1}u&&r.preventDefault()}},_selectFocusedItem:function(r){var u=this.menuItems.eq(this.focusIndex).parent("li");u.hasClass("ui-state-disabled")||this._select(u.data("ui-selectmenu-item"),r)},_select:function(r,u){var f=this.element[0].selectedIndex;this.element[0].selectedIndex=r.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(r)),this._setAria(r),this._trigger("select",u,{item:r}),r.index!==f&&this._trigger("change",u,{item:r}),this.close(u)},_setAria:function(r){r=this.menuItems.eq(r.index).attr("id"),this.button.attr({"aria-labelledby":r,"aria-activedescendant":r}),this.menu.attr("aria-activedescendant",r)},_setOption:function(r,u){if("icons"===r){var f=this.button.find("span.ui-icon");this._removeClass(f,null,this.options.icons.button)._addClass(f,null,u.button)}this._super(r,u),"appendTo"===r&&this.menuWrap.appendTo(this._appendTo()),"width"===r&&this._resizeButton()},_setOptionDisabled:function(r){this._super(r),this.menuInstance.option("disabled",r),this.button.attr("aria-disabled",r),this._toggleClass(this.button,null,"ui-state-disabled",r),this.element.prop("disabled",r),r?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var r=this.options.appendTo;return r&&(r=r.jquery||r.nodeType?e(r):this.document.find(r).eq(0)),r&&r[0]||(r=this.element.closest(".ui-front, dialog")),r.length||(r=this.document[0].body),r},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var r=this.options.width;!1===r?this.button.css("width",""):(null===r&&(r=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(r))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var r=this._super();return r.disabled=this.element.prop("disabled"),r},_parseOptions:function(r){var u=this,f=[];r.each(function(m,b){f.push(u._parseOption(e(b),m))}),this.items=f},_parseOption:function(r,u){var f=r.parent("optgroup");return{element:r,index:u,value:r.val(),label:r.text(),optgroup:f.attr("label")||"",disabled:f.prop("disabled")||r.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),e.widget("ui.slider",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._mouseSliding=this._keySliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var r=this.options,u=this.element.find(".ui-slider-handle"),f=[],m=r.values&&r.values.length||1;for(u.length>m&&(u.slice(m).remove(),u=u.slice(0,m)),r=u.length;r<m;r++)f.push("<span tabindex='0'></span>");this.handles=u.add(e(f.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(b){e(this).data("ui-slider-handle-index",b).attr("tabIndex",0)})},_createRange:function(){var r=this.options;r.range?(!0===r.range&&(r.values?r.values.length&&2!==r.values.length?r.values=[r.values[0],r.values[0]]:e.isArray(r.values)&&(r.values=r.values.slice(0)):r.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=e("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),"min"!==r.range&&"max"!==r.range||this._addClass(this.range,"ui-slider-range-"+r.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(r){var u,f,m=this,b=this.options;if(b.disabled)return!1;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset();var w=this._normValueFromMouse({x:r.pageX,y:r.pageY}),A=this._valueMax()-this._valueMin()+1;if(this.handles.each(function(y){var S=Math.abs(w-m.values(y));(A>S||A===S&&(y===m._lastChangedValue||m.values(y)===b.min))&&(A=S,u=e(this),f=y)}),!1===this._start(r,f))return!1;this._mouseSliding=!0,this._handleIndex=f,this._addClass(u,null,"ui-state-active"),u.trigger("focus");var x=u.offset();return this._clickOffset=e(r.target).parents().addBack().is(".ui-slider-handle")?{left:r.pageX-x.left-u.width()/2,top:r.pageY-x.top-u.height()/2-(parseInt(u.css("borderTopWidth"),10)||0)-(parseInt(u.css("borderBottomWidth"),10)||0)+(parseInt(u.css("marginTop"),10)||0)}:{left:0,top:0},this.handles.hasClass("ui-state-hover")||this._slide(r,f,w),this._animateOff=!0},_mouseStart:function(){return!0},_mouseDrag:function(r){var u=this._normValueFromMouse({x:r.pageX,y:r.pageY});return this._slide(r,this._handleIndex,u),!1},_mouseStop:function(r){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(r,this._handleIndex),this._change(r,this._handleIndex),this._clickOffset=this._handleIndex=null,this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(r){if("horizontal"===this.orientation){var u=this.elementSize.width;r=r.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else u=this.elementSize.height,r=r.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);return 1<(u=r/u)&&(u=1),0>u&&(u=0),"vertical"===this.orientation&&(u=1-u),r=this._valueMax()-this._valueMin(),u=this._valueMin()+u*r,this._trimAlignValue(u)},_uiHash:function(r,u,f){var m={handle:this.handles[r],handleIndex:r,value:void 0!==u?u:this.value()};return this._hasMultipleValues()&&(m.value=void 0!==u?u:this.values(r),m.values=f||this.values()),m},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(r,u){return this._trigger("start",r,this._uiHash(u))},_slide:function(r,u,f){var m=this.value(),b=this.values();if(this._hasMultipleValues()){var w=this.values(u?0:1);m=this.values(u),2===this.options.values.length&&!0===this.options.range&&(f=0===u?Math.min(w,f):Math.max(w,f)),b[u]=f}f!==m&&!1!==this._trigger("slide",r,this._uiHash(u,f,b))&&(this._hasMultipleValues()?this.values(u,f):this.value(f))},_stop:function(r,u){this._trigger("stop",r,this._uiHash(u))},_change:function(r,u){this._keySliding||this._mouseSliding||(this._lastChangedValue=u,this._trigger("change",r,this._uiHash(u)))},value:function(r){if(!arguments.length)return this._value();this.options.value=this._trimAlignValue(r),this._refreshValue(),this._change(null,0)},values:function(r,u){var f;if(1<arguments.length)this.options.values[r]=this._trimAlignValue(u),this._refreshValue(),this._change(null,r);else{if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this._hasMultipleValues()?this._values(r):this.value();var m=this.options.values,b=arguments[0];for(f=0;f<m.length;f+=1)m[f]=this._trimAlignValue(b[f]),this._change(null,f);this._refreshValue()}},_setOption:function(r,u){var f=0;switch("range"===r&&!0===this.options.range&&("min"===u?(this.options.value=this._values(0),this.options.values=null):"max"===u&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(f=this.options.values.length),this._super(r,u),r){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(u),this.handles.css("horizontal"===u?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=f-1;0<=r;r--)this._change(null,r);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(r){this._super(r),this._toggleClass(null,"ui-state-disabled",!!r)},_value:function(){return this._trimAlignValue(this.options.value)},_values:function(r){var u;if(arguments.length){var f=this.options.values[r];return this._trimAlignValue(f)}if(this._hasMultipleValues()){for(f=this.options.values.slice(),u=0;u<f.length;u+=1)f[u]=this._trimAlignValue(f[u]);return f}return[]},_trimAlignValue:function(r){if(r<=this._valueMin())return this._valueMin();if(r>=this._valueMax())return this._valueMax();var u=0<this.options.step?this.options.step:1,f=(r-this._valueMin())%u;return r-=f,2*Math.abs(f)>=u&&(r+=0<f?u:-u),parseFloat(r.toFixed(5))},_calculateNewMax:function(){var r=this.options.max,u=this._valueMin(),f=this.options.step;(r=Math.round((r-u)/f)*f+u)>this.options.max&&(r-=f),this.max=parseFloat(r.toFixed(this._precision()))},_precision:function(){var r=this._precisionOf(this.options.step);return null!==this.options.min&&(r=Math.max(r,this._precisionOf(this.options.min))),r},_precisionOf:function(r){var u=(r=r.toString()).indexOf(".");return-1===u?0:r.length-u-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(r){"vertical"===r&&this.range.css({width:"",left:""}),"horizontal"===r&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var r,u=this.options.range,f=this.options,m=this,b=!this._animateOff&&f.animate,w={};if(this._hasMultipleValues())this.handles.each(function(_){S=(m.values(_)-m._valueMin())/(m._valueMax()-m._valueMin())*100,w["horizontal"===m.orientation?"left":"bottom"]=S+"%",e(this).stop(1,1)[b?"animate":"css"](w,f.animate),!0===m.options.range&&("horizontal"===m.orientation?(0===_&&m.range.stop(1,1)[b?"animate":"css"]({left:S+"%"},f.animate),1===_&&m.range[b?"animate":"css"]({width:S-r+"%"},{queue:!1,duration:f.animate})):(0===_&&m.range.stop(1,1)[b?"animate":"css"]({bottom:S+"%"},f.animate),1===_&&m.range[b?"animate":"css"]({height:S-r+"%"},{queue:!1,duration:f.animate}))),r=S});else{var A=this.value(),x=this._valueMin(),y=this._valueMax(),S=y!==x?(A-x)/(y-x)*100:0;w["horizontal"===this.orientation?"left":"bottom"]=S+"%",this.handle.stop(1,1)[b?"animate":"css"](w,f.animate),"min"===u&&"horizontal"===this.orientation&&this.range.stop(1,1)[b?"animate":"css"]({width:S+"%"},f.animate),"max"===u&&"horizontal"===this.orientation&&this.range.stop(1,1)[b?"animate":"css"]({width:100-S+"%"},f.animate),"min"===u&&"vertical"===this.orientation&&this.range.stop(1,1)[b?"animate":"css"]({height:S+"%"},f.animate),"max"===u&&"vertical"===this.orientation&&this.range.stop(1,1)[b?"animate":"css"]({height:100-S+"%"},f.animate)}},_handleEvents:{keydown:function(r){var u,f=e(r.target).data("ui-slider-handle-index");switch(r.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(r.preventDefault(),!this._keySliding){this._keySliding=!0,this._addClass(e(r.target),null,"ui-state-active");var m=this._start(r,f);if(!1===m)return}}var b=this.options.step;switch(m=u=this._hasMultipleValues()?this.values(f):this.value(),r.keyCode){case e.ui.keyCode.HOME:u=this._valueMin();break;case e.ui.keyCode.END:u=this._valueMax();break;case e.ui.keyCode.PAGE_UP:u=this._trimAlignValue(m+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:u=this._trimAlignValue(m-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(m===this._valueMax())return;u=this._trimAlignValue(m+b);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(m===this._valueMin())return;u=this._trimAlignValue(m-b)}this._slide(r,f,u)},keyup:function(r){var u=e(r.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(r,u),this._change(r,u),this._removeClass(e(r.target),null,"ui-state-active"))}}}),e.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var r=this._super(),u=this.element;return e.each(["min","max","step"],function(f,m){null!=(f=u.attr(m))&&f.length&&(r[m]=f)}),r},_events:{keydown:function(r){this._start(r)&&this._keydown(r)&&r.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(r){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",r))},mousewheel:function(r,u){if(u){if(!this.spinning&&!this._start(r))return!1;this._spin((0<u?1:-1)*this.options.step,r),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(r)},100),r.preventDefault()}},"mousedown .ui-spinner-button":function(r){function u(){this.element[0]!==e.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=f,this._delay(function(){this.previous=f}))}var f=this.element[0]===e.ui.safeActiveElement(this.document[0])?this.previous:this.element.val();r.preventDefault(),u.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,u.call(this)}),!1!==this._start(r)&&this._repeat(null,e(r.currentTarget).hasClass("ui-spinner-up")?1:-1,r)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(r){if(e(r.currentTarget).hasClass("ui-state-active")){if(!1===this._start(r))return!1;this._repeat(null,e(r.currentTarget).hasClass("ui-spinner-up")?1:-1,r)}},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&0<this.uiSpinner.height()&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(r){var u=this.options,f=e.ui.keyCode;switch(r.keyCode){case f.UP:return this._repeat(null,1,r),!0;case f.DOWN:return this._repeat(null,-1,r),!0;case f.PAGE_UP:return this._repeat(null,u.page,r),!0;case f.PAGE_DOWN:return this._repeat(null,-u.page,r),!0}return!1},_start:function(r){return!(!this.spinning&&!1===this._trigger("start",r))&&(this.counter||(this.counter=1),this.spinning=!0)},_repeat:function(r,u,f){r=r||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,u,f)},r),this._spin(u*this.options.step,f)},_spin:function(r,u){var f=this.value()||0;this.counter||(this.counter=1),f=this._adjustValue(f+r*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",u,{value:f})||(this._value(f),this.counter++)},_increment:function(r){var u=this.options.incremental;return u?e.isFunction(u)?u(r):Math.floor(r*r*r/5e4-r*r/500+17*r/200+1):1},_precision:function(){var r=this._precisionOf(this.options.step);return null!==this.options.min&&(r=Math.max(r,this._precisionOf(this.options.min))),r},_precisionOf:function(r){var u=(r=r.toString()).indexOf(".");return-1===u?0:r.length-u-1},_adjustValue:function(r){var u=this.options,f=null!==u.min?u.min:0;return r=f+Math.round((r-f)/u.step)*u.step,r=parseFloat(r.toFixed(this._precision())),null!==u.max&&r>u.max?u.max:null!==u.min&&r<u.min?u.min:r},_stop:function(r){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",r))},_setOption:function(r,u){if("culture"===r||"numberFormat"===r){var f=this._parse(this.element.val());this.options[r]=u,this.element.val(this._format(f))}else"max"!==r&&"min"!==r&&"step"!==r||"string"!=typeof u||(u=this._parse(u)),"icons"===r&&(f=this.buttons.first().find(".ui-icon"),this._removeClass(f,null,this.options.icons.up),this._addClass(f,null,u.up),f=this.buttons.last().find(".ui-icon"),this._removeClass(f,null,this.options.icons.down),this._addClass(f,null,u.down)),this._super(r,u)},_setOptionDisabled:function(r){this._super(r),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!r),this.element.prop("disabled",!!r),this.buttons.button(r?"disable":"enable")},_setOptions:l(function(r){this._super(r)}),_parse:function(r){return"string"==typeof r&&""!==r&&(r=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(r,10,this.options.culture):+r),""===r||isNaN(r)?null:r},_format:function(r){return""===r?"":window.Globalize&&this.options.numberFormat?Globalize.format(r,this.options.numberFormat,this.options.culture):r},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var r=this.value();return null!==r&&r===this._adjustValue(r)},_value:function(r,u){if(""!==r){var f=this._parse(r);null!==f&&(u||(f=this._adjustValue(f)),r=this._format(f))}this.element.val(r),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:l(function(r){this._stepUp(r)}),_stepUp:function(r){this._start()&&(this._spin((r||1)*this.options.step),this._stop())},stepDown:l(function(r){this._stepDown(r)}),_stepDown:function(r){this._start()&&(this._spin((r||1)*-this.options.step),this._stop())},pageUp:l(function(r){this._stepUp((r||1)*this.options.page)}),pageDown:l(function(r){this._stepDown((r||1)*this.options.page)}),value:function(r){if(!arguments.length)return this._parse(this.element.val());l(this._value).call(this,r)},widget:function(){return this.uiSpinner}}),!1!==e.uiBackCompat&&e.widget("ui.spinner",e.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),e.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var r=/#.*$/;return function(u){var f=u.href.replace(r,""),m=location.href.replace(r,"");try{f=decodeURIComponent(f)}catch{}try{m=decodeURIComponent(m)}catch{}return 1<u.hash.length&&f===m}}(),_create:function(){var r=this,u=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,u.collapsible),this._processTabs(),u.active=this._initialActive(),e.isArray(u.disabled)&&(u.disabled=e.unique(u.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(f){return r.tabs.index(f)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(u.active):e(),this._refresh(),this.active.length&&this.load(u.active)},_initialActive:function(){var r=this.options.active,u=this.options.collapsible,f=location.hash.substring(1);return null===r&&(f&&this.tabs.each(function(m,b){if(e(b).attr("aria-controls")===f)return r=m,!1}),null===r&&(r=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null===r||-1===r)&&(r=!!this.tabs.length&&0),!1!==r&&-1===(r=this.tabs.index(this.tabs.eq(r)))&&(r=!u&&0),!u&&!1===r&&this.anchors.length&&(r=0),r},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(r){var u=e(e.ui.safeActiveElement(this.document[0])).closest("li"),f=this.tabs.index(u),m=!0;if(!this._handlePageNav(r)){switch(r.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:f++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:m=!1,f--;break;case e.ui.keyCode.END:f=this.anchors.length-1;break;case e.ui.keyCode.HOME:f=0;break;case e.ui.keyCode.SPACE:return r.preventDefault(),clearTimeout(this.activating),void this._activate(f);case e.ui.keyCode.ENTER:return r.preventDefault(),clearTimeout(this.activating),void this._activate(f!==this.options.active&&f);default:return}r.preventDefault(),clearTimeout(this.activating),f=this._focusNextTab(f,m),r.ctrlKey||r.metaKey||(u.attr("aria-selected","false"),this.tabs.eq(f).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",f)},this.delay))}},_panelKeydown:function(r){!this._handlePageNav(r)&&r.ctrlKey&&r.keyCode===e.ui.keyCode.UP&&(r.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(r){return r.altKey&&r.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):r.altKey&&r.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(r,u){for(var m=this.tabs.length-1;-1!==e.inArray((r>m&&(r=0),0>r&&(r=m),r),this.options.disabled);)r=u?r+1:r-1;return r},_focusNextTab:function(r,u){return r=this._findNextTab(r,u),this.tabs.eq(r).trigger("focus"),r},_setOption:function(r,u){"active"===r?this._activate(u):(this._super(r,u),"collapsible"===r&&(this._toggleClass("ui-tabs-collapsible",null,u),u||!1!==this.options.active||this._activate(0)),"event"===r&&this._setupEvents(u),"heightStyle"===r&&this._setupHeightStyle(u))},_sanitizeSelector:function(r){return r?r.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var r=this.options,u=this.tablist.children(":has(a[href])");r.disabled=e.map(u.filter(".ui-state-disabled"),function(f){return u.index(f)}),this._processTabs(),!1!==r.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===r.disabled.length?(r.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,r.active-1),!1)):r.active=this.tabs.index(this.active):(r.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var r=this,u=this.tabs,f=this.anchors,m=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(b){e(this).is(".ui-state-disabled")&&b.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=e(),this.anchors.each(function(b,w){var A=e(w).uniqueId().attr("id"),x=e(w).closest("li"),y=x.attr("aria-controls");if(r._isLocal(w)){w=(b=w.hash).substring(1);var S=r.element.find(r._sanitizeSelector(b))}else w=x.attr("aria-controls")||e({}).uniqueId()[0].id,(S=r.element.find("#"+w)).length||(S=r._createPanel(w)).insertAfter(r.panels[b-1]||r.tablist),S.attr("aria-live","polite");S.length&&(r.panels=r.panels.add(S)),y&&x.data("ui-tabs-aria-controls",y),x.attr({"aria-controls":w,"aria-labelledby":A}),S.attr("aria-labelledby",A)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),u&&(this._off(u.not(this.tabs)),this._off(f.not(this.anchors)),this._off(m.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(r){return e("<div>").attr("id",r).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(r){var u,f;for(e.isArray(r)&&(r.length?r.length===this.anchors.length&&(r=!0):r=!1),f=0;u=this.tabs[f];f++)u=e(u),!0===r||-1!==e.inArray(f,r)?(u.attr("aria-disabled","true"),this._addClass(u,null,"ui-state-disabled")):(u.removeAttr("aria-disabled"),this._removeClass(u,null,"ui-state-disabled"));this.options.disabled=r,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===r)},_setupEvents:function(r){var u={};r&&e.each(r.split(" "),function(f,m){u[m]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(f){f.preventDefault()}}),this._on(this.anchors,u),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(r){var u=this.element.parent();if("fill"===r){var f=u.height();f-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var m=e(this),b=m.css("position");"absolute"!==b&&"fixed"!==b&&(f-=m.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){f-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,f-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")}else"auto"===r&&(f=0,this.panels.each(function(){f=Math.max(f,e(this).height("").height())}).height(f))},_eventHandler:function(r){var u=this.options,f=this.active,m=e(r.currentTarget).closest("li"),b=m[0]===f[0],w=b&&u.collapsible,A=w?e():this._getPanelForTab(m),x=f.length?this._getPanelForTab(f):e();f={oldTab:f,oldPanel:x,newTab:w?e():m,newPanel:A},r.preventDefault(),m.hasClass("ui-state-disabled")||m.hasClass("ui-tabs-loading")||this.running||b&&!u.collapsible||!1===this._trigger("beforeActivate",r,f)||(u.active=!w&&this.tabs.index(m),this.active=b?e():m,this.xhr&&this.xhr.abort(),x.length||A.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),A.length&&this.load(this.tabs.index(m),r),this._toggle(r,f))},_toggle:function(r,u){function f(){b.running=!1,b._trigger("activate",r,u)}function m(){b._addClass(u.newTab.closest("li"),"ui-tabs-active","ui-state-active"),w.length&&b.options.show?b._show(w,b.options.show,f):(w.show(),f())}var b=this,w=u.newPanel,A=u.oldPanel;this.running=!0,A.length&&this.options.hide?this._hide(A,this.options.hide,function(){b._removeClass(u.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),m()}):(this._removeClass(u.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),A.hide(),m()),A.attr("aria-hidden","true"),u.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),w.length&&A.length?u.oldTab.attr("tabIndex",-1):w.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),w.attr("aria-hidden","false"),u.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(r){(r=this._findActive(r))[0]!==this.active[0]&&(r.length||(r=this.active),r=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:r,currentTarget:r,preventDefault:e.noop}))},_findActive:function(r){return!1===r?e():this.tabs.eq(r)},_getIndex:function(r){return"string"==typeof r&&(r=this.anchors.index(this.anchors.filter("[href$='"+e.ui.escapeSelector(r)+"']"))),r},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var r=e(this),u=r.data("ui-tabs-aria-controls");u?r.attr("aria-controls",u).removeData("ui-tabs-aria-controls"):r.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(r){var u=this.options.disabled;!1!==u&&(void 0===r?u=!1:(r=this._getIndex(r),u=e.isArray(u)?e.map(u,function(f){return f!==r?f:null}):e.map(this.tabs,function(f,m){return m!==r?m:null})),this._setOptionDisabled(u))},disable:function(r){var u=this.options.disabled;if(!0!==u){if(void 0===r)u=!0;else{if(r=this._getIndex(r),-1!==e.inArray(r,u))return;u=e.isArray(u)?e.merge([r],u).sort():[r]}this._setOptionDisabled(u)}},load:function(r,u){r=this._getIndex(r);var f=this,m=this.tabs.eq(r);r=m.find(".ui-tabs-anchor");var b=this._getPanelForTab(m),w={tab:m,panel:b},A=function(x,y){"abort"===y&&f.panels.stop(!1,!0),f._removeClass(m,"ui-tabs-loading"),b.removeAttr("aria-busy"),x===f.xhr&&delete f.xhr};this._isLocal(r[0])||(this.xhr=e.ajax(this._ajaxSettings(r,u,w)))&&"canceled"!==this.xhr.statusText&&(this._addClass(m,"ui-tabs-loading"),b.attr("aria-busy","true"),this.xhr.done(function(x,y,S){setTimeout(function(){b.html(x),f._trigger("load",u,w),A(S,y)},1)}).fail(function(x,y){setTimeout(function(){A(x,y)},1)}))},_ajaxSettings:function(r,u,f){var m=this;return{url:r.attr("href").replace(/#.*$/,""),beforeSend:function(b,w){return m._trigger("beforeLoad",u,e.extend({jqXHR:b,ajaxSettings:w},f))}}},_getPanelForTab:function(r){return r=e(r).attr("aria-controls"),this.element.find(this._sanitizeSelector("#"+r))}}),!1!==e.uiBackCompat&&e.widget("ui.tabs",e.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),e.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var r=e(this).attr("title")||"";return e("<a>").text(r).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(r,u){var f=(r.attr("aria-describedby")||"").split(/\s+/);f.push(u),r.data("ui-tooltip-id",u).attr("aria-describedby",e.trim(f.join(" ")))},_removeDescribedBy:function(r){var u=r.data("ui-tooltip-id"),f=(r.attr("aria-describedby")||"").split(/\s+/);-1!==(u=e.inArray(u,f))&&f.splice(u,1),r.removeData("ui-tooltip-id"),(f=e.trim(f.join(" ")))?r.attr("aria-describedby",f):r.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=e([])},_setOption:function(r,u){var f=this;this._super(r,u),"content"===r&&e.each(this.tooltips,function(m,b){f._updateContent(b.element)})},_setOptionDisabled:function(r){this[r?"_disable":"_enable"]()},_disable:function(){var r=this;e.each(this.tooltips,function(u,f){(u=e.Event("blur")).target=u.currentTarget=f.element[0],r.close(u,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var u=e(this);if(u.is("[title]"))return u.data("ui-tooltip-title",u.attr("title")).removeAttr("title")}))},_enable:function(){this.disabledTitles.each(function(){var r=e(this);r.data("ui-tooltip-title")&&r.attr("title",r.data("ui-tooltip-title"))}),this.disabledTitles=e([])},open:function(r){var u=this,f=e(r?r.target:this.element).closest(this.options.items);f.length&&!f.data("ui-tooltip-id")&&(f.attr("title")&&f.data("ui-tooltip-title",f.attr("title")),f.data("ui-tooltip-open",!0),r&&"mouseover"===r.type&&f.parents().each(function(){var m=e(this);if(m.data("ui-tooltip-open")){var b=e.Event("blur");b.target=b.currentTarget=this,u.close(b,!0)}m.attr("title")&&(m.uniqueId(),u.parents[this.id]={element:this,title:m.attr("title")},m.attr("title",""))}),this._registerCloseHandlers(r,f),this._updateContent(f,r))},_updateContent:function(r,u){var f=this.options.content,m=this,b=u?u.type:null;if("string"==typeof f||f.nodeType||f.jquery)return this._open(u,r,f);(f=f.call(r[0],function(w){m._delay(function(){r.data("ui-tooltip-open")&&(u&&(u.type=b),this._open(u,r,w))})}))&&this._open(u,r,f)},_open:function(r,u,f){function m(y){w.of=y,A.is(":hidden")||A.position(w)}var b,w=e.extend({},this.options.position);if(f)if(b=this._find(u))b.tooltip.find(".ui-tooltip-content").html(f);else{u.is("[title]")&&(r&&"mouseover"===r.type?u.attr("title",""):u.removeAttr("title"));var A=(b=this._tooltip(u)).tooltip;if(this._addDescribedBy(u,A.attr("id")),A.find(".ui-tooltip-content").html(f),this.liveRegion.children().hide(),(f=e("<div>").html(A.find(".ui-tooltip-content").html())).removeAttr("name").find("[name]").removeAttr("name"),f.removeAttr("id").find("[id]").removeAttr("id"),f.appendTo(this.liveRegion),this.options.track&&r&&/^mouse/.test(r.type)?(this._on(this.document,{mousemove:m}),m(r)):A.position(e.extend({of:u},this.options.position)),A.hide(),this._show(A,this.options.show),this.options.track&&this.options.show&&this.options.show.delay)var x=this.delayedShow=setInterval(function(){A.is(":visible")&&(m(w.of),clearInterval(x))},e.fx.interval);this._trigger("open",r,{tooltip:A})}},_registerCloseHandlers:function(r,u){var f={keyup:function(m){m.keyCode===e.ui.keyCode.ESCAPE&&((m=e.Event(m)).currentTarget=u[0],this.close(m,!0))}};u[0]!==this.element[0]&&(f.remove=function(){this._removeTooltip(this._find(u).tooltip)}),r&&"mouseover"!==r.type||(f.mouseleave="close"),r&&"focusin"!==r.type||(f.focusout="close"),this._on(!0,u,f)},close:function(r){var u=this,f=e(r?r.currentTarget:this.element),m=this._find(f);if(m){var b=m.tooltip;m.closing||(clearInterval(this.delayedShow),f.data("ui-tooltip-title")&&!f.attr("title")&&f.attr("title",f.data("ui-tooltip-title")),this._removeDescribedBy(f),m.hiding=!0,b.stop(!0),this._hide(b,this.options.hide,function(){u._removeTooltip(e(this))}),f.removeData("ui-tooltip-open"),this._off(f,"mouseleave focusout keyup"),f[0]!==this.element[0]&&this._off(f,"remove"),this._off(this.document,"mousemove"),r&&"mouseleave"===r.type&&e.each(this.parents,function(w,A){e(A.element).attr("title",A.title),delete u.parents[w]}),m.closing=!0,this._trigger("close",r,{tooltip:b}),m.hiding||(m.closing=!1))}else f.removeData("ui-tooltip-open")},_tooltip:function(r){var u=e("<div>").attr("role","tooltip"),f=e("<div>").appendTo(u),m=u.uniqueId().attr("id");return this._addClass(f,"ui-tooltip-content"),this._addClass(u,"ui-tooltip","ui-widget ui-widget-content"),u.appendTo(this._appendTo(r)),this.tooltips[m]={element:r,tooltip:u}},_find:function(r){return(r=r.data("ui-tooltip-id"))?this.tooltips[r]:null},_removeTooltip:function(r){r.remove(),delete this.tooltips[r.attr("id")]},_appendTo:function(r){return(r=r.closest(".ui-front, dialog")).length||(r=this.document[0].body),r},_destroy:function(){var r=this;e.each(this.tooltips,function(u,f){var m=e.Event("blur");m.target=m.currentTarget=(f=f.element)[0],r.close(m,!0),e("#"+u).remove(),f.data("ui-tooltip-title")&&(f.attr("title")||f.attr("title",f.data("ui-tooltip-title")),f.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==e.uiBackCompat&&e.widget("ui.tooltip",e.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var r=this._superApply(arguments);return this.options.tooltipClass&&r.tooltip.addClass(this.options.tooltipClass),r}})}),($jscomp=$jscomp||{}).scope={},$jscomp.findInternal=function(e,t,s){e instanceof String&&(e=String(e));for(var o=e.length,n=0;n<o;n++){var a=e[n];if(t.call(s,a,n,e))return{i:n,v:a}}return{i:-1,v:void 0}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){e!=Array.prototype&&e!=Object.prototype&&(e[t]=s.value)},$jscomp.getGlobal=function(e){return typeof window<"u"&&window===e?e:typeof global<"u"&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,s,o){if(t){for(s=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var n=e[o];n in s||(s[n]={}),s=s[n]}(t=t(o=s[e=e[e.length-1]]))!=o&&null!=t&&$jscomp.defineProperty(s,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(t,s){return $jscomp.findInternal(this,t,s).v}},"es6","es3"),function(e,t){function o(x){return x.id&&e('label[for="'+x.id+'"]').val()||x.name}function n(x,y,S){return S||(S=0),y.each(function(){var _=e(this),C=this,I=this.nodeName.toLowerCase();if("label"===I&&_.find("input, textarea, select").length){var L=_.text();I=(C=(_=_.children().first()).get(0)).nodeName.toLowerCase()}switch(I){case"menu":var D={name:_.attr("label"),items:{}};S=n(D.items,_.children(),S);break;case"a":case"button":D={name:_.text(),disabled:!!_.attr("disabled"),callback:function(){_.get(0).click()}};break;case"menuitem":case"command":switch(_.attr("type")){case t:case"command":case"menuitem":D={name:_.attr("label"),disabled:!!_.attr("disabled"),icon:_.attr("icon"),callback:function(){_.get(0).click()}};break;case"checkbox":D={type:"checkbox",disabled:!!_.attr("disabled"),name:_.attr("label"),selected:!!_.attr("checked")};break;case"radio":D={type:"radio",disabled:!!_.attr("disabled"),name:_.attr("label"),radio:_.attr("radiogroup"),value:_.attr("id"),selected:!!_.attr("checked")};break;default:D=t}break;case"hr":D="-------";break;case"input":switch(_.attr("type")){case"text":D={type:"text",name:L||o(C),disabled:!!_.attr("disabled"),value:_.val()};break;case"checkbox":D={type:"checkbox",name:L||o(C),disabled:!!_.attr("disabled"),selected:!!_.attr("checked")};break;case"radio":D={type:"radio",name:L||o(C),disabled:!!_.attr("disabled"),radio:!!_.attr("name"),value:_.val(),selected:!!_.attr("checked")};break;default:D=t}break;case"select":D={type:"select",name:L||o(C),disabled:!!_.attr("disabled"),selected:_.val(),options:{}},_.children().each(function(){D.options[this.value]=e(this).text()});break;case"textarea":D={type:"textarea",name:L||o(C),disabled:!!_.attr("disabled"),value:_.val()};break;case"label":break;default:D={type:"html",html:_.clone(!0)}}D&&(S++,x["key"+S]=D)}),S}var x;e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement,e.ui&&e.widget||(e.cleanData=(x=e.cleanData,function(y){var S,_;for(_=0;null!=y[_];_++){var C=y[_];try{(S=e._data(C,"events"))&&S.remove&&e(C).triggerHandler("remove")}catch{}}x(y)}));var m,a=null,l=!1,c=e(window),d=0,h={},p={},g={},v={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,hideOnSecondTrigger:!1,selectableSubMenu:!1,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function(x){if(e.ui&&e.ui.position)x.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var y=this.offset();y.top+=this.outerHeight(),y.left+=this.outerWidth()/2-x.outerWidth()/2,x.css(y)}},position:function(x,y,S){if(y||S){if("maintain"===y&&"maintain"===S)y=x.$menu.position();else{var _=x.$menu.offsetParent().offset();y={top:S-_.top,left:y-_.left}}S=c.scrollTop()+c.height(),_=c.scrollLeft()+c.width();var C=x.$menu.outerHeight(),I=x.$menu.outerWidth();y.top+C>S&&(y.top-=C),0>y.top&&(y.top=0),y.left+I>_&&(y.left-=I),0>y.left&&(y.left=0),x.$menu.css(y)}else x.determinePosition.call(this,x.$menu)},positionSubmenu:function(x){if(typeof x<"u")if(e.ui&&e.ui.position)x.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var y={top:-9,left:this.outerWidth()-5};x.css(y)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{preShow:e.noop,show:e.noop,hide:e.noop,activated:e.noop},callback:null,items:{}},r=null,u=null,f=null,w={abortevent:function(x){x.preventDefault(),x.stopImmediatePropagation()},contextmenu:function(x){var y=e(this);if(!1!==x.data.events.preShow(y,x)&&("right"===x.data.trigger&&(x.preventDefault(),x.stopImmediatePropagation()),!("right"!==x.data.trigger&&"demand"!==x.data.trigger&&x.originalEvent||typeof x.mouseButton<"u"&&x.data&&!("left"===x.data.trigger&&0===x.mouseButton||"right"===x.data.trigger&&2===x.mouseButton)||y.hasClass("context-menu-active")||y.hasClass("context-menu-disabled")))){if(a=y,x.data.build){var S=x.data.build(a,x);if(!1===S)return;if(x.data=e.extend(!0,{},v,x.data,S||{}),!x.data.items||e.isEmptyObject(x.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),Error("No Items specified");x.data.$trigger=a,A.create(x.data)}A.show.call(y,x.data,x.pageX,x.pageY)}},click:function(x){x.preventDefault(),x.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:x.data,pageX:x.pageX,pageY:x.pageY}))},mousedown:function(x){var y=e(this);a&&a.length&&!a.is(y)&&a.data("contextMenu").$menu.trigger("contextmenu:hide"),2===x.button&&(a=y.data("contextMenuActive",!0))},mouseup:function(x){var y=e(this);y.data("contextMenuActive")&&a&&a.length&&a.is(y)&&!y.hasClass("context-menu-disabled")&&(x.preventDefault(),x.stopImmediatePropagation(),a=y,y.trigger(e.Event("contextmenu",{data:x.data,pageX:x.pageX,pageY:x.pageY}))),y.removeData("contextMenuActive")},mouseenter:function(x){var y=e(this),S=e(x.relatedTarget),_=e(document);S.is(".context-menu-list")||S.closest(".context-menu-list").length||a&&a.length||(u=x.pageX,f=x.pageY,m=x.data,_.on("mousemove.contextMenuShow",w.mousemove),r=setTimeout(function(){r=null,_.off("mousemove.contextMenuShow"),a=y,y.trigger(e.Event("contextmenu",{data:m,pageX:u,pageY:f}))},x.data.delay))},mousemove:function(x){u=x.pageX,f=x.pageY},mouseleave:function(x){if(!(x=e(x.relatedTarget)).is(".context-menu-list")&&!x.closest(".context-menu-list").length){try{clearTimeout(r)}catch{}r=null}},layerClick:function(x){var L,D,y=e(this).data("contextMenuRoot"),S=x.button,_=x.pageX,C=x.pageY,I=_===t;x.preventDefault(),setTimeout(function(){if(I)null!==y&&typeof y<"u"&&null!==y.$menu&&typeof y.$menu<"u"&&y.$menu.trigger("contextmenu:hide");else{var O="left"===y.trigger&&0===S||"right"===y.trigger&&2===S;if(document.elementFromPoint&&y.$layer){if(y.$layer.hide(),(L=document.elementFromPoint(_-c.scrollLeft(),C-c.scrollTop())).isContentEditable){var M=document.createRange(),E=window.getSelection();M.selectNode(L),M.collapse(!0),E.removeAllRanges(),E.addRange(M)}e(L).trigger(x),y.$layer.show()}if(y.hideOnSecondTrigger&&O&&null!==y.$menu&&typeof y.$menu<"u")y.$menu.trigger("contextmenu:hide");else{if(y.reposition&&O)if(document.elementFromPoint){if(y.$trigger.is(L))return void y.position.call(y.$trigger,y,_,C)}else if(D=y.$trigger.offset(),M=e(window),D.top+=M.scrollTop(),D.top<=x.pageY&&(D.left+=M.scrollLeft(),D.left<=x.pageX&&(D.bottom=D.top+y.$trigger.outerHeight(),D.bottom>=x.pageY&&(D.right=D.left+y.$trigger.outerWidth(),D.right>=x.pageX))))return void y.position.call(y.$trigger,y,_,C);L&&O&&y.$trigger.one("contextmenu:hidden",function(){e(L).contextMenu({x:_,y:C,button:S})}),null!==y&&typeof y<"u"&&null!==y.$menu&&typeof y.$menu<"u"&&y.$menu.trigger("contextmenu:hide")}}},50)},keyStop:function(x,y){y.isInput||x.preventDefault(),x.stopPropagation()},key:function(x){var y={};a&&(y=a.data("contextMenu")||{}),typeof y.zIndex>"u"&&(y.zIndex=0);var S=0,_=function(I){""!==I.style.zIndex?S=I.style.zIndex:null!==I.offsetParent&&typeof I.offsetParent<"u"?_(I.offsetParent):null!==I.parentElement&&typeof I.parentElement<"u"&&_(I.parentElement)};if(_(x.target),!(y.$menu&&parseInt(S,10)>parseInt(y.$menu.css("zIndex"),10))){switch(x.keyCode){case 9:case 38:if(w.keyStop(x,y),y.isInput){if(9===x.keyCode&&x.shiftKey)return x.preventDefault(),y.$selected&&y.$selected.find("input, textarea, select").blur(),void(null!==y.$menu&&typeof y.$menu<"u"&&y.$menu.trigger("prevcommand"));if(38===x.keyCode&&"checkbox"===y.$selected.find("input, textarea, select").prop("type"))return void x.preventDefault()}else if(9!==x.keyCode||x.shiftKey)return void(null!==y.$menu&&typeof y.$menu<"u"&&y.$menu.trigger("prevcommand"));break;case 40:if(w.keyStop(x,y),!y.isInput)return void(null!==y.$menu&&typeof y.$menu<"u"&&y.$menu.trigger("nextcommand"));if(9===x.keyCode)return x.preventDefault(),y.$selected&&y.$selected.find("input, textarea, select").blur(),void(null!==y.$menu&&typeof y.$menu<"u"&&y.$menu.trigger("nextcommand"));if(40===x.keyCode&&"checkbox"===y.$selected.find("input, textarea, select").prop("type"))return void x.preventDefault();break;case 37:if(w.keyStop(x,y),y.isInput||!y.$selected||!y.$selected.length)break;if(!y.$selected.parent().hasClass("context-menu-root"))return x=y.$selected.parent().parent(),y.$selected.trigger("contextmenu:blur"),void(y.$selected=x);break;case 39:if(w.keyStop(x,y),y.isInput||!y.$selected||!y.$selected.length)break;var C=y.$selected.data("contextMenu")||{};if(C.$menu&&y.$selected.hasClass("context-menu-submenu"))return y.$selected=null,C.$selected=null,void C.$menu.trigger("nextcommand");break;case 35:case 36:return void(y.$selected&&y.$selected.find("input, textarea, select").length||((y.$selected&&y.$selected.parent()||y.$menu).children(":not(."+y.classNames.disabled+", ."+y.classNames.notSelectable+")")[36===x.keyCode?"first":"last"]().trigger("contextmenu:focus"),x.preventDefault()));case 13:if(w.keyStop(x,y),y.isInput){if(y.$selected&&!y.$selected.is("textarea, select"))return void x.preventDefault();break}return void(typeof y.$selected<"u"&&null!==y.$selected&&y.$selected.trigger("mouseup"));case 32:case 33:case 34:return void w.keyStop(x,y);case 27:return w.keyStop(x,y),void(null!==y.$menu&&typeof y.$menu<"u"&&y.$menu.trigger("contextmenu:hide"));default:if(C=String.fromCharCode(x.keyCode).toUpperCase(),y.accesskeys&&y.accesskeys[C])return void y.accesskeys[C].$node.trigger(y.accesskeys[C].$menu?"contextmenu:focus":"mouseup")}x.stopPropagation(),typeof y.$selected<"u"&&null!==y.$selected&&y.$selected.trigger(x)}},prevItem:function(x){x.stopPropagation();var y=e(this).data("contextMenu")||{},S=e(this).data("contextMenuRoot")||{};if(y.$selected){var _=y.$selected;(y=y.$selected.parent().data("contextMenu")||{}).$selected=_}_=y.$menu.children();for(var C=y.$selected&&y.$selected.prev().length?y.$selected.prev():_.last(),I=C;C.hasClass(S.classNames.disabled)||C.hasClass(S.classNames.notSelectable)||C.is(":hidden");)if((C=C.prev().length?C.prev():_.last()).is(I))return;y.$selected&&w.itemMouseleave.call(y.$selected.get(0),x),w.itemMouseenter.call(C.get(0),x),(x=C.find("input, textarea, select")).length&&x.focus()},nextItem:function(x){x.stopPropagation();var y=e(this).data("contextMenu")||{},S=e(this).data("contextMenuRoot")||{};if(y.$selected){var _=y.$selected;(y=y.$selected.parent().data("contextMenu")||{}).$selected=_}_=y.$menu.children();for(var C=y.$selected&&y.$selected.next().length?y.$selected.next():_.first(),I=C;C.hasClass(S.classNames.disabled)||C.hasClass(S.classNames.notSelectable)||C.is(":hidden");)if((C=C.next().length?C.next():_.first()).is(I))return;y.$selected&&w.itemMouseleave.call(y.$selected.get(0),x),w.itemMouseenter.call(C.get(0),x),(x=C.find("input, textarea, select")).length&&x.focus()},focusInput:function(){var x=e(this).closest(".context-menu-item"),y=x.data(),S=y.contextMenu;(y=y.contextMenuRoot).$selected=S.$selected=x,y.isInput=S.isInput=!0},blurInput:function(){var x=e(this).closest(".context-menu-item").data();x.contextMenuRoot.isInput=x.contextMenu.isInput=!1},menuMouseenter:function(){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(x){var y=e(this).data().contextMenuRoot;y.$layer&&y.$layer.is(x.relatedTarget)&&(y.hovering=!1)},itemMouseenter:function(x){var y=e(this),S=y.data(),_=S.contextMenu;(S=S.contextMenuRoot).hovering=!0,x&&S.$layer&&S.$layer.is(x.relatedTarget)&&(x.preventDefault(),x.stopImmediatePropagation()),(_.$menu?_:S).$menu.children("."+S.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),y.hasClass(S.classNames.disabled)||y.hasClass(S.classNames.notSelectable)?_.$selected=null:y.trigger("contextmenu:focus")},itemMouseleave:function(x){var y=e(this),S=y.data(),_=S.contextMenu;(S=S.contextMenuRoot)!==_&&S.$layer&&S.$layer.is(x.relatedTarget)?(typeof S.$selected<"u"&&null!==S.$selected&&S.$selected.trigger("contextmenu:blur"),x.preventDefault(),x.stopImmediatePropagation(),S.$selected=_.$selected=_.$node):_&&_.$menu&&_.$menu.hasClass("context-menu-visible")||y.trigger("contextmenu:blur")},itemClick:function(x){var y=e(this),S=y.data(),_=S.contextMenu,C=S.contextMenuRoot;if(!(!_.items[S=S.contextMenuKey]||y.is("."+C.classNames.disabled+", .context-menu-separator, ."+C.classNames.notSelectable)||y.is(".context-menu-submenu")&&!1===C.selectableSubMenu)){if(x.preventDefault(),x.stopImmediatePropagation(),e.isFunction(_.callbacks[S])&&Object.prototype.hasOwnProperty.call(_.callbacks,S))y=_.callbacks[S];else{if(!e.isFunction(C.callback))return;y=C.callback}!1!==y.call(C.$trigger,S,C,x)?C.$menu.trigger("contextmenu:hide"):C.$menu.parent().length&&A.update.call(C.$trigger,C)}},inputClick:function(x){x.stopImmediatePropagation()},hideMenu:function(x,y){x=e(this).data("contextMenuRoot"),A.hide.call(x.$trigger,x,y&&y.force)},focusItem:function(x){x.stopPropagation();var y=(x=e(this)).data(),S=y.contextMenu;x.hasClass((y=y.contextMenuRoot).classNames.disabled)||x.hasClass(y.classNames.notSelectable)||(x.addClass([y.classNames.hover,y.classNames.visible].join(" ")).parent().find(".context-menu-item").not(x).removeClass(y.classNames.visible).filter("."+y.classNames.hover).trigger("contextmenu:blur"),S.$selected=y.$selected=x,S&&S.$node&&S.$node.hasClass("context-menu-submenu")&&S.$node.addClass(y.classNames.hover),S.$node&&y.positionSubmenu.call(S.$node,S.$menu))},blurItem:function(x){x.stopPropagation();var y=(x=e(this)).data(),S=y.contextMenu;y=y.contextMenuRoot,S.autoHide&&x.removeClass(y.classNames.visible),x.removeClass(y.classNames.hover),S.$selected=null}},A={show:function(x,y,S){var _=e(this),C={};e("#context-menu-layer").trigger("mousedown"),x.$trigger=_,!1===x.events.show.call(_,x)||!1===A.update.call(_,x)?a=null:(x.position.call(_,x,y,S),x.zIndex&&(y=x.zIndex,"function"==typeof x.zIndex&&(y=x.zIndex.call(_,x)),C.zIndex=function(x){for(var y=0;y=Math.max(y,parseInt(x.css("z-index"),10)||0),(x=x.parent())&&x.length&&!(-1<"html body".indexOf(x.prop("nodeName").toLowerCase())););return y}(_)+y),A.layer.call(x.$menu,x,C.zIndex),x.$menu.find("ul").css("zIndex",C.zIndex+1),x.$menu.css(C)[x.animation.show](x.animation.duration,function(){_.trigger("contextmenu:visible"),A.activated(x),x.events.activated(x)}),_.data("contextMenu",x).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",w.key),x.autoHide&&e(document).on("mousemove.contextMenuAutoHide",function(I){var L=_.offset();L.right=L.left+_.outerWidth(),L.bottom=L.top+_.outerHeight(),!x.$layer||x.hovering||I.pageX>=L.left&&I.pageX<=L.right&&I.pageY>=L.top&&I.pageY<=L.bottom||setTimeout(function(){x.hovering||null===x.$menu||typeof x.$menu>"u"||x.$menu.trigger("contextmenu:hide")},50)}))},hide:function(x,y){var _,S=e(this);if(x||(x=S.data("contextMenu")||{}),y||!x.events||!1!==x.events.hide.call(S,x)){if(S.removeData("contextMenu").removeClass("context-menu-active"),x.$layer){setTimeout((_=x.$layer,function(){_.remove()}),10);try{delete x.$layer}catch{x.$layer=null}}a=null,x.$menu.find("."+x.classNames.hover).trigger("contextmenu:blur"),x.$selected=null,x.$menu.find("."+x.classNames.visible).removeClass(x.classNames.visible),e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),x.$menu&&x.$menu[x.animation.hide](x.animation.duration,function(){x.build&&(x.$menu.remove(),e.each(x,function(_){switch(_){case"ns":case"selector":case"build":case"trigger":return!0;default:x[_]=t;try{delete x[_]}catch{}return!0}})),setTimeout(function(){S.trigger("contextmenu:hidden")},10)})}},create:function(x,y){function S(_){var C=e("<span></span>");if(_._accesskey)_._beforeAccesskey&&C.append(document.createTextNode(_._beforeAccesskey)),e("<span></span>").addClass("context-menu-accesskey").text(_._accesskey).appendTo(C),_._afterAccesskey&&C.append(document.createTextNode(_._afterAccesskey));else if(_.isHtmlName){if(typeof _.accesskey<"u")throw Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");C.html(_.name)}else C.text(_.name);return C}typeof y>"u"&&(y=x),x.$menu=e('<ul class="context-menu-list"></ul>').addClass(x.className||"").data({contextMenu:x,contextMenuRoot:y}),e.each(["callbacks","commands","inputs"],function(_,C){x[C]={},y[C]||(y[C]={})}),y.accesskeys||(y.accesskeys={}),e.each(x.items,function(_,C){var I=e('<li class="context-menu-item"></li>').addClass(C.className||""),L=null,D=null;if(I.on("click",e.noop),("string"==typeof C||"cm_separator"===C.type)&&(C={type:"cm_seperator"}),C.$node=I.data({contextMenu:x,contextMenuRoot:y,contextMenuKey:_}),typeof C.accesskey<"u")for(var E,O=function s(x){x=x.split(/\s+/);for(var _,y=[],S=0;_=x[S];S++)_=_.charAt(0).toUpperCase(),y.push(_);return y}(C.accesskey),M=0;E=O[M];M++)if(!y.accesskeys[E]){y.accesskeys[E]=C,(O=C.name.match(new RegExp("^(.*?)("+E+")(.*)$","i")))&&(C._beforeAccesskey=O[1],C._accesskey=O[2],C._afterAccesskey=O[3]);break}if(C.type&&g[C.type])g[C.type].call(I,C,x,y),e.each([x,y],function(R,H){H.commands[_]=C,!e.isFunction(C.callback)||typeof H.callbacks[_]<"u"&&typeof x.type<"u"||(H.callbacks[_]=C.callback)});else{switch("cm_seperator"===C.type?I.addClass("context-menu-separator "+y.classNames.notSelectable):"html"===C.type?I.addClass("context-menu-html "+y.classNames.notSelectable):"sub"!==C.type&&C.type?(L=e("<label></label>").appendTo(I),S(C).appendTo(L),I.addClass("context-menu-input"),x.hasTypes=!0,e.each([x,y],function(R,H){H.commands[_]=C,H.inputs[_]=C})):C.items&&(C.type="sub"),C.type){case"cm_seperator":break;case"text":D=e('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+_).val(C.value||"").appendTo(L);break;case"textarea":D=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+_).val(C.value||"").appendTo(L),C.height&&D.height(C.height);break;case"checkbox":D=e('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+_).val(C.value||"").prop("checked",!!C.selected).prependTo(L);break;case"radio":D=e('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+C.radio).val(C.value||"").prop("checked",!!C.selected).prependTo(L);break;case"select":D=e('<select name=""></select>').attr("name","context-menu-input-"+_).appendTo(L),C.options&&(e.each(C.options,function(R,H){e("<option></option>").val(R).text(H).appendTo(D)}),D.val(C.selected));break;case"sub":S(C).appendTo(I),C.appendTo=C.$node,I.data("contextMenu",C).addClass("context-menu-submenu"),C.callback=null,"function"==typeof C.items.then?A.processPromises(C,y,C.items):A.create(C,y);break;case"html":e(C.html).appendTo(I);break;default:e.each([x,y],function(R,H){H.commands[_]=C,!e.isFunction(C.callback)||typeof H.callbacks[_]<"u"&&typeof x.type<"u"||(H.callbacks[_]=C.callback)}),S(C).appendTo(I)}C.type&&"sub"!==C.type&&"html"!==C.type&&"cm_seperator"!==C.type&&(D.on("focus",w.focusInput).on("blur",w.blurInput),C.events)&&D.on(C.events,x),C.icon&&(e.isFunction(C.icon)?C._icon=C.icon.call(this,this,I,_,C):"string"!=typeof C.icon||"fab "!==C.icon.substring(0,4)&&"fas "!==C.icon.substring(0,4)&&"far "!==C.icon.substring(0,4)&&"fal "!==C.icon.substring(0,4)?C._icon="string"==typeof C.icon&&"fa-"===C.icon.substring(0,3)?y.classNames.icon+" "+y.classNames.icon+"--fa fa "+C.icon:y.classNames.icon+" "+y.classNames.icon+"-"+C.icon:(I.addClass(y.classNames.icon+" "+y.classNames.icon+"--fa5"),C._icon=e('<i class="'+C.icon+'"></i>')),"string"==typeof C._icon?I.addClass(C._icon):I.prepend(C._icon))}C.$input=D,C.$label=L,I.appendTo(x.$menu),!x.hasTypes&&e.support.eventSelectstart&&I.on("selectstart.disableTextSelect",w.abortevent)}),x.$node||x.$menu.css("display","none").addClass("context-menu-root"),x.$menu.appendTo(x.appendTo||document.body)},resize:function(x,y){var S;x.css({position:"absolute",display:"block"}),x.data("width",(S=x.get(0)).getBoundingClientRect?Math.ceil(S.getBoundingClientRect().width):x.outerWidth()+1),x.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),x.find("> li > ul").each(function(){A.resize(e(this),!0)}),y||x.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return e(this).data("width")})},update:function(x,y){var S=this;typeof y>"u"&&(y=x,A.resize(x.$menu));var _=!1;return x.$menu.children().each(function(){var O,C=e(this),I=C.data("contextMenuKey"),L=x.items[I],D=e.isFunction(L.disabled)&&L.disabled.call(S,I,y)||!0===L.disabled;if((O=e.isFunction(L.visible)?L.visible.call(S,I,y):!(typeof L.visible<"u")||!0===L.visible)&&(_=!0),C[O?"show":"hide"](),C[D?"addClass":"removeClass"](y.classNames.disabled),e.isFunction(L.icon)&&(C.removeClass(L._icon),"string"==typeof(I=L.icon.call(this,S,C,I,L))?C.addClass(I):C.prepend(I)),L.type)switch(C.find("input, select, textarea").prop("disabled",D),L.type){case"text":case"textarea":L.$input.val(L.value||"");break;case"checkbox":case"radio":L.$input.val(L.value||"").prop("checked",!!L.selected);break;case"select":L.$input.val((0===L.selected?"0":L.selected)||"")}L.$menu&&A.update.call(S,L,y)&&(_=!0)}),_},layer:function(x,y){return x=x.$layer=e('<div id="context-menu-layer"></div>').css({height:c.height(),width:c.width(),display:"block",position:"fixed","z-index":y,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",x).insertBefore(this).on("contextmenu",w.abortevent).on("mousedown",w.layerClick),typeof document.body.style.maxWidth>"u"&&x.css({position:"absolute",height:e(document).height()}),x},processPromises:function(x,y,S){function _(I,L,D){typeof D>"u"?(D={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}},window.console&&(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')):"string"==typeof D&&(D={error:{name:D}}),C(I,L,D)}function C(I,L,D){typeof L.$menu<"u"&&L.$menu.is(":visible")&&(I.$node.removeClass(L.classNames.iconLoadingClass),I.items=D,A.create(I,L,!0),A.update(I,L),L.positionSubmenu.call(I.$node,I.$menu))}x.$node.addClass(y.classNames.iconLoadingClass),S.then(function(I,L,D){typeof D>"u"&&_(t),C(I,L,D)}.bind(this,x,y),_.bind(this,x,y))},activated:function(x){var y=(x=x.$menu).offset(),S=e(window).height(),_=e(window).scrollTop(),C=x.height();C>S?x.css({height:S+"px","overflow-x":"hidden","overflow-y":"auto",top:_+"px"}):(y.top<_||y.top+C>_+S)&&x.css({top:_+"px"})}};e.fn.contextMenu=function(x){var y=this;if(0<this.length)if(typeof x>"u")this.first().trigger("contextmenu");else if(typeof x.x<"u"&&typeof x.y<"u")this.first().trigger(e.Event("contextmenu",{pageX:x.x,pageY:x.y,mouseButton:x.button}));else if("hide"===x){var S=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;S&&S.trigger("contextmenu:hide")}else"destroy"===x?e.contextMenu("destroy",{context:this}):e.isPlainObject(x)?(x.context=this,e.contextMenu("create",x)):x?this.removeClass("context-menu-disabled"):x||this.addClass("context-menu-disabled");else e.each(p,function(){this.selector===y.selector&&(x.data=this,e.extend(x.data,{trigger:"demand"}))}),w.contextmenu.call(x.target,x);return this},e.contextMenu=function(x,y){"string"!=typeof x&&(y=x,x="create"),"string"==typeof y?y={selector:y}:typeof y>"u"&&(y={});var S=e.extend(!0,{},v,y||{}),_=e(document),C=_,I=!1;switch(S.context&&S.context.length?(C=e(S.context).first(),S.context=C.get(0),I=!e(S.context).is(document)):S.context=document,x){case"update":if(I)A.update(C);else for(var L in p)p.hasOwnProperty(L)&&A.update(p[L]);break;case"create":if(!S.selector)throw Error("No selector specified");if(S.selector.match(/.context-menu-(list|item|input)($|\s)/))throw Error('Cannot bind to selector "'+S.selector+'" as it contains a reserved className');if(!S.build&&(!S.items||e.isEmptyObject(S.items)))throw Error("No Items specified");switch(d++,S.ns=".contextMenu"+d,I||(h[S.selector]=S.ns),p[S.ns]=S,S.trigger||(S.trigger="right"),l||((x={"contextmenu:focus.contextMenu":w.focusItem,"contextmenu:blur.contextMenu":w.blurItem,"contextmenu.contextMenu":w.abortevent,"mouseenter.contextMenu":w.itemMouseenter,"mouseleave.contextMenu":w.itemMouseleave})["click"===S.itemClickEvent?"click.contextMenu":"mouseup.contextMenu"]=w.itemClick,_.on({"contextmenu:hide.contextMenu":w.hideMenu,"prevcommand.contextMenu":w.prevItem,"nextcommand.contextMenu":w.nextItem,"contextmenu.contextMenu":w.abortevent,"mouseenter.contextMenu":w.menuMouseenter,"mouseleave.contextMenu":w.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",w.inputClick).on(x,".context-menu-item"),l=!0),C.on("contextmenu"+S.ns,S.selector,S,w.contextmenu),I&&C.on("remove"+S.ns,function(){e(this).contextMenu("destroy")}),S.trigger){case"hover":C.on("mouseenter"+S.ns,S.selector,S,w.mouseenter).on("mouseleave"+S.ns,S.selector,S,w.mouseleave);break;case"left":C.on("click"+S.ns,S.selector,S,w.click);break;case"touchstart":C.on("touchstart"+S.ns,S.selector,S,w.click)}S.build||A.create(S);break;case"destroy":if(I){var D=S.context;e.each(p,function(M,E){if(!E||!e(D).is(E.selector))return!0;(O=e(".context-menu-list").filter(":visible")).length&&O.data().contextMenuRoot.$trigger.is(e(E.context).find(E.selector))&&O.trigger("contextmenu:hide",{force:!0});try{p[E.ns].$menu&&p[E.ns].$menu.remove(),delete p[E.ns]}catch{p[E.ns]=null}return e(E.context).off(E.ns),!0})}else if(S.selector){if(h[S.selector]){var O=e(".context-menu-list").filter(":visible");O.length&&O.data().contextMenuRoot.$trigger.is(S.selector)&&O.trigger("contextmenu:hide",{force:!0});try{p[h[S.selector]].$menu&&p[h[S.selector]].$menu.remove(),delete p[h[S.selector]]}catch{p[h[S.selector]]=null}_.off(h[S.selector])}}else _.off(".contextMenu .contextMenuAutoHide"),e.each(p,function(M,E){e(E.context).off(E.ns)}),h={},p={},d=0,l=!1,e("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof y&&y)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw Error('Unknown operation "'+x+'"')}return this},e.contextMenu.setInputValues=function(x,y){typeof y>"u"&&(y={}),e.each(x.inputs,function(S,_){switch(_.type){case"text":case"textarea":_.value=y[S]||"";break;case"checkbox":_.selected=!!y[S];break;case"radio":_.selected=(y[_.radio]||"")===_.value;break;case"select":_.selected=y[S]||""}})},e.contextMenu.getInputValues=function(x,y){return typeof y>"u"&&(y={}),e.each(x.inputs,function(S,_){switch(_.type){case"text":case"textarea":case"select":y[S]=_.$input.val();break;case"checkbox":y[S]=_.$input.prop("checked");break;case"radio":_.$input.prop("checked")&&(y[_.radio]=_.value)}}),y},e.contextMenu.fromMenu=function(x){var y={};return n(y,(x=e(x)).children()),y},e.contextMenu.defaults=v,e.contextMenu.types=g,e.contextMenu.handle=w,e.contextMenu.op=A,e.contextMenu.menus=p}(jQuery),($jscomp=$jscomp||{}).scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){e!=Array.prototype&&e!=Object.prototype&&(e[t]=s.value)},$jscomp.getGlobal=function(e){return typeof window<"u"&&window===e?e:typeof global<"u"&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,s,o){if(t){for(s=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var n=e[o];n in s||(s[n]={}),s=s[n]}(t=t(o=s[e=e[e.length-1]]))!=o&&null!=t&&$jscomp.defineProperty(s,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.fill",function(e){return e||function(t,s,o){var n=this.length||0;for(0>s&&(s=Math.max(0,n+s)),(null==o||o>n)&&(o=n),0>(o=Number(o))&&(o=Math.max(0,n+o)),s=Number(s||0);s<o;s++)this[s]=t;return this}},"es6","es3"),$jscomp.findInternal=function(e,t,s){e instanceof String&&(e=String(e));for(var o=e.length,n=0;n<o;n++){var a=e[n];if(t.call(s,a,n,e))return{i:n,v:a}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(t,s){return $jscomp.findInternal(this,t,s).v}},"es6","es3"),function(e){e.color={},e.color.make=function(s,o,n,a){var l={};return l.r=s||0,l.g=o||0,l.b=n||0,l.a=a??1,l.add=function(c,d){for(var h=0;h<c.length;++h)l[c.charAt(h)]+=d;return l.normalize()},l.scale=function(c,d){for(var h=0;h<c.length;++h)l[c.charAt(h)]*=d;return l.normalize()},l.toString=function(){return 1<=l.a?"rgb("+[l.r,l.g,l.b].join()+")":"rgba("+[l.r,l.g,l.b,l.a].join()+")"},l.normalize=function(){function c(d,h,p){return h<d?d:h>p?p:h}return l.r=c(0,parseInt(l.r),255),l.g=c(0,parseInt(l.g),255),l.b=c(0,parseInt(l.b),255),l.a=c(0,l.a,1),l},l.clone=function(){return e.color.make(l.r,l.b,l.g,l.a)},l.normalize()},e.color.extract=function(s,o){do{var n=s.css(o).toLowerCase();if(""!=n&&"transparent"!=n)break;s=s.parent()}while(s.length&&!e.nodeName(s.get(0),"body"));return"rgba(0, 0, 0, 0)"==n&&(n="transparent"),e.color.parse(n)},e.color.parse=function(s){var o,n=e.color.make;return(o=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(s))?n(parseInt(o[1],10),parseInt(o[2],10),parseInt(o[3],10)):(o=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(s))?n(parseInt(o[1],10),parseInt(o[2],10),parseInt(o[3],10),parseFloat(o[4])):(o=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*\)/.exec(s))?n(2.55*parseFloat(o[1]),2.55*parseFloat(o[2]),2.55*parseFloat(o[3])):(o=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(s))?n(2.55*parseFloat(o[1]),2.55*parseFloat(o[2]),2.55*parseFloat(o[3]),parseFloat(o[4])):(o=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(s))?n(parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)):(o=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(s))?n(parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)):"transparent"==(s=e.trim(s).toLowerCase())?n(255,255,255,0):n((o=t[s]||[0,0,0])[0],o[1],o[2])};var t={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(e){function t(n,a){var l=a.children("."+n)[0];if(null==l&&((l=document.createElement("canvas")).className=n,e(l).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(a),!l.getContext)){if(!window.G_vmlCanvasManager)throw Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");l=window.G_vmlCanvasManager.initElement(l)}this.element=l,n=this.context=l.getContext("2d"),this.pixelRatio=(window.devicePixelRatio||1)/(n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1),this.resize(a.width(),a.height()),this.textContainer=null,this.text={},this._textCache={}}function s(n,a,l,c){function d(W,K){K=[$e].concat(K);for(var ne=0;ne<W.length;++ne)W[ne].apply(this,K)}function h(W){for(var K=[],ne=0;ne<W.length;++ne){var oe=e.extend(!0,{},Q.series);null!=W[ne].data?(oe.data=W[ne].data,delete W[ne].data,e.extend(!0,oe,W[ne]),W[ne].data=oe.data):oe.data=W[ne],K.push(oe)}for(ne=(te=K).length,K=-1,W=0;W<te.length;++W)null!=(oe=te[W].color)&&(ne--,"number"==typeof oe&&oe>K&&(K=oe));ne<=K&&(ne=K+1),K=[];var se=Q.colors,ve=se.length,pe=0;for(W=0;W<ne;W++)oe=e.color.parse(se[W%ve]||"#666"),W%ve==0&&W&&(pe=0<=pe?.5>pe?-pe-.2:0:-pe),K[W]=oe.scale("rgb",1+pe);for(W=ne=0;W<te.length;++W){if(null==(oe=te[W]).color?(oe.color=K[ne].toString(),++ne):"number"==typeof oe.color&&(oe.color=K[oe.color].toString()),null==oe.lines.show){var Ae;for(Ae in se=!0,oe)if(oe[Ae]&&oe[Ae].show){se=!1;break}se&&(oe.lines.show=!0)}null==oe.lines.zero&&(oe.lines.zero=!!oe.lines.fill),oe.xaxis=r(Se,p(oe,"x")),oe.yaxis=r(Y,p(oe,"y"))}!function u(){function W(ze,Be,Qe){Be<ze.datamin&&Be!=-oe&&(ze.datamin=Be),Qe>ze.datamax&&Qe!=oe&&(ze.datamax=Qe)}var se,ve,pe,Ae,we,K=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,oe=Number.MAX_VALUE;for(e.each(g(),function(ze,Be){Be.datamin=K,Be.datamax=ne,Be.used=!1}),se=0;se<te.length;++se){var me=te[se];me.datapoints={points:[]},d(Ee.processRawData,[me,me.data,me.datapoints])}for(se=0;se<te.length;++se){var De=(me=te[se]).data,Ne=me.datapoints.format;if(Ne||((Ne=[]).push({x:!0,number:!0,required:!0}),Ne.push({y:!0,number:!0,required:!0}),(me.bars.show||me.lines.show&&me.lines.fill)&&(Ne.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:!!(me.bars.show&&me.bars.zero||me.lines.show&&me.lines.zero)}),me.bars.horizontal&&(delete Ne[Ne.length-1].y,Ne[Ne.length-1].x=!0)),me.datapoints.format=Ne),null==me.datapoints.pointsize){me.datapoints.pointsize=Ne.length;var He=me.datapoints.pointsize,Je=me.datapoints.points,st=me.lines.show&&me.lines.steps;for(me.xaxis.used=me.yaxis.used=!0,ve=pe=0;ve<De.length;++ve,pe+=He){var Te=De[ve],_e=null==Te;if(!_e)for(Ae=0;Ae<He;++Ae){var Oe=Te[Ae];(we=Ne[Ae])&&(we.number&&null!=Oe&&(Oe=+Oe,isNaN(Oe)?Oe=null:Oe==1/0?Oe=oe:Oe==-1/0&&(Oe=-oe)),null==Oe&&(we.required&&(_e=!0),null!=we.defaultValue&&(Oe=we.defaultValue))),Je[pe+Ae]=Oe}if(_e)for(Ae=0;Ae<He;++Ae)null!=(Oe=Je[pe+Ae])&&!1!==(we=Ne[Ae]).autoscale&&(we.x&&W(me.xaxis,Oe,Oe),we.y&&W(me.yaxis,Oe,Oe)),Je[pe+Ae]=null;else if(st&&0<pe&&null!=Je[pe-He]&&Je[pe-He]!=Je[pe]&&Je[pe-He+1]!=Je[pe+1]){for(Ae=0;Ae<He;++Ae)Je[pe+He+Ae]=Je[pe+Ae];Je[pe+1]=Je[pe-He+1],pe+=He}}}}for(se=0;se<te.length;++se)d(Ee.processDatapoints,[me=te[se],me.datapoints]);for(se=0;se<te.length;++se){for(Je=(me=te[se]).datapoints.points,He=me.datapoints.pointsize,Ne=me.datapoints.format,Te=pe=K,st=De=ne,ve=0;ve<Je.length;ve+=He)if(null!=Je[ve])for(Ae=0;Ae<He;++Ae)Oe=Je[ve+Ae],(we=Ne[Ae])&&!1!==we.autoscale&&Oe!=oe&&Oe!=-oe&&(we.x&&(Oe<pe&&(pe=Oe),Oe>De&&(De=Oe)),we.y&&(Oe<Te&&(Te=Oe),Oe>st&&(st=Oe)));if(me.bars.show){switch(me.bars.align){case"left":ve=0;break;case"right":ve=-me.bars.barWidth;break;default:ve=-me.bars.barWidth/2}me.bars.horizontal?(Te+=ve,st+=ve+me.bars.barWidth):(pe+=ve,De+=ve+me.bars.barWidth)}W(me.xaxis,pe,De),W(me.yaxis,Te,st)}e.each(g(),function(ze,Be){Be.datamin==K&&(Be.datamin=null),Be.datamax==ne&&(Be.datamax=null)})}()}function p(W,K){return"object"==typeof(W=W[K+"axis"])&&(W=W.n),"number"!=typeof W&&(W=1),W}function g(){return e.grep(Se.concat(Y),function(W){return W})}function v(W){var ne,oe,K={};for(ne=0;ne<Se.length;++ne)(oe=Se[ne])&&oe.used&&(K["x"+oe.n]=oe.c2p(W.left));for(ne=0;ne<Y.length;++ne)(oe=Y[ne])&&oe.used&&(K["y"+oe.n]=oe.c2p(W.top));return void 0!==K.x1&&(K.x=K.x1),void 0!==K.y1&&(K.y=K.y1),K}function r(W,K){return W[K-1]||(W[K-1]={n:K,direction:W==Se?"x":"y",options:e.extend(!0,{},W==Se?Q.xaxis:Q.yaxis)}),W[K-1]}function f(){Ye&&clearTimeout(Ye),ce.unbind("mousemove",R),ce.unbind("mouseleave",H),ce.unbind("click",N),d(Ee.shutdown,[ce])}function b(W){var K=W.labelWidth,ne=W.labelHeight,oe=W.options.position,se="x"===W.direction,ve=W.options.tickLength,pe=Q.grid.axisMargin,Ae=Q.grid.labelMargin,we=!0,me=!0,De=!0,Ne=!1;e.each(se?Se:Y,function(He,Je){Je&&(Je.show||Je.reserveSpace)&&(Je===W?Ne=!0:Je.options.position===oe&&(Ne?me=!1:we=!1),Ne||(De=!1))}),me&&(pe=0),null==ve&&(ve=De?"full":5),isNaN(+ve)||(Ae+=+ve),se?(ne+=Ae,"bottom"==oe?(ie.bottom+=ne+pe,W.box={top:de.height-ie.bottom,height:ne}):(W.box={top:ie.top+pe,height:ne},ie.top+=ne+pe)):(K+=Ae,"left"==oe?(W.box={left:ie.left+pe,width:K},ie.left+=K+pe):(ie.right+=K+pe,W.box={left:de.width-ie.right,width:K})),W.position=oe,W.tickLength=ve,W.box.padding=Ae,W.innermost=we}function A(){var W,K=g(),ne=Q.grid.show;for(W in ie){var oe=Q.grid.margin||0;ie[W]="number"==typeof oe?oe:oe[W]||0}for(W in d(Ee.processOffset,[ie]),ie)ie[W]="object"==typeof Q.grid.borderWidth?ie[W]+(ne?Q.grid.borderWidth[W]:0):ie[W]+(ne?Q.grid.borderWidth:0);if(e.each(K,function(se,ve){ve.show=(se=ve.options).show??ve.used,ve.reserveSpace=se.reserveSpace??ve.show;var pe=+(null!=(se=ve.options).min?se.min:ve.datamin),Ae=+(null!=se.max?se.max:ve.datamax),we=Ae-pe;if(0==we)we=0==Ae?1:.01,null==se.min&&(pe-=we),(null==se.max||null!=se.min)&&(Ae+=we);else{var me=se.autoscaleMargin;null!=me&&(null==se.min&&0>(pe-=we*me)&&null!=ve.datamin&&0<=ve.datamin&&(pe=0),null==se.max&&0<(Ae+=we*me)&&null!=ve.datamax&&0>=ve.datamax&&(Ae=0))}ve.min=pe,ve.max=Ae}),ne){for(oe=e.grep(K,function(se){return se.show||se.reserveSpace}),e.each(oe,function(se,ve){!function x(W){var K=W.options,ne=(W.max-W.min)/("number"==typeof K.ticks&&0<K.ticks?K.ticks:.3*Math.sqrt("x"==W.direction?de.width:de.height)),oe=-Math.floor(Math.log(ne)/Math.LN10),se=K.tickDecimals;null!=se&&oe>se&&(oe=se);var ve=Math.pow(10,-oe),pe=ne/ve;if(1.5>pe)var Ae=1;else 3>pe?(Ae=2,2.25<pe&&(null==se||oe+1<=se)&&(Ae=2.5,++oe)):Ae=7.5>pe?5:10;if(Ae*=ve,null!=K.minTickSize&&Ae<K.minTickSize&&(Ae=K.minTickSize),W.delta=ne,W.tickDecimals=Math.max(0,se??oe),W.tickSize=K.tickSize||Ae,"time"==K.mode&&!W.tickGenerator)throw Error("Time mode requires the flot.time plugin.");if(W.tickGenerator||(W.tickGenerator=function(me){var De=[],Ne=me.tickSize;Ne*=Math.floor(me.min/Ne);var He=0,Je=Number.NaN;do{var st=Je;De.push(Je=Ne+He*me.tickSize),++He}while(Je<me.max&&Je!=st);return De},W.tickFormatter=function(me,De){var Ne=De.tickDecimals?Math.pow(10,De.tickDecimals):1;if(me=""+Math.round(me*Ne)/Ne,null!=De.tickDecimals){var He=me.indexOf(".");if((He=-1==He?0:me.length-He-1)<De.tickDecimals)return(He?me:me+".")+(""+Ne).substr(1,De.tickDecimals-He)}return me}),e.isFunction(K.tickFormatter)&&(W.tickFormatter=function(me,De){return""+K.tickFormatter(me,De)}),null!=K.alignTicksWithAxis){var we=("x"==W.direction?Se:Y)[K.alignTicksWithAxis-1];we&&we.used&&we!=W&&(0<(ne=W.tickGenerator(W)).length&&(null==K.min&&(W.min=Math.min(W.min,ne[0])),null==K.max&&1<ne.length&&(W.max=Math.max(W.max,ne[ne.length-1]))),W.tickGenerator=function(me){var Ne,De=[];for(Ne=0;Ne<we.ticks.length;++Ne){var He=(we.ticks[Ne].v-we.min)/(we.max-we.min);De.push(He=me.min+He*(me.max-me.min))}return De},W.mode||null!=K.tickDecimals||(ne=Math.max(0,1-Math.floor(Math.log(W.delta)/Math.LN10)),1<(oe=W.tickGenerator(W)).length&&/\..*0$/.test((oe[1]-oe[0]).toFixed(ne))||(W.tickDecimals=ne)))}}(ve);var pe=ve.options.ticks;for(se=[],null==pe||"number"==typeof pe&&0<pe?se=ve.tickGenerator(ve):pe&&(se=e.isFunction(pe)?pe(ve):pe),ve.ticks=[],pe=0;pe<se.length;++pe){var Ae=null,we=se[pe];if("object"==typeof we){var me=+we[0];1<we.length&&(Ae=we[1])}else me=+we;null==Ae&&(Ae=ve.tickFormatter(me,ve)),isNaN(me)||ve.ticks.push({v:me,label:Ae})}se=ve.ticks,ve.options.autoscaleMargin&&0<se.length&&(null==ve.options.min&&(ve.min=Math.min(ve.min,se[0].v)),null==ve.options.max&&1<se.length&&(ve.max=Math.max(ve.max,se[se.length-1].v))),pe=ve.ticks||[],Ae=(se=ve.options).labelHeight||0,we=(me=se.labelWidth||0)||("x"==ve.direction?Math.floor(de.width/(pe.length||1)):null);for(var De="flot-"+ve.direction+"-axis flot-"+ve.direction+ve.n+"-axis "+ve.direction+"Axis "+ve.direction+ve.n+"Axis",Ne=se.font||"flot-tick-label tickLabel",He=0;He<pe.length;++He){var Je=pe[He];Je.label&&(Je=de.getTextInfo(De,Je.label,Ne,null,we),me=Math.max(me,Je.width),Ae=Math.max(Ae,Je.height))}ve.labelWidth=se.labelWidth||me,ve.labelHeight=se.labelHeight||Ae}),W=oe.length-1;0<=W;--W)b(oe[W]);(function w(){var K,W=Q.grid.minBorderMargin;if(null==W)for(K=W=0;K<te.length;++K)W=Math.max(W,2*(te[K].points.radius+te[K].points.lineWidth/2));var ne=W,oe=W,se=W,ve=W;e.each(g(),function(pe,Ae){Ae.reserveSpace&&Ae.ticks&&Ae.ticks.length&&("x"===Ae.direction?(ne=Math.max(ne,Ae.labelWidth/2),oe=Math.max(oe,Ae.labelWidth/2)):(ve=Math.max(ve,Ae.labelHeight/2),se=Math.max(se,Ae.labelHeight/2)))}),ie.left=Math.ceil(Math.max(ne,ie.left)),ie.right=Math.ceil(Math.max(oe,ie.right)),ie.top=Math.ceil(Math.max(se,ie.top)),ie.bottom=Math.ceil(Math.max(ve,ie.bottom))})(),e.each(oe,function(se,ve){"x"==ve.direction?(ve.box.left=ie.left-ve.labelWidth/2,ve.box.width=de.width-ie.left-ie.right+ve.labelWidth):(ve.box.top=ie.top-ve.labelHeight/2,ve.box.height=de.height-ie.bottom-ie.top+ve.labelHeight)})}be=de.width-ie.left-ie.right,ke=de.height-ie.bottom-ie.top,e.each(K,function(se,ve){!function m(W){function K(pe){return pe}var ne=W.options.transform||K,oe=W.options.inverseTransform;if("x"==W.direction)var se=W.scale=be/Math.abs(ne(W.max)-ne(W.min)),ve=Math.min(ne(W.max),ne(W.min));else se=-(se=W.scale=ke/Math.abs(ne(W.max)-ne(W.min))),ve=Math.max(ne(W.max),ne(W.min));W.p2c=ne==K?function(pe){return(pe-ve)*se}:function(pe){return(ne(pe)-ve)*se},W.c2p=oe?function(pe){return oe(ve+pe/se)}:function(pe){return ve+pe/se}}(ve)}),ne&&function C(){e.each(g(),function(W,K){W=K.box;var ne="flot-"+K.direction+"-axis flot-"+K.direction+K.n+"-axis "+K.direction+"Axis "+K.direction+K.n+"Axis",oe=K.options.font||"flot-tick-label tickLabel";if(de.removeText(ne),K.show&&0!=K.ticks.length)for(var se=0;se<K.ticks.length;++se){var ve=K.ticks[se];if(!(!ve.label||ve.v<K.min||ve.v>K.max)){if("x"==K.direction){var pe="center",Ae=ie.left+K.p2c(ve.v);if("bottom"==K.position)var we=W.top+W.padding;else{we=W.top+W.height-W.padding;var me="bottom"}}else me="middle",we=ie.top+K.p2c(ve.v),"left"==K.position?(Ae=W.left+W.width-W.padding,pe="right"):Ae=W.left+W.padding;de.addText(ne,Ae,we,ve.label,oe,null,null,pe,me)}}})}(),function E(){if(null!=Q.legend.container?e(Q.legend.container).html(""):n.find(".legend").remove(),Q.legend.show){for(var se,ve,W=[],K=[],ne=!1,oe=Q.legend.labelFormatter,pe=0;pe<te.length;++pe)(se=te[pe]).label&&(ve=oe?oe(se.label,se):se.label)&&K.push({label:ve,color:se.color});if(Q.legend.sorted)if(e.isFunction(Q.legend.sorted))K.sort(Q.legend.sorted);else if("reverse"==Q.legend.sorted)K.reverse();else{var Ae="descending"!=Q.legend.sorted;K.sort(function(we,me){return we.label==me.label?0:we.label<me.label!=Ae?1:-1})}for(pe=0;pe<K.length;++pe)oe=K[pe],pe%Q.legend.noColumns==0&&(ne&&W.push("</tr>"),W.push("<tr>"),ne=!0),W.push('<td class="legendColorBox"><div style="border:1px solid '+Q.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+oe.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+oe.label+"</td>");ne&&W.push("</tr>"),0!=W.length&&(K='<table style="font-size:smaller;color:'+Q.grid.color+'">'+W.join("")+"</table>",null!=Q.legend.container?e(Q.legend.container).html(K):(W="",null==(pe=Q.legend.margin)[0]&&(pe=[pe,pe]),"n"==(ne=Q.legend.position).charAt(0)?W+="top:"+(pe[1]+ie.top)+"px;":"s"==ne.charAt(0)&&(W+="bottom:"+(pe[1]+ie.bottom)+"px;"),"e"==ne.charAt(1)?W+="right:"+(pe[0]+ie.right)+"px;":"w"==ne.charAt(1)&&(W+="left:"+(pe[0]+ie.left)+"px;"),K=e('<div class="legend">'+K.replace('style="','style="position:absolute;'+W+";")+"</div>").appendTo(n),0!=Q.legend.backgroundOpacity&&(null==(ne=Q.legend.backgroundColor)&&((ne=(ne=Q.grid.backgroundColor)&&"string"==typeof ne?e.color.parse(ne):e.color.extract(K,"background-color")).a=1,ne=ne.toString()),pe=K.children(),e('<div style="position:absolute;width:'+pe.width()+"px;height:"+pe.height()+"px;"+W+"background-color:"+ne+';"> </div>').prependTo(K).css("opacity",Q.legend.backgroundOpacity))))}}()}function y(){de.clear(),d(Ee.drawBackground,[he]);var W=Q.grid;W.show&&W.backgroundColor&&(he.save(),he.translate(ie.left,ie.top),he.fillStyle=le(Q.grid.backgroundColor,ke,0,"rgba(255, 255, 255, 0)"),he.fillRect(0,0,be,ke),he.restore()),W.show&&!W.aboveData&&_();for(var K=0;K<te.length;++K){d(Ee.drawSeries,[he,te[K]]);var ne=te[K];ne.lines.show&&I(ne),ne.bars.show&&O(ne),ne.points.show&&L(ne)}d(Ee.draw,[he]),W.show&&W.aboveData&&_(),de.render(),P()}function S(W,K){for(var ne,oe,se,ve,pe=g(),Ae=0;Ae<pe.length;++Ae)if((ne=pe[Ae]).direction==K&&(W[ve=K+ne.n+"axis"]||1!=ne.n||(ve=K+"axis"),W[ve])){oe=W[ve].from,se=W[ve].to;break}return W[ve]||(ne="x"==K?Se[0]:Y[0],oe=W[K+"1"],se=W[K+"2"]),null!=oe&&null!=se&&oe>se&&(W=oe,oe=se,se=W),{from:oe,to:se,axis:ne}}function _(){var W,K;if(he.save(),he.translate(ie.left,ie.top),K=Q.grid.markings){if(e.isFunction(K)){var ne=$e.getAxes();ne.xmin=ne.xaxis.min,ne.xmax=ne.xaxis.max,ne.ymin=ne.yaxis.min,ne.ymax=ne.yaxis.max,K=K(ne)}for(W=0;W<K.length;++W){var oe=S(ne=K[W],"x"),se=S(ne,"y");if(null==oe.from&&(oe.from=oe.axis.min),null==oe.to&&(oe.to=oe.axis.max),null==se.from&&(se.from=se.axis.min),null==se.to&&(se.to=se.axis.max),!(oe.to<oe.axis.min||oe.from>oe.axis.max||se.to<se.axis.min||se.from>se.axis.max)){oe.from=Math.max(oe.from,oe.axis.min),oe.to=Math.min(oe.to,oe.axis.max),se.from=Math.max(se.from,se.axis.min),se.to=Math.min(se.to,se.axis.max);var ve=oe.from===oe.to,pe=se.from===se.to;if(!ve||!pe)if(oe.from=Math.floor(oe.axis.p2c(oe.from)),oe.to=Math.floor(oe.axis.p2c(oe.to)),se.from=Math.floor(se.axis.p2c(se.from)),se.to=Math.floor(se.axis.p2c(se.to)),ve||pe){var Ae=(pe=ne.lineWidth||Q.grid.markingsLineWidth)%2?.5:0;he.beginPath(),he.strokeStyle=ne.color||Q.grid.markingsColor,he.lineWidth=pe,ve?(he.moveTo(oe.to+Ae,se.from),he.lineTo(oe.to+Ae,se.to)):(he.moveTo(oe.from,se.to+Ae),he.lineTo(oe.to,se.to+Ae)),he.stroke()}else he.fillStyle=ne.color||Q.grid.markingsColor,he.fillRect(oe.from,se.to,oe.to-oe.from,se.from-se.to)}}}for(ne=g(),K=Q.grid.borderWidth,oe=0;oe<ne.length;++oe){var we;if(W=(se=ne[oe]).box,ve=se.tickLength,se.show&&0!=se.ticks.length){if(he.lineWidth=1,"x"==se.direction?(pe=0,Ae="full"==ve?"top"==se.position?0:ke:W.top-ie.top+("top"==se.position?W.height:0)):(Ae=0,pe="full"==ve?"left"==se.position?0:be:W.left-ie.left+("left"==se.position?W.width:0)),!se.innermost){he.strokeStyle=se.options.color,he.beginPath();var me=we=0;"x"==se.direction?me=be+1:we=ke+1,1==he.lineWidth&&("x"==se.direction?Ae=Math.floor(Ae)+.5:pe=Math.floor(pe)+.5),he.moveTo(pe,Ae),he.lineTo(pe+me,Ae+we),he.stroke()}for(he.strokeStyle=se.options.tickColor,he.beginPath(),W=0;W<se.ticks.length;++W){var De=se.ticks[W].v;me=we=0,isNaN(De)||De<se.min||De>se.max||"full"==ve&&("object"==typeof K&&0<K[se.position]||0<K)&&(De==se.min||De==se.max)||("x"==se.direction?(pe=se.p2c(De),we="full"==ve?-ke:ve,"top"==se.position&&(we=-we)):(Ae=se.p2c(De),me="full"==ve?-be:ve,"left"==se.position&&(me=-me)),1==he.lineWidth&&("x"==se.direction?pe=Math.floor(pe)+.5:Ae=Math.floor(Ae)+.5),he.moveTo(pe,Ae),he.lineTo(pe+me,Ae+we))}he.stroke()}}K&&(W=Q.grid.borderColor,"object"==typeof K||"object"==typeof W?("object"!=typeof K&&(K={top:K,right:K,bottom:K,left:K}),"object"!=typeof W&&(W={top:W,right:W,bottom:W,left:W}),0<K.top&&(he.strokeStyle=W.top,he.lineWidth=K.top,he.beginPath(),he.moveTo(0-K.left,-K.top/2),he.lineTo(be,-K.top/2),he.stroke()),0<K.right&&(he.strokeStyle=W.right,he.lineWidth=K.right,he.beginPath(),he.moveTo(be+K.right/2,0-K.top),he.lineTo(be+K.right/2,ke),he.stroke()),0<K.bottom&&(he.strokeStyle=W.bottom,he.lineWidth=K.bottom,he.beginPath(),he.moveTo(be+K.right,ke+K.bottom/2),he.lineTo(0,ke+K.bottom/2),he.stroke()),0<K.left&&(he.strokeStyle=W.left,he.lineWidth=K.left,he.beginPath(),he.moveTo(-K.left/2,ke+K.bottom),he.lineTo(-K.left/2,0),he.stroke())):(he.lineWidth=K,he.strokeStyle=Q.grid.borderColor,he.strokeRect(-K/2,-K/2,be+K,ke+K))),he.restore()}function I(W){function K(pe,Ae,we,me,De){var Ne=pe.points;pe=pe.pointsize;var He=null,Je=null;he.beginPath();for(var st=pe;st<Ne.length;st+=pe){var Te=Ne[st-pe],_e=Ne[st-pe+1],Oe=Ne[st],ze=Ne[st+1];if(null!=Te&&null!=Oe){if(_e<=ze&&_e<De.min){if(ze<De.min)continue;Te=(De.min-_e)/(ze-_e)*(Oe-Te)+Te,_e=De.min}else if(ze<=_e&&ze<De.min){if(_e<De.min)continue;Oe=(De.min-_e)/(ze-_e)*(Oe-Te)+Te,ze=De.min}if(_e>=ze&&_e>De.max){if(ze>De.max)continue;Te=(De.max-_e)/(ze-_e)*(Oe-Te)+Te,_e=De.max}else if(ze>=_e&&ze>De.max){if(_e>De.max)continue;Oe=(De.max-_e)/(ze-_e)*(Oe-Te)+Te,ze=De.max}if(Te<=Oe&&Te<me.min){if(Oe<me.min)continue;_e=(me.min-Te)/(Oe-Te)*(ze-_e)+_e,Te=me.min}else if(Oe<=Te&&Oe<me.min){if(Te<me.min)continue;ze=(me.min-Te)/(Oe-Te)*(ze-_e)+_e,Oe=me.min}if(Te>=Oe&&Te>me.max){if(Oe>me.max)continue;_e=(me.max-Te)/(Oe-Te)*(ze-_e)+_e,Te=me.max}else if(Oe>=Te&&Oe>me.max){if(Te>me.max)continue;ze=(me.max-Te)/(Oe-Te)*(ze-_e)+_e,Oe=me.max}Te==He&&_e==Je||he.moveTo(me.p2c(Te)+Ae,De.p2c(_e)+we),He=Oe,Je=ze,he.lineTo(me.p2c(Oe)+Ae,De.p2c(ze)+we)}}he.stroke()}he.save(),he.translate(ie.left,ie.top),he.lineJoin="round";var oe=W.lines.lineWidth,se=W.shadowSize;if(0<oe&&0<se){he.lineWidth=se,he.strokeStyle="rgba(0,0,0,0.1)";var ve=Math.PI/18;K(W.datapoints,Math.sin(ve)*(oe/2+se/2),Math.cos(ve)*(oe/2+se/2),W.xaxis,W.yaxis),he.lineWidth=se/2,K(W.datapoints,Math.sin(ve)*(oe/2+se/4),Math.cos(ve)*(oe/2+se/4),W.xaxis,W.yaxis)}he.lineWidth=oe,he.strokeStyle=W.color,(se=M(W.lines,W.color,0,ke))&&(he.fillStyle=se,function ne(pe,Ae,we){var me=pe.points;pe=pe.pointsize;for(var De=Math.min(Math.max(0,we.min),we.max),Ne=0,He=!1,Je=1,st=0,Te=0;!(0<pe&&Ne>me.length+pe);){var _e=me[(Ne+=pe)-pe],Oe=me[Ne-pe+Je],ze=me[Ne],Be=me[Ne+Je];if(He){if(0<pe&&null!=_e&&null==ze){Te=Ne,pe=-pe,Je=2;continue}if(0>pe&&Ne==st+pe){he.fill(),He=!1,Je=1,Ne=st=Te+(pe=-pe);continue}}if(null!=_e&&null!=ze){if(_e<=ze&&_e<Ae.min){if(ze<Ae.min)continue;Oe=(Ae.min-_e)/(ze-_e)*(Be-Oe)+Oe,_e=Ae.min}else if(ze<=_e&&ze<Ae.min){if(_e<Ae.min)continue;Be=(Ae.min-_e)/(ze-_e)*(Be-Oe)+Oe,ze=Ae.min}if(_e>=ze&&_e>Ae.max){if(ze>Ae.max)continue;Oe=(Ae.max-_e)/(ze-_e)*(Be-Oe)+Oe,_e=Ae.max}else if(ze>=_e&&ze>Ae.max){if(_e>Ae.max)continue;Be=(Ae.max-_e)/(ze-_e)*(Be-Oe)+Oe,ze=Ae.max}if(He||(he.beginPath(),he.moveTo(Ae.p2c(_e),we.p2c(De)),He=!0),Oe>=we.max&&Be>=we.max)he.lineTo(Ae.p2c(_e),we.p2c(we.max)),he.lineTo(Ae.p2c(ze),we.p2c(we.max));else if(Oe<=we.min&&Be<=we.min)he.lineTo(Ae.p2c(_e),we.p2c(we.min)),he.lineTo(Ae.p2c(ze),we.p2c(we.min));else{var Qe=_e,lt=ze;Oe<=Be&&Oe<we.min&&Be>=we.min?(_e=(we.min-Oe)/(Be-Oe)*(ze-_e)+_e,Oe=we.min):Be<=Oe&&Be<we.min&&Oe>=we.min&&(ze=(we.min-Oe)/(Be-Oe)*(ze-_e)+_e,Be=we.min),Oe>=Be&&Oe>we.max&&Be<=we.max?(_e=(we.max-Oe)/(Be-Oe)*(ze-_e)+_e,Oe=we.max):Be>=Oe&&Be>we.max&&Oe<=we.max&&(ze=(we.max-Oe)/(Be-Oe)*(ze-_e)+_e,Be=we.max),_e!=Qe&&he.lineTo(Ae.p2c(Qe),we.p2c(Oe)),he.lineTo(Ae.p2c(_e),we.p2c(Oe)),he.lineTo(Ae.p2c(ze),we.p2c(Be)),ze!=lt&&(he.lineTo(Ae.p2c(ze),we.p2c(Be)),he.lineTo(Ae.p2c(lt),we.p2c(Be)))}}}}(W.datapoints,W.xaxis,W.yaxis)),0<oe&&K(W.datapoints,0,0,W.xaxis,W.yaxis),he.restore()}function L(W){function K(pe,Ae,we,me,De,Ne,He,Je){var st=pe.points;pe=pe.pointsize;for(var Te=0;Te<st.length;Te+=pe){var _e=st[Te],Oe=st[Te+1];null==_e||_e<Ne.min||_e>Ne.max||Oe<He.min||Oe>He.max||(he.beginPath(),_e=Ne.p2c(_e),Oe=He.p2c(Oe)+me,"circle"==Je?he.arc(_e,Oe,Ae,0,De?Math.PI:2*Math.PI,!1):Je(he,_e,Oe,Ae,De),he.closePath(),we&&(he.fillStyle=we,he.fill()),he.stroke())}}he.save(),he.translate(ie.left,ie.top);var ne=W.points.lineWidth,oe=W.shadowSize,se=W.points.radius,ve=W.points.symbol;0==ne&&(ne=1e-4),0<ne&&0<oe&&(he.lineWidth=oe/=2,he.strokeStyle="rgba(0,0,0,0.1)",K(W.datapoints,se,null,oe+oe/2,!0,W.xaxis,W.yaxis,ve),he.strokeStyle="rgba(0,0,0,0.2)",K(W.datapoints,se,null,oe/2,!0,W.xaxis,W.yaxis,ve)),he.lineWidth=ne,he.strokeStyle=W.color,K(W.datapoints,se,M(W.points,W.color),0,!1,W.xaxis,W.yaxis,ve),he.restore()}function D(W,K,ne,oe,se,ve,pe,Ae,we,me,De){var Ne,He;if(me){var Je=Ne=He=!0,st=!1;me=ne,ne=K+oe,se=K+se,W<me&&(K=W,W=me,me=K,st=!0,Ne=!1)}else st=Ne=He=!0,Je=!1,me=W+oe,W+=se,se=ne,(ne=K)<se&&(K=ne,ne=se,se=K,Je=!0,He=!1);W<pe.min||me>pe.max||ne<Ae.min||se>Ae.max||(me<pe.min&&(me=pe.min,st=!1),W>pe.max&&(W=pe.max,Ne=!1),se<Ae.min&&(se=Ae.min,Je=!1),ne>Ae.max&&(ne=Ae.max,He=!1),me=pe.p2c(me),se=Ae.p2c(se),W=pe.p2c(W),ne=Ae.p2c(ne),ve&&(we.fillStyle=ve(se,ne),we.fillRect(me,ne,W-me,se-ne)),0<De&&(st||Ne||He||Je)&&(we.beginPath(),we.moveTo(me,se),st?we.lineTo(me,ne):we.moveTo(me,ne),He?we.lineTo(W,ne):we.moveTo(W,ne),Ne?we.lineTo(W,se):we.moveTo(W,se),Je?we.lineTo(me,se):we.moveTo(me,se),we.stroke()))}function O(W){switch(he.save(),he.translate(ie.left,ie.top),he.lineWidth=W.bars.lineWidth,he.strokeStyle=W.color,W.bars.align){case"left":var K=0;break;case"right":K=-W.bars.barWidth;break;default:K=-W.bars.barWidth/2}(function(ne,oe,se,ve,pe,Ae){var we=ne.points;ne=ne.pointsize;for(var me=0;me<we.length;me+=ne)null!=we[me]&&D(we[me],we[me+1],we[me+2],oe,se,ve,pe,Ae,he,W.bars.horizontal,W.bars.lineWidth)})(W.datapoints,K,K+W.bars.barWidth,W.bars.fill?function(ne,oe){return M(W.bars,W.color,ne,oe)}:null,W.xaxis,W.yaxis),he.restore()}function M(W,K,ne,oe){var se=W.fill;return se?W.fillColor?le(W.fillColor,ne,oe,K):((W=e.color.parse(K)).a="number"==typeof se?se:.4,W.normalize(),W.toString()):null}function R(W){Q.grid.hoverable&&B("plothover",W,function(K){return 0!=K.hoverable})}function H(W){Q.grid.hoverable&&B("plothover",W,function(K){return!1})}function N(W){B("plotclick",W,function(K){return 0!=K.clickable})}function B(W,K,ne){var oe=ce.offset(),se=K.pageX-oe.left-ie.left,ve=K.pageY-oe.top-ie.top,pe=v({left:se,top:ve});pe.pageX=K.pageX,pe.pageY=K.pageY;var me,De,Ae=(K=Q.grid.mouseActiveRadius)*K+1,we=null;for(me=te.length-1;0<=me;--me)if(ne(te[me])){var Ne=te[me],He=Ne.xaxis,Je=Ne.yaxis,st=Ne.datapoints.points,Te=He.c2p(se),_e=Je.c2p(ve),Oe=K/He.scale,ze=K/Je.scale,Be=Ne.datapoints.pointsize;if(He.options.inverseTransform&&(Oe=Number.MAX_VALUE),Je.options.inverseTransform&&(ze=Number.MAX_VALUE),Ne.lines.show||Ne.points.show)for(De=0;De<st.length;De+=Be){var Qe=st[De],lt=st[De+1];null==Qe||Qe-Te>Oe||Qe-Te<-Oe||lt-_e>ze||lt-_e<-ze||(lt=(Qe=Math.abs(He.p2c(Qe)-se))*Qe+(lt=Math.abs(Je.p2c(lt)-ve))*lt)<Ae&&(Ae=lt,we=[me,De/Be])}if(Ne.bars.show&&!we){switch(Ne.bars.align){case"left":He=0;break;case"right":He=-Ne.bars.barWidth;break;default:He=-Ne.bars.barWidth/2}for(Ne=He+Ne.bars.barWidth,De=0;De<st.length;De+=Be)lt=st[De+1],Je=st[De+2],null!=(Qe=st[De])&&(te[me].bars.horizontal?Te<=Math.max(Je,Qe)&&Te>=Math.min(Je,Qe)&&_e>=lt+He&&_e<=lt+Ne:Te>=Qe+He&&Te<=Qe+Ne&&_e>=Math.min(Je,lt)&&_e<=Math.max(Je,lt))&&(we=[me,De/Be])}}if((ne=we?{datapoint:te[me=we[0]].datapoints.points.slice((De=we[1])*(Be=te[me].datapoints.pointsize),(De+1)*Be),dataIndex:De,series:te[me],seriesIndex:me}:null)&&(ne.pageX=parseInt(ne.series.xaxis.p2c(ne.datapoint[0])+oe.left+ie.left,10),ne.pageY=parseInt(ne.series.yaxis.p2c(ne.datapoint[1])+oe.top+ie.top,10)),Q.grid.autoHighlight){for(oe=0;oe<Ge.length;++oe)(se=Ge[oe]).auto!=W||ne&&se.series==ne.series&&se.point[0]==ne.datapoint[0]&&se.point[1]==ne.datapoint[1]||q(se.series,se.point);ne&&J(ne.series,ne.datapoint,W)}n.trigger(W,[pe,ne])}function P(){var W=Q.interaction.redrawOverlayInterval;-1==W?z():Ye||(Ye=setTimeout(z,W))}function z(){var W;for(Ye=null,Pe.save(),xe.clear(),Pe.translate(ie.left,ie.top),W=0;W<Ge.length;++W){var K=Ge[W];if(K.series.bars.show)ee(K.series,K.point);else{var ne=K.series,oe=K.point;K=oe[0],oe=oe[1];var se=ne.xaxis,ve=ne.yaxis,pe="string"==typeof ne.highlightColor?ne.highlightColor:e.color.parse(ne.color).scale("a",.5).toString();if(!(K<se.min||K>se.max||oe<ve.min||oe>ve.max)){var Ae=ne.points.radius+ne.points.lineWidth/2;Pe.lineWidth=Ae,Pe.strokeStyle=pe,pe=1.5*Ae,K=se.p2c(K),oe=ve.p2c(oe),Pe.beginPath(),"circle"==ne.points.symbol?Pe.arc(K,oe,pe,0,2*Math.PI,!1):ne.points.symbol(Pe,K,oe,pe,!1),Pe.closePath(),Pe.stroke()}}}Pe.restore(),d(Ee.drawOverlay,[Pe])}function J(W,K,ne){if("number"==typeof W&&(W=te[W]),"number"==typeof K){var oe=W.datapoints.pointsize;K=W.datapoints.points.slice(oe*K,oe*(K+1))}-1==(oe=G(W,K))?(Ge.push({series:W,point:K,auto:ne}),P()):ne||(Ge[oe].auto=!1)}function q(W,K){if(null==W&&null==K)Ge=[],P();else{if("number"==typeof W&&(W=te[W]),"number"==typeof K){var ne=W.datapoints.pointsize;K=W.datapoints.points.slice(ne*K,ne*(K+1))}-1!=(W=G(W,K))&&(Ge.splice(W,1),P())}}function G(W,K){for(var ne=0;ne<Ge.length;++ne){var oe=Ge[ne];if(oe.series==W&&oe.point[0]==K[0]&&oe.point[1]==K[1])return ne}return-1}function ee(W,K){var ne="string"==typeof W.highlightColor?W.highlightColor:e.color.parse(W.color).scale("a",.5).toString();switch(W.bars.align){case"left":var oe=0;break;case"right":oe=-W.bars.barWidth;break;default:oe=-W.bars.barWidth/2}Pe.lineWidth=W.bars.lineWidth,Pe.strokeStyle=ne,D(K[0],K[1],K[2]||0,oe,oe+W.bars.barWidth,function(){return ne},W.xaxis,W.yaxis,Pe,W.bars.horizontal,W.bars.lineWidth)}function le(W,K,ne,oe){if("string"==typeof W)return W;K=he.createLinearGradient(0,ne,0,K),ne=0;for(var se=W.colors.length;ne<se;++ne){var ve=W.colors[ne];if("string"!=typeof ve){var pe=e.color.parse(oe);null!=ve.brightness&&(pe=pe.scale("rgb",ve.brightness)),null!=ve.opacity&&(pe.a*=ve.opacity),ve=pe.toString()}K.addColorStop(ne/(se-1),ve)}return K}var te=[],Q={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},de=null,xe=null,ce=null,he=null,Pe=null,Se=[],Y=[],ie={left:0,right:0,top:0,bottom:0},be=0,ke=0,Ee={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},$e=this;$e.setData=h,$e.setupGrid=A,$e.draw=y,$e.getPlaceholder=function(){return n},$e.getCanvas=function(){return de.element},$e.getPlotOffset=function(){return ie},$e.width=function(){return be},$e.height=function(){return ke},$e.offset=function(){var W=ce.offset();return W.left+=ie.left,W.top+=ie.top,W},$e.getData=function(){return te},$e.getAxes=function(){var W={};return e.each(Se.concat(Y),function(K,ne){ne&&(W[ne.direction+(1!=ne.n?ne.n:"")+"axis"]=ne)}),W},$e.getXAxes=function(){return Se},$e.getYAxes=function(){return Y},$e.c2p=v,$e.p2c=function(W){var ne,oe,K={};for(ne=0;ne<Se.length;++ne)if((oe=Se[ne])&&oe.used){var se="x"+oe.n;if(null==W[se]&&1==oe.n&&(se="x"),null!=W[se]){K.left=oe.p2c(W[se]);break}}for(ne=0;ne<Y.length;++ne)if((oe=Y[ne])&&oe.used&&(null==W[se="y"+oe.n]&&1==oe.n&&(se="y"),null!=W[se])){K.top=oe.p2c(W[se]);break}return K},$e.getOptions=function(){return Q},$e.highlight=J,$e.unhighlight=q,$e.triggerRedrawOverlay=P,$e.pointOffset=function(W){return{left:parseInt(Se[p(W,"x")-1].p2c(+W.x)+ie.left,10),top:parseInt(Y[p(W,"y")-1].p2c(+W.y)+ie.top,10)}},$e.shutdown=f,$e.destroy=function(){f(),n.removeData("plot").empty(),te=[],Pe=he=ce=xe=de=Q=null,Se=[],Y=[],Ee=null,Ge=[],$e=null},$e.resize=function(){var W=n.width(),K=n.height();de.resize(W,K),xe.resize(W,K)},$e.hooks=Ee,function(){for(var W={Canvas:t},K=0;K<c.length;++K){var ne=c[K];ne.init($e,W),ne.options&&e.extend(!0,Q,ne.options)}}(),function(W){var K;e.extend(!0,Q,W),W&&W.colors&&(Q.colors=W.colors),null==Q.xaxis.color&&(Q.xaxis.color=e.color.parse(Q.grid.color).scale("a",.22).toString()),null==Q.yaxis.color&&(Q.yaxis.color=e.color.parse(Q.grid.color).scale("a",.22).toString()),null==Q.xaxis.tickColor&&(Q.xaxis.tickColor=Q.grid.tickColor||Q.xaxis.color),null==Q.yaxis.tickColor&&(Q.yaxis.tickColor=Q.grid.tickColor||Q.yaxis.color),null==Q.grid.borderColor&&(Q.grid.borderColor=Q.grid.color),null==Q.grid.tickColor&&(Q.grid.tickColor=e.color.parse(Q.grid.color).scale("a",.22).toString()),W=(W=n.css("font-size"))?+W.replace("px",""):13;var ne={style:n.css("font-style"),size:Math.round(.8*W),variant:n.css("font-variant"),weight:n.css("font-weight"),family:n.css("font-family")},oe=Q.xaxes.length||1;for(W=0;W<oe;++W)(K=Q.xaxes[W])&&!K.tickColor&&(K.tickColor=K.color),K=e.extend(!0,{},Q.xaxis,K),Q.xaxes[W]=K,K.font&&(K.font=e.extend({},ne,K.font),K.font.color||(K.font.color=K.color),K.font.lineHeight||(K.font.lineHeight=Math.round(1.15*K.font.size)));for(oe=Q.yaxes.length||1,W=0;W<oe;++W)(K=Q.yaxes[W])&&!K.tickColor&&(K.tickColor=K.color),K=e.extend(!0,{},Q.yaxis,K),Q.yaxes[W]=K,K.font&&(K.font=e.extend({},ne,K.font),K.font.color||(K.font.color=K.color),K.font.lineHeight||(K.font.lineHeight=Math.round(1.15*K.font.size)));for(Q.xaxis.noTicks&&null==Q.xaxis.ticks&&(Q.xaxis.ticks=Q.xaxis.noTicks),Q.yaxis.noTicks&&null==Q.yaxis.ticks&&(Q.yaxis.ticks=Q.yaxis.noTicks),Q.x2axis&&(Q.xaxes[1]=e.extend(!0,{},Q.xaxis,Q.x2axis),Q.xaxes[1].position="top",null==Q.x2axis.min&&(Q.xaxes[1].min=null),null==Q.x2axis.max&&(Q.xaxes[1].max=null)),Q.y2axis&&(Q.yaxes[1]=e.extend(!0,{},Q.yaxis,Q.y2axis),Q.yaxes[1].position="right",null==Q.y2axis.min&&(Q.yaxes[1].min=null),null==Q.y2axis.max&&(Q.yaxes[1].max=null)),Q.grid.coloredAreas&&(Q.grid.markings=Q.grid.coloredAreas),Q.grid.coloredAreasColor&&(Q.grid.markingsColor=Q.grid.coloredAreasColor),Q.lines&&e.extend(!0,Q.series.lines,Q.lines),Q.points&&e.extend(!0,Q.series.points,Q.points),Q.bars&&e.extend(!0,Q.series.bars,Q.bars),null!=Q.shadowSize&&(Q.series.shadowSize=Q.shadowSize),null!=Q.highlightColor&&(Q.series.highlightColor=Q.highlightColor),W=0;W<Q.xaxes.length;++W)r(Se,W+1).options=Q.xaxes[W];for(W=0;W<Q.yaxes.length;++W)r(Y,W+1).options=Q.yaxes[W];for(var se in Ee)Q.hooks[se]&&Q.hooks[se].length&&(Ee[se]=Ee[se].concat(Q.hooks[se]));d(Ee.processOptions,[Q])}(l),function(){n.css("padding",0).children().filter(function(){return!e(this).hasClass("flot-overlay")&&!e(this).hasClass("flot-base")}).remove(),"static"==n.css("position")&&n.css("position","relative"),de=new t("flot-base",n),xe=new t("flot-overlay",n),he=de.context,Pe=xe.context,ce=e(xe.element).unbind();var W=n.data("plot");W&&(W.shutdown(),xe.clear()),n.data("plot",$e)}(),h(a),A(),y(),Q.grid.hoverable&&(ce.mousemove(R),ce.bind("mouseleave",H)),Q.grid.clickable&&ce.click(N),d(Ee.bindEvents,[ce]);var Ge=[],Ye=null}var o=Object.prototype.hasOwnProperty;e.fn.detach||(e.fn.detach=function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)})}),t.prototype.resize=function(n,a){if(0>=n||0>=a)throw Error("Invalid dimensions for plot, width = "+n+", height = "+a);var l=this.element,c=this.context,d=this.pixelRatio;this.width!=n&&(l.width=n*d,l.style.width=n+"px",this.width=n),this.height!=a&&(l.height=a*d,l.style.height=a+"px",this.height=a),c.restore(),c.save(),c.scale(d,d)},t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.render=function(){var a,n=this._textCache;for(a in n)if(o.call(n,a)){var l=this.getTextLayer(a),c=n[a];for(var d in l.hide(),c)if(o.call(c,d)){var p,h=c[d];for(p in h)if(o.call(h,p)){for(var r,g=h[p].positions,v=0;r=g[v];v++)r.active?r.rendered||(l.append(r.element),r.rendered=!0):(g.splice(v--,1),r.rendered&&r.element.detach());0==g.length&&delete h[p]}}l.show()}},t.prototype.getTextLayer=function(n){var a=this.text[n];return null==a&&(null==this.textContainer&&(this.textContainer=e("<div class='flot-text'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),a=this.text[n]=e("<div></div>").addClass(n).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),a},t.prototype.getTextInfo=function(n,a,l,c,d){a=""+a,c="object"==typeof l?l.style+" "+l.variant+" "+l.weight+" "+l.size+"px/"+l.lineHeight+"px "+l.family:l;var h=this._textCache[n];null==h&&(h=this._textCache[n]={});var p=h[c];return null==p&&(p=h[c]={}),null==(h=p[a])&&(n=e("<div></div>").html(a).css({position:"absolute","max-width":d,top:-9999}).appendTo(this.getTextLayer(n)),"object"==typeof l?n.css({font:c,color:l.color}):"string"==typeof l&&n.addClass(l),h=p[a]={width:n.outerWidth(!0),height:n.outerHeight(!0),element:n,positions:[]},n.detach()),h},t.prototype.addText=function(n,a,l,c,d,h,p,g,v){for(c=(n=this.getTextInfo(n,c,d,h,p)).positions,"center"==g?a-=n.width/2:"right"==g&&(a-=n.width),"middle"==v?l-=n.height/2:"bottom"==v&&(l-=n.height),v=0;d=c[v];v++)if(d.x==a&&d.y==l)return void(d.active=!0);d={active:!0,rendered:!1,element:c.length?n.element.clone():n.element,x:a,y:l},c.push(d),d.element.css({top:Math.round(l),left:Math.round(a),"text-align":g})},t.prototype.removeText=function(n,a,l,c,d,h){if(null==c){if(null!=(a=this._textCache[n]))for(var p in a)if(o.call(a,p))for(var g in l=a[p])if(o.call(l,g))for(n=l[g].positions,c=0;d=n[c];c++)d.active=!1}else for(n=this.getTextInfo(n,c,d,h).positions,c=0;d=n[c];c++)d.x==a&&d.y==l&&(d.active=!1)},e.plot=function(n,a,l){return new s(e(n),a,l,e.plot.plugins)},e.plot.version="0.8.3",e.plot.plugins=[],e.fn.plot=function(n,a){return this.each(function(){e.plot(this,n,a)})}}(jQuery),function(e){function t(a,l,c,d){l.points.errorbars&&(a=[{x:!0,number:!0,required:!0},{y:!0,number:!0,required:!0}],("x"==(c=l.points.errorbars)||"xy"==c)&&(l.points.xerr.asymmetric&&a.push({x:!0,number:!0,required:!0}),a.push({x:!0,number:!0,required:!0})),("y"==c||"xy"==c)&&(l.points.yerr.asymmetric&&a.push({y:!0,number:!0,required:!0}),a.push({y:!0,number:!0,required:!0})),d.format=a)}function s(a,l,c,d,h,p,g,v,r,u,f){d+=u,h+=u,p+=u,"x"==l.err?(h>c+r?o(a,[[h,d],[Math.max(c+r,f[0]),d]]):g=!1,p<c-r?o(a,[[Math.min(c-r,f[1]),d],[p,d]]):v=!1):(h<d-r?o(a,[[c,h],[c,Math.min(d-r,f[0])]]):g=!1,p>d+r?o(a,[[c,Math.max(d+r,f[1])],[c,p]]):v=!1),r=null!=l.radius?l.radius:r,g&&("-"==l.upperCap?o(a,"x"==l.err?[[h,d-r],[h,d+r]]:[[c-r,h],[c+r,h]]):e.isFunction(l.upperCap)&&("x"==l.err?l.upperCap(a,h,d,r):l.upperCap(a,c,h,r))),v&&("-"==l.lowerCap?o(a,"x"==l.err?[[p,d-r],[p,d+r]]:[[c-r,p],[c+r,p]]):e.isFunction(l.lowerCap)&&("x"==l.err?l.lowerCap(a,p,d,r):l.lowerCap(a,c,p,r)))}function o(a,l){a.beginPath(),a.moveTo(l[0][0],l[0][1]);for(var c=1;c<l.length;c++)a.lineTo(l[c][0],l[c][1]);a.stroke()}function n(a,l){var c=a.getPlotOffset();l.save(),l.translate(c.left,c.top),e.each(a.getData(),function(d,h){if(h.points.errorbars&&(h.points.xerr.show||h.points.yerr.show)){d=h.datapoints.points;var p=h.datapoints.pointsize,g=[h.xaxis,h.yaxis],v=h.points.radius,r=[h.points.xerr,h.points.yerr],u=!1;if(g[0].p2c(g[0].max)<g[0].p2c(g[0].min)){u=!0;var f=r[0].lowerCap;r[0].lowerCap=r[0].upperCap,r[0].upperCap=f}var m=!1;g[1].p2c(g[1].min)<g[1].p2c(g[1].max)&&(m=!0,f=r[1].lowerCap,r[1].lowerCap=r[1].upperCap,r[1].upperCap=f);for(var b=0;b<h.datapoints.points.length;b+=p){var w=h.datapoints.points,A=null,x=null,y=null,S=null,_=h.points.xerr,C=h.points.yerr,I=h.points.errorbars;for("x"==I||"xy"==I?_.asymmetric?(A=w[b+2],x=w[b+3],"xy"==I&&(C.asymmetric?(y=w[b+4],S=w[b+5]):y=w[b+4])):(A=w[b+2],"xy"==I&&(C.asymmetric?(y=w[b+3],S=w[b+4]):y=w[b+3])):"y"==I&&(C.asymmetric?(y=w[b+2],S=w[b+3]):y=w[b+2]),null==x&&(x=A),null==S&&(S=y),w=[A,x,y,S],_.show||(w[0]=null,w[1]=null),C.show||(w[2]=null,w[3]=null),_=w,C=0;C<r.length;C++)if(w=[g[C].min,g[C].max],_[C*r.length]&&(y=[A=d[b],x=d[b+1]][C]+_[C*r.length+1],S=[A,x][C]-_[C*r.length],"x"!=r[C].err||!(x>g[1].max||x<g[1].min||y<g[0].min||S>g[0].max))&&("y"!=r[C].err||!(A>g[0].max||A<g[0].min||y<g[1].min||S>g[1].max))){var L=I=!0;y>w[1]&&(I=!1,y=w[1]),S<w[0]&&(L=!1,S=w[0]),("x"==r[C].err&&u||"y"==r[C].err&&m)&&(f=S,S=y,y=f,f=L,L=I,I=f,f=w[0],w[0]=w[1],w[1]=f),A=g[0].p2c(A),x=g[1].p2c(x),y=g[C].p2c(y),S=g[C].p2c(S),w[0]=g[C].p2c(w[0]),w[1]=g[C].p2c(w[1]);var D=null!=h.points.shadowSize?h.points.shadowSize:h.shadowSize;0<(f=r[C].lineWidth?r[C].lineWidth:h.points.lineWidth)&&0<D&&(l.lineWidth=D/=2,l.strokeStyle="rgba(0,0,0,0.1)",s(l,r[C],A,x,y,S,I,L,v,D+D/2,w),l.strokeStyle="rgba(0,0,0,0.2)",s(l,r[C],A,x,y,S,I,L,v,D/2,w)),l.strokeStyle=r[C].color?r[C].color:h.color,l.lineWidth=f,s(l,r[C],A,x,y,S,I,L,v,0,w)}}}}),l.restore()}e.plot.plugins.push({init:function(a){a.hooks.processRawData.push(t),a.hooks.draw.push(n)},options:{series:{points:{errorbars:null,xerr:{err:"x",show:null,asymmetric:null,upperCap:null,lowerCap:null,color:null,radius:null},yerr:{err:"y",show:null,asymmetric:null,upperCap:null,lowerCap:null,color:null,radius:null}}}},name:"errorbars",version:"1.0"})}(jQuery),function(e){function t(d){var h=this,p=d.data||{};if(p.elem)h=d.dragTarget=p.elem,d.dragProxy=c.proxy||h,d.cursorOffsetX=p.pageX-p.left,d.cursorOffsetY=p.pageY-p.top,d.offsetX=d.pageX-d.cursorOffsetX,d.offsetY=d.pageY-d.cursorOffsetY;else if(c.dragging||0<p.which&&d.which!=p.which||e(d.target).is(p.not))return;switch(d.type){case"mousedown":return e.extend(p,e(h).offset(),{elem:h,target:d.target,pageX:d.pageX,pageY:d.pageY}),a.add(document,"mousemove mouseup",t,p),n(h,!1),c.dragging=null,!1;case!c.dragging&&"mousemove":if(Math.pow(d.pageX-p.pageX,2)+Math.pow(d.pageY-p.pageY,2)<p.distance)break;d.target=p.target;var g=s(d,"dragstart",h);!1!==g&&(c.dragging=h,c.proxy=d.dragProxy=e(g||h)[0]);case"mousemove":if(c.dragging){if(g=s(d,"drag",h),l.drop&&(l.drop.allowed=!1!==g,l.drop.handler(d)),!1!==g)break;d.type="mouseup"}case"mouseup":a.remove(document,"mousemove mouseup",t),c.dragging&&(l.drop&&l.drop.handler(d),s(d,"dragend",h)),n(h,!0),c.dragging=c.proxy=p.elem=!1}return!0}function s(d,h,p){return d.type=h,!1!==(h=e.event.dispatch.call(p,d))&&(h||d.result)}function o(){return!1===c.dragging}function n(d,h){d&&(d.unselectable=h?"off":"on",d.onselectstart=function(){return h},d.style&&(d.style.MozUserSelect=h?"":"none"))}e.fn.drag=function(d,h,p){return h&&this.bind("dragstart",d),p&&this.bind("dragend",p),d?this.bind("drag",h||d):this.trigger("drag")};var a=e.event,l=a.special,c=l.drag={not:":input",distance:0,which:1,dragging:!1,setup:function(d){(d=e.extend({distance:c.distance,which:c.which,not:c.not},d||{})).distance=Math.pow(d.distance,2),a.add(this,"mousedown",t,d),this.attachEvent&&this.attachEvent("ondragstart",o)},teardown:function(){a.remove(this,"mousedown",t),this===c.dragging&&(c.dragging=c.proxy=!1),n(this,!0),this.detachEvent&&this.detachEvent("ondragstart",o)}};l.dragstart=l.dragend={setup:function(){},teardown:function(){}}}(jQuery),function(e){function t(n){var a=n||window.event,l=[].slice.call(arguments,1),c=0,d=0;(n=e.event.fix(a)).type="mousewheel",a.wheelDelta&&(c=a.wheelDelta/120),a.detail&&(c=-a.detail/3);var h=c;return void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(h=0,d=-1*c),void 0!==a.wheelDeltaY&&(h=a.wheelDeltaY/120),void 0!==a.wheelDeltaX&&(d=-1*a.wheelDeltaX/120),l.unshift(n,c,d,h),(e.event.dispatch||e.event.handle).apply(this,l)}var s=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var o=s.length;o;)e.event.fixHooks[s[--o]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var n=s.length;n;)this.addEventListener(s[--n],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var n=s.length;n;)this.removeEventListener(s[--n],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})}(jQuery),function(e){e.plot.plugins.push({init:function(t){function s(g,v){var r=t.offset();r.left=g.pageX-r.left,r.top=g.pageY-r.top,v?t.zoomOut({center:r}):t.zoom({center:r})}function o(g,v){return g.preventDefault(),s(g,0>v),!1}function n(g){if(1!=g.which)return!1;var v=t.getPlaceholder().css("cursor");v&&(c=v),t.getPlaceholder().css("cursor",t.getOptions().pan.cursor),d=g.pageX,h=g.pageY}function a(g){var v=t.getOptions().pan.frameRate;!p&&v&&(p=setTimeout(function(){t.pan({left:d-g.pageX,top:h-g.pageY}),d=g.pageX,h=g.pageY,p=null},1/v*1e3))}function l(g){p&&(clearTimeout(p),p=null),t.getPlaceholder().css("cursor",c),t.pan({left:d-g.pageX,top:h-g.pageY})}var c="default",d=0,h=0,p=null;t.zoomOut=function(g){g||(g={}),g.amount||(g.amount=t.getOptions().zoom.amount),g.amount=1/g.amount,t.zoom(g)},t.zoom=function(g){g||(g={});var v=g.center,r=g.amount||t.getOptions().zoom.amount,u=t.width(),f=t.height();v||(v={left:u/2,top:f/2});var m=v.left/u,b=v.top/f,w={x:{min:v.left-m*u/r,max:v.left+(1-m)*u/r},y:{min:v.top-b*f/r,max:v.top+(1-b)*f/r}};e.each(t.getAxes(),function(A,x){var y=w[x.direction].min,S=w[x.direction].max,_=(A=x.options).zoomRange,C=A.panRange;!1!==_&&((y=x.c2p(y))>(S=x.c2p(S))&&(x=y,y=S,S=x),C&&(null!=C[0]&&y<C[0]&&(y=C[0]),null!=C[1]&&S>C[1]&&(S=C[1])),x=S-y,_&&(null!=_[0]&&x<_[0]&&1<r||null!=_[1]&&x>_[1]&&1>r)||(A.min=y,A.max=S))}),t.setupGrid(),t.draw(),g.preventEvent||t.getPlaceholder().trigger("plotzoom",[t,g])},t.pan=function(g){var v={x:+g.left,y:+g.top};isNaN(v.x)&&(v.x=0),isNaN(v.y)&&(v.y=0),e.each(t.getAxes(),function(r,u){r=u.options;var f=v[u.direction],m=u.c2p(u.p2c(u.min)+f);u=u.c2p(u.p2c(u.max)+f);var b=r.panRange;!1!==b&&(b&&(null!=b[0]&&b[0]>m&&(m+=f=b[0]-m,u+=f),null!=b[1]&&b[1]<u&&(m+=f=b[1]-u,u+=f)),r.min=m,r.max=u)}),t.setupGrid(),t.draw(),g.preventEvent||t.getPlaceholder().trigger("plotpan",[t,g])},t.hooks.bindEvents.push(function(g,v){(g=g.getOptions()).zoom.interactive&&(v[g.zoom.trigger](s),v.mousewheel(o)),g.pan.interactive&&(v.bind("dragstart",{distance:10},n),v.bind("drag",a),v.bind("dragend",l))}),t.hooks.shutdown.push(function(g,v){v.unbind(g.getOptions().zoom.trigger,s),v.unbind("mousewheel",o),v.unbind("dragstart",n),v.unbind("drag",a),v.unbind("dragend",l),p&&clearTimeout(p)})},options:{xaxis:{zoomRange:null,panRange:null},zoom:{interactive:!1,trigger:"dblclick",amount:1.5},pan:{interactive:!1,cursor:"move",frameRate:20}},name:"navigate",version:"1.3"})}(jQuery),function(e,t,s){function o(d){!0===c&&(c=d||1);for(var h=n.length-1;0<=h;h--){var p=e(n[h]);if(p[0]==t||p.is(":visible")){var g=p.width(),v=p.height(),r=p.data("resize-special-event");!r||g===r.w&&v===r.h||(p.trigger("resize",[r.w=g,r.h=v]),c=d||!0)}else(r=p.data("resize-special-event")).w=0,r.h=0}null!==l&&(c&&(null==d||1e3>d-c)?l=t.requestAnimationFrame(o):(l=setTimeout(o,a.pendingDelay),c=!1))}var l,n=[],a=e.resize=e.extend(e.resize,{}),c=!1;a.pendingDelay=200,a.activeDelay=20,a.throttleWindow=!0,e.event.special.resize={setup:function(){if(!a.throttleWindow&&this.setTimeout)return!1;var d=e(this);n.push(this),d.data("resize-special-event",{w:d.width(),h:d.height()}),1===n.length&&(l=s,o())},teardown:function(){if(!a.throttleWindow&&this.setTimeout)return!1;for(var d=e(this),h=n.length-1;0<=h;h--)if(n[h]==this){n.splice(h,1);break}d.removeData("resize-special-event"),n.length||(c?cancelAnimationFrame(l):clearTimeout(l),l=null)},add:function(d){function h(g,v,r){var u=e(this),f=u.data("resize-special-event")||{};f.w=v!==s?v:u.width(),f.h=r!==s?r:u.height(),p.apply(this,arguments)}if(!a.throttleWindow&&this.setTimeout)return!1;if(e.isFunction(d)){var p=d;return h}p=d.handler,d.handler=h}},t.requestAnimationFrame||(t.requestAnimationFrame=t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(d,h){return t.setTimeout(function(){d((new Date).getTime())},a.activeDelay)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout)}(jQuery,this),jQuery.plot.plugins.push({init:function(t){function s(){var o=t.getPlaceholder();0!=o.width()&&0!=o.height()&&(t.resize(),t.setupGrid(),t.draw())}t.hooks.bindEvents.push(function(o,n){o.getPlaceholder().resize(s)}),t.hooks.shutdown.push(function(o,n){o.getPlaceholder().unbind("resize",s)})},options:{},name:"resize",version:"1.0"}),function(e){e.plot.plugins.push({init:function(t){function s(u){g.active&&(c(u),t.getPlaceholder().trigger("plotselecting",[n()]))}function o(u){1==u.which&&(document.body.focus(),void 0!==document.onselectstart&&null==v.onselectstart&&(v.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==v.ondrag&&(v.ondrag=document.ondrag,document.ondrag=function(){return!1}),l(g.first,u),g.active=!0,r=function(f){r=null,void 0!==document.onselectstart&&(document.onselectstart=v.onselectstart),void 0!==document.ondrag&&(document.ondrag=v.ondrag),g.active=!1,c(f),p()?a():(t.getPlaceholder().trigger("plotunselected",[]),t.getPlaceholder().trigger("plotselecting",[null]))},e(document).one("mouseup",r))}function n(){if(!p()||!g.show)return null;var u={},f=g.first,m=g.second;return e.each(t.getAxes(),function(b,w){if(w.used){var A=w.c2p(f[w.direction]);w=w.c2p(m[w.direction]),u[b]={from:Math.min(A,w),to:Math.max(A,w)}}}),u}function a(){var u=n();t.getPlaceholder().trigger("plotselected",[u]),u.xaxis&&u.yaxis&&t.getPlaceholder().trigger("selected",[{x1:u.xaxis.from,y1:u.yaxis.from,x2:u.xaxis.to,y2:u.yaxis.to}])}function l(u,f){var m=t.getOptions(),b=t.getPlaceholder().offset(),w=t.getPlotOffset(),A=f.pageX-b.left-w.left,x=t.width();u.x=0>A?0:A>x?x:A,f=f.pageY-b.top-w.top,b=t.height(),u.y=0>f?0:f>b?b:f,"y"==m.selection.mode&&(u.x=u==g.first?0:t.width()),"x"==m.selection.mode&&(u.y=u==g.first?0:t.height())}function c(u){null!=u.pageX&&(l(g.second,u),p()?(g.show=!0,t.triggerRedrawOverlay()):d(!0))}function d(u){g.show&&(g.show=!1,t.triggerRedrawOverlay(),u||t.getPlaceholder().trigger("plotunselected",[]))}function h(u,f){var b,m=t.getAxes();for(b in m){var w=m[b];if(w.direction==f){var A=f+w.n+"axis";if(u[A]||1!=w.n||(A=f+"axis"),u[A]){var x=u[A].from,y=u[A].to;break}}}return u[A]||(w="x"==f?t.getXAxes()[0]:t.getYAxes()[0],x=u[f+"1"],y=u[f+"2"]),null!=x&&null!=y&&x>y&&(u=x,x=y,y=u),{from:x,to:y,axis:w}}function p(){var u=t.getOptions().selection.minSize;return Math.abs(g.second.x-g.first.x)>=u&&Math.abs(g.second.y-g.first.y)>=u}var g={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},v={},r=null;t.clearSelection=d,t.setSelection=function(u,f){var m=t.getOptions();if("y"==m.selection.mode)g.first.x=0,g.second.x=t.width();else{var b=h(u,"x");g.first.x=b.axis.p2c(b.from),g.second.x=b.axis.p2c(b.to)}"x"==m.selection.mode?(g.first.y=0,g.second.y=t.height()):(b=h(u,"y"),g.first.y=b.axis.p2c(b.from),g.second.y=b.axis.p2c(b.to)),g.show=!0,t.triggerRedrawOverlay(),!f&&p()&&a()},t.getSelection=n,t.hooks.bindEvents.push(function(u,f){null!=u.getOptions().selection.mode&&(f.mousemove(s),f.mousedown(o))}),t.hooks.drawOverlay.push(function(u,f){if(g.show&&p()){var m=u.getPlotOffset();u=u.getOptions(),f.save(),f.translate(m.left,m.top),m=e.color.parse(u.selection.color),f.strokeStyle=m.scale("a",.8).toString(),f.lineWidth=1,f.lineJoin=u.selection.shape,f.fillStyle=m.scale("a",.4).toString(),m=Math.min(g.first.x,g.second.x)+.5,u=Math.min(g.first.y,g.second.y)+.5;var b=Math.abs(g.second.x-g.first.x)-1,w=Math.abs(g.second.y-g.first.y)-1;f.fillRect(m,u,b,w),f.strokeRect(m,u,b,w),f.restore()}}),t.hooks.shutdown.push(function(u,f){f.unbind("mousemove",s),f.unbind("mousedown",o),r&&e(document).unbind("mouseup",r)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery),($jscomp=$jscomp||{}).scope={},$jscomp.findInternal=function(e,t,s){e instanceof String&&(e=String(e));for(var o=e.length,n=0;n<o;n++){var a=e[n];if(t.call(s,a,n,e))return{i:n,v:a}}return{i:-1,v:void 0}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){e!=Array.prototype&&e!=Object.prototype&&(e[t]=s.value)},$jscomp.getGlobal=function(e){return typeof window<"u"&&window===e?e:typeof global<"u"&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,s,o){if(t){for(s=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var n=e[o];n in s||(s[n]={}),s=s[n]}(t=t(o=s[e=e[e.length-1]]))!=o&&null!=t&&$jscomp.defineProperty(s,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(t,s){return $jscomp.findInternal(this,t,s).v}},"es6","es3"),function(e){function t(a,l){o&&(a.stack=[],l=a.getPlaceholder(),e(l).append("<div style='position:relative'><div style='z-index:100;position:absolute;right:12;top:12;z-index:2'>\t\t             <img class='zoomout' width='16' height='16' title='' alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABYlBMVEU9m+Y6l+I8meQ+nehAn+o/nuk8muU3luEujdgsi9Yujdcwj9ogf8ojgs0ce8YYd8IaecQZa7YbbrkabbgWZ7IVZrEIVaAMWqUQYKsCFSgAAAA/nehAn+pAn+o9m+ZVru09m+Y8meQ+neg8meRUruxQquo6l+I/nulVr+44l+JMqOg3luEsi9ZqyfYujdcgf8o2mNpgxPQjgs0ce8YaecQbesUZa7YabbgabLcWZ7IcfcQpq+sVZrEQX6oepuoQYKsMWqUPcrwMWqUIVJ8UcbgKbbcJVqEIVaANb7gFUJsPbLQEPXUDKU8JarQBFCYCTJcCN2wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZ5f+V5P+U5P+I3/9Qm9GY5f+W5P9Pm9F93P+T4/+R4/+N4f+L4f9k1P9f0v9Tzv9OzP8zisgivf8Xuv8xishAx/8zw/8jvv8Wuv8twf8Uuf////9LFEt0AAAAWnRSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzzHDM2XAzM3DZ2YXM2XDZzIXzzDPZ88wzzJkzzJkz2fPMhfPMcNnMcNnZhczZzNlwM9lAzIMyLioiGx0mKy/TF9BpAAAAAWJLR0R1qGqY+wAAAPtJREFUGNMVxedfQVEYAOD3cm8iDm84114l2SuyZ5LcjHaKop3R/P9/nft8ecDucAKnUPK8UsGB02EH18jt4bw+nvd5OY975IKt7Vv/jj8gCAHW3a4T1oKh8eQ+rFKFHybjUFCAdXVkOovGNJpYdDaNqDdAG088Jp9SOl3qOfmSiGuBpPeYDCEZ+TQBQvSMgRCDPCGAuMkYEY3yiIDZfSaHmJPPIpjyhdfiW8lsLr0XPwp5E1CxPF9UqhZLtbKYl0UKtFZfrj4botj4Wi3rNQrNg+/WYatNaZv1c9SEzu9x1ypJNpskWbsnfx3o9QfD07Pzi8ur65vhoN/7B9wsL7lanTVQAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDEzLTA0LTAzVDE3OjE4OjAxKzA4OjAw0kcQ3gAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxMS0wNS0xOFQyMzoyNzowMCswODowMPWTeDEAAABNdEVYdHNvZnR3YXJlAEltYWdlTWFnaWNrIDYuOC44LTcgUTE2IHg4Nl82NCAyMDE0LTAyLTI4IGh0dHA6Ly93d3cuaW1hZ2VtYWdpY2sub3JnWaRffwAAABh0RVh0VGh1bWI6OkRvY3VtZW50OjpQYWdlcwAxp/+7LwAAABd0RVh0VGh1bWI6OkltYWdlOjpIZWlnaHQAMTYdr15vAAAAFnRFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADE25QCe4gAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxMzA1NzMyNDIw3zNdNgAAABF0RVh0VGh1bWI6OlNpemUANzcxQkKQmHCaAAAAYHRFWHRUaHVtYjo6VVJJAGZpbGU6Ly8vaG9tZS9mdHAvMTUyMC9lYXN5aWNvbi5jbi9lYXN5aWNvbi5jbi9jZG4taW1nLmVhc3lpY29uLmNuL3BuZy81MTIyLzUxMjIzMy5wbmelXfH0AAAAAElFTkSuQmCC' /></div></div>"),e(l).bind("plotselected",function(c,d){c=n.zoomFunc;var h=a.getAxes(),p=a.getPlaceholder(),g={};g.xmin=h.xaxis.min,g.xmax=h.xaxis.max,g.ymin=h.yaxis.min,g.ymax=h.yaxis.max,a.stack.push(g),h.xaxis.options.min=d.xaxis.from,h.xaxis.options.max=d.xaxis.to,h.yaxis.options.min=d.yaxis.from,h.yaxis.options.max=d.yaxis.to,a.clearSelection(!0),a.setupGrid(),a.draw(),e(p).find(".zoomout").css("visibility","visible"),void 0!==c&&c(a,g)}),e(l).find(".zoomout").click(function(){var c=n.zoomFunc,d=a.stack.pop(),h=a.getPlaceholder();0===a.stack.length&&e(h).find(".zoomout").css("visibility","hidden"),a.getAxes().xaxis.options.min=d.xmin,a.getAxes().xaxis.options.max=d.xmax,a.getAxes().yaxis.options.min=d.ymin,a.getAxes().yaxis.options.max=d.ymax,a.clearSelection(!0),a.setupGrid(),a.draw(),void 0!==c&&c(a,d)}),e(l).find(".zoomout").css("visibility","hidden"),o=0)}function s(a,l){l&&l.zoomStack&&("object"==typeof l.zoomStack?(n.zoomStack=l.zoomStack.enabled,n.zoomFunc=l.zoomStack.func):n.zoomStack=l.zoomStack),n.zoomStack&&(o=1,a.hooks.drawOverlay.push(t))}var o=0,n={zoomStack:0,zoomFunc:void 0};e.plot.plugins.push({init:function(a){a.hooks.processOptions.push(s)},options:n,name:"zoomStack",version:.1})}($);var dhtmlwindow={imagefiles:["windowfiles/min.gif","windowfiles/close.gif","windowfiles/restore.gif","windowfiles/resize.gif"],ajaxbustcache:!0,ajaxloadinghtml:"<b>Loading Page. Please wait...</b>",minimizeorder:0,zIndexvalue:100,tobjects:[],lastactivet:{},init:function(e){var t=document.createElement("div");t.id=e,t.className="dhtmlwindow";var s="";for(s='<div class="drag-handle">',s=navigator.platform.match(/^Win/)?s+'DHTML Window <div class="drag-controls"><img src="'+this.imagefiles[0]+'" title="Minimize" /><img src="'+this.imagefiles[1]+'" title="Close" /></div>':s+'DHTML Window <div class="drag-controls"><div class="osxButtons"><div class="osxClose"><a class="osxA osxClosebutton" href="#"><span class="osxSpan"><strong title="Close">\xd7</strong></span></a></div><div class="osxMinimize"><a class="osxA osxMinimizebutton" href="#"><span class="osxSpan"><strong title="Minimize">&ndash;</strong></span></a></div></div></div>',t.innerHTML=(s=s+'</div><div class="drag-contentarea"></div><div class="drag-statusarea"><div class="drag-resizearea" style="background: transparent url('+this.imagefiles[3]+') top right no-repeat;">&nbsp;</div></div>')+"</div>",document.getElementById("dhtmlwindowholder").appendChild(t),t=(e=document.getElementById(e)).getElementsByTagName("div"),s=0;s<t.length;s++)/drag-/.test(t[s].className)&&(e[t[s].className.replace(/drag-/,"")]=t[s]);return e.handle._parent=e,e.resizearea._parent=e,e.controls._parent=e,e.onclose=function(){return!0},e.onmousedown=function(){dhtmlwindow.setfocus(this)},e.ontouchstart=function(){dhtmlwindow.setfocus(this)},e.handle.onmousedown=dhtmlwindow.setupdrag,e.handle.ontouchstart=dhtmlwindow.setupdrag,e.resizearea.onmousedown=dhtmlwindow.setupdrag,e.resizearea.ontouchstart=dhtmlwindow.setupdrag,e.controls.onclick=dhtmlwindow.enablecontrols,e.show=function(){dhtmlwindow.show(this)},e.hide=function(){dhtmlwindow.hide(this)},e.close=function(){dhtmlwindow.close(this)},e.setSize=function(o,n){dhtmlwindow.setSize(this,o,n)},e.moveTo=function(o,n){dhtmlwindow.moveTo(this,o,n)},e.isResize=function(o){dhtmlwindow.isResize(this,o)},e.isScrolling=function(o){dhtmlwindow.isScrolling(this,o)},e.load=function(o,n,a){dhtmlwindow.load(this,o,n,a)},this.tobjects[this.tobjects.length]=e},open:function(e,t,s,o,n,a){function l(h){return new RegExp(h+"=([^,]+)","i").test(n)?parseInt(RegExp.$1):0}e=null==document.getElementById(e)?this.init(e):document.getElementById(e),this.setfocus(e),e.setSize(l("width"),l("height"));var c=l("center")?"middle":l("left"),d=l("center")?"middle":l("top");return typeof a<"u"&&"recal"==a&&0==this.scroll_top&&(window.attachEvent&&!window.opera?this.addEvent(window,function(){setTimeout(function(){e.moveTo(c,d)},400)},"load"):this.addEvent(window,function(){e.moveTo(c,d)},"load")),e.isResize(l("resize")),e.isScrolling(l("scrolling")),e.style.visibility="visible",e.style.display="block",e.contentarea.style.display="block",e.moveTo(c,d),e.load(t,s,o),"minimized"==e.state&&"Restore"==e.controls.firstChild.title&&(e.controls.firstChild.setAttribute("src",dhtmlwindow.imagefiles[0]),e.controls.firstChild.setAttribute("title","Minimize"),e.state="fullview"),e},setSize:function(e,t,s){e.style.width=Math.max(parseInt(t),150)+"px",e.contentarea.style.height=Math.max(parseInt(s),20)+"px"},moveTo:function(e,t,s){this.getviewpoint(),e.style.left="middle"==t?this.scroll_left+(this.docwidth-e.offsetWidth)/2+"px":this.scroll_left+parseInt(t)+"px",e.style.top="middle"==s?this.scroll_top+(this.docheight-e.offsetHeight)/2+"px":this.scroll_top+parseInt(s)+"px"},isResize:function(e,t){e.statusarea.style.display=t?"block":"none",e.resizeBool=t?1:0},isScrolling:function(e,t){e.contentarea.style.overflow=t?"auto":"hidden"},load:function(e,t,s,o){e.isClosed?alert("DHTML Window has been closed, so no window to load contents into. Open/Create the window again."):(t=t.toLowerCase(),typeof o<"u"&&(e.handle.firstChild.nodeValue=o),"inline"==t?e.contentarea.innerHTML=s:"div"==t?(s=document.getElementById(s),e.contentarea.innerHTML=s.defaultHTML||s.innerHTML,s.defaultHTML||(s.defaultHTML=s.innerHTML),s.innerHTML="",s.style.display="none"):"iframe"==t?(e.contentarea.style.overflow="hidden",e.contentarea.firstChild&&"IFRAME"==e.contentarea.firstChild.tagName||(e.contentarea.innerHTML='<iframe src="" style="margin:0; padding:0; width:100%; height: 100%" name="_iframe-'+e.id+'"></iframe>'),window.frames["_iframe-"+e.id].location.replace(s)):"ajax"==t&&this.ajax_connect(s,e),e.contentarea.datatype=t)},setupdrag:function(e){var t=dhtmlwindow,s=this._parent;return t.etarget=this,(e=window.event||e).touches&&e.touches.length?(t.initmousex=e.touches[0].clientX,t.initmousey=e.touches[0].clientY):(t.initmousex=e.clientX,t.initmousey=e.clientY),t.initx=parseInt(s.offsetLeft),t.inity=parseInt(s.offsetTop),t.width=parseInt(s.offsetWidth),t.contentheight=parseInt(s.contentarea.offsetHeight),"iframe"==s.contentarea.datatype&&(s.style.backgroundColor="#F8F8F8",s.contentarea.style.visibility="hidden"),document.onmousemove=t.getdistance,document.ontouchmove=t.getdistance,document.onmouseup=function(){"iframe"==s.contentarea.datatype&&(s.contentarea.style.backgroundColor="white",s.contentarea.style.visibility="visible"),t.stop()},document.ontouchend=function(){"iframe"==s.contentarea.datatype&&(s.contentarea.style.backgroundColor="white",s.contentarea.style.visibility="visible"),t.stop()},!1},getdistance:function(e){var t=dhtmlwindow,s=t.etarget;return(e=window.event||e).touches&&e.touches.length?(t.distancex=e.touches[0].clientX-t.initmousex,t.distancey=e.touches[0].clientY-t.initmousey):(t.distancex=e.clientX-t.initmousex,t.distancey=e.clientY-t.initmousey),"drag-handle"==s.className?t.move(s._parent,e):"drag-resizearea"==s.className&&t.resize(s._parent,e),!1},getviewpoint:function(){var e=document.all&&!window.opera,t=document.documentElement&&parseInt(document.documentElement.clientWidth)||1e5;this.standardbody="CSS1Compat"==document.compatMode?document.documentElement:document.body,this.scroll_top=e?this.standardbody.scrollTop:window.pageYOffset,this.scroll_left=e?this.standardbody.scrollLeft:window.pageXOffset,this.docwidth=e?this.standardbody.clientWidth:/Safari/i.test(navigator.userAgent)?window.innerWidth:Math.min(t,window.innerWidth-16),this.docheight=e?this.standardbody.clientHeight:window.innerHeight},rememberattrs:function(e){this.getviewpoint(),e.lastx=parseInt(e.style.left||e.offsetLeft)-dhtmlwindow.scroll_left,e.lasty=parseInt(e.style.top||e.offsetTop)-dhtmlwindow.scroll_top,e.lastwidth=parseInt(e.style.width)},move:function(e,t){e.style.left=Math.max(0,dhtmlwindow.distancex+dhtmlwindow.initx)+"px",e.style.top=Math.max(0,dhtmlwindow.distancey+dhtmlwindow.inity)+"px"},resize:function(e,t){e.style.width=Math.max(dhtmlwindow.width+dhtmlwindow.distancex,150)+"px",e.contentarea.style.height=Math.max(dhtmlwindow.contentheight+dhtmlwindow.distancey,20)+"px"},enablecontrols:function(e){var t=dhtmlwindow;return e=window.event?window.event.srcElement:e.target,/Minimize/i.test(e.getAttribute("title"))?t.minimize(e,this._parent):/Restore/i.test(e.getAttribute("title"))?t.restore(e,this._parent):/Close/i.test(e.getAttribute("title"))&&t.close(this._parent),!1},minimize:function(e,t){dhtmlwindow.rememberattrs(t),e.setAttribute("src",dhtmlwindow.imagefiles[2]),e.setAttribute("title","Restore"),t.state="minimized",t.contentarea.style.display="none",t.statusarea.style.display="none",typeof t.minimizeorder>"u"&&(dhtmlwindow.minimizeorder++,t.minimizeorder=dhtmlwindow.minimizeorder),t.style.left="10px",t.style.width="200px",t.style.top=dhtmlwindow.scroll_top+dhtmlwindow.docheight-t.handle.offsetHeight*t.minimizeorder-10*t.minimizeorder+"px"},restore:function(e,t){dhtmlwindow.getviewpoint(),e.setAttribute("src",dhtmlwindow.imagefiles[0]),e.setAttribute("title","Minimize"),t.state="fullview",t.style.display="block",t.contentarea.style.display="block",t.resizeBool&&(t.statusarea.style.display="block"),t.style.left=parseInt(t.lastx)+dhtmlwindow.scroll_left+"px",t.style.top=parseInt(t.lasty)+dhtmlwindow.scroll_top+"px",t.style.width=parseInt(t.lastwidth)+"px"},close:function(e){try{var t=e.onclose()}catch{t=!0}finally{typeof t>"u"&&(alert('An error has occured somwhere inside your "onclose" event handler'),t=!0)}return t&&("minimized"!=e.state&&dhtmlwindow.rememberattrs(e),window.frames["_iframe-"+e.id]?window.frames["_iframe-"+e.id].location.replace("about:blank"):e.contentarea.innerHTML="",e.style.display="none",e.isClosed=!0),t},setopacity:function(e,t){e&&(e.filters&&e.filters[0]?"number"==typeof e.filters[0].opacity?e.filters[0].opacity=100*t:e.style.filter="alpha(opacity="+100*t+")":typeof e.style.MozOpacity<"u"?e.style.MozOpacity=t:typeof e.style.opacity<"u"&&(e.style.opacity=t))},setfocus:function(e){this.zIndexvalue++,e.style.zIndex=this.zIndexvalue,e.isClosed=!1,this.setopacity(this.lastactivet.handle,.5),this.setopacity(e.handle,1),this.lastactivet=e},show:function(e){e.isClosed?alert("DHTML Window has been closed, so nothing to show. Open/Create the window again."):(e.lastx?dhtmlwindow.restore(e.controls.firstChild,e):e.style.display="block",this.setfocus(e),e.state="fullview")},hide:function(e){e.style.display="none"},ajax_connect:function(e,t){var s=!1,o="";if(window.XMLHttpRequest)s=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;try{s=new ActiveXObject("Msxml2.XMLHTTP")}catch{try{s=new ActiveXObject("Microsoft.XMLHTTP")}catch{}}}t.contentarea.innerHTML=this.ajaxloadinghtml,s.onreadystatechange=function(){dhtmlwindow.ajax_loadpage(s,t)},this.ajaxbustcache&&(o=-1!=e.indexOf("?")?"&"+(new Date).getTime():"?"+(new Date).getTime()),s.open("GET",e+o,!0),s.send(null)},ajax_loadpage:function(e,t){4!=e.readyState||200!=e.status&&-1!=window.location.href.indexOf("http")||(t.contentarea.innerHTML=e.responseText)},stop:function(){dhtmlwindow.etarget=null,dhtmlwindow.distancex=0,dhtmlwindow.distancey=0,document.onmousemove=null,document.ontouchmove=null,document.onmouseup=null,document.ontouchend=null},addEvent:function(e,t,s){s=window.addEventListener?s:"on"+s,e.addEventListener?e.addEventListener(s,t,!1):e.attachEvent&&e.attachEvent(s,t)},cleanup:function(){for(var e=0;e<dhtmlwindow.tobjects.length;e++)dhtmlwindow.tobjects[e].handle._parent=dhtmlwindow.tobjects[e].resizearea._parent=dhtmlwindow.tobjects[e].controls._parent=null;window.onload=null}};window.onunload=dhtmlwindow.cleanup;var fabric=fabric||{version:"5.2.1"};if(typeof exports<"u"?exports.fabric=fabric:"function"==typeof define&&define.amd&&define([],function(){return fabric}),typeof document<"u"&&typeof window<"u")fabric.document=document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),fabric.window=window;else{var jsdom=require("jsdom"),virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;fabric.document=virtualWindow.document,fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=virtualWindow,DOMParser=fabric.window.DOMParser}function resizeCanvasIfNeeded(e){var t=e.targetCanvas,n=e.destinationWidth,a=e.destinationHeight;t.width===n&&t.height===a||(t.width=n,t.height=a)}function copyGLTo2DDrawImage(e,t){var s=e.canvas,o=t.targetCanvas,n=o.getContext("2d");n.translate(0,o.height),n.scale(1,-1),n.drawImage(s,0,s.height-o.height,o.width,o.height,0,0,o.width,o.height)}function copyGLTo2DPutImageData(e,t){var s=t.targetCanvas.getContext("2d"),o=t.destinationWidth,n=t.destinationHeight,a=o*n*4,l=new Uint8Array(this.imageBuffer,0,a),c=new Uint8ClampedArray(this.imageBuffer,0,a);e.readPixels(0,0,o,n,e.RGBA,e.UNSIGNED_BYTE,l);var d=new ImageData(c,o,n);s.putImageData(d,0,0)}function ddtabcontent(e){this.tabinterfaceid=e,this.tabs=document.getElementById(e).getElementsByTagName("a"),this.enabletabpersistence=!0,this.hottabspositions=[],this.currentTabIndex=0,this.subcontentids=[],this.revcontentids=[],this.selectedClassTarget="link"}fabric.isTouchSupported="ontouchstart"in fabric.window||"ontouchstart"in fabric.document||fabric.window&&fabric.window.navigator&&0<fabric.window.navigator.maxTouchPoints,fabric.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",fabric.commaWsp="(?:\\s+,?\\s*|,\\s*)",fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,fabric.reNonWord=/[ \n\.,;!\?\-]/,fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.svgNS="http://www.w3.org/2000/svg",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.disableStyleCopyPaste=!1,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.arcToSegmentsCache={},fabric.boundsOfCurveCache={},fabric.cachesBoundsOfCurve=!0,fabric.forceGLPutImageData=!1,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=fabric),function(){function e(s,o){if(this.__eventListeners[s]){var n=this.__eventListeners[s];o?n[n.indexOf(o)]=!1:fabric.util.array.fill(n,!1)}}function t(s,o){var n=function(){o.apply(this,arguments),this.off(s,n)}.bind(this);this.on(s,n)}fabric.Observable={fire:function(s,o){if(!this.__eventListeners)return this;var n=this.__eventListeners[s];if(!n)return this;for(var a=0,l=n.length;a<l;a++)n[a]&&n[a].call(this,o||{});return this.__eventListeners[s]=n.filter(function(c){return!1!==c}),this},on:function(s,o){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var n in s)this.on(n,s[n]);else this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(o);return this},once:function(s,o){if(1===arguments.length)for(var n in s)t.call(this,n,s[n]);else t.call(this,s,o);return this},off:function(s,o){if(!this.__eventListeners)return this;if(0===arguments.length)for(s in this.__eventListeners)e.call(this,s);else if(1===arguments.length&&"object"==typeof s)for(var n in s)e.call(this,n,s[n]);else e.call(this,s,o);return this}}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,s){var o=this._objects;return s?o[t]=e:o.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e,t=this._objects,s=!1,o=0,n=arguments.length;o<n;o++)-1!==(e=t.indexOf(arguments[o]))&&(s=!0,t.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[o]));return this.renderOnAddRemove&&s&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var s=this.getObjects(),o=0,n=s.length;o<n;o++)e.call(t,s[o],o,s);return this},getObjects:function(e){return void 0===e?this._objects.concat():this._objects.filter(function(t){return t.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(e,t){return-1<this._objects.indexOf(e)||!!t&&this._objects.some(function(s){return"function"==typeof s.contains&&s.contains(e,!0)})},complexity:function(){return this._objects.reduce(function(e,t){return e+(t.complexity?t.complexity():0)},0)}},fabric.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){!e||!e.colorStops||e instanceof fabric.Gradient||this.set(t,new fabric.Gradient(e))},_initPattern:function(e,t,s){!e||!e.source||e instanceof fabric.Pattern?s&&s():this.set(t,new fabric.Pattern(e,s))},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return"object"==typeof e?this._setObject(e):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return"boolean"==typeof t&&this.set(e,!t),this},get:function(e){return this[e]}},function(e){var t=Math.sqrt,s=Math.atan2,o=Math.pow,n=Math.PI/180,a=Math.PI/2;fabric.util={cos:function(l){if(0===l)return 1;switch(l<0&&(l=-l),l/a){case 1:case 3:return 0;case 2:return-1}return Math.cos(l)},sin:function(l){if(0===l)return 0;var c=1;switch(l<0&&(c=-1),l/a){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(l)},removeFromArray:function(l,c){var d=l.indexOf(c);return-1!==d&&l.splice(d,1),l},getRandomInt:function(l,c){return Math.floor(Math.random()*(c-l+1))+l},degreesToRadians:function(l){return l*n},radiansToDegrees:function(l){return l/n},rotatePoint:function(l,c,d){var h=new fabric.Point(l.x-c.x,l.y-c.y),p=fabric.util.rotateVector(h,d);return new fabric.Point(p.x,p.y).addEquals(c)},rotateVector:function(l,c){var d=fabric.util.sin(c),h=fabric.util.cos(c);return{x:l.x*h-l.y*d,y:l.x*d+l.y*h}},createVector:function(l,c){return new fabric.Point(c.x-l.x,c.y-l.y)},calcAngleBetweenVectors:function(l,c){return Math.acos((l.x*c.x+l.y*c.y)/(Math.hypot(l.x,l.y)*Math.hypot(c.x,c.y)))},getHatVector:function(l){return new fabric.Point(l.x,l.y).multiply(1/Math.hypot(l.x,l.y))},getBisector:function(l,c,d){var h=fabric.util.createVector(l,c),p=fabric.util.createVector(l,d),g=fabric.util.calcAngleBetweenVectors(h,p),v=g*(0===fabric.util.calcAngleBetweenVectors(fabric.util.rotateVector(h,g),p)?1:-1)/2;return{vector:fabric.util.getHatVector(fabric.util.rotateVector(h,v)),angle:g}},projectStrokeOnPoints:function(l,c,d){var h=[],p=c.strokeWidth/2,g=c.strokeUniform?new fabric.Point(1/c.scaleX,1/c.scaleY):new fabric.Point(1,1),v=function(r){var u=p/Math.hypot(r.x,r.y);return new fabric.Point(r.x*u*g.x,r.y*u*g.y)};return l.length<=1||l.forEach(function(r,u){var f,m,b=new fabric.Point(r.x,r.y);0===u?(m=l[u+1],f=d?v(fabric.util.createVector(m,b)).addEquals(b):l[l.length-1]):u===l.length-1?(f=l[u-1],m=d?v(fabric.util.createVector(f,b)).addEquals(b):l[0]):(f=l[u-1],m=l[u+1]);var w,A,x=fabric.util.getBisector(b,f,m),y=x.vector;if("miter"===c.strokeLineJoin&&(w=-p/Math.sin(x.angle/2),A=new fabric.Point(y.x*w*g.x,y.y*w*g.y),Math.hypot(A.x,A.y)/p<=c.strokeMiterLimit))return h.push(b.add(A)),void h.push(b.subtract(A));w=-p*Math.SQRT2,A=new fabric.Point(y.x*w*g.x,y.y*w*g.y),h.push(b.add(A)),h.push(b.subtract(A))}),h},transformPoint:function(l,c,d){return d?new fabric.Point(c[0]*l.x+c[2]*l.y,c[1]*l.x+c[3]*l.y):new fabric.Point(c[0]*l.x+c[2]*l.y+c[4],c[1]*l.x+c[3]*l.y+c[5])},makeBoundingBoxFromPoints:function(l,c){if(c)for(var d=0;d<l.length;d++)l[d]=fabric.util.transformPoint(l[d],c);var h=[l[0].x,l[1].x,l[2].x,l[3].x],p=fabric.util.array.min(h),g=fabric.util.array.max(h)-p,v=[l[0].y,l[1].y,l[2].y,l[3].y],r=fabric.util.array.min(v);return{left:p,top:r,width:g,height:fabric.util.array.max(v)-r}},invertTransform:function(l){var c=1/(l[0]*l[3]-l[1]*l[2]),d=[c*l[3],-c*l[1],-c*l[2],c*l[0]],h=fabric.util.transformPoint({x:l[4],y:l[5]},d,!0);return d[4]=-h.x,d[5]=-h.y,d},toFixed:function(l,c){return parseFloat(Number(l).toFixed(c))},parseUnit:function(l,c){var d=/\D{0,2}$/.exec(l),h=parseFloat(l);switch(c||(c=fabric.Text.DEFAULT_SVG_FONT_SIZE),d[0]){case"mm":return h*fabric.DPI/25.4;case"cm":return h*fabric.DPI/2.54;case"in":return h*fabric.DPI;case"pt":return h*fabric.DPI/72;case"pc":return h*fabric.DPI/72*12;case"em":return h*c;default:return h}},falseFunction:function(){return!1},getKlass:function(l,c){return l=fabric.util.string.camelize(l.charAt(0).toUpperCase()+l.slice(1)),fabric.util.resolveNamespace(c)[l]},getSvgAttributes:function(l){var c=["instantiated_by_use","style","id","class"];switch(l){case"linearGradient":c=c.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":c=c.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":c=c.concat(["offset","stop-color","stop-opacity"])}return c},resolveNamespace:function(l){if(!l)return fabric;var c,d=l.split("."),h=d.length,p=e||fabric.window;for(c=0;c<h;++c)p=p[d[c]];return p},loadImage:function(l,c,d,h){if(l){var p=fabric.util.createImage(),g=function(){c&&c.call(d,p,!1),p=p.onload=p.onerror=null};p.onload=g,p.onerror=function(){fabric.log("Error loading "+p.src),c&&c.call(d,null,!0),p=p.onload=p.onerror=null},0!==l.indexOf("data")&&null!=h&&(p.crossOrigin=h),"data:image/svg"===l.substring(0,14)&&(p.onload=null,fabric.util.loadImageInDom(p,g)),p.src=l}else c&&c.call(d,l)},loadImageInDom:function(l,c){var d=fabric.document.createElement("div");d.style.width=d.style.height="1px",d.style.left=d.style.top="-100%",d.style.position="absolute",d.appendChild(l),fabric.document.querySelector("body").appendChild(d),l.onload=function(){c(),d.parentNode.removeChild(d),d=null}},enlivenObjects:function(l,c,d,h){var p=[],g=0,v=(l=l||[]).length;function r(){++g===v&&c&&c(p.filter(function(u){return u}))}v?l.forEach(function(u,f){u&&u.type?fabric.util.getKlass(u.type,d).fromObject(u,function(m,b){b||(p[f]=m),h&&h(u,m,b),r()}):r()}):c&&c(p)},enlivenObjectEnlivables:function(l,c,d){var h=fabric.Object.ENLIVEN_PROPS.filter(function(p){return!!l[p]});fabric.util.enlivenObjects(h.map(function(p){return l[p]}),function(p){var g={};h.forEach(function(v,r){g[v]=p[r],c&&(c[v]=p[r])}),d&&d(g)})},enlivenPatterns:function(l,c){function d(){++p===g&&c&&c(h)}var h=[],p=0,g=(l=l||[]).length;g?l.forEach(function(v,r){v&&v.source?new fabric.Pattern(v,function(u){h[r]=u,d()}):(h[r]=v,d())}):c&&c(h)},groupSVGElements:function(l,c,d){var h;return l&&1===l.length?l[0]:(c&&(c.width&&c.height?c.centerPoint={x:c.width/2,y:c.height/2}:(delete c.width,delete c.height)),h=new fabric.Group(l,c),void 0!==d&&(h.sourcePath=d),h)},populateWithProperties:function(l,c,d){if(d&&Array.isArray(d))for(var h=0,p=d.length;h<p;h++)d[h]in l&&(c[d[h]]=l[d[h]])},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(l){var c=fabric.util.createCanvasElement();return c.width=l.width,c.height=l.height,c.getContext("2d").drawImage(l,0,0),c},toDataURL:function(l,c,d){return l.toDataURL("image/"+c,d)},createImage:function(){return fabric.document.createElement("img")},multiplyTransformMatrices:function(l,c,d){return[l[0]*c[0]+l[2]*c[1],l[1]*c[0]+l[3]*c[1],l[0]*c[2]+l[2]*c[3],l[1]*c[2]+l[3]*c[3],d?0:l[0]*c[4]+l[2]*c[5]+l[4],d?0:l[1]*c[4]+l[3]*c[5]+l[5]]},qrDecompose:function(l){var c=s(l[1],l[0]),d=o(l[0],2)+o(l[1],2),h=t(d),p=(l[0]*l[3]-l[2]*l[1])/h,g=s(l[0]*l[2]+l[1]*l[3],d);return{angle:c/n,scaleX:h,scaleY:p,skewX:g/n,skewY:0,translateX:l[4],translateY:l[5]}},calcRotateMatrix:function(l){if(!l.angle)return fabric.iMatrix.concat();var c=fabric.util.degreesToRadians(l.angle),d=fabric.util.cos(c),h=fabric.util.sin(c);return[d,h,-h,d,0,0]},calcDimensionsMatrix:function(l){var c=void 0===l.scaleX?1:l.scaleX,d=void 0===l.scaleY?1:l.scaleY,h=[l.flipX?-c:c,0,0,l.flipY?-d:d,0,0],p=fabric.util.multiplyTransformMatrices,g=fabric.util.degreesToRadians;return l.skewX&&(h=p(h,[1,0,Math.tan(g(l.skewX)),1],!0)),l.skewY&&(h=p(h,[1,Math.tan(g(l.skewY)),0,1],!0)),h},composeMatrix:function(l){var c=[1,0,0,1,l.translateX||0,l.translateY||0],d=fabric.util.multiplyTransformMatrices;return l.angle&&(c=d(c,fabric.util.calcRotateMatrix(l))),(1!==l.scaleX||1!==l.scaleY||l.skewX||l.skewY||l.flipX||l.flipY)&&(c=d(c,fabric.util.calcDimensionsMatrix(l))),c},resetObjectTransform:function(l){l.scaleX=1,l.scaleY=1,l.skewX=0,l.skewY=0,l.flipX=!1,l.flipY=!1,l.rotate(0)},saveObjectTransform:function(l){return{scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,angle:l.angle,left:l.left,flipX:l.flipX,flipY:l.flipY,top:l.top}},isTransparent:function(l,c,d,h){0<h&&(h<c?c-=h:c=0,h<d?d-=h:d=0);var p,g=!0,v=l.getImageData(c,d,2*h||1,2*h||1),r=v.data.length;for(p=3;p<r&&(g=v.data[p]<=0);p+=4);return v=null,g},parsePreserveAspectRatioAttribute:function(l){var c,d="meet",h=l.split(" ");return h&&h.length&&("meet"!==(d=h.pop())&&"slice"!==d?(c=d,d="meet"):h.length&&(c=h.pop())),{meetOrSlice:d,alignX:"none"!==c?c.slice(1,4):"none",alignY:"none"!==c?c.slice(5,8):"none"}},clearFabricFontCache:function(l){(l=(l||"").toLowerCase())?fabric.charWidthsCache[l]&&delete fabric.charWidthsCache[l]:fabric.charWidthsCache={}},limitDimsByArea:function(l,c){var d=Math.sqrt(c*l),h=Math.floor(c/d);return{x:Math.floor(d),y:h}},capValue:function(l,c,d){return Math.max(l,Math.min(c,d))},findScaleToFit:function(l,c){return Math.min(c.width/l.width,c.height/l.height)},findScaleToCover:function(l,c){return Math.max(c.width/l.width,c.height/l.height)},matrixToSVG:function(l){return"matrix("+l.map(function(c){return fabric.util.toFixed(c,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(l,c){var d=fabric.util.invertTransform(c),h=fabric.util.multiplyTransformMatrices(d,l.calcOwnMatrix());fabric.util.applyTransformToObject(l,h)},addTransformToObject:function(l,c){fabric.util.applyTransformToObject(l,fabric.util.multiplyTransformMatrices(c,l.calcOwnMatrix()))},applyTransformToObject:function(l,c){var d=fabric.util.qrDecompose(c),h=new fabric.Point(d.translateX,d.translateY);l.flipX=!1,l.flipY=!1,l.set("scaleX",d.scaleX),l.set("scaleY",d.scaleY),l.skewX=d.skewX,l.skewY=d.skewY,l.angle=d.angle,l.setPositionByOrigin(h,"center","center")},sizeAfterTransform:function(l,c,d){var h=l/2,p=c/2,g=[{x:-h,y:-p},{x:h,y:-p},{x:-h,y:p},{x:h,y:p}],v=fabric.util.calcDimensionsMatrix(d),r=fabric.util.makeBoundingBoxFromPoints(g,v);return{x:r.width,y:r.height}},mergeClipPaths:function(l,c){var d=l,h=c;d.inverted&&!h.inverted&&(d=c,h=l),fabric.util.applyTransformToObject(h,fabric.util.multiplyTransformMatrices(fabric.util.invertTransform(d.calcTransformMatrix()),h.calcTransformMatrix()));var p=d.inverted&&h.inverted;return p&&(d.inverted=h.inverted=!1),new fabric.Group([d],{clipPath:h,inverted:p})}}}(typeof exports<"u"?exports:this),function(){var e=Array.prototype.join,t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},s={m:"l",M:"L"};function o(r,u,f,m){var b=Math.atan2(u,r),w=Math.atan2(m,f);return b<=w?w-b:2*Math.PI-(b-w)}function n(r,u,f){for(var y=function(C,I,L,D,O,M,E){var R=Math.PI,H=E*R/180,N=fabric.util.sin(H),B=fabric.util.cos(H),P=0,z=0,J=-B*C*.5-N*I*.5,q=-B*I*.5+N*C*.5,G=(L=Math.abs(L))*L,ee=(D=Math.abs(D))*D,le=q*q,te=J*J,Q=G*ee-G*le-ee*te,de=0;if(Q<0){var xe=Math.sqrt(1-Q/(G*ee));L*=xe,D*=xe}else de=(O===M?-1:1)*Math.sqrt(Q/(G*le+ee*te));var ce=de*L*q/D,he=-de*D*J/L,Pe=B*ce-N*he+.5*C,Se=N*ce+B*he+.5*I,Y=o(1,0,(J-ce)/L,(q-he)/D),ie=o((J-ce)/L,(q-he)/D,(-J-ce)/L,(-q-he)/D);0===M&&0<ie?ie-=2*R:1===M&&ie<0&&(ie+=2*R);for(var be,ke,Ee,$e,Ge,Ye,W,K,ne,oe,se,ve,pe,Ae,we,me,De,Ne=Math.ceil(Math.abs(ie/R*2)),He=[],Je=ie/Ne,st=8/3*Math.sin(Je/4)*Math.sin(Je/4)/Math.sin(Je/2),Te=Y+Je,_e=0;_e<Ne;_e++)He[_e]=(ke=Te,Ee=B,$e=N,Ge=L,Ye=D,W=Pe,K=Se,ne=st,oe=P,se=z,ve=fabric.util.cos(be=Y),["C",oe+ne*(-Ee*Ge*(pe=fabric.util.sin(be))-$e*Ye*ve),se+ne*(-$e*Ge*pe+Ee*Ye*ve),(me=Ee*Ge*(Ae=fabric.util.cos(ke))-$e*Ye*(we=fabric.util.sin(ke))+W)+ne*(Ee*Ge*we+$e*Ye*Ae),(De=$e*Ge*Ae+Ee*Ye*we+K)+ne*($e*Ge*we-Ee*Ye*Ae),me,De]),P=He[_e][5],z=He[_e][6],Y=Te,Te+=Je;return He}(f[6]-r,f[7]-u,f[1],f[2],f[4],f[5],f[3]),S=0,_=y.length;S<_;S++)y[S][1]+=r,y[S][2]+=u,y[S][3]+=r,y[S][4]+=u,y[S][5]+=r,y[S][6]+=u;return y}function a(r,u,f,m){return Math.sqrt((f-r)*(f-r)+(m-u)*(m-u))}function l(r,u,f,m,b,w,A,x){return function(y){var S,_,C,I,L=(I=y)*I*I,D=3*(C=y)*C*(1-C),O=3*(_=y)*(1-_)*(1-_),M=(1-(S=y))*(1-S)*(1-S);return{x:A*L+b*D+f*O+r*M,y:x*L+w*D+m*O+u*M}}}function c(r,u,f,m,b,w,A,x){return function(y){var S=1-y;return Math.atan2(3*S*S*(m-u)+6*S*y*(w-m)+3*y*y*(x-w),3*S*S*(f-r)+6*S*y*(b-f)+3*y*y*(A-b))}}function d(r,u,f,m,b,w){return function(A){var x,y,S,_=(S=A)*S,C=2*(y=A)*(1-y),I=(1-(x=A))*(1-x);return{x:b*_+f*C+r*I,y:w*_+m*C+u*I}}}function h(r,u,f,m,b,w){return function(A){var x=1-A;return Math.atan2(2*x*(m-u)+2*A*(w-m),2*x*(f-r)+2*A*(b-f))}}function p(r,u,f){var m,b,w={x:u,y:f},A=0;for(b=1;b<=100;b+=1)m=r(b/100),A+=a(w.x,w.y,m.x,m.y),w=m;return A}function v(r){for(var u,f,m,b,w=0,A=r.length,x=0,y=0,S=0,_=0,C=[],I=0;I<A;I++){switch(m={x,y,command:(u=r[I])[0]},u[0]){case"M":m.length=0,S=x=u[1],_=y=u[2];break;case"L":m.length=a(x,y,u[1],u[2]),x=u[1],y=u[2];break;case"C":f=l(x,y,u[1],u[2],u[3],u[4],u[5],u[6]),b=c(x,y,u[1],u[2],u[3],u[4],u[5],u[6]),m.iterator=f,m.angleFinder=b,m.length=p(f,x,y),x=u[5],y=u[6];break;case"Q":f=d(x,y,u[1],u[2],u[3],u[4]),b=h(x,y,u[1],u[2],u[3],u[4]),m.iterator=f,m.angleFinder=b,m.length=p(f,x,y),x=u[3],y=u[4];break;case"Z":case"z":m.destX=S,m.destY=_,m.length=a(x,y,S,_),x=S,y=_}w+=m.length,C.push(m)}return C.push({length:w,x,y}),C}fabric.util.joinPath=function(r){return r.map(function(u){return u.join(" ")}).join(" ")},fabric.util.parsePath=function(r){var u,f,m,b,w,A=[],x=[],y=fabric.rePathCommand,S="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",_="("+S+")"+fabric.commaWsp,C="([01])"+fabric.commaWsp+"?",I=new RegExp(_+"?"+_+"?"+_+C+C+_+"?("+S+")","g");if(!r||!r.match)return A;for(var L,D=0,O=(w=r.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;D<O;D++){b=(u=w[D]).slice(1).trim(),x.length=0;var M=u.charAt(0);if(L=[M],"a"===M.toLowerCase())for(var E;E=I.exec(b);)for(var R=1;R<E.length;R++)x.push(E[R]);else for(;m=y.exec(b);)x.push(m[0]);R=0;for(var H=x.length;R<H;R++)f=parseFloat(x[R]),isNaN(f)||L.push(f);var N=t[M.toLowerCase()],B=s[M]||M;if(L.length-1>N)for(var P=1,z=L.length;P<z;P+=N)A.push([M].concat(L.slice(P,P+N))),M=B;else A.push(L)}return A},fabric.util.makePathSimpler=function(r){var u,f,m,b,w,A,x=0,y=0,S=r.length,_=0,C=0,I=[];for(f=0;f<S;++f){switch(m=!1,(u=r[f].slice(0))[0]){case"l":u[0]="L",u[1]+=x,u[2]+=y;case"L":x=u[1],y=u[2];break;case"h":u[1]+=x;case"H":u[0]="L",u[2]=y,x=u[1];break;case"v":u[1]+=y;case"V":u[0]="L",y=u[1],u[1]=x,u[2]=y;break;case"m":u[0]="M",u[1]+=x,u[2]+=y;case"M":x=u[1],y=u[2],_=u[1],C=u[2];break;case"c":u[0]="C",u[1]+=x,u[2]+=y,u[3]+=x,u[4]+=y,u[5]+=x,u[6]+=y;case"C":w=u[3],A=u[4],x=u[5],y=u[6];break;case"s":u[0]="S",u[1]+=x,u[2]+=y,u[3]+=x,u[4]+=y;case"S":"C"===b?(w=2*x-w,A=2*y-A):(w=x,A=y),x=u[3],y=u[4],u[0]="C",u[5]=u[3],u[6]=u[4],u[3]=u[1],u[4]=u[2],u[1]=w,u[2]=A,w=u[3],A=u[4];break;case"q":u[0]="Q",u[1]+=x,u[2]+=y,u[3]+=x,u[4]+=y;case"Q":w=u[1],A=u[2],x=u[3],y=u[4];break;case"t":u[0]="T",u[1]+=x,u[2]+=y;case"T":"Q"===b?(w=2*x-w,A=2*y-A):(w=x,A=y),u[0]="Q",x=u[1],y=u[2],u[1]=w,u[2]=A,u[3]=x,u[4]=y;break;case"a":u[0]="A",u[6]+=x,u[7]+=y;case"A":m=!0,I=I.concat(n(x,y,u)),x=u[6],y=u[7];break;case"z":case"Z":x=_,y=C}m||I.push(u),b=u[0]}return I},fabric.util.getSmoothPathFromPoints=function(r,u){var f,m=[],b=new fabric.Point(r[0].x,r[0].y),w=new fabric.Point(r[1].x,r[1].y),A=r.length,x=1,y=0,S=2<A;for(S&&(x=r[2].x<w.x?-1:r[2].x===w.x?0:1,y=r[2].y<w.y?-1:r[2].y===w.y?0:1),m.push(["M",b.x-x*(u=u||0),b.y-y*u]),f=1;f<A;f++){if(!b.eq(w)){var _=b.midPointFrom(w);m.push(["Q",b.x,b.y,_.x,_.y])}b=r[f],f+1<r.length&&(w=r[f+1])}return S&&(x=b.x>r[f-2].x?1:b.x===r[f-2].x?0:-1,y=b.y>r[f-2].y?1:b.y===r[f-2].y?0:-1),m.push(["L",b.x+x*u,b.y+y*u]),m},fabric.util.getPathSegmentsInfo=v,fabric.util.getBoundsOfCurve=function(r,u,f,m,b,w,A,x){var y;if(fabric.cachesBoundsOfCurve&&(y=e.call(arguments),fabric.boundsOfCurveCache[y]))return fabric.boundsOfCurveCache[y];var S,_,C,I,L,D,O,M,E=Math.sqrt,R=Math.min,H=Math.max,N=Math.abs,B=[],P=[[],[]];_=6*r-12*f+6*b,S=-3*r+9*f-9*b+3*A,C=3*f-3*r;for(var z=0;z<2;++z)if(0<z&&(_=6*u-12*m+6*w,S=-3*u+9*m-9*w+3*x,C=3*m-3*u),N(S)<1e-12){if(N(_)<1e-12)continue;0<(I=-C/_)&&I<1&&B.push(I)}else(O=_*_-4*C*S)<0||(0<(L=(-_+(M=E(O)))/(2*S))&&L<1&&B.push(L),0<(D=(-_-M)/(2*S))&&D<1&&B.push(D));for(var J,G,ee=B.length,le=ee;ee--;)J=(G=1-(I=B[ee]))*G*G*r+3*G*G*I*f+3*G*I*I*b+I*I*I*A,P[0][ee]=J,P[1][ee]=G*G*G*u+3*G*G*I*m+3*G*I*I*w+I*I*I*x;P[0][le]=r,P[1][le]=u,P[0][le+1]=A,P[1][le+1]=x;var te=[{x:R.apply(null,P[0]),y:R.apply(null,P[1])},{x:H.apply(null,P[0]),y:H.apply(null,P[1])}];return fabric.cachesBoundsOfCurve&&(fabric.boundsOfCurveCache[y]=te),te},fabric.util.getPointOnPath=function(r,u,f){f||(f=v(r));for(var m=0;0<u-f[m].length&&m<f.length-2;)u-=f[m].length,m++;var b,w=f[m],A=u/w.length,y=r[m];switch(w.command){case"M":return{x:w.x,y:w.y,angle:0};case"Z":case"z":return(b=new fabric.Point(w.x,w.y).lerp(new fabric.Point(w.destX,w.destY),A)).angle=Math.atan2(w.destY-w.y,w.destX-w.x),b;case"L":return(b=new fabric.Point(w.x,w.y).lerp(new fabric.Point(y[1],y[2]),A)).angle=Math.atan2(y[2]-w.y,y[1]-w.x),b;case"C":case"Q":return function g(r,u){for(var f,m,b,w=0,A=0,x=r.iterator,y={x:r.x,y:r.y},S=.01,_=r.angleFinder;A<u&&1e-4<S;)f=x(w),b=w,u<(m=a(y.x,y.y,f.x,f.y))+A?(w-=S,S/=2):(y=f,w+=S,A+=m);return f.angle=_(b),f}(w,u)}},fabric.util.transformPath=function(r,u,f){return f&&(u=fabric.util.multiplyTransformMatrices(u,[1,0,0,1,-f.x,-f.y])),r.map(function(m){for(var b=m.slice(0),w={},A=1;A<m.length-1;A+=2)w.x=m[A],w.y=m[A+1],w=fabric.util.transformPoint(w,u),b[A]=w.x,b[A+1]=w.y;return b})}}(),function(){var e=Array.prototype.slice;function t(s,o,n){if(s&&0!==s.length){var a=s.length-1,l=o?s[a][o]:s[a];if(o)for(;a--;)n(s[a][o],l)&&(l=s[a][o]);else for(;a--;)n(s[a],l)&&(l=s[a]);return l}}fabric.util.array={fill:function(s,o){for(var n=s.length;n--;)s[n]=o;return s},invoke:function(s,o){for(var n=e.call(arguments,2),a=[],l=0,c=s.length;l<c;l++)a[l]=n.length?s[l][o].apply(s[l],n):s[l][o].call(s[l]);return a},min:function(s,o){return t(s,o,function(n,a){return n<a})},max:function(s,o){return t(s,o,function(n,a){return a<=n})}}}(),function(){function e(t,s,o){if(o)if(!fabric.isLikelyNode&&s instanceof Element)t=s;else if(s instanceof Array){t=[];for(var n=0,a=s.length;n<a;n++)t[n]=e({},s[n],o)}else if(s&&"object"==typeof s)for(var l in s)"canvas"===l||"group"===l?t[l]=null:s.hasOwnProperty(l)&&(t[l]=e({},s[l],o));else t=s;else for(var l in s)t[l]=s[l];return t}fabric.util.object={extend:e,clone:function(t,s){return e({},t,s)}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function e(t,s){var o=t.charCodeAt(s);if(isNaN(o))return"";if(o<55296||57343<o)return t.charAt(s);if(55296<=o&&o<=56319){if(t.length<=s+1)throw"High surrogate without following low surrogate";var n=t.charCodeAt(s+1);if(n<56320||57343<n)throw"High surrogate without following low surrogate";return t.charAt(s)+t.charAt(s+1)}if(0===s)throw"Low surrogate without preceding high surrogate";var a=t.charCodeAt(s-1);if(a<55296||56319<a)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(s,o){return o?o.toUpperCase():""})},capitalize:function(t,s){return t.charAt(0).toUpperCase()+(s?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var s,o=0,n=[];for(o=0;o<t.length;o++)!1!==(s=e(t,o))&&n.push(s);return n}}}(),function(){var e=Array.prototype.slice,t=function(){},s=function(){for(var l in{toString:1})if("toString"===l)return!1;return!0}(),o=function(l,c,d){for(var h in c)l.prototype[h]=h in l.prototype&&"function"==typeof l.prototype[h]&&-1<(c[h]+"").indexOf("callSuper")?function(p){return function(){var g=this.constructor.superclass;this.constructor.superclass=d;var v=c[p].apply(this,arguments);if(this.constructor.superclass=g,"initialize"!==p)return v}}(h):c[h],s&&(c.toString!==Object.prototype.toString&&(l.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(l.prototype.valueOf=c.valueOf))};function n(){}function a(l){for(var c=null,d=this;d.constructor.superclass;){var h=d.constructor.superclass.prototype[l];if(d[l]!==h){c=h;break}d=d.constructor.superclass.prototype}return c?1<arguments.length?c.apply(this,e.call(arguments,1)):c.call(this):console.log("tried to callSuper "+l+", method not found in prototype chain",this)}fabric.util.createClass=function(){var l=null,c=e.call(arguments,0);function d(){this.initialize.apply(this,arguments)}"function"==typeof c[0]&&(l=c.shift()),d.superclass=l,d.subclasses=[],l&&(n.prototype=l.prototype,d.prototype=new n,l.subclasses.push(d));for(var h=0,p=c.length;h<p;h++)o(d,c[h],l);return d.prototype.initialize||(d.prototype.initialize=t),(d.prototype.constructor=d).prototype.callSuper=a,d}}(),function(){var e=!!fabric.document.createElement("div").attachEvent,t=["touchstart","touchmove","touchend"];fabric.util.addListener=function(s,o,n,a){s&&s.addEventListener(o,n,!e&&a)},fabric.util.removeListener=function(s,o,n,a){s&&s.removeEventListener(o,n,!e&&a)},fabric.util.getPointer=function(s){var o,n,l=fabric.util.getScrollLeftTop(s.target),c=(n=(o=s).changedTouches)&&n[0]?n[0]:o;return{x:c.clientX+l.left,y:c.clientY+l.top}},fabric.util.isTouchEvent=function(s){return-1<t.indexOf(s.type)||"touch"===s.pointerType}}(),function(){var e=fabric.document.createElement("div"),o=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(a){return a};"string"==typeof e.style.opacity?n=function(a,l){return a.style.opacity=l,a}:"string"==typeof e.style.filter&&(n=function(a,l){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),o.test(c.filter)?c.filter=c.filter.replace(o,l=.9999<=l?"":"alpha(opacity="+100*l+")"):c.filter+=" alpha(opacity="+100*l+")",a}),fabric.util.setStyle=function(a,l){var c=a.style;if(!c)return a;if("string"==typeof l)return a.style.cssText+=";"+l,-1<l.indexOf("opacity")?n(a,l.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in l)"opacity"===d?n(a,l[d]):c["float"===d||"cssFloat"===d?void 0===c.styleFloat?"cssFloat":"styleFloat":d]=l[d];return a}}(),function(){var t,s,o,n,e=Array.prototype.slice,a=function(d){return e.call(d,0)};try{t=a(fabric.document.childNodes)instanceof Array}catch{}function l(d,h){var p=fabric.document.createElement(d);for(var g in h)"class"===g?p.className=h[g]:"for"===g?p.htmlFor=h[g]:p.setAttribute(g,h[g]);return p}function c(d){for(var h=0,p=0,g=fabric.document.documentElement,v=fabric.document.body||{scrollLeft:0,scrollTop:0};d&&(d.parentNode||d.host)&&((d=d.parentNode||d.host)===fabric.document?(h=v.scrollLeft||g.scrollLeft||0,p=v.scrollTop||g.scrollTop||0):(h+=d.scrollLeft||0,p+=d.scrollTop||0),1!==d.nodeType||"fixed"!==d.style.position););return{left:h,top:p}}t||(a=function(d){for(var h=new Array(d.length),p=d.length;p--;)h[p]=d[p];return h}),s=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(d,h){var p=fabric.document.defaultView.getComputedStyle(d,null);return p?p[h]:void 0}:function(d,h){var p=d.style[h];return!p&&d.currentStyle&&(p=d.currentStyle[h]),p},n="userSelect"in(o=fabric.document.documentElement.style)?"userSelect":"MozUserSelect"in o?"MozUserSelect":"WebkitUserSelect"in o?"WebkitUserSelect":"KhtmlUserSelect"in o?"KhtmlUserSelect":"",fabric.util.makeElementUnselectable=function(d){return void 0!==d.onselectstart&&(d.onselectstart=fabric.util.falseFunction),n?d.style[n]="none":"string"==typeof d.unselectable&&(d.unselectable="on"),d},fabric.util.makeElementSelectable=function(d){return void 0!==d.onselectstart&&(d.onselectstart=null),n?d.style[n]="":"string"==typeof d.unselectable&&(d.unselectable=""),d},fabric.util.setImageSmoothing=function(d,h){d.imageSmoothingEnabled=d.imageSmoothingEnabled||d.webkitImageSmoothingEnabled||d.mozImageSmoothingEnabled||d.msImageSmoothingEnabled||d.oImageSmoothingEnabled,d.imageSmoothingEnabled=h},fabric.util.getById=function(d){return"string"==typeof d?fabric.document.getElementById(d):d},fabric.util.toArray=a,fabric.util.addClass=function(d,h){d&&-1===(" "+d.className+" ").indexOf(" "+h+" ")&&(d.className+=(d.className?" ":"")+h)},fabric.util.makeElement=l,fabric.util.wrapElement=function(d,h,p){return"string"==typeof h&&(h=l(h,p)),d.parentNode&&d.parentNode.replaceChild(h,d),h.appendChild(d),h},fabric.util.getScrollLeftTop=c,fabric.util.getElementOffset=function(d){var h,p,g=d&&d.ownerDocument,v={left:0,top:0},r={left:0,top:0},u={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!g)return r;for(var f in u)r[u[f]]+=parseInt(s(d,f),10)||0;return h=g.documentElement,void 0!==d.getBoundingClientRect&&(v=d.getBoundingClientRect()),p=c(d),{left:v.left+p.left-(h.clientLeft||0)+r.left,top:v.top+p.top-(h.clientTop||0)+r.top}},fabric.util.getNodeCanvas=function(d){var h=fabric.jsdomImplForWrapper(d);return h._canvas||h._image},fabric.util.cleanUpJsdomNode=function(d){if(fabric.isLikelyNode){var h=fabric.jsdomImplForWrapper(d);h&&(h._image=null,h._canvas=null,h._currentSrc=null,h._attributes=null,h._classList=null)}}}(),function(){function e(){}fabric.util.request=function(t,s){s||(s={});var o,n,a=s.method?s.method.toUpperCase():"GET",l=s.onComplete||function(){},c=new fabric.window.XMLHttpRequest,d=s.body||s.parameters;return c.onreadystatechange=function(){4===c.readyState&&(l(c),c.onreadystatechange=e)},"GET"===a&&(d=null,"string"==typeof s.parameters&&(n=s.parameters,t=(o=t)+(/\?/.test(o)?"&":"?")+n)),c.open(a,t,!0),"POST"!==a&&"PUT"!==a||c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(d),c}}(),fabric.log=console.log,fabric.warn=console.warn,function(){var e=fabric.util.object.extend,t=fabric.util.object.clone,s=[];function o(){return!1}function n(d,h,p,g){return-p*Math.cos(d/g*(Math.PI/2))+p+h}fabric.util.object.extend(s,{cancelAll:function(){var d=this.splice(0);return d.forEach(function(h){h.cancel()}),d},cancelByCanvas:function(d){if(!d)return[];var h=this.filter(function(p){return"object"==typeof p.target&&p.target.canvas===d});return h.forEach(function(p){p.cancel()}),h},cancelByTarget:function(d){var h=this.findAnimationsByTarget(d);return h.forEach(function(p){p.cancel()}),h},findAnimationIndex:function(d){return this.indexOf(this.findAnimation(d))},findAnimation:function(d){return this.find(function(h){return h.cancel===d})},findAnimationsByTarget:function(d){return d?this.filter(function(h){return h.target===d}):[]}});var a=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(d){return fabric.window.setTimeout(d,1e3/60)},l=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function c(){return a.apply(fabric.window,arguments)}fabric.util.animate=function(d){d||(d={});var h,p=!1,g=function(){var v=fabric.runningAnimations.indexOf(h);return-1<v&&fabric.runningAnimations.splice(v,1)[0]};return h=e(t(d),{cancel:function(){return p=!0,g()},currentValue:"startValue"in d?d.startValue:0,completionRate:0,durationRate:0}),fabric.runningAnimations.push(h),c(function(v){var r,u=v||+new Date,f=d.duration||500,m=u+f,b=d.onChange||o,w=d.abort||o,A=d.onComplete||o,x=d.easing||n,y="startValue"in d&&0<d.startValue.length,S="startValue"in d?d.startValue:0,_="endValue"in d?d.endValue:100,C=d.byValue||(y?S.map(function(I,L){return _[L]-S[L]}):_-S);d.onStart&&d.onStart(),function I(L){r=L||+new Date;var D=m<r?f:r-u,O=D/f,M=y?S.map(function(R,H){return x(D,S[H],C[H],f)}):x(D,S,C,f),E=Math.abs(y?(M[0]-S[0])/C[0]:(M-S)/C);if(h.currentValue=y?M.slice():M,h.completionRate=E,h.durationRate=O,!p){if(!w(M,E,O))return m<r?(h.currentValue=y?_.slice():_,h.completionRate=1,h.durationRate=1,b(y?_.slice():_,1,1),A(_,1,1),void g()):(b(M,E,O),void c(I));g()}}(u)}),h.cancel},fabric.util.requestAnimFrame=c,fabric.util.cancelAnimFrame=function(){return l.apply(fabric.window,arguments)},fabric.runningAnimations=s}(),function(){function e(t,s,o){var n="rgba("+parseInt(t[0]+o*(s[0]-t[0]),10)+","+parseInt(t[1]+o*(s[1]-t[1]),10)+","+parseInt(t[2]+o*(s[2]-t[2]),10);return(n+=","+(t&&s?parseFloat(t[3]+o*(s[3]-t[3])):1))+")"}fabric.util.animateColor=function(t,s,o,n){var a=new fabric.Color(t).getSource(),l=new fabric.Color(s).getSource(),c=n.onComplete,d=n.onChange;return fabric.util.animate(fabric.util.object.extend(n=n||{},{duration:o||500,startValue:a,endValue:l,byValue:l,easing:function(h,p,g,v){return e(p,g,n.colorEasing?n.colorEasing(h,v):1-Math.cos(h/v*(Math.PI/2)))},onComplete:function(h,p,g){if(c)return c(e(l,l,0),p,g)},onChange:function(h,p,g){if(d){if(Array.isArray(h))return d(e(h,h,0),p,g);d(h,p,g)}}}))}}(),function(){function e(n,a,l,c){return n<Math.abs(a)?(n=a,c=l/4):c=0===a&&0===n?l/(2*Math.PI)*Math.asin(1):l/(2*Math.PI)*Math.asin(a/n),{a:n,c:a,p:l,s:c}}function t(n,a,l){return n.a*Math.pow(2,10*(a-=1))*Math.sin((a*l-n.s)*(2*Math.PI)/n.p)}function s(n,a,l,c){return l-o(c-n,0,l,c)+a}function o(n,a,l,c){return(n/=c)<1/2.75?l*(7.5625*n*n)+a:n<2/2.75?l*(7.5625*(n-=1.5/2.75)*n+.75)+a:n<2.5/2.75?l*(7.5625*(n-=2.25/2.75)*n+.9375)+a:l*(7.5625*(n-=2.625/2.75)*n+.984375)+a}fabric.util.ease={easeInQuad:function(n,a,l,c){return l*(n/=c)*n+a},easeOutQuad:function(n,a,l,c){return-l*(n/=c)*(n-2)+a},easeInOutQuad:function(n,a,l,c){return(n/=c/2)<1?l/2*n*n+a:-l/2*(--n*(n-2)-1)+a},easeInCubic:function(n,a,l,c){return l*(n/=c)*n*n+a},easeOutCubic:function(n,a,l,c){return l*((n=n/c-1)*n*n+1)+a},easeInOutCubic:function(n,a,l,c){return(n/=c/2)<1?l/2*n*n*n+a:l/2*((n-=2)*n*n+2)+a},easeInQuart:function(n,a,l,c){return l*(n/=c)*n*n*n+a},easeOutQuart:function(n,a,l,c){return-l*((n=n/c-1)*n*n*n-1)+a},easeInOutQuart:function(n,a,l,c){return(n/=c/2)<1?l/2*n*n*n*n+a:-l/2*((n-=2)*n*n*n-2)+a},easeInQuint:function(n,a,l,c){return l*(n/=c)*n*n*n*n+a},easeOutQuint:function(n,a,l,c){return l*((n=n/c-1)*n*n*n*n+1)+a},easeInOutQuint:function(n,a,l,c){return(n/=c/2)<1?l/2*n*n*n*n*n+a:l/2*((n-=2)*n*n*n*n+2)+a},easeInSine:function(n,a,l,c){return-l*Math.cos(n/c*(Math.PI/2))+l+a},easeOutSine:function(n,a,l,c){return l*Math.sin(n/c*(Math.PI/2))+a},easeInOutSine:function(n,a,l,c){return-l/2*(Math.cos(Math.PI*n/c)-1)+a},easeInExpo:function(n,a,l,c){return 0===n?a:l*Math.pow(2,10*(n/c-1))+a},easeOutExpo:function(n,a,l,c){return n===c?a+l:l*(1-Math.pow(2,-10*n/c))+a},easeInOutExpo:function(n,a,l,c){return 0===n?a:n===c?a+l:(n/=c/2)<1?l/2*Math.pow(2,10*(n-1))+a:l/2*(2-Math.pow(2,-10*--n))+a},easeInCirc:function(n,a,l,c){return-l*(Math.sqrt(1-(n/=c)*n)-1)+a},easeOutCirc:function(n,a,l,c){return l*Math.sqrt(1-(n=n/c-1)*n)+a},easeInOutCirc:function(n,a,l,c){return(n/=c/2)<1?-l/2*(Math.sqrt(1-n*n)-1)+a:l/2*(Math.sqrt(1-(n-=2)*n)+1)+a},easeInElastic:function(n,a,l,c){var d=0;return 0===n?a:1==(n/=c)?a+l:(d||(d=.3*c),-t(e(l,l,d,1.70158),n,c)+a)},easeOutElastic:function(n,a,l,c){var d=0;if(0===n)return a;if(1==(n/=c))return a+l;d||(d=.3*c);var h=e(l,l,d,1.70158);return h.a*Math.pow(2,-10*n)*Math.sin((n*c-h.s)*(2*Math.PI)/h.p)+h.c+a},easeInOutElastic:function(n,a,l,c){var d=0;if(0===n)return a;if(2==(n/=c/2))return a+l;d||(d=c*(.3*1.5));var h=e(l,l,d,1.70158);return n<1?-.5*t(h,n,c)+a:h.a*Math.pow(2,-10*(n-=1))*Math.sin((n*c-h.s)*(2*Math.PI)/h.p)*.5+h.c+a},easeInBack:function(n,a,l,c,d){return void 0===d&&(d=1.70158),l*(n/=c)*n*((d+1)*n-d)+a},easeOutBack:function(n,a,l,c,d){return void 0===d&&(d=1.70158),l*((n=n/c-1)*n*((d+1)*n+d)+1)+a},easeInOutBack:function(n,a,l,c,d){return void 0===d&&(d=1.70158),(n/=c/2)<1?l/2*(n*n*((1+(d*=1.525))*n-d))+a:l/2*((n-=2)*n*((1+(d*=1.525))*n+d)+2)+a},easeInBounce:s,easeOutBounce:o,easeInOutBounce:function(n,a,l,c){return n<c/2?.5*s(2*n,0,l,c)+a:.5*o(2*n-c,0,l,c)+.5*l+a}}}(),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend,o=t.util.object.clone,n=t.util.toFixed,a=t.util.parseUnit,l=t.util.multiplyTransformMatrices,c={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},d={stroke:"strokeOpacity",fill:"fillOpacity"},h="font-size",p="clip-path";function g(y,S,_,C){var I,L=Array.isArray(S);if("fill"!==y&&"stroke"!==y||"none"!==S){if("strokeUniform"===y)return"non-scaling-stroke"===S;if("strokeDashArray"===y)S="none"===S?null:S.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===y)S=_&&_.transformMatrix?l(_.transformMatrix,t.parseTransformAttribute(S)):t.parseTransformAttribute(S);else if("visible"===y)S="none"!==S&&"hidden"!==S,_&&!1===_.visible&&(S=!1);else if("opacity"===y)S=parseFloat(S),_&&void 0!==_.opacity&&(S*=_.opacity);else if("textAnchor"===y)S="start"===S?"left":"end"===S?"right":"center";else if("charSpacing"===y)I=a(S,C)/C*1e3;else if("paintFirst"===y){var D=S.indexOf("fill"),O=S.indexOf("stroke");S="fill",(-1<D&&-1<O&&O<D||-1===D&&-1<O)&&(S="stroke")}else{if("href"===y||"xlink:href"===y||"font"===y)return S;if("imageSmoothing"===y)return"optimizeQuality"===S;I=L?S.map(a):a(S,C)}}else S="";return!L&&isNaN(I)?S:I}function v(y){return new RegExp("^("+y.join("|")+")\\b","i")}function r(y,S){var C,I,L,D=[];for(I=0,L=S.length;I<L;I++)C=y.getElementsByTagName(S[I]),D=D.concat(Array.prototype.slice.call(C));return D}function u(y,S){var _,C=!0;return(_=f(y,S.pop()))&&S.length&&(C=function(I,L){for(var D,O=!0;I.parentNode&&1===I.parentNode.nodeType&&L.length;)O&&(D=L.pop()),O=f(I=I.parentNode,D);return 0===L.length}(y,S)),_&&C&&0===S.length}function f(y,S){var _,C,I=y.nodeName,L=y.getAttribute("class"),D=y.getAttribute("id");if(_=new RegExp("^"+I,"i"),S=S.replace(_,""),D&&S.length&&(_=new RegExp("#"+D+"(?![a-zA-Z\\-]+)","i"),S=S.replace(_,"")),L&&S.length)for(C=(L=L.split(" ")).length;C--;)_=new RegExp("\\."+L[C]+"(?![a-zA-Z\\-]+)","i"),S=S.replace(_,"");return 0===S.length}function m(y,S){var _;if(y.getElementById&&(_=y.getElementById(S)),_)return _;var C,I,L,D=y.getElementsByTagName("*");for(I=0,L=D.length;I<L;I++)if(S===(C=D[I]).getAttribute("id"))return C}t.svgValidTagNamesRegEx=v(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),t.svgViewBoxElementsRegEx=v(["symbol","image","marker","pattern","view","svg"]),t.svgInvalidAncestorsRegEx=v(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),t.svgValidParentsRegEx=v(["symbol","g","a","svg","clipPath","defs"]),t.cssRules={},t.gradientDefs={},t.clipPaths={},t.parseTransformAttribute=function(){function y(O,M,E){O[E]=Math.tan(t.util.degreesToRadians(M[0]))}var S=t.iMatrix,_=t.reNum,C=t.commaWsp,I="(?:(?:(matrix)\\s*\\(\\s*("+_+")"+C+"("+_+")"+C+"("+_+")"+C+"("+_+")"+C+"("+_+")"+C+"("+_+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+_+")(?:"+C+"("+_+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+_+")(?:"+C+"("+_+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+_+")(?:"+C+"("+_+")"+C+"("+_+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+_+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+_+")\\s*\\)))",L=new RegExp("^\\s*(?:(?:"+I+"(?:"+C+"*"+I+")*)?)\\s*$"),D=new RegExp(I,"g");return function(O){var M=S.concat(),E=[];if(!O||O&&!L.test(O))return M;O.replace(D,function(H){var N,B,P,z,J,q,G,ee,le,te,Q,de,xe=new RegExp(I).exec(H).filter(function(Pe){return!!Pe}),ce=xe[1],he=xe.slice(2).map(parseFloat);switch(ce){case"translate":(Q=M)[4]=(de=he)[0],2===de.length&&(Q[5]=de[1]);break;case"rotate":he[0]=t.util.degreesToRadians(he[0]),J=M,G=t.util.cos((q=he)[0]),ee=t.util.sin(q[0]),te=le=0,3===q.length&&(le=q[1],te=q[2]),J[0]=G,J[1]=ee,J[2]=-ee,J[3]=G,J[4]=le-(G*le-ee*te),J[5]=te-(ee*le+G*te);break;case"scale":P=(B=he)[0],z=2===B.length?B[1]:B[0],(N=M)[0]=P,N[3]=z;break;case"skewX":y(M,he,2);break;case"skewY":y(M,he,1);break;case"matrix":M=he}E.push(M.concat()),M=S.concat()});for(var R=E[0];1<E.length;)E.shift(),R=t.util.multiplyTransformMatrices(R,E[0]);return R}}();var b=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function w(y){if(!t.svgViewBoxElementsRegEx.test(y.nodeName))return{};var S,_,C,I,L,D,O=y.getAttribute("viewBox"),M=1,E=1,R=y.getAttribute("width"),H=y.getAttribute("height"),N=y.getAttribute("x")||0,B=y.getAttribute("y")||0,P=y.getAttribute("preserveAspectRatio")||"",z=!O||!(O=O.match(b)),J=!R||!H||"100%"===R||"100%"===H,q=z&&J,G={},ee="",le=0,te=0;if(G.width=0,G.height=0,G.toBeParsed=q,z&&(N||B)&&y.parentNode&&"#document"!==y.parentNode.nodeName&&(ee=" translate("+a(N)+" "+a(B)+") ",L=(y.getAttribute("transform")||"")+ee,y.setAttribute("transform",L),y.removeAttribute("x"),y.removeAttribute("y")),q)return G;if(z)return G.width=a(R),G.height=a(H),G;if(S=-parseFloat(O[1]),_=-parseFloat(O[2]),C=parseFloat(O[3]),I=parseFloat(O[4]),G.minX=S,G.minY=_,G.viewBoxWidth=C,G.viewBoxHeight=I,J?(G.width=C,G.height=I):(G.width=a(R),G.height=a(H),M=G.width/C,E=G.height/I),"none"!==(P=t.util.parsePreserveAspectRatioAttribute(P)).alignX&&("meet"===P.meetOrSlice&&(E=M=E<M?E:M),"slice"===P.meetOrSlice&&(E=M=E<M?M:E),le=G.width-C*M,te=G.height-I*M,"Mid"===P.alignX&&(le/=2),"Mid"===P.alignY&&(te/=2),"Min"===P.alignX&&(le=0),"Min"===P.alignY&&(te=0)),1===M&&1===E&&0===S&&0===_&&0===N&&0===B)return G;if((N||B)&&"#document"!==y.parentNode.nodeName&&(ee=" translate("+a(N)+" "+a(B)+") "),L=ee+" matrix("+M+" 0 0 "+E+" "+(S*M+le)+" "+(_*E+te)+") ","svg"===y.nodeName){for(D=y.ownerDocument.createElementNS(t.svgNS,"g");y.firstChild;)D.appendChild(y.firstChild);y.appendChild(D)}else(D=y).removeAttribute("x"),D.removeAttribute("y"),L=D.getAttribute("transform")+L;return D.setAttribute("transform",L),G}function A(y,S){var _="xlink:href",C=m(y,S.getAttribute(_).slice(1));if(C&&C.getAttribute(_)&&A(y,C),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(L){C&&!S.hasAttribute(L)&&C.hasAttribute(L)&&S.setAttribute(L,C.getAttribute(L))}),!S.children.length)for(var I=C.cloneNode(!0);I.firstChild;)S.appendChild(I.firstChild);S.removeAttribute(_)}t.parseSVGDocument=function(y,S,_,C){if(y){!function(N){for(var B=r(N,["use","svg:use"]),P=0;B.length&&P<B.length;){var z=B[P],J=z.getAttribute("xlink:href")||z.getAttribute("href");if(null===J)return;var q,G,ee,le,te=J.slice(1),Q=z.getAttribute("x")||0,de=z.getAttribute("y")||0,xe=m(N,te).cloneNode(!0),ce=(xe.getAttribute("transform")||"")+" translate("+Q+", "+de+")",he=B.length,Pe=t.svgNS;if(w(xe),/^svg$/i.test(xe.nodeName)){var Se=xe.ownerDocument.createElementNS(Pe,"g");for(G=0,le=(ee=xe.attributes).length;G<le;G++)q=ee.item(G),Se.setAttributeNS(Pe,q.nodeName,q.nodeValue);for(;xe.firstChild;)Se.appendChild(xe.firstChild);xe=Se}for(G=0,le=(ee=z.attributes).length;G<le;G++)"x"!==(q=ee.item(G)).nodeName&&"y"!==q.nodeName&&"xlink:href"!==q.nodeName&&"href"!==q.nodeName&&("transform"===q.nodeName?ce=q.nodeValue+" "+ce:xe.setAttribute(q.nodeName,q.nodeValue));xe.setAttribute("transform",ce),xe.setAttribute("instantiated_by_use","1"),xe.removeAttribute("id"),z.parentNode.replaceChild(xe,z),B.length===he&&P++}}(y);var I,L,D=t.Object.__uid++,O=w(y),M=t.util.toArray(y.getElementsByTagName("*"));if(O.crossOrigin=C&&C.crossOrigin,O.svgUid=D,0===M.length&&t.isLikelyNode){var E=[];for(I=0,L=(M=y.selectNodes('//*[name(.)!="svg"]')).length;I<L;I++)E[I]=M[I];M=E}var R=M.filter(function(N){return w(N),t.svgValidTagNamesRegEx.test(N.nodeName.replace("svg:",""))&&!function(B,P){for(;B&&(B=B.parentNode);)if(B.nodeName&&P.test(B.nodeName.replace("svg:",""))&&!B.getAttribute("instantiated_by_use"))return!0;return!1}(N,t.svgInvalidAncestorsRegEx)});if(!R||R&&!R.length)S&&S([],{});else{var H={};M.filter(function(N){return"clipPath"===N.nodeName.replace("svg:","")}).forEach(function(N){var B=N.getAttribute("id");H[B]=t.util.toArray(N.getElementsByTagName("*")).filter(function(P){return t.svgValidTagNamesRegEx.test(P.nodeName.replace("svg:",""))})}),t.gradientDefs[D]=t.getGradientDefs(y),t.cssRules[D]=t.getCSSRules(y),t.clipPaths[D]=H,t.parseElements(R,function(N,B){S&&(S(N,O,B,M),delete t.gradientDefs[D],delete t.cssRules[D],delete t.clipPaths[D])},o(O),_,C)}}};var x=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");s(t,{parseFontDeclaration:function(y,S){var _=y.match(x);if(_){var C=_[1],I=_[3],L=_[4],D=_[5],O=_[6];C&&(S.fontStyle=C),I&&(S.fontWeight=isNaN(parseFloat(I))?I:parseFloat(I)),L&&(S.fontSize=a(L)),O&&(S.fontFamily=O),D&&(S.lineHeight="normal"===D?1:D)}},getGradientDefs:function(y){var S,_=r(y,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),C=0,I={};for(C=_.length;C--;)(S=_[C]).getAttribute("xlink:href")&&A(y,S),I[S.getAttribute("id")]=S;return I},parseAttributes:function(y,S,_){if(y){var C,I,L,D={};void 0===_&&(_=y.getAttribute("svgUid")),y.parentNode&&t.svgValidParentsRegEx.test(y.parentNode.nodeName)&&(D=t.parseAttributes(y.parentNode,S,_));var O=S.reduce(function(z,J){return(C=y.getAttribute(J))&&(z[J]=C),z},{}),M=s(function(z,J){var q={};for(var G in t.cssRules[J])if(u(z,G.split(" ")))for(var ee in t.cssRules[J][G])q[ee]=t.cssRules[J][G][ee];return q}(y,_),t.parseStyleAttribute(y));O=s(O,M),M[p]&&y.setAttribute(p,M[p]),I=L=D.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,O[h]&&(O[h]=I=a(O[h],L));var E,R,H,N={};for(var B in O)R=g(E=(H=B)in c?c[H]:H,O[B],D,I),N[E]=R;N&&N.font&&t.parseFontDeclaration(N.font,N);var P=s(D,N);return t.svgValidParentsRegEx.test(y.nodeName)?P:function(z){for(var J in d)if(void 0!==z[d[J]]&&""!==z[J]){if(void 0===z[J]){if(!t.Object.prototype[J])continue;z[J]=t.Object.prototype[J]}if(0!==z[J].indexOf("url(")){var q=new t.Color(z[J]);z[J]=q.setAlpha(n(q.getAlpha()*z[d[J]],2)).toRgba()}}return z}(P)}},parseElements:function(y,S,_,C,I){new t.ElementsParser(y,S,_,C,I).parse()},parseStyleAttribute:function(y){var S,_,C,I={},L=y.getAttribute("style");return L&&("string"==typeof L?(S=I,L.replace(/;\s*$/,"").split(";").forEach(function(D){var O=D.split(":");_=O[0].trim().toLowerCase(),C=O[1].trim(),S[_]=C})):function(D,O){for(var R in D)void 0!==D[R]&&(O[R.toLowerCase()]=D[R])}(L,I)),I},parsePointsAttribute:function(y){if(!y)return null;var S,_,C=[];for(S=0,_=(y=(y=y.replace(/,/g," ").trim()).split(/\s+/)).length;S<_;S+=2)C.push({x:parseFloat(y[S]),y:parseFloat(y[S+1])});return C},getCSSRules:function(y){var S,_,C=y.getElementsByTagName("style"),I={};for(S=0,_=C.length;S<_;S++){var L=C[S].textContent;""!==(L=L.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&L.split("}").filter(function(D){return D.trim()}).forEach(function(D){var O=D.split("{"),M={},E=O[1].trim().split(";").filter(function(B){return B.trim()});for(S=0,_=E.length;S<_;S++){var R=E[S].split(":"),H=R[0].trim(),N=R[1].trim();M[H]=N}(D=O[0].trim()).split(",").forEach(function(B){""!==(B=B.replace(/^svg/i,"").trim())&&(I[B]?t.util.object.extend(I[B],M):I[B]=t.util.object.clone(M))})})}return I},loadSVGFromURL:function(y,S,_,C){y=y.replace(/^\n\s*/,"").trim(),new t.util.request(y,{method:"get",onComplete:function(I){var L=I.responseXML;if(!L||!L.documentElement)return S&&S(null),!1;t.parseSVGDocument(L.documentElement,function(D,O,M,E){S&&S(D,O,M,E)},_,C)}})},loadSVGFromString:function(y,S,_,C){var I=(new t.window.DOMParser).parseFromString(y.trim(),"text/xml");t.parseSVGDocument(I.documentElement,function(L,D,O,M){S(L,D,O,M)},_,C)}})}(typeof exports<"u"?exports:this),fabric.ElementsParser=function(e,t,s,o,n,a){this.elements=e,this.callback=t,this.options=s,this.reviver=o,this.svgUid=s&&s.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a},function(e){e.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},e.createObjects=function(){var t=this;this.elements.forEach(function(s,o){s.setAttribute("svgUid",t.svgUid),t.createObject(s,o)})},e.findTag=function(t){return fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))]},e.createObject=function(t,s){var o=this.findTag(t);if(o&&o.fromElement)try{o.fromElement(t,this.createCallback(s,t),this.options)}catch(n){fabric.log(n)}else this.checkIfDone()},e.createCallback=function(t,s){var o=this;return function(n){var a;o.resolveGradient(n,s,"fill"),o.resolveGradient(n,s,"stroke"),n instanceof fabric.Image&&n._originalElement&&(a=n.parsePreserveAspectRatioAttribute(s)),n._removeTransformMatrix(a),o.resolveClipPath(n,s),o.reviver&&o.reviver(s,n),o.instances[t]=n,o.checkIfDone()}},e.extractPropertyDefinition=function(t,s,o){var n=t[s],a=this.regexUrl;if(a.test(n)){a.lastIndex=0;var l=a.exec(n)[1];return a.lastIndex=0,fabric[o][this.svgUid][l]}},e.resolveGradient=function(t,s,o){var n=this.extractPropertyDefinition(t,o,"gradientDefs");if(n){var a=s.getAttribute(o+"-opacity"),l=fabric.Gradient.fromElement(n,t,a,this.options);t.set(o,l)}},e.createClipPathCallback=function(t,s){return function(o){o._removeTransformMatrix(),o.fillRule=o.clipRule,s.push(o)}},e.resolveClipPath=function(t,s){var o,n,a,l,c=this.extractPropertyDefinition(t,"clipPath","clipPaths");if(c){a=[],n=fabric.util.invertTransform(t.calcTransformMatrix());for(var d=c[0].parentNode,h=s;h.parentNode&&h.getAttribute("clip-path")!==t.clipPath;)h=h.parentNode;h.parentNode.appendChild(d);for(var p=0;p<c.length;p++)this.findTag(o=c[p]).fromElement(o,this.createClipPathCallback(t,a),this.options);c=1===a.length?a[0]:new fabric.Group(a),l=fabric.util.multiplyTransformMatrices(n,c.calcTransformMatrix()),c.clipPath&&this.resolveClipPath(c,h);var g=fabric.util.qrDecompose(l);c.flipX=!1,c.flipY=!1,c.set("scaleX",g.scaleX),c.set("scaleY",g.scaleY),c.angle=g.angle,c.skewX=g.skewX,c.skewY=0,c.setPositionByOrigin({x:g.translateX,y:g.translateY},"center","center"),t.clipPath=c}else delete t.clipPath},e.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances,this.elements))}}(fabric.ElementsParser.prototype),function(e){"use strict";var t=e.fabric||(e.fabric={});function s(o,n){this.x=o,this.y=n}t.Point?t.warn("fabric.Point is already defined"):(t.Point=s).prototype={type:"point",constructor:s,add:function(o){return new s(this.x+o.x,this.y+o.y)},addEquals:function(o){return this.x+=o.x,this.y+=o.y,this},scalarAdd:function(o){return new s(this.x+o,this.y+o)},scalarAddEquals:function(o){return this.x+=o,this.y+=o,this},subtract:function(o){return new s(this.x-o.x,this.y-o.y)},subtractEquals:function(o){return this.x-=o.x,this.y-=o.y,this},scalarSubtract:function(o){return new s(this.x-o,this.y-o)},scalarSubtractEquals:function(o){return this.x-=o,this.y-=o,this},multiply:function(o){return new s(this.x*o,this.y*o)},multiplyEquals:function(o){return this.x*=o,this.y*=o,this},divide:function(o){return new s(this.x/o,this.y/o)},divideEquals:function(o){return this.x/=o,this.y/=o,this},eq:function(o){return this.x===o.x&&this.y===o.y},lt:function(o){return this.x<o.x&&this.y<o.y},lte:function(o){return this.x<=o.x&&this.y<=o.y},gt:function(o){return this.x>o.x&&this.y>o.y},gte:function(o){return this.x>=o.x&&this.y>=o.y},lerp:function(o,n){return void 0===n&&(n=.5),n=Math.max(Math.min(1,n),0),new s(this.x+(o.x-this.x)*n,this.y+(o.y-this.y)*n)},distanceFrom:function(o){var n=this.x-o.x,a=this.y-o.y;return Math.sqrt(n*n+a*a)},midPointFrom:function(o){return this.lerp(o)},min:function(o){return new s(Math.min(this.x,o.x),Math.min(this.y,o.y))},max:function(o){return new s(Math.max(this.x,o.x),Math.max(this.y,o.y))},toString:function(){return this.x+","+this.y},setXY:function(o,n){return this.x=o,this.y=n,this},setX:function(o){return this.x=o,this},setY:function(o){return this.y=o,this},setFromPoint:function(o){return this.x=o.x,this.y=o.y,this},swap:function(o){var n=this.x,a=this.y;this.x=o.x,this.y=o.y,o.x=n,o.y=a},clone:function(){return new s(this.x,this.y)}}}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});function s(o){this.status=o,this.points=[]}t.Intersection?t.warn("fabric.Intersection is already defined"):(t.Intersection=s,t.Intersection.prototype={constructor:s,appendPoint:function(o){return this.points.push(o),this},appendPoints:function(o){return this.points=this.points.concat(o),this}},t.Intersection.intersectLineLine=function(o,n,a,l){var c,d=(l.x-a.x)*(o.y-a.y)-(l.y-a.y)*(o.x-a.x),h=(n.x-o.x)*(o.y-a.y)-(n.y-o.y)*(o.x-a.x),p=(l.y-a.y)*(n.x-o.x)-(l.x-a.x)*(n.y-o.y);if(0!==p){var g=d/p,v=h/p;0<=g&&g<=1&&0<=v&&v<=1?(c=new s("Intersection")).appendPoint(new t.Point(o.x+g*(n.x-o.x),o.y+g*(n.y-o.y))):c=new s}else c=new s(0===d||0===h?"Coincident":"Parallel");return c},t.Intersection.intersectLinePolygon=function(o,n,a){var d,h,p=new s,g=a.length;for(h=0;h<g;h++)d=s.intersectLineLine(o,n,a[h],a[(h+1)%g]),p.appendPoints(d.points);return 0<p.points.length&&(p.status="Intersection"),p},t.Intersection.intersectPolygonPolygon=function(o,n){var a,l=new s,c=o.length;for(a=0;a<c;a++){var p=s.intersectLinePolygon(o[a],o[(a+1)%c],n);l.appendPoints(p.points)}return 0<l.points.length&&(l.status="Intersection"),l},t.Intersection.intersectPolygonRectangle=function(o,n,a){var l=n.min(a),c=n.max(a),d=new t.Point(c.x,l.y),h=new t.Point(l.x,c.y),p=s.intersectLinePolygon(l,d,o),g=s.intersectLinePolygon(d,c,o),v=s.intersectLinePolygon(c,h,o),r=s.intersectLinePolygon(h,l,o),u=new s;return u.appendPoints(p.points),u.appendPoints(g.points),u.appendPoints(v.points),u.appendPoints(r.points),0<u.points.length&&(u.status="Intersection"),u})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});function s(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function o(n,a,l){return l<0&&(l+=1),1<l&&(l-=1),l<1/6?n+6*(a-n)*l:l<.5?a:l<2/3?n+(a-n)*(2/3-l)*6:n}t.Color?t.warn("fabric.Color is already defined."):(t.Color=s,t.Color.prototype={_tryParsingColor:function(n){var a;n in s.colorNameMap&&(n=s.colorNameMap[n]),"transparent"===n&&(a=[255,255,255,0]),a||(a=s.sourceFromHex(n)),a||(a=s.sourceFromRgb(n)),a||(a=s.sourceFromHsl(n)),a||(a=[0,0,0,1]),a&&this.setSource(a)},_rgbToHsl:function(n,a,l){var c,d,h,p=t.util.array.max([n/=255,a/=255,l/=255]),g=t.util.array.min([n,a,l]);if(h=(p+g)/2,p===g)c=d=0;else{var v=p-g;switch(d=.5<h?v/(2-p-g):v/(p+g),p){case n:c=(a-l)/v+(a<l?6:0);break;case a:c=(l-n)/v+2;break;case l:c=(n-a)/v+4}c/=6}return[Math.round(360*c),Math.round(100*d),Math.round(100*h)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),a=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var n=this.getSource(),a=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+n[3]+")"},toHex:function(){var n,a,l,c=this.getSource();return n=1===(n=c[0].toString(16)).length?"0"+n:n,a=1===(a=c[1].toString(16)).length?"0"+a:a,l=1===(l=c[2].toString(16)).length?"0"+l:l,n.toUpperCase()+a.toUpperCase()+l.toUpperCase()},toHexa:function(){var n,a=this.getSource();return n=1===(n=(n=Math.round(255*a[3])).toString(16)).length?"0"+n:n,this.toHex()+n.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var a=this.getSource();return a[3]=n,this.setSource(a),this},toGrayscale:function(){var n=this.getSource(),a=parseInt((.3*n[0]+.59*n[1]+.11*n[2]).toFixed(0),10);return this.setSource([a,a,a,n[3]]),this},toBlackWhite:function(n){var a=this.getSource(),l=(.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),c=a[3];return n=n||127,l=Number(l)<Number(n)?0:255,this.setSource([l,l,l,c]),this},overlayWith:function(n){n instanceof s||(n=new s(n));var a,l=[],c=this.getAlpha(),d=this.getSource(),h=n.getSource();for(a=0;a<3;a++)l.push(Math.round(.5*d[a]+.5*h[a]));return l[3]=c,this.setSource(l),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},t.Color.fromRgb=function(n){return s.fromSource(s.sourceFromRgb(n))},t.Color.sourceFromRgb=function(n){var a=n.match(s.reRGBa);if(a){var l=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),c=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),d=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(l,10),parseInt(c,10),parseInt(d,10),a[4]?parseFloat(a[4]):1]}},t.Color.fromRgba=s.fromRgb,t.Color.fromHsl=function(n){return s.fromSource(s.sourceFromHsl(n))},t.Color.sourceFromHsl=function(n){var a=n.match(s.reHSLa);if(a){var l,c,d,h=(parseFloat(a[1])%360+360)%360/360,p=parseFloat(a[2])/(/%$/.test(a[2])?100:1),g=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===p)l=c=d=g;else{var v=g<=.5?g*(p+1):g+p-g*p,r=2*g-v;l=o(r,v,h+1/3),c=o(r,v,h),d=o(r,v,h-1/3)}return[Math.round(255*l),Math.round(255*c),Math.round(255*d),a[4]?parseFloat(a[4]):1]}},t.Color.fromHsla=s.fromHsl,t.Color.fromHex=function(n){return s.fromSource(s.sourceFromHex(n))},t.Color.sourceFromHex=function(n){if(n.match(s.reHex)){var a=n.slice(n.indexOf("#")+1),l=3===a.length||4===a.length,c=8===a.length||4===a.length,d=l?a.charAt(0)+a.charAt(0):a.substring(0,2),h=l?a.charAt(1)+a.charAt(1):a.substring(2,4),p=l?a.charAt(2)+a.charAt(2):a.substring(4,6),g=c?l?a.charAt(3)+a.charAt(3):a.substring(6,8):"FF";return[parseInt(d,16),parseInt(h,16),parseInt(p,16),parseFloat((parseInt(g,16)/255).toFixed(2))]}},t.Color.fromSource=function(n){var a=new s;return a.setSource(n),a})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=["e","se","s","sw","w","nw","n","ne","e"],o=["ns","nesw","ew","nwse"],n={},a="left",l="top",c="right",d="bottom",h="center",p={top:d,bottom:l,left:c,right:a,center:h},g=t.util.radiansToDegrees,v=Math.sign||function(D){return(0<D)-(D<0)||+D};function r(D,O){var M=D.angle+g(Math.atan2(O.y,O.x))+360;return Math.round(M%360/45)}function u(D,O){var M=O.transform.target,E=M.canvas,R=t.util.object.clone(O);R.target=M,E&&E.fire("object:"+D,R),M.fire(D,O)}function f(D,O){var M=O.canvas,E=D[M.uniScaleKey];return M.uniformScaling&&!E||!M.uniformScaling&&E}function m(D){return D.originX===h&&D.originY===h}function b(D,O,M){var E=D.lockScalingX,R=D.lockScalingY;return!((!E||!R)&&(O||!E&&!R||!M)&&(!E||"x"!==O)&&(!R||"y"!==O))}function w(D,O,M,E){return{e:D,transform:O,pointer:{x:M,y:E}}}function A(D){return function(O,M,E,R){var H=M.target,N=H.getCenterPoint(),B=H.translateToOriginPoint(N,M.originX,M.originY),P=D(O,M,E,R);return H.setPositionByOrigin(B,M.originX,M.originY),P}}function x(D,O){return function(M,E,R,H){var N=O(M,E,R,H);return N&&u(D,w(M,E,R,H)),N}}function y(D,O,M,E,R){var H=D.target,N=H.controls[D.corner],B=H.canvas.getZoom(),P=H.padding/B,z=H.toLocalPoint(new t.Point(E,R),O,M);return z.x>=P&&(z.x-=P),z.x<=-P&&(z.x+=P),z.y>=P&&(z.y-=P),z.y<=P&&(z.y+=P),z.x-=N.offsetX,z.y-=N.offsetY,z}function S(D){return D.flipX!==D.flipY}function _(D,O,M,E,R){if(0!==D[O]){var H=R/D._getTransformedDimensions()[E]*D[M];D.set(M,H)}}function C(D,O,M,E){var R,H=O.target,N=H._getTransformedDimensions(0,H.skewY),B=y(O,O.originX,O.originY,M,E),P=Math.abs(2*B.x)-N.x,z=H.skewX;P<2?R=0:(R=g(Math.atan2(P/H.scaleX,N.y/H.scaleY)),O.originX===a&&O.originY===d&&(R=-R),O.originX===c&&O.originY===l&&(R=-R),S(H)&&(R=-R));var J=z!==R;if(J){var q=H._getTransformedDimensions().y;H.set("skewX",R),_(H,"skewY","scaleY","y",q)}return J}function I(D,O,M,E){var R,H=O.target,N=H._getTransformedDimensions(H.skewX,0),B=y(O,O.originX,O.originY,M,E),P=Math.abs(2*B.y)-N.y,z=H.skewY;P<2?R=0:(R=g(Math.atan2(P/H.scaleY,N.x/H.scaleX)),O.originX===a&&O.originY===d&&(R=-R),O.originX===c&&O.originY===l&&(R=-R),S(H)&&(R=-R));var J=z!==R;if(J){var q=H._getTransformedDimensions().x;H.set("skewY",R),_(H,"skewX","scaleX","x",q)}return J}function L(D,O,M,E,R){var H,N,B,P,z,J,q=O.target,G=q.lockScalingX,ee=q.lockScalingY,le=(R=R||{}).by,te=f(D,q),Q=b(q,le,te),de=O.gestureScale;if(Q)return!1;if(de)N=O.scaleX*de,B=O.scaleY*de;else{if(H=y(O,O.originX,O.originY,M,E),z="y"!==le?v(H.x):1,J="x"!==le?v(H.y):1,O.signX||(O.signX=z),O.signY||(O.signY=J),q.lockScalingFlip&&(O.signX!==z||O.signY!==J))return!1;if(P=q._getTransformedDimensions(),te&&!le){var xe=Math.abs(H.x)+Math.abs(H.y),ce=O.original,he=xe/(Math.abs(P.x*ce.scaleX/q.scaleX)+Math.abs(P.y*ce.scaleY/q.scaleY));N=ce.scaleX*he,B=ce.scaleY*he}else N=Math.abs(H.x*q.scaleX/P.x),B=Math.abs(H.y*q.scaleY/P.y);m(O)&&(N*=2,B*=2),O.signX!==z&&"y"!==le&&(O.originX=p[O.originX],N*=-1,O.signX=z),O.signY!==J&&"x"!==le&&(O.originY=p[O.originY],B*=-1,O.signY=J)}var Pe=q.scaleX,Se=q.scaleY;return le?("x"===le&&q.set("scaleX",N),"y"===le&&q.set("scaleY",B)):(!G&&q.set("scaleX",N),!ee&&q.set("scaleY",B)),Pe!==q.scaleX||Se!==q.scaleY}n.scaleCursorStyleHandler=function(D,O,M){var E=f(D,M),R="";if(0!==O.x&&0===O.y?R="x":0===O.x&&0!==O.y&&(R="y"),b(M,R,E))return"not-allowed";var H=r(M,O);return s[H]+"-resize"},n.skewCursorStyleHandler=function(D,O,M){if(0!==O.x&&M.lockSkewingY||0!==O.y&&M.lockSkewingX)return"not-allowed";var R=r(M,O)%4;return o[R]+"-resize"},n.scaleSkewCursorStyleHandler=function(D,O,M){return D[M.canvas.altActionKey]?n.skewCursorStyleHandler(D,O,M):n.scaleCursorStyleHandler(D,O,M)},n.rotationWithSnapping=x("rotating",A(function(D,O,M,E){var R=O,H=R.target,N=H.translateToOriginPoint(H.getCenterPoint(),R.originX,R.originY);if(H.lockRotation)return!1;var B,P=Math.atan2(R.ey-N.y,R.ex-N.x),z=Math.atan2(E-N.y,M-N.x),J=g(z-P+R.theta);if(0<H.snapAngle){var q=H.snapAngle,G=H.snapThreshold||q,ee=Math.ceil(J/q)*q,le=Math.floor(J/q)*q;Math.abs(J-le)<G?J=le:Math.abs(J-ee)<G&&(J=ee)}return J<0&&(J=360+J),B=H.angle!==(J%=360),H.angle=J,B})),n.scalingEqually=x("scaling",A(function(D,O,M,E){return L(D,O,M,E)})),n.scalingX=x("scaling",A(function(D,O,M,E){return L(D,O,M,E,{by:"x"})})),n.scalingY=x("scaling",A(function(D,O,M,E){return L(D,O,M,E,{by:"y"})})),n.scalingYOrSkewingX=function(D,O,M,E){return D[O.target.canvas.altActionKey]?n.skewHandlerX(D,O,M,E):n.scalingY(D,O,M,E)},n.scalingXOrSkewingY=function(D,O,M,E){return D[O.target.canvas.altActionKey]?n.skewHandlerY(D,O,M,E):n.scalingX(D,O,M,E)},n.changeWidth=x("resizing",A(function(D,O,M,E){var R=O.target,H=y(O,O.originX,O.originY,M,E),N=R.strokeWidth/(R.strokeUniform?R.scaleX:1),B=m(O)?2:1,P=R.width,z=Math.abs(H.x*B/R.scaleX)-N;return R.set("width",Math.max(z,0)),P!==z})),n.skewHandlerX=function(D,O,M,E){var R,H=O.target,N=H.skewX,B=O.originY;return!H.lockSkewingX&&(0===N?R=0<y(O,h,h,M,E).x?a:c:(0<N&&(R=B===l?a:c),N<0&&(R=B===l?c:a),S(H)&&(R=R===a?c:a)),O.originX=R,x("skewing",A(C))(D,O,M,E))},n.skewHandlerY=function(D,O,M,E){var R,H=O.target,N=H.skewY,B=O.originX;return!H.lockSkewingY&&(0===N?R=0<y(O,h,h,M,E).y?l:d:(0<N&&(R=B===a?l:d),N<0&&(R=B===a?d:l),S(H)&&(R=R===l?d:l)),O.originY=R,x("skewing",A(I))(D,O,M,E))},n.dragHandler=function(D,O,M,E){var R=O.target,H=M-O.offsetX,N=E-O.offsetY,B=!R.get("lockMovementX")&&R.left!==H,P=!R.get("lockMovementY")&&R.top!==N;return B&&R.set("left",H),P&&R.set("top",N),(B||P)&&u("moving",w(D,O,M,E)),B||P},n.scaleOrSkewActionName=function(D,O,M){var E=D[M.canvas.altActionKey];return 0===O.x?E?"skewX":"scaleY":0===O.y?E?"skewY":"scaleX":void 0},n.rotationStyleHandler=function(D,O,M){return M.lockRotation?"not-allowed":O.cursorStyle},n.fireEvent=u,n.wrapWithFixedAnchor=A,n.wrapWithFireEvent=x,n.getLocalPoint=y,t.controlsUtils=n}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.degreesToRadians,o=t.controlsUtils;o.renderCircleControl=function(n,a,l,c,d){c=c||{};var h,p=this.sizeX||c.cornerSize||d.cornerSize,g=this.sizeY||c.cornerSize||d.cornerSize,v=void 0!==c.transparentCorners?c.transparentCorners:d.transparentCorners,r=v?"stroke":"fill",u=!v&&(c.cornerStrokeColor||d.cornerStrokeColor),f=a,m=l;n.save(),n.fillStyle=c.cornerColor||d.cornerColor,n.strokeStyle=c.cornerStrokeColor||d.cornerStrokeColor,g<p?(h=p,n.scale(1,g/p),m=l*p/g):p<g?(h=g,n.scale(p/g,1),f=a*g/p):h=p,n.lineWidth=1,n.beginPath(),n.arc(f,m,h/2,0,2*Math.PI,!1),n[r](),u&&n.stroke(),n.restore()},o.renderSquareControl=function(n,a,l,c,d){c=c||{};var h=this.sizeX||c.cornerSize||d.cornerSize,p=this.sizeY||c.cornerSize||d.cornerSize,g=void 0!==c.transparentCorners?c.transparentCorners:d.transparentCorners,v=g?"stroke":"fill",r=!g&&(c.cornerStrokeColor||d.cornerStrokeColor),u=h/2,f=p/2;n.save(),n.fillStyle=c.cornerColor||d.cornerColor,n.strokeStyle=c.cornerStrokeColor||d.cornerStrokeColor,n.lineWidth=1,n.translate(a,l),n.rotate(s(d.angle)),n[v+"Rect"](-u,-f,h,p),r&&n.strokeRect(-u,-f,h,p),n.restore()}}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Control=function(s){for(var o in s)this[o]=s[o]},t.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(s,o){return o.cursorStyle},getActionName:function(s,o){return o.actionName},getVisibility:function(s,o){var n=s._controlsVisibility;return n&&void 0!==n[o]?n[o]:this.visible},setVisibility:function(s){this.visible=s},positionHandler:function(s,o){return t.util.transformPoint({x:this.x*s.x+this.offsetX,y:this.y*s.y+this.offsetY},o)},calcCornerCoords:function(s,o,n,a,l){var c,d,h,p,g=l?this.touchSizeX:this.sizeX,v=l?this.touchSizeY:this.sizeY;if(g&&v&&g!==v){var r=Math.atan2(v,g),u=Math.sqrt(g*g+v*v)/2,f=r-t.util.degreesToRadians(s),m=Math.PI/2-r-t.util.degreesToRadians(s);c=u*t.util.cos(f),d=u*t.util.sin(f),h=u*t.util.cos(m),p=u*t.util.sin(m)}else u=.7071067812*(g&&v?g:o),f=t.util.degreesToRadians(45-s),c=h=u*t.util.cos(f),d=p=u*t.util.sin(f);return{tl:{x:n-p,y:a-h},tr:{x:n+c,y:a-d},bl:{x:n-c,y:a+d},br:{x:n+p,y:a+h}}},render:function(s,o,n,a,l){"circle"===((a=a||{}).cornerStyle||l.cornerStyle)?t.controlsUtils.renderCircleControl.call(this,s,o,n,a,l):t.controlsUtils.renderSquareControl.call(this,s,o,n,a,l)}}}(typeof exports<"u"?exports:this),function(){function e(s,o){var n,a,l,c,d=s.getAttribute("style"),h=s.getAttribute("offset")||0;if(h=(h=parseFloat(h)/(/%$/.test(h)?100:1))<0?0:1<h?1:h,d){var p=d.split(/\s*;\s*/);for(""===p[p.length-1]&&p.pop(),c=p.length;c--;){var g=p[c].split(/\s*:\s*/),v=g[0].trim(),r=g[1].trim();"stop-color"===v?n=r:"stop-opacity"===v&&(l=r)}}return n||(n=s.getAttribute("stop-color")||"rgb(0,0,0)"),l||(l=s.getAttribute("stop-opacity")),a=(n=new fabric.Color(n)).getAlpha(),l=isNaN(parseFloat(l))?1:parseFloat(l),l*=a*o,{offset:h,color:n.toRgb(),opacity:l}}var t=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(s){s||(s={}),s.coords||(s.coords={});var o,n=this;Object.keys(s).forEach(function(a){n[a]=s[a]}),this.id?this.id+="_"+fabric.Object.__uid++:this.id=fabric.Object.__uid++,o={x1:s.coords.x1||0,y1:s.coords.y1||0,x2:s.coords.x2||0,y2:s.coords.y2||0},"radial"===this.type&&(o.r1=s.coords.r1||0,o.r2=s.coords.r2||0),this.coords=o,this.colorStops=s.colorStops.slice()},addColorStop:function(s){for(var o in s){var n=new fabric.Color(s[o]);this.colorStops.push({offset:parseFloat(o),color:n.toRgb(),opacity:n.getAlpha()})}return this},toObject:function(s){var o={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,o,s),o},toSVG:function(s,o){var n,a,l,c,d=t(this.coords,!0),h=(o=o||{},t(this.colorStops,!0)),p=d.r1>d.r2,g=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),v=-this.offsetX,r=-this.offsetY,u=!!o.additionalTransform,f="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(h.sort(function(A,x){return A.offset-x.offset}),"objectBoundingBox"===f?(v/=s.width,r/=s.height):(v+=s.width/2,r+=s.height/2),"path"===s.type&&"percentage"!==this.gradientUnits&&(v-=s.pathOffset.x,r-=s.pathOffset.y),g[4]-=v,g[5]-=r,c='id="SVGID_'+this.id+'" gradientUnits="'+f+'"',c+=' gradientTransform="'+(u?o.additionalTransform+" ":"")+fabric.util.matrixToSVG(g)+'" ',"linear"===this.type?l=["<linearGradient ",c,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,'">\n']:"radial"===this.type&&(l=["<radialGradient ",c,' cx="',p?d.x1:d.x2,'" cy="',p?d.y1:d.y2,'" r="',p?d.r1:d.r2,'" fx="',p?d.x2:d.x1,'" fy="',p?d.y2:d.y1,'">\n']),"radial"===this.type){if(p)for((h=h.concat()).reverse(),n=0,a=h.length;n<a;n++)h[n].offset=1-h[n].offset;var m=Math.min(d.r1,d.r2);if(0<m){var b=m/Math.max(d.r1,d.r2);for(n=0,a=h.length;n<a;n++)h[n].offset+=b*(1-h[n].offset)}}for(n=0,a=h.length;n<a;n++){var w=h[n];l.push("<stop ",'offset="',100*w.offset+"%",'" style="stop-color:',w.color,void 0!==w.opacity?";stop-opacity: "+w.opacity:";",'"/>\n')}return l.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),l.join("")},toLive:function(s){var o,n,a,l=fabric.util.object.clone(this.coords);if(this.type){for("linear"===this.type?o=s.createLinearGradient(l.x1,l.y1,l.x2,l.y2):"radial"===this.type&&(o=s.createRadialGradient(l.x1,l.y1,l.r1,l.x2,l.y2,l.r2)),n=0,a=this.colorStops.length;n<a;n++){var c=this.colorStops[n].color,d=this.colorStops[n].opacity,h=this.colorStops[n].offset;void 0!==d&&(c=new fabric.Color(c).setAlpha(d).toRgba()),o.addColorStop(h,c)}return o}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(s,o,n,a){var l=parseFloat(n)/(/%$/.test(n)?100:1);l=l<0?0:1<l?1:l,isNaN(l)&&(l=1);var c,d,h,p,g,v,r,u,f,m,b,w=s.getElementsByTagName("stop"),A="userSpaceOnUse"===s.getAttribute("gradientUnits")?"pixels":"percentage",x=s.getAttribute("gradientTransform")||"",y=[],S=0,_=0;for("linearGradient"===s.nodeName||"LINEARGRADIENT"===s.nodeName?(c="linear",d={x1:(v=s).getAttribute("x1")||0,y1:v.getAttribute("y1")||0,x2:v.getAttribute("x2")||"100%",y2:v.getAttribute("y2")||0}):(c="radial",d={x1:(g=s).getAttribute("fx")||g.getAttribute("cx")||"50%",y1:g.getAttribute("fy")||g.getAttribute("cy")||"50%",r1:0,x2:g.getAttribute("cx")||"50%",y2:g.getAttribute("cy")||"50%",r2:g.getAttribute("r")||"50%"}),h=w.length;h--;)y.push(e(w[h],l));return p=fabric.parseTransformAttribute(x),r=d,u=a,f=A,Object.keys(r).forEach(function(C){"Infinity"===(m=r[C])?b=1:"-Infinity"===m?b=0:(b=parseFloat(r[C],10),"string"==typeof m&&/^(\d+\.\d+)%|(\d+)%$/.test(m)&&(b*=.01,"pixels"===f&&("x1"!==C&&"x2"!==C&&"r2"!==C||(b*=u.viewBoxWidth||u.width),"y1"!==C&&"y2"!==C||(b*=u.viewBoxHeight||u.height)))),r[C]=b}),"pixels"===A&&(S=-o.left,_=-o.top),new fabric.Gradient({id:s.getAttribute("id"),type:c,coords:d,colorStops:y,gradientUnits:A,gradientTransform:p,offsetX:S,offsetY:_})}})}(),function(){"use strict";var e=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,s){if(t||(t={}),this.id=fabric.Object.__uid++,this.setOptions(t),!t.source||t.source&&"string"!=typeof t.source)s&&s(this);else{var o=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(n,a){o.source=n,s&&s(o,a)},null,this.crossOrigin)}},toObject:function(t){var s,o,n=fabric.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?s=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(s=this.source.toDataURL()),o={type:"pattern",source:s,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:e(this.offsetX,n),offsetY:e(this.offsetY,n),patternTransform:this.patternTransform?this.patternTransform.concat():null},fabric.util.populateWithProperties(this,o,t),o},toSVG:function(t){var s="function"==typeof this.source?this.source():this.source,o=s.width/t.width,n=s.height/t.height,a=this.offsetX/t.width,l=this.offsetY/t.height,c="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1,l&&(n+=Math.abs(l))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(o=1,a&&(o+=Math.abs(a))),s.src?c=s.src:s.toDataURL&&(c=s.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+l+'" width="'+o+'" height="'+n+'">\n<image x="0" y="0" width="'+s.width+'" height="'+s.height+'" xlink:href="'+c+'"></image>\n</pattern>\n'},setOptions:function(t){for(var s in t)this[s]=t[s]},toLive:function(t){var s=this.source;return s&&(void 0===s.src||s.complete&&0!==s.naturalWidth&&0!==s.naturalHeight)?t.createPattern(s,this.repeat):""}})}(),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.toFixed;t.Shadow?t.warn("fabric.Shadow is already defined."):(t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(o){for(var n in"string"==typeof o&&(o=this._parseShadow(o)),o)this[n]=o[n];this.id=t.Object.__uid++},_parseShadow:function(o){var n=o.trim(),a=t.Shadow.reOffsetsAndBlur.exec(n)||[];return{color:(n.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(a[1],10)||0,offsetY:parseFloat(a[2],10)||0,blur:parseFloat(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(o){var n=40,a=40,l=t.Object.NUM_FRACTION_DIGITS,c=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-o.angle)),d=new t.Color(this.color);return o.width&&o.height&&(n=100*s((Math.abs(c.x)+this.blur)/o.width,l)+20,a=100*s((Math.abs(c.y)+this.blur)/o.height,l)+20),o.flipX&&(c.x*=-1),o.flipY&&(c.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+s(this.blur?this.blur/2:0,l)+'"></feGaussianBlur>\n\t<feOffset dx="'+s(c.x,l)+'" dy="'+s(c.y,l)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+d.toRgb()+'" flood-opacity="'+d.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var o={},n=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(a){this[a]!==n[a]&&(o[a]=this[a])},this),o}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(typeof exports<"u"?exports:this),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var e=fabric.util.object.extend,t=fabric.util.getElementOffset,s=fabric.util.removeFromArray,o=fabric.util.toFixed,n=fabric.util.transformPoint,a=fabric.util.invertTransform,l=fabric.util.getNodeCanvas,c=fabric.util.createCanvasElement,d=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(h,p){p||(p={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(h,p)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(h,p){var g=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(h),this._initOptions(p),this.interactive||this._initRetinaScaling(),p.overlayImage&&this.setOverlayImage(p.overlayImage,g),p.backgroundImage&&this.setBackgroundImage(p.backgroundImage,g),p.backgroundColor&&this.setBackgroundColor(p.backgroundColor,g),p.overlayColor&&this.setOverlayColor(p.overlayColor,g),this.calcOffset()},_isRetinaScaling:function(){return 1<fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,fabric.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var h=fabric.devicePixelRatio;this.__initRetinaScaling(h,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(h,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(h,p,g){p.setAttribute("width",this.width*h),p.setAttribute("height",this.height*h),g.scale(h,h)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(h,p,g){return this.__setBgOverlayImage("overlayImage",h,p,g)},setBackgroundImage:function(h,p,g){return this.__setBgOverlayImage("backgroundImage",h,p,g)},setOverlayColor:function(h,p){return this.__setBgOverlayColor("overlayColor",h,p)},setBackgroundColor:function(h,p){return this.__setBgOverlayColor("backgroundColor",h,p)},__setBgOverlayImage:function(h,p,g,v){return"string"==typeof p?fabric.util.loadImage(p,function(r,u){if(r){var f=new fabric.Image(r,v);(this[h]=f).canvas=this}g&&g(r,u)},this,v&&v.crossOrigin):(v&&p.setOptions(v),(this[h]=p)&&(p.canvas=this),g&&g(p,!1)),this},__setBgOverlayColor:function(h,p,g){return this[h]=p,this._initGradient(p,h),this._initPattern(p,h,g),this},_createCanvasElement:function(){var h=c();if(!h||(h.style||(h.style={}),void 0===h.getContext))throw d;return h},_initOptions:function(h){var p=this.lowerCanvasEl;this._setOptions(h),this.width=this.width||parseInt(p.width,10)||0,this.height=this.height||parseInt(p.height,10)||0,this.lowerCanvasEl.style&&(p.width=this.width,p.height=this.height,p.style.width=this.width+"px",p.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(h){this.lowerCanvasEl=h&&h.getContext?h:fabric.util.getById(h)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(h,p){return this.setDimensions({width:h},p)},setHeight:function(h,p){return this.setDimensions({height:h},p)},setDimensions:function(h,p){var g;for(var v in p=p||{},h)g=h[v],p.cssOnly||(this._setBackstoreDimension(v,h[v]),g+="px",this.hasLostContext=!0),p.backstoreOnly||this._setCssDimension(v,g);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),p.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(h,p){return this.lowerCanvasEl[h]=p,this.upperCanvasEl&&(this.upperCanvasEl[h]=p),this.cacheCanvasEl&&(this.cacheCanvasEl[h]=p),this[h]=p,this},_setCssDimension:function(h,p){return this.lowerCanvasEl.style[h]=p,this.upperCanvasEl&&(this.upperCanvasEl.style[h]=p),this.wrapperEl&&(this.wrapperEl.style[h]=p),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(h){var p,g,v,r=this._activeObject,u=this.backgroundImage,f=this.overlayImage;for(this.viewportTransform=h,g=0,v=this._objects.length;g<v;g++)(p=this._objects[g]).group||p.setCoords(!0);return r&&r.setCoords(),u&&u.setCoords(!0),f&&f.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(h,p){var g=h,v=this.viewportTransform.slice(0);h=n(h,a(this.viewportTransform)),v[0]=p,v[3]=p;var r=n(h,v);return v[4]+=g.x-r.x,v[5]+=g.y-r.y,this.setViewportTransform(v)},setZoom:function(h){return this.zoomToPoint(new fabric.Point(0,0),h),this},absolutePan:function(h){var p=this.viewportTransform.slice(0);return p[4]=-h.x,p[5]=-h.y,this.setViewportTransform(p)},relativePan:function(h){return this.absolutePan(new fabric.Point(-h.x-this.viewportTransform[4],-h.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(h){this.stateful&&h.setupState(),h._set("canvas",this),h.setCoords(),this.fire("object:added",{target:h}),h.fire("added")},_onObjectRemoved:function(h){this.fire("object:removed",{target:h}),h.fire("removed"),delete h.canvas},clearContext:function(h){return h.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var h={},p=this.width,g=this.height,v=a(this.viewportTransform);return h.tl=n({x:0,y:0},v),h.br=n({x:p,y:g},v),h.tr=new fabric.Point(h.br.x,h.tl.y),h.bl=new fabric.Point(h.tl.x,h.br.y),this.vptCoords=h},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(h,p){var g=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(h),fabric.util.setImageSmoothing(h,this.imageSmoothingEnabled),this.fire("before:render",{ctx:h}),this._renderBackground(h),h.save(),h.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._renderObjects(h,p),h.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(h),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(h)),this._renderOverlay(h),this.controlsAboveOverlay&&this.interactive&&this.drawControls(h),this.fire("after:render",{ctx:h})},drawClipPathOnCanvas:function(h){var p=this.viewportTransform,g=this.clipPath;h.save(),h.transform(p[0],p[1],p[2],p[3],p[4],p[5]),h.globalCompositeOperation="destination-in",g.transform(h),h.scale(1/g.zoomX,1/g.zoomY),h.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),h.restore()},_renderObjects:function(h,p){var g,v;for(g=0,v=p.length;g<v;++g)p[g]&&p[g].render(h)},_renderBackgroundOrOverlay:function(h,p){var g=this[p+"Color"],v=this[p+"Image"],r=this.viewportTransform,u=this[p+"Vpt"];if(g||v){if(g){h.save(),h.beginPath(),h.moveTo(0,0),h.lineTo(this.width,0),h.lineTo(this.width,this.height),h.lineTo(0,this.height),h.closePath(),h.fillStyle=g.toLive?g.toLive(h,this):g,u&&h.transform(r[0],r[1],r[2],r[3],r[4],r[5]),h.transform(1,0,0,1,g.offsetX||0,g.offsetY||0);var f=g.gradientTransform||g.patternTransform;f&&h.transform(f[0],f[1],f[2],f[3],f[4],f[5]),h.fill(),h.restore()}v&&(h.save(),u&&h.transform(r[0],r[1],r[2],r[3],r[4],r[5]),v.render(h),h.restore())}},_renderBackground:function(h){this._renderBackgroundOrOverlay(h,"background")},_renderOverlay:function(h){this._renderBackgroundOrOverlay(h,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new fabric.Point(this.width/2,this.height/2)},centerObjectH:function(h){return this._centerObject(h,new fabric.Point(this.getCenterPoint().x,h.getCenterPoint().y))},centerObjectV:function(h){return this._centerObject(h,new fabric.Point(h.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(h){var p=this.getCenterPoint();return this._centerObject(h,p)},viewportCenterObject:function(h){var p=this.getVpCenter();return this._centerObject(h,p)},viewportCenterObjectH:function(h){var p=this.getVpCenter();return this._centerObject(h,new fabric.Point(p.x,h.getCenterPoint().y)),this},viewportCenterObjectV:function(h){var p=this.getVpCenter();return this._centerObject(h,new fabric.Point(h.getCenterPoint().x,p.y))},getVpCenter:function(){var h=this.getCenterPoint(),p=a(this.viewportTransform);return n(h,p)},_centerObject:function(h,p){return h.setPositionByOrigin(p,"center","center"),h.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(h){return this.toDatalessObject(h)},toObject:function(h){return this._toObjectMethod("toObject",h)},toDatalessObject:function(h){return this._toObjectMethod("toDatalessObject",h)},_toObjectMethod:function(h,p){var g=this.clipPath,v={version:fabric.version,objects:this._toObjects(h,p)};return g&&!g.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,h,p)),e(v,this.__serializeBgOverlay(h,p)),fabric.util.populateWithProperties(this,v,p),v},_toObjects:function(h,p){return this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){return this._toObject(g,h,p)},this)},_toObject:function(h,p,g){var v;this.includeDefaultValues||(v=h.includeDefaultValues,h.includeDefaultValues=!1);var r=h[p](g);return this.includeDefaultValues||(h.includeDefaultValues=v),r},__serializeBgOverlay:function(h,p){var g={},v=this.backgroundImage,r=this.overlayImage,u=this.backgroundColor,f=this.overlayColor;return u&&u.toObject?u.excludeFromExport||(g.background=u.toObject(p)):u&&(g.background=u),f&&f.toObject?f.excludeFromExport||(g.overlay=f.toObject(p)):f&&(g.overlay=f),v&&!v.excludeFromExport&&(g.backgroundImage=this._toObject(v,h,p)),r&&!r.excludeFromExport&&(g.overlayImage=this._toObject(r,h,p)),g},svgViewportTransformation:!0,toSVG:function(h,p){h||(h={}),h.reviver=p;var g=[];return this._setSVGPreamble(g,h),this._setSVGHeader(g,h),this.clipPath&&g.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(g,"background"),this._setSVGBgOverlayImage(g,"backgroundImage",p),this._setSVGObjects(g,p),this.clipPath&&g.push("</g>\n"),this._setSVGBgOverlayColor(g,"overlay"),this._setSVGBgOverlayImage(g,"overlayImage",p),g.push("</svg>"),g.join("")},_setSVGPreamble:function(h,p){p.suppressPreamble||h.push('<?xml version="1.0" encoding="',p.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(h,p){var g,v=p.width||this.width,r=p.height||this.height,u='viewBox="0 0 '+this.width+" "+this.height+'" ',f=fabric.Object.NUM_FRACTION_DIGITS;p.viewBox?u='viewBox="'+p.viewBox.x+" "+p.viewBox.y+" "+p.viewBox.width+" "+p.viewBox.height+'" ':this.svgViewportTransformation&&(u='viewBox="'+o(-(g=this.viewportTransform)[4]/g[0],f)+" "+o(-g[5]/g[3],f)+" "+o(this.width/g[0],f)+" "+o(this.height/g[3],f)+'" '),h.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',v,'" ','height="',r,'" ',u,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(p),"</defs>\n")},createSVGClipPathMarkup:function(h){var p=this.clipPath;return p?(p.clipPathId="CLIPPATH_"+fabric.Object.__uid++,'<clipPath id="'+p.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(h.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var h=this;return["background","overlay"].map(function(p){var g=h[p+"Color"];if(g&&g.toLive){var v=h[p+"Vpt"],r=h.viewportTransform;return g.toSVG({width:h.width/(v?r[0]:1),height:h.height/(v?r[3]:1)},{additionalTransform:v?fabric.util.matrixToSVG(r):""})}}).join("")},createSVGFontFacesMarkup:function(){var h,p,g,v,r,u,f,m,b="",w={},A=fabric.fontPaths,x=[];for(this._objects.forEach(function S(_){x.push(_),_._objects&&_._objects.forEach(S)}),f=0,m=x.length;f<m;f++)if(p=(h=x[f]).fontFamily,-1!==h.type.indexOf("text")&&!w[p]&&A[p]&&(w[p]=!0,h.styles))for(r in g=h.styles)for(u in v=g[r])!w[p=v[u].fontFamily]&&A[p]&&(w[p]=!0);for(var y in w)b+=["\t\t@font-face {\n","\t\t\tfont-family: '",y,"';\n","\t\t\tsrc: url('",A[y],"');\n","\t\t}\n"].join("");return b&&(b=['\t<style type="text/css">',"<![CDATA[\n",b,"]]>","</style>\n"].join("")),b},_setSVGObjects:function(h,p){var g,v,r,u=this._objects;for(v=0,r=u.length;v<r;v++)(g=u[v]).excludeFromExport||this._setSVGObject(h,g,p)},_setSVGObject:function(h,p,g){h.push(p.toSVG(g))},_setSVGBgOverlayImage:function(h,p,g){this[p]&&!this[p].excludeFromExport&&this[p].toSVG&&h.push(this[p].toSVG(g))},_setSVGBgOverlayColor:function(h,p){var g=this[p+"Color"],r=this.width,u=this.height;if(g)if(g.toLive){var f=g.repeat,m=fabric.util.invertTransform(this.viewportTransform),b=this[p+"Vpt"]?fabric.util.matrixToSVG(m):"";h.push('<rect transform="'+b+" translate(",r/2,",",u/2,')"',' x="',g.offsetX-r/2,'" y="',g.offsetY-u/2,'" ','width="',"repeat-y"===f||"no-repeat"===f?g.source.width:r,'" height="',"repeat-x"===f||"no-repeat"===f?g.source.height:u,'" fill="url(#SVGID_'+g.id+')"',"></rect>\n")}else h.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',g,'"',"></rect>\n")},sendToBack:function(h){if(!h)return this;var p,g,v,r=this._activeObject;if(h===r&&"activeSelection"===h.type)for(p=(v=r._objects).length;p--;)s(this._objects,g=v[p]),this._objects.unshift(g);else s(this._objects,h),this._objects.unshift(h);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(h){if(!h)return this;var p,g,v,r=this._activeObject;if(h===r&&"activeSelection"===h.type)for(v=r._objects,p=0;p<v.length;p++)s(this._objects,g=v[p]),this._objects.push(g);else s(this._objects,h),this._objects.push(h);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(h,p){if(!h)return this;var g,v,r,u,f,m=this._activeObject,b=0;if(h===m&&"activeSelection"===h.type)for(f=m._objects,g=0;g<f.length;g++)0+b<(r=this._objects.indexOf(v=f[g]))&&(u=r-1,s(this._objects,v),this._objects.splice(u,0,v)),b++;else 0!==(r=this._objects.indexOf(h))&&(u=this._findNewLowerIndex(h,r,p),s(this._objects,h),this._objects.splice(u,0,h));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(h,p,g){var v,r;if(g){for(r=(v=p)-1;0<=r;--r)if(h.intersectsWithObject(this._objects[r])||h.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(h)){v=r;break}}else v=p-1;return v},bringForward:function(h,p){if(!h)return this;var g,v,r,u,f,m=this._activeObject,b=0;if(h===m&&"activeSelection"===h.type)for(g=(f=m._objects).length;g--;)(r=this._objects.indexOf(v=f[g]))<this._objects.length-1-b&&(u=r+1,s(this._objects,v),this._objects.splice(u,0,v)),b++;else(r=this._objects.indexOf(h))!==this._objects.length-1&&(u=this._findNewUpperIndex(h,r,p),s(this._objects,h),this._objects.splice(u,0,h));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(h,p,g){var v,r,u;if(g){for(r=(v=p)+1,u=this._objects.length;r<u;++r)if(h.intersectsWithObject(this._objects[r])||h.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(h)){v=r;break}}else v=p+1;return v},moveTo:function(h,p){return s(this._objects,h),this._objects.splice(p,0,h),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(h){h.dispose&&h.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),fabric.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),fabric.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,fabric.Collection),e(fabric.StaticCanvas.prototype,fabric.DataURLExporter),e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(h){var p=c();if(!p||!p.getContext)return null;var g=p.getContext("2d");return g&&"setLineDash"===h?void 0!==g.setLineDash:null}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var h=l(this.lowerCanvasEl);return h&&h.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(h){var p=l(this.lowerCanvasEl);return p&&p.createJPEGStream(h)})}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(e){e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(this.shadow){var e=this.canvas,t=this.shadow,s=e.contextTop,o=e.getZoom();e&&e._isRetinaScaling()&&(o*=fabric.devicePixelRatio),s.shadowColor=t.color,s.shadowBlur=t.blur*o,s.shadowOffsetX=t.offsetX*o,s.shadowOffsetY=t.offsetY*o}},needsFullRender:function(){return new fabric.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},_isOutSideCanvas:function(e){return e.x<0||e.x>this.canvas.getWidth()||e.y<0||e.y>this.canvas.getHeight()}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(e){this.canvas=e,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(e,t,s){var o=t.midPointFrom(s);return e.quadraticCurveTo(t.x,t.y,o.x,o.y),o},onMouseDown:function(e,t){this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],this._prepareForDrawing(e),this._captureDrawingPath(e),this._render())},onMouseMove:function(e,t){if(this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(e))&&this._captureDrawingPath(e)&&1<this._points.length))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var s=this._points,o=s.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,s[o-2],s[o-1],!0),n.stroke(),n.restore()}},onMouseUp:function(e){return!this.canvas._isMainEvent(e.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(e){var t=new fabric.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return!(1<this._points.length&&e.eq(this._points[this._points.length-1])||(this.drawStraightLine&&1<this._points.length&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(e),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(e){var t=new fabric.Point(e.x,e.y);return this._addPoint(t)},_render:function(e){var t,s,o=this._points[0],n=this._points[1];if(this._saveAndTransform(e=e||this.canvas.contextTop),e.beginPath(),2===this._points.length&&o.x===n.x&&o.y===n.y){var a=this.width/1e3;o=new fabric.Point(o.x,o.y),n=new fabric.Point(n.x,n.y),o.x-=a,n.x+=a}for(e.moveTo(o.x,o.y),t=1,s=this._points.length;t<s;t++)this._drawSegment(e,o,n),o=this._points[t],n=this._points[t+1];e.lineTo(o.x,o.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){return fabric.util.getSmoothPathFromPoints(e,this.width/1e3)},_isEmptySVGPath:function(e){return"M 0 0 Q 0 0 0 0 L 0 0"===fabric.util.joinPath(e)},createPath:function(e){var t=new fabric.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new fabric.Shadow(this.shadow)),t},decimatePoints:function(e,t){if(e.length<=2)return e;var s,o=this.canvas.getZoom(),n=Math.pow(t/o,2),a=e.length-1,l=e[0],c=[l];for(s=1;s<a-1;s++)n<=Math.pow(l.x-e[s].x,2)+Math.pow(l.y-e[s].y,2)&&c.push(l=e[s]);return c.push(e[a]),c},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(e))this.canvas.requestRenderAll();else{var t=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:t}),this.canvas.add(t),this.canvas.requestRenderAll(),t.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:t})}}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),s=this.canvas.contextTop;this._saveAndTransform(s),this.dot(s,t),s.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e,t,s=this.canvas.contextTop,o=this.points;for(this._saveAndTransform(s),e=0,t=o.length;e<t;e++)this.dot(s,o[e]);s.restore()},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e))},onMouseUp:function(){var e,t,s=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var o=[];for(e=0,t=this.points.length;e<t;e++){var n=this.points[e],a=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(a.shadow=new fabric.Shadow(this.shadow)),o.push(a)}var l=new fabric.Group(o);l.canvas=this.canvas,this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=s,this.canvas.requestRenderAll()},addPoint:function(e){var t=new fabric.Point(e.x,e.y),s=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,o=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=s,t.fill=o,this.points.push(t),t}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.addSprayChunk(e),this.render(this.sprayChunkPoints))},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],s=0,o=this.sprayChunks.length;s<o;s++)for(var n=this.sprayChunks[s],a=0,l=n.length;a<l;a++){var c=new fabric.Rect({width:n[a].width,height:n[a].width,left:n[a].x+1,top:n[a].y+1,originX:"center",originY:"center",fill:this.color});t.push(c)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var d=new fabric.Group(t);this.shadow&&d.set("shadow",new fabric.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t,s,o,n={};for(s=0,o=e.length;s<o;s++)n[t=e[s].left+""+e[s].top]||(n[t]=e[s]);var a=[];for(t in n)a.push(n[t]);return a},render:function(e){var t,s,o=this.canvas.contextTop;for(o.fillStyle=this.color,this._saveAndTransform(o),t=0,s=e.length;t<s;t++){var n=e[t];void 0!==n.opacity&&(o.globalAlpha=n.opacity),o.fillRect(n.x,n.y,n.width,n.width)}o.restore()},_render:function(){var e,t,s=this.canvas.contextTop;for(s.fillStyle=this.color,this._saveAndTransform(s),e=0,t=this.sprayChunks.length;e<t;e++)this.render(this.sprayChunks[e]);s.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,s,o,n,a=this.width/2;for(n=0;n<this.density;n++){t=fabric.util.getRandomInt(e.x-a,e.x+a),s=fabric.util.getRandomInt(e.y-a,e.y+a),o=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var l=new fabric.Point(t,s);l.width=o,this.randomOpacity&&(l.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(l)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=fabric.util.createCanvasElement(),t=e.getContext("2d");return e.width=e.height=25,t.fillStyle=this.color,t.beginPath(),t.arc(10,10,10,0,2*Math.PI,!1),t.closePath(),t.fill(),e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(e){return e.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(e){this.callSuper("_setBrushStyles",e),e.strokeStyle=this.getPattern(e)},createPath:function(e){var t=this.callSuper("createPath",e),s=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-s.x,offsetY:-s.y}),t}}),function(){var e=fabric.util.getPointer,t=fabric.util.degreesToRadians,s=fabric.util.isTouchEvent;for(var o in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(n,a){a||(a={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(n,a),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var n,a,l,c=this.getActiveObjects();if(0<c.length&&!this.preserveObjectStacking){a=[],l=[];for(var d=0,h=this._objects.length;d<h;d++)-1===c.indexOf(n=this._objects[d])?a.push(n):l.push(n);1<c.length&&(this._activeObject._objects=l),a.push.apply(a,l)}else a=this._objects;return a},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(n){n.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(n),this.contextTopDirty=!0),n.restore()},renderTop:function(){var n=this.contextTop;return this.clearContext(n),this.renderTopLayer(n),this.fire("after:render"),this},_normalizePointer:function(n,a){var l=n.calcTransformMatrix(),c=fabric.util.invertTransform(l),d=this.restorePointerVpt(a);return fabric.util.transformPoint(d,c)},isTargetTransparent:function(n,a,l){if(n.shouldCache()&&n._cacheCanvas&&n!==this._activeObject){var c=this._normalizePointer(n,{x:a,y:l}),d=Math.max(n.cacheTranslationX+c.x*n.zoomX,0),h=Math.max(n.cacheTranslationY+c.y*n.zoomY,0);return fabric.util.isTransparent(n._cacheContext,Math.round(d),Math.round(h),this.targetFindTolerance)}var p=this.contextCache,g=n.selectionBackgroundColor,v=this.viewportTransform;return n.selectionBackgroundColor="",this.clearContext(p),p.save(),p.transform(v[0],v[1],v[2],v[3],v[4],v[5]),n.render(p),p.restore(),n.selectionBackgroundColor=g,fabric.util.isTransparent(p,a,l,this.targetFindTolerance)},_isSelectionKeyPressed:function(n){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(a){return!0===n[a]}):n[this.selectionKey]},_shouldClearSelection:function(n,a){var l=this.getActiveObjects(),c=this._activeObject;return!a||a&&c&&1<l.length&&-1===l.indexOf(a)&&c!==a&&!this._isSelectionKeyPressed(n)||a&&!a.evented||a&&!a.selectable&&c&&c!==a},_shouldCenterTransform:function(n,a,l){var c;if(n)return"scale"===a||"scaleX"===a||"scaleY"===a||"resizing"===a?c=this.centeredScaling||n.centeredScaling:"rotate"===a&&(c=this.centeredRotation||n.centeredRotation),c?!l:l},_getOriginFromCorner:function(n,a){var l={x:n.originX,y:n.originY};return"ml"===a||"tl"===a||"bl"===a?l.x="right":"mr"!==a&&"tr"!==a&&"br"!==a||(l.x="left"),"tl"===a||"mt"===a||"tr"===a?l.y="bottom":"bl"!==a&&"mb"!==a&&"br"!==a||(l.y="top"),l},_getActionFromCorner:function(n,a,l,c){if(!a||!n)return"drag";var d=c.controls[a];return d.getActionName(l,d,c)},_setupCurrentTransform:function(n,a,l){if(a){var c=this.getPointer(n),d=a.__corner,h=a.controls[d],p=l&&d?h.getActionHandler(n,a,h):fabric.controlsUtils.dragHandler,g=this._getActionFromCorner(l,d,n,a),v=this._getOriginFromCorner(a,d),r=n[this.centeredKey],u={target:a,action:g,actionHandler:p,corner:d,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,offsetX:c.x-a.left,offsetY:c.y-a.top,originX:v.x,originY:v.y,ex:c.x,ey:c.y,lastX:c.x,lastY:c.y,theta:t(a.angle),width:a.width*a.scaleX,shiftKey:n.shiftKey,altKey:r,original:fabric.util.saveObjectTransform(a)};this._shouldCenterTransform(a,g,r)&&(u.originX="center",u.originY="center"),u.original.originX=v.x,u.original.originY=v.y,this._currentTransform=u,this._beforeTransform(n)}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_drawSelection:function(n){var a=this._groupSelector,l=new fabric.Point(a.ex,a.ey),c=fabric.util.transformPoint(l,this.viewportTransform),d=new fabric.Point(a.ex+a.left,a.ey+a.top),h=fabric.util.transformPoint(d,this.viewportTransform),p=Math.min(c.x,h.x),g=Math.min(c.y,h.y),v=Math.max(c.x,h.x),r=Math.max(c.y,h.y),u=this.selectionLineWidth/2;this.selectionColor&&(n.fillStyle=this.selectionColor,n.fillRect(p,g,v-p,r-g)),this.selectionLineWidth&&this.selectionBorderColor&&(n.lineWidth=this.selectionLineWidth,n.strokeStyle=this.selectionBorderColor,p+=u,g+=u,v-=u,r-=u,fabric.Object.prototype._setLineDash.call(this,n,this.selectionDashArray),n.strokeRect(p,g,v-p,r-g))},findTarget:function(n,a){if(!this.skipTargetFind){var l,c,d=this.getPointer(n,!0),h=this._activeObject,p=this.getActiveObjects(),g=s(n),v=1<p.length&&!a||1===p.length;if(this.targets=[],v&&h._findTargetCorner(d,g)||1<p.length&&!a&&h===this._searchPossibleTargets([h],d))return h;if(1===p.length&&h===this._searchPossibleTargets([h],d)){if(!this.preserveObjectStacking)return h;l=h,c=this.targets,this.targets=[]}var r=this._searchPossibleTargets(this._objects,d);return n[this.altSelectionKey]&&r&&l&&r!==l&&(r=l,this.targets=c),r}},_checkTarget:function(n,a,l){if(a&&a.visible&&a.evented&&a.containsPoint(n)&&(!this.perPixelTargetFind&&!a.perPixelTargetFind||a.isEditing||!this.isTargetTransparent(a,l.x,l.y)))return!0},_searchPossibleTargets:function(n,a){for(var l,c,d=n.length;d--;){var h=n[d],p=h.group?this._normalizePointer(h.group,a):a;if(this._checkTarget(p,h,a)){(l=n[d]).subTargetCheck&&l instanceof fabric.Group&&(c=this._searchPossibleTargets(l._objects,a))&&this.targets.push(c);break}}return l},restorePointerVpt:function(n){return fabric.util.transformPoint(n,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(n,a){if(this._absolutePointer&&!a)return this._absolutePointer;if(this._pointer&&a)return this._pointer;var l,c=e(n),d=this.upperCanvasEl,h=d.getBoundingClientRect(),p=h.width||0,g=h.height||0;p&&g||("top"in h&&"bottom"in h&&(g=Math.abs(h.top-h.bottom)),"right"in h&&"left"in h&&(p=Math.abs(h.right-h.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,a||(c=this.restorePointerVpt(c));var v=this.getRetinaScaling();return 1!==v&&(c.x/=v,c.y/=v),{x:c.x*(l=0===p||0===g?{width:1,height:1}:{width:d.width/p,height:d.height/g}).width,y:c.y*l.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),a=this.lowerCanvasEl,l=this.upperCanvasEl;l?l.className="":(l=this._createCanvasElement(),this.upperCanvasEl=l),fabric.util.addClass(l,"upper-canvas "+n),this.wrapperEl.appendChild(l),this._copyCanvasStyle(a,l),this._applyCanvasStyle(l),this.contextTop=l.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var a=this.width||n.width,l=this.height||n.height;fabric.util.setStyle(n,{position:"absolute",width:a+"px",height:l+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),n.width=a,n.height=l,fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,a){a.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var n=this._activeObject;return n?"activeSelection"===n.type&&n._objects?n._objects.slice(0):[n]:[]},_onObjectRemoved:function(n){n===this._activeObject&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared",{target:n}),n.fire("deselected")),n===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",n)},_fireSelectionEvents:function(n,a){var l=!1,c=this.getActiveObjects(),d=[],h=[];n.forEach(function(p){-1===c.indexOf(p)&&(l=!0,p.fire("deselected",{e:a,target:p}),h.push(p))}),c.forEach(function(p){-1===n.indexOf(p)&&(l=!0,p.fire("selected",{e:a,target:p}),d.push(p))}),0<n.length&&0<c.length?l&&this.fire("selection:updated",{e:a,selected:d,deselected:h}):0<c.length?this.fire("selection:created",{e:a,selected:d}):0<n.length&&this.fire("selection:cleared",{e:a,deselected:h})},setActiveObject:function(n,a){var l=this.getActiveObjects();return this._setActiveObject(n,a),this._fireSelectionEvents(l,a),this},_setActiveObject:function(n,a){return this._activeObject!==n&&!!this._discardActiveObject(a,n)&&!n.onSelect({e:a})&&(this._activeObject=n,!0)},_discardActiveObject:function(n,a){var l=this._activeObject;if(l){if(l.onDeselect({e:n,object:a}))return!1;this._activeObject=null}return!0},discardActiveObject:function(n){var a=this.getActiveObjects(),l=this.getActiveObject();return a.length&&this.fire("before:selection:cleared",{target:l,e:n}),this._discardActiveObject(n),this._fireSelectionEvents(a,n),this},dispose:function(){var n=this.wrapperEl;return this.removeListeners(),n.removeChild(this.upperCanvasEl),n.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(a){fabric.util.cleanUpJsdomNode(this[a]),this[a]=void 0}.bind(this)),n.parentNode&&n.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(n){var a=this._activeObject;a&&a._renderControls(n)},_toObject:function(n,a,l){var c=this._realizeGroupTransformOnObject(n),d=this.callSuper("_toObject",n,a,l);return this._unwindGroupTransformOnObject(n,c),d},_realizeGroupTransformOnObject:function(n){if(n.group&&"activeSelection"===n.group.type&&this._activeObject===n.group){var a={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(l){a[l]=n[l]}),fabric.util.addTransformToObject(n,this._activeObject.calcOwnMatrix()),a}return null},_unwindGroupTransformOnObject:function(n,a){a&&n.set(a)},_setSVGObject:function(n,a,l){var c=this._realizeGroupTransformOnObject(a);this.callSuper("_setSVGObject",n,a,l),this._unwindGroupTransformOnObject(a,c)},setViewportTransform:function(n){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),fabric.StaticCanvas.prototype.setViewportTransform.call(this,n)}}),fabric.StaticCanvas)"prototype"!==o&&(fabric.Canvas[o]=fabric.StaticCanvas[o])}(),function(){var e=fabric.util.addListener,t=fabric.util.removeListener,s={passive:!1};function o(n,a){return n.button&&n.button===a-1}fabric.util.object.extend(fabric.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(n,a){var l=this.upperCanvasEl,c=this._getEventPrefix();n(fabric.window,"resize",this._onResize),n(l,c+"down",this._onMouseDown),n(l,c+"move",this._onMouseMove,s),n(l,c+"out",this._onMouseOut),n(l,c+"enter",this._onMouseEnter),n(l,"wheel",this._onMouseWheel),n(l,"contextmenu",this._onContextMenu),n(l,"dblclick",this._onDoubleClick),n(l,"dragover",this._onDragOver),n(l,"dragenter",this._onDragEnter),n(l,"dragleave",this._onDragLeave),n(l,"drop",this._onDrop),this.enablePointerEvents||n(l,"touchstart",this._onTouchStart,s),typeof eventjs<"u"&&a in eventjs&&(eventjs[a](l,"gesture",this._onGesture),eventjs[a](l,"drag",this._onDrag),eventjs[a](l,"orientation",this._onOrientationChange),eventjs[a](l,"shake",this._onShake),eventjs[a](l,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var n=this._getEventPrefix();t(fabric.document,n+"up",this._onMouseUp),t(fabric.document,"touchend",this._onTouchEnd,s),t(fabric.document,n+"move",this._onMouseMove,s),t(fabric.document,"touchmove",this._onMouseMove,s)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(n,a){this.__onTransformGesture&&this.__onTransformGesture(n,a)},_onDrag:function(n,a){this.__onDrag&&this.__onDrag(n,a)},_onMouseWheel:function(n){this.__onMouseWheel(n)},_onMouseOut:function(n){var a=this._hoveredTarget;this.fire("mouse:out",{target:a,e:n}),this._hoveredTarget=null,a&&a.fire("mouseout",{e:n});var l=this;this._hoveredTargets.forEach(function(c){l.fire("mouse:out",{target:a,e:n}),c&&a.fire("mouseout",{e:n})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(c){c.isEditing&&c.hiddenTextarea.focus()})},_onMouseEnter:function(n){this._currentTransform||this.findTarget(n)||(this.fire("mouse:over",{target:null,e:n}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(n,a){this.__onOrientationChange&&this.__onOrientationChange(n,a)},_onShake:function(n,a){this.__onShake&&this.__onShake(n,a)},_onLongPress:function(n,a){this.__onLongPress&&this.__onLongPress(n,a)},_onDragOver:function(n){n.preventDefault();var a=this._simpleEventHandler("dragover",n);this._fireEnterLeaveEvents(a,n)},_onDrop:function(n){return this._simpleEventHandler("drop:before",n),this._simpleEventHandler("drop",n)},_onContextMenu:function(n){return this.stopContextMenu&&(n.stopPropagation(),n.preventDefault()),!1},_onDoubleClick:function(n){this._cacheTransformEventData(n),this._handleEvent(n,"dblclick"),this._resetTransformEventData(n)},getPointerId:function(n){var a=n.changedTouches;return a?a[0]&&a[0].identifier:this.enablePointerEvents?n.pointerId:-1},_isMainEvent:function(n){return!0===n.isPrimary||!1!==n.isPrimary&&("touchend"===n.type&&0===n.touches.length||!n.changedTouches||n.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(n){n.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(n)),this.__onMouseDown(n),this._resetTransformEventData();var a=this.upperCanvasEl,l=this._getEventPrefix();e(fabric.document,"touchend",this._onTouchEnd,s),e(fabric.document,"touchmove",this._onMouseMove,s),t(a,l+"down",this._onMouseDown)},_onMouseDown:function(n){this.__onMouseDown(n),this._resetTransformEventData();var a=this.upperCanvasEl,l=this._getEventPrefix();t(a,l+"move",this._onMouseMove,s),e(fabric.document,l+"up",this._onMouseUp),e(fabric.document,l+"move",this._onMouseMove,s)},_onTouchEnd:function(n){if(!(0<n.touches.length)){this.__onMouseUp(n),this._resetTransformEventData(),this.mainTouchId=null;var a=this._getEventPrefix();t(fabric.document,"touchend",this._onTouchEnd,s),t(fabric.document,"touchmove",this._onMouseMove,s);var l=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(l.upperCanvasEl,a+"down",l._onMouseDown),l._willAddMouseDown=0},400)}},_onMouseUp:function(n){this.__onMouseUp(n),this._resetTransformEventData();var a=this.upperCanvasEl,l=this._getEventPrefix();this._isMainEvent(n)&&(t(fabric.document,l+"up",this._onMouseUp),t(fabric.document,l+"move",this._onMouseMove,s),e(a,l+"move",this._onMouseMove,s))},_onMouseMove:function(n){!this.allowTouchScrolling&&n.preventDefault&&n.preventDefault(),this.__onMouseMove(n)},_onResize:function(){this.calcOffset()},_shouldRender:function(n){var a=this._activeObject;return!!(!!a!=!!n||a&&n&&a!==n)||!1},__onMouseUp:function(n){var a,l=this._currentTransform,c=this._groupSelector,d=!1,h=!c||0===c.left&&0===c.top;if(this._cacheTransformEventData(n),a=this._target,this._handleEvent(n,"up:before"),o(n,3))this.fireRightClick&&this._handleEvent(n,"up",3,h);else{if(o(n,2))return this.fireMiddleClick&&this._handleEvent(n,"up",2,h),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(n);else if(this._isMainEvent(n)){if(l&&(this._finalizeCurrentTransform(n),d=l.actionPerformed),!h){var p=a===this._activeObject;this._maybeGroupObjects(n),d||(d=this._shouldRender(a)||!p&&a===this._activeObject)}var g,v;if(a){if(g=a._findTargetCorner(this.getPointer(n,!0),fabric.util.isTouchEvent(n)),a.selectable&&a!==this._activeObject&&"up"===a.activeOn)this.setActiveObject(a,n),d=!0;else{var r=a.controls[g],u=r&&r.getMouseUpHandler(n,a,r);u&&u(n,l,(v=this.getPointer(n)).x,v.y)}a.isMoving=!1}if(l&&(l.target!==a||l.corner!==g)){var f=l.target&&l.target.controls[l.corner],m=f&&f.getMouseUpHandler(n,a,r);v=v||this.getPointer(n),m&&m(n,l,v.x,v.y)}this._setCursorFromEvent(n,a),this._handleEvent(n,"up",1,h),this._groupSelector=null,this._currentTransform=null,a&&(a.__corner=0),d?this.requestRenderAll():h||this.renderTop()}}},_simpleEventHandler:function(n,a){var l=this.findTarget(a),c=this.targets,d={e:a,target:l,subTargets:c};if(this.fire(n,d),l&&l.fire(n,d),!c)return l;for(var h=0;h<c.length;h++)c[h].fire(n,d);return l},_handleEvent:function(n,a,l,c){var d=this._target,h=this.targets||[],p={e:n,target:d,subTargets:h,button:l||1,isClick:c||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===a&&(p.currentTarget=this.findTarget(n),p.currentSubTargets=this.targets),this.fire("mouse:"+a,p),d&&d.fire("mouse"+a,p);for(var g=0;g<h.length;g++)h[g].fire("mouse"+a,p)},_finalizeCurrentTransform:function(n){var a=this._currentTransform,l=a.target,c={e:n,target:l,transform:a,action:a.action};l._scaling&&(l._scaling=!1),l.setCoords(),(a.actionPerformed||this.stateful&&l.hasStateChanged())&&this._fire("modified",c)},_onMouseDownInDrawingMode:function(n){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(n).requestRenderAll();var a=this.getPointer(n);this.freeDrawingBrush.onMouseDown(a,{e:n,pointer:a}),this._handleEvent(n,"down")},_onMouseMoveInDrawingMode:function(n){if(this._isCurrentlyDrawing){var a=this.getPointer(n);this.freeDrawingBrush.onMouseMove(a,{e:n,pointer:a})}this.setCursor(this.freeDrawingCursor),this._handleEvent(n,"move")},_onMouseUpInDrawingMode:function(n){var a=this.getPointer(n);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:n,pointer:a}),this._handleEvent(n,"up")},__onMouseDown:function(n){this._cacheTransformEventData(n),this._handleEvent(n,"down:before");var a=this._target;if(o(n,3))this.fireRightClick&&this._handleEvent(n,"down",3);else if(o(n,2))this.fireMiddleClick&&this._handleEvent(n,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(n);else if(this._isMainEvent(n)&&!this._currentTransform){var l=this._pointer;this._previousPointer=l;var c=this._shouldRender(a),d=this._shouldGroup(n,a);if(this._shouldClearSelection(n,a)?this.discardActiveObject(n):d&&(this._handleGrouping(n,a),a=this._activeObject),!this.selection||a&&(a.selectable||a.isEditing||a===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),a){var h=a===this._activeObject;a.selectable&&"down"===a.activeOn&&this.setActiveObject(a,n);var p=a._findTargetCorner(this.getPointer(n,!0),fabric.util.isTouchEvent(n));if(a.__corner=p,a===this._activeObject&&(p||!d)){this._setupCurrentTransform(n,a,h);var g=a.controls[p],v=(l=this.getPointer(n),g&&g.getMouseDownHandler(n,a,g));v&&v(n,this._currentTransform,l.x,l.y)}}this._handleEvent(n,"down"),(c||d)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(n){this._resetTransformEventData(),this._pointer=this.getPointer(n,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(n)||null},_beforeTransform:function(n){var a=this._currentTransform;this.stateful&&a.target.saveState(),this.fire("before:transform",{e:n,transform:a})},__onMouseMove:function(n){var a,l;if(this._handleEvent(n,"move:before"),this._cacheTransformEventData(n),this.isDrawingMode)this._onMouseMoveInDrawingMode(n);else if(this._isMainEvent(n)){var c=this._groupSelector;c?(c.left=(l=this._absolutePointer).x-c.ex,c.top=l.y-c.ey,this.renderTop()):this._currentTransform?this._transformObject(n):(a=this.findTarget(n)||null,this._setCursorFromEvent(n,a),this._fireOverOutEvents(a,n)),this._handleEvent(n,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(n,a){var l=this._hoveredTarget,c=this._hoveredTargets,d=this.targets,h=Math.max(c.length,d.length);this.fireSyntheticInOutEvents(n,a,{oldTarget:l,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var p=0;p<h;p++)this.fireSyntheticInOutEvents(d[p],a,{oldTarget:c[p],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(n,a){var l=this._draggedoverTarget,c=this._hoveredTargets,d=this.targets,h=Math.max(c.length,d.length);this.fireSyntheticInOutEvents(n,a,{oldTarget:l,evtOut:"dragleave",evtIn:"dragenter"});for(var p=0;p<h;p++)this.fireSyntheticInOutEvents(d[p],a,{oldTarget:c[p],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=n},fireSyntheticInOutEvents:function(n,a,l){var c,d,h,p=l.oldTarget,g=p!==n,v=l.canvasEvtIn,r=l.canvasEvtOut;g&&(c={e:a,target:n,previousTarget:p},d={e:a,target:p,nextTarget:n}),h=n&&g,p&&g&&(r&&this.fire(r,d),p.fire(l.evtOut,d)),h&&(v&&this.fire(v,c),n.fire(l.evtIn,c))},__onMouseWheel:function(n){this._cacheTransformEventData(n),this._handleEvent(n,"wheel"),this._resetTransformEventData()},_transformObject:function(n){var a=this.getPointer(n),l=this._currentTransform;l.reset=!1,l.shiftKey=n.shiftKey,l.altKey=n[this.centeredKey],this._performTransformAction(n,l,a),l.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(n,a,l){var h=a.action,p=!1,g=a.actionHandler;g&&(p=g(n,a,l.x,l.y)),"drag"===h&&p&&(a.target.isMoving=!0,this.setCursor(a.target.moveCursor||this.moveCursor)),a.actionPerformed=a.actionPerformed||p},_fire:fabric.controlsUtils.fireEvent,_setCursorFromEvent:function(n,a){if(!a)return this.setCursor(this.defaultCursor),!1;var l=a.hoverCursor||this.hoverCursor,c=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,d=(!c||!c.contains(a))&&a._findTargetCorner(this.getPointer(n,!0));d?this.setCursor(this.getCornerCursor(d,a,n)):(a.subTargetCheck&&this.targets.concat().reverse().map(function(h){l=h.hoverCursor||l}),this.setCursor(l))},getCornerCursor:function(n,a,l){var c=a.controls[n];return c.cursorStyleHandler(l,c,a)}})}(),function(){var e=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(s,o){var n=this._activeObject;return n&&this._isSelectionKeyPressed(s)&&o&&o.selectable&&this.selection&&(n!==o||"activeSelection"===n.type)&&!o.onSelect({e:s})},_handleGrouping:function(s,o){var n=this._activeObject;n.__corner||(o!==n||(o=this.findTarget(s,!0))&&o.selectable)&&(n&&"activeSelection"===n.type?this._updateActiveSelection(o,s):this._createActiveSelection(o,s))},_updateActiveSelection:function(s,o){var n=this._activeObject,a=n._objects.slice(0);n.contains(s)?(n.removeWithUpdate(s),this._hoveredTarget=s,this._hoveredTargets=this.targets.concat(),1===n.size()&&this._setActiveObject(n.item(0),o)):(n.addWithUpdate(s),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(a,o)},_createActiveSelection:function(s,o){var n=this.getActiveObjects(),a=this._createGroup(s);this._hoveredTarget=a,this._setActiveObject(a,o),this._fireSelectionEvents(n,o)},_createGroup:function(s){var o=this._objects,n=o.indexOf(this._activeObject)<o.indexOf(s)?[this._activeObject,s]:[s,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(n,{canvas:this})},_groupSelectedObjects:function(s){var o,n=this._collectObjects(s);1===n.length?this.setActiveObject(n[0],s):1<n.length&&(o=new fabric.ActiveSelection(n.reverse(),{canvas:this}),this.setActiveObject(o,s))},_collectObjects:function(s){for(var o,n=[],a=this._groupSelector.ex,l=this._groupSelector.ey,c=a+this._groupSelector.left,d=l+this._groupSelector.top,h=new fabric.Point(e(a,c),e(l,d)),p=new fabric.Point(t(a,c),t(l,d)),g=!this.selectionFullyContained,v=a===c&&l===d,r=this._objects.length;r--&&!((o=this._objects[r])&&o.selectable&&o.visible&&(g&&o.intersectsWithRect(h,p,!0)||o.isContainedWithinRect(h,p,!0)||g&&o.containsPoint(h,null,!0)||g&&o.containsPoint(p,null,!0))&&(n.push(o),v)););return 1<n.length&&(n=n.filter(function(u){return!u.onSelect({e:s})})),n},_maybeGroupObjects:function(s){this.selection&&this._groupSelector&&this._groupSelectedObjects(s),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",s=e.quality||1,o=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(o,e);return fabric.util.toDataURL(n,t,s)},toCanvasElement:function(e,t){var s=((t=t||{}).width||this.width)*(e=e||1),o=(t.height||this.height)*e,n=this.getZoom(),a=this.width,l=this.height,c=n*e,d=this.viewportTransform,g=this.interactive,v=[c,0,0,c,(d[4]-(t.left||0))*e,(d[5]-(t.top||0))*e],r=this.enableRetinaScaling,u=fabric.util.createCanvasElement(),f=this.contextTop;return u.width=s,u.height=o,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=s,this.height=o,this.calcViewportBoundaries(),this.renderCanvas(u.getContext("2d"),this._objects),this.viewportTransform=d,this.width=a,this.height=l,this.calcViewportBoundaries(),this.interactive=g,this.enableRetinaScaling=r,this.contextTop=f,u}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromJSON:function(e,t,s){if(e){var o="string"==typeof e?JSON.parse(e):fabric.util.object.clone(e),n=this,a=o.clipPath,l=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete o.clipPath,this._enlivenObjects(o.objects,function(c){n.clear(),n._setBgOverlay(o,function(){a?n._enlivenObjects([a],function(d){n.clipPath=d[0],n.__setupCanvas.call(n,o,c,l,t)}):n.__setupCanvas.call(n,o,c,l,t)})},s),this}},__setupCanvas:function(e,t,s,o){var n=this;t.forEach(function(a,l){n.insertAt(a,l)}),this.renderOnAddRemove=s,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),o&&o()},_setBgOverlay:function(e,t){var s={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var o=function(){s.backgroundImage&&s.overlayImage&&s.backgroundColor&&s.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",e.backgroundImage,s,o),this.__setBgOverlay("overlayImage",e.overlayImage,s,o),this.__setBgOverlay("backgroundColor",e.background,s,o),this.__setBgOverlay("overlayColor",e.overlay,s,o)}else t&&t()},__setBgOverlay:function(e,t,s,o){var n=this;if(!t)return s[e]=!0,void(o&&o());"backgroundImage"===e||"overlayImage"===e?fabric.util.enlivenObjects([t],function(a){n[e]=a[0],s[e]=!0,o&&o()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){s[e]=!0,o&&o()})},_enlivenObjects:function(e,t,s){e&&0!==e.length?fabric.util.enlivenObjects(e,function(o){t&&t(o)},null,s):t&&t([])},_toDataURL:function(e,t){this.clone(function(s){t(s.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,s){this.clone(function(o){s(o.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var s=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(o){o.loadFromJSON(s,function(){e&&e(o)})})},cloneWithoutData:function(e){var t=fabric.util.createCanvasElement();t.width=this.width,t.height=this.height;var s=new fabric.Canvas(t);this.backgroundImage?(s.setBackgroundImage(this.backgroundImage.src,function(){s.renderAll(),e&&e(s)}),s.backgroundImageOpacity=this.backgroundImageOpacity,s.backgroundImageStretch=this.backgroundImageStretch):e&&e(s)}}),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend,o=t.util.object.clone,n=t.util.toFixed,a=t.util.string.capitalize,l=t.util.degreesToRadians;t.Object||(t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!t.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(d){d&&this.setOptions(d)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(d){var h=t.perfLimitSizeTotal,p=d.width,g=d.height,v=t.maxCacheSideLimit,r=t.minCacheSideLimit;if(p<=v&&g<=v&&p*g<=h)return p<r&&(d.width=r),g<r&&(d.height=r),d;var f=t.util.limitDimsByArea(p/g,h),m=t.util.capValue,b=m(r,f.x,v),w=m(r,f.y,v);return b<p&&(d.zoomX/=p/b,d.width=b,d.capped=!0),w<g&&(d.zoomY/=g/w,d.height=w,d.capped=!0),d},_getCacheCanvasDimensions:function(){var d=this.getTotalObjectScaling(),h=this._getTransformedDimensions(0,0),p=h.x*d.scaleX/this.scaleX,g=h.y*d.scaleY/this.scaleY;return{width:p+2,height:g+2,zoomX:d.scaleX,zoomY:d.scaleY,x:p,y:g}},_updateCacheCanvas:function(){var d=this.canvas;if(this.noScaleCache&&d&&d._currentTransform){var p=d._currentTransform.action;if(this===d._currentTransform.target&&p.slice&&"scale"===p.slice(0,5))return!1}var g,v,r=this._cacheCanvas,u=this._limitCacheSize(this._getCacheCanvasDimensions()),f=t.minCacheSideLimit,m=u.width,b=u.height,w=u.zoomX,A=u.zoomY,x=m!==this.cacheWidth||b!==this.cacheHeight,S=x||this.zoomX!==w||this.zoomY!==A,_=0,C=0,I=!1;if(x){var L=this._cacheCanvas.width,D=this._cacheCanvas.height,O=L<m||D<b;I=O||(m<.9*L||b<.9*D)&&f<L&&f<D,O&&!u.capped&&(f<m||f<b)&&(_=.1*m,C=.1*b)}return this instanceof t.Text&&this.path&&(I=S=!0,_+=this.getHeightOfLine(0)*this.zoomX,C+=this.getHeightOfLine(0)*this.zoomY),!!S&&(I?(r.width=Math.ceil(m+_),r.height=Math.ceil(b+C)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,r.width,r.height)),g=u.x/2,v=u.y/2,this.cacheTranslationX=Math.round(r.width/2-g)+g,this.cacheTranslationY=Math.round(r.height/2-v)+v,this.cacheWidth=m,this.cacheHeight=b,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(w,A),this.zoomX=w,this.zoomY=A,!0)},setOptions:function(d){this._setOptions(d),this._initGradient(d.fill,"fill"),this._initGradient(d.stroke,"stroke"),this._initPattern(d.fill,"fill"),this._initPattern(d.stroke,"stroke")},transform:function(d){var p=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&d===this.canvas.contextTop));d.transform(p[0],p[1],p[2],p[3],p[4],p[5])},toObject:function(d){var h=t.Object.NUM_FRACTION_DIGITS,p={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:n(this.left,h),top:n(this.top,h),width:n(this.width,h),height:n(this.height,h),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,h),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:n(this.strokeMiterLimit,h),scaleX:n(this.scaleX,h),scaleY:n(this.scaleY,h),angle:n(this.angle,h),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,h),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:n(this.skewX,h),skewY:n(this.skewY,h)};return this.clipPath&&!this.clipPath.excludeFromExport&&(p.clipPath=this.clipPath.toObject(d),p.clipPath.inverted=this.clipPath.inverted,p.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,p,d),this.includeDefaultValues||(p=this._removeDefaultValues(p)),p},toDatalessObject:function(d){return this.toObject(d)},_removeDefaultValues:function(d){var h=t.util.getKlass(d.type).prototype;return h.stateProperties.forEach(function(p){"left"!==p&&"top"!==p&&(d[p]===h[p]&&delete d[p],Array.isArray(d[p])&&Array.isArray(h[p])&&0===d[p].length&&0===h[p].length&&delete d[p])}),d},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var d=t.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(d.scaleX),scaleY:Math.abs(d.scaleY)}},getTotalObjectScaling:function(){var d=this.getObjectScaling(),h=d.scaleX,p=d.scaleY;if(this.canvas){var g=this.canvas.getZoom(),v=this.canvas.getRetinaScaling();h*=g*v,p*=g*v}return{scaleX:h,scaleY:p}},getObjectOpacity:function(){var d=this.opacity;return this.group&&(d*=this.group.getObjectOpacity()),d},_set:function(d,h){var g=this[d]!==h,v=!1;return("scaleX"===d||"scaleY"===d)&&(h=this._constrainScale(h)),"scaleX"===d&&h<0?(this.flipX=!this.flipX,h*=-1):"scaleY"===d&&h<0?(this.flipY=!this.flipY,h*=-1):"shadow"!==d||!h||h instanceof t.Shadow?"dirty"===d&&this.group&&this.group.set("dirty",h):h=new t.Shadow(h),this[d]=h,g&&(v=this.group&&this.group.isOnACache(),-1<this.cacheProperties.indexOf(d)?(this.dirty=!0,v&&this.group.set("dirty",!0)):v&&-1<this.stateProperties.indexOf(d)&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(d){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(d.save(),this._setupCompositeOperation(d),this.drawSelectionBackground(d),this.transform(d),this._setOpacity(d),this._setShadow(d,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(d)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(d),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),d.restore())},renderCache:function(d){d=d||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,d.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(d,h){if(d.save(),d.globalCompositeOperation=h.inverted?"destination-out":"destination-in",h.absolutePositioned){var p=t.util.invertTransform(this.calcTransformMatrix());d.transform(p[0],p[1],p[2],p[3],p[4],p[5])}h.transform(d),d.scale(1/h.zoomX,1/h.zoomY),d.drawImage(h._cacheCanvas,-h.cacheTranslationX,-h.cacheTranslationY),d.restore()},drawObject:function(d,h){var p=this.fill,g=this.stroke;h?(this.fill="black",this.stroke="",this._setClippingProperties(d)):this._renderBackground(d),this._render(d),this._drawClipPath(d,this.clipPath),this.fill=p,this.stroke=g},_drawClipPath:function(d,h){h&&(h.canvas=this.canvas,h.shouldCache(),h._transformDone=!0,h.renderCache({forClipping:!0}),this.drawClipPathOnCache(d,h))},drawCacheOnCanvas:function(d){d.scale(1/this.zoomX,1/this.zoomY),d.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(d){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!d&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!d){var h=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-h/2,-p/2,h,p)}return!0}return!1},_renderBackground:function(d){if(this.backgroundColor){var h=this._getNonTransformedDimensions();d.fillStyle=this.backgroundColor,d.fillRect(-h.x/2,-h.y/2,h.x,h.y),this._removeShadow(d)}},_setOpacity:function(d){this.group&&!this.group._transformDone?d.globalAlpha=this.getObjectOpacity():d.globalAlpha*=this.opacity},_setStrokeStyles:function(d,h){var p=h.stroke;p&&(d.lineWidth=h.strokeWidth,d.lineCap=h.strokeLineCap,d.lineDashOffset=h.strokeDashOffset,d.lineJoin=h.strokeLineJoin,d.miterLimit=h.strokeMiterLimit,p.toLive?"percentage"===p.gradientUnits||p.gradientTransform||p.patternTransform?this._applyPatternForTransformedGradient(d,p):(d.strokeStyle=p.toLive(d,this),this._applyPatternGradientTransform(d,p)):d.strokeStyle=h.stroke)},_setFillStyles:function(d,h){var p=h.fill;p&&(p.toLive?(d.fillStyle=p.toLive(d,this),this._applyPatternGradientTransform(d,h.fill)):d.fillStyle=p)},_setClippingProperties:function(d){d.globalAlpha=1,d.strokeStyle="transparent",d.fillStyle="#000000"},_setLineDash:function(d,h){h&&0!==h.length&&(1&h.length&&h.push.apply(h,h),d.setLineDash(h))},_renderControls:function(d,h){var p,g,v,r=this.getViewportTransform(),u=this.calcTransformMatrix();g=void 0!==(h=h||{}).hasBorders?h.hasBorders:this.hasBorders,v=void 0!==h.hasControls?h.hasControls:this.hasControls,u=t.util.multiplyTransformMatrices(r,u),p=t.util.qrDecompose(u),d.save(),d.translate(p.translateX,p.translateY),d.lineWidth=1*this.borderScaleFactor,this.group||(d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(p.angle-=180),d.rotate(l(this.group?p.angle:this.angle)),h.forActiveSelection||this.group?g&&this.drawBordersInGroup(d,p,h):g&&this.drawBorders(d,h),v&&this.drawControls(d,h),d.restore()},_setShadow:function(d){if(this.shadow){var h,p=this.shadow,g=this.canvas,v=g&&g.viewportTransform[0]||1,r=g&&g.viewportTransform[3]||1;h=p.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),g&&g._isRetinaScaling()&&(v*=t.devicePixelRatio,r*=t.devicePixelRatio),d.shadowColor=p.color,d.shadowBlur=p.blur*t.browserShadowBlurConstant*(v+r)*(h.scaleX+h.scaleY)/4,d.shadowOffsetX=p.offsetX*v*h.scaleX,d.shadowOffsetY=p.offsetY*r*h.scaleY}},_removeShadow:function(d){this.shadow&&(d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0)},_applyPatternGradientTransform:function(d,h){if(!h||!h.toLive)return{offsetX:0,offsetY:0};var p=h.gradientTransform||h.patternTransform,g=-this.width/2+h.offsetX||0,v=-this.height/2+h.offsetY||0;return"percentage"===h.gradientUnits?d.transform(this.width,0,0,this.height,g,v):d.transform(1,0,0,1,g,v),p&&d.transform(p[0],p[1],p[2],p[3],p[4],p[5]),{offsetX:g,offsetY:v}},_renderPaintInOrder:function(d){"stroke"===this.paintFirst?(this._renderStroke(d),this._renderFill(d)):(this._renderFill(d),this._renderStroke(d))},_render:function(){},_renderFill:function(d){this.fill&&(d.save(),this._setFillStyles(d,this),"evenodd"===this.fillRule?d.fill("evenodd"):d.fill(),d.restore())},_renderStroke:function(d){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d),d.save(),this.strokeUniform&&this.group){var h=this.getObjectScaling();d.scale(1/h.scaleX,1/h.scaleY)}else this.strokeUniform&&d.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(d,this.strokeDashArray),this._setStrokeStyles(d,this),d.stroke(),d.restore()}},_applyPatternForTransformedGradient:function(d,h){var p,g=this._limitCacheSize(this._getCacheCanvasDimensions()),v=t.util.createCanvasElement(),r=this.canvas.getRetinaScaling(),u=g.x/this.scaleX/r,f=g.y/this.scaleY/r;v.width=u,v.height=f,(p=v.getContext("2d")).beginPath(),p.moveTo(0,0),p.lineTo(u,0),p.lineTo(u,f),p.lineTo(0,f),p.closePath(),p.translate(u/2,f/2),p.scale(g.zoomX/this.scaleX/r,g.zoomY/this.scaleY/r),this._applyPatternGradientTransform(p,h),p.fillStyle=h.toLive(d),p.fill(),d.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),d.scale(r*this.scaleX/g.zoomX,r*this.scaleY/g.zoomY),d.strokeStyle=p.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var d=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",d.scaleX),this.set("scaleY",d.scaleY),this.angle=d.angle,this.skewX=d.skewX,this.skewY=0}},_removeTransformMatrix:function(d){var h=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),h=t.util.transformPoint(h,this.transformMatrix)),this.transformMatrix=null,d&&(this.scaleX*=d.scaleX,this.scaleY*=d.scaleY,this.cropX=d.cropX,this.cropY=d.cropY,h.x+=d.offsetLeft,h.y+=d.offsetTop,this.width=d.width,this.height=d.height),this.setPositionByOrigin(h,"center","center")},clone:function(d,h){var p=this.toObject(h);this.constructor.fromObject?this.constructor.fromObject(p,d):t.Object._fromObject("Object",p,d)},cloneAsImage:function(d,h){var p=this.toCanvasElement(h);return d&&d(new t.Image(p)),this},toCanvasElement:function(d){d||(d={});var h=t.util,p=h.saveObjectTransform(this),g=this.group,v=this.shadow,r=Math.abs,u=(d.multiplier||1)*(d.enableRetinaScaling?t.devicePixelRatio:1);delete this.group,d.withoutTransform&&h.resetObjectTransform(this),d.withoutShadow&&(this.shadow=null);var f,m,w,A=t.util.createCanvasElement(),x=this.getBoundingRect(!0,!0),y=this.shadow,S={x:0,y:0};y&&(m=y.blur,f=y.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),S.x=2*Math.round(r(y.offsetX)+m)*r(f.scaleX),S.y=2*Math.round(r(y.offsetY)+m)*r(f.scaleY)),w=x.height+S.y,A.width=Math.ceil(x.width+S.x),A.height=Math.ceil(w);var _=new t.StaticCanvas(A,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===d.format&&(_.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(_.width/2,_.height/2),"center","center");var C=this.canvas;_.add(this);var I=_.toCanvasElement(u||1,d);return this.shadow=v,this.set("canvas",C),g&&(this.group=g),this.set(p).setCoords(),_._objects=[],_.dispose(),_=null,I},toDataURL:function(d){return d||(d={}),t.util.toDataURL(this.toCanvasElement(d),d.format||"png",d.quality||1)},isType:function(d){return 1<arguments.length?Array.from(arguments).includes(this.type):this.type===d},complexity:function(){return 1},toJSON:function(d){return this.toObject(d)},rotate:function(d){var h=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return h&&this._setOriginToCenter(),this.set("angle",d),h&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(d,h){h=h||this.canvas.getPointer(d);var p=new t.Point(h.x,h.y),g=this._getLeftTopCoords();return this.angle&&(p=t.util.rotatePoint(p,g,l(-this.angle))),{x:p.x-g.x,y:p.y-g.y}},_setupCompositeOperation:function(d){this.globalCompositeOperation&&(d.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){t.runningAnimations&&t.runningAnimations.cancelByTarget(this)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),s(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.ENLIVEN_PROPS=["clipPath"],t.Object._fromObject=function(d,h,p,g){var v=t[d];h=o(h,!0),t.util.enlivenPatterns([h.fill,h.stroke],function(r){void 0!==r[0]&&(h.fill=r[0]),void 0!==r[1]&&(h.stroke=r[1]),t.util.enlivenObjectEnlivables(h,h,function(){var u=g?new v(h[g],h):new v(h);p&&p(u)})})},t.Object.__uid=0)}(typeof exports<"u"?exports:this),function(){var e=fabric.util.degreesToRadians,t={left:-.5,center:0,right:.5},s={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(o,n,a,l,c){var d,h,p,g=o.x,v=o.y;return"string"==typeof n?n=t[n]:n-=.5,"string"==typeof l?l=t[l]:l-=.5,"string"==typeof a?a=s[a]:a-=.5,"string"==typeof c?c=s[c]:c-=.5,h=c-a,((d=l-n)||h)&&(p=this._getTransformedDimensions(),g=o.x+d*p.x,v=o.y+h*p.y),new fabric.Point(g,v)},translateToCenterPoint:function(o,n,a){var l=this.translateToGivenOrigin(o,n,a,"center","center");return this.angle?fabric.util.rotatePoint(l,o,e(this.angle)):l},translateToOriginPoint:function(o,n,a){var l=this.translateToGivenOrigin(o,"center","center",n,a);return this.angle?fabric.util.rotatePoint(l,o,e(this.angle)):l},getCenterPoint:function(){var o=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(o,this.originX,this.originY)},getPointByOrigin:function(o,n){var a=this.getCenterPoint();return this.translateToOriginPoint(a,o,n)},toLocalPoint:function(o,n,a){var l,c,d=this.getCenterPoint();return l=void 0!==n&&void 0!==a?this.translateToGivenOrigin(d,"center","center",n,a):new fabric.Point(this.left,this.top),c=new fabric.Point(o.x,o.y),this.angle&&(c=fabric.util.rotatePoint(c,d,-e(this.angle))),c.subtractEquals(l)},setPositionByOrigin:function(o,n,a){var l=this.translateToCenterPoint(o,n,a),c=this.translateToOriginPoint(l,this.originX,this.originY);this.set("left",c.x),this.set("top",c.y)},adjustPosition:function(o){var n,a,l=e(this.angle),c=this.getScaledWidth(),d=fabric.util.cos(l)*c,h=fabric.util.sin(l)*c;this.left+=d*((a="string"==typeof o?t[o]:o-.5)-(n="string"==typeof this.originX?t[this.originX]:this.originX-.5)),this.top+=h*(a-n),this.setCoords(),this.originX=o},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var o=this.getCenterPoint();this.originX="center",this.originY="center",this.left=o.x,this.top=o.y},_resetOrigin:function(){var o=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=o.x,this.top=o.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){var e=fabric.util,t=e.degreesToRadians,s=e.multiplyTransformMatrices,o=e.transformPoint;e.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(n,a){return a?n?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),n?this.aCoords:this.lineCoords)},getCoords:function(n,a){return l=this._getCoords(n,a),[new fabric.Point(l.tl.x,l.tl.y),new fabric.Point(l.tr.x,l.tr.y),new fabric.Point(l.br.x,l.br.y),new fabric.Point(l.bl.x,l.bl.y)];var l},intersectsWithRect:function(n,a,l,c){var d=this.getCoords(l,c);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(d,n,a).status},intersectsWithObject:function(n,a,l){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(a,l),n.getCoords(a,l)).status||n.isContainedWithinObject(this,a,l)||this.isContainedWithinObject(n,a,l)},isContainedWithinObject:function(n,a,l){for(var c=this.getCoords(a,l),h=0,p=n._getImageLines(a?n.aCoords:n.lineCoords);h<4;h++)if(!n.containsPoint(c[h],p))return!1;return!0},isContainedWithinRect:function(n,a,l,c){var d=this.getBoundingRect(l,c);return d.left>=n.x&&d.left+d.width<=a.x&&d.top>=n.y&&d.top+d.height<=a.y},containsPoint:function(n,a,l,c){var d=this._getCoords(l,c),h=(a=a||this._getImageLines(d),this._findCrossPoints(n,a));return 0!==h&&h%2==1},isOnScreen:function(n){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br;return!!this.getCoords(!0,n).some(function(c){return c.x<=l.x&&c.x>=a.x&&c.y<=l.y&&c.y>=a.y})||!!this.intersectsWithRect(a,l,!0,n)||this._containsCenterOfCanvas(a,l,n)},_containsCenterOfCanvas:function(n,a,l){return!!this.containsPoint({x:(n.x+a.x)/2,y:(n.y+a.y)/2},null,!0,l)},isPartiallyOnScreen:function(n){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br;return!!this.intersectsWithRect(a,l,!0,n)||this.getCoords(!0,n).every(function(c){return(c.x>=l.x||c.x<=a.x)&&(c.y>=l.y||c.y<=a.y)})&&this._containsCenterOfCanvas(a,l,n)},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_findCrossPoints:function(n,a){var l,c,d,h=0;for(var p in a)if(!((d=a[p]).o.y<n.y&&d.d.y<n.y||d.o.y>=n.y&&d.d.y>=n.y||(d.o.x===d.d.x&&d.o.x>=n.x?c=d.o.x:(l=(d.d.y-d.o.y)/(d.d.x-d.o.x),c=-(n.y-0*n.x-(d.o.y-l*d.o.x))/(0-l)),c>=n.x&&(h+=1),2!==h)))break;return h},getBoundingRect:function(n,a){var l=this.getCoords(n,a);return e.makeBoundingBoxFromPoints(l)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:0===n?1e-4:n},scale:function(n){return this._set("scaleX",n),this._set("scaleY",n),this.setCoords()},scaleToWidth:function(n,a){var l=this.getBoundingRect(a).width/this.getScaledWidth();return this.scale(n/this.width/l)},scaleToHeight:function(n,a){var l=this.getBoundingRect(a).height/this.getScaledHeight();return this.scale(n/this.height/l)},calcLineCoords:function(){var n=this.getViewportTransform(),a=this.padding,l=t(this.angle),c=e.cos(l)*a,d=e.sin(l)*a,h=c+d,p=c-d,g=this.calcACoords(),v={tl:o(g.tl,n),tr:o(g.tr,n),bl:o(g.bl,n),br:o(g.br,n)};return a&&(v.tl.x-=p,v.tl.y-=h,v.tr.x+=h,v.tr.y-=p,v.bl.x-=h,v.bl.y+=p,v.br.x+=p,v.br.y+=h),v},calcOCoords:function(){var n=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),l=this.getViewportTransform(),c=s(l,a),d=s(c,n),h=(d=s(d,[1/l[0],0,0,1/l[3],0,0]),this._calculateCurrentDimensions()),p={};return this.forEachControl(function(g,v,r){p[v]=g.positionHandler(h,d,r)}),p},calcACoords:function(){var n=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),l=s(a,n),c=this._getTransformedDimensions(),d=c.x/2,h=c.y/2;return{tl:o({x:-d,y:-h},l),tr:o({x:d,y:-h},l),bl:o({x:-d,y:h},l),br:o({x:d,y:h},l)}},setCoords:function(n){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),n||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return e.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var n=this.getCenterPoint();return[1,0,0,1,n.x,n.y]},transformMatrixKey:function(n){var a="_",l="";return!n&&this.group&&(l=this.group.transformMatrixKey(n)+a),l+this.top+a+this.left+a+this.scaleX+a+this.scaleY+a+this.skewX+a+this.skewY+a+this.angle+a+this.originX+a+this.originY+a+this.width+a+this.height+a+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(n){var a=this.calcOwnMatrix();if(n||!this.group)return a;var l=this.transformMatrixKey(n),c=this.matrixCache||(this.matrixCache={});return c.key===l?c.value:(this.group&&(a=s(this.group.calcTransformMatrix(!1),a)),c.key=l,c.value=a)},calcOwnMatrix:function(){var n=this.transformMatrixKey(!0),a=this.ownMatrixCache||(this.ownMatrixCache={});if(a.key===n)return a.value;var l=this._calcTranslateMatrix(),c={angle:this.angle,translateX:l[4],translateY:l[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return a.key=n,a.value=e.composeMatrix(c),a.value},_getNonTransformedDimensions:function(){var n=this.strokeWidth;return{x:this.width+n,y:this.height+n}},_getTransformedDimensions:function(n,a){void 0===n&&(n=this.skewX),void 0===a&&(a=this.skewY);var l,c,d,h=0===n&&0===a;if(this.strokeUniform?(c=this.width,d=this.height):(c=(l=this._getNonTransformedDimensions()).x,d=l.y),h)return this._finalizeDimensions(c*this.scaleX,d*this.scaleY);var p=e.sizeAfterTransform(c,d,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:n,skewY:a});return this._finalizeDimensions(p.x,p.y)},_finalizeDimensions:function(n,a){return this.strokeUniform?{x:n+this.strokeWidth,y:a+this.strokeWidth}:{x:n,y:a}},_calculateCurrentDimensions:function(){var n=this.getViewportTransform(),a=this._getTransformedDimensions();return o(a,n,!0).scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}}),function(){function e(s,o){if(o){if(o.toLive)return s+": url(#SVGID_"+o.id+"); ";var n=new fabric.Color(o),a=s+": "+n.toRgb()+"; ",l=n.getAlpha();return 1!==l&&(a+=s+"-opacity: "+l.toString()+"; "),a}return s+": none; "}var t=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(s){var o=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",l=this.strokeDashOffset?this.strokeDashOffset:"0",c=this.strokeLineCap?this.strokeLineCap:"butt",d=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",p=void 0!==this.opacity?this.opacity:"1",g=this.visible?"":" visibility: hidden;",v=s?"":this.getSvgFilter(),r=e("fill",this.fill);return[e("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",c,"; ","stroke-dashoffset: ",l,"; ","stroke-linejoin: ",d,"; ","stroke-miterlimit: ",h,"; ",r,"fill-rule: ",o,"; ","opacity: ",p,";",v,g].join("")},getSvgSpanStyles:function(s,o){var n="; ",a=s.fontFamily?"font-family: "+(-1===s.fontFamily.indexOf("'")&&-1===s.fontFamily.indexOf('"')?"'"+s.fontFamily+"'":s.fontFamily)+n:"",l=s.strokeWidth?"stroke-width: "+s.strokeWidth+n:"",c=s.fontSize?"font-size: "+s.fontSize+"px"+n:"",d=s.fontStyle?"font-style: "+s.fontStyle+n:"",h=s.fontWeight?"font-weight: "+s.fontWeight+n:"",p=s.fill?e("fill",s.fill):"",g=s.stroke?e("stroke",s.stroke):"",v=this.getSvgTextDecoration(s);return v&&(v="text-decoration: "+v+n),[g,l,a,c,d,h,v,p,s.deltaY?"baseline-shift: "+-s.deltaY+"; ":"",o?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(s){return["overline","underline","line-through"].filter(function(o){return s[o.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(s,o){var n=s?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+fabric.util.matrixToSVG(n)+(o||"")+'" '},_setSVGBg:function(s){if(this.backgroundColor){var o=fabric.Object.NUM_FRACTION_DIGITS;s.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,o),'" y="',t(-this.height/2,o),'" width="',t(this.width,o),'" height="',t(this.height,o),'"></rect>\n')}},toSVG:function(s){return this._createBaseSVGMarkup(this._toSVG(s),{reviver:s})},toClipPathSVG:function(s){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(s),{reviver:s})},_createBaseClipPathSVGMarkup:function(s,o){var n=(o=o||{}).reviver,l=[this.getSvgTransform(!0,o.additionalTransform||""),this.getSvgCommons()].join(""),c=s.indexOf("COMMON_PARTS");return s[c]=l,n?n(s.join("")):s.join("")},_createBaseSVGMarkup:function(s,o){var n,a,l=(o=o||{}).noStyle,c=o.reviver,d=l?"":'style="'+this.getSvgStyles()+'" ',h=o.withShadow?'style="'+this.getSvgFilter()+'" ':"",p=this.clipPath,g=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",v=p&&p.absolutePositioned,r=this.stroke,u=this.fill,f=this.shadow,m=[],b=s.indexOf("COMMON_PARTS"),w=o.additionalTransform;return p&&(p.clipPathId="CLIPPATH_"+fabric.Object.__uid++,a='<clipPath id="'+p.clipPathId+'" >\n'+p.toClipPathSVG(c)+"</clipPath>\n"),v&&m.push("<g ",h,this.getSvgCommons()," >\n"),m.push("<g ",this.getSvgTransform(!1),v?"":h+this.getSvgCommons()," >\n"),n=[d,g,l?"":this.addPaintOrder()," ",w?'transform="'+w+'" ':""].join(""),s[b]=n,u&&u.toLive&&m.push(u.toSVG(this)),r&&r.toLive&&m.push(r.toSVG(this)),f&&m.push(f.toSVG(this)),p&&m.push(a),m.push(s.join("")),m.push("</g>\n"),v&&m.push("</g>\n"),c?c(m.join("")):m.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var e=fabric.util.object.extend,t="stateProperties";function s(o,n,a){var l={};a.forEach(function(c){l[c]=o[c]}),e(o[n],l,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(o){var n="_"+(o=o||t);return Object.keys(this[n]).length<this[o].length||!function a(l,c,d){if(l===c)return!0;if(Array.isArray(l)){if(!Array.isArray(c)||l.length!==c.length)return!1;for(var h=0,p=l.length;h<p;h++)if(!a(l[h],c[h]))return!1;return!0}if(l&&"object"==typeof l){var g,v=Object.keys(l);if(!c||"object"!=typeof c||!d&&v.length!==Object.keys(c).length)return!1;for(h=0,p=v.length;h<p;h++)if("canvas"!==(g=v[h])&&"group"!==g&&!a(l[g],c[g]))return!1;return!0}}(this[n],this,!0)},saveState:function(o){var n=o&&o.propertySet||t,a="_"+n;return this[a]?(s(this,a,this[n]),o&&o.stateProperties&&s(this,a,o.stateProperties),this):this.setupState(o)},setupState:function(o){var n=(o=o||{}).propertySet||t;return this["_"+(o.propertySet=n)]={},this.saveState(o),this}})}(),function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(t,s){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var o,n,a,l=t.x,c=t.y,d=Object.keys(this.oCoords),h=d.length-1;for(this.__corner=0;0<=h;h--)if(this.isControlVisible(a=d[h])&&(n=this._getImageLines(s?this.oCoords[a].touchCorner:this.oCoords[a].corner),0!==(o=this._findCrossPoints({x:l,y:c},n))&&o%2==1))return this.__corner=a;return!1},forEachControl:function(t){for(var s in this.controls)t(this.controls[s],s,this)},_setCornerCoords:function(){var t=this.oCoords;for(var s in t){var o=this.controls[s];t[s].corner=o.calcCornerCoords(this.angle,this.cornerSize,t[s].x,t[s].y,!1),t[s].touchCorner=o.calcCornerCoords(this.angle,this.touchCornerSize,t[s].x,t[s].y,!0)}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var s=this.getCenterPoint(),o=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return t.translate(s.x,s.y),t.scale(1/n[0],1/n[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-o.x/2,-o.y/2,o.x,o.y),t.restore(),this},drawBorders:function(t,s){s=s||{};var o=this._calculateCurrentDimensions(),n=this.borderScaleFactor,a=o.x+n,l=o.y+n,c=void 0!==s.hasControls?s.hasControls:this.hasControls,d=!1;return t.save(),t.strokeStyle=s.borderColor||this.borderColor,this._setLineDash(t,s.borderDashArray||this.borderDashArray),t.strokeRect(-a/2,-l/2,a,l),c&&(t.beginPath(),this.forEachControl(function(h,p,g){h.withConnection&&h.getVisibility(g,p)&&(d=!0,t.moveTo(h.x*a,h.y*l),t.lineTo(h.x*a+h.offsetX,h.y*l+h.offsetY))}),d&&t.stroke()),t.restore(),this},drawBordersInGroup:function(t,s,o){o=o||{};var n=fabric.util.sizeAfterTransform(this.width,this.height,s),a=this.strokeWidth,l=this.strokeUniform,c=this.borderScaleFactor,d=n.x+a*(l?this.canvas.getZoom():s.scaleX)+c,h=n.y+a*(l?this.canvas.getZoom():s.scaleY)+c;return t.save(),this._setLineDash(t,o.borderDashArray||this.borderDashArray),t.strokeStyle=o.borderColor||this.borderColor,t.strokeRect(-d/2,-h/2,d,h),t.restore(),this},drawControls:function(t,s){s=s||{},t.save();var o,n,a=this.canvas.getRetinaScaling();return t.setTransform(a,0,0,a,0,0),t.strokeStyle=t.fillStyle=s.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=s.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,s.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(o=this.group.calcTransformMatrix()),this.forEachControl(function(l,c,d){n=d.oCoords[c],l.getVisibility(d,c)&&(o&&(n=fabric.util.transformPoint(n,o)),l.render(t,n.x,n.y,s,d))}),t.restore(),this},isControlVisible:function(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)},setControlVisible:function(t,s){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=s,this},setControlsVisibility:function(t){for(var s in t||(t={}),t)this.setControlVisible(s,t[s]);return this},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){var s=function(){},o=(t=t||{}).onComplete||s,n=t.onChange||s,a=this;return fabric.util.animate({target:this,startValue:e.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(l){e.set("left",l),a.requestRenderAll(),n()},onComplete:function(){e.setCoords(),o()}})},fxCenterObjectV:function(e,t){var s=function(){},o=(t=t||{}).onComplete||s,n=t.onChange||s,a=this;return fabric.util.animate({target:this,startValue:e.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(l){e.set("top",l),a.requestRenderAll(),n()},onComplete:function(){e.setCoords(),o()}})},fxRemove:function(e,t){var s=function(){},o=(t=t||{}).onComplete||s,n=t.onChange||s,a=this;return fabric.util.animate({target:this,startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(l){e.set("opacity",l),a.requestRenderAll(),n()},onComplete:function(){a.remove(e),o()}})}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var e,s=[],o=[];for(e in arguments[0])s.push(e);for(var n=0,a=s.length;n<a;n++)o.push(this._animate(e=s[n],arguments[0][e],arguments[1],n!==a-1));return o}return this._animate.apply(this,arguments)},_animate:function(e,t,s,o){var n,a=this;t=t.toString(),s=s?fabric.util.object.clone(s):{},~e.indexOf(".")&&(n=e.split("."));var l=-1<a.colorProperties.indexOf(e)||n&&-1<a.colorProperties.indexOf(n[1]),c=n?this.get(n[0])[n[1]]:this.get(e);"from"in s||(s.from=c),l||(t=~t.indexOf("=")?c+parseFloat(t.replace("=","")):parseFloat(t));var d={target:this,startValue:s.from,endValue:t,byValue:s.by,easing:s.easing,duration:s.duration,abort:s.abort&&function(h,p,g){return s.abort.call(a,h,p,g)},onChange:function(h,p,g){n?a[n[0]][n[1]]=h:a.set(e,h),o||s.onChange&&s.onChange(h,p,g)},onComplete:function(h,p,g){o||(a.setCoords(),s.onComplete&&s.onComplete(h,p,g))}};return l?fabric.util.animateColor(d.startValue,d.endValue,d.duration,d):fabric.util.animate(d)}}),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend,o=t.util.object.clone,n={x1:1,x2:1,y1:1,y2:1};function a(l,c){var d=l.origin,h=l.axis1,p=l.axis2,g=l.dimension,v=c.nearest,r=c.center,u=c.farthest;return function(){switch(this.get(d)){case v:return Math.min(this.get(h),this.get(p));case r:return Math.min(this.get(h),this.get(p))+.5*this.get(g);case u:return Math.max(this.get(h),this.get(p))}}}t.Line?t.warn("fabric.Line is already defined"):(t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(l,c){l||(l=[0,0,0,0]),this.callSuper("initialize",c),this.set("x1",l[0]),this.set("y1",l[1]),this.set("x2",l[2]),this.set("y2",l[3]),this._setWidthHeight(c)},_setWidthHeight:function(l){l||(l={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in l?l.left:this._getLeftToOriginX(),this.top="top"in l?l.top:this._getTopToOriginY()},_set:function(l,c){return this.callSuper("_set",l,c),void 0!==n[l]&&this._setWidthHeight(),this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(l){l.beginPath();var c=this.calcLinePoints();l.moveTo(c.x1,c.y1),l.lineTo(c.x2,c.y2),l.lineWidth=this.strokeWidth;var d=l.strokeStyle;l.strokeStyle=this.stroke||l.fillStyle,this.stroke&&this._renderStroke(l),l.strokeStyle=d},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(l){return s(this.callSuper("toObject",l),this.calcLinePoints())},_getNonTransformedDimensions:function(){var l=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(l.y-=this.strokeWidth),0===this.height&&(l.x-=this.strokeWidth)),l},calcLinePoints:function(){var l=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1;return{x1:l*this.width*.5,x2:l*this.width*-.5,y1:c*this.height*.5,y2:c*this.height*-.5}},_toSVG:function(){var l=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',l.x1,'" y1="',l.y1,'" x2="',l.x2,'" y2="',l.y2,'" />\n']}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(l,c,d){d=d||{};var h=t.parseAttributes(l,t.Line.ATTRIBUTE_NAMES);c(new t.Line([h.x1||0,h.y1||0,h.x2||0,h.y2||0],s(h,d)))},t.Line.fromObject=function(l,c){var d=o(l,!0);d.points=[l.x1,l.y1,l.x2,l.y2],t.Object._fromObject("Line",d,function(h){delete h.points,c&&c(h)},"points")})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.degreesToRadians;t.Circle?t.warn("fabric.Circle is already defined."):(t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(o,n){return this.callSuper("_set",o,n),"radius"===o&&this.setRadius(n),this},toObject:function(o){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(o))},_toSVG:function(){var o,n=(this.endAngle-this.startAngle)%360;if(0===n)o=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var a=s(this.startAngle),l=s(this.endAngle),c=this.radius;o=['<path d="M '+t.util.cos(a)*c+" "+t.util.sin(a)*c," A "+c+" "+c," 0 ",+(180<n?"1":"0")+" 1"," "+t.util.cos(l)*c+" "+t.util.sin(l)*c,'" ',"COMMON_PARTS"," />\n"]}return o},_render:function(o){o.beginPath(),o.arc(0,0,this.radius,s(this.startAngle),s(this.endAngle),!1),this._renderPaintInOrder(o)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(o){return this.radius=o,this.set("width",2*o).set("height",2*o)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(o,n){var a,l=t.parseAttributes(o,t.Circle.ATTRIBUTE_NAMES);if(!("radius"in(a=l)&&0<=a.radius))throw new Error("value of `r` attribute is required and can not be negative");l.left=(l.left||0)-l.radius,l.top=(l.top||0)-l.radius,n(new t.Circle(l))},t.Circle.fromObject=function(o,n){t.Object._fromObject("Circle",o,n)})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Triangle?t.warn("fabric.Triangle is already defined"):(t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(s){var o=this.width/2,n=this.height/2;s.beginPath(),s.moveTo(-o,n),s.lineTo(0,-n),s.lineTo(o,n),s.closePath(),this._renderPaintInOrder(s)},_toSVG:function(){var s=this.width/2,o=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-s+" "+o,"0 "+-o,s+" "+o].join(","),'" />']}}),t.Triangle.fromObject=function(s,o){return t.Object._fromObject("Triangle",s,o)})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=2*Math.PI;t.Ellipse?t.warn("fabric.Ellipse is already defined."):(t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(o){this.callSuper("initialize",o),this.set("rx",o&&o.rx||0),this.set("ry",o&&o.ry||0)},_set:function(o,n){switch(this.callSuper("_set",o,n),o){case"rx":this.rx=n,this.set("width",2*n);break;case"ry":this.ry=n,this.set("height",2*n)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(o){return this.callSuper("toObject",["rx","ry"].concat(o))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(o){o.beginPath(),o.save(),o.transform(1,0,0,this.ry/this.rx,0,0),o.arc(0,0,this.rx,0,s,!1),o.restore(),this._renderPaintInOrder(o)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(o,n){var a=t.parseAttributes(o,t.Ellipse.ATTRIBUTE_NAMES);a.left=(a.left||0)-a.rx,a.top=(a.top||0)-a.ry,n(new t.Ellipse(a))},t.Ellipse.fromObject=function(o,n){t.Object._fromObject("Ellipse",o,n)})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend;t.Rect?t.warn("fabric.Rect is already defined"):(t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(o){this.callSuper("initialize",o),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(o){var n=this.rx?Math.min(this.rx,this.width/2):0,a=this.ry?Math.min(this.ry,this.height/2):0,l=this.width,c=this.height,d=-this.width/2,h=-this.height/2,p=0!==n||0!==a,g=.4477152502;o.beginPath(),o.moveTo(d+n,h),o.lineTo(d+l-n,h),p&&o.bezierCurveTo(d+l-g*n,h,d+l,h+g*a,d+l,h+a),o.lineTo(d+l,h+c-a),p&&o.bezierCurveTo(d+l,h+c-g*a,d+l-g*n,h+c,d+l-n,h+c),o.lineTo(d+n,h+c),p&&o.bezierCurveTo(d+g*n,h+c,d,h+c-g*a,d,h+c-a),o.lineTo(d,h+a),p&&o.bezierCurveTo(d,h+g*a,d+g*n,h,d+n,h),o.closePath(),this._renderPaintInOrder(o)},toObject:function(o){return this.callSuper("toObject",["rx","ry"].concat(o))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(o,n,a){if(!o)return n(null);a=a||{};var l=t.parseAttributes(o,t.Rect.ATTRIBUTE_NAMES);l.left=l.left||0,l.top=l.top||0,l.height=l.height||0,l.width=l.width||0;var c=new t.Rect(s(a?t.util.object.clone(a):{},l));c.visible=c.visible&&0<c.width&&0<c.height,n(c)},t.Rect.fromObject=function(o,n){return t.Object._fromObject("Rect",o,n)})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend,o=t.util.array.min,n=t.util.array.max,a=t.util.toFixed,l=t.util.projectStrokeOnPoints;t.Polyline?t.warn("fabric.Polyline is already defined"):(t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(c,d){d=d||{},this.points=c||[],this.callSuper("initialize",d),this._setPositionDimensions(d)},_projectStrokeOnPoints:function(){return l(this.points,this,!0)},_setPositionDimensions:function(c){var d,h=this._calcDimensions(c),p=this.exactBoundingBox?this.strokeWidth:0;this.width=h.width-p,this.height=h.height-p,c.fromSVG||(d=this.translateToGivenOrigin({x:h.left-this.strokeWidth/2+p/2,y:h.top-this.strokeWidth/2+p/2},"left","top",this.originX,this.originY)),void 0===c.left&&(this.left=c.fromSVG?h.left:d.x),void 0===c.top&&(this.top=c.fromSVG?h.top:d.y),this.pathOffset={x:h.left+this.width/2+p/2,y:h.top+this.height/2+p/2}},_calcDimensions:function(){var c=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,d=o(c,"x")||0,h=o(c,"y")||0;return{left:d,top:h,width:(n(c,"x")||0)-d,height:(n(c,"y")||0)-h}},toObject:function(c){return s(this.callSuper("toObject",c),{points:this.points.concat()})},_toSVG:function(){for(var c=[],d=this.pathOffset.x,h=this.pathOffset.y,p=t.Object.NUM_FRACTION_DIGITS,g=0,v=this.points.length;g<v;g++)c.push(a(this.points[g].x-d,p),",",a(this.points[g].y-h,p)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',c.join(""),'" />\n']},commonRender:function(c){var d,h=this.points.length,p=this.pathOffset.x,g=this.pathOffset.y;if(!h||isNaN(this.points[h-1].y))return!1;c.beginPath(),c.moveTo(this.points[0].x-p,this.points[0].y-g);for(var v=0;v<h;v++)c.lineTo((d=this.points[v]).x-p,d.y-g);return!0},_render:function(c){this.commonRender(c)&&this._renderPaintInOrder(c)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(c){return function(d,h,p){if(!d)return h(null);p||(p={});var g=t.parsePointsAttribute(d.getAttribute("points")),v=t.parseAttributes(d,t[c].ATTRIBUTE_NAMES);v.fromSVG=!0,h(new t[c](g,s(v,p)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(c,d){return t.Object._fromObject("Polyline",c,d,"points")})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.projectStrokeOnPoints;t.Polygon?t.warn("fabric.Polygon is already defined"):(t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return s(this.points,this)},_render:function(o){this.commonRender(o)&&(o.closePath(),this._renderPaintInOrder(o))}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(o,n){t.Object._fromObject("Polygon",o,n,"points")})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.array.min,o=t.util.array.max,n=t.util.object.extend,a=t.util.object.clone,l=t.util.toFixed;t.Path?t.warn("fabric.Path is already defined"):(t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(c,d){delete(d=a(d||{})).path,this.callSuper("initialize",d),this._setPath(c||[],d)},_setPath:function(c,d){this.path=t.util.makePathSimpler(Array.isArray(c)?c:t.util.parsePath(c)),t.Polyline.prototype._setPositionDimensions.call(this,d||{})},_renderPathCommands:function(c){var d,h=0,p=0,g=0,v=0,f=-this.pathOffset.x,m=-this.pathOffset.y;c.beginPath();for(var b=0,w=this.path.length;b<w;++b)switch((d=this.path[b])[0]){case"L":c.lineTo((g=d[1])+f,(v=d[2])+m);break;case"M":h=g=d[1],p=v=d[2],c.moveTo(g+f,v+m);break;case"C":c.bezierCurveTo(d[1]+f,d[2]+m,d[3]+f,d[4]+m,(g=d[5])+f,(v=d[6])+m);break;case"Q":c.quadraticCurveTo(d[1]+f,d[2]+m,d[3]+f,d[4]+m),g=d[3],v=d[4];break;case"z":case"Z":g=h,v=p,c.closePath()}},_render:function(c){this._renderPathCommands(c),this._renderPaintInOrder(c)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(c){return n(this.callSuper("toObject",c),{path:this.path.map(function(d){return d.slice()})})},toDatalessObject:function(c){var d=this.toObject(["sourcePath"].concat(c));return d.sourcePath&&delete d.path,d},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',t.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var c=t.Object.NUM_FRACTION_DIGITS;return" translate("+l(-this.pathOffset.x,c)+", "+l(-this.pathOffset.y,c)+")"},toClipPathSVG:function(c){var d=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:c,additionalTransform:d})},toSVG:function(c){var d=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:c,additionalTransform:d})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var c,d,h=[],p=[],g=0,v=0,r=0,u=0,f=0,m=this.path.length;f<m;++f){switch((c=this.path[f])[0]){case"L":r=c[1],u=c[2],d=[];break;case"M":g=r=c[1],v=u=c[2],d=[];break;case"C":d=t.util.getBoundsOfCurve(r,u,c[1],c[2],c[3],c[4],c[5],c[6]),r=c[5],u=c[6];break;case"Q":d=t.util.getBoundsOfCurve(r,u,c[1],c[2],c[1],c[2],c[3],c[4]),r=c[3],u=c[4];break;case"z":case"Z":r=g,u=v}d.forEach(function(A){h.push(A.x),p.push(A.y)}),h.push(r),p.push(u)}var b=s(h)||0,w=s(p)||0;return{left:b,top:w,width:(o(h)||0)-b,height:(o(p)||0)-w}}}),t.Path.fromObject=function(c,d){"string"==typeof c.sourcePath?t.loadSVGFromURL(c.sourcePath,function(p){var g=p[0];g.setOptions(c),d&&d(g)}):t.Object._fromObject("Path",c,d,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(c,d,h){var p=t.parseAttributes(c,t.Path.ATTRIBUTE_NAMES);p.fromSVG=!0,d(new t.Path(p.d,n(p,h)))})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.array.min,o=t.util.array.max;t.Group||(t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,a,l){a=a||{},this._objects=[],l&&this.callSuper("initialize",a),this._objects=n||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;if(l)this._updateObjectsACoords();else{var d=a&&a.centerPoint;void 0!==a.originX&&(this.originX=a.originX),void 0!==a.originY&&(this.originY=a.originY),d||this._calcBounds(),this._updateObjectsCoords(d),delete a.centerPoint,this.callSuper("initialize",a)}this.setCoords()},_updateObjectsACoords:function(){for(var n=this._objects.length;n--;)this._objects[n].setCoords(!0)},_updateObjectsCoords:function(n){n=n||this.getCenterPoint();for(var a=this._objects.length;a--;)this._updateObjectCoords(this._objects[a],n)},_updateObjectCoords:function(n,a){n.set({left:n.left-a.x,top:n.top-a.y}),n.group=this,n.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){var a=!!this.group;return this._restoreObjectsState(),t.util.resetObjectTransform(this),n&&(a&&t.util.removeTransformFromObject(n,this.group.calcTransformMatrix()),this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,a?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(n){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0,n.group=this,n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0,delete n.group},_set:function(n,a){var l=this._objects.length;if(this.useSetOnGroup)for(;l--;)this._objects[l].setOnGroup(n,a);if("canvas"===n)for(;l--;)this._objects[l]._set(n,a);t.Object.prototype._set.call(this,n,a)},toObject:function(n){var a=this.includeDefaultValues,l=this._objects.filter(function(d){return!d.excludeFromExport}).map(function(d){var h=d.includeDefaultValues;d.includeDefaultValues=a;var p=d.toObject(n);return d.includeDefaultValues=h,p}),c=t.Object.prototype.toObject.call(this,n);return c.objects=l,c},toDatalessObject:function(n){var a,l=this.sourcePath;if(l)a=l;else{var c=this.includeDefaultValues;a=this._objects.map(function(h){var p=h.includeDefaultValues;h.includeDefaultValues=c;var g=h.toDatalessObject(n);return h.includeDefaultValues=p,g})}var d=t.Object.prototype.toDatalessObject.call(this,n);return d.objects=a,d},render:function(n){this._transformDone=!0,this.callSuper("render",n),this._transformDone=!1},shouldCache:function(){var n=t.Object.prototype.shouldCache.call(this);if(n)for(var a=0,l=this._objects.length;a<l;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1;return n},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var n=0,a=this._objects.length;n<a;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var a=0,l=this._objects.length;a<l;a++)this._objects[a].render(n);this._drawClipPath(n,this.clipPath)},isCacheDirty:function(n){if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(var a=0,l=this._objects.length;a<l;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var c=this.cacheWidth/this.zoomX,d=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-c/2,-d/2,c,d)}return!0}return!1},_restoreObjectsState:function(){var n=this.calcOwnMatrix();return this._objects.forEach(function(a){t.util.addTransformToObject(a,n),delete a.group,a.setCoords()}),this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(n){n.dispose&&n.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var n=this._objects,a=this.canvas;this._objects=[];var l=this.toObject();delete l.objects;var c=new t.ActiveSelection([]);return c.set(l),c.type="activeSelection",a.remove(this),n.forEach(function(d){d.group=c,d.dirty=!0,a.add(d)}),c.canvas=a,c._objects=n,(a._activeObject=c).setCoords(),c}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(n){n.setCoords(!0)}),this},_calcBounds:function(n){for(var a,l,c,d,h=[],p=[],g=["tr","br","bl","tl"],v=0,r=this._objects.length,u=g.length;v<r;++v){for(c=(a=this._objects[v]).calcACoords(),d=0;d<u;d++)h.push(c[l=g[d]].x),p.push(c[l].y);a.aCoords=c}this._getBounds(h,p,n)},_getBounds:function(n,a,l){var c=new t.Point(s(n),s(a)),d=new t.Point(o(n),o(a)),h=c.y||0,p=c.x||0,v=d.y-c.y||0;this.width=d.x-c.x||0,this.height=v,l||this.setPositionByOrigin({x:p,y:h},"left","top")},_toSVG:function(n){for(var a=["<g ","COMMON_PARTS"," >\n"],l=0,c=this._objects.length;l<c;l++)a.push("\t\t",this._objects[l].toSVG(n));return a.push("</g>\n"),a},getSvgStyles:function(){var a=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),a].join("")},toClipPathSVG:function(n){for(var a=[],l=0,c=this._objects.length;l<c;l++)a.push("\t",this._objects[l].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(a,{reviver:n})}}),t.Group.fromObject=function(n,a){var l=n.objects,c=t.util.object.clone(n,!0);delete c.objects,"string"!=typeof l?t.util.enlivenObjects(l,function(d){var h=t.util.object.clone(n,!0);delete h.objects,t.util.enlivenObjectEnlivables(n,h,function(){a&&a(new t.Group(d,h,!0))})}):t.loadSVGFromURL(l,function(d){var h=t.util.groupSVGElements(d,n,l);h.set(c),a&&a(h)})})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.ActiveSelection||(t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(s,o){o=o||{},this._objects=s||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;o.originX&&(this.originX=o.originX),o.originY&&(this.originY=o.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,o),this.setCoords()},toGroup:function(){var s=this._objects.concat();this._objects=[];var o=t.Object.prototype.toObject.call(this),n=new t.Group([]);if(delete o.type,n.set(o),s.forEach(function(l){l.canvas.remove(l),l.group=n}),n._objects=s,!this.canvas)return n;var a=this.canvas;return a.add(n),(a._activeObject=n).setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(s,o,n){s.save(),s.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",s,o),void 0===(n=n||{}).hasControls&&(n.hasControls=!1),n.forActiveSelection=!0;for(var a=0,l=this._objects.length;a<l;a++)this._objects[a]._renderControls(s,n);s.restore()}}),t.ActiveSelection.fromObject=function(s,o){t.util.enlivenObjects(s.objects,function(n){delete s.objects,o&&o(new t.ActiveSelection(n,s,!0))})})}(typeof exports<"u"?exports:this),function(e){"use strict";var t=fabric.util.object.extend;e.fabric||(e.fabric={}),e.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:fabric.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(s,o){o||(o={}),this.filters=[],this.cacheKey="texture"+fabric.Object.__uid++,this.callSuper("initialize",o),this._initElement(s,o)},getElement:function(){return this._element||{}},setElement:function(s,o){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=s,this._originalElement=s,this._initConfig(o),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(s){var o=fabric.filterBackend;o&&o.evictCachesForKey&&o.evictCachesForKey(s)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(s){fabric.util.cleanUpJsdomNode(this[s]),this[s]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var s=this.getElement();return{width:s.naturalWidth||s.width,height:s.naturalHeight||s.height}},_stroke:function(s){if(this.stroke&&0!==this.strokeWidth){var o=this.width/2,n=this.height/2;s.beginPath(),s.moveTo(-o,-n),s.lineTo(o,-n),s.lineTo(o,n),s.lineTo(-o,n),s.lineTo(-o,-n),s.closePath()}},toObject:function(s){var o=[];this.filters.forEach(function(a){a&&o.push(a.toObject())});var n=t(this.callSuper("toObject",["cropX","cropY"].concat(s)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:o});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var s,o=[],n=[],a=this._element,l=-this.width/2,c=-this.height/2,d="",h="";if(!a)return[];if(this.hasCrop()){var p=fabric.Object.__uid++;o.push('<clipPath id="imageCrop_'+p+'">\n','\t<rect x="'+l+'" y="'+c+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),d=' clip-path="url(#imageCrop_'+p+')" '}if(this.imageSmoothing||(h='" image-rendering="optimizeSpeed'),n.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',l-this.cropX,'" y="',c-this.cropY,'" width="',a.width||a.naturalWidth,'" height="',a.height||a.height,h,'"',d,"></image>\n"),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,s=["\t<rect ",'x="',l,'" y="',c,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=g}return"fill"!==this.paintFirst?o.concat(s,n):o.concat(n,s)},getSrc:function(s){var o=s?this._element:this._originalElement;return o?o.toDataURL?o.toDataURL():this.srcFromAttribute?o.getAttribute("src"):o.src:this.src||""},setSrc:function(s,o,n){return fabric.util.loadImage(s,function(a,l){this.setElement(a,n),this._setWidthHeight(),o&&o(this,l)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var s=this.resizeFilter,o=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),a=n.scaleX,l=n.scaleY,c=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!s||o<a&&o<l)return this._element=c,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=a,void(this._lastScaleY=l);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var d=fabric.util.createCanvasElement(),h=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,p=c.width,g=c.height;d.width=p,d.height=g,this._element=d,this._lastScaleX=s.scaleX=a,this._lastScaleY=s.scaleY=l,fabric.filterBackend.applyFilters([s],c,p,g,this._element,h),this._filterScalingX=d.width/this._originalElement.width,this._filterScalingY=d.height/this._originalElement.height},applyFilters:function(s){if(s=(s=s||this.filters||[]).filter(function(c){return c&&!c.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===s.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var o=this._originalElement,n=o.naturalWidth||o.width,a=o.naturalHeight||o.height;if(this._element===this._originalElement){var l=fabric.util.createCanvasElement();l.width=n,l.height=a,this._element=l,this._filteredEl=l}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,a),this._lastScaleX=1,this._lastScaleY=1;return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(s,this._originalElement,n,a,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(s){fabric.util.setImageSmoothing(s,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(s),this._renderPaintInOrder(s)},drawCacheOnCanvas:function(s){fabric.util.setImageSmoothing(s,this.imageSmoothing),fabric.Object.prototype.drawCacheOnCanvas.call(this,s)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(s){var o=this._element;if(o){var n=this._filterScalingX,a=this._filterScalingY,l=this.width,c=this.height,d=Math.min,h=Math.max,p=h(this.cropX,0),g=h(this.cropY,0),v=o.naturalWidth||o.width,r=o.naturalHeight||o.height,u=p*n,f=g*a,m=d(l*n,v-u),b=d(c*a,r-f),w=-l/2,A=-c/2,x=d(l,v/n-p),y=d(c,r/a-g);o&&s.drawImage(o,u,f,m,b,w,A,x,y)}},_needsResize:function(){var s=this.getTotalObjectScaling();return s.scaleX!==this._lastScaleX||s.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(s,o){this.setElement(fabric.util.getById(s),o),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(s){s||(s={}),this.setOptions(s),this._setWidthHeight(s)},_initFilters:function(s,o){s&&s.length?fabric.util.enlivenObjects(s,function(n){o&&o(n)},"fabric.Image.filters"):o&&o()},_setWidthHeight:function(s){s||(s={});var o=this.getElement();this.width=s.width||o.naturalWidth||o.width||0,this.height=s.height||o.naturalHeight||o.height||0},parsePreserveAspectRatioAttribute:function(){var s,o=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),n=this._element.width,a=this._element.height,l=1,c=1,d=0,h=0,p=0,g=0,v=this.width,r=this.height,u={width:v,height:r};return!o||"none"===o.alignX&&"none"===o.alignY?(l=v/n,c=r/a):("meet"===o.meetOrSlice&&(s=(v-n*(l=c=fabric.util.findScaleToFit(this._element,u)))/2,"Min"===o.alignX&&(d=-s),"Max"===o.alignX&&(d=s),s=(r-a*c)/2,"Min"===o.alignY&&(h=-s),"Max"===o.alignY&&(h=s)),"slice"===o.meetOrSlice&&(s=n-v/(l=c=fabric.util.findScaleToCover(this._element,u)),"Mid"===o.alignX&&(p=s/2),"Max"===o.alignX&&(p=s),s=a-r/c,"Mid"===o.alignY&&(g=s/2),"Max"===o.alignY&&(g=s),n=v/l,a=r/c)),{width:n,height:a,scaleX:l,scaleY:c,offsetLeft:d,offsetTop:h,cropX:p,cropY:g}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(s,o){var n=fabric.util.object.clone(s);fabric.util.loadImage(n.src,function(a,l){l?o&&o(null,!0):fabric.Image.prototype._initFilters.call(n,n.filters,function(c){n.filters=c||[],fabric.Image.prototype._initFilters.call(n,[n.resizeFilter],function(d){n.resizeFilter=d[0],fabric.util.enlivenObjectEnlivables(n,n,function(){var h=new fabric.Image(a,n);o(h,!1)})})})},null,n.crossOrigin)},fabric.Image.fromURL=function(s,o,n){fabric.util.loadImage(s,function(a,l){o&&o(new fabric.Image(a,n),l)},null,n&&n.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),fabric.Image.fromElement=function(s,o,n){var a=fabric.parseAttributes(s,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(a["xlink:href"],o,t(n?fabric.util.object.clone(n):{},a))})}(typeof exports<"u"?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(e){var t=function(){},s=(e=e||{}).onComplete||t,o=e.onChange||t,n=this;return fabric.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){n.rotate(a),o()},onComplete:function(){n.setCoords(),s()}})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){"use strict";fabric.isWebglSupported=function(t){if(fabric.isLikelyNode)return!1;t=t||fabric.WebglFilterBackend.prototype.tileSize;var s,o,n,a=document.createElement("canvas"),l=a.getContext("webgl")||a.getContext("experimental-webgl"),c=!1;if(l){fabric.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),c=fabric.maxTextureSize>=t;for(var d=["highp","mediump","lowp"],h=0;h<3;h++)if(o="precision "+d[h]+" float;\nvoid main(){}",n=(s=l).createShader(s.FRAGMENT_SHADER),s.shaderSource(n,o),s.compileShader(n),s.getShaderParameter(n,s.COMPILE_STATUS)){fabric.webGlPrecision=d[h];break}}return this.isSupported=c},(fabric.WebglFilterBackend=function e(t){t&&t.tileSize&&(this.tileSize=t.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}).prototype={tileSize:2048,resources:{},setupGLContext:function(t,s){this.dispose(),this.createWebGLCanvas(t,s),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(t,s)},chooseFastestCopyGLTo2DMethod:function(t,s){var o,n=void 0!==window.performance;try{new ImageData(1,1),o=!0}catch{o=!1}var a=typeof ArrayBuffer<"u",l=typeof Uint8ClampedArray<"u";if(n&&o&&a&&l){var c=fabric.util.createCanvasElement(),d=new ArrayBuffer(t*s*4);if(fabric.forceGLPutImageData)return this.imageBuffer=d,void(this.copyGLTo2D=copyGLTo2DPutImageData);var h,p,g={imageBuffer:d,destinationWidth:t,destinationHeight:s,targetCanvas:c};c.width=t,c.height=s,h=window.performance.now(),copyGLTo2DDrawImage.call(g,this.gl,g),p=window.performance.now()-h,h=window.performance.now(),copyGLTo2DPutImageData.call(g,this.gl,g),window.performance.now()-h<p?(this.imageBuffer=d,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(t,s){var o=fabric.util.createCanvasElement();o.width=t,o.height=s;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},a=o.getContext("webgl",n);a||(a=o.getContext("experimental-webgl",n)),a&&(a.clearColor(0,0,0,0),this.canvas=o,this.gl=a)},applyFilters:function(t,s,o,n,a,l){var c,d=this.gl;l&&(c=this.getCachedTexture(l,s));var h={originalWidth:s.width||s.originalWidth,originalHeight:s.height||s.originalHeight,sourceWidth:o,sourceHeight:n,destinationWidth:o,destinationHeight:n,context:d,sourceTexture:this.createTexture(d,o,n,!c&&s),targetTexture:this.createTexture(d,o,n),originalTexture:c||this.createTexture(d,o,n,!c&&s),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:a},p=d.createFramebuffer();return d.bindFramebuffer(d.FRAMEBUFFER,p),t.forEach(function(g){g&&g.applyTo(h)}),resizeCanvasIfNeeded(h),this.copyGLTo2D(d,h),d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(h.sourceTexture),d.deleteTexture(h.targetTexture),d.deleteFramebuffer(p),a.getContext("2d").setTransform(1,0,0,1,0,0),h},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(t,s,o,n){var a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,s,o,0,t.RGBA,t.UNSIGNED_BYTE,null),a},getCachedTexture:function(t,s){if(this.textureCache[t])return this.textureCache[t];var o=this.createTexture(this.gl,s.width,s.height,s);return this.textureCache[t]=o},evictCachesForKey:function(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,s={renderer:"",vendor:""};if(!t)return s;var o=t.getExtension("WEBGL_debug_renderer_info");if(o){var n=t.getParameter(o.UNMASKED_RENDERER_WEBGL),a=t.getParameter(o.UNMASKED_VENDOR_WEBGL);n&&(s.renderer=n.toLowerCase()),a&&(s.vendor=a.toLowerCase())}return this.gpuInfo=s}}}(),function(){"use strict";var e=function(){};(fabric.Canvas2dFilterBackend=function t(){}).prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(s,o,n,a,l){var c=l.getContext("2d");c.drawImage(o,0,0,n,a);var d={sourceWidth:n,sourceHeight:a,imageData:c.getImageData(0,0,n,a),originalEl:o,originalImageData:c.getImageData(0,0,n,a),canvasEl:l,ctx:c,filterBackend:this};return s.forEach(function(h){h.applyTo(d)}),d.imageData.width===n&&d.imageData.height===a||(l.width=d.imageData.width,l.height=d.imageData.height),c.putImageData(d.imageData,0,0),d}}}(),fabric.Image=fabric.Image||{},fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,s){t=t||this.fragmentSource,s=s||this.vertexSource,"highp"!==fabric.webGlPrecision&&(t=t.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var o=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(o,s),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(o));var n=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(n));var a=e.createProgram();if(e.attachShader(a,o),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(a));var l=this.getAttributeLocations(e,a),c=this.getUniformLocations(e,a)||{};return c.uStepW=e.getUniformLocation(a,"uStepW"),c.uStepH=e.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:l,uniformLocations:c}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,s){var o=t.aPosition,n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t,s,o=e.context;1<e.passes?(s=e.destinationHeight,e.sourceWidth===(t=e.destinationWidth)&&e.sourceHeight===s||(o.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(o,t,s)),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e.targetTexture,0)):(o.bindFramebuffer(o.FRAMEBUFFER,null),o.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=fabric.Image.filters[this.type].prototype;if(e){if(Array.isArray(t[e])){for(var s=t[e].length;s--;)if(this[e][s]!==t[e][s])return!1;return!0}return t[e]===this[e]}return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,s=this.retrieveShader(e);t.bindTexture(t.TEXTURE_2D,0===e.pass&&e.originalTexture?e.originalTexture:e.sourceTexture),t.useProgram(s.program),this.sendAttributeData(t,s.attributeLocations,e.aPosition),t.uniform1f(s.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(s.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,s.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,s){e.activeTexture(s),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(e,t){var s=new fabric.Image.filters[e.type](e);return t&&t(s),s},function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.ColorMatrix=(0,t.util.createClass)(s.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(n){this.callSuper("initialize",n),this.matrix=this.matrix.slice(0)},applyTo2d:function(n){var a,l,c,d,h,p=n.imageData.data,g=p.length,v=this.matrix,r=this.colorsOnly;for(h=0;h<g;h+=4)a=p[h],l=p[h+1],c=p[h+2],r?(p[h]=a*v[0]+l*v[1]+c*v[2]+255*v[4],p[h+1]=a*v[5]+l*v[6]+c*v[7]+255*v[9],p[h+2]=a*v[10]+l*v[11]+c*v[12]+255*v[14]):(p[h]=a*v[0]+l*v[1]+c*v[2]+(d=p[h+3])*v[3]+255*v[4],p[h+1]=a*v[5]+l*v[6]+c*v[7]+d*v[8]+255*v[9],p[h+2]=a*v[10]+l*v[11]+c*v[12]+d*v[13]+255*v[14],p[h+3]=a*v[15]+l*v[16]+c*v[17]+d*v[18]+255*v[19])},getUniformLocations:function(n,a){return{uColorMatrix:n.getUniformLocation(a,"uColorMatrix"),uConstants:n.getUniformLocation(a,"uConstants")}},sendUniformData:function(n,a){var l=this.matrix,d=[l[4],l[9],l[14],l[19]];n.uniformMatrix4fv(a.uColorMatrix,!1,[l[0],l[1],l[2],l[3],l[5],l[6],l[7],l[8],l[10],l[11],l[12],l[13],l[15],l[16],l[17],l[18]]),n.uniform4fv(a.uConstants,d)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Brightness=(0,t.util.createClass)(s.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(n){if(0!==this.brightness){var a,l=n.imageData.data,c=l.length,d=Math.round(255*this.brightness);for(a=0;a<c;a+=4)l[a]=l[a]+d,l[a+1]=l[a+1]+d,l[a+2]=l[a+2]+d}},getUniformLocations:function(n,a){return{uBrightness:n.getUniformLocation(a,"uBrightness")}},sendUniformData:function(n,a){n.uniform1f(a.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend,o=t.Image.filters;o.Convolute=(0,t.util.createClass)(o.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(a){var l=Math.sqrt(this.matrix.length),c=this.type+"_"+l+"_"+(this.opaque?1:0),d=this.fragmentSource[c];return a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,d)),a.programCache[c]},applyTo2d:function(a){var l,c,d,h,p,g,v,r,u,f,m,b,w,A=a.imageData,x=A.data,y=this.matrix,S=Math.round(Math.sqrt(y.length)),_=Math.floor(S/2),C=A.width,I=A.height,L=a.ctx.createImageData(C,I),D=L.data,O=this.opaque?1:0;for(m=0;m<I;m++)for(f=0;f<C;f++){for(p=4*(m*C+f),w=h=d=c=l=0;w<S;w++)for(b=0;b<S;b++)g=f+b-_,(v=m+w-_)<0||I<=v||g<0||C<=g||(l+=x[r=4*(v*C+g)]*(u=y[w*S+b]),c+=x[r+1]*u,d+=x[r+2]*u,O||(h+=x[r+3]*u));D[p]=l,D[p+1]=c,D[p+2]=d,D[p+3]=O?x[p+3]:h}a.imageData=L},getUniformLocations:function(a,l){return{uMatrix:a.getUniformLocation(l,"uMatrix"),uOpaque:a.getUniformLocation(l,"uOpaque"),uHalfSize:a.getUniformLocation(l,"uHalfSize"),uSize:a.getUniformLocation(l,"uSize")}},sendUniformData:function(a,l){a.uniform1fv(l.uMatrix,this.matrix)},toObject:function(){return s(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Grayscale=(0,t.util.createClass)(s.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(n){var a,l,c=n.imageData.data,d=c.length,h=this.mode;for(a=0;a<d;a+=4)"average"===h?l=(c[a]+c[a+1]+c[a+2])/3:"lightness"===h?l=(Math.min(c[a],c[a+1],c[a+2])+Math.max(c[a],c[a+1],c[a+2]))/2:"luminosity"===h&&(l=.21*c[a]+.72*c[a+1]+.07*c[a+2]),c[a]=l,c[a+1]=l,c[a+2]=l},retrieveShader:function(n){var a=this.type+"_"+this.mode;return n.programCache.hasOwnProperty(a)||(n.programCache[a]=this.createProgram(n.context,this.fragmentSource[this.mode])),n.programCache[a]},getUniformLocations:function(n,a){return{uMode:n.getUniformLocation(a,"uMode")}},sendUniformData:function(n,a){n.uniform1i(a.uMode,1)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Invert=(0,t.util.createClass)(s.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(n){var a,l=n.imageData.data,c=l.length;for(a=0;a<c;a+=4)l[a]=255-l[a],l[a+1]=255-l[a+1],l[a+2]=255-l[a+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(n,a){return{uInvert:n.getUniformLocation(a,"uInvert")}},sendUniformData:function(n,a){n.uniform1i(a.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend,o=t.Image.filters;o.Noise=(0,t.util.createClass)(o.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(a){if(0!==this.noise){var l,c,h,d=a.imageData.data,p=this.noise;for(l=0,h=d.length;l<h;l+=4)c=(.5-Math.random())*p,d[l]+=c,d[l+1]+=c,d[l+2]+=c}},getUniformLocations:function(a,l){return{uNoise:a.getUniformLocation(l,"uNoise"),uSeed:a.getUniformLocation(l,"uSeed")}},sendUniformData:function(a,l){a.uniform1f(l.uNoise,this.noise/255),a.uniform1f(l.uSeed,Math.random())},toObject:function(){return s(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Pixelate=(0,t.util.createClass)(s.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(n){var a,l,c,d,h,p,g,v,r,u,f,m=n.imageData,b=m.data,w=m.height,A=m.width;for(l=0;l<w;l+=this.blocksize)for(c=0;c<A;c+=this.blocksize)for(d=b[a=4*l*A+4*c],h=b[a+1],p=b[a+2],g=b[a+3],u=Math.min(l+this.blocksize,w),f=Math.min(c+this.blocksize,A),v=l;v<u;v++)for(r=c;r<f;r++)b[a=4*v*A+4*r]=d,b[a+1]=h,b[a+2]=p,b[a+3]=g},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(n,a){return{uBlocksize:n.getUniformLocation(a,"uBlocksize"),uStepW:n.getUniformLocation(a,"uStepW"),uStepH:n.getUniformLocation(a,"uStepH")}},sendUniformData:function(n,a){n.uniform1f(a.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.extend,o=t.Image.filters;o.RemoveColor=(0,t.util.createClass)(o.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(a){var l,c,d,h,p=a.imageData.data,g=255*this.distance,v=new t.Color(this.color).getSource(),r=[v[0]-g,v[1]-g,v[2]-g],u=[v[0]+g,v[1]+g,v[2]+g];for(l=0;l<p.length;l+=4)d=p[l+1],h=p[l+2],r[0]<(c=p[l])&&r[1]<d&&r[2]<h&&c<u[0]&&d<u[1]&&h<u[2]&&(p[l+3]=0)},getUniformLocations:function(a,l){return{uLow:a.getUniformLocation(l,"uLow"),uHigh:a.getUniformLocation(l,"uHigh")}},sendUniformData:function(a,l){var c=new t.Color(this.color).getSource(),d=parseFloat(this.distance),p=[c[0]/255+d,c[1]/255+d,c[2]/255+d,1];a.uniform4fv(l.uLow,[0+c[0]/255-d,0+c[1]/255-d,0+c[2]/255-d,1]),a.uniform4fv(l.uHigh,p)},toObject:function(){return s(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters,o=t.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in n)s[a]=o(s.ColorMatrix,{type:a,matrix:n[a],mainParameter:!1,colorsOnly:!0}),t.Image.filters[a].fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric,s=t.Image.filters;s.BlendColor=(0,t.util.createClass)(s.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(n){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[n]+"}\n}"},retrieveShader:function(n){var a,l=this.type+"_"+this.mode;return n.programCache.hasOwnProperty(l)||(a=this.buildSource(this.mode),n.programCache[l]=this.createProgram(n.context,a)),n.programCache[l]},applyTo2d:function(n){var a,l,c,d,h,p,g,v=n.imageData.data,r=v.length,u=1-this.alpha;a=(g=new t.Color(this.color).getSource())[0]*this.alpha,l=g[1]*this.alpha,c=g[2]*this.alpha;for(var f=0;f<r;f+=4)switch(d=v[f],h=v[f+1],p=v[f+2],this.mode){case"multiply":v[f]=d*a/255,v[f+1]=h*l/255,v[f+2]=p*c/255;break;case"screen":v[f]=255-(255-d)*(255-a)/255,v[f+1]=255-(255-h)*(255-l)/255,v[f+2]=255-(255-p)*(255-c)/255;break;case"add":v[f]=d+a,v[f+1]=h+l,v[f+2]=p+c;break;case"diff":case"difference":v[f]=Math.abs(d-a),v[f+1]=Math.abs(h-l),v[f+2]=Math.abs(p-c);break;case"subtract":v[f]=d-a,v[f+1]=h-l,v[f+2]=p-c;break;case"darken":v[f]=Math.min(d,a),v[f+1]=Math.min(h,l),v[f+2]=Math.min(p,c);break;case"lighten":v[f]=Math.max(d,a),v[f+1]=Math.max(h,l),v[f+2]=Math.max(p,c);break;case"overlay":v[f]=a<128?2*d*a/255:255-2*(255-d)*(255-a)/255,v[f+1]=l<128?2*h*l/255:255-2*(255-h)*(255-l)/255,v[f+2]=c<128?2*p*c/255:255-2*(255-p)*(255-c)/255;break;case"exclusion":v[f]=a+d-2*a*d/255,v[f+1]=l+h-2*l*h/255,v[f+2]=c+p-2*c*p/255;break;case"tint":v[f]=a+d*u,v[f+1]=l+h*u,v[f+2]=c+p*u}},getUniformLocations:function(n,a){return{uColor:n.getUniformLocation(a,"uColor")}},sendUniformData:function(n,a){var l=new t.Color(this.color).getSource();l[0]=this.alpha*l[0]/255,l[1]=this.alpha*l[1]/255,l[2]=this.alpha*l[2]/255,l[3]=this.alpha,n.uniform4fv(a.uColor,l)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric,s=t.Image.filters;s.BlendImage=(0,t.util.createClass)(s.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(n){var a=this.type+"_"+this.mode,l=this.fragmentSource[this.mode];return n.programCache.hasOwnProperty(a)||(n.programCache[a]=this.createProgram(n.context,l)),n.programCache[a]},applyToWebGL:function(n){var a=n.context,l=this.createTexture(n.filterBackend,this.image);this.bindAdditionalTexture(a,l,a.TEXTURE1),this.callSuper("applyToWebGL",n),this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(n,a){return n.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var n=this.image;return[1/n.scaleX,0,0,0,1/n.scaleY,0,-n.left/n._element.width,-n.top/n._element.height,1]},applyTo2d:function(n){var a,l,c,d,h,p,g,v,r,u,f,m=n.imageData,b=n.filterBackend.resources,w=m.data,A=w.length,x=m.width,y=m.height,S=this.image;b.blendImage||(b.blendImage=t.util.createCanvasElement()),u=(r=b.blendImage).getContext("2d"),r.width!==x||r.height!==y?(r.width=x,r.height=y):u.clearRect(0,0,x,y),u.setTransform(S.scaleX,0,0,S.scaleY,S.left,S.top),u.drawImage(S._element,0,0,x,y),f=u.getImageData(0,0,x,y).data;for(var _=0;_<A;_+=4)switch(h=w[_],p=w[_+1],g=w[_+2],v=w[_+3],a=f[_],l=f[_+1],c=f[_+2],d=f[_+3],this.mode){case"multiply":w[_]=h*a/255,w[_+1]=p*l/255,w[_+2]=g*c/255,w[_+3]=v*d/255;break;case"mask":w[_+3]=d}},getUniformLocations:function(n,a){return{uTransformMatrix:n.getUniformLocation(a,"uTransformMatrix"),uImage:n.getUniformLocation(a,"uImage")}},sendUniformData:function(n,a){var l=this.calculateMatrix();n.uniform1i(a.uImage,1),n.uniformMatrix3fv(a.uTransformMatrix,!1,l)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(n,a){t.Image.fromObject(n.image,function(l){var c=t.util.object.clone(n);c.image=l,a(new t.Image.filters.BlendImage(c))})}}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=Math.pow,o=Math.floor,n=Math.sqrt,a=Math.abs,l=Math.round,c=Math.sin,d=Math.ceil,h=t.Image.filters;h.Resize=(0,t.util.createClass)(h.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(g,v){return{uDelta:g.getUniformLocation(v,"uDelta"),uTaps:g.getUniformLocation(v,"uTaps")}},sendUniformData:function(g,v){g.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),g.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(g){var v=this.getFilterWindow(),r=this.type+"_"+v;if(!g.programCache.hasOwnProperty(r)){var u=this.generateShader(v);g.programCache[r]=this.createProgram(g.context,u)}return g.programCache[r]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var g=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,r=this.getFilterWindow(),u=new Array(r),f=1;f<=r;f++)u[f-1]=g(f*v);return u},generateShader:function(g){for(var v=new Array(g),r=this.fragmentSourceTOP,u=1;u<=g;u++)v[u-1]=u+".0 * uDelta";return r+="uniform float uTaps["+g+"];\n",r+="void main() {\n",r+="  vec4 color = texture2D(uTexture, vTexCoord);\n",r+="  float sum = 1.0;\n",v.forEach(function(f,m){r+="  color += texture2D(uTexture, vTexCoord + "+f+") * uTaps["+m+"];\n",r+="  color += texture2D(uTexture, vTexCoord - "+f+") * uTaps["+m+"];\n",r+="  sum += 2.0 * uTaps["+m+"];\n"}),r+="  gl_FragColor = color / sum;\n",r+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(g){g.webgl?(g.passes++,this.width=g.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=g.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),g.destinationWidth=this.dW,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceWidth=g.destinationWidth,this.height=g.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),g.destinationHeight=this.dH,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceHeight=g.destinationHeight):this.applyTo2d(g)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(g){return function(v){if(g<=v||v<=-g)return 0;if(v<1.1920929e-7&&-1.1920929e-7<v)return 1;var r=(v*=Math.PI)/g;return c(v)/v*c(r)/r}},applyTo2d:function(g){var v=g.imageData,r=this.scaleX,u=this.scaleY;this.rcpScaleX=1/r,this.rcpScaleY=1/u;var f,m=v.width,b=v.height,w=l(m*r),A=l(b*u);"sliceHack"===this.resizeType?f=this.sliceByTwo(g,m,b,w,A):"hermite"===this.resizeType?f=this.hermiteFastResize(g,m,b,w,A):"bilinear"===this.resizeType?f=this.bilinearFiltering(g,m,b,w,A):"lanczos"===this.resizeType&&(f=this.lanczosResize(g,m,b,w,A)),g.imageData=f},sliceByTwo:function(g,v,r,u,f){var m,b,w=g.imageData,A=!1,x=!1,y=.5*v,S=.5*r,_=t.filterBackend.resources,C=0,I=0,L=v,D=0;for(_.sliceByTwo||(_.sliceByTwo=document.createElement("canvas")),((m=_.sliceByTwo).width<1.5*v||m.height<r)&&(m.width=1.5*v,m.height=r),(b=m.getContext("2d")).clearRect(0,0,1.5*v,r),b.putImageData(w,0,0),u=o(u),f=o(f);!A||!x;)r=S,u<o(.5*(v=y))?y=o(.5*y):(y=u,A=!0),f<o(.5*S)?S=o(.5*S):(S=f,x=!0),b.drawImage(m,C,I,v,r,L,D,y,S),C=L,I=D,D+=S;return b.getImageData(C,I,u,f)},lanczosResize:function(g,v,r,u,f){var m=g.imageData.data,b=g.ctx.createImageData(u,f),w=b.data,A=this.lanczosCreate(this.lanczosLobes),x=this.rcpScaleX,y=this.rcpScaleY,S=2/this.rcpScaleX,_=2/this.rcpScaleY,C=d(x*this.lanczosLobes/2),I=d(y*this.lanczosLobes/2),L={},D={},O={};return function M(E){var R,H,N,B,P,z,J,q,G,ee,le;for(D.x=(E+.5)*x,O.x=o(D.x),R=0;R<f;R++){for(D.y=(R+.5)*y,O.y=o(D.y),G=q=J=z=P=0,H=O.x-C;H<=O.x+C;H++)if(!(H<0||v<=H)){ee=o(1e3*a(H-D.x)),L[ee]||(L[ee]={});for(var te=O.y-I;te<=O.y+I;te++)te<0||r<=te||(le=o(1e3*a(te-D.y)),L[ee][le]||(L[ee][le]=A(n(s(ee*S,2)+s(le*_,2))/1e3)),0<(N=L[ee][le])&&(P+=N,z+=N*m[B=4*(te*v+H)],J+=N*m[B+1],q+=N*m[B+2],G+=N*m[B+3]))}w[B=4*(R*u+E)]=z/P,w[B+1]=J/P,w[B+2]=q/P,w[B+3]=G/P}return++E<u?M(E):b}(0)},bilinearFiltering:function(g,v,r,u,f){var m,b,w,A,x,y,S,C,I=0,L=this.rcpScaleX,D=this.rcpScaleY,O=4*(v-1),M=g.imageData.data,E=g.ctx.createImageData(u,f),R=E.data;for(w=0;w<f;w++)for(A=0;A<u;A++)for(x=L*A-(m=o(L*A)),y=D*w-(b=o(D*w)),C=4*(b*v+m),S=0;S<4;S++)R[I++]=M[C+S]*(1-x)*(1-y)+M[C+4+S]*x*(1-y)+M[C+O+S]*y*(1-x)+M[C+O+4+S]*x*y;return E},hermiteFastResize:function(g,v,r,u,f){for(var m=this.rcpScaleX,b=this.rcpScaleY,w=d(m/2),A=d(b/2),x=g.imageData.data,y=g.ctx.createImageData(u,f),S=y.data,_=0;_<f;_++)for(var C=0;C<u;C++){for(var I=4*(C+_*u),L=0,D=0,O=0,M=0,E=0,R=0,H=0,N=(_+.5)*b,B=o(_*b);B<(_+1)*b;B++)for(var P=a(N-(B+.5))/A,z=(C+.5)*m,J=P*P,q=o(C*m);q<(C+1)*m;q++){var G=a(z-(q+.5))/w,ee=n(J+G*G);1<ee&&ee<-1||0<(L=2*ee*ee*ee-3*ee*ee+1)&&(H+=L*x[3+(G=4*(q+B*v))],O+=L,x[G+3]<255&&(L=L*x[G+3]/250),M+=L*x[G],E+=L*x[G+1],R+=L*x[G+2],D+=L)}S[I]=M/D,S[I+1]=E/D,S[I+2]=R/D,S[I+3]=H/O}return y},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Contrast=(0,t.util.createClass)(s.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(n){if(0!==this.contrast){var a,l=n.imageData.data,c=l.length,d=Math.floor(255*this.contrast),h=259*(d+255)/(255*(259-d));for(a=0;a<c;a+=4)l[a]=h*(l[a]-128)+128,l[a+1]=h*(l[a+1]-128)+128,l[a+2]=h*(l[a+2]-128)+128}},getUniformLocations:function(n,a){return{uContrast:n.getUniformLocation(a,"uContrast")}},sendUniformData:function(n,a){n.uniform1f(a.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Saturation=(0,t.util.createClass)(s.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(n){if(0!==this.saturation){var a,l,c=n.imageData.data,d=c.length,h=-this.saturation;for(a=0;a<d;a+=4)l=Math.max(c[a],c[a+1],c[a+2]),c[a]+=l!==c[a]?(l-c[a])*h:0,c[a+1]+=l!==c[a+1]?(l-c[a+1])*h:0,c[a+2]+=l!==c[a+2]?(l-c[a+2])*h:0}},getUniformLocations:function(n,a){return{uSaturation:n.getUniformLocation(a,"uSaturation")}},sendUniformData:function(n,a){n.uniform1f(a.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Vibrance=(0,t.util.createClass)(s.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(n){if(0!==this.vibrance){var a,l,d,h=n.imageData.data,p=h.length,g=-this.vibrance;for(a=0;a<p;a+=4)l=Math.max(h[a],h[a+1],h[a+2]),d=2*Math.abs(l-(h[a]+h[a+1]+h[a+2])/3)/255*g,h[a]+=l!==h[a]?(l-h[a])*d:0,h[a+1]+=l!==h[a+1]?(l-h[a+1])*d:0,h[a+2]+=l!==h[a+2]?(l-h[a+2])*d:0}},getUniformLocations:function(n,a){return{uVibrance:n.getUniformLocation(a,"uVibrance")}},sendUniformData:function(n,a){n.uniform1f(a.uVibrance,-this.vibrance)}}),t.Image.filters.Vibrance.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Blur=(0,t.util.createClass)(s.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(n){n.webgl?(this.aspectRatio=n.sourceWidth/n.sourceHeight,n.passes++,this._setupFrameBuffer(n),this.horizontal=!0,this.applyToWebGL(n),this._swapTextures(n),this._setupFrameBuffer(n),this.horizontal=!1,this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},applyTo2d:function(n){n.imageData=this.simpleBlur(n)},simpleBlur:function(n){var a,l,c=n.filterBackend.resources,d=n.imageData.width,h=n.imageData.height;c.blurLayer1||(c.blurLayer1=t.util.createCanvasElement(),c.blurLayer2=t.util.createCanvasElement()),l=c.blurLayer2,(a=c.blurLayer1).width===d&&a.height===h||(l.width=a.width=d,l.height=a.height=h);var p,g,v,r,u=a.getContext("2d"),f=l.getContext("2d"),m=.06*this.blur*.5;for(u.putImageData(n.imageData,0,0),f.clearRect(0,0,d,h),r=-15;r<=15;r++)v=m*(g=r/15)*d+(p=(Math.random()-.5)/4),f.globalAlpha=1-Math.abs(g),f.drawImage(a,v,p),u.drawImage(l,0,0),f.globalAlpha=1,f.clearRect(0,0,l.width,l.height);for(r=-15;r<=15;r++)v=m*(g=r/15)*h+(p=(Math.random()-.5)/4),f.globalAlpha=1-Math.abs(g),f.drawImage(a,p,v),u.drawImage(l,0,0),f.globalAlpha=1,f.clearRect(0,0,l.width,l.height);n.ctx.drawImage(a,0,0);var b=n.ctx.getImageData(0,0,a.width,a.height);return u.globalAlpha=1,u.clearRect(0,0,a.width,a.height),b},getUniformLocations:function(n,a){return{delta:n.getUniformLocation(a,"uDelta")}},sendUniformData:function(n,a){var l=this.chooseRightDelta();n.uniform2fv(a.delta,l)},chooseRightDelta:function(){var n,a=1,l=[0,0];return this.horizontal?1<this.aspectRatio&&(a=1/this.aspectRatio):this.aspectRatio<1&&(a=this.aspectRatio),n=a*this.blur*.12,this.horizontal?l[0]=n:l[1]=n,l}}),s.Blur.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Gamma=(0,t.util.createClass)(s.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(n){this.gamma=[1,1,1],s.BaseFilter.prototype.initialize.call(this,n)},applyTo2d:function(n){var a,l=n.imageData.data,c=this.gamma,d=l.length,h=1/c[0],p=1/c[1],g=1/c[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),a=0,d=256;a<d;a++)this.rVals[a]=255*Math.pow(a/255,h),this.gVals[a]=255*Math.pow(a/255,p),this.bVals[a]=255*Math.pow(a/255,g);for(a=0,d=l.length;a<d;a+=4)l[a]=this.rVals[l[a]],l[a+1]=this.gVals[l[a+1]],l[a+2]=this.bVals[l[a+2]]},getUniformLocations:function(n,a){return{uGamma:n.getUniformLocation(a,"uGamma")}},sendUniformData:function(n,a){n.uniform3fv(a.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.Composed=(0,t.util.createClass)(s.BaseFilter,{type:"Composed",subFilters:[],initialize:function(n){this.callSuper("initialize",n),this.subFilters=this.subFilters.slice(0)},applyTo:function(n){n.passes+=this.subFilters.length-1,this.subFilters.forEach(function(a){a.applyTo(n)})},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(n){return n.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(n){return!n.isNeutralState()})}}),t.Image.filters.Composed.fromObject=function(n,a){var l=(n.subFilters||[]).map(function(d){return new t.Image.filters[d.type](d)}),c=new t.Image.filters.Composed({subFilters:l});return a&&a(c),c}}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.Image.filters;s.HueRotation=(0,t.util.createClass)(s.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var n=this.rotation*Math.PI,a=t.util.cos(n),l=t.util.sin(n),c=Math.sqrt(1/3)*l,d=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=a+d/3,this.matrix[1]=1/3*d-c,this.matrix[2]=1/3*d+c,this.matrix[5]=1/3*d+c,this.matrix[6]=a+1/3*d,this.matrix[7]=1/3*d-c,this.matrix[10]=1/3*d-c,this.matrix[11]=1/3*d+c,this.matrix[12]=a+1/3*d},isNeutralState:function(n){return this.calculateMatrix(),s.BaseFilter.prototype.isNeutralState.call(this,n)},applyTo:function(n){this.calculateMatrix(),s.BaseFilter.prototype.applyTo.call(this,n)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject}(typeof exports<"u"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),s=t.util.object.clone;if(t.Text)t.warn("fabric.Text is already defined");else{var o="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat(o),cacheProperties:t.Object.prototype.cacheProperties.concat(o),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(n,a){this.styles=a&&a.styles||{},this.text=n,this.__skipDimension=!0,this.callSuper("initialize",a),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var n=this.path;n&&(n.segmentsInfo=t.util.getPathSegmentsInfo(n.path))},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var n=this._splitTextIntoLines(this.text);return this.textLines=n.lines,this._textLines=n.graphemeLines,this._unwrappedTextLines=n._unwrappedLines,this._text=n.graphemeText,n},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var n,a,c,d,h,p,g=0,v=this._textLines.length;g<v;g++)if(("justify"===this.textAlign||g!==v-1&&!this.isEndOfWrapping(g))&&(c=0,d=this._textLines[g],(a=this.getLineWidth(g))<this.width&&(p=this.textLines[g].match(this._reSpacesAndTabs)))){n=(this.width-a)/p.length;for(var r=0,u=d.length;r<=u;r++)h=this.__charBounds[g][r],this._reSpaceAndTab.test(d[r])?(h.width+=n,h.kernedWidth+=n,h.left+=c,c+=n):h.left+=c}},isEndOfWrapping:function(n){return n===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var n=this.callSuper("_getCacheCanvasDimensions"),a=this.fontSize;return n.width+=a*n.zoomX,n.height+=a*n.zoomY,n},_render:function(n){var a=this.path;a&&!a.isNotVisible()&&a._render(n),this._setTextStyles(n),this._renderTextLinesBackground(n),this._renderTextDecoration(n,"underline"),this._renderText(n),this._renderTextDecoration(n,"overline"),this._renderTextDecoration(n,"linethrough")},_renderText:function(n){"stroke"===this.paintFirst?(this._renderTextStroke(n),this._renderTextFill(n)):(this._renderTextFill(n),this._renderTextStroke(n))},_setTextStyles:function(n,a,l){if(n.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":n.textBaseline="middle";break;case"ascender":n.textBaseline="top";break;case"descender":n.textBaseline="bottom"}n.font=this._getFontDeclaration(a,l)},calcTextWidth:function(){for(var n=this.getLineWidth(0),a=1,l=this._textLines.length;a<l;a++){var c=this.getLineWidth(a);n<c&&(n=c)}return n},_renderTextLine:function(n,a,l,c,d,h){this._renderChars(n,a,l,c,d,h)},_renderTextLinesBackground:function(n){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var a,l,c,d,h,p,g,v=n.fillStyle,r=this._getLeftOffset(),u=this._getTopOffset(),f=0,m=0,b=this.path,w=0,A=this._textLines.length;w<A;w++)if(a=this.getHeightOfLine(w),this.textBackgroundColor||this.styleHas("textBackgroundColor",w)){c=this._textLines[w],l=this._getLineLeftOffset(w),f=m=0,d=this.getValueOfPropertyAt(w,0,"textBackgroundColor");for(var x=0,y=c.length;x<y;x++)h=this.__charBounds[w][x],p=this.getValueOfPropertyAt(w,x,"textBackgroundColor"),b?(n.save(),n.translate(h.renderLeft,h.renderTop),n.rotate(h.angle),(n.fillStyle=p)&&n.fillRect(-h.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),h.width,a/this.lineHeight),n.restore()):p!==d?(g=r+l+f,"rtl"===this.direction&&(g=this.width-g-m),(n.fillStyle=d)&&n.fillRect(g,u,m,a/this.lineHeight),f=h.left,m=h.width,d=p):m+=h.kernedWidth;p&&!b&&(g=r+l+f,"rtl"===this.direction&&(g=this.width-g-m),n.fillStyle=p,n.fillRect(g,u,m,a/this.lineHeight)),u+=a}else u+=a;n.fillStyle=v,this._removeShadow(n)}},getFontCache:function(n){var a=n.fontFamily.toLowerCase();t.charWidthsCache[a]||(t.charWidthsCache[a]={});var l=t.charWidthsCache[a],c=n.fontStyle.toLowerCase()+"_"+(n.fontWeight+"").toLowerCase();return l[c]||(l[c]={}),l[c]},_measureChar:function(n,a,l,c){var d,h,p,g,v=this.getFontCache(a),r=l+n,u=this._getFontDeclaration(a)===this._getFontDeclaration(c),f=a.fontSize/this.CACHE_FONT_SIZE;if(l&&void 0!==v[l]&&(p=v[l]),void 0!==v[n]&&(g=d=v[n]),u&&void 0!==v[r]&&(g=(h=v[r])-p),void 0===d||void 0===p||void 0===h){var m=this.getMeasuringContext();this._setTextStyles(m,a,!0)}return void 0===d&&(g=d=m.measureText(n).width,v[n]=d),void 0===p&&u&&l&&(p=m.measureText(l).width,v[l]=p),u&&void 0===h&&(h=m.measureText(r).width,g=(v[r]=h)-p),{width:d*f,kernedWidth:g*f}},getHeightOfChar:function(n,a){return this.getValueOfPropertyAt(n,a,"fontSize")},measureLine:function(n){var a=this._measureLine(n);return 0!==this.charSpacing&&(a.width-=this._getWidthOfCharSpacing()),a.width<0&&(a.width=0),a},_measureLine:function(n){var a,l,c,d,h,p,g=0,v=this._textLines[n],r=new Array(v.length),u=0,f=this.path,m="right"===this.pathSide;for(this.__charBounds[n]=r,a=0;a<v.length;a++)d=this._getGraphemeBox(l=v[a],n,a,c),g+=(r[a]=d).kernedWidth,c=l;if(r[a]={left:d?d.left+d.width:0,width:0,kernedWidth:0,height:this.fontSize},f){switch(p=f.segmentsInfo[f.segmentsInfo.length-1].length,(h=t.util.getPointOnPath(f.path,0,f.segmentsInfo)).x+=f.pathOffset.x,h.y+=f.pathOffset.y,this.textAlign){case"left":u=m?p-g:0;break;case"center":u=(p-g)/2;break;case"right":u=m?0:p-g}for(u+=this.pathStartOffset*(m?-1:1),a=m?v.length-1:0;m?0<=a:a<v.length;m?a--:a++)p<u?u%=p:u<0&&(u+=p),this._setGraphemeOnPath(u,d=r[a],h),u+=d.kernedWidth}return{width:g,numOfSpaces:0}},_setGraphemeOnPath:function(n,a,l){var d=this.path,h=t.util.getPointOnPath(d.path,n+a.kernedWidth/2,d.segmentsInfo);a.renderLeft=h.x-l.x,a.renderTop=h.y-l.y,a.angle=h.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(n,a,l,c,d){var h,p=this.getCompleteStyleDeclaration(a,l),g=c?this.getCompleteStyleDeclaration(a,l-1):{},v=this._measureChar(n,p,c,g),r=v.kernedWidth,u=v.width;0!==this.charSpacing&&(u+=h=this._getWidthOfCharSpacing(),r+=h);var f={width:u,left:0,height:p.fontSize,kernedWidth:r,deltaY:p.deltaY};if(0<l&&!d){var m=this.__charBounds[a][l-1];f.left=m.left+m.width+v.kernedWidth-v.width}return f},getHeightOfLine:function(n){if(this.__lineHeights[n])return this.__lineHeights[n];for(var a=this._textLines[n],l=this.getHeightOfChar(n,0),c=1,d=a.length;c<d;c++)l=Math.max(this.getHeightOfChar(n,c),l);return this.__lineHeights[n]=l*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var n,a=0,l=0,c=this._textLines.length;l<c;l++)n=this.getHeightOfLine(l),a+=l===c-1?n/this.lineHeight:n;return a},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(n,a){n.save();for(var l=0,c=this._getLeftOffset(),d=this._getTopOffset(),h=0,p=this._textLines.length;h<p;h++){var g=this.getHeightOfLine(h),v=g/this.lineHeight,r=this._getLineLeftOffset(h);this._renderTextLine(a,n,this._textLines[h],c+r,d+l+v,h),l+=g}n.restore()},_renderTextFill:function(n){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(n,"fillText")},_renderTextStroke:function(n){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this._setLineDash(n,this.strokeDashArray),n.beginPath(),this._renderTextCommon(n,"strokeText"),n.closePath(),n.restore())},_renderChars:function(n,a,l,c,d,h){var p,g,v,r,f=this.getHeightOfLine(h),m=-1!==this.textAlign.indexOf("justify"),b="",w=0,A=this.path,x=!m&&0===this.charSpacing&&this.isEmptyStyles(h)&&!A,y="ltr"===this.direction,S="ltr"===this.direction?1:-1,_=a.canvas.getAttribute("dir");if(a.save(),_!==this.direction&&(a.canvas.setAttribute("dir",y?"ltr":"rtl"),a.direction=y?"ltr":"rtl",a.textAlign=y?"left":"right"),d-=f*this._fontSizeFraction/this.lineHeight,x)return this._renderChar(n,a,h,0,l.join(""),c,d,f),void a.restore();for(var C=0,I=l.length-1;C<=I;C++)r=C===I||this.charSpacing||A,b+=l[C],v=this.__charBounds[h][C],0===w?(c+=S*(v.kernedWidth-v.width),w+=v.width):w+=v.kernedWidth,m&&!r&&this._reSpaceAndTab.test(l[C])&&(r=!0),r||(p=p||this.getCompleteStyleDeclaration(h,C),g=this.getCompleteStyleDeclaration(h,C+1),r=this._hasStyleChanged(p,g)),r&&(A?(a.save(),a.translate(v.renderLeft,v.renderTop),a.rotate(v.angle),this._renderChar(n,a,h,C,b,-w/2,0,f),a.restore()):this._renderChar(n,a,h,C,b,c,d,f),b="",p=g,c+=S*w,w=0);a.restore()},_applyPatternGradientTransformText:function(n){var a,l=t.util.createCanvasElement(),c=this.width+this.strokeWidth,d=this.height+this.strokeWidth;return l.width=c,l.height=d,(a=l.getContext("2d")).beginPath(),a.moveTo(0,0),a.lineTo(c,0),a.lineTo(c,d),a.lineTo(0,d),a.closePath(),a.translate(c/2,d/2),a.fillStyle=n.toLive(a),this._applyPatternGradientTransform(a,n),a.fill(),a.createPattern(l,"no-repeat")},handleFiller:function(n,a,l){var c,d;return l.toLive?"percentage"===l.gradientUnits||l.gradientTransform||l.patternTransform?(n.translate(c=-this.width/2,d=-this.height/2),n[a]=this._applyPatternGradientTransformText(l),{offsetX:c,offsetY:d}):(n[a]=l.toLive(n,this),this._applyPatternGradientTransform(n,l)):(n[a]=l,{offsetX:0,offsetY:0})},_setStrokeStyles:function(n,a){return n.lineWidth=a.strokeWidth,n.lineCap=this.strokeLineCap,n.lineDashOffset=this.strokeDashOffset,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,this.handleFiller(n,"strokeStyle",a.stroke)},_setFillStyles:function(n,a){return this.handleFiller(n,"fillStyle",a.fill)},_renderChar:function(n,a,l,c,d,h,p){var g,v,r=this._getStyleDeclaration(l,c),u=this.getCompleteStyleDeclaration(l,c),f="fillText"===n&&u.fill,m="strokeText"===n&&u.stroke&&u.strokeWidth;(m||f)&&(a.save(),f&&(g=this._setFillStyles(a,u)),m&&(v=this._setStrokeStyles(a,u)),a.font=this._getFontDeclaration(u),r&&r.textBackgroundColor&&this._removeShadow(a),r&&r.deltaY&&(p+=r.deltaY),f&&a.fillText(d,h-g.offsetX,p-g.offsetY),m&&a.strokeText(d,h-v.offsetX,p-v.offsetY),a.restore())},setSuperscript:function(n,a){return this._setScript(n,a,this.superscript)},setSubscript:function(n,a){return this._setScript(n,a,this.subscript)},_setScript:function(n,a,l){var c=this.get2DCursorLocation(n,!0),d=this.getValueOfPropertyAt(c.lineIndex,c.charIndex,"fontSize"),h=this.getValueOfPropertyAt(c.lineIndex,c.charIndex,"deltaY");return this.setSelectionStyles({fontSize:d*l.size,deltaY:h+d*l.baseline},n,a),this},_hasStyleChanged:function(n,a){return n.fill!==a.fill||n.stroke!==a.stroke||n.strokeWidth!==a.strokeWidth||n.fontSize!==a.fontSize||n.fontFamily!==a.fontFamily||n.fontWeight!==a.fontWeight||n.fontStyle!==a.fontStyle||n.deltaY!==a.deltaY},_hasStyleChangedForSvg:function(n,a){return this._hasStyleChanged(n,a)||n.overline!==a.overline||n.underline!==a.underline||n.linethrough!==a.linethrough},_getLineLeftOffset:function(n){var a=this.getLineWidth(n),l=this.width-a,c=this.textAlign,d=this.direction,h=0,p=this.isEndOfWrapping(n);return"justify"===c||"justify-center"===c&&!p||"justify-right"===c&&!p||"justify-left"===c&&!p?0:("center"===c&&(h=l/2),"right"===c&&(h=l),"justify-center"===c&&(h=l/2),"justify-right"===c&&(h=l),"rtl"===d&&(h-=l),h)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var n=this._forceClearCache;return n||(n=this.hasStateChanged("_dimensionAffectingProps")),n&&(this.dirty=!0,this._forceClearCache=!1),n},getLineWidth:function(n){if(void 0!==this.__lineWidths[n])return this.__lineWidths[n];var a=this.measureLine(n).width;return this.__lineWidths[n]=a},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(n,a,l){var c=this._getStyleDeclaration(n,a);return c&&void 0!==c[l]?c[l]:this[l]},_renderTextDecoration:function(n,a){if(this[a]||this.styleHas(a)){for(var l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S=this._getLeftOffset(),_=this._getTopOffset(),C=this.path,I=this._getWidthOfCharSpacing(),L=this.offsets[a],D=0,O=this._textLines.length;D<O;D++)if(l=this.getHeightOfLine(D),this[a]||this.styleHas(a,D)){v=this._textLines[D],A=l/this.lineHeight,h=this._getLineLeftOffset(D),m=f=0,r=this.getValueOfPropertyAt(D,0,a),y=this.getValueOfPropertyAt(D,0,"fill"),u=_+A*(1-this._fontSizeFraction),c=this.getHeightOfChar(D,0),p=this.getValueOfPropertyAt(D,0,"deltaY");for(var M=0,E=v.length;M<E;M++)if(b=this.__charBounds[D][M],w=this.getValueOfPropertyAt(D,M,a),x=this.getValueOfPropertyAt(D,M,"fill"),d=this.getHeightOfChar(D,M),g=this.getValueOfPropertyAt(D,M,"deltaY"),C&&w&&x)n.save(),n.fillStyle=y,n.translate(b.renderLeft,b.renderTop),n.rotate(b.angle),n.fillRect(-b.kernedWidth/2,L*d+g,b.kernedWidth,this.fontSize/15),n.restore();else if((w!==r||x!==y||d!==c||g!==p)&&0<m){var R=S+h+f;"rtl"===this.direction&&(R=this.width-R-m),r&&y&&(n.fillStyle=y,n.fillRect(R,u+L*c+p,m,this.fontSize/15)),f=b.left,m=b.width,r=w,y=x,c=d,p=g}else m+=b.kernedWidth;R=S+h+f,"rtl"===this.direction&&(R=this.width-R-m),n.fillStyle=x,w&&x&&n.fillRect(R,u+L*c+p,m-I,this.fontSize/15),_+=l}else _+=l;this._removeShadow(n)}},_getFontDeclaration:function(n,a){var l=n||this,c=this.fontFamily,d=-1<t.Text.genericFonts.indexOf(c.toLowerCase()),h=void 0===c||-1<c.indexOf("'")||-1<c.indexOf(",")||-1<c.indexOf('"')||d?l.fontFamily:'"'+l.fontFamily+'"';return[t.isLikelyNode?l.fontWeight:l.fontStyle,t.isLikelyNode?l.fontStyle:l.fontWeight,a?this.CACHE_FONT_SIZE+"px":l.fontSize+"px",h].join(" ")},render:function(n){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",n)))},_splitTextIntoLines:function(n){for(var a=n.split(this._reNewline),l=new Array(a.length),c=["\n"],d=[],h=0;h<a.length;h++)l[h]=t.util.string.graphemeSplit(a[h]),d=d.concat(l[h],c);return d.pop(),{_unwrappedLines:l,lines:a,graphemeText:d,graphemeLines:l}},toObject:function(n){var a=o.concat(n),l=this.callSuper("toObject",a);return l.styles=s(this.styles,!0),l.path&&(l.path=this.path.toObject()),l},set:function(n,a){this.callSuper("set",n,a);var l=!1,c=!1;if("object"==typeof n)for(var d in n)"path"===d&&this.setPathInfo(),l=l||-1!==this._dimensionAffectingProps.indexOf(d),c=c||"path"===d;else l=-1!==this._dimensionAffectingProps.indexOf(n),c="path"===n;return c&&this.setPathInfo(),l&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(n,a,l){if(!n)return a(null);var c=t.parseAttributes(n,t.Text.ATTRIBUTE_NAMES),d=c.textAnchor||"left";if((l=t.util.object.extend(l?s(l):{},c)).top=l.top||0,l.left=l.left||0,c.textDecoration){var h=c.textDecoration;-1!==h.indexOf("underline")&&(l.underline=!0),-1!==h.indexOf("overline")&&(l.overline=!0),-1!==h.indexOf("line-through")&&(l.linethrough=!0),delete l.textDecoration}"dx"in c&&(l.left+=c.dx),"dy"in c&&(l.top+=c.dy),"fontSize"in l||(l.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var p="";"textContent"in n?p=n.textContent:"firstChild"in n&&null!==n.firstChild&&"data"in n.firstChild&&null!==n.firstChild.data&&(p=n.firstChild.data),p=p.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var g=l.strokeWidth;l.strokeWidth=0;var v=new t.Text(p,l),r=v.getScaledHeight()/v.height,u=((v.height+v.strokeWidth)*v.lineHeight-v.height)*r,f=v.getScaledHeight()+u,m=0;"center"===d&&(m=v.getScaledWidth()/2),"right"===d&&(m=v.getScaledWidth()),v.set({left:v.left-m,top:v.top-(f-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:void 0!==g?g:1}),a(v)},t.Text.fromObject=function(n,a){var l=s(n),c=n.path;return delete l.path,t.Object._fromObject("Text",l,function(d){c?t.Object._fromObject("Path",c,function(h){d.set("path",h),a(d)},"path"):a(d)},"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text)}}(typeof exports<"u"?exports:this),fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(e){if(!this.styles||void 0!==e&&!this.styles[e])return!0;var t=void 0===e?this.styles:{line:this.styles[e]};for(var s in t)for(var o in t[s])for(var n in t[s][o])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||""===e||void 0!==t&&!this.styles[t])return!1;var s=void 0===t?this.styles:{0:this.styles[t]};for(var o in s)for(var n in s[o])if(void 0!==s[o][n][e])return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||""===e)return!1;var t,s,o=this.styles,n=0,a=!0,l=0;for(var c in o){for(var d in t=0,o[c]){var h;n++,(h=o[c][d]).hasOwnProperty(e)?(s?h[e]!==s&&(a=!1):s=h[e],h[e]===this[e]&&delete h[e]):a=!1,0!==Object.keys(h).length?t++:delete o[c][d]}0===t&&delete o[c]}for(var p=0;p<this._textLines.length;p++)l+=this._textLines[p].length;a&&n===l&&(this[e]=s,this.removeStyle(e))},removeStyle:function(e){if(this.styles&&e&&""!==e){var t,s,o,n=this.styles;for(s in n){for(o in t=n[s])delete t[o][e],0===Object.keys(t[o]).length&&delete t[o];0===Object.keys(t).length&&delete n[s]}}},_extendStyles:function(e,t){var s=this.get2DCursorLocation(e);this._getLineStyle(s.lineIndex)||this._setLineStyle(s.lineIndex),this._getStyleDeclaration(s.lineIndex,s.charIndex)||this._setStyleDeclaration(s.lineIndex,s.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(s.lineIndex,s.charIndex),t)},get2DCursorLocation:function(e,t){void 0===e&&(e=this.selectionStart);for(var s=t?this._unwrappedTextLines:this._textLines,o=s.length,n=0;n<o;n++){if(e<=s[n].length)return{lineIndex:n,charIndex:e};e-=s[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:s[n-1].length<e?s[n-1].length:e}},getSelectionStyles:function(e,t,s){void 0===e&&(e=this.selectionStart||0),void 0===t&&(t=this.selectionEnd||e);for(var o=[],n=e;n<t;n++)o.push(this.getStyleAtPosition(n,s));return o},getStyleAtPosition:function(e,t){var s=this.get2DCursorLocation(e);return(t?this.getCompleteStyleDeclaration(s.lineIndex,s.charIndex):this._getStyleDeclaration(s.lineIndex,s.charIndex))||{}},setSelectionStyles:function(e,t,s){void 0===t&&(t=this.selectionStart||0),void 0===s&&(s=this.selectionEnd||t);for(var o=t;o<s;o++)this._extendStyles(o,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var s=this.styles&&this.styles[e];return s?s[t]:null},getCompleteStyleDeclaration:function(e,t){for(var s,o=this._getStyleDeclaration(e,t)||{},n={},a=0;a<this._styleProperties.length;a++)n[s=this._styleProperties[a]]=void 0===o[s]?this[s]:o[s];return n},_setStyleDeclaration:function(e,t,s){this.styles[e][t]=s},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}}),function(){function e(t){t.textDecoration&&(-1<t.textDecoration.indexOf("underline")&&(t.underline=!0),-1<t.textDecoration.indexOf("line-through")&&(t.linethrough=!0),-1<t.textDecoration.indexOf("overline")&&(t.overline=!0),delete t.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,s){this.callSuper("initialize",t,s),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,s){this[t]!==s&&(this._fireSelectionChanged(),this[t]=s),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var s=this.canvas.contextTop,o=this.canvas.viewportTransform;s.save(),s.transform(o[0],o[1],o[2],o[3],o[4],o[5]),this.transform(s),this._clearTextArea(s),t||s.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this._getCursorBoundaries(),s=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(t,s):this.renderSelection(t,s),s.restore()}},_clearTextArea:function(t){var s=this.width+4,o=this.height+4;t.clearRect(-s/2,-o/2,s,o)},_getCursorBoundaries:function(t){void 0===t&&(t=this.selectionStart);var s=this._getLeftOffset(),o=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t);return{left:s,top:o,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var s,o,n,a,l=0,c=0,d=this.get2DCursorLocation(t);n=d.charIndex,o=d.lineIndex;for(var h=0;h<o;h++)l+=this.getHeightOfLine(h);s=this._getLineLeftOffset(o);var p=this.__charBounds[o][n];return p&&(c=p.left),0!==this.charSpacing&&n===this._textLines[o].length&&(c-=this._getWidthOfCharSpacing()),a={top:l,left:s+(0<c?c:0)},"rtl"===this.direction&&(a.left*=-1),this.cursorOffsetCache=a,this.cursorOffsetCache},renderCursor:function(t,s){var o=this.get2DCursorLocation(),n=o.lineIndex,a=0<o.charIndex?o.charIndex-1:0,l=this.getValueOfPropertyAt(n,a,"fontSize"),c=this.scaleX*this.canvas.getZoom(),d=this.cursorWidth/c,h=t.topOffset,p=this.getValueOfPropertyAt(n,a,"deltaY");h+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-l*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,s),s.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,a,"fill"),s.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,s.fillRect(t.left+t.leftOffset-d/2,h+t.top+p,d,l)},renderSelection:function(t,s){for(var o=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=-1!==this.textAlign.indexOf("justify"),l=this.get2DCursorLocation(o),c=this.get2DCursorLocation(n),d=l.lineIndex,h=c.lineIndex,p=l.charIndex<0?0:l.charIndex,g=c.charIndex<0?0:c.charIndex,v=d;v<=h;v++){var r,u=this._getLineLeftOffset(v)||0,f=this.getHeightOfLine(v),m=0,b=0;if(v===d&&(m=this.__charBounds[d][p].left),d<=v&&v<h)b=a&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===h)if(0===g)b=this.__charBounds[h][g].left;else{var w=this._getWidthOfCharSpacing();b=this.__charBounds[h][g-1].left+this.__charBounds[h][g-1].width-w}r=f,(this.lineHeight<1||v===h&&1<this.lineHeight)&&(f/=this.lineHeight);var A=t.left+u+m,x=b-m,y=f,S=0;this.inCompositionMode?(s.fillStyle=this.compositionColor||"black",y=1,S=f):s.fillStyle=this.selectionColor,"rtl"===this.direction&&(A=this.width-A-x),s.fillRect(A,t.top+t.topOffset+S,x,y),t.topOffset+=r}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0);return{l:t.lineIndex,c:0<t.charIndex?t.charIndex-1:0}}}),fabric.IText.fromObject=function(t,s){if(e(t),t.styles)for(var o in t.styles)for(var n in t.styles[o])e(t.styles[o][n]);fabric.Object._fromObject("IText",t,s,"text")}}(),function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",function(){var s=t.canvas;s&&(s._hasITextHandlers||(s._hasITextHandlers=!0,t._initCanvasHandlers(s)),s._iTextInstances=s._iTextInstances||[],s._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var s=t.canvas;s&&(s._iTextInstances=s._iTextInstances||[],fabric.util.removeFromArray(s._iTextInstances,t),0===s._iTextInstances.length&&(s._hasITextHandlers=!1,t._removeCanvasHandlers(s)))})},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(s){s.__isMousedown=!1})},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,s,o,n){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",s,{duration:o,onComplete:function(){a.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var s=this,o=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){s._tick()},o)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,s=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&s&&s.clearContext(s.contextTop||s.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var s=0,o=t-1;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)s++,o--;for(;/\S/.test(this._text[o])&&-1<o;)s++,o--;return t-s},findWordBoundaryRight:function(t){var s=0,o=t;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)s++,o++;for(;/\S/.test(this._text[o])&&o<this._text.length;)s++,o++;return t+s},findLineBoundaryLeft:function(t){for(var s=0,o=t-1;!/\n/.test(this._text[o])&&-1<o;)s++,o--;return t-s},findLineBoundaryRight:function(t){for(var s=0,o=t;!/\n/.test(this._text[o])&&o<this._text.length;)s++,o++;return t+s},searchWordBoundary:function(t,s){for(var o=this._text,n=this._reSpace.test(o[t])?t-1:t,a=o[n],l=fabric.reNonWord;!l.test(a)&&0<n&&n<o.length;)a=o[n+=s];return l.test(a)&&(n+=1===s?0:1),n},selectWord:function(t){var s=this.searchWordBoundary(t=t||this.selectionStart,-1),o=this.searchWordBoundary(t,1);this.selectionStart=s,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){var s=this.findLineBoundaryLeft(t=t||this.selectionStart),o=this.findLineBoundaryRight(t);return this.selectionStart=s,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll()),this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(s){s.selected=!1,s.isEditing&&s.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var s=this.getSelectionStartFromPointer(t.e),o=this.selectionStart,n=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&o!==n||o!==s&&n!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===o&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,s,o){var n=o.slice(0,t),a=fabric.util.string.graphemeSplit(n).length;if(t===s)return{selectionStart:a,selectionEnd:a};var l=o.slice(t,s);return{selectionStart:a,selectionEnd:a+fabric.util.string.graphemeSplit(l).length}},fromGraphemeToStringSelection:function(t,s,o){var n=o.slice(0,t).join("").length;return t===s?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+o.slice(t,s).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,s=this._getCursorBoundaries(t),o=this.get2DCursorLocation(t),l=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"fontSize")*this.lineHeight,c=s.leftOffset,d=this.calcTransformMatrix(),h={x:s.left+c,y:s.top+s.topOffset+l},p=this.canvas.getRetinaScaling(),g=this.canvas.upperCanvasEl,v=g.width/p,r=g.height/p,u=v-l,f=r-l,m=g.clientWidth/v,b=g.clientHeight/r;return h=fabric.util.transformPoint(h,d),(h=fabric.util.transformPoint(h,this.canvas.viewportTransform)).x*=m,h.y*=b,h.x<0&&(h.x=0),h.x>u&&(h.x=u),h.y<0&&(h.y=0),h.y>f&&(h.y=f),h.x+=this.canvas._offset.left,h.y+=this.canvas._offset.top,{left:h.x+"px",top:h.y+"px",fontSize:l+"px",charHeight:l}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text,s=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,s&&(s.blur&&s.blur(),s.parentNode&&s.parentNode.removeChild(s)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,s){var o,n,a=this.get2DCursorLocation(t,!0),l=this.get2DCursorLocation(s,!0),c=a.lineIndex,d=a.charIndex,h=l.lineIndex,p=l.charIndex;if(c!==h){if(this.styles[c])for(o=d;o<this._unwrappedTextLines[c].length;o++)delete this.styles[c][o];if(this.styles[h])for(o=p;o<this._unwrappedTextLines[h].length;o++)(n=this.styles[h][o])&&(this.styles[c]||(this.styles[c]={}),this.styles[c][d+o-p]=n);for(o=c+1;o<=h;o++)delete this.styles[o];this.shiftLineStyles(h,c-h)}else if(this.styles[c]){n=this.styles[c];var g,v,r=p-d;for(o=d;o<p;o++)delete n[o];for(v in this.styles[c])p<=(g=parseInt(v,10))&&(n[g-r]=n[v],delete n[v])}},shiftLineStyles:function(t,s){var o=e(this.styles);for(var n in this.styles){var a=parseInt(n,10);t<a&&(this.styles[a+s]=o[a],o[a-s]||delete this.styles[a])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(t,s,o,n){var a,l={},c=!1,d=this._unwrappedTextLines[t].length===s;for(var h in o||(o=1),this.shiftLineStyles(t,o),this.styles[t]&&(a=this.styles[t][0===s?s:s-1]),this.styles[t]){var p=parseInt(h,10);s<=p&&(c=!0,l[p-s]=this.styles[t][h],d&&0===s||delete this.styles[t][h])}var g=!1;for(c&&!d&&(this.styles[t+o]=l,g=!0),g&&o--;0<o;)n&&n[o-1]?this.styles[t+o]={0:e(n[o-1])}:a?this.styles[t+o]={0:e(a)}:delete this.styles[t+o],o--;this._forceClearCache=!0},insertCharStyleObject:function(t,s,o,n){this.styles||(this.styles={});var a=this.styles[t],l=a?e(a):{};for(var c in o||(o=1),l){var d=parseInt(c,10);s<=d&&(a[d+o]=l[d],l[d-o]||delete a[d])}if(this._forceClearCache=!0,n)for(;o--;)Object.keys(n[o]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][s+o]=e(n[o]));else if(a)for(var h=a[s?s-1:1];h&&o--;)this.styles[t][s+o]=e(h)},insertNewStyleBlock:function(t,s,o){for(var n=this.get2DCursorLocation(s,!0),a=[0],l=0,c=0;c<t.length;c++)"\n"===t[c]?a[++l]=0:a[l]++;for(0<a[0]&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,a[0],o),o=o&&o.slice(a[0]+1)),l&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+a[0],l),c=1;c<l;c++)0<a[c]?this.insertCharStyleObject(n.lineIndex+c,0,a[c],o):o&&this.styles[n.lineIndex+c]&&o[0]&&(this.styles[n.lineIndex+c][0]=o[0]),o=o&&o.slice(a[c]+1);0<a[c]&&this.insertCharStyleObject(n.lineIndex+c,0,a[c],o)},setSelectionStartEndWithShift:function(t,s,o){o<=t?(s===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=o):t<o&&o<s?"right"===this._selectionDirection?this.selectionEnd=o:this.selectionStart=o:(s===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=s),this.selectionEnd=o)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(this.canvas){this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!(!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&1!==e.e.button)){if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e);e.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t,s=this.getLocalPointer(e),o=0,n=0,a=0,l=0,c=0,d=0,h=this._textLines.length;d<h&&a<=s.y;d++)a+=this.getHeightOfLine(d)*this.scaleY,0<(c=d)&&(l+=this._textLines[d-1].length+this.missingNewlineOffset(d-1));n=this._getLineLeftOffset(c)*this.scaleX,t=this._textLines[c],"rtl"===this.direction&&(s.x=this.width*this.scaleX-s.x+n);for(var p=0,g=t.length;p<g&&(o=n,(n+=this.__charBounds[c][p].kernedWidth*this.scaleX)<=s.x);p++)l++;return this._getNewSelectionStartFromOffset(s,o,n,l,g)},_getNewSelectionStartFromOffset:function(e,t,s,o,n){var l=s-e.x,c=o+(e.x-t<l||l<0?0:1);return this.flipX&&(c=n-c),c>this._text.length&&(c=this._text.length),c}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+e.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing){var t="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),33<=e.keyCode&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),this.isEditing){var s,o,n,a,l,c=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,d=this._text.length,h=c.length,p=h-d,g=this.selectionStart,v=this.selectionEnd,r=g!==v;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var u=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),f=g>u.selectionStart;r?(s=this._text.slice(g,v),p+=v-g):h<d&&(s=f?this._text.slice(v+p,v):this._text.slice(g,g-p)),o=c.slice(u.selectionEnd-p,u.selectionEnd),s&&s.length&&(o.length&&(n=this.getSelectionStyles(g,g+1,!1),n=o.map(function(){return n[0]})),r?(a=g,l=v):f?(a=v-s.length,l=v):l=(a=v)+s.length,this.removeStyleFromTo(a,l)),o.length&&(t&&o.join("")===fabric.copiedText&&!fabric.disableStyleCopyPaste&&(n=fabric.copiedTextStyle),this.insertNewStyleBlock(o,g,n)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=fabric.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(e,t){var s,o=this._getLineLeftOffset(e);return 0<t&&(o+=(s=this.__charBounds[e][t-1]).left+s.width),o},getDownCursorOffset:function(e,t){var s=this._getSelectionForOffset(e,t),o=this.get2DCursorLocation(s),n=o.lineIndex;if(n===this._textLines.length-1||e.metaKey||34===e.keyCode)return this._text.length-s;var a=o.charIndex,l=this._getWidthBeforeCursor(n,a),c=this._getIndexOnLine(n+1,l);return this._textLines[n].slice(a).length+c+1+this.missingNewlineOffset(n)},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var s=this._getSelectionForOffset(e,t),o=this.get2DCursorLocation(s),n=o.lineIndex;if(0===n||e.metaKey||33===e.keyCode)return-s;var a=o.charIndex,l=this._getWidthBeforeCursor(n,a),c=this._getIndexOnLine(n-1,l),d=this._textLines[n].slice(0,a),h=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+c-d.length+(1-h)},_getIndexOnLine:function(e,t){for(var s,o,n=this._textLines[e],a=this._getLineLeftOffset(e),l=0,c=0,d=n.length;c<d;c++)if(t<(a+=s=this.__charBounds[e][c].width)){o=!0;var p=a,g=Math.abs(a-s-t);l=Math.abs(p-t)<g?c:c-1;break}return o||(l=n.length-1),l},moveCursorDown:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var s=this["get"+e+"CursorOffset"](t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),0!==s&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+e:this.selectionEnd+e),0!==e},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e},moveCursorLeft:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,s){var o;if(e.altKey)o=this["findWordBoundary"+s](this[t]);else{if(!e.metaKey&&35!==e.keyCode&&36!==e.keyCode)return this[t]+="Left"===s?-1:1,!0;o=this["findLineBoundary"+s](this[t])}if(void 0!==typeof o&&this[t]!==o)return this[t]=o,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(e,"selectionStart")):void 0},moveCursorRight:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var s="moveCursor"+e+"With";this._currentCursorOpacity=1,this[s+=t.shiftKey?"Shift":"outShift"](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(e,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){void 0===t&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,s,o){void 0===o&&(o=s),s<o&&this.removeStyleFromTo(s,o);var n=fabric.util.string.graphemeSplit(e);this.insertNewStyleBlock(n,s,t),this._text=[].concat(this._text.slice(0,s),n,this._text.slice(o)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var e=fabric.util.toFixed,t=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var s=this._getSVGLeftTopOffsets(),o=this._getSVGTextAndBg(s.textTop,s.textLeft);return this._wrapSVGTextAndBg(o)},toSVG:function(s){return this._createBaseSVGMarkup(this._toSVG(),{reviver:s,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(s){var o=this.getSvgTextDecoration(this);return[s.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",o?'text-decoration="'+o+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",s.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(s,o){var n,a=[],l=[],c=s;this._setSVGBg(l);for(var d=0,h=this._textLines.length;d<h;d++)n=this._getLineLeftOffset(d),(this.textBackgroundColor||this.styleHas("textBackgroundColor",d))&&this._setSVGTextLineBg(l,d,o+n,c),this._setSVGTextLineText(a,d,o+n,c),c+=this.getHeightOfLine(d);return{textSpans:a,textBgRects:l}},_createTextCharSpan:function(s,o,n,a){var l=s!==s.trim()||s.match(t),c=this.getSvgSpanStyles(o,l),d=c?'style="'+c+'"':"",h=o.deltaY,p="",g=fabric.Object.NUM_FRACTION_DIGITS;return h&&(p=' dy="'+e(h,g)+'" '),['<tspan x="',e(n,g),'" y="',e(a,g),'" ',p,d,">",fabric.util.string.escapeXml(s),"</tspan>"].join("")},_setSVGTextLineText:function(s,o,n,a){var l,c,d,h,p,g=this.getHeightOfLine(o),v=-1!==this.textAlign.indexOf("justify"),r="",u=0,f=this._textLines[o];a+=g*(1-this._fontSizeFraction)/this.lineHeight;for(var m=0,b=f.length-1;m<=b;m++)p=m===b||this.charSpacing,r+=f[m],d=this.__charBounds[o][m],0===u?(n+=d.kernedWidth-d.width,u+=d.width):u+=d.kernedWidth,v&&!p&&this._reSpaceAndTab.test(f[m])&&(p=!0),p||(l=l||this.getCompleteStyleDeclaration(o,m),c=this.getCompleteStyleDeclaration(o,m+1),p=this._hasStyleChangedForSvg(l,c)),p&&(h=this._getStyleDeclaration(o,m)||{},s.push(this._createTextCharSpan(r,h,n,a)),r="",l=c,n+=u,u=0)},_pushTextBgRect:function(s,o,n,a,l,c){var d=fabric.Object.NUM_FRACTION_DIGITS;s.push("\t\t<rect ",this._getFillAttributes(o),' x="',e(n,d),'" y="',e(a,d),'" width="',e(l,d),'" height="',e(c,d),'"></rect>\n')},_setSVGTextLineBg:function(s,o,n,a){for(var l,c,d=this._textLines[o],h=this.getHeightOfLine(o)/this.lineHeight,p=0,g=0,v=this.getValueOfPropertyAt(o,0,"textBackgroundColor"),r=0,u=d.length;r<u;r++)l=this.__charBounds[o][r],(c=this.getValueOfPropertyAt(o,r,"textBackgroundColor"))!==v?(v&&this._pushTextBgRect(s,v,n+g,a,p,h),g=l.left,p=l.width,v=c):p+=l.kernedWidth;c&&this._pushTextBgRect(s,c,n+g,a,p,h)},_getFillAttributes:function(s){var o=s&&"string"==typeof s?new fabric.Color(s):"";return o&&o.getSource()&&1!==o.getAlpha()?'opacity="'+o.getAlpha()+'" fill="'+o.setAlpha(1).toRgb()+'"':'fill="'+s+'"'},_getSVGLineTopOffset:function(s){for(var o,n=0,a=0;a<s;a++)n+=this.getHeightOfLine(a);return o=this.getHeightOfLine(a),{lineTop:n,offset:(this._fontSizeMult-this._fontSizeFraction)*o/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(s){return fabric.Object.prototype.getSvgStyles.call(this,s)+" white-space: pre;"}})}(),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(s){for(var o=0,n=0,a=0,l={},c=0;c<s.graphemeLines.length;c++)"\n"===s.graphemeText[a]&&0<c?(n=0,a++,o++):!this.splitByGrapheme&&this._reSpaceAndTab.test(s.graphemeText[a])&&0<c&&(n++,a++),l[c]={line:o,offset:n},a+=s.graphemeLines[c].length,n+=s.graphemeLines[c].length;return l},styleHas:function(s,o){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[o];n&&(o=n.line)}return t.Text.prototype.styleHas.call(this,s,o)},isEmptyStyles:function(s){if(!this.styles)return!0;var o,n,a=0,l=!1,c=this._styleMap[s],d=this._styleMap[s+1];for(var h in c&&(s=c.line,a=c.offset),d&&(l=d.line===s,o=d.offset),n=void 0===s?this.styles:{line:this.styles[s]})for(var p in n[h])if(a<=p&&(!l||p<o))for(var g in n[h][p])return!1;return!0},_getStyleDeclaration:function(s,o){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[s];if(!n)return null;s=n.line,o=n.offset+o}return this.callSuper("_getStyleDeclaration",s,o)},_setStyleDeclaration:function(s,o,n){var a=this._styleMap[s];this.styles[s=a.line][o=a.offset+o]=n},_deleteStyleDeclaration:function(s,o){var n=this._styleMap[s];delete this.styles[s=n.line][o=n.offset+o]},_getLineStyle:function(s){return!!this.styles[this._styleMap[s].line]},_setLineStyle:function(s){this.styles[this._styleMap[s].line]={}},_wrapText:function(s,o){var n,a=[];for(this.isWrapping=!0,n=0;n<s.length;n++)a=a.concat(this._wrapLine(s[n],n,o));return this.isWrapping=!1,a},_measureWord:function(s,o,n){var a,l=0;n=n||0;for(var c=0,d=s.length;c<d;c++)l+=this._getGraphemeBox(s[c],o,c+n,a,!0).kernedWidth,a=s[c];return l},_wrapLine:function(s,o,n,a){var l=0,c=this.splitByGrapheme,d=[],h=[],p=c?t.util.string.graphemeSplit(s):s.split(this._wordJoiners),g="",v=0,r=c?"":" ",u=0,f=0,m=0,b=!0,w=this._getWidthOfCharSpacing();a=a||0,0===p.length&&p.push([]),n-=a;for(var A=0;A<p.length;A++)g=c?p[A]:t.util.string.graphemeSplit(p[A]),u=this._measureWord(g,o,v),v+=g.length,n<(l+=f+u-w)&&!b?(d.push(h),h=[],l=u,b=!0):l+=w,b||c||h.push(r),h=h.concat(g),f=c?0:this._measureWord([r],o,v),v++,b=!1,m<u&&(m=u);return A&&d.push(h),m+a>this.dynamicMinWidth&&(this.dynamicMinWidth=m-w+a),d},isEndOfWrapping:function(s){return!this._styleMap[s+1]||this._styleMap[s+1].line!==this._styleMap[s].line},missingNewlineOffset:function(s){return this.splitByGrapheme?this.isEndOfWrapping(s)?1:0:1},_splitTextIntoLines:function(s){for(var o=t.Text.prototype._splitTextIntoLines.call(this,s),n=this._wrapText(o.lines,this.width),a=new Array(n.length),l=0;l<n.length;l++)a[l]=n[l].join("");return o.lines=a,o.graphemeLines=n,o},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var s={};for(var o in this._styleMap)this._textLines[o]&&(s[this._styleMap[o].line]=1);for(var o in this.styles)s[o]||delete this.styles[o]},toObject:function(s){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(s))}}),t.Textbox.fromObject=function(s,o){return t.Object._fromObject("Textbox",s,o,"text")}}(typeof exports<"u"?exports:this),function(){var e=fabric.controlsUtils,t=e.scaleSkewCursorStyleHandler,s=e.scaleCursorStyleHandler,o=e.scalingEqually,n=e.scalingYOrSkewingX,a=e.scalingXOrSkewingY,l=e.scaleOrSkewActionName,c=fabric.Object.prototype.controls;if(c.ml=new fabric.Control({x:-.5,y:0,cursorStyleHandler:t,actionHandler:a,getActionName:l}),c.mr=new fabric.Control({x:.5,y:0,cursorStyleHandler:t,actionHandler:a,getActionName:l}),c.mb=new fabric.Control({x:0,y:.5,cursorStyleHandler:t,actionHandler:n,getActionName:l}),c.mt=new fabric.Control({x:0,y:-.5,cursorStyleHandler:t,actionHandler:n,getActionName:l}),c.tl=new fabric.Control({x:-.5,y:-.5,cursorStyleHandler:s,actionHandler:o}),c.tr=new fabric.Control({x:.5,y:-.5,cursorStyleHandler:s,actionHandler:o}),c.bl=new fabric.Control({x:-.5,y:.5,cursorStyleHandler:s,actionHandler:o}),c.br=new fabric.Control({x:.5,y:.5,cursorStyleHandler:s,actionHandler:o}),c.mtr=new fabric.Control({x:0,y:-.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),fabric.Textbox){var d=fabric.Textbox.prototype.controls={};d.mtr=c.mtr,d.tr=c.tr,d.br=c.br,d.tl=c.tl,d.bl=c.bl,d.mt=c.mt,d.mb=c.mb,d.mr=new fabric.Control({x:.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"}),d.ml=new fabric.Control({x:-.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"})}}(),function(e){if("object"==typeof exports&&typeof module<"u")module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;typeof window<"u"?t=window:typeof global<"u"?t=global:typeof self<"u"&&(t=self),t.pako=e()}}(function(){return function e(t,s,o){function n(c,d){if(!s[c]){if(!t[c]){var h="function"==typeof require&&require;if(!d&&h)return h(c,!0);if(a)return a(c,!0);throw Error("Cannot find module '"+c+"'")}d=s[c]={exports:{}},t[c][0].call(d.exports,function(p){return n(t[c][1][p]||p)},d,d.exports,e,t,s,o)}return s[c].exports}for(var a="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,s){function o(v,r){if((r=new g(r)).push(v,!0),r.err)throw r.msg;return r.result}var n=e("./zlib/inflate.js"),a=e("./utils/common"),l=e("./utils/strings"),c=e("./zlib/constants"),d=e("./zlib/messages"),h=e("./zlib/zstream"),p=e("./zlib/gzheader"),g=function(v){var r=this.options=a.assign({chunkSize:16384,windowBits:0,to:""},v||{});if(r.raw&&0<=r.windowBits&&16>r.windowBits&&(r.windowBits=-r.windowBits,0===r.windowBits&&(r.windowBits=-15)),!(0<=r.windowBits&&16>r.windowBits)||v&&v.windowBits||(r.windowBits+=32),15<r.windowBits&&48>r.windowBits&&0==(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0,(v=n.inflateInit2(this.strm,r.windowBits))!==c.Z_OK)throw Error(d[v]);this.header=new p,n.inflateGetHeader(this.strm,this.header)};g.prototype.push=function(v,r){var u=this.strm,f=this.options.chunkSize;if(this.ended)return!1;r=r===~~r?r:!0===r?c.Z_FINISH:c.Z_NO_FLUSH,u.input="string"==typeof v?l.binstring2buf(v):v,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new a.Buf8(f),u.next_out=0,u.avail_out=f),(v=n.inflate(u,c.Z_NO_FLUSH))!==c.Z_STREAM_END&&v!==c.Z_OK)return this.onEnd(v),this.ended=!0,!1;if(u.next_out&&(0===u.avail_out||v===c.Z_STREAM_END||0===u.avail_in&&r===c.Z_FINISH))if("string"===this.options.to){var m=l.utf8border(u.output,u.next_out),b=u.next_out-m,w=l.buf2string(u.output,m);u.next_out=b,u.avail_out=f-b,b&&a.arraySet(u.output,u.output,m,b,0),this.onData(w)}else this.onData(a.shrinkBuf(u.output,u.next_out))}while((0<u.avail_in||0===u.avail_out)&&v!==c.Z_STREAM_END);return v===c.Z_STREAM_END&&(r=c.Z_FINISH),r!==c.Z_FINISH||(v=n.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===c.Z_OK)},g.prototype.onData=function(v){this.chunks.push(v)},g.prototype.onEnd=function(v){v===c.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},s.Inflate=g,s.inflate=o,s.inflateRaw=function(v,r){return(r=r||{}).raw=!0,o(v,r)},s.ungzip=o},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,"./zlib/messages":11,"./zlib/zstream":12}],2:[function(e,t,s){e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u",s.assign=function(a){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var c=l.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},s.shrinkBuf=function(a,l){return a.length===l?a:a.subarray?a.subarray(0,l):(a.length=l,a)};var o={arraySet:function(a,l,c,d,h){if(l.subarray&&a.subarray)a.set(l.subarray(c,c+d),h);else for(var p=0;p<d;p++)a[h+p]=l[c+p]},flattenChunks:function(a){var l,c,d=c=0;for(l=a.length;d<l;d++)c+=a[d].length;var h=new Uint8Array(c);for(d=c=0,l=a.length;d<l;d++){var p=a[d];h.set(p,c),c+=p.length}return h}},n={arraySet:function(a,l,c,d,h){for(var p=0;p<d;p++)a[h+p]=l[c+p]},flattenChunks:function(a){return[].concat.apply([],a)}};s.setTyped=function(a){a?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,o)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,n))},s.setTyped(e)},{}],3:[function(e,t,s){function o(d,h){if(65537>h&&(d.subarray&&l||!d.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(d,h));for(var p="",g=0;g<h;g++)p+=String.fromCharCode(d[g]);return p}var n=e("./common"),a=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}var c=new n.Buf8(256);for(e=0;256>e;e++)c[e]=252<=e?6:248<=e?5:240<=e?4:224<=e?3:192<=e?2:1;c[254]=c[254]=1,s.string2buf=function(d){var h,p,g=d.length,v=0;for(h=0;h<g;h++){var r=d.charCodeAt(h);if(55296==(64512&r)&&h+1<g){var u=d.charCodeAt(h+1);56320==(64512&u)&&(r=65536+(r-55296<<10)+(u-56320),h++)}v+=128>r?1:2048>r?2:65536>r?3:4}var f=new n.Buf8(v);for(h=p=0;p<v;h++)55296==(64512&(r=d.charCodeAt(h)))&&h+1<g&&56320==(64512&(u=d.charCodeAt(h+1)))&&(r=65536+(r-55296<<10)+(u-56320),h++),128>r?f[p++]=r:(2048>r?f[p++]=192|r>>>6:(65536>r?f[p++]=224|r>>>12:(f[p++]=240|r>>>18,f[p++]=128|r>>>12&63),f[p++]=128|r>>>6&63),f[p++]=128|63&r);return f},s.buf2binstring=function(d){return o(d,d.length)},s.binstring2buf=function(d){for(var h=new n.Buf8(d.length),p=0,g=h.length;p<g;p++)h[p]=d.charCodeAt(p);return h},s.buf2string=function(d,h){var p,g=h||d.length,v=Array(2*g);for(h=p=0;h<g;){var r=d[h++];if(128>r)v[p++]=r;else{var u=c[r];if(4<u)v[p++]=65533,h+=u-1;else{for(r&=2===u?31:3===u?15:7;1<u&&h<g;)r=r<<6|63&d[h++],u--;1<u?v[p++]=65533:65536>r?v[p++]=r:(v[p++]=55296|(r-=65536)>>10&1023,v[p++]=56320|1023&r)}}}return o(v,p)},s.utf8border=function(d,h){var p;for((h=h||d.length)>d.length&&(h=d.length),p=h-1;0<=p&&128==(192&d[p]);)p--;return 0>p||0===p?h:p+c[d[p]]>h?p:h}},{"./common":2}],4:[function(e,t,s){t.exports=function(o,n,a,l){var d,c=65535&o|0;for(o=o>>>16&65535|0;0!==a;){a-=d=2e3<a?2e3:a;do{o=o+(c=c+n[l++]|0)|0}while(--d);c%=65521,o%=65521}return c|o<<16|0}},{}],5:[function(e,t,s){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(e,t,s){var o=function(){for(var n,a=[],l=0;256>l;l++){n=l;for(var c=0;8>c;c++)n=1&n?3988292384^n>>>1:n>>>1;a[l]=n}return a}();t.exports=function(n,a,l,c){for(l=c+l,n^=-1;c<l;c++)n=n>>>8^o[255&(n^a[c])];return-1^n}},{}],7:[function(e,t,s){t.exports=function(){this.os=this.xflags=this.time=this.text=0,this.extra=null,this.extra_len=0,this.comment=this.name="",this.hcrc=0,this.done=!1}},{}],8:[function(e,t,s){t.exports=function(o,n){var a=o.state,l=o.next_in,c=o.input,d=l+(o.avail_in-5),h=o.next_out,p=o.output;n=h-(n-o.avail_out);var g=h+(o.avail_out-257),v=a.dmax,r=a.wsize,u=a.whave,f=a.wnext,m=a.window,b=a.hold,w=a.bits,A=a.lencode,x=a.distcode,y=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;e:do{15>w&&(b+=c[l++]<<w,b+=c[l++]<<(w+=8),w+=8);var _=A[b&y];t:for(;;){var C=_>>>24;if(b>>>=C,w-=C,0==(C=_>>>16&255))p[h++]=65535&_;else{if(!(16&C)){if(0==(64&C)){_=A[(65535&_)+(b&(1<<C)-1)];continue t}32&C?a.mode=12:(o.msg="invalid literal/length code",a.mode=30);break e}var I=65535&_;(C&=15)&&(w<C&&(b+=c[l++]<<w,w+=8),I+=b&(1<<C)-1,b>>>=C,w-=C),15>w&&(b+=c[l++]<<w,b+=c[l++]<<(w+=8),w+=8),_=x[b&S];i:for(;;){if(b>>>=C=_>>>24,w-=C,!(16&(C=_>>>16&255))){if(0==(64&C)){_=x[(65535&_)+(b&(1<<C)-1)];continue i}o.msg="invalid distance code",a.mode=30;break e}if(_&=65535,w<(C&=15)&&(b+=c[l++]<<w,(w+=8)<C&&(b+=c[l++]<<w,w+=8)),(_+=b&(1<<C)-1)>v){o.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=C,w-=C,_>(C=h-n)){if((C=_-C)>u&&a.sane){o.msg="invalid distance too far back",a.mode=30;break e}var L=0,D=m;if(0===f){if(L+=r-C,C<I){I-=C;do{p[h++]=m[L++]}while(--C);L=h-_,D=p}}else if(f<C){if(L+=r+f-C,(C-=f)<I){I-=C;do{p[h++]=m[L++]}while(--C);if(L=0,f<I){I-=C=f;do{p[h++]=m[L++]}while(--C);L=h-_,D=p}}}else if(L+=f-C,C<I){I-=C;do{p[h++]=m[L++]}while(--C);L=h-_,D=p}for(;2<I;)p[h++]=D[L++],p[h++]=D[L++],p[h++]=D[L++],I-=3;I&&(p[h++]=D[L++],1<I&&(p[h++]=D[L++]))}else{L=h-_;do{p[h++]=p[L++],p[h++]=p[L++],p[h++]=p[L++],I-=3}while(2<I);I&&(p[h++]=p[L++],1<I&&(p[h++]=p[L++]))}break}}break}}while(l<d&&h<g);w-=(I=w>>3)<<3,o.next_in=l-=I,o.next_out=h,o.avail_in=l<d?d-l+5:5-(l-d),o.avail_out=h<g?g-h+257:257-(h-g),a.hold=b&(1<<w)-1,a.bits=w}},{}],9:[function(e,t,s){function o(b){return(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.total=this.check=this.dmax=this.flags=0,this.head=null,this.wnext=this.whave=this.wsize=this.wbits=0,this.window=null,this.extra=this.offset=this.length=this.bits=this.hold=0,this.distcode=this.lencode=null,this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0,this.next=null,this.lens=new h.Buf16(320),this.work=new h.Buf16(288),this.distdyn=this.lendyn=null,this.was=this.back=this.sane=0}function a(b){if(!b||!b.state)return-2;var w=b.state;return b.total_in=b.total_out=w.total=0,b.msg="",w.wrap&&(b.adler=1&w.wrap),w.mode=1,w.last=0,w.havedict=0,w.dmax=32768,w.head=null,w.hold=0,w.bits=0,w.lencode=w.lendyn=new h.Buf32(852),w.distcode=w.distdyn=new h.Buf32(592),w.sane=1,w.back=-1,0}function l(b){if(!b||!b.state)return-2;var w=b.state;return w.wsize=0,w.whave=0,w.wnext=0,a(b)}function c(b,w){if(!b||!b.state)return-2;var A=b.state;if(0>w){var x=0;w=-w}else x=1+(w>>4),48>w&&(w&=15);return w&&(8>w||15<w)?-2:(null!==A.window&&A.wbits!==w&&(A.window=null),A.wrap=x,A.wbits=w,l(b))}function d(b,w){if(!b)return-2;var A=new n;return b.state=A,A.window=null,0!==(w=c(b,w))&&(b.state=null),w}var f,m,h=e("../utils/common"),p=e("./adler32"),g=e("./crc32"),v=e("./inffast"),r=e("./inftrees"),u=!0;s.inflateReset=l,s.inflateReset2=c,s.inflateResetKeep=a,s.inflateInit=function(b){return d(b,15)},s.inflateInit2=d,s.inflate=function(b,w){var A,x=new h.Buf8(4),y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!b||!b.state||!b.output||!b.input&&0!==b.avail_in)return-2;var S=b.state;12===S.mode&&(S.mode=13);var _=b.next_out,C=b.output,I=b.avail_out,L=b.next_in,D=b.input,O=b.avail_in,M=S.hold,E=S.bits,R=O,H=I,N=0;e:for(;;)switch(S.mode){case 1:if(0===S.wrap){S.mode=13;break}for(;16>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(2&S.wrap&&35615===M){S.check=0,x[0]=255&M,x[1]=M>>>8&255,S.check=g(S.check,x,2,0),E=M=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&M)<<8)+(M>>8))%31){b.msg="incorrect header check",S.mode=30;break}if(8!=(15&M)){b.msg="unknown compression method",S.mode=30;break}E-=4;var B=8+(15&(M>>>=4));if(0===S.wbits)S.wbits=B;else if(B>S.wbits){b.msg="invalid window size",S.mode=30;break}S.dmax=1<<B,b.adler=S.check=1,S.mode=512&M?10:12,E=M=0;break;case 2:for(;16>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(S.flags=M,8!=(255&S.flags)){b.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){b.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=M>>8&1),512&S.flags&&(x[0]=255&M,x[1]=M>>>8&255,S.check=g(S.check,x,2,0)),E=M=0,S.mode=3;case 3:for(;32>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}S.head&&(S.head.time=M),512&S.flags&&(x[0]=255&M,x[1]=M>>>8&255,x[2]=M>>>16&255,x[3]=M>>>24&255,S.check=g(S.check,x,4,0)),E=M=0,S.mode=4;case 4:for(;16>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}S.head&&(S.head.xflags=255&M,S.head.os=M>>8),512&S.flags&&(x[0]=255&M,x[1]=M>>>8&255,S.check=g(S.check,x,2,0)),E=M=0,S.mode=5;case 5:if(1024&S.flags){for(;16>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}S.length=M,S.head&&(S.head.extra_len=M),512&S.flags&&(x[0]=255&M,x[1]=M>>>8&255,S.check=g(S.check,x,2,0)),E=M=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags){var P=S.length;if(P>O&&(P=O),P&&(S.head&&(B=S.head.extra_len-S.length,S.head.extra||(S.head.extra=Array(S.head.extra_len)),h.arraySet(S.head.extra,D,L,P,B)),512&S.flags&&(S.check=g(S.check,D,P,L)),O-=P,L+=P,S.length-=P),S.length)break e}S.length=0,S.mode=7;case 7:if(2048&S.flags){if(0===O)break e;P=0;do{B=D[L+P++],S.head&&B&&65536>S.length&&(S.head.name+=String.fromCharCode(B))}while(B&&P<O);if(512&S.flags&&(S.check=g(S.check,D,P,L)),O-=P,L+=P,B)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(0===O)break e;P=0;do{B=D[L+P++],S.head&&B&&65536>S.length&&(S.head.comment+=String.fromCharCode(B))}while(B&&P<O);if(512&S.flags&&(S.check=g(S.check,D,P,L)),O-=P,L+=P,B)break e}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;16>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(M!==(65535&S.check)){b.msg="header crc mismatch",S.mode=30;break}E=M=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),b.adler=S.check=0,S.mode=12;break;case 10:for(;32>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}b.adler=S.check=o(M),E=M=0,S.mode=11;case 11:if(0===S.havedict)return b.next_out=_,b.avail_out=I,b.next_in=L,b.avail_in=O,S.hold=M,S.bits=E,2;b.adler=S.check=1,S.mode=12;case 12:if(5===w||6===w)break e;case 13:if(S.last){M>>>=7&E,E-=7&E,S.mode=27;break}for(;3>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}switch(S.last=1&M,--E,3&(M>>>=1)){case 0:S.mode=14;break;case 1:if(B=S,u){for(f=new h.Buf32(512),m=new h.Buf32(32),P=0;144>P;)B.lens[P++]=8;for(;256>P;)B.lens[P++]=9;for(;280>P;)B.lens[P++]=7;for(;288>P;)B.lens[P++]=8;for(r(1,B.lens,0,288,f,0,B.work,{bits:9}),P=0;32>P;)B.lens[P++]=5;r(2,B.lens,0,32,m,0,B.work,{bits:5}),u=!1}if(B.lencode=f,B.lenbits=9,B.distcode=m,B.distbits=5,S.mode=20,6===w){M>>>=2,E-=2;break e}break;case 2:S.mode=17;break;case 3:b.msg="invalid block type",S.mode=30}M>>>=2,E-=2;break;case 14:for(M>>>=7&E,E-=7&E;32>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if((65535&M)!=(M>>>16^65535)){b.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&M,E=M=0,S.mode=15,6===w)break e;case 15:S.mode=16;case 16:if(P=S.length){if(P>O&&(P=O),P>I&&(P=I),0===P)break e;h.arraySet(C,D,L,P,_),O-=P,L+=P,I-=P,_+=P,S.length-=P;break}S.mode=12;break;case 17:for(;14>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(S.nlen=257+(31&M),E-=5,S.ndist=1+(31&(M>>>=5)),E-=5,S.ncode=4+(15&(M>>>=5)),M>>>=4,E-=4,286<S.nlen||30<S.ndist){b.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;3>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}S.lens[y[S.have++]]=7&M,M>>>=3,E-=3}for(;19>S.have;)S.lens[y[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,N=r(0,S.lens,0,19,S.lencode,0,S.work,P={bits:S.lenbits}),S.lenbits=P.bits,N){b.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;;){var z=S.lencode[M&(1<<S.lenbits)-1];if(P=z>>>24,z&=65535,P<=E)break;if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(16>z)M>>>=P,E-=P,S.lens[S.have++]=z;else{if(16===z){for(B=P+2;E<B;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(M>>>=P,E-=P,0===S.have){b.msg="invalid bit length repeat",S.mode=30;break}B=S.lens[S.have-1],P=3+(3&M),M>>>=2,E-=2}else if(17===z){for(B=P+3;E<B;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}E-=P,B=0,P=3+(7&(M>>>=P)),M>>>=3,E-=3}else{for(B=P+7;E<B;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}E-=P,B=0,P=11+(127&(M>>>=P)),M>>>=7,E-=7}if(S.have+P>S.nlen+S.ndist){b.msg="invalid bit length repeat",S.mode=30;break}for(;P--;)S.lens[S.have++]=B}}if(30===S.mode)break;if(0===S.lens[256]){b.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,N=r(1,S.lens,0,S.nlen,S.lencode,0,S.work,P={bits:S.lenbits}),S.lenbits=P.bits,N){b.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,N=r(2,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,P={bits:S.distbits}),S.distbits=P.bits,N){b.msg="invalid distances set",S.mode=30;break}if(S.mode=20,6===w)break e;case 20:S.mode=21;case 21:if(6<=O&&258<=I){b.next_out=_,b.avail_out=I,b.next_in=L,b.avail_in=O,S.hold=M,S.bits=E,v(b,H),_=b.next_out,C=b.output,I=b.avail_out,L=b.next_in,D=b.input,O=b.avail_in,M=S.hold,E=S.bits,12===S.mode&&(S.back=-1);break}for(S.back=0;P=(z=S.lencode[M&(1<<S.lenbits)-1])>>>24,B=z>>>16&255,z&=65535,!(P<=E);){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(B&&0==(240&B)){var J=P,q=B;for(A=z;P=(z=S.lencode[A+((M&(1<<J+q)-1)>>J)])>>>24,B=z>>>16&255,z&=65535,!(J+P<=E);){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}M>>>=J,E-=J,S.back+=J}if(M>>>=P,E-=P,S.back+=P,S.length=z,0===B){S.mode=26;break}if(32&B){S.back=-1,S.mode=12;break}if(64&B){b.msg="invalid literal/length code",S.mode=30;break}S.extra=15&B,S.mode=22;case 22:if(S.extra){for(B=S.extra;E<B;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}S.length+=M&(1<<S.extra)-1,M>>>=S.extra,E-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;P=(z=S.distcode[M&(1<<S.distbits)-1])>>>24,B=z>>>16&255,z&=65535,!(P<=E);){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(0==(240&B)){for(J=P,q=B,A=z;P=(z=S.distcode[A+((M&(1<<J+q)-1)>>J)])>>>24,B=z>>>16&255,z&=65535,!(J+P<=E);){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}M>>>=J,E-=J,S.back+=J}if(M>>>=P,E-=P,S.back+=P,64&B){b.msg="invalid distance code",S.mode=30;break}S.offset=z,S.extra=15&B,S.mode=24;case 24:if(S.extra){for(B=S.extra;E<B;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}S.offset+=M&(1<<S.extra)-1,M>>>=S.extra,E-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){b.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(0===I)break e;if(S.offset>(P=H-I)){if((P=S.offset-P)>S.whave&&S.sane){b.msg="invalid distance too far back",S.mode=30;break}B=P>S.wnext?S.wsize-(P-=S.wnext):S.wnext-P,P>S.length&&(P=S.length),J=S.window}else J=C,B=_-S.offset,P=S.length;P>I&&(P=I),I-=P,S.length-=P;do{C[_++]=J[B++]}while(--P);0===S.length&&(S.mode=21);break;case 26:if(0===I)break e;C[_++]=S.length,I--,S.mode=21;break;case 27:if(S.wrap){for(;32>E;){if(0===O)break e;O--,M|=D[L++]<<E,E+=8}if(b.total_out+=H-=I,S.total+=H,H&&(b.adler=S.check=S.flags?g(S.check,C,H,_-H):p(S.check,C,H,_-H)),H=I,(S.flags?M:o(M))!==S.check){b.msg="incorrect data check",S.mode=30;break}E=M=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;32>E;){if(0===O)break e;O--,M+=D[L++]<<E,E+=8}if(M!==(4294967295&S.total)){b.msg="incorrect length check",S.mode=30;break}E=M=0}S.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;default:return-2}return b.next_out=_,b.avail_out=I,b.next_in=L,b.avail_in=O,S.hold=M,S.bits=E,(S.wsize||H!==b.avail_out&&30>S.mode&&(27>S.mode||4!==w))&&(D=b.output,L=b.next_out,_=H-b.avail_out,null===(I=b.state).window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new h.Buf8(I.wsize)),_>=I.wsize?(h.arraySet(I.window,D,L-I.wsize,I.wsize,0),I.wnext=0,I.whave=I.wsize):((O=I.wsize-I.wnext)>_&&(O=_),h.arraySet(I.window,D,L-_,O,I.wnext),(_-=O)?(h.arraySet(I.window,D,L-_,_,0),I.wnext=_,I.whave=I.wsize):(I.wnext+=O,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=O)))),H-=b.avail_out,b.total_in+=R-=b.avail_in,b.total_out+=H,S.total+=H,S.wrap&&H&&(b.adler=S.check=S.flags?g(S.check,C,H,b.next_out-H):p(S.check,C,H,b.next_out-H)),b.data_type=S.bits+(S.last?64:0)+(12===S.mode?128:0)+(20===S.mode||15===S.mode?256:0),(0===R&&0===H||4===w)&&0===N&&(N=-5),N},s.inflateEnd=function(b){if(!b||!b.state)return-2;var w=b.state;return w.window&&(w.window=null),b.state=null,0},s.inflateGetHeader=function(b,w){return b&&b.state&&0!=(2&(b=b.state).wrap)?(b.head=w,w.done=!1,0):-2},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(e,t,s){var o=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(d,h,p,g,v,r,u,f){var b,w,A,x,y,S,L,m=f.bits,_=0,C=new o.Buf16(16),I=new o.Buf16(16),D=0;for(b=0;15>=b;b++)C[b]=0;for(w=0;w<g;w++)C[h[p+w]]++;var O=m;for(A=15;1<=A&&0===C[A];A--);if(O>A&&(O=A),0===A)return v[r++]=20971520,v[r++]=20971520,f.bits=1,0;for(m=1;m<A&&0===C[m];m++);for(O<m&&(O=m),b=x=1;15>=b;b++)if(x<<=1,0>(x-=C[b]))return-1;if(0<x&&(0===d||1!==A))return-1;for(I[1]=0,b=1;15>b;b++)I[b+1]=I[b]+C[b];for(w=0;w<g;w++)0!==h[p+w]&&(u[I[h[p+w]]++]=w);switch(d){case 0:var M=L=u,E=19;break;case 1:M=n,_-=257,L=a,D-=257,E=256;break;default:M=l,L=c,E=-1}w=y=0,b=m;var R=r;g=O,I=0;var H=-1,N=1<<O,B=N-1;if(1===d&&852<N||2===d&&592<N)return 1;for(;;){var z=b-I;if(u[w]<E)var J=0,q=u[w];else u[w]>E?(J=L[D+u[w]],q=M[_+u[w]]):(J=96,q=0);x=1<<b-I,m=S=1<<g;do{v[R+(y>>I)+(S-=x)]=z<<24|J<<16|q|0}while(0!==S);for(x=1<<b-1;y&x;)x>>=1;if(0!==x?(y&=x-1,y+=x):y=0,w++,0==--C[b]){if(b===A)break;b=h[p+u[w]]}if(b>O&&(y&B)!==H){for(0===I&&(I=O),R+=m,x=1<<(g=b-I);g+I<A&&!(0>=(x-=C[g+I]));)g++,x<<=1;if(N+=1<<g,1===d&&852<N||2===d&&592<N)return 1;v[H=y&B]=O<<24|g<<16|R-r|0}}return 0!==y&&(v[R+y]=b-I<<24|4194304),f.bits=O,0}},{"../utils/common":2}],11:[function(e,t,s){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(e,t,s){t.exports=function(){this.input=null,this.total_in=this.avail_in=this.next_in=0,this.output=null,this.total_out=this.avail_out=this.next_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[1])(1)}),function(e,t){"function"==typeof define&&define.amd&&typeof Jupyter>"u"?define([],t):typeof exports<"u"?t():(t(),e.FileSaver={})}(this,function(){function t(c,d,h){var p=new XMLHttpRequest;p.open("GET",c),p.responseType="blob",p.onload=function(){l(p.response,d,h)},p.onerror=function(){console.error("could not download file")},p.send()}function s(c){var d=new XMLHttpRequest;d.open("HEAD",c,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function o(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(d)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(c,d,h){var p=n.URL||n.webkitURL,g=document.createElement("a");g.download=d=d||c.name||"download",g.rel="noopener","string"==typeof c?(g.href=c,g.origin!==location.origin?s(g.href)?t(c,d,h):o(g,g.target="_blank"):o(g)):(g.href=p.createObjectURL(c),setTimeout(function(){p.revokeObjectURL(g.href)},4e4),setTimeout(function(){o(g)},0))}:"msSaveOrOpenBlob"in navigator?function(c,d,h){if(d=d||c.name||"download","string"==typeof c)if(s(c))t(c,d,h);else{var p=document.createElement("a");p.href=c,p.target="_blank",setTimeout(function(){o(p)})}else navigator.msSaveOrOpenBlob(function e(c,d){return typeof d>"u"?d={autoBom:!1}:"object"!=typeof d&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob([String.fromCharCode(65279),c],{type:c.type}):c}(c,h),d)}:function(c,d,h,p){if((p=p||open("","_blank"))&&(p.document.title=p.document.body.innerText="downloading..."),"string"==typeof c)return t(c,d,h);d="application/octet-stream"===c.type,h=/constructor/i.test(n.HTMLElement)||n.safari;var g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||d&&h||a)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var f=v.result;f=g?f:f.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=f:location=f,p=null},v.readAsDataURL(c)}else{var r=n.URL||n.webkitURL,u=r.createObjectURL(c);p?p.location=u:location.href=u,p=null,setTimeout(function(){r.revokeObjectURL(u)},4e4)}});n.saveAs=l.saveAs=l,typeof module<"u"&&(module.exports=l)}),function(e){"use strict";var l,t=e.Uint8Array,s=e.HTMLCanvasElement,o=s&&s.prototype,n=/\s*;\s*base64\s*(?:;|$)/i,a="toDataURL",c=function(d){for(var m,b,h=d.length,p=new t(h/4*3|0),g=0,v=0,r=[0,0],u=0,f=0;h--;)b=d.charCodeAt(g++),255!==(m=l[b-43])&&void 0!==m&&(r[1]=r[0],r[0]=b,f=f<<6|m,4==++u&&(p[v++]=f>>>16,61!==r[1]&&(p[v++]=f>>>8),61!==r[0]&&(p[v++]=f),u=0));return p};t&&(l=new t([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),s&&!o.toBlob&&(o.toBlob=function(d,h){if(h||(h="image/png"),this.mozGetAsFile)d(this.mozGetAsFile("canvas",h));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(h))d(this.msToBlob());else{var f,p=Array.prototype.slice.call(arguments,1),g=this[a].apply(this,p),v=g.indexOf(","),r=g.substring(v+1),u=n.test(g.substring(0,v));Blob.fake?((f=new Blob).encoding=u?"base64":"URI",f.data=r,f.size=r.length):t&&(f=u?new Blob([c(r)],{type:h}):new Blob([decodeURIComponent(r)],{type:h})),d(f)}},o.toBlobHD=o.toDataURLHD?function(){a="toDataURLHD";var d=this.toBlob();return a="toDataURL",d}:o.toBlob)}(typeof self<"u"&&self||typeof window<"u"&&window||this.content||this),ddtabcontent.getCookie=function(e){var t=new RegExp(e+"=[^;]+","i");return document.cookie.match(t)?document.cookie.match(t)[0].split("=")[1]:""},ddtabcontent.setCookie=function(e,t){document.cookie=e+"="+t+";path=/"},ddtabcontent.prototype={expandit:function(e){this.cancelautorun();var t="";try{"string"==typeof e&&document.getElementById(e).getAttribute("rel")?t=document.getElementById(e):parseInt(e)!=isNaN()&&this.tabs[e].getAttribute("rel")&&(t=this.tabs[e])}catch{alert("Invalid Tab ID or position entered!")}""!=t&&this.expandtab(t)},cycleit:function(e,t){if("next"==e)var s=this.currentTabIndex<this.hottabspositions.length-1?this.currentTabIndex+1:0;else"prev"==e&&(s=this.currentTabIndex>0?this.currentTabIndex-1:this.hottabspositions.length-1);typeof t>"u"&&this.cancelautorun(),this.expandtab(this.tabs[this.hottabspositions[s]])},setpersist:function(e){this.enabletabpersistence=e},setselectedClassTarget:function(e){this.selectedClassTarget=e||"link"},getselectedClassTarget:function(e){return this.selectedClassTarget=="linkparent".toLowerCase()?e.parentNode:e},urlparamselect:function(e){return null==window.location.search.match(new RegExp(e+"=(\\d+)","i"))?null:parseInt(RegExp.$1)},expandtab:function(e){var t=e.getAttribute("rel"),s=e.getAttribute("rev")?","+e.getAttribute("rev").replace(/\s+/,"")+",":"";this.expandsubcontent(t),this.expandrevcontent(s);for(var o=0;o<this.tabs.length;o++)this.getselectedClassTarget(this.tabs[o]).className=this.tabs[o].getAttribute("rel")==t?"selected":"";this.enabletabpersistence&&ddtabcontent.setCookie(this.tabinterfaceid,e.tabposition),this.setcurrenttabindex(e.tabposition)},expandsubcontent:function(e){for(var t=0;t<this.subcontentids.length;t++){var s=document.getElementById(this.subcontentids[t]);s.style.display=s.id==e?"block":"none"}},expandrevcontent:function(e){for(var t=this.revcontentids,s=0;s<t.length;s++)document.getElementById(t[s]).style.display=-1!=e.indexOf(","+t[s]+",")?"block":"none"},setcurrenttabindex:function(e){for(var t=0;t<this.hottabspositions.length;t++)if(e==this.hottabspositions[t]){this.currentTabIndex=t;break}},autorun:function(){this.cycleit("next",!0)},cancelautorun:function(){typeof this.autoruntimer<"u"&&clearInterval(this.autoruntimer)},init:function(e){var t=ddtabcontent.getCookie(this.tabinterfaceid),s=-1,o=this.urlparamselect(this.tabinterfaceid);this.automodeperiod=e||0;for(var n=0;n<this.tabs.length;n++)if(this.tabs[n].tabposition=n,this.tabs[n].getAttribute("rel")){var a=this;this.hottabspositions[this.hottabspositions.length]=n,this.subcontentids[this.subcontentids.length]=this.tabs[n].getAttribute("rel"),this.tabs[n].onclick=function(){return a.expandtab(this),a.cancelautorun(),!1},this.tabs[n].getAttribute("rev")&&(this.revcontentids=this.revcontentids.concat(this.tabs[n].getAttribute("rev").split(/\s*,\s*/))),(o==n||this.enabletabpersistence&&-1==s&&parseInt(t)==n||!this.enabletabpersistence&&-1==s&&"selected"==this.getselectedClassTarget(this.tabs[n]).className)&&(s=n)}this.expandtab(-1!=s?this.tabs[s]:this.tabs[this.hottabspositions[0]]),parseInt(this.automodeperiod)>500&&this.hottabspositions.length>1&&(this.autoruntimer=setInterval(function(){a.autorun()},this.automodeperiod))}};var Arrive=function(e,t,s){function o(g,v,r){l.addMethod(v,r,g.unbindEvent),l.addMethod(v,r,g.unbindEventWithSelectorOrCallback),l.addMethod(v,r,g.unbindEventWithSelectorAndCallback)}function n(g){g.arrive=h.bindEvent,o(h,g,"unbindArrive"),g.leave=p.bindEvent,o(p,g,"unbindLeave")}if(e.MutationObserver&&typeof HTMLElement<"u"){var a=0,l=(g=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(v,r){return v instanceof HTMLElement&&g.call(v,r)},addMethod:function(v,r,u){var f=v[r];v[r]=function(){return u.length==arguments.length?u.apply(this,arguments):"function"==typeof f?f.apply(this,arguments):void 0}},callCallbacks:function(v,r){r&&r.options.onceOnly&&1==r.firedElems.length&&(v=[v[0]]);for(var f,u=0;f=v[u];u++)f&&f.callback&&f.callback.call(f.elem,f.elem);r&&r.options.onceOnly&&1==r.firedElems.length&&r.me.unbindEventWithSelectorAndCallback.call(r.target,r.selector,r.callback)},checkChildNodesRecursively:function(v,r,u,f){for(var b,m=0;b=v[m];m++)u(b,r,f)&&f.push({callback:r.callback,elem:b}),0<b.childNodes.length&&l.checkChildNodesRecursively(b.childNodes,r,u,f)},mergeArrays:function(v,r){var f,u={};for(f in v)v.hasOwnProperty(f)&&(u[f]=v[f]);for(f in r)r.hasOwnProperty(f)&&(u[f]=r[f]);return u},toElementsArray:function(v){return typeof v>"u"||"number"==typeof v.length&&v!==e||(v=[v]),v}}),c=function(){var g=function(){this._eventsBucket=[],this._beforeRemoving=this._beforeAdding=null};return g.prototype.addEvent=function(v,r,u,f){return v={target:v,selector:r,options:u,callback:f,firedElems:[]},this._beforeAdding&&this._beforeAdding(v),this._eventsBucket.push(v),v},g.prototype.removeEvent=function(v){for(var u,r=this._eventsBucket.length-1;u=this._eventsBucket[r];r--)v(u)&&(this._beforeRemoving&&this._beforeRemoving(u),(u=this._eventsBucket.splice(r,1))&&u.length&&(u[0].callback=null))},g.prototype.beforeAdding=function(v){this._beforeAdding=v},g.prototype.beforeRemoving=function(v){this._beforeRemoving=v},g}(),d=function(g,v){var r=new c,u=this,f={fireOnAttributesModification:!1};return r.beforeAdding(function(m){var b=m.target;(b===e.document||b===e)&&(b=document.getElementsByTagName("html")[0]);var w=new MutationObserver(function(x){v.call(this,x,m)}),A=g(m.options);w.observe(b,A),m.observer=w,m.me=u}),r.beforeRemoving(function(m){m.observer.disconnect()}),this.bindEvent=function(m,b,w){b=l.mergeArrays(f,b);for(var A=l.toElementsArray(this),x=0;x<A.length;x++)r.addEvent(A[x],m,b,w)},this.unbindEvent=function(){var m=l.toElementsArray(this);r.removeEvent(function(b){for(var w=0;w<m.length;w++)if(this===s||b.target===m[w])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(m){var b=l.toElementsArray(this);r.removeEvent("function"==typeof m?function(w){for(var A=0;A<b.length;A++)if((this===s||w.target===b[A])&&w.callback===m)return!0;return!1}:function(w){for(var A=0;A<b.length;A++)if((this===s||w.target===b[A])&&w.selector===m)return!0;return!1})},this.unbindEventWithSelectorAndCallback=function(m,b){var w=l.toElementsArray(this);r.removeEvent(function(A){for(var x=0;x<w.length;x++)if((this===s||A.target===w[x])&&A.selector===m&&A.callback===b)return!0;return!1})},this},h=new function(){function g(u,f,m){return!(!l.matchesSelector(u,f.selector)||(u._id===s&&(u._id=a++),-1!=f.firedElems.indexOf(u._id))||(f.firedElems.push(u._id),0))}var v={fireOnAttributesModification:!1,onceOnly:!1,existing:!1},r=(h=new d(function(u){var f={attributes:!1,childList:!0,subtree:!0};return u.fireOnAttributesModification&&(f.attributes=!0),f},function(u,f){u.forEach(function(m){var b=m.addedNodes,w=m.target,A=[];null!==b&&0<b.length?l.checkChildNodesRecursively(b,f,g,A):"attributes"===m.type&&g(w,f)&&A.push({callback:f.callback,elem:w}),l.callCallbacks(A,f)})})).bindEvent;return h.bindEvent=function(u,f,m){typeof m>"u"?(m=f,f=v):f=l.mergeArrays(v,f);var b=l.toElementsArray(this);if(f.existing){for(var w=[],A=0;A<b.length;A++)for(var x=b[A].querySelectorAll(u),y=0;y<x.length;y++)w.push({callback:m,elem:x[y]});if(f.onceOnly&&w.length)return m.call(w[0].elem,w[0].elem);setTimeout(l.callCallbacks,1,w)}r.call(this,u,f,m)},h},p=new function(){function g(u,f){return l.matchesSelector(u,f.selector)}var v={},r=(p=new d(function(){return{childList:!0,subtree:!0}},function(u,f){u.forEach(function(m){var b=[];null!==(m=m.removedNodes)&&0<m.length&&l.checkChildNodesRecursively(m,f,g,b),l.callCallbacks(b,f)})})).bindEvent;return p.bindEvent=function(u,f,m){typeof m>"u"?(m=f,f=v):f=l.mergeArrays(v,f),r.call(this,u,f,m)},p};return t&&n(t.fn),n(HTMLElement.prototype),n(NodeList.prototype),n(HTMLCollection.prototype),n(HTMLDocument.prototype),n(Window.prototype),o(h,t={},"unbindAllArrive"),o(p,t,"unbindAllLeave"),t}var g}(window,typeof jQuery>"u"?null:jQuery,void 0);(function(e){var t=!1,s=navigator.userAgent.toLowerCase();(0<=s.indexOf("iphone")||0<=s.indexOf("ipad"))&&(t=!0),e.fn.doubletap=function(o,n,a){var l;a=a??500;var c=1==t?"touchend":"click";e(this).bind(c,function(d){var h=(new Date).getTime(),p=e(this).data("lastTouch")||h+1;p=h-p,clearTimeout(l),500>p&&0<p?null!=o&&"function"==typeof o&&o(d):(e(this).data("lastTouch",h),l=setTimeout(function(g){null!=n&&"function"==typeof n&&n(g),clearTimeout(l)},a,[d])),e(this).data("lastTouch",h)})}})(jQuery),function(e){function n(){var g=document.createElement("div");return typeof g.style.MozTransition<"u"||typeof g.style.OTransition<"u"||typeof g.style.webkitTransition<"u"||typeof g.style.transition<"u"}function a(g,v,r,u,f){this.axisName=g,this.position=v,this.padding=r,this.plot=u,this.opts=f,this.width=0,this.height=0}function l(g,v,r,u,f){a.prototype.constructor.call(this,g,v,r,u,f)}function c(g,v,r,u,f){a.prototype.constructor.call(this,g,v,r,u,f),this.elem=null}function d(g,v,r,u,f){c.prototype.constructor.call(this,g,v,r,u,f)}function h(g,v,r,u,f){d.prototype.constructor.call(this,g,v,r,u,f),this.requiresResize=!1}a.prototype.cleanup=function(){},(l.prototype=new a).constructor=l,l.prototype.calculateSize=function(){this.opts.axisLabelFontSizePixels||(this.opts.axisLabelFontSizePixels=14),this.opts.axisLabelFontFamily||(this.opts.axisLabelFontFamily="sans-serif"),"left"==this.position||"right"==this.position?(this.width=this.opts.axisLabelFontSizePixels+this.padding,this.height=0):(this.width=0,this.height=this.opts.axisLabelFontSizePixels+this.padding)},l.prototype.draw=function(g){this.opts.axisLabelColour||(this.opts.axisLabelColour="black");var v=this.plot.getCanvas().getContext("2d");v.save(),v.font=this.opts.axisLabelFontSizePixels+"px "+this.opts.axisLabelFontFamily,v.fillStyle=this.opts.axisLabelColour;var f,m,r=v.measureText(this.opts.axisLabel).width,u=this.opts.axisLabelFontSizePixels,b=0;"top"==this.position?(f=g.left+g.width/2-r/2,m=g.top+.72*u):"bottom"==this.position?(f=g.left+g.width/2-r/2,m=g.top+g.height-.72*u):"left"==this.position?(f=g.left+.72*u,m=g.height/2+g.top+r/2,b=-Math.PI/2):"right"==this.position&&(f=g.left+g.width-.72*u,m=g.height/2+g.top-r/2,b=Math.PI/2),v.translate(f,m),v.rotate(b),v.fillText(this.opts.axisLabel,0,0),v.restore()},(c.prototype=new a).constructor=c,c.prototype.calculateSize=function(){var g=e('<div class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>");this.plot.getPlaceholder().append(g),this.labelWidth=g.outerWidth(!0),this.labelHeight=g.outerHeight(!0),g.remove(),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelWidth+this.padding:this.height=this.labelHeight+this.padding},c.prototype.cleanup=function(){this.elem&&this.elem.remove()},c.prototype.draw=function(g){this.plot.getPlaceholder().find("#"+this.axisName+"Label").remove(),this.elem=e('<div id="'+this.axisName+'Label" " class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem),"top"==this.position?(this.elem.css("left",g.left+g.width/2-this.labelWidth/2+"px"),this.elem.css("top",g.top+"px")):"bottom"==this.position?(this.elem.css("left",g.left+g.width/2-this.labelWidth/2+"px"),this.elem.css("top",g.top+g.height-this.labelHeight+"px")):"left"==this.position?(this.elem.css("top",g.top+g.height/2-this.labelHeight/2+"px"),this.elem.css("left",g.left+"px")):"right"==this.position&&(this.elem.css("top",g.top+g.height/2-this.labelHeight/2+"px"),this.elem.css("left",g.left+g.width-this.labelWidth+"px"))},(d.prototype=new c).constructor=d,d.prototype.calculateSize=function(){c.prototype.calculateSize.call(this),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelHeight+this.padding:this.height=this.labelHeight+this.padding},d.prototype.transforms=function(g,v,r){var u={"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":""};if(0!=v||0!=r){var f=" translate("+v+"px, "+r+"px)";u["-moz-transform"]+=f,u["-webkit-transform"]+=f,u["-o-transform"]+=f,u["-ms-transform"]+=f}if(0!=g){var b=" rotate("+g+"deg)";u["-moz-transform"]+=b,u["-webkit-transform"]+=b,u["-o-transform"]+=b,u["-ms-transform"]+=b}var w="top: 0; left: 0; ";for(var A in u)u[A]&&(w+=A+":"+u[A]+";");return w+";"},d.prototype.calculateOffsets=function(g){var v={x:0,y:0,degrees:0};return"bottom"==this.position?(v.x=g.left+g.width/2-this.labelWidth/2,v.y=g.top+g.height-this.labelHeight):"top"==this.position?(v.x=g.left+g.width/2-this.labelWidth/2,v.y=g.top):"left"==this.position?(v.degrees=-90,v.x=g.left-this.labelWidth/2+this.labelHeight/2,v.y=g.height/2+g.top):"right"==this.position&&(v.degrees=90,v.x=g.left+g.width-this.labelWidth/2-this.labelHeight/2,v.y=g.height/2+g.top),v.x=Math.round(v.x),v.y=Math.round(v.y),v},d.prototype.draw=function(g){this.plot.getPlaceholder().find("."+this.axisName+"Label").remove();var v=this.calculateOffsets(g);this.elem=e('<div class="axisLabels '+this.axisName+'Label" style="position:absolute; '+this.transforms(v.degrees,v.x,v.y)+'">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem)},(h.prototype=new d).constructor=h,h.prototype.transforms=function(g,v,r){var u="";if(0!=g){for(var f=g/90;f<0;)f+=4;u+=" filter: progid:DXImageTransform.Microsoft.BasicImage(rotation="+f+"); ",this.requiresResize="right"==this.position}return 0!=v&&(u+="left: "+v+"px; "),0!=r&&(u+="top: "+r+"px; "),u},h.prototype.calculateOffsets=function(g){var v=d.prototype.calculateOffsets.call(this,g);return"top"==this.position?v.y=g.top+1:"left"==this.position?(v.x=g.left,v.y=g.height/2+g.top-this.labelWidth/2):"right"==this.position&&(v.x=g.left+g.width-this.labelHeight,v.y=g.height/2+g.top-this.labelWidth/2),v},h.prototype.draw=function(g){d.prototype.draw.call(this,g),this.requiresResize&&(this.elem=this.plot.getPlaceholder().find("."+this.axisName+"Label"),this.elem.css("width",this.labelWidth),this.elem.css("height",this.labelHeight))},e.plot.plugins.push({init:function p(g){g.hooks.processOptions.push(function(v,r){if(r.axisLabels.show){var u=!1,f={};v.hooks.draw.push(function(w,A){var x=!1;u?(u=!1,e.each(w.getAxes(),function(y,S){var _=S.options||w.getOptions()[y];!_||!_.axisLabel||!S.show||f[y].draw(S.box)})):(e.each(w.getAxes(),function(y,S){var _=S.options||w.getOptions()[y];if(y in f&&(S.labelHeight=S.labelHeight-f[y].height,S.labelWidth=S.labelWidth-f[y].width,_.labelHeight=S.labelHeight,_.labelWidth=S.labelWidth,f[y].cleanup(),delete f[y]),_&&_.axisLabel&&S.show){x=!0;var C=null;if(_.axisLabelUseHtml||"Microsoft Internet Explorer"!=navigator.appName)C=_.axisLabelUseHtml||!n()&&!function o(){return!!function s(){return!!document.createElement("canvas").getContext}()&&"function"==typeof document.createElement("canvas").getContext("2d").fillText}()&&!_.axisLabelUseCanvas?c:_.axisLabelUseCanvas||!n()?l:d;else{var I=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(I)&&(rv=parseFloat(RegExp.$1)),C=rv>=9&&!_.axisLabelUseCanvas&&!_.axisLabelUseHtml?d:_.axisLabelUseCanvas||_.axisLabelUseHtml?_.axisLabelUseCanvas?l:c:h}f[y]=new C(y,S.position,void 0===_.axisLabelPadding?2:_.axisLabelPadding,w,_),f[y].calculateSize(),_.labelHeight=S.labelHeight+f[y].height,_.labelWidth=S.labelWidth+f[y].width}}),x&&(u=!0,w.setupGrid(),w.draw()))})}})},options:{axisLabels:{show:!0}},name:"axisLabels",version:"2.0"})}(jQuery),function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";var s,o,e=["webkit","Moz","ms","O"],t={};function n(f,m){var w,b=document.createElement(f||"div");for(w in m)b[w]=m[w];return b}function a(f){for(var m=1,b=arguments.length;m<b;m++)f.appendChild(arguments[m]);return f}function l(f,m,b,w){var A=["opacity",m,~~(100*f),b,w].join("-"),x=.01+b/w*100,y=Math.max(1-(1-f)/m*(100-x),f),S=s.substring(0,s.indexOf("Animation")).toLowerCase();return t[A]||(o.insertRule("@"+(S&&"-"+S+"-"||"")+"keyframes "+A+"{0%{opacity:"+y+"}"+x+"%{opacity:"+f+"}"+(x+.01)+"%{opacity:1}"+(x+m)%100+"%{opacity:"+f+"}100%{opacity:"+y+"}}",o.cssRules.length),t[A]=1),A}function c(f,m){var w,A,b=f.style;if(void 0!==b[m=m.charAt(0).toUpperCase()+m.slice(1)])return m;for(A=0;A<e.length;A++)if(void 0!==b[w=e[A]+m])return w}function d(f,m){for(var b in m)f.style[c(f,b)||b]=m[b];return f}function h(f){for(var m=1;m<arguments.length;m++){var b=arguments[m];for(var w in b)void 0===f[w]&&(f[w]=b[w])}return f}function p(f,m){return"string"==typeof f?f:f[m%f.length]}var f,g={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:1/4,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};function v(f){this.opts=h(f||{},v.defaults,g)}if(v.defaults={},h(v.prototype,{spin:function(f){this.stop();var m=this,b=m.opts,w=m.el=n(null,{className:b.className});if(d(w,{position:b.position,width:0,zIndex:b.zIndex,left:b.left,top:b.top}),f&&f.insertBefore(w,f.firstChild||null),w.setAttribute("role","progressbar"),m.lines(w,m.opts),!s){var y,A=0,x=(b.lines-1)*(1-b.direction)/2,S=b.fps,_=S/b.speed,C=(1-b.opacity)/(_*b.trail/100),I=_/b.lines;!function L(){A++;for(var D=0;D<b.lines;D++)y=Math.max(1-(A+(b.lines-D)*I)%_*C,b.opacity),m.opacity(w,D*b.direction+x,y,b);m.timeout=m.el&&setTimeout(L,~~(1e3/S))}()}return m},stop:function(){var f=this.el;return f&&(clearTimeout(this.timeout),f.parentNode&&f.parentNode.removeChild(f),this.el=void 0),this},lines:function(f,m){var A,b=0,w=(m.lines-1)*(1-m.direction)/2;function x(y,S){return d(n(),{position:"absolute",width:m.scale*(m.length+m.width)+"px",height:m.scale*m.width+"px",background:y,boxShadow:S,transformOrigin:"left",transform:"rotate("+~~(360/m.lines*b+m.rotate)+"deg) translate("+m.scale*m.radius+"px,0)",borderRadius:(m.corners*m.scale*m.width>>1)+"px"})}for(;b<m.lines;b++)A=d(n(),{position:"absolute",top:1+~(m.scale*m.width/2)+"px",transform:m.hwaccel?"translate3d(0,0,0)":"",opacity:m.opacity,animation:s&&l(m.opacity,m.trail,w+b*m.direction,m.lines)+" "+1/m.speed+"s linear infinite"}),m.shadow&&a(A,d(x("#000","0 0 4px #000"),{top:"2px"})),a(f,a(A,x(p(m.color,b),"0 0 1px rgba(0,0,0,.1)")));return f},opacity:function(f,m,b){m<f.childNodes.length&&(f.childNodes[m].style.opacity=b)}}),typeof document<"u"){f=n("style",{type:"text/css"}),a(document.getElementsByTagName("head")[0],f),o=f.sheet||f.styleSheet;var u=d(n("group"),{behavior:"url(#default#VML)"});!c(u,"transform")&&u.adj?function r(){function f(m,b){return n("<"+m+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)}o.addRule(".spin-vml","behavior:url(#default#VML)"),v.prototype.lines=function(m,b){var w=b.scale*(b.length+b.width),A=2*b.scale*w;function x(){return d(f("group",{coordsize:A+" "+A,coordorigin:-w+" "+-w}),{width:A,height:A})}var _,y=-(b.width+b.length)*b.scale*2+"px",S=d(x(),{position:"absolute",top:y,left:y});function C(I,L,D){a(S,a(d(x(),{rotation:360/b.lines*I+"deg",left:~~L}),a(d(f("roundrect",{arcsize:b.corners}),{width:w,height:b.scale*b.width,left:b.scale*b.radius,top:-b.scale*b.width>>1,filter:D}),f("fill",{color:p(b.color,I),opacity:b.opacity}),f("stroke",{opacity:0}))))}if(b.shadow)for(_=1;_<=b.lines;_++)C(_,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(_=1;_<=b.lines;_++)C(_);return a(m,S)},v.prototype.opacity=function(m,b,w,A){var x=m.firstChild;A=A.shadow&&A.lines||0,x&&b+A<x.childNodes.length&&(x=(x=(x=x.childNodes[b+A])&&x.firstChild)&&x.firstChild)&&(x.opacity=w)}}():s=c(u,"animation")}return v}),function(e,t){"function"==typeof define&&define.amd?define(["./ResizeSensor.js"],t):"object"==typeof exports?module.exports=t(require("./ResizeSensor.js")):(e.ElementQueries=t(e.ResizeSensor),e.ElementQueries.listen())}(typeof window<"u"?window:this,function(e){var t=function(){var o,n={},a=[];function l(y){y||(y=document.documentElement);var S=window.getComputedStyle(y,null).fontSize;return parseFloat(S)||16}function d(y,S){var _=S.split(/\d/),C=_[_.length-1];switch(S=parseFloat(S),C){case"px":default:return S;case"em":return S*l(y);case"rem":return S*l();case"vw":return S*document.documentElement.clientWidth/100;case"vh":return S*document.documentElement.clientHeight/100;case"vmin":case"vmax":var I=document.documentElement.clientWidth/100,L=document.documentElement.clientHeight/100;return S*(0,Math["vmin"===C?"min":"max"])(I,L)}}function h(y,S){this.element=y;var _,C,I,L,D,O,M,E,R=["min-width","min-height","max-width","max-height"];this.call=function(){for(_ in I=function c(y){if(!y.getBoundingClientRect)return{width:y.offsetWidth,height:y.offsetHeight};var S=y.getBoundingClientRect();return{width:Math.round(S.width),height:Math.round(S.height)}}(this.element),O={},n[S])!n[S].hasOwnProperty(_)||(L=d(this.element,(C=n[S][_]).value),D="width"===C.property?I.width:I.height,M="","min"===C.mode&&D>=L&&(M+=C.value),"max"===C.mode&&D<=L&&(M+=C.value),O[E=C.mode+"-"+C.property]||(O[E]=""),M&&-1===(" "+O[E]+" ").indexOf(" "+M+" ")&&(O[E]+=" "+M));for(var H in R)!R.hasOwnProperty(H)||(O[R[H]]?this.element.setAttribute(R[H],O[R[H]].substr(1)):this.element.removeAttribute(R[H]))}}function p(y,S){y.elementQueriesSetupInformation||(y.elementQueriesSetupInformation=new h(y,S)),y.elementQueriesSensor||(y.elementQueriesSensor=new e(y,function(){y.elementQueriesSetupInformation.call()}))}function g(y,S,_,C){if(typeof n[y]>"u"){n[y]=[];var I=a.length;o.innerHTML+="\n"+y+" {animation: 0.1s element-queries;}",o.innerHTML+="\n"+y+" > .resize-sensor {min-width: "+I+"px;}",a.push(y)}n[y].push({mode:S,property:_,value:C})}function v(y){var S;if(document.querySelectorAll&&(S=y?y.querySelectorAll.bind(y):document.querySelectorAll.bind(document)),!S&&typeof $$<"u"&&(S=$$),!S&&typeof jQuery<"u"&&(S=jQuery),!S)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";return S}function u(y){var S=[],_=[],C=[],I=0,L=-1,D=[];for(var O in y.children)if(y.children.hasOwnProperty(O)&&y.children[O].tagName&&"img"===y.children[O].tagName.toLowerCase()){S.push(y.children[O]);var M=y.children[O].getAttribute("min-width")||y.children[O].getAttribute("data-min-width"),E=y.children[O].getAttribute("data-src")||y.children[O].getAttribute("url");C.push(E),_.push({minWidth:M}),M?y.children[O].style.display="none":(I=S.length-1,y.children[O].style.display="block")}function H(){var B,N=!1;for(B in S)!S.hasOwnProperty(B)||_[B].minWidth&&y.offsetWidth>_[B].minWidth&&(N=B);if(N||(N=I),L!==N)if(D[N])S[L].style.display="none",S[N].style.display="block",L=N;else{var P=new Image;P.onload=function(){S[N].src=C[N],S[L].style.display="none",S[N].style.display="block",D[N]=!0,L=N},P.src=C[N]}else S[N].src=C[N]}L=I,y.resizeSensorInstance=new e(y,H),H()}var m=/,?[\s\t]*([^,\n]*?)((?:\[[\s\t]*?(?:min|max)-(?:width|height)[\s\t]*?[~$\^]?=[\s\t]*?"[^"]*?"[\s\t]*?])+)([^,\n\s\{]*)/gim,b=/\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]/gim;function w(y){var S,_,C,I;for(y=y.replace(/'/g,'"');null!==(S=m.exec(y));)for(_=S[1]+S[3],C=S[2];null!==(I=b.exec(C));)g(_,I[1],I[2],I[3])}function A(y){var S="";if(y)if("string"==typeof y)(-1!==(y=y.toLowerCase()).indexOf("min-width")||-1!==y.indexOf("max-width"))&&w(y);else for(var _=0,C=y.length;_<C;_++)1===y[_].type?(-1!==(S=y[_].selectorText||y[_].cssText).indexOf("min-height")||-1!==S.indexOf("max-height")||-1!==S.indexOf("min-width")||-1!==S.indexOf("max-width"))&&w(S):4===y[_].type?A(y[_].cssRules||y[_].rules):3===y[_].type&&y[_].styleSheet.hasOwnProperty("cssRules")&&A(y[_].styleSheet.cssRules)}var x=!1;this.init=function(){var y="animationstart";typeof document.documentElement.style.webkitAnimationName<"u"?y="webkitAnimationStart":typeof document.documentElement.style.MozAnimationName<"u"?y="mozanimationstart":typeof document.documentElement.style.OAnimationName<"u"&&(y="oanimationstart"),document.body.addEventListener(y,function(C){var I=C.target,L=I&&window.getComputedStyle(I,null),D=L&&L.getPropertyValue("animation-name");if(D&&-1!==D.indexOf("element-queries")){I.elementQueriesSensor=new e(I,function(){I.elementQueriesSetupInformation&&I.elementQueriesSetupInformation.call()});var E=window.getComputedStyle(I.resizeSensor,null).getPropertyValue("min-width");E=parseInt(E.replace("px","")),p(C.target,a[E])}}),x||((o=document.createElement("style")).type="text/css",o.innerHTML="[responsive-image] > img, [data-responsive-image] {overflow: hidden; padding: 0; } [responsive-image] > img, [data-responsive-image] > img {width: 100%;}",o.innerHTML+="\n@keyframes element-queries { 0% { visibility: inherit; } }",document.getElementsByTagName("head")[0].appendChild(o),x=!0);for(var S=0,_=document.styleSheets.length;S<_;S++)try{document.styleSheets[S].href&&0===document.styleSheets[S].href.indexOf("file://")&&console.warn("CssElementQueries: unable to parse local css files, "+document.styleSheets[S].href),A(document.styleSheets[S].cssRules||document.styleSheets[S].rules||document.styleSheets[S].cssText)}catch{}!function f(){for(var S=v()("[data-responsive-image],[responsive-image]"),_=0,C=S.length;_<C;_++)u(S[_])}()},this.findElementQueriesElements=function(y){!function r(y){var S=v(y);for(var _ in n)if(n.hasOwnProperty(_))for(var C=S(_,y),I=0,L=C.length;I<L;I++)p(C[I],_)}(y)},this.update=function(){this.init()}};return t.update=function(){t.instance.update()},t.detach=function(o){o.elementQueriesSetupInformation?(o.elementQueriesSensor.detach(),delete o.elementQueriesSetupInformation,delete o.elementQueriesSensor):o.resizeSensorInstance&&(o.resizeSensorInstance.detach(),delete o.resizeSensorInstance)},t.init=function(){t.instance||(t.instance=new t),t.instance.init()},t.findElementQueriesElements=function(o){t.instance.findElementQueriesElements(o)},t.listen=function(){!function(o){if(document.addEventListener)document.addEventListener("DOMContentLoaded",o,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var n=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(o(),clearInterval(n))},10);else window.onload=o}(t.init)},t}),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.ResizeSensor=t()}(typeof window<"u"?window:this,function(){if(typeof window>"u")return null;var e=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")(),t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||function(c){return e.setTimeout(c,20)};function s(c,d){var h=Object.prototype.toString.call(c),p="[object Array]"===h||"[object NodeList]"===h||"[object HTMLCollection]"===h||"[object Object]"===h||typeof jQuery<"u"&&c instanceof jQuery||typeof Elements<"u"&&c instanceof Elements,g=0,v=c.length;if(p)for(;g<v;g++)d(c[g]);else d(c)}function o(c){if(!c.getBoundingClientRect)return{width:c.offsetWidth,height:c.offsetHeight};var d=c.getBoundingClientRect();return{width:Math.round(d.width),height:Math.round(d.height)}}function n(c,d){Object.keys(d).forEach(function(h){c.style[h]=d[h]})}var a=function(c,d){var h=0;function p(){var r,u,v=[];this.add=function(f){v.push(f)},this.call=function(f){for(r=0,u=v.length;r<u;r++)v[r].call(this,f)},this.remove=function(f){var m=[];for(r=0,u=v.length;r<u;r++)v[r]!==f&&m.push(v[r]);v=m},this.length=function(){return v.length}}s(c,function(v){!function g(v,r){if(v){if(v.resizedAttached)return void v.resizedAttached.add(r);v.resizedAttached=new p,v.resizedAttached.add(r),v.resizeSensor=document.createElement("div"),v.resizeSensor.dir="ltr",v.resizeSensor.className="resize-sensor";var u={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},f={position:"absolute",left:"0px",top:"0px",transition:"0s"};n(v.resizeSensor,u);var m=document.createElement("div");m.className="resize-sensor-expand",n(m,u);var b=document.createElement("div");n(b,f),m.appendChild(b);var w=document.createElement("div");w.className="resize-sensor-shrink",n(w,u);var A=document.createElement("div");n(A,f),n(A,{width:"200%",height:"200%"}),w.appendChild(A),v.resizeSensor.appendChild(m),v.resizeSensor.appendChild(w),v.appendChild(v.resizeSensor);var x=window.getComputedStyle(v),y=x?x.getPropertyValue("position"):null;"absolute"!==y&&"relative"!==y&&"fixed"!==y&&"sticky"!==y&&(v.style.position="relative");var S,_,C=o(v),I=0,L=0,D=!0;h=0;var M=function(){if(D){if(0===v.offsetWidth&&0===v.offsetHeight)return void(h||(h=t(function(){h=0,M()})));D=!1}var N,B;B=v.offsetHeight,b.style.width=(N=v.offsetWidth)+10+"px",b.style.height=B+10+"px",m.scrollLeft=N+10,m.scrollTop=B+10,w.scrollLeft=N+10,w.scrollTop=B+10};v.resizeSensor.resetSensor=M;var E=function(){_=0,S&&(I=C.width,L=C.height,v.resizedAttached&&v.resizedAttached.call(C))},R=function(){C=o(v),(S=C.width!==I||C.height!==L)&&!_&&(_=t(E)),M()},H=function(N,B,P){N.attachEvent?N.attachEvent("on"+B,P):N.addEventListener(B,P)};H(m,"scroll",R),H(w,"scroll",R),h=t(M)}}(v,d)}),this.detach=function(v){h||(window.cancelAnimationFrame(h),h=0),a.detach(c,v)},this.reset=function(){c.resizeSensor.resetSensor()}};if(a.reset=function(c){s(c,function(d){d.resizeSensor.resetSensor()})},a.detach=function(c,d){s(c,function(h){!h||h.resizedAttached&&"function"==typeof d&&(h.resizedAttached.remove(d),h.resizedAttached.length())||h.resizeSensor&&(h.contains(h.resizeSensor)&&h.removeChild(h.resizeSensor),delete h.resizeSensor,delete h.resizedAttached)})},typeof MutationObserver<"u"){var l=new MutationObserver(function(c){for(var d in c)if(c.hasOwnProperty(d))for(var h=c[d].addedNodes,p=0;p<h.length;p++)h[p].resizeSensor&&a.reset(h[p])});document.addEventListener("DOMContentLoaded",function(c){l.observe(document.body,{childList:!0,subtree:!0})})}return a});var ImageFilters,$jscomp,gaussBlur=function(){function s(a,l,c,d,h){for(var p=0;p<a.length;p++)l[p]=a[p]==a[p]?a[p]:0;(function o(a,l,c,d,h){for(var p=1/(h+h+1),g=0;g<d;g++){for(var v=g*c,r=v,u=v+h,f=a[v],m=a[v+c-1],b=(h+1)*f,w=0;w<h;w++)b+=a[v+w];for(w=0;w<=h;w++)b+=a[u++]-f,l[v++]=b*p;for(w=h+1;w<c-h;w++)b+=a[u++]-a[r++],l[v++]=b*p;for(w=c-h;w<c;w++)b+=m-a[r++],l[v++]=b*p}})(l,a,c,d,h),function n(a,l,c,d,h){for(var p=1/(h+h+1),g=0;g<c;g++){for(var v=g,r=v,u=v+h*c,f=a[v],m=a[v+c*(d-1)],b=(h+1)*f,w=0;w<h;w++)b+=a[v+w*c];for(w=0;w<=h;w++)l[v]=(b+=a[u]-f)*p,u+=c,v+=c;for(w=h+1;w<d-h;w++)l[v]=(b+=a[u]-a[r])*p,r+=c,u+=c,v+=c;for(w=d-h;w<d;w++)l[v]=(b+=m-a[r])*p,r+=c,v+=c}}(a,l,c,d,h)}return function e(a,l,c,d,h){var p=function t(a,l){var c=Math.sqrt(12*a*a/l+1),d=Math.floor(c);d%2==0&&d--;for(var h=d+2,g=Math.round((12*a*a-l*d*d-4*l*d-3*l)/(-4*d-4)),v=[],r=0;r<l;r++)v.push(r<g?d:h);return v}(h,3);s(a,l,c,d,(p[0]-1)/2),s(l,a,c,d,(p[1]-1)/2),s(a,l,c,d,(p[2]-1)/2)}}();ImageFilters=function(){"use strict";function t(D,O,M,E,R){var H,N,B,P,z,G,ee,le,te,Q,de,xe,ce,he,Pe=Math.round(Math.sqrt(M.length)),Se=Math.floor(Pe/2),Y=O.width,ie=O.height,be=Y*ie*4,ke=Y,Ee=ie,$e=O.data,Ge=D.createImageData(O.width,O.height);for(H=0;H<be;H++)Ge[H]=$e[H];if("[object Array]"!==Object.prototype.toString.call(M))return O;void 0===E&&(E=!0);var Ye=E?1:0;for(R&&function e(D){var O,M;for(M=D.reduce(function(E,R){return E+R}),O=0;O<D.length;++O)D[O]/=M}(M),B=0;B<Ee;B++)for(N=0;N<ke;N++){for(z=B,P=N,G=4*(B*ke+N),de=0,xe=0,ce=0,he=0,le=0;le<Pe;le++)for(ee=0;ee<Pe;ee++)de+=Ge[te=4*(Math.min(ie-1,Math.max(0,z+le-Se))*Y+Math.min(Y-1,Math.max(0,P+ee-Se)))]*(Q=M[le*Pe+ee]),xe+=Ge[te+1]*Q,ce+=Ge[te+2]*Q,he+=Ge[te+3]*Q;$e[G]=de,$e[G+1]=xe,$e[G+2]=ce,$e[G+3]=he+Ye*(255-he)}return O}function s(D,O,M,E){var R,H,N,B,J,q,G,ee,le,te,Q,de,xe,ce=Math.round(Math.sqrt(M.length)),he=Math.floor(ce/2),Pe=O.data,Se=O.width,Y=O.height,ie=Se,be=Y,ke={width:ie,height:be,data:new Float32Array(ie*be*4)},Ee=ke.data,$e=E?1:0;for(H=0;H<be;H++)for(R=0;R<ie;R++){for(B=H,N=R,J=4*(H*ie+R),te=0,Q=0,de=0,xe=0,G=0;G<ce;G++)for(q=0;q<ce;q++)te+=Pe[ee=4*(Math.min(Y-1,Math.max(0,B+G-he))*Se+Math.min(Se-1,Math.max(0,N+q-he)))]*(le=M[G*ce+q]),Q+=Pe[ee+1]*le,de+=Pe[ee+2]*le,xe+=Pe[ee+3]*le;Ee[J]=te,Ee[J+1]=Q,Ee[J+2]=de,Ee[J+3]=xe+$e*(255-xe)}return ke.data}function n(D,O){var M,R=O.data;for(M=0;M<R.length;M+=4)R[M]=R[M+1]=R[M+2]=.299*R[M]+.587*R[M+1]+.114*R[M+2];return O}function a(D,O){var M,R=O.data;for(M=0;M<R.length;M+=4)R[M]=R[M+1]=R[M+2]=(R[M]+R[M+1]+R[M+2])/3;return O}return{convolve:t,luminance:function o(D,O){var M,R=O.data;for(M=0;M<R.length;M+=4)R[M]=R[M+1]=R[M+2]=.2126*R[M]+.7152*R[M+1]+.0722*R[M+2];return O},greyscale:n,greyscaleAvg:a,brighten:function g(D,O,M){var E,R=O.data;for(arguments.length<3&&(M=10),E=0;E<R.length;E+=4)R[E]+=M,R[E+1]+=M,R[E+2]+=M;return O},noise:function c(D,O,M,E){var R,H,N,B=O.data;for(arguments.length<3?(M=-30,E=30):3===arguments.length&&(E=M,M=-M),H=E-M,R=0;R<B.length;R+=4)N=Math.floor(Math.random()*H-E),B[R]+=N,B[R+1]+=N,B[R+2]+=N;return O},duotone:function l(D,O,M){var E,H=O.data;switch(M){case"r":default:M=0;break;case"g":M=1;break;case"b":M=2}for(E=0;E<H.length;E+=4)H[E+M]=(H[E]+H[E+1]+H[E+2]-H[E+M])/2;return O},invert:function d(D,O){var M,E=O.data;for(M=0;M<E.length;M+=4)E[M]=255-E[M],E[M+1]=255-E[M+1],E[M+2]=255-E[M+2];return O},pixelate:function h(D,O,M){var E,R,H,N,B,P,z,J,q,G,ee,le,te=O.width,Q=O.height,de=O.data;if(arguments.length<3&&(M=2),M<=0)return O;for(ee=2*M,J=M;J<Q-M;J+=ee)for(z=M;z<te-M;z+=ee)for(E=de[N=4*(te*J+z)],R=de[N+1],H=de[N+2],G=-M;G<M;++G)for(P=te*(J+G),q=-M;q<M;++q)de[B=4*(P+(z+q))]=E,de[B+1]=R,de[B+2]=H;for(J=Q-(le=Q%ee?Q%ee:ee);J<Q;J++)for(P=te*J,z=0;z<te;z++)de[B=4*(z+P)]=0,de[B+1]=0,de[B+2]=0;for(le=te%ee?te%ee:ee,J=0;J<Q;J++)for(P=te*J,z=te-le;z<te;z++)de[B=4*(z+P)]=0,de[B+1]=0,de[B+2]=0;return O},sobel:function m(D,O,M){var E,R,H,N,B,P=O.data;if(B=s(0,O=a(0,O),[-1,0,1,-2,0,2,-1,0,1]),N=s(0,O,[-1,-2,-1,0,0,0,1,2,1]),M)for(E=0;E<P.length;E+=4)R=Math.abs(N[E]),H=Math.abs(B[E]),P[E]=R,P[E+1]=H,P[E+2]=(R+H)/4;else{for(E=0;E<P.length;E+=4)R=Math.abs(N[E]),H=Math.abs(B[E]),P[E]=R,P[E+1]=H,P[E+2]=(R+H)/2;n(0,O)}return O},medianFilter:function f(D,O){return t(D,O,[1,0,0,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,0,0,1],!0,!0)},sepia:function v(D,O,M){var E,R,H,N,B=O.data;for(void 0===M&&(M=100),M/=100,E=0;E<B.length;E+=4)R=B[E],H=B[E+1],N=B[E+2],B[E]=Math.min(255,R*(1-.607*M)+H*(.769*M)+N*(.189*M)),B[E+1]=Math.min(255,R*(.349*M)+H*(1-.314*M)+N*(.168*M)),B[E+2]=Math.min(255,R*(.272*M)+H*(.534*M)+N*(1-.869*M));return O},contrast:function r(D,O,M){var E,R=O.data;for(arguments.length<3&&(M=2),M<-100?M=-100:M>100&&(M=100),E=0;E<R.length;E+=4)R[E]=255*((R[E]/255-.5)*M+.5),R[E+1]=255*((R[E+1]/255-.5)*M+.5),R[E+2]=255*((R[E+2]/255-.5)*M+.5);return O},threshold:function u(D,O,M,E,R){var H,J=O.data;for(arguments.length<3?(M=10,E=0,R=255):arguments.length<5&&(E=0,R=255),H=0;H<J.length-1;H+=4)J[H]=J[H+1]=J[H+2]=.2126*J[H]+.7152*J[H+1]+.0722*J[H+2]>=M?R:E;return O},gamma:function p(D,O,M){var E,R=O.data;for(arguments.length<3&&(M=.2),E=0;E<R.length;E+=4)R[E]=255*Math.pow(R[E]/255,M),R[E+1]=255*Math.pow(R[E+1]/255,M),R[E+2]=255*Math.pow(R[E+2]/255,M);return O},gaussBlur5:function b(D,O){return t(D,O,[.003,.0133,.0219,.0133,.003,.0133,.0596,.0983,.0596,.0133,.0219,.0983,.1621,.0983,.0219,.0133,.0596,.0983,.0596,.0133,.003,.0133,.0219,.0133,.003])},posterize:function w(D,O,M){var E,H,N,B=[],P=1,z=O.data;for(arguments.length<3&&(M=40),E=0;E<256;++E)E<M*P?B[E]=M*(P-1):(B[E]=M*P,++P);for(E=0;E<z.length;E+=4)H=z[E+1],N=z[E+2],z[E]=B[z[E]],z[E+1]=B[H],z[E+2]=B[N];return O},scatter:function A(D,O,M){var E,R,H,N,B,P,ee=O.width,le=O.height,te=O.data,Q=function(de,xe,ce,he){var Pe=[],Se=4*(ee*xe+de),Y=4*(ee*he+ce);Pe[0]=te[Se],Pe[1]=te[Se+1],Pe[2]=te[Se+2],Pe[3]=te[Se+3],te[Se]=te[Y],te[Se+1]=te[Y+1],te[Se+2]=te[Y+2],te[Se+3]=te[Y+3],te[Y]=Pe[0],te[Y+1]=Pe[1],te[Y+2]=Pe[2],te[Y+3]=Pe[3]};if(arguments.length<3&&(M=5),M<=0)return O;for(B=2*M,P=(M-1)*M,R=M;R<le-M;R+=B)for(E=M;E<ee-M;E+=B)for(H=!1,N=0;!H;)Q(Math.floor(Math.random()*B-M)+E,Math.floor(Math.random()*B-M)+R,Math.floor(Math.random()*B-M)+E,Math.floor(Math.random()*B-M)+R),++N>P&&(H=!0);return O},solarize:function x(D,O,M){var E,R,H,N,P=O.data;for(arguments.length<3&&(M=50),E=0;E<P.length;++E)((R=P[E])+(H=P[E+1])+(N=P[E+2]))/3<M&&(P[E]=255-R,P[E+1]=255-H,P[E+2]=255-N);return O},sharpen:function _(D,O,M){return arguments.length<3&&(M=20),t(D,O,[0,-1,0,-1,M,-1,0,-1,0],!0,!0)},edgeDetect:function S(D,O){return t(D,O,[-1,-1,-1,-1,8,-1,-1,-1,-1])},blur:function y(D,O,M){var B,P,z,J,q,G,ee,le,te,Q,de,xe,ce,he,E=O.width,R=E<<2,H=O.height,N=O.data,Pe=0;for(void 0===M&&(M=30),(M/=10)<0&&(M=0),le=1-((q=(2.44413*(B=M>=2.5?.98711*M-.9633:M>=.5?3.97156-4.14554*Math.sqrt(1-.26891*M):2*M*(3.97156-4.14554*Math.sqrt(.865545)))+2.85619*(P=B*B)+1.26661*(z=P*B))/(J=1.57825+2.44413*B+1.4281*P+.422205*z))+(G=-(1.4281*P+1.26661*z)/J)+(ee=.422205*z/J)),Pe=0;Pe<3;Pe++)for(var Se=0;Se<H;Se++){for(Q=Se*R+(E-1<<2)+Pe,he=ce=xe=de=N[te=Se*R+Pe];te<=Q;te+=4)N[te]=de=le*N[te]+q*xe+G*ce+ee*he,he=ce,ce=xe,xe=de;for(Q=Se*R+Pe,he=ce=xe=de=N[te=Se*R+(E-1<<2)+Pe];te>=Q;te-=4)N[te]=de=le*N[te]+q*xe+G*ce+ee*he,he=ce,ce=xe,xe=de}for(Pe=0;Pe<3;Pe++)for(var Y=0;Y<E;Y++){for(Q=(H-1)*R+(Y<<2)+Pe,he=ce=xe=de=N[te=(Y<<2)+Pe];te<=Q;te+=R)N[te]=de=le*N[te]+q*xe+G*ce+ee*he,he=ce,ce=xe,xe=de;for(Q=(Y<<2)+Pe,he=ce=xe=de=N[te=(H-1)*R+(Y<<2)+Pe];te>=Q;te-=R)N[te]=de=le*N[te]+q*xe+G*ce+ee*he,he=ce,ce=xe,xe=de}},emboss:function C(D,O,M){return arguments.length<3&&(M=95),t(D,O,[-18,-9,9,-9,100-M,9,0,9,18],!0,!0)},lighten:function I(D,O,M){return(arguments.length<3||M<0)&&(M=12/9),t(D,O,[0,0,0,0,M,0,0,0,0])},darken:function L(D,O,M){return(arguments.length<3||M>1)&&(M=6/9),t(D,O,[0,0,0,0,M,0,0,0,0])}}}(),function(e){if(e.support.touch="ontouchend"in document,e.support.touch){var n,t=e.ui.mouse.prototype,s=t._mouseInit,o=t._mouseDestroy;t._touchStart=function(l){n||!this._mouseCapture(l.originalEvent.changedTouches[0])||(n=!0,this._touchMoved=!1,a(l,"mouseover"),a(l,"mousemove"),a(l,"mousedown"))},t._touchMove=function(l){!n||(this._touchMoved=!0,a(l,"mousemove"))},t._touchEnd=function(l){!n||(a(l,"mouseup"),a(l,"mouseout"),this._touchMoved||a(l,"click"),n=!1)},t._mouseInit=function(){var l=this;l.element.bind({touchstart:e.proxy(l,"_touchStart"),touchmove:e.proxy(l,"_touchMove"),touchend:e.proxy(l,"_touchEnd")}),s.call(l)},t._mouseDestroy=function(){var l=this;l.element.unbind({touchstart:e.proxy(l,"_touchStart"),touchmove:e.proxy(l,"_touchMove"),touchend:e.proxy(l,"_touchEnd")}),o.call(l)}}function a(l,c){if(!(l.originalEvent.touches.length>1)){l.preventDefault();var d=l.originalEvent.changedTouches[0],h=document.createEvent("MouseEvents");h.initMouseEvent(c,!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),l.target.dispatchEvent(h)}}}(jQuery),JS9Inline={},JS9Inline["images/close.gif"]="data:image/gif;base64,R0lGODlhEAAOAKIAAAAAAGNjY3t7e5ycnL29vcbGxt7e3v///yH5BAAAAAAALAAAAAAQAA4AAANCeLrccybKKUWAJOudLSYAsIVE4RkaWZDdhRZZyJYnx8JEna3yVsOsm24GEuVcHJzGhNwlWweBdEqlBgqDrHa7LSQAADs=",JS9Inline["images/min.gif"]="data:image/gif;base64,R0lGODlhEAAOAPcAAAQCBISChNTSzERCRPz+/B+a/wCD/wB8/z8I7hz//wCA/wB8/wD/AAD/ABX/AAD/AAkF8AD/AACAeQB8AAADAgIoAABCAAAAAAAQ9AMgAAAWAAAAAKDWKeXyAhLVAAB3AOk/3OVHAoFIAHwAAABmrAAGAgESAAAAAFYB9AAAAAAAAAAAAKgAKeQAAhIAAAAAAG4W3AAKAgABAAADAMgBrOUAAhIAAAAAABgABu4AAZAAAHwAAHAAFQUAApEAAHwAAP/kyv8BAv8AAP8AAG1QmgUAApEAAHwAAIUA8ecAAIEAAHwAAAAAKQAAAhUAAAAAAGCArAMf5wAAEgAAALAj24kAvyAA1AAAd7hs8GF4ABX3eQC0AABo8QCFAACAKQC/An5QuABjBACMBsDhAAAIMAABgAAARQAAAP9/AP8CAP8gAP8BAP8Alv8An//8Of8FdgA6IAA8RwA6FQB2AAAgAAAAAAAAAAAAAABmqAAG5xUSEgAAAHwSYIYAngAAgAACfNgAEOUAIBIAFgAAAJ8AAOsAAIEAAHwAAErkB+MBAIEAAHwAAEBQAOUAAE8AAAAAALggAGEAIAEAFgAAAGxmAAAGAAASAAAAABR8AOWGABIAAAAAADTwAADmAAASAMAAAPiFAPcrABKDAAB8ABgAaO4AnpAAgHwAfHAA/wUA/5EA/3wA//8AYP8Anv8AgP8AfG0AEQUBAJEAAHwAAErpEfQrAICDAHx8AAAUXADn8BUSEgAAAADE/wAr/wCD/wB8/7gAAGEAABUAAAAAAAAQHAEg6AAWEgAAAAA0DgBkzwCDSwB8AFf//PT/54D/Enz/AAAYW+fo4hISTgAAALhtMGFk6BWDEgB8ALi4NOnvZBJOgwAAfAAQrQAZ6ABPEgAAAOQA7QEB/wAA/wAAfxAUnCDn6BYSEgAAAFAAEAABIAAAFgAAAA6INABkZACDgwB8fO4BEOYAIBIAFgAAAAEAfAAAhgAAAAAAAABwAObnABISAAAAAKC/fubPVRLVRwB3ACH5BAAAAAAALAAAAAAQAA4ARwhFAAkIHEiw4AACAhIqXKgwwEGGEBM6JBCgosWLFx9GZDhxI0eNAgCIHLmwo8eGIE+aPClgpUqQI0miRMiy5YCbOHPqvBkQADs=",JS9Inline["images/resize.gif"]="data:image/gif;base64,R0lGODlhDQANAPcAAISChNTSzPz+/AB8AGlwyB+ZWgCAeQB8AGL/GBz/5wD/EgD/AABtAACZABWAAAB8AAnaAACi6AA+EgB3AACYZwJRBAAa1wAAdwC+VAOU5wDUEgB3AKAtmOW01RLU1AB3d+nExOUDA4FAQHwAAAAghAAAAAEAAAAAAFbuAAAEAAAgAAAAAKgSxOQAARIAtgACAW4AAQAAAAAAAAAAAMierOUC5xIAEgAAABgB9u4AGpAA13wAWnDExAUDA5FAQHwAAP8whP+AAP9FAP8AAG3uAAUEAJEgAHwAAIUAxOcAAYEAtnwAAQAAxAAAAxUAQAAAAGBQMAMWgAAARQAAABABAAIAAB4AAAAAALjQbWEHRRUARQAAAAAAkAAAHAAATwAAAH5IcAAyHAAVT8AAAAAApAAA7AAAEgAAAP+kXP/m8v8SEv8AAP+YMP/VgP/URf93AADEIAAD8gBAEgAAAAAgAAAAAAAAAAAAAADuMAAEgBUgRQAAANYCYB4AngAAgAAAfNj8EOXm/xISFQAAAJ/8AOvmAIESAHwAAEqCB+PPAIHVAHx3AEDkAOXmAE8SAAAAALjEAGEB8AEAFQAAAGwFAAAAAAAAAAAAABTWAOUeABIAAAAAADTwAADmAAASAMAAAPiFAPcrABKDAAB8ABgAaO4AnpAAgHwAfHAA/wUA/5EA/3wA//8AYP8Anv8AgP8AfG0AFAUBAJEAAHwAAErpFPQrAICDAHx8AAAUXADn8BUSEgAAAADE/wAr/wCD/wB8/7gAAGEAABUAAAAAAAAQHAH/6AAVEgAAAAA0DgBkzwCDSwB8AFf//PT/54D/Enz/AAAYW+fo4hISTgAAALhtMGFk6BWDEgB8AJi4NFHvZBpOgwAAfAAQsOcZ6BJPEgAAAAAA6ucB/xIA/wAAfwAUnADn6AASEgAAAAEAEAAB/wAAFQAAABCINOdkZBKDgwB8fP8BEP8A//8AFf8AAPgA1uUAHhIAAAAAAAEzAAC5AADUAAB3AECYfvA6VRIzRwAAACH5BAEAAAEALAAAAAANAA0ARwg4AAMIHEhQoACCAgAACJBw4cGCBhUyhEixYsSFBRsylLjRoUSNFjdaBAlRY8KMHzle7CjSZMqFAQEAOw==",JS9Inline["images/restore.gif"]="data:image/gif;base64,R0lGODlhEAAOAKIAAAAAAGNjY3t7e5ycnL29vcbGxt7e3v///yH5BAAAAAAALAAAAAAQAA4AAANCeLrccybKKUWAJIPNM7GYxm1ZARpEQQDe6p3ryLIpLM/vhdIibeouDy9jKwVVH+CtlQwxjU2BdEqlBgqDrHa7LSQAADs=",JS9Inline["images/voyager/regions_annulus.svg"]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxMzQgMTM0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMzQgMTM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6NjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cjwvc3R5bGU+CjxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjY3IiBjeT0iNjciIHI9IjY0Ii8+CjxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjY3IiBjeT0iNjciIHI9IjQwIi8+Cjwvc3ZnPgo=",JS9Inline["images/voyager/regions_box.svg"]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxODYgMTM0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxODYgMTM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6NjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cjwvc3R5bGU+CjxyZWN0IHg9IjMiIHk9IjMiIGNsYXNzPSJzdDAiIHdpZHRoPSIxODAiIGhlaWdodD0iMTI4Ii8+Cjwvc3ZnPgo=",JS9Inline["images/voyager/regions_circle.svg"]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxMzQgMTM0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMzQgMTM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6NjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cjwvc3R5bGU+CjxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjY3IiBjeT0iNjciIHI9IjY0Ii8+Cjwvc3ZnPgo=",JS9Inline["images/voyager/regions_ellipse.svg"]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxODYgMTM0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxODYgMTM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6NjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cjwvc3R5bGU+CjxlbGxpcHNlIGNsYXNzPSJzdDAiIGN4PSI5MyIgY3k9IjY3IiByeD0iOTAiIHJ5PSI2NCIvPgo8L3N2Zz4K",JS9Inline["images/voyager/regions_line.svg"]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxODYgMTM0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxODYgMTM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6NjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cjwvc3R5bGU+CjxsaW5lIGNsYXNzPSJzdDAiIHgxPSIwIiB5MT0iMTM0IiB4Mj0iMTg2IiB5Mj0iMCIvPgo8L3N2Zz4K",JS9Inline["images/voyager/regions_point.svg"]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxMzQgMTM0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMzQgMTM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTt9Cjwvc3R5bGU+CjxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjY3IiBjeT0iNjciIHI9IjY0Ii8+CjxjaXJjbGUgY3g9IjY3IiBjeT0iNjYiIHI9IjEyIi8+Cjwvc3ZnPgo=",JS9Inline["images/voyager/regions_polygon.svg"]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxMzQgMTM0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMzQgMTM0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6NjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cjwvc3R5bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iODguMTUsNi43NCAxMjUuMDYsMzMuMTIgMTA4LjY2LDExMi43NCAyNy43MiwxMTMuMzUgMTUuNDIsMzUuOTcgIi8+Cjwvc3ZnPgo=",JS9Inline["images/voyager/regions_text.svg"]="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNzMuMDUgMTM4LjMiPjxkZWZzPjxzdHlsZT4uY2xzLTF7ZmlsbDpub25lO308L3N0eWxlPjwvZGVmcz48dGl0bGU+dHh0PC90aXRsZT48cmVjdCBjbGFzcz0iY2xzLTEiIHdpZHRoPSIxNzMuMDUiIGhlaWdodD0iMTM4LjMiLz48cGF0aCBkPSJNMjcuNzIsMzYuMjJILjcxVjI2Ljc1SDY1LjQ4djkuNDdIMzguMzR2NzUuOTFIMjcuNzJaIi8+PHBhdGggZD0iTTk3LjA5LDg2Ljc4LDc4LjUzLDExMi4xM2gtMTFMOTEuMiw4MC4zOCw2OC44LDUwLjNINzkuOTRMOTcuMDksNzMuODUsMTE0LjI0LDUwLjNoMTEuMTRMMTAzLDgwLjM4bDIzLjgxLDMxLjc1SDExNS42NVoiLz48cGF0aCBkPSJNMTQ2Ljg4LDk5LjJWNTguNzVIMTM2LjY0VjUwLjNoMTAuMjRWMzMuNGg5LjZWNTAuM0gxNjl2OC40NUgxNTYuNDh2MzguNGMwLDQuNjEsMi4wNSw3Ljk0LDYuMjcsNy45NGE5LjI2LDkuMjYsMCwwLDAsNi41My0yLjU3bDIuODIsNy4xN2MtMi40MywyLjMxLTUuODksNC0xMS41Miw0QzE1MS40OSwxMTMuNjYsMTQ2Ljg4LDEwOC40MSwxNDYuODgsOTkuMloiLz48L3N2Zz4=",JS9Inline["images/voyager/color_a.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIHDAcADwAAGQAAJAAALgAAOQAAQwAATgAAWQAAYwAAbgAAeAAAggIAjAgAlg8AoRYAqx0AtSQAwCsAyjIA1TkA4EAA6kcA9U4B/FUJ9VsU6mIe4Gkp1XAzy3c+wH5ItoVSrIxdoZNnl5pyjKF9gaiGeK+RbbabY7ymWMOwTsq6RNHFOdjPL9/aJObkGu3uEPT5Bfv/APr/APH/AOf/AN7/ANX/AMv/AML/ALn/ALD/AKf/AJ3/AJT/AIv/AIH/AHf/AG3/AGP/AFr/AFD/AEb/ADz/ADL/ACj/AB7/ABT/AAr/AQH/CgD/FgD/IgD/LQD/OAD/QwD/TwD/WgD/ZQD/cAD/ewD/hwD/kgD/nQD/qQD/tAD/wAD/ywD/1gD/4QD/7QD/+Af//7KjNILBAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ3LTA1OjAw2xzW7wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMKpBblMAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_aips0.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAAAYFBMVEXBwcE3NzcxMTEwMjA8KUJ0BJN5AJx5AJt7AJpRAKoAAMgUI89boOlfp+thp/A5oY4AlwAAlgAA0AAA+AAA9gB3+gD//wD/ygD/rwD/sAD/sQD/owD/HAD/AAD/Bwf/srIhB9ZYAAAACXBIWXMAAABIAAAASABGyWs+AAAAP0lEQVQoz2NgYGSCAmYWVjZ2CODg5IIDbh5eKODjF4ABQSFhERgQFYMDcQlJCJCSlpGFATl5hlFLRi0Z2pYAAP8BMglRFBCOAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ3LTA1OjAw2xzW7wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMKpBblMAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_b.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIHBwwAAA8AABkAACQAAC4AADkAAEMAAE4AAFkAAGMAAG4AAHgAAIIAAIwAAJYAAKEAAKsAALUAAMAAAMoAANUAAOAAAOoAAPUBAPwJAPUUAOoeAOApANUzAMs+AMBIALZSAKxdAKFnAJdyAIx9AIGGAHiRAG2bAGOmAFiwAE66AETFADnPAC/aACTkABruABD5AAX/BAD/DwD/GQD/IwD/LgD/OAD/QwD/TQD/VwD/YgD/bAD/dwD/gQD/iwD/lgD/oAD/qwD/tQD/vwD/ygD/1AD/3wD/6QD/8wD//QH//wn//xT//x7//yj//zP//z3//0j//1L//1z//2f//3H//3z//4b//5D//5v//6X//7D//7r//8T//8///9n//+T//+7///j///8WD52SAAAAAWJLR0RjXL4tqgAAAAlwSFlzAAAASAAAAEgARslrPgAAAHVJREFUKM9jYGBkYmZhZWPn4OTi5uHl4xcQFBIWERUTl5CUkpaRlZNXUFRSVlFVU9fQ1NLW0dXTNzA0MjYxNTO3sLSytrG1s3dwdHJ2cXVz9/D08vbx9fMPCAwKDgkNC4+IjIqOiY2LT0hMSmYYtWTUkqFtCQACtpqx25ceuQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMNsc1u8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDctMDU6MDCqQW5TAAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_bb.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIJBwcHAAAMAAARAAAXAAAcAAAhAAAnAAAsAAAyAAA3AAA8AABAAABFAABLAABQAABVAABaAABfAABlAABqAABwAAB1AAB6AAB/AQCEBQCJCgCODwCTFACZGgCeHwCjJACoKQCtLgCzNAC5OQC+PgDCQwDHSADNTgDSUwDXWADcXQDhYgDnaADsbQDxcgD2dwD7fAD/ggL/hwf/jAz/kRH/lhb/nBz/oSH/pib/qyv/sDD/tjb/uzv/wED/xUX/ykr/0FD/1VX/2lr/31//5GT/6mr/72//9HT/+Xn//n7//4T//4n//47//5P//5j//57//6P//6j//63//7L//7j//73//8L//8f//8z//9L//9f//9z//+H//+b//+z///H///b///v///9tCjTtAAAAAWJLR0RjXL4tqgAAAAlwSFlzAAAASAAAAEgARslrPgAAAHVJREFUKM9jYGBkYmZhZWPn4OTi5uHl4xcQFBIWERUTl5CUkpaRlZNXUFRSVlFVU9fQ1NLW0dXTNzA0MjYxNTO3sLSytrG1s3dwdHJ2cXVz9/D08vbx9fMPCAwKDgkNC4+IjIqOiY2LT0hMSmYYtWTUkqFtCQACtpqx25ceuQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMNsc1u8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDctMDU6MDCqQW5TAAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_blue.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIHBwgAAAMAAAYAAAgAAAsAAA0AABAAABMAABYAABkAABsAAB4AACAAACIAACUAACcAACoAAC0AAC8AADIAADUAADgAADsAAD0AAD8AAEEAAEQAAEcAAEkAAEwAAE4AAFEAAFQAAFYAAFkAAFwAAF8AAGEAAGMAAGYAAGgAAGsAAG4AAHAAAHMAAHUAAHgAAHsAAH0AAIAAAIIAAIUAAIgAAIoAAI0AAI8AAJIAAJUAAJcAAJoAAJwAAJ8AAKIAAKQAAKcAAKkAAKwAAK8AALEAALQAALYAALkAALwAAL4AAMEAAMMAAMYAAMkAAMsAAM4AANAAANMAANYAANgAANsAAN0AAOAAAOMAAOUAAOgAAOoAAO0AAPAAAPIAAPUAAPcAAPoHB/2ysv9cPJ2OAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ3LTA1OjAw2xzW7wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMKpBblMAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_color.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAAAqFBMVEWysrIHBwcAAAAqKiouLi4yMjJXV1dgYGBfX1+BgYGPj4+Ojo6srKzAwMC/v7++vr7V1dXv7+/u7u7y8u6gr+4BL+4ALu4ALe8AOOQAXcEAX78AY7gAe4YAf38Agn0AslgAwE0Av04A3xoA7wAA7gAqxABPngBOnwBNoABhkgB/fwB+gACIcgCeTwCfTgCrQgDoBgDuAADqAAbGAEK/AE+/AE7BB1Psssqk2tDoAAAACXBIWXMAAABIAAAASABGyWs+AAAAaUlEQVQoz2NgYGQCAkZmFiBgZWPn4OBg5+TiBgIeXj4+Pn4BQSEhIWERUTExMXEJSSkgkJaRBQI5eQVFIFBSVlFRUVZVU1dX19DUAgJtHV09PT1dfQNDIDAyNjE1NTUzZxi1ZNSSoW0JAOL6VAHE/HacAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ4LTA1OjAwLVSmBgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0OC0wNTowMFwJHroAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_cool.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIHBwkAAAcAAAwAABEAABYAABsAAB8AACQAACkAAC8AADMAADgAAD0AAEIAAEcAAEwAAFEAAFUAAFoAAF8AAGQAAGkAA24ABnMACngADn0AEYIAFIYAGIsAG5EBH5UBIpoCJp8CKaQDLakDMa4ENLMFN7gFO7wGPsIGQsYHRssHSdAITdUIUNoJVN8JV+QKWugLXu0LYvMMZfgMafwNbP8NcP8Oc/8Od/8Pev8Qfv8Qgf8Rhf8RiP8SjP8Sj/8Tk/8Ulv8Umv8Vnf8Vof8WpP8WqP8XrP8Xr/8Ysv8Ytv8auf8ivf8swP82xP9AyP9Ky/9Tz/9d0v9n1f9w2f963P+E4P+O5P+X5/+h6/+r7v+18v+/9f/I+f/S/P/c///l///v///5//////+uwBW/AAAAAWJLR0RjXL4tqgAAAAlwSFlzAAAASAAAAEgARslrPgAAAHVJREFUKM9jYGBkYmZhZWPn4OTi5uHl4xcQFBIWERUTl5CUkpaRlZNXUFRSVlFVU9fQ1NLW0dXTNzA0MjYxNTO3sLSytrG1s3dwdHJ2cXVz9/D08vbx9fMPCAwKDgkNC4+IjIqOiY2LT0hMSmYYtWTUkqFtCQACtpqx25ceuQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0Ni0wNTowMH1r3VsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDYtMDU6MDAMNmXnAAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_green.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIHCAcAAwAABgAACAAACwAADQAAEAAAEwAAFgAAGQAAGwAAHgAAIAAAIgAAJQAAJwAAKgAALQAALwAAMgAANQAAOAAAOwAAPQAAPwAAQQAARAAARwAASQAATAAATgAAUQAAVAAAVgAAWQAAXAAAXwAAYQAAYwAAZgAAaAAAawAAbgAAcAAAcwAAdQAAeAAAewAAfQAAgAAAggAAhQAAiAAAigAAjQAAjwAAkgAAlQAAlwAAmgAAnAAAnwAAogAApAAApwAAqQAArAAArwAAsQAAtAAAtgAAuQAAvAAAvgAAwQAAwwAAxgAAyQAAywAAzgAA0AAA0wAA1gAA2AAA2wAA3QAA4AAA4wAA5QAA6AAA6gAA7QAA8AAA8gAA9QAA9wAA+gAH/Qey/7JQ9JLiAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ3LTA1OjAw2xzW7wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMKpBblMAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_grey.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAAAAAAqvwWpAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAB7SURBVCjPY9jEwczGwc0rICwmKS2noKSqrqWrb2RqYW1r7+ji7unjFxgSFhkTn5iclpGdV1BcWlFd29DU2tHV2z9p6vRZc+YvWrJ85Zr1G7ds27ln38HDx06ePnfh8rUbt+8+ePz0xau3Hz59/f7r73+GUUtGLRnalgAAfkCRkMwlhR4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMDRUMTQ6MDU6NDYtMDU6MDB9a91bAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTA0VDE0OjA1OjQ2LTA1OjAwDDZl5wAAAABJRU5ErkJggg==",JS9Inline["images/voyager/color_he.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWzsrI1BxJ0ACWAAEx/AGp/AH1/AI9/BZx/GZl/L5R/RI5/Wol/b4R/gH9/hXp/i3R/kG5/lWl/mmR/n19/pVl/qlR/r09/tEp/uUV/vkCBwEGEwESHwUeJwUmMwkyOwk6Rw1GUxFSWxFaZxVmbxlyexl+hx2Gjx2OmyGaoyWiryWuuym6wy3Czy3O1zHW4zHi7zXu9zn2/z4DAz4LC0YXD0ojE0orG1I3H1I/I1ZLK15XL15fM2JrN2ZzP2p/Q26LR3KTT3afU3qnV36zX4K/Y4bHZ4rTa47bc5Lnd5bze5r7g58Hh6MPi6cbk6snl68vm7M7n7dDp7tPq79br8Njt8dvu8t3v8+Dx9OPy9eXz9uj09+r2+O33+fD4+vL6+/X7/Pf8/fr+/v3////OONOYAAAAAWJLR0RjXL4tqgAAAAlwSFlzAAAASAAAAEgARslrPgAAAHVJREFUKM9jYGBkYmZhZWPn4OTi5uHl4xcQFBIWERUTl5CUkpaRlZNXUFRSVlFVU9fQ1NLW0dXTNzA0MjYxNTO3sLSytrG1s3dwdHJ2cXVz9/D08vbx9fMPCAwKDgkNC4+IjIqOiY2LT0hMSmYYtWTUkqFtCQACtpqx25ceuQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMNsc1u8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDctMDU6MDCqQW5TAAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_heat.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIKCAcLAwATBgAbCAAiCwAqDQAxEAA5EwBBFgBIGQBQGwBYHgBgIABnIgBuJQB2JwB+KgCGLQCNLwCUMgCcNQCkOACsOwC0PQC7PwDDQQDKRADSRwDaSQDhTADpTgDwUQD4VAD+VgD/WQD/XAD/XwD/YQD/YwD/ZgD/aAD/awD/bgD/cAD/cwD/dQD/eAD/ewD/fQD/gAD/ggD/hQD/iAD/igD/jQD/jwD/kgD/lQD/lwD/mgD/nAD/nwD/ogD/pAD/pwX/qQ3/rBX/rx3/sSX/tCz/tjX/uT3/vEX/vk3/wVT/w1z/xmT/yWz/y3T/znv/0IP/04v/1pP/2Jv/26P/3av/4LP/47v/5cP/6Mr/6tL/7dr/8OL/8ur/9fH/9/n/+v///f////9RYC9pAAAAAWJLR0RjXL4tqgAAAAlwSFlzAAAASAAAAEgARslrPgAAAHVJREFUKM9jYGBkYmZhZWPn4OTi5uHl4xcQFBIWERUTl5CUkpaRlZNXUFRSVlFVU9fQ1NLW0dXTNzA0MjYxNTO3sLSytrG1s3dwdHJ2cXVz9/D08vbx9fMPCAwKDgkNC4+IjIqOiY2LT0hMSmYYtWTUkqFtCQACtpqx25ceuQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0Ni0wNTowMH1r3VsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDYtMDU6MDAMNmXnAAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_hsv.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWxsbEdHB07OTxEQkhMSVJQTVlSUGBTUWZTUmtSUnBSVHRRVnhQWHxOW39MXoNKYYZIZIlGaIxDbo9Ac5E+eZQ7f5c4hpk1jpwylp0vnp8sopwppZYmp5AjqYggqoEdrHkarm8YsGYVsl0TtFIQtUcOtzwMuTAKuiQIvBgHvQoLvwUXwQQhwgMswwI5xQFExgBRyABdyQBrywB4zACHzgCUzwGg0AGw0QO90gTN1AbV0QjWxQrYugzZrg7apBHbmxPcjxfdhhreex7gcyLhaybiYirjWy/kUzTlTTnmSD7nRUXpSVXpT2PqVXDsXIDsYozuaZvucKfwd7Lxfr3xhsjyjdLzltz0neP1pOr2rfH3tfb1vvjzxvnyzvry2Pvz4fv26fz48v39/P/////3lQJAAAAAAWJLR0RjXL4tqgAAAAlwSFlzAAAASAAAAEgARslrPgAAAHVJREFUKM9jYGBkYmZhZWPn4OTi5uHl4xcQFBIWERUTl5CUkpaRlZNXUFRSVlFVU9fQ1NLW0dXTNzA0MjYxNTO3sLSytrG1s3dwdHJ2cXVz9/D08vbx9fMPCAwKDgkNC4+IjIqOiY2LT0hMSmYYtWTUkqFtCQACtpqx25ceuQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0OC0wNTowMC1UpgYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDgtMDU6MDBcCR66AAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_i8.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAAAQlBMVEWysrIHBwcAAAAAEwAA1wAA/wAAZZoAAP8AVP8A/v8A//8d4uLiHR3/AAD/AQD/qwD//wD/mmX/AP//KP//7P/////h+IhAAAAAAWJLR0QV5dj5owAAAAlwSFlzAAAASAAAAEgARslrPgAAADNJREFUKM9jYGBkggNmFlYEYGNHAA5OLjjg5uGFAz5+AQQQFEIAYRFRJMAwasmoJUPbEgBf7iPZ6JO0OwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMNsc1u8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDctMDU6MDCqQW5TAAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_inferno.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrMHBwwBAAkCAg8EAxQGBBoIBiALByYPCSwSCjIVCzgZCz8dDEUhC0smC1ArClYvCls0CV84CWI9CWVBCWdFCmlKC2pODWxSDmxWD21aEW1fEm5jFG5nFW5rF25vGG5zGm13HG18HWx/H2uEIGuIIWqMI2mQJGiUJmaYJ2WcKWOhKmKlLGCpLl6tL1yxMVq1M1e5NVa8N1PAOVHEPE7HPkvLQEnOQ0bSRkPVSUDYTD3bTzreUzfhVjTkWjHmXS7oYSvrZSftaSTvbSHxcR3ydhr0ehf1fxP3gxD4iAz5jAn6kQf6lgb7mwb7nwf7pAr7qg77rxP7sxj7uB36vSP5wyr5yDD4zTf20j7110b03E7z4Vfy5mDx6mrx73Xy84Dz9ov2+pX6/aH+/+T+q6T7AAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAxLTI1VDEyOjEyOjA4LTA1OjAwjGeqjgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMS0yNVQxMjoxMjowOC0wNTowMP06EjIAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_magma.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrMHBwwBAQkCAg4EAxMGBRkIBh4LCCQOCikQDC8TDTUWDjsaEEEdEEghEU4kEVQpEVotEGAxEGY2D2o6D28/D3JDD3VIEHhMEHlQEntUE3xYFX5cFn5gGH9kGoBoG4BsHYBwH4F1IIF4IoF9I4GBJYGFJoGJKIGNKYCRKoCVLICaLX+eLn6iMH6mMX2rM3yvNHuzNXq3N3i8OHfAOnXEO3TIPXLMP3DQQW/UQ23YRmrcSGnfS2bjTmXmUWLpVGHsWF/uXF7wYF3zZVz0aVv2blv3c1z4eFz5fV36gV/7hmD8jGP8kWT9lWf9mmr9n239pHD+qXP+rnb+snr+t37+vIH+wYX+xon+yo79z5L91Jb92Zv93Z/84qT856j87K788LL89bf7+r7+/ux7Y2jEAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAxLTI1VDEyOjEyOjA4LTA1OjAwjGeqjgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMS0yNVQxMjoxMjowOC0wNTowMP06EjIAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_parula.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEXCv9s7MIk1Lo41MZY2Np41Oqc0Pa4xQrguR8AqS8ghUdEYVtgOXN0EYeABZOABaOEDa+AFbd8IcN4Lc90NddsQeNoRe9gSfdcTgNUUgtQUhdMTidIRjNIPj9INktEKldEImNEGm88Gns4GoMwFosoFpMgFpsYGqMIHqsAJq70NrboQrrcVsLQZsbAesq0ktKkptqYut6I2uJ48uZpCupZLvJJRvI9ZvYthvoZovoNwvoB5v3x/v3qHv3aOvnOTvnGavm6hvmynvmmtvWezvGW4vGO+vGDDvF7Ju1zPulrTulfYulXfuVPkuVHpuU7uuUryuUf4ukP7vT/9vzz+wzf9xjT9yTH7zS360Cv50yj31yb22iP13iH04x305xr06xj28BT39RH4+hT9/balLXYSAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAxLTI1VDEyOjEyOjA4LTA1OjAwjGeqjgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMS0yNVQxMjoxMjowOC0wNTowMP06EjIAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_plasma.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEW2tNsXDYsYBoseBY4jBZApBZMuBJUzBJc3BJk8A5pAA5xEA55JAp9NAqFRAaJVAaNZAaReAKViAKZmAKdqAKduAKhyAKh2Aah6Aah9A6eBBKeFBqaJCKWNC6SQDqOUEKGXE6CbFp6eGZyhHJqlH5ioIparJZOuJ5GxK4+0LY23MIq6NIe8NoW/OYLBPIDEP37HQnvJRXnMSHbOS3TRTnLTUW/VVG3XV2vZWWncXWbeYGTfY2LiZmDkaV7lbFvnb1npclfrdVTseVPufFDwf07xg0zzhkn0iUf1jUX2kEL3lEH4lz75mzz6nzr7ojf8pjX8qjP8rjH9si/9ti39uiv9vin9wij9xib8yiX8ziX70yT61yT52yT34CT25CX16Cbz7Sby8Sbw9ir6/bwxuQ4jAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAxLTI1VDEyOjEyOjA4LTA1OjAwjGeqjgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMS0yNVQxMjoxMjowOC0wNTowMP06EjIAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_rainbow.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEX/sv/4B//rAP/eAP/RAP/EAP+3AP+qAP+cAP+PAP+CAP91AP9oAP9cAP9PAP9CAP81AP8oAP8bAP8OAP8CAf8AC/8AGf8AJv8AM/8AP/8ATP8AWf8AZv8Ac/8AgP8Ajf8Amv8Ap/8AtP8Awf8Az/8A3P8A6P8A9f8A/vsA/+4A/+EA/9QA/8cA/7oA/60A/6AA/5MA/4YA/3kA/2wA/18A/1IA/0UA/zgA/ysA/x4A/xEA/wQI/wAV/wAi/wAv/wA8/wBJ/wBW/wBj/wBw/wB9/wCK/wCX/wCk/wCx/wC+/wDL/wDY/wDl/wDy/wD9/QD/8QD/5AD/1wD/ygD/vQD/sAD/owD/lgD/iQD/fAD/bwD/YgD/VQD/SAD/OwD/LgD/IQD/FAD/Dgf/srK5q7D5AAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ4LTA1OjAwLVSmBgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0OC0wNTowMFwJHroAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_red.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIIBwcDAAAGAAAIAAALAAANAAAQAAATAAAWAAAZAAAbAAAeAAAgAAAiAAAlAAAnAAAqAAAtAAAvAAAyAAA1AAA4AAA7AAA9AAA/AABBAABEAABHAABJAABMAABOAABRAABUAABWAABZAABcAABfAABhAABjAABmAABoAABrAABuAABwAABzAAB1AAB4AAB7AAB9AACAAACCAACFAACIAACKAACNAACPAACSAACVAACXAACaAACcAACfAACiAACkAACnAACpAACsAACvAACxAAC0AAC2AAC5AAC8AAC+AADBAADDAADGAADJAADLAADOAADQAADTAADWAADYAADbAADdAADgAADjAADlAADoAADqAADtAADwAADyAAD1AAD3AAD6AAD9Bwf/srIU/HeeAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ3LTA1OjAw2xzW7wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0Ny0wNTowMKpBblMAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_sls.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABI1BMVEWysrIOBw8dACMzAD5LAFtgAHV1AI+AAKJ6AKVyAKhrAKtjAK5bALFQALVAALsyAMAjAMUVAMoEANAABtYAEN4AG+YAJe0AMPUAOv0ASP8AV/8AaP8AeP8Aif8AmP0ApfQAs+YAv9oAzM0A2cEA5rMA5KUA4ZcA3YkA2n0A1mwA1GAA1FEA00UA0zgA0yoA0x0E1BMS1g8m2gs23QhJ4AVZ4wJp5gB85gCM5gCf5gCv5gDA5gDN5AHX4gPf3wXo3Qfy2gn62Av90Q37yA/5vxH3tBL1qxTzoBbzlxT1jRD3hAz6eQj7cAT+ZwH+VwD9RwD8NAD8JAD6EwD4BQDuAADiAADVAADJAAC9AAC0CAi8KCjJU1PXf3/lq6vz2dn+/f3///90lDsXAAAAAWJLR0Rgxbd8EAAAAAlwSFlzAAAASAAAAEgARslrPgAAAHRJREFUKM9jYGBkYmZhZWPn4OTi5uHl4xcQFBIWERUTl5CUkpaRlZNXUFRSVlFVU9fQ1NLW0dXTNzA0MjYxNTO3sLSytrG1s3dwdHJ2cXVz9/D08vbx9fMPCAwKDgkNC4+IjIqOiY2LTwAChlFLRi0Z2pYAAMAPmoFYidXLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ2LTA1OjAwfWvdWwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0Ni0wNTowMAw2ZecAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_staircase.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAAApVBMVEW3t8IWFjkPDzMPDzIUFEQeHmYeHmcpKYstLZotLZktLZgxMac9Pcs9PcxHR+5MTP9NTP8/R80SNBoPMw4PMw8YUhgeZx4eZh4eZR4gbiAslSwtmS0tmC02tDY9zT09zD0/0j9K+UpM/0xM/01AjzAzDA4zDw83EBBeHBxnHh5mHh5lHh56JCSZLS2bLi7BOjrNPT3MPT3LPT3dQkL/TEz/UVH/ycnjTNQ0AAAACXBIWXMAAABIAAAASABGyWs+AAAAYUlEQVQoz2NgYGQCAmYWVhBgY+fg5OTk4ubhBQE+fiAQEBQSFgECUTFxcXEJSSlpIJCRlZMHAgVFJSBQVlFVAwJ1DU0tLS1tHV0Q0NM3MDQ0NDI2AQFTM4ZRS0YtGdqWAAAuMVQh1rBrtAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOC0wMS0wNFQxNDowNTo0OC0wNTowMC1UpgYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTgtMDEtMDRUMTQ6MDU6NDgtMDU6MDBcCR66AAAAAElFTkSuQmCC",JS9Inline["images/voyager/color_standard.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEWysrIICAoDAwsGBhMICBsKCiIMDCoPDzIRETsTE0MWFkoYGFIbG1odHWIfH2oiInEkJHkmJoApKYgrK5AtLZcvL58yMqg1NbA2Nrg5Ob87O8c+Ps9AQNdCQt9FReZHR+5KSfojTHUAUAAEVgQGXAYJYQkLZgsNbA0QchASdxIUfBQXghcZhxkbjRsdkh0gmCAjnSMkoyQnqCcprikssywuuC4wvjAzxDM1yTU3zjc61Do82Tw/3z9A5EBD6kNG70ZI9UhK70dNNRBTAAFYBQVdBwdjCQloCwtuDg5zERF4EhJ+FRWEFxeJGhqOHByUHh6aISGfIyOkJSWpKCivKiq1LCy6Li6/MTHFNDTKNTXQODjVOjrbPT3gPz/lQUHrRETxRkb2SEj7UFD/ycmFm+dxAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTAxLTA0VDE0OjA1OjQ4LTA1OjAwLVSmBgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wMS0wNFQxNDowNTo0OC0wNTowMFwJHroAAAAASUVORK5CYII=",JS9Inline["images/voyager/color_turbo.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAYAAAAP1Fp1AAADUklEQVRIib1W6dLbKgw9wluau0x7Z+6D9BX6/q/TJgYjddCCcb7vb+qMAgYh4Bwtpu///5B5+w/p1uQb5vUr0u1f0NbkH0y3v4HtL9B2B61fVLCtoHWFbAtkXSDbBFkmHBtQN8GxMo7tQFkKyppRlyd4yvi5PIAlg5YdZc6gdcc0Zcicscw70pSxTju2acc9PXBLT9zSjjv9wpf0xJ1a/4E7PXFHwY123DhjlQM3ObA1qcAijO0grFVUloOwlYS5EtYiWHLCfCTMRTCXBCqMKUNb2gWpMLAfwM6QZwXlA/wswLOi7qJjdT9Qs6A+BUcuqJlRC+MoFcfBODJhb+9ZUCqQKyNXQS6CvQJ7pWYOOQMPfU94sCDhLY+A5Gr3gCDpmE0IBJOItklsbhQWgGS0I+daITAIJIRxGxvHdW85x6N/tcamL6z9JnZMOm3wucZaVgHzZe+Xba/9ZoPjnT7VbL03EUKfHUnbIKWRkQFUERQYAdwJC/0EbqSJOEED2MJov9YqMS7koIu2dvlYp2SIUmAmXC+Iip1FuAucm7AvThtksnFUJyjORRAm3VfoI0nCuDxqQ49jp5rfQ8j1CaDV82HgZggWjwyIRYn4nIkRoVdToG1eeoT5pRWo2m+q5CH69seql3TOhwYhtUkIwsQRIh8z0k+yqK+ROIfq1xN0moxQuMtXCxAlyFXt/EN0kL2/KULGxzYlB71qWmoRgj6XhFA8asgliflipKDRy5WoFhkNKwU6iDH9DnSPmtO7xYkWZ6S/n2ieIAldiSd8QgwGfXZ9I0cDWAL8Qc951/kXtN5OSKQYcc9PHWybmJQki5Tquomvay0pDBdy9CRu1feiYT8HVkLf+zjno8+n0WGTl9ZrxofhF3tGBlsCCkLpWjeuNWTYiv4AIeeWp7RoqE5A9qzcosTEs7JYEojCTlpHTnRbZMDnLd+LpygCRREOAsK1P9QNeAQO0QPuUcM9GuL05tojqUFySzkYHaHdItX4TugJ6kOkDAjhT9WQAFS/TzxdtchI7TMviRLRxlPzrJ6eLHXZKgM7LhQZXKkMEno9qGBqoEZhd8K8jliaSl6Ih+I/umknfXSAgZhmo+VLsupjJPRKdCEwokPPE5963TVfPn4A/AaurDCUJUCwkAAAAABJRU5ErkJggg==",JS9Inline["images/voyager/color_viridis.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAICAMAAAA4CqpHAAABLFBMVEXHs8xJCVtFBlpGCl1GDmFHEmRHFmhIGWtIHG5IIHFII3RHJnZHKnlGLXtGMH1FM39FN4FDOoNCPYRCQIVAQ4c/Roc+SYk9TIk8T4o6Uos5VIs4V4w2Wow1XIw0X40zYY0xZI0wZ40vaY0ubI4tbo4scY4rdI4qdo4peY4oe44nfY4mgI4lgo4khY0jh40iiY0hjI0hjowgkYwfk4sflosemIoemokenYgen4gfooYgpYUhp4QjqYIlq4Eorn8rsH4usnwxtXo1t3g5uXY+vHNCvnFHwG5MwmtRxGhWxmVcyGJiyl9ozFttzlhzz1R60VCA002H1EiN1kSU10Cb2Dyh2jeo2zOv3C623Sq93iXE3yHL4B7S4RvZ4hnf4xjm5Bnt5Brz5R765yj++L2Ad/FjAAAACXBIWXMAAABIAAAASABGyWs+AAAAdUlEQVQoz2NgYGRiZmFlY+fg5OLm4eXjFxAUEhYRFROXkJSSlpGVk1dQVFJWUVVT19DU0tbR1dM3MDQyNjE1M7ewtLK2sbWzd3B0cnZxdXP38PTy9vH18w8IDAoOCQ0Lj4iMio6JjYtPSExKZhi1ZNSSoW0JAAK2mrHblx65AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAxLTI1VDEyOjEyOjA4LTA1OjAwjGeqjgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMS0yNVQxMjoxMjowOC0wNTowMP06EjIAAAAASUVORK5CYII=",JS9Inline["images/voyager/zoom_1.svg"]="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODYuMTIgMTcxLjkyIj48ZGVmcz48c3R5bGU+LmNscy0xLC5jbHMtMntmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fS5jbHMtMXtzdHJva2Utd2lkdGg6MTBweDt9LmNscy0ye3N0cm9rZS13aWR0aDoxNnB4O308L3N0eWxlPjwvZGVmcz48dGl0bGU+bWFnMTwvdGl0bGU+PGNpcmNsZSBjbGFzcz0iY2xzLTEiIGN4PSIxMDYuMTIiIGN5PSI4MCIgcj0iNzUiLz48bGluZSBjbGFzcz0iY2xzLTIiIHgxPSI1LjI0IiB5MT0iMTY1Ljg3IiB4Mj0iNDguNyIgeTI9IjEyOC4yNCIvPjxwYXRoIGQ9Ik0xMDMuNjcsNDUuMzlsLTE2LDE3LTcuNS03LjY1LDI1LTI1LjhoMTFWMTI4Ljk0SDEwMy42N1oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMCkiLz48L3N2Zz4=",JS9Inline["images/voyager/zoom_in.svg"]="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODYuMTIgMTcxLjkyIj48ZGVmcz48c3R5bGU+LmNscy0xLC5jbHMtMntmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fS5jbHMtMXtzdHJva2Utd2lkdGg6MTBweDt9LmNscy0ye3N0cm9rZS13aWR0aDoxNnB4O308L3N0eWxlPjwvZGVmcz48dGl0bGU+bWFncGx1czwvdGl0bGU+PGNpcmNsZSBjbGFzcz0iY2xzLTEiIGN4PSIxMTcuMTIiIGN5PSI2OSIgcj0iNjQiLz48bGluZSBjbGFzcz0iY2xzLTIiIHgxPSI1LjI0IiB5MT0iMTY1Ljg3IiB4Mj0iNjguNzMiIHkyPSIxMTAuODkiLz48bGluZSBjbGFzcz0iY2xzLTIiIHgxPSI3NC4zOCIgeTE9IjY5IiB4Mj0iMTU5Ljg2IiB5Mj0iNjkiLz48bGluZSBjbGFzcz0iY2xzLTIiIHgxPSIxMTcuMTIiIHkxPSIxMTEuNzQiIHgyPSIxMTcuMTIiIHkyPSIyNi4yNiIvPjwvc3ZnPg==",JS9Inline["images/voyager/zoom_out.svg"]="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODYuMTIgMTcxLjkyIj48ZGVmcz48c3R5bGU+LmNscy0xLC5jbHMtMntmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fS5jbHMtMXtzdHJva2Utd2lkdGg6MTBweDt9LmNscy0ye3N0cm9rZS13aWR0aDoxNnB4O308L3N0eWxlPjwvZGVmcz48dGl0bGU+bWFnbWludXM8L3RpdGxlPjxjaXJjbGUgY2xhc3M9ImNscy0xIiBjeD0iMTE3LjEyIiBjeT0iNjkiIHI9IjY0Ii8+PGxpbmUgY2xhc3M9ImNscy0yIiB4MT0iNS4yNCIgeTE9IjE2NS44NyIgeDI9IjY4LjczIiB5Mj0iMTEwLjg5Ii8+PGxpbmUgY2xhc3M9ImNscy0yIiB4MT0iNzQuMzgiIHkxPSI2OSIgeDI9IjE1OS44NiIgeTI9IjY5Ii8+PC9zdmc+",JS9Inline["images/voyager/zoom_tofit.svg"]="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODIuMjggMTY4LjgzIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2Utd2lkdGg6MTBweDt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPm1hZ3RvZml0PC90aXRsZT48cmVjdCBjbGFzcz0iY2xzLTEiIHg9IjUiIHk9IjUiIHdpZHRoPSIxNzIuMjgiIGhlaWdodD0iMTU4LjgzIi8+PGxpbmUgY2xhc3M9ImNscy0xIiB4MT0iMTA2Ljc5IiB5MT0iODQuNDIiIHgyPSIxNTIuMyIgeTI9Ijg0LjQyIi8+PHBvbHlnb24gcG9pbnRzPSIxMzIuMzggMTAxLjM3IDE0OS4zNCA4NC40MiAxMzIuMzggNjcuNDYgMTQ2Ljc4IDY3LjQ2IDE2My43MyA4NC40MiAxNDYuNzggMTAxLjM3IDEzMi4zOCAxMDEuMzciLz48bGluZSBjbGFzcz0iY2xzLTEiIHgxPSI3NC44IiB5MT0iODQuNTIiIHgyPSIyOS4yOSIgeTI9Ijg0LjUyIi8+PHBvbHlnb24gcG9pbnRzPSI0OS4yMSA2Ny41NyAzMi4yNSA4NC41MiA0OS4yMSAxMDEuNDggMzQuODIgMTAxLjQ4IDE3Ljg2IDg0LjUyIDM0LjgyIDY3LjU3IDQ5LjIxIDY3LjU3Ii8+PGxpbmUgY2xhc3M9ImNscy0xIiB4MT0iOTEuMDUiIHkxPSI3NS4wMiIgeDI9IjkxLjA1IiB5Mj0iMjkuNTEiLz48cG9seWdvbiBwb2ludHM9IjEwOCA0OS40MyA5MS4wNSAzMi40NyA3NC4wOSA0OS40MyA3NC4wOSAzNS4wNCA5MS4wNSAxOC4wOCAxMDggMzUuMDQgMTA4IDQ5LjQzIi8+PGxpbmUgY2xhc3M9ImNscy0xIiB4MT0iOTEuMDUiIHkxPSI5NC4wMyIgeDI9IjkxLjA1IiB5Mj0iMTM5LjU0Ii8+PHBvbHlnb24gcG9pbnRzPSI3NC4wOSAxMTkuNjIgOTEuMDUgMTM2LjU4IDEwOCAxMTkuNjIgMTA4IDEzNC4wMSA5MS4wNSAxNTAuOTcgNzQuMDkgMTM0LjAxIDc0LjA5IDExOS42MiIvPjwvc3ZnPg==",JS9Inline["images/voyager/zoom_zoom.svg"]="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODYuMTIgMTcxLjkyIj48ZGVmcz48c3R5bGU+LmNscy0xLC5jbHMtMntmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fS5jbHMtMXtzdHJva2Utd2lkdGg6MTBweDt9LmNscy0ye3N0cm9rZS13aWR0aDoxNnB4O308L3N0eWxlPjwvZGVmcz48dGl0bGU+bWFnPC90aXRsZT48Y2lyY2xlIGNsYXNzPSJjbHMtMSIgY3g9IjExNy4xMiIgY3k9IjY5IiByPSI2NCIvPjxsaW5lIGNsYXNzPSJjbHMtMiIgeDE9IjUuMjQiIHkxPSIxNjUuODciIHgyPSI2OC43MyIgeTI9IjExMC44OSIvPjwvc3ZnPg==",JS9Inline["images/checkmark.svg"]="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNzMuMDUgMTYyLjQ4Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPmNoZWNrbWFyazwvdGl0bGU+PHJlY3QgY2xhc3M9ImNscy0xIiB5PSIyNC4xOCIgd2lkdGg9IjE3My4wNSIgaGVpZ2h0PSIxMzguMyIvPjx0ZXh0IHk9IjI0LjE4Ii8+PHJlY3QgY2xhc3M9ImNscy0xIiB4PSIxNC45OSIgeT0iMzYuNSIgd2lkdGg9IjEzOS4yMiIgaGVpZ2h0PSIxMTAuMzgiLz48dGV4dCB5PSIyNC4xOCIvPjxwYXRoIGQ9Ik02MC40NCw2OC4yNGw0LjI4LTRMNzgsODAuNDRsMjUuOTQtNDgsNC44MiwzTDc4LjgyLDkwLjYzWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAyNC4xOCkiLz48L3N2Zz4=",($jscomp=$jscomp||{}).scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){e!=Array.prototype&&e!=Object.prototype&&(e[t]=s.value)},$jscomp.getGlobal=function(e){return typeof window<"u"&&window===e?e:typeof global<"u"&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,s,o){if(t){for(s=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var n=e[o];n in s||(s[n]={}),s=s[n]}(t=t(o=s[e=e[e.length-1]]))!=o&&null!=t&&$jscomp.defineProperty(s,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.flat",function(e){return e||function(t){t=void 0===t?1:t;for(var s=[],o=0;o<this.length;o++){var n=this[o];Array.isArray(n)&&0<t?(n=Array.prototype.flat.call(n,t-1),s.push.apply(s,n)):s.push(n)}return s}},"es9","es5"),$jscomp.findInternal=function(e,t,s){e instanceof String&&(e=String(e));for(var o=e.length,n=0;n<o;n++){var a=e[n];if(t.call(s,a,n,e))return{i:n,v:a}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(t,s){return $jscomp.findInternal(this,t,s).v}},"es6","es3"),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){function s(m,b,w,A){for(var x=[],y=0;y<m.length;y++){var S=m[y];if(S){var _=tinycolor(S),C=.5>_.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";C+=tinycolor.equals(b,S)?" sp-thumb-active":"",S=_.toString(A.preferredFormat||"rgb");var I=u?"background-color:"+_.toRgbString():"filter:"+_.toFilter();x.push('<span title="'+S+'" data-color="'+_.toRgbString()+'" class="'+C+'"><span class="sp-thumb-inner" style="'+I+';" /></span>')}else x.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",A.noColorSelectedText)).html())}return"<div class='sp-cf "+w+"'>"+x.join("")+"</div>"}function n(m,b){function w(){if(ee.showPaletteOnly&&(ee.showPalette=!0),Lt.text(ee.showPaletteOnly?ee.togglePaletteMoreText:ee.togglePaletteLessText),ee.palette){K=ee.palette.slice(0),ne=e.isArray(K[0])?K:[K],oe={};for(var We=0;We<ne.length;We++)for(var Ke=0;Ke<ne[We].length;Ke++){var et=tinycolor(ne[We][Ke]).toRgbString();oe[et]=!0}}De.toggleClass("sp-flat",le),De.toggleClass("sp-input-disabled",!ee.showInput),De.toggleClass("sp-alpha-enabled",ee.showAlpha),De.toggleClass("sp-clear-enabled",Zt),De.toggleClass("sp-buttons-disabled",!ee.showButtons),De.toggleClass("sp-palette-buttons-disabled",!ee.togglePaletteOnly),De.toggleClass("sp-palette-disabled",!ee.showPalette),De.toggleClass("sp-palette-only",ee.showPaletteOnly),De.toggleClass("sp-initial-disabled",!ee.showInitial),De.addClass(ee.className).addClass(ee.containerClassName),q()}function A(){if(Q&&window.localStorage){try{var We=window.localStorage[Q].split(",#");1<We.length&&(delete window.localStorage[Q],e.each(We,function(Ke,et){x(et)}))}catch{}try{se=window.localStorage[Q].split(";")}catch{}}}function x(We){if(te){if(We=tinycolor(We).toRgbString(),!oe[We]&&-1===e.inArray(We,se))for(se.push(We);se.length>ve;)se.shift();if(Q&&window.localStorage)try{window.localStorage[Q]=se.join(";")}catch{}}}function S(){var We=N(),Ke=e.map(ne,function(et,St){return s(et,We,"sp-palette-row sp-palette-row-"+St,ee)});A(),se&&Ke.push(s(function y(){var We=[];if(ee.showPalette)for(var Ke=0;Ke<se.length;Ke++){var et=tinycolor(se[Ke]).toRgbString();oe[et]||We.push(se[Ke])}return We.reverse().slice(0,ee.maxSelectionSize)}(),We,"sp-palette-row sp-palette-row-selection",ee)),Qe.html(Ke.join(""))}function _(){if(ee.showInitial){var We=Nt,Ke=N();lt.html(s([We,Ke],Ke,"sp-palette-row-initial",ee))}}function C(){(0>=Se||0>=Pe||0>=ie)&&q(),he=!0,De.addClass("sp-dragging"),pe=null,we.trigger("dragstart.spectrum",[N()])}function I(){he=!1,De.removeClass("sp-dragging"),we.trigger("dragstop.spectrum",[N()])}function L(){var We=Be.val();null!==We&&""!==We||!Zt?(We=tinycolor(We)).isValid()?(H(We),J(!0)):Be.addClass("sp-validation-error"):(H(null),J(!0))}function D(){ce?R():O()}function O(){var We=e.Event("beforeShow.spectrum");if(ce)q();else if(we.trigger(We,[N()]),!1!==de.beforeShow(N())&&!We.isDefaultPrevented()){for(We=0;We<v.length;We++)v[We]&&v[We].hide();ce=!0,e(Ae).bind("keydown.spectrum",M),e(Ae).bind("click.spectrum",E),e(window).bind("resize.spectrum",xe),kt.addClass("sp-active"),De.removeClass("sp-hidden"),q(),P(),Nt=N(),_(),de.show(Nt),we.trigger("show.spectrum",[Nt])}}function M(We){27===We.keyCode&&R()}function E(We){2==We.button||he||(si?J(!0):H(Nt,!0),R())}function R(){ce&&!le&&(ce=!1,e(Ae).unbind("keydown.spectrum",M),e(Ae).unbind("click.spectrum",E),e(window).unbind("resize.spectrum",xe),kt.removeClass("sp-active"),De.addClass("sp-hidden"),de.hide(N()),we.trigger("hide.spectrum",[N()]))}function H(We,Ke){if(tinycolor.equals(We,N()))P();else{if(!We&&Zt)Rt=!0;else{Rt=!1;var et=tinycolor(We);We=et.toHsv(),$e=We.h%360/360,Ge=We.s,Ye=We.v,W=We.a}P(),et&&et.isValid()&&!Ke&&(Ft=ee.preferredFormat||et.getFormat())}}function N(We){return We=We||{},Zt&&Rt?null:tinycolor.fromRatio({h:$e,s:Ge,v:Ye,a:Math.round(100*W)/100},{format:We.format||Ft})}function B(){P(),de.move(N()),we.trigger("move.spectrum",[N()])}function P(){Be.removeClass("sp-validation-error"),z();var We=tinycolor.fromRatio({h:$e,s:1,v:1});He.css("background-color",We.toHexString()),We=Ft,!(1>W)||0===W&&"name"===We||"hex"!==We&&"hex3"!==We&&"hex6"!==We&&"name"!==We||(We="rgb");var Ke=N({format:We}),et="";if(pt.removeClass("sp-clear-display"),pt.css("background-color","transparent"),!Ke&&Zt)pt.addClass("sp-clear-display");else{et=Ke.toHexString();var St=Ke.toRgbString();if(u||1===Ke.alpha?pt.css("background-color",St):(pt.css("background-color","transparent"),pt.css("filter",Ke.toFilter())),ee.showAlpha){(St=Ke.toRgb()).a=0;var Wt="linear-gradient(left, "+(St=tinycolor(St).toRgbString())+", "+et+")";r?_e.css("filter",tinycolor(St).toFilter({gradientType:1},et)):(_e.css("background","-webkit-"+Wt),_e.css("background","-moz-"+Wt),_e.css("background","-ms-"+Wt),_e.css("background","linear-gradient(to right, "+St+", "+et+")"))}et=Ke.toString(We)}ee.showInput&&Be.val(et),ee.showPalette&&S(),_()}function z(){var We=Ge,Ke=Ye;Zt&&Rt?(ze.hide(),Te.hide(),Je.hide()):(ze.show(),Te.show(),Je.show(),We*=Pe,Ke=Se-Ke*Se,We=Math.max(-Y,Math.min(Pe-Y,We-Y)),Ke=Math.max(-Y,Math.min(Se-Y,Ke-Y)),Je.css({top:Ke+"px",left:We+"px"}),ze.css({left:W*be-ke/2+"px"}),Te.css({top:$e*ie-Ee+"px"}))}function J(We){var Ke=N(),et="",St=!tinycolor.equals(Ke,Nt);Ke&&(et=Ke.toString(Ft),x(Ke)),Tt&&we.val(et),We&&St&&(de.change(Ke),we.trigger("change",[Ke]))}function q(){ce&&(Pe=He.width(),Se=He.height(),Y=Je.height(),st.width(),ie=st.height(),Ee=Te.height(),be=Oe.width(),ke=ze.width(),le||(De.css("position","absolute"),De.offset(ee.offset?ee.offset:function a(m,b){var w=m.outerWidth(),A=m.outerHeight(),x=b.outerHeight(),y=m[0].ownerDocument,S=y.documentElement;return m=S.clientWidth+e(y).scrollLeft(),y=S.clientHeight+e(y).scrollTop(),(b=b.offset()).top+=x,b.left-=Math.min(b.left,b.left+w>m&&m>w?Math.abs(b.left+w-m):0),b.top-=Math.min(b.top,b.top+A>y&&y>A?Math.abs(A+x-0):0),b}(De,At))),z(),ee.showPalette&&S(),we.trigger("reflow.spectrum"))}function G(){R(),me=!0,we.attr("disabled",!0),At.addClass("sp-disabled")}var ee=function o(m,b){return(m=e.extend({},g,m)).callbacks={move:d(m.move,b),change:d(m.change,b),show:d(m.show,b),hide:d(m.hide,b),beforeShow:d(m.beforeShow,b)},m}(b,m),le=ee.flat,te=ee.showSelectionPalette,Q=ee.localStorageKey;b=ee.theme;var de=ee.callbacks,xe=function p(m,b,w){var A;return function(){var x=this,y=arguments,S=function(){A=null,m.apply(x,y)};w&&clearTimeout(A),(w||!A)&&(A=setTimeout(S,b))}}(q,10),ce=!1,he=!1,Pe=0,Se=0,Y=0,ie=0,be=0,ke=0,Ee=0,$e=0,Ge=0,Ye=0,W=1,K=[],ne=[],oe={},se=ee.selectionPalette.slice(0),ve=ee.maxSelectionSize,pe=null,Ae=m.ownerDocument,we=e(m),me=!1,De=e(f,Ae).addClass(b),Ne=De.find(".sp-picker-container"),He=De.find(".sp-color"),Je=De.find(".sp-dragger"),st=De.find(".sp-hue"),Te=De.find(".sp-slider"),_e=De.find(".sp-alpha-inner"),Oe=De.find(".sp-alpha"),ze=De.find(".sp-alpha-handle"),Be=De.find(".sp-input"),Qe=De.find(".sp-palette"),lt=De.find(".sp-initial"),wt=De.find(".sp-cancel"),ut=De.find(".sp-clear"),Dt=De.find(".sp-choose"),Lt=De.find(".sp-palette-toggle"),Tt=we.is("input");m=Tt&&"color"===we.attr("type")&&e.fn.spectrum.inputTypeColorSupport();var zt=Tt&&!le,kt=zt?e("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(b).addClass(ee.className).addClass(ee.replacerClassName):e([]),At=zt?kt:we,pt=kt.find(".sp-preview-inner"),ft=ee.color||Tt&&we.val(),Nt=!1,Ft=ee.preferredFormat,si=!ee.showButtons||ee.clickoutFiresChange,Rt=!ft,Zt=ee.allowEmpty&&!m;!function(){function We(et){return et.data&&et.data.ignore?(H(e(et.target).closest(".sp-thumb-el").data("color")),B()):(H(e(et.target).closest(".sp-thumb-el").data("color")),B(),J(!0),ee.hideAfterPaletteSelect&&R()),!1}if(r&&De.find("*:not(input)").attr("unselectable","on"),w(),zt&&we.after(kt).hide(),Zt||ut.hide(),le)we.after(De).hide();else{var Ke="parent"===ee.appendTo?we.parent():e(ee.appendTo);1!==Ke.length&&(Ke=e("body")),Ke.append(De)}A(),At.bind("click.spectrum touchstart.spectrum",function(et){me||D(),et.stopPropagation(),e(et.target).is("input")||et.preventDefault()}),(we.is(":disabled")||!0===ee.disabled)&&G(),De.click(c),Be.change(L),Be.bind("paste",function(){setTimeout(L,1)}),Be.keydown(function(et){13==et.keyCode&&L()}),wt.text(ee.cancelText),wt.bind("click.spectrum",function(et){et.stopPropagation(),et.preventDefault(),H(Nt,!0),R()}),ut.attr("title",ee.clearText),ut.bind("click.spectrum",function(et){et.stopPropagation(),et.preventDefault(),Rt=!0,B(),le&&J(!0)}),Dt.text(ee.chooseText),Dt.bind("click.spectrum",function(et){et.stopPropagation(),et.preventDefault(),r&&Be.is(":focus")&&Be.trigger("change"),Be.hasClass("sp-validation-error")||(J(!0),R())}),Lt.text(ee.showPaletteOnly?ee.togglePaletteMoreText:ee.togglePaletteLessText),Lt.bind("click.spectrum",function(et){et.stopPropagation(),et.preventDefault(),ee.showPaletteOnly=!ee.showPaletteOnly,ee.showPaletteOnly||le||De.css("left","-="+(Ne.outerWidth(!0)+5)),w()}),h(Oe,function(et,St,Wt){W=et/be,Rt=!1,Wt.shiftKey&&(W=Math.round(10*W)/10),B()},C,I),h(st,function(et,St){$e=parseFloat(St/ie),Rt=!1,ee.showAlpha||(W=1),B()},C,I),h(He,function(et,St,Wt){Wt.shiftKey?pe||(pe=Math.abs(et-Ge*Pe)>Math.abs(St-(Se-Ye*Se))?"x":"y"):pe=null,Wt=!pe||"y"===pe,pe&&"x"!==pe||(Ge=parseFloat(et/Pe)),Wt&&(Ye=parseFloat((Se-St)/Se)),Rt=!1,ee.showAlpha||(W=1),B()},C,I),ft?(H(ft),P(),Ft=ee.preferredFormat||tinycolor(ft).format,x(ft)):P(),le&&O(),Qe.delegate(".sp-thumb-el",Ke=r?"mousedown.spectrum":"click.spectrum touchstart.spectrum",We),lt.delegate(".sp-thumb-el:nth-child(1)",Ke,{ignore:!0},We)}();var ni={show:O,hide:R,toggle:D,reflow:q,option:function(We,Ke){return We===t?e.extend({},ee):Ke===t?ee[We]:(ee[We]=Ke,"preferredFormat"===We&&(Ft=ee.preferredFormat),void w())},enable:function(){me=!1,we.attr("disabled",!1),At.removeClass("sp-disabled")},disable:G,offset:function(We){ee.offset=We,q()},set:function(We){H(We),J()},get:N,destroy:function(){we.show(),At.unbind("click.spectrum touchstart.spectrum"),De.remove(),kt.remove(),v[ni.id]=null},container:De};return ni.id=v.push(ni)-1,ni}function l(){}function c(m){m.stopPropagation()}function d(m,b){var w=Array.prototype.slice,A=w.call(arguments,2);return function(){return m.apply(b,A.concat(w.call(arguments)))}}function h(m,b,w,A){function x(E){E.stopPropagation&&E.stopPropagation(),E.preventDefault&&E.preventDefault(),E.returnValue=!1}function y(E){if(C){if(r&&9>_.documentMode&&!E.button)return S();var R=E.originalEvent&&E.originalEvent.touches&&E.originalEvent.touches[0],H=Math.max(0,Math.min((R&&R.pageX||E.pageX)-I.left,D));R=Math.max(0,Math.min((R&&R.pageY||E.pageY)-I.top,L)),O&&x(E),b.apply(m,[H,R,E])}}function S(){C&&(e(_).unbind(M),e(_.body).removeClass("sp-dragging"),setTimeout(function(){A.apply(m,arguments)},0)),C=!1}b=b||function(){},w=w||function(){},A=A||function(){};var _=document,C=!1,I={},L=0,D=0,O="ontouchstart"in window,M={};M.selectstart=x,M.dragstart=x,M["touchmove mousemove"]=y,M["touchend mouseup"]=S,e(m).bind("touchstart mousedown",function(E){(E.which?3==E.which:2==E.button)||C||!1===w.apply(m,arguments)||(C=!0,L=e(m).height(),D=e(m).width(),I=e(m).offset(),e(_).bind(M),e(_.body).addClass("sp-dragging"),y(E),x(E))})}var m,g={beforeShow:l,move:l,change:l,show:l,hide:l,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:["#ffffff #000000 #ff0000 #ff8000 #ffff00 #008000 #0000ff #4b0082 #9400d3".split(" ")],selectionPalette:[],disabled:!1,offset:null},v=[],r=!!/msie/i.exec(window.navigator.userAgent),u=((m=document.createElement("div").style).cssText="background-color:rgba(0,0,0,.5)",!!~(""+m.backgroundColor).indexOf("rgba")||!!~(""+m.backgroundColor).indexOf("hsla")),f=function(){var m="";if(r)for(var b=1;6>=b;b++)m+="<div class='sp-"+b+"'></div>";return["<div class='sp-container sp-hidden'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div><div class='sp-palette-button-container sp-cf'><button type='button' class='sp-palette-toggle'></button></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-clear sp-clear-display'></div><div class='sp-hue'><div class='sp-slider'></div>",m,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button type='button' class='sp-choose'></button></div></div></div>"].join("")}();e.fn.spectrum=function(m,b){if("string"==typeof m){var w=this,A=Array.prototype.slice.call(arguments,1);return this.each(function(){var x=v[e(this).data("spectrum.id")];if(x){var y=x[m];if(!y)throw Error("Spectrum: no such method: '"+m+"'");"get"==m?w=x.get():"container"==m?w=x.container:"option"==m?w=x.option.apply(x,A):"destroy"==m?(x.destroy(),e(this).removeData("spectrum.id")):y.apply(x,A)}}),w}return this.spectrum("destroy").each(function(){var x=e.extend({},m,e(this).data());x=n(this,x),e(this).data("spectrum.id",x.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=h,e.fn.spectrum.defaults=g,e.fn.spectrum.inputTypeColorSupport=function m(){if(typeof m._cachedResult>"u"){var b=e("<input type='color'/>")[0];m._cachedResult="color"===b.type&&""!==b.value}return m._cachedResult},e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){var m=e("input[type=color]");m.length&&!e.fn.spectrum.inputTypeColorSupport()&&m.spectrum({preferredFormat:"hex6"})},function(){function m(Y,ie,be){Y=P(Y,255),ie=P(ie,255),be=P(be,255);var ke=de(Y,ie,be),Ee=Q(Y,ie,be),$e=(ke+Ee)/2;if(ke==Ee)var Ge=Ee=0;else{var Ye=ke-Ee;switch(Ee=.5<$e?Ye/(2-ke-Ee):Ye/(ke+Ee),ke){case Y:Ge=(ie-be)/Ye+(ie<be?6:0);break;case ie:Ge=(be-Y)/Ye+2;break;case be:Ge=(Y-ie)/Ye+4}Ge/=6}return{h:Ge,s:Ee,l:$e}}function w(Y,ie,be){Y=P(Y,255),ie=P(ie,255),be=P(be,255);var ke=de(Y,ie,be),Ee=Q(Y,ie,be),$e=ke-Ee;if(ke==Ee)var Ge=0;else{switch(ke){case Y:Ge=(ie-be)/$e+(ie<be?6:0);break;case ie:Ge=(be-Y)/$e+2;break;case be:Ge=(Y-ie)/$e+4}Ge/=6}return{h:Ge,s:0===ke?0:$e/ke,v:ke}}function A(Y,ie,be,ke){return Y=[z(te(Y).toString(16)),z(te(ie).toString(16)),z(te(be).toString(16))],ke&&Y[0].charAt(0)==Y[0].charAt(1)&&Y[1].charAt(0)==Y[1].charAt(1)&&Y[2].charAt(0)==Y[2].charAt(1)?Y[0].charAt(0)+Y[1].charAt(0)+Y[2].charAt(0):Y.join("")}function x(Y,ie,be,ke){return[z(Math.round(255*parseFloat(ke)).toString(16)),z(te(Y).toString(16)),z(te(ie).toString(16)),z(te(be).toString(16))].join("")}function y(Y,ie){return ie=0===ie?0:ie||10,(Y=ce(Y).toHsl()).s-=ie/100,Y.s=Q(1,de(0,Y.s)),ce(Y)}function S(Y,ie){return ie=0===ie?0:ie||10,(Y=ce(Y).toHsl()).s+=ie/100,Y.s=Q(1,de(0,Y.s)),ce(Y)}function _(Y){return ce(Y).desaturate(100)}function C(Y,ie){return ie=0===ie?0:ie||10,(Y=ce(Y).toHsl()).l+=ie/100,Y.l=Q(1,de(0,Y.l)),ce(Y)}function I(Y,ie){return ie=0===ie?0:ie||10,(Y=ce(Y).toRgb()).r=de(0,Q(255,Y.r-te(-ie/100*255))),Y.g=de(0,Q(255,Y.g-te(-ie/100*255))),Y.b=de(0,Q(255,Y.b-te(-ie/100*255))),ce(Y)}function L(Y,ie){return ie=0===ie?0:ie||10,(Y=ce(Y).toHsl()).l-=ie/100,Y.l=Q(1,de(0,Y.l)),ce(Y)}function D(Y,ie){return Y=ce(Y).toHsl(),ie=(te(Y.h)+ie)%360,Y.h=0>ie?360+ie:ie,ce(Y)}function O(Y){return(Y=ce(Y).toHsl()).h=(Y.h+180)%360,ce(Y)}function M(Y){var ie=ce(Y).toHsl(),be=ie.h;return[ce(Y),ce({h:(be+120)%360,s:ie.s,l:ie.l}),ce({h:(be+240)%360,s:ie.s,l:ie.l})]}function E(Y){var ie=ce(Y).toHsl(),be=ie.h;return[ce(Y),ce({h:(be+90)%360,s:ie.s,l:ie.l}),ce({h:(be+180)%360,s:ie.s,l:ie.l}),ce({h:(be+270)%360,s:ie.s,l:ie.l})]}function R(Y){var ie=ce(Y).toHsl(),be=ie.h;return[ce(Y),ce({h:(be+72)%360,s:ie.s,l:ie.l}),ce({h:(be+216)%360,s:ie.s,l:ie.l})]}function H(Y,ie,be){ie=ie||6,be=be||30;var ke=ce(Y).toHsl();for(be=360/be,Y=[ce(Y)],ke.h=(ke.h-(be*ie>>1)+720)%360;--ie;)ke.h=(ke.h+be)%360,Y.push(ce(ke));return Y}function N(Y,ie){ie=ie||6;var be=ce(Y).toHsv();Y=be.h;var ke=be.s;be=be.v;for(var Ee=[],$e=1/ie;ie--;)Ee.push(ce({h:Y,s:ke,v:be})),be=(be+$e)%1;return Ee}function B(Y){return Y=parseFloat(Y),(isNaN(Y)||0>Y||1<Y)&&(Y=1),Y}function P(Y,ie){var be=Y;return"string"==typeof be&&-1!=be.indexOf(".")&&1===parseFloat(be)&&(Y="100%"),be="string"==typeof Y&&-1!=Y.indexOf("%"),Y=Q(ie,de(0,parseFloat(Y))),be&&(Y=parseInt(Y*ie,10)/100),1e-6>le.abs(Y-ie)?1:Y%ie/parseFloat(ie)}function z(Y){return 1==Y.length?"0"+Y:""+Y}function J(Y){return 1>=Y&&(Y=100*Y+"%"),Y}var q=/^[\s,#]+/,G=/\s+$/,ee=0,le=Math,te=le.round,Q=le.min,de=le.max,xe=le.random,ce=function(Y,ie){var be,ke;if(ie=ie||{},(Y=Y||"")instanceof ce)return Y;if(!(this instanceof ce))return new ce(Y,ie);var Ee=Y,$e={r:0,g:0,b:0},Ge=1,Ye=be=!1;if("string"==typeof Ee)e:{Ee=Ee.replace(q,"").replace(G,"").toLowerCase();var W=!1;if(he[Ee])Ee=he[Ee],W=!0;else if("transparent"==Ee){Ee={r:0,g:0,b:0,a:0,format:"name"};break e}Ee=(ke=Se.rgb.exec(Ee))?{r:ke[1],g:ke[2],b:ke[3]}:(ke=Se.rgba.exec(Ee))?{r:ke[1],g:ke[2],b:ke[3],a:ke[4]}:(ke=Se.hsl.exec(Ee))?{h:ke[1],s:ke[2],l:ke[3]}:(ke=Se.hsla.exec(Ee))?{h:ke[1],s:ke[2],l:ke[3],a:ke[4]}:(ke=Se.hsv.exec(Ee))?{h:ke[1],s:ke[2],v:ke[3]}:(ke=Se.hsva.exec(Ee))?{h:ke[1],s:ke[2],v:ke[3],a:ke[4]}:(ke=Se.hex8.exec(Ee))?{a:parseInt(ke[1],16)/255,r:parseInt(ke[2],16),g:parseInt(ke[3],16),b:parseInt(ke[4],16),format:W?"name":"hex8"}:(ke=Se.hex6.exec(Ee))?{r:parseInt(ke[1],16),g:parseInt(ke[2],16),b:parseInt(ke[3],16),format:W?"name":"hex"}:!!(ke=Se.hex3.exec(Ee))&&{r:parseInt(ke[1]+""+ke[1],16),g:parseInt(ke[2]+""+ke[2],16),b:parseInt(ke[3]+""+ke[3],16),format:W?"name":"hex"}}if("object"==typeof Ee){if(Ee.hasOwnProperty("r")&&Ee.hasOwnProperty("g")&&Ee.hasOwnProperty("b"))$e=Ee.g,be=Ee.b,$e={r:255*P(Ee.r,255),g:255*P($e,255),b:255*P(be,255)},be=!0,Ye="%"===String(Ee.r).substr(-1)?"prgb":"rgb";else if(Ee.hasOwnProperty("h")&&Ee.hasOwnProperty("s")&&Ee.hasOwnProperty("v")){Ee.s=J(Ee.s),Ee.v=J(Ee.v),W=Ee.s,$e=Ee.v,Ye=6*P(Ye=Ee.h,360),W=P(W,100),$e=P($e,100);var K=Ye-(be=le.floor(Ye));$e={r:255*[$e,ke=$e*(1-K*W),Ye=$e*(1-W),Ye,W=$e*(1-(1-K)*W),$e][be%=6],g:255*[W,$e,$e,ke,Ye,Ye][be],b:255*[Ye,Ye,W,$e,$e,ke][be]},be=!0,Ye="hsv"}else Ee.hasOwnProperty("h")&&Ee.hasOwnProperty("s")&&Ee.hasOwnProperty("l")&&(Ee.s=J(Ee.s),Ee.l=J(Ee.l),$e=function b(Y,ie,be){function ke(Ge,Ye,W){return 0>W&&(W+=1),1<W&&--W,W<1/6?Ge+6*(Ye-Ge)*W:.5>W?Ye:W<2/3?Ge+(Ye-Ge)*(2/3-W)*6:Ge}if(Y=P(Y,360),ie=P(ie,100),be=P(be,100),0===ie)be=ie=Y=be;else{var Ee=.5>be?be*(1+ie):be+ie-be*ie,$e=2*be-Ee;be=ke($e,Ee,Y+1/3),ie=ke($e,Ee,Y),Y=ke($e,Ee,Y-1/3)}return{r:255*be,g:255*ie,b:255*Y}}(Ee.h,Ee.s,Ee.l),be=!0,Ye="hsl");Ee.hasOwnProperty("a")&&(Ge=Ee.a)}Ge=B(Ge),Ee=Ee.format||Ye,Ye=Q(255,de($e.r,0)),ke=Q(255,de($e.g,0)),$e=Q(255,de($e.b,0)),this._originalInput=Y,this._r=Ye,this._g=ke,this._b=$e,this._a=Ge,this._roundA=te(100*this._a)/100,this._format=ie.format||Ee,this._gradientType=ie.gradientType,1>this._r&&(this._r=te(this._r)),1>this._g&&(this._g=te(this._g)),1>this._b&&(this._b=te(this._b)),this._ok=be,this._tc_id=ee++};ce.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var Y=this.toRgb();return(299*Y.r+587*Y.g+114*Y.b)/1e3},setAlpha:function(Y){return this._a=B(Y),this._roundA=te(100*this._a)/100,this},toHsv:function(){var Y=w(this._r,this._g,this._b);return{h:360*Y.h,s:Y.s,v:Y.v,a:this._a}},toHsvString:function(){var Y=w(this._r,this._g,this._b),ie=te(360*Y.h),be=te(100*Y.s);return Y=te(100*Y.v),1==this._a?"hsv("+ie+", "+be+"%, "+Y+"%)":"hsva("+ie+", "+be+"%, "+Y+"%, "+this._roundA+")"},toHsl:function(){var Y=m(this._r,this._g,this._b);return{h:360*Y.h,s:Y.s,l:Y.l,a:this._a}},toHslString:function(){var Y=m(this._r,this._g,this._b),ie=te(360*Y.h),be=te(100*Y.s);return Y=te(100*Y.l),1==this._a?"hsl("+ie+", "+be+"%, "+Y+"%)":"hsla("+ie+", "+be+"%, "+Y+"%, "+this._roundA+")"},toHex:function(Y){return A(this._r,this._g,this._b,Y)},toHexString:function(Y){return"#"+this.toHex(Y)},toHex8:function(){return x(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:te(this._r),g:te(this._g),b:te(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+te(this._r)+", "+te(this._g)+", "+te(this._b)+")":"rgba("+te(this._r)+", "+te(this._g)+", "+te(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:te(100*P(this._r,255))+"%",g:te(100*P(this._g,255))+"%",b:te(100*P(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+te(100*P(this._r,255))+"%, "+te(100*P(this._g,255))+"%, "+te(100*P(this._b,255))+"%)":"rgba("+te(100*P(this._r,255))+"%, "+te(100*P(this._g,255))+"%, "+te(100*P(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(1>this._a)&&(Pe[A(this._r,this._g,this._b,!0)]||!1)},toFilter:function(Y){var ie="#"+x(this._r,this._g,this._b,this._a),be=ie,ke=this._gradientType?"GradientType = 1, ":"";return Y&&(be=ce(Y).toHex8String()),"progid:DXImageTransform.Microsoft.gradient("+ke+"startColorstr="+ie+",endColorstr="+be+")"},toString:function(Y){var ie=!!Y;Y=Y||this._format;var be=!1;return ie||!(1>this._a&&0<=this._a)||"hex"!==Y&&"hex6"!==Y&&"hex3"!==Y&&"name"!==Y?("rgb"===Y&&(be=this.toRgbString()),"prgb"===Y&&(be=this.toPercentageRgbString()),("hex"===Y||"hex6"===Y)&&(be=this.toHexString()),"hex3"===Y&&(be=this.toHexString(!0)),"hex8"===Y&&(be=this.toHex8String()),"name"===Y&&(be=this.toName()),"hsl"===Y&&(be=this.toHslString()),"hsv"===Y&&(be=this.toHsvString()),be||this.toHexString()):"name"===Y&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(Y,ie){return Y=Y.apply(null,[this].concat([].slice.call(ie))),this._r=Y._r,this._g=Y._g,this._b=Y._b,this.setAlpha(Y._a),this},lighten:function(){return this._applyModification(C,arguments)},brighten:function(){return this._applyModification(I,arguments)},darken:function(){return this._applyModification(L,arguments)},desaturate:function(){return this._applyModification(y,arguments)},saturate:function(){return this._applyModification(S,arguments)},greyscale:function(){return this._applyModification(_,arguments)},spin:function(){return this._applyModification(D,arguments)},_applyCombination:function(Y,ie){return Y.apply(null,[this].concat([].slice.call(ie)))},analogous:function(){return this._applyCombination(H,arguments)},complement:function(){return this._applyCombination(O,arguments)},monochromatic:function(){return this._applyCombination(N,arguments)},splitcomplement:function(){return this._applyCombination(R,arguments)},triad:function(){return this._applyCombination(M,arguments)},tetrad:function(){return this._applyCombination(E,arguments)}},ce.fromRatio=function(Y,ie){if("object"==typeof Y){var ke,be={};for(ke in Y)Y.hasOwnProperty(ke)&&(be[ke]="a"===ke?Y[ke]:J(Y[ke]));Y=be}return ce(Y,ie)},ce.equals=function(Y,ie){return!(!Y||!ie)&&ce(Y).toRgbString()==ce(ie).toRgbString()},ce.random=function(){return ce.fromRatio({r:xe(),g:xe(),b:xe()})},ce.mix=function(Y,ie,be){be=0===be?0:be||50,Y=ce(Y).toRgb();var ke=2*(be/=100)-1,Ee=(ie=ce(ie).toRgb()).a-Y.a;return ce({r:ie.r*(ke=((ke*Ee==-1?ke:(ke+Ee)/(1+ke*Ee))+1)/2)+Y.r*(Ee=1-ke),g:ie.g*ke+Y.g*Ee,b:ie.b*ke+Y.b*Ee,a:ie.a*be+Y.a*(1-be)})},ce.readability=function(Y,ie){var be=ce(Y),ke=ce(ie);return ie=be.toRgb(),Y=ke.toRgb(),be=be.getBrightness(),ke=ke.getBrightness(),{brightness:Math.abs(be-ke),color:Math.max(ie.r,Y.r)-Math.min(ie.r,Y.r)+Math.max(ie.g,Y.g)-Math.min(ie.g,Y.g)+Math.max(ie.b,Y.b)-Math.min(ie.b,Y.b)}},ce.isReadable=function(Y,ie){return 125<(Y=ce.readability(Y,ie)).brightness&&500<Y.color},ce.mostReadable=function(Y,ie){for(var be=null,ke=0,Ee=!1,$e=0;$e<ie.length;$e++){var Ge=ce.readability(Y,ie[$e]),Ye=125<Ge.brightness&&500<Ge.color;Ge=Ge.brightness/125*3+Ge.color/500,(Ye&&!Ee||Ye&&Ee&&Ge>ke||!Ye&&!Ee&&Ge>ke)&&(Ee=Ye,ke=Ge,be=ce(ie[$e]))}return be};var he=ce.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Pe=ce.hexNames=function(Y){var be,ie={};for(be in Y)Y.hasOwnProperty(be)&&(ie[Y[be]]=be);return ie}(he),Se={rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsva:/hsva[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};window.tinycolor=ce}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})}),function(e){function t(P,z){var J,q;if(z=z||{},(P=P||"")instanceof t)return P;if(!(this instanceof t))return new t(P,z);var G=P,ee={r:0,g:0,b:0},le=1,te=J=!1;if("string"==typeof G)e:{G=G.replace(I,"").replace(L,"").toLowerCase();var Q=!1;if(H[G])G=H[G],Q=!0;else if("transparent"==G){G={r:0,g:0,b:0,a:0,format:"name"};break e}G=(q=B.rgb.exec(G))?{r:q[1],g:q[2],b:q[3]}:(q=B.rgba.exec(G))?{r:q[1],g:q[2],b:q[3],a:q[4]}:(q=B.hsl.exec(G))?{h:q[1],s:q[2],l:q[3]}:(q=B.hsla.exec(G))?{h:q[1],s:q[2],l:q[3],a:q[4]}:(q=B.hsv.exec(G))?{h:q[1],s:q[2],v:q[3]}:(q=B.hsva.exec(G))?{h:q[1],s:q[2],v:q[3],a:q[4]}:(q=B.hex8.exec(G))?{r:parseInt(q[1],16),g:parseInt(q[2],16),b:parseInt(q[3],16),a:parseInt(q[4],16)/255,format:Q?"name":"hex8"}:(q=B.hex6.exec(G))?{r:parseInt(q[1],16),g:parseInt(q[2],16),b:parseInt(q[3],16),format:Q?"name":"hex"}:(q=B.hex4.exec(G))?{r:parseInt(q[1]+""+q[1],16),g:parseInt(q[2]+""+q[2],16),b:parseInt(q[3]+""+q[3],16),a:parseInt(q[4]+""+q[4],16)/255,format:Q?"name":"hex8"}:!!(q=B.hex3.exec(G))&&{r:parseInt(q[1]+""+q[1],16),g:parseInt(q[2]+""+q[2],16),b:parseInt(q[3]+""+q[3],16),format:Q?"name":"hex"}}if("object"==typeof G){if(C(G.r)&&C(G.g)&&C(G.b))ee=G.g,J=G.b,ee={r:255*y(G.r,255),g:255*y(ee,255),b:255*y(J,255)},J=!0,te="%"===String(G.r).substr(-1)?"prgb":"rgb";else if(C(G.h)&&C(G.s)&&C(G.v)){J=ee=_(G.s),ee=te=_(G.v),q=6*y(q=G.h,360),J=y(J,100),ee=y(ee,100);var de=q-(te=e.floor(q));ee={r:255*[ee,Q=ee*(1-de*J),q=ee*(1-J),q,J=ee*(1-(1-de)*J),ee][te%=6],g:255*[J,ee,ee,Q,q,q][te],b:255*[q,q,J,ee,ee,Q][te]},J=!0,te="hsv"}else C(G.h)&&C(G.s)&&C(G.l)&&(ee=_(G.s),J=_(G.l),ee=function o(P,z,J){function q(le,te,Q){return 0>Q&&(Q+=1),1<Q&&--Q,Q<1/6?le+6*(te-le)*Q:.5>Q?te:Q<2/3?le+(te-le)*(2/3-Q)*6:le}if(P=y(P,360),z=y(z,100),J=y(J,100),0===z)J=z=P=J;else{var G=.5>J?J*(1+z):J+z-J*z,ee=2*J-G;J=q(ee,G,P+1/3),z=q(ee,G,P),P=q(ee,G,P-1/3)}return{r:255*J,g:255*z,b:255*P}}(G.h,ee,J),J=!0,te="hsl");G.hasOwnProperty("a")&&(le=G.a)}le=x(le),G=G.format||te,te=M(255,E(ee.r,0)),q=M(255,E(ee.g,0)),ee=M(255,E(ee.b,0)),this._originalInput=P,this._r=te,this._g=q,this._b=ee,this._a=le,this._roundA=O(100*this._a)/100,this._format=z.format||G,this._gradientType=z.gradientType,1>this._r&&(this._r=O(this._r)),1>this._g&&(this._g=O(this._g)),1>this._b&&(this._b=O(this._b)),this._ok=J,this._tc_id=D++}function s(P,z,J){P=y(P,255),z=y(z,255),J=y(J,255);var q=E(P,z,J),G=M(P,z,J),ee=(q+G)/2;if(q==G)var le=G=0;else{var te=q-G;switch(G=.5<ee?te/(2-q-G):te/(q+G),q){case P:le=(z-J)/te+(z<J?6:0);break;case z:le=(J-P)/te+2;break;case J:le=(P-z)/te+4}le/=6}return{h:le,s:G,l:ee}}function n(P,z,J){P=y(P,255),z=y(z,255),J=y(J,255);var q=E(P,z,J),G=M(P,z,J),ee=q-G;if(q==G)var le=0;else{switch(q){case P:le=(z-J)/ee+(z<J?6:0);break;case z:le=(J-P)/ee+2;break;case J:le=(P-z)/ee+4}le/=6}return{h:le,s:0===q?0:ee/q,v:q}}function a(P,z,J,q){return P=[S(O(P).toString(16)),S(O(z).toString(16)),S(O(J).toString(16))],q&&P[0].charAt(0)==P[0].charAt(1)&&P[1].charAt(0)==P[1].charAt(1)&&P[2].charAt(0)==P[2].charAt(1)?P[0].charAt(0)+P[1].charAt(0)+P[2].charAt(0):P.join("")}function l(P,z,J,q){return[S(e.round(255*parseFloat(q)).toString(16)),S(O(P).toString(16)),S(O(z).toString(16)),S(O(J).toString(16))].join("")}function c(P,z){return z=0===z?0:z||10,(P=t(P).toHsl()).s-=z/100,P.s=M(1,E(0,P.s)),t(P)}function d(P,z){return z=0===z?0:z||10,(P=t(P).toHsl()).s+=z/100,P.s=M(1,E(0,P.s)),t(P)}function h(P){return t(P).desaturate(100)}function p(P,z){return z=0===z?0:z||10,(P=t(P).toHsl()).l+=z/100,P.l=M(1,E(0,P.l)),t(P)}function g(P,z){return z=0===z?0:z||10,(P=t(P).toRgb()).r=E(0,M(255,P.r-O(-z/100*255))),P.g=E(0,M(255,P.g-O(-z/100*255))),P.b=E(0,M(255,P.b-O(-z/100*255))),t(P)}function v(P,z){return z=0===z?0:z||10,(P=t(P).toHsl()).l-=z/100,P.l=M(1,E(0,P.l)),t(P)}function r(P,z){return(P=t(P).toHsl()).h=0>(z=(P.h+z)%360)?360+z:z,t(P)}function u(P){return(P=t(P).toHsl()).h=(P.h+180)%360,t(P)}function f(P){var z=t(P).toHsl(),J=z.h;return[t(P),t({h:(J+120)%360,s:z.s,l:z.l}),t({h:(J+240)%360,s:z.s,l:z.l})]}function m(P){var z=t(P).toHsl(),J=z.h;return[t(P),t({h:(J+90)%360,s:z.s,l:z.l}),t({h:(J+180)%360,s:z.s,l:z.l}),t({h:(J+270)%360,s:z.s,l:z.l})]}function b(P){var z=t(P).toHsl(),J=z.h;return[t(P),t({h:(J+72)%360,s:z.s,l:z.l}),t({h:(J+216)%360,s:z.s,l:z.l})]}function w(P,z,J){z=z||6,J=J||30;var q=t(P).toHsl();for(J=360/J,P=[t(P)],q.h=(q.h-(J*z>>1)+720)%360;--z;)q.h=(q.h+J)%360,P.push(t(q));return P}function A(P,z){z=z||6;var J=t(P).toHsv();P=J.h;var q=J.s;J=J.v;for(var G=[],ee=1/z;z--;)G.push(t({h:P,s:q,v:J})),J=(J+ee)%1;return G}function x(P){return P=parseFloat(P),(isNaN(P)||0>P||1<P)&&(P=1),P}function y(P,z){var J=P;return"string"==typeof J&&-1!=J.indexOf(".")&&1===parseFloat(J)&&(P="100%"),J="string"==typeof P&&-1!=P.indexOf("%"),P=M(z,E(0,parseFloat(P))),J&&(P=parseInt(P*z,10)/100),1e-6>e.abs(P-z)?1:P%z/parseFloat(z)}function S(P){return 1==P.length?"0"+P:""+P}function _(P){return 1>=P&&(P=100*P+"%"),P}function C(P){return!!B.CSS_UNIT.exec(P)}var I=/^\s+/,L=/\s+$/,D=0,O=e.round,M=e.min,E=e.max,R=e.random;t.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var P=this.toRgb();return(299*P.r+587*P.g+114*P.b)/1e3},getLuminance:function(){var P=this.toRgb(),z=P.r/255,J=P.g/255;return P=P.b/255,.2126*(z=.03928>=z?z/12.92:e.pow((z+.055)/1.055,2.4))+.7152*(J=.03928>=J?J/12.92:e.pow((J+.055)/1.055,2.4))+.0722*(.03928>=P?P/12.92:e.pow((P+.055)/1.055,2.4))},setAlpha:function(P){return this._a=x(P),this._roundA=O(100*this._a)/100,this},toHsv:function(){var P=n(this._r,this._g,this._b);return{h:360*P.h,s:P.s,v:P.v,a:this._a}},toHsvString:function(){var P=n(this._r,this._g,this._b),z=O(360*P.h),J=O(100*P.s);return P=O(100*P.v),1==this._a?"hsv("+z+", "+J+"%, "+P+"%)":"hsva("+z+", "+J+"%, "+P+"%, "+this._roundA+")"},toHsl:function(){var P=s(this._r,this._g,this._b);return{h:360*P.h,s:P.s,l:P.l,a:this._a}},toHslString:function(){var P=s(this._r,this._g,this._b),z=O(360*P.h),J=O(100*P.s);return P=O(100*P.l),1==this._a?"hsl("+z+", "+J+"%, "+P+"%)":"hsla("+z+", "+J+"%, "+P+"%, "+this._roundA+")"},toHex:function(P){return a(this._r,this._g,this._b,P)},toHexString:function(P){return"#"+this.toHex(P)},toHex8:function(P){var z=this._g,J=this._b,q=this._a;return z=[S(O(this._r).toString(16)),S(O(z).toString(16)),S(O(J).toString(16)),S(e.round(255*parseFloat(q)).toString(16))],P&&z[0].charAt(0)==z[0].charAt(1)&&z[1].charAt(0)==z[1].charAt(1)&&z[2].charAt(0)==z[2].charAt(1)&&z[3].charAt(0)==z[3].charAt(1)?z[0].charAt(0)+z[1].charAt(0)+z[2].charAt(0)+z[3].charAt(0):z.join("")},toHex8String:function(P){return"#"+this.toHex8(P)},toRgb:function(){return{r:O(this._r),g:O(this._g),b:O(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+O(this._r)+", "+O(this._g)+", "+O(this._b)+")":"rgba("+O(this._r)+", "+O(this._g)+", "+O(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:O(100*y(this._r,255))+"%",g:O(100*y(this._g,255))+"%",b:O(100*y(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+O(100*y(this._r,255))+"%, "+O(100*y(this._g,255))+"%, "+O(100*y(this._b,255))+"%)":"rgba("+O(100*y(this._r,255))+"%, "+O(100*y(this._g,255))+"%, "+O(100*y(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(1>this._a)&&(N[a(this._r,this._g,this._b,!0)]||!1)},toFilter:function(P){var z="#"+l(this._r,this._g,this._b,this._a),J=z,q=this._gradientType?"GradientType = 1, ":"";return P&&(J="#"+l((P=t(P))._r,P._g,P._b,P._a)),"progid:DXImageTransform.Microsoft.gradient("+q+"startColorstr="+z+",endColorstr="+J+")"},toString:function(P){var z=!!P;P=P||this._format;var J=!1;return z||!(1>this._a&&0<=this._a)||"hex"!==P&&"hex6"!==P&&"hex3"!==P&&"hex4"!==P&&"hex8"!==P&&"name"!==P?("rgb"===P&&(J=this.toRgbString()),"prgb"===P&&(J=this.toPercentageRgbString()),("hex"===P||"hex6"===P)&&(J=this.toHexString()),"hex3"===P&&(J=this.toHexString(!0)),"hex4"===P&&(J=this.toHex8String(!0)),"hex8"===P&&(J=this.toHex8String()),"name"===P&&(J=this.toName()),"hsl"===P&&(J=this.toHslString()),"hsv"===P&&(J=this.toHsvString()),J||this.toHexString()):"name"===P&&0===this._a?this.toName():this.toRgbString()},clone:function(){return t(this.toString())},_applyModification:function(P,z){return P=P.apply(null,[this].concat([].slice.call(z))),this._r=P._r,this._g=P._g,this._b=P._b,this.setAlpha(P._a),this},lighten:function(){return this._applyModification(p,arguments)},brighten:function(){return this._applyModification(g,arguments)},darken:function(){return this._applyModification(v,arguments)},desaturate:function(){return this._applyModification(c,arguments)},saturate:function(){return this._applyModification(d,arguments)},greyscale:function(){return this._applyModification(h,arguments)},spin:function(){return this._applyModification(r,arguments)},_applyCombination:function(P,z){return P.apply(null,[this].concat([].slice.call(z)))},analogous:function(){return this._applyCombination(w,arguments)},complement:function(){return this._applyCombination(u,arguments)},monochromatic:function(){return this._applyCombination(A,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(f,arguments)},tetrad:function(){return this._applyCombination(m,arguments)}},t.fromRatio=function(P,z){if("object"==typeof P){var q,J={};for(q in P)P.hasOwnProperty(q)&&(J[q]="a"===q?P[q]:_(P[q]));P=J}return t(P,z)},t.equals=function(P,z){return!(!P||!z)&&t(P).toRgbString()==t(z).toRgbString()},t.random=function(){return t.fromRatio({r:R(),g:R(),b:R()})},t.mix=function(P,z,J){return J=0===J?0:J||50,P=t(P).toRgb(),z=t(z).toRgb(),t({r:(z.r-P.r)*(J/=100)+P.r,g:(z.g-P.g)*J+P.g,b:(z.b-P.b)*J+P.b,a:(z.a-P.a)*J+P.a})},t.readability=function(P,z){return P=t(P),z=t(z),(e.max(P.getLuminance(),z.getLuminance())+.05)/(e.min(P.getLuminance(),z.getLuminance())+.05)},t.isReadable=function(P,z,J){P=t.readability(P,z),z=!1;var q=J||{level:"AA",size:"small"};switch("AA"!==(J=(q.level||"AA").toUpperCase())&&"AAA"!==J&&(J="AA"),"small"!==(q=(q.size||"small").toLowerCase())&&"large"!==q&&(q="small"),J+q){case"AAsmall":case"AAAlarge":z=4.5<=P;break;case"AAlarge":z=3<=P;break;case"AAAsmall":z=7<=P}return z},t.mostReadable=function(P,z,J){for(var q=null,G=0,ee=(J=J||{}).includeFallbackColors,le=J.level,te=J.size,Q=0;Q<z.length;Q++){var de=t.readability(P,z[Q]);de>G&&(G=de,q=t(z[Q]))}return t.isReadable(P,q,{level:le,size:te})||!ee?q:(J.includeFallbackColors=!1,t.mostReadable(P,["#fff","#000"],J))};var H=t.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},N=t.hexNames=function(P){var J,z={};for(J in P)P.hasOwnProperty(J)&&(z[P[J]]=J);return z}(H),B={CSS_UNIT:/(?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?)/,rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsva:/hsva[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};typeof module<"u"&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.tinycolor=t}(Math),function(e,t){"object"==typeof exports&&typeof module<"u"?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.Mark=t(e.jQuery)}(this,function(e){"use strict";class t{constructor(a,l=!0,c=[],d=5e3){this.ctx=a,this.iframes=l,this.exclude=c,this.iframesTimeout=d}static matches(a,l){const d=a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector;if(d){let h=!1;return("string"==typeof l?[l]:l).every(p=>!d.call(a,p)||(h=!0,!1)),h}return!1}getContexts(){let a,l=[];return(a=void 0!==this.ctx&&this.ctx?NodeList.prototype.isPrototypeOf(this.ctx)?Array.prototype.slice.call(this.ctx):Array.isArray(this.ctx)?this.ctx:"string"==typeof this.ctx?Array.prototype.slice.call(document.querySelectorAll(this.ctx)):[this.ctx]:[]).forEach(c=>{const d=l.filter(h=>h.contains(c)).length>0;-1!==l.indexOf(c)||d||l.push(c)}),l}getIframeContents(a,l,c=(()=>{})){let d;try{const h=a.contentWindow;if(d=h.document,!h||!d)throw new Error("iframe inaccessible")}catch{c()}d&&l(d)}isIframeBlank(a){const l="about:blank",c=a.getAttribute("src").trim();return a.contentWindow.location.href===l&&c!==l&&c}observeIframeLoad(a,l,c){let d=!1,h=null;const p=()=>{if(!d){d=!0,clearTimeout(h);try{this.isIframeBlank(a)||(a.removeEventListener("load",p),this.getIframeContents(a,l,c))}catch{c()}}};a.addEventListener("load",p),h=setTimeout(p,this.iframesTimeout)}onIframeReady(a,l,c){try{"complete"===a.contentWindow.document.readyState?this.isIframeBlank(a)?this.observeIframeLoad(a,l,c):this.getIframeContents(a,l,c):this.observeIframeLoad(a,l,c)}catch{c()}}waitForIframes(a,l){let c=0;this.forEachIframe(a,()=>!0,d=>{c++,this.waitForIframes(d.querySelector("html"),()=>{--c||l()})},d=>{d||l()})}forEachIframe(a,l,c,d=(()=>{})){let h=a.querySelectorAll("iframe"),p=h.length,g=0;h=Array.prototype.slice.call(h);const v=()=>{--p<=0&&d(g)};p||v(),h.forEach(r=>{t.matches(r,this.exclude)?v():this.onIframeReady(r,u=>{l(r)&&(g++,c(u)),v()},v)})}createIterator(a,l,c){return document.createNodeIterator(a,l,c,!1)}createInstanceOnIframe(a){return new t(a.querySelector("html"),this.iframes)}compareNodeIframe(a,l,c){return!!(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_PRECEDING&&(null===l||l.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING))}getIteratorNode(a){const l=a.previousNode();let c;return{prevNode:l,node:c=(null===l||a.nextNode())&&a.nextNode()}}checkIframeFilter(a,l,c,d){let h=!1,p=!1;return d.forEach((g,v)=>{g.val===c&&(h=v,p=g.handled)}),this.compareNodeIframe(a,l,c)?(!1!==h||p?!1===h||p||(d[h].handled=!0):d.push({val:c,handled:!0}),!0):(!1===h&&d.push({val:c,handled:!1}),!1)}handleOpenIframes(a,l,c,d){a.forEach(h=>{h.handled||this.getIframeContents(h.val,p=>{this.createInstanceOnIframe(p).forEachNode(l,c,d)})})}iterateThroughNodes(a,l,c,d,h){const p=this.createIterator(l,a,d);let g,v,r=[],u=[],f=()=>(({prevNode:v,node:g}=this.getIteratorNode(p)),g);for(;f();)this.iframes&&this.forEachIframe(l,m=>this.checkIframeFilter(g,v,m,r),m=>{this.createInstanceOnIframe(m).forEachNode(a,b=>u.push(b),d)}),u.push(g);u.forEach(m=>{c(m)}),this.iframes&&this.handleOpenIframes(r,a,c,d),h()}forEachNode(a,l,c,d=(()=>{})){const h=this.getContexts();let p=h.length;p||d(),h.forEach(g=>{const v=()=>{this.iterateThroughNodes(a,g,l,c,()=>{--p<=0&&d()})};this.iframes?this.waitForIframes(g,v):v()})}}class s{constructor(a){this.opt=Object.assign({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},a)}create(a){return"disabled"!==this.opt.wildcards&&(a=this.setupWildcardsRegExp(a)),a=this.escapeStr(a),Object.keys(this.opt.synonyms).length&&(a=this.createSynonymsRegExp(a)),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(a=this.setupIgnoreJoinersRegExp(a)),this.opt.diacritics&&(a=this.createDiacriticsRegExp(a)),a=this.createMergedBlanksRegExp(a),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(a=this.createJoinersRegExp(a)),"disabled"!==this.opt.wildcards&&(a=this.createWildcardsRegExp(a)),a=this.createAccuracyRegExp(a),new RegExp(a,"gm"+(this.opt.caseSensitive?"":"i"))}sortByLength(a){return a.sort((l,c)=>l.length===c.length?l>c?1:-1:c.length-l.length)}escapeStr(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}createSynonymsRegExp(a){const l=this.opt.synonyms,c=this.opt.caseSensitive?"":"i",d=this.opt.ignoreJoiners||this.opt.ignorePunctuation.length?"\0":"";for(let h in l)if(l.hasOwnProperty(h)){let p=Array.isArray(l[h])?l[h]:[l[h]];p.unshift(h),(p=this.sortByLength(p).map(g=>("disabled"!==this.opt.wildcards&&(g=this.setupWildcardsRegExp(g)),this.escapeStr(g))).filter(g=>""!==g)).length>1&&(a=a.replace(new RegExp(`(${p.map(g=>this.escapeStr(g)).join("|")})`,`gm${c}`),d+`(${p.map(g=>this.processSynonyms(g)).join("|")})`+d))}return a}processSynonyms(a){return(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(a=this.setupIgnoreJoinersRegExp(a)),a}setupWildcardsRegExp(a){return(a=a.replace(/(?:\\)*\?/g,l=>"\\"===l.charAt(0)?"?":"\x01")).replace(/(?:\\)*\*/g,l=>"\\"===l.charAt(0)?"*":"\x02")}createWildcardsRegExp(a){let l="withSpaces"===this.opt.wildcards;return a.replace(/\u0001/g,l?"[\\S\\s]?":"\\S?").replace(/\u0002/g,l?"[\\S\\s]*?":"\\S*")}setupIgnoreJoinersRegExp(a){return a.replace(/[^(|)\\]/g,(l,c,d)=>{let h=d.charAt(c+1);return/[(|)\\]/.test(h)||""===h?l:l+"\0"})}createJoinersRegExp(a){let l=[];const c=this.opt.ignorePunctuation;return Array.isArray(c)&&c.length&&l.push(this.escapeStr(c.join(""))),this.opt.ignoreJoiners&&l.push("\\u00ad\\u200b\\u200c\\u200d"),l.length?a.split(/\u0000+/).join(`[${l.join("")}]*`):a}createDiacriticsRegExp(a){const l=this.opt.caseSensitive?"":"i",c=this.opt.caseSensitive?["a\xe0\xe1\u1ea3\xe3\u1ea1\u0103\u1eb1\u1eaf\u1eb3\u1eb5\u1eb7\xe2\u1ea7\u1ea5\u1ea9\u1eab\u1ead\xe4\xe5\u0101\u0105","A\xc0\xc1\u1ea2\xc3\u1ea0\u0102\u1eb0\u1eae\u1eb2\u1eb4\u1eb6\xc2\u1ea6\u1ea4\u1ea8\u1eaa\u1eac\xc4\xc5\u0100\u0104","c\xe7\u0107\u010d","C\xc7\u0106\u010c","d\u0111\u010f","D\u0110\u010e","e\xe8\xe9\u1ebb\u1ebd\u1eb9\xea\u1ec1\u1ebf\u1ec3\u1ec5\u1ec7\xeb\u011b\u0113\u0119","E\xc8\xc9\u1eba\u1ebc\u1eb8\xca\u1ec0\u1ebe\u1ec2\u1ec4\u1ec6\xcb\u011a\u0112\u0118","i\xec\xed\u1ec9\u0129\u1ecb\xee\xef\u012b","I\xcc\xcd\u1ec8\u0128\u1eca\xce\xcf\u012a","l\u0142","L\u0141","n\xf1\u0148\u0144","N\xd1\u0147\u0143","o\xf2\xf3\u1ecf\xf5\u1ecd\xf4\u1ed3\u1ed1\u1ed5\u1ed7\u1ed9\u01a1\u1edf\u1ee1\u1edb\u1edd\u1ee3\xf6\xf8\u014d","O\xd2\xd3\u1ece\xd5\u1ecc\xd4\u1ed2\u1ed0\u1ed4\u1ed6\u1ed8\u01a0\u1ede\u1ee0\u1eda\u1edc\u1ee2\xd6\xd8\u014c","r\u0159","R\u0158","s\u0161\u015b\u0219\u015f","S\u0160\u015a\u0218\u015e","t\u0165\u021b\u0163","T\u0164\u021a\u0162","u\xf9\xfa\u1ee7\u0169\u1ee5\u01b0\u1eeb\u1ee9\u1eed\u1eef\u1ef1\xfb\xfc\u016f\u016b","U\xd9\xda\u1ee6\u0168\u1ee4\u01af\u1eea\u1ee8\u1eec\u1eee\u1ef0\xdb\xdc\u016e\u016a","y\xfd\u1ef3\u1ef7\u1ef9\u1ef5\xff","Y\xdd\u1ef2\u1ef6\u1ef8\u1ef4\u0178","z\u017e\u017c\u017a","Z\u017d\u017b\u0179"]:["a\xe0\xe1\u1ea3\xe3\u1ea1\u0103\u1eb1\u1eaf\u1eb3\u1eb5\u1eb7\xe2\u1ea7\u1ea5\u1ea9\u1eab\u1ead\xe4\xe5\u0101\u0105A\xc0\xc1\u1ea2\xc3\u1ea0\u0102\u1eb0\u1eae\u1eb2\u1eb4\u1eb6\xc2\u1ea6\u1ea4\u1ea8\u1eaa\u1eac\xc4\xc5\u0100\u0104","c\xe7\u0107\u010dC\xc7\u0106\u010c","d\u0111\u010fD\u0110\u010e","e\xe8\xe9\u1ebb\u1ebd\u1eb9\xea\u1ec1\u1ebf\u1ec3\u1ec5\u1ec7\xeb\u011b\u0113\u0119E\xc8\xc9\u1eba\u1ebc\u1eb8\xca\u1ec0\u1ebe\u1ec2\u1ec4\u1ec6\xcb\u011a\u0112\u0118","i\xec\xed\u1ec9\u0129\u1ecb\xee\xef\u012bI\xcc\xcd\u1ec8\u0128\u1eca\xce\xcf\u012a","l\u0142L\u0141","n\xf1\u0148\u0144N\xd1\u0147\u0143","o\xf2\xf3\u1ecf\xf5\u1ecd\xf4\u1ed3\u1ed1\u1ed5\u1ed7\u1ed9\u01a1\u1edf\u1ee1\u1edb\u1edd\u1ee3\xf6\xf8\u014dO\xd2\xd3\u1ece\xd5\u1ecc\xd4\u1ed2\u1ed0\u1ed4\u1ed6\u1ed8\u01a0\u1ede\u1ee0\u1eda\u1edc\u1ee2\xd6\xd8\u014c","r\u0159R\u0158","s\u0161\u015b\u0219\u015fS\u0160\u015a\u0218\u015e","t\u0165\u021b\u0163T\u0164\u021a\u0162","u\xf9\xfa\u1ee7\u0169\u1ee5\u01b0\u1eeb\u1ee9\u1eed\u1eef\u1ef1\xfb\xfc\u016f\u016bU\xd9\xda\u1ee6\u0168\u1ee4\u01af\u1eea\u1ee8\u1eec\u1eee\u1ef0\xdb\xdc\u016e\u016a","y\xfd\u1ef3\u1ef7\u1ef9\u1ef5\xffY\xdd\u1ef2\u1ef6\u1ef8\u1ef4\u0178","z\u017e\u017c\u017aZ\u017d\u017b\u0179"];let d=[];return a.split("").forEach(h=>{c.every(p=>{if(-1!==p.indexOf(h)){if(d.indexOf(p)>-1)return!1;a=a.replace(new RegExp(`[${p}]`,`gm${l}`),`[${p}]`),d.push(p)}return!0})}),a}createMergedBlanksRegExp(a){return a.replace(/[\s]+/gim,"[\\s]+")}createAccuracyRegExp(a){let l=this.opt.accuracy,c="string"==typeof l?l:l.value,h="";switch(("string"==typeof l?[]:l.limiters).forEach(p=>{h+=`|${this.escapeStr(p)}`}),c){case"partially":default:return`()(${a})`;case"complementary":return`()([^${h="\\s"+(h||this.escapeStr("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~\xa1\xbf"))}]*${a}[^${h}]*)`;case"exactly":return`(^|\\s${h})(${a})(?=$|\\s${h})`}}}class o{constructor(a){this.ctx=a,this.ie=!1;const l=window.navigator.userAgent;(l.indexOf("MSIE")>-1||l.indexOf("Trident")>-1)&&(this.ie=!0)}set opt(a){this._opt=Object.assign({},{element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,ignoreGroups:0,each:()=>{},noMatch:()=>{},filter:()=>!0,done:()=>{},debug:!1,log:window.console},a)}get opt(){return this._opt}get iterator(){return new t(this.ctx,this.opt.iframes,this.opt.exclude,this.opt.iframesTimeout)}log(a,l="debug"){const c=this.opt.log;this.opt.debug&&"object"==typeof c&&"function"==typeof c[l]&&c[l](`mark.js: ${a}`)}getSeparatedKeywords(a){let l=[];return a.forEach(c=>{this.opt.separateWordSearch?c.split(" ").forEach(d=>{d.trim()&&-1===l.indexOf(d)&&l.push(d)}):c.trim()&&-1===l.indexOf(c)&&l.push(c)}),{keywords:l.sort((c,d)=>d.length-c.length),length:l.length}}isNumeric(a){return Number(parseFloat(a))==a}checkRanges(a){if(!Array.isArray(a)||"[object Object]"!==Object.prototype.toString.call(a[0]))return this.log("markRanges() will only accept an array of objects"),this.opt.noMatch(a),[];const l=[];let c=0;return a.sort((d,h)=>d.start-h.start).forEach(d=>{let{start:h,end:p,valid:g}=this.callNoMatchOnInvalidRanges(d,c);g&&(d.start=h,d.length=p-h,l.push(d),c=p)}),l}callNoMatchOnInvalidRanges(a,l){let c,d,h=!1;return a&&void 0!==a.start?(d=(c=parseInt(a.start,10))+parseInt(a.length,10),this.isNumeric(a.start)&&this.isNumeric(a.length)&&d-l>0&&d-c>0?h=!0:(this.log(`Ignoring invalid or overlapping range: ${JSON.stringify(a)}`),this.opt.noMatch(a))):(this.log(`Ignoring invalid range: ${JSON.stringify(a)}`),this.opt.noMatch(a)),{start:c,end:d,valid:h}}checkWhitespaceRanges(a,l,c){let d,h=!0,p=c.length,g=l-p,v=parseInt(a.start,10)-g;return(d=(v=v>p?p:v)+parseInt(a.length,10))>p&&(d=p,this.log(`End range automatically set to the max value of ${p}`)),v<0||d-v<0||v>p||d>p?(h=!1,this.log(`Invalid range: ${JSON.stringify(a)}`),this.opt.noMatch(a)):""===c.substring(v,d).replace(/\s+/g,"")&&(h=!1,this.log("Skipping whitespace only range: "+JSON.stringify(a)),this.opt.noMatch(a)),{start:v,end:d,valid:h}}getTextNodes(a){let l="",c=[];this.iterator.forEachNode(NodeFilter.SHOW_TEXT,d=>{c.push({start:l.length,end:(l+=d.textContent).length,node:d})},d=>this.matchesExclude(d.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT,()=>{a({value:l,nodes:c})})}matchesExclude(a){return t.matches(a,this.opt.exclude.concat(["script","style","title","head","html"]))}wrapRangeInTextNode(a,l,c){const d=this.opt.element?this.opt.element:"mark",h=a.splitText(l),p=h.splitText(c-l);let g=document.createElement(d);return g.setAttribute("data-markjs","true"),this.opt.className&&g.setAttribute("class",this.opt.className),g.textContent=h.textContent,h.parentNode.replaceChild(g,h),p}wrapRangeInMappedTextNode(a,l,c,d,h){a.nodes.every((p,g)=>{const v=a.nodes[g+1];if(void 0===v||v.start>l){if(!d(p.node))return!1;const r=l-p.start,u=(c>p.end?p.end:c)-p.start,f=a.value.substr(0,p.start),m=a.value.substr(u+p.start);if(p.node=this.wrapRangeInTextNode(p.node,r,u),a.value=f+m,a.nodes.forEach((b,w)=>{w>=g&&(a.nodes[w].start>0&&w!==g&&(a.nodes[w].start-=u),a.nodes[w].end-=u)}),c-=u,h(p.node.previousSibling,p.start),!(c>p.end))return!1;l=p.end}return!0})}wrapGroups(a,l,c,d){return d((a=this.wrapRangeInTextNode(a,l,l+c)).previousSibling),a}separateGroups(a,l,c,d,h){let p=l.length;for(let g=1;g<p;g++){let v=a.textContent.indexOf(l[g]);l[g]&&v>-1&&d(l[g],a)&&(a=this.wrapGroups(a,v,l[g].length,h))}return a}wrapMatches(a,l,c,d,h){const p=0===l?0:l+1;this.getTextNodes(g=>{g.nodes.forEach(v=>{let r;for(v=v.node;null!==(r=a.exec(v.textContent))&&""!==r[p];){if(this.opt.separateGroups)v=this.separateGroups(v,r,p,c,d);else{if(!c(r[p],v))continue;let u=r.index;if(0!==p)for(let f=1;f<p;f++)u+=r[f].length;v=this.wrapGroups(v,u,r[p].length,d)}a.lastIndex=0}}),h()})}wrapMatchesAcrossElements(a,l,c,d,h){const p=0===l?0:l+1;this.getTextNodes(g=>{let v;for(;null!==(v=a.exec(g.value))&&""!==v[p];){let r=v.index;if(0!==p)for(let f=1;f<p;f++)r+=v[f].length;this.wrapRangeInMappedTextNode(g,r,r+v[p].length,f=>c(v[p],f),(f,m)=>{a.lastIndex=m,d(f)})}h()})}wrapRangeFromIndex(a,l,c,d){this.getTextNodes(h=>{const p=h.value.length;a.forEach((g,v)=>{let{start:r,end:u,valid:f}=this.checkWhitespaceRanges(g,p,h.value);f&&this.wrapRangeInMappedTextNode(h,r,u,m=>l(m,g,h.value.substring(r,u),v),m=>{c(m,g)})}),d()})}unwrapMatches(a){const l=a.parentNode;let c=document.createDocumentFragment();for(;a.firstChild;)c.appendChild(a.removeChild(a.firstChild));l.replaceChild(c,a),this.ie?this.normalizeTextNode(l):l.normalize()}normalizeTextNode(a){if(a){if(3===a.nodeType)for(;a.nextSibling&&3===a.nextSibling.nodeType;)a.nodeValue+=a.nextSibling.nodeValue,a.parentNode.removeChild(a.nextSibling);else this.normalizeTextNode(a.firstChild);this.normalizeTextNode(a.nextSibling)}}markRegExp(a,l){this.opt=l,this.log(`Searching with expression "${a}"`);let c=0,d="wrapMatches";this.opt.acrossElements&&(d="wrapMatchesAcrossElements"),this[d](a,this.opt.ignoreGroups,(h,p)=>this.opt.filter(p,h,c),h=>{c++,this.opt.each(h)},()=>{0===c&&this.opt.noMatch(a),this.opt.done(c)})}mark(a,l){this.opt=l;let c=0,d="wrapMatches";const{keywords:h,length:p}=this.getSeparatedKeywords("string"==typeof a?[a]:a),g=v=>{const r=new s(this.opt).create(v);let u=0;this.log(`Searching with expression "${r}"`),this[d](r,1,(f,m)=>this.opt.filter(m,v,c,u),f=>{u++,c++,this.opt.each(f)},()=>{0===u&&this.opt.noMatch(v),h[p-1]===v?this.opt.done(c):g(h[h.indexOf(v)+1])})};this.opt.acrossElements&&(d="wrapMatchesAcrossElements"),0===p?this.opt.done(c):g(h[0])}markRanges(a,l){this.opt=l;let c=0,d=this.checkRanges(a);d&&d.length?(this.log("Starting to mark with the following ranges: "+JSON.stringify(d)),this.wrapRangeFromIndex(d,(h,p,g,v)=>this.opt.filter(h,p,g,v),(h,p)=>{c++,this.opt.each(h,p)},()=>{this.opt.done(c)})):this.opt.done(c)}unmark(a){this.opt=a;let l=this.opt.element?this.opt.element:"*";l+="[data-markjs]",this.opt.className&&(l+=`.${this.opt.className}`),this.log(`Removal selector "${l}"`),this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT,c=>{this.unwrapMatches(c)},c=>{const d=t.matches(c,l),h=this.matchesExclude(c);return!d||h?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},this.opt.done)}}return(e=e&&e.hasOwnProperty("default")?e.default:e).fn.mark=function(n,a){return new o(this.get()).mark(n,a),this},e.fn.markRegExp=function(n,a){return new o(this.get()).markRegExp(n,a),this},e.fn.markRanges=function(n,a){return new o(this.get()).markRanges(n,a),this},e.fn.unmark=function(n){return new o(this.get()).unmark(n),this},e}),function(e){e.caretTo=function(t,s){t.createTextRange?((t=t.createTextRange()).move("character",s),t.select()):null!=t.selectionStart&&(t.focus(),t.setSelectionRange(s,s))},e.fn.caretTo=function(t,s){return this.queue(function(o){if(isNaN(t)){var n=e(this).val().indexOf(t);!0===s?n+=t.length:s&&(n+=s),e.caretTo(this,n)}else e.caretTo(this,t);o()})},e.fn.caretToStart=function(){return this.caretTo(0)},e.fn.caretToEnd=function(){return this.queue(function(t){e.caretTo(this,e(this).val().length),t()})}}(jQuery);var Module,regSelect=function(){var e=function(b,w,A,x){for(A=A||{},x=b.length;x--;A[b[x]]=w);return A},t=[1,3],s=[1,4],o=[1,5],n=[1,6],a=[1,7],l=[1,8],c=[1,10],d=[1,11],h=[5,10,11,14],p={trace:function(){},yy:{},symbols_:{error:2,select:3,exp:4,EOF:5,WORD:6,DSTRING:7,SSTRING:8,REGEXP:9,AND:10,OR:11,NOT:12,"(":13,")":14,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"WORD",7:"DSTRING",8:"SSTRING",9:"REGEXP",10:"AND",11:"OR",12:"NOT",13:"(",14:")"},productions_:[0,[3,2],[4,1],[4,1],[4,1],[4,1],[4,3],[4,3],[4,2],[4,3]],performAction:function(w,A,x,y,S,_,C){var I=_.length-1;switch(S){case 1:return JS9.tmp.regSelect.ids=_[I-1],_[I-1];case 2:case 5:this.$=g(_[I]);break;case 3:this.$=g(_[I].replace(/^"(.+(?="$))"$/,"$1"));break;case 4:this.$=g(_[I].replace(/^'(.+(?='$))'$/,"$1"));break;case 6:this.$=function v(b,w){return b.filter(A=>w.includes(A))}(_[I-2],_[I]);break;case 7:this.$=function r(b,w){return[...new Set([...b,...w])]}(_[I-2],_[I]);break;case 8:this.$=function u(b){return JS9.tmp.regSelect.all.filter(w=>!b.includes(w))}(_[I]);break;case 9:this.$=_[I-1]}},table:[{3:1,4:2,6:t,7:s,8:o,9:n,12:a,13:l},{1:[3]},{5:[1,9],10:c,11:d},e(h,[2,2]),e(h,[2,3]),e(h,[2,4]),e(h,[2,5]),{4:12,6:t,7:s,8:o,9:n,12:a,13:l},{4:13,6:t,7:s,8:o,9:n,12:a,13:l},{1:[2,1]},{4:14,6:t,7:s,8:o,9:n,12:a,13:l},{4:15,6:t,7:s,8:o,9:n,12:a,13:l},e(h,[2,8]),{10:c,11:d,14:[1,16]},e(h,[2,6]),e(h,[2,7]),e(h,[2,9])],defaultActions:{9:[2,1]},parseError:function(w,A){if(!A.recoverable){var x=new Error(w);throw x.hash=A,x}this.trace(w)},parse:function(w){var A=this,x=[0],S=[null],_=[],C=this.table,I="",L=0,D=0,O=0,M=2,E=1,R=_.slice.call(arguments,1),H=Object.create(this.lexer),N={yy:{}};for(var B in this.yy)Object.prototype.hasOwnProperty.call(this.yy,B)&&(N.yy[B]=this.yy[B]);H.setInput(w,N.yy),N.yy.lexer=H,N.yy.parser=this,typeof H.yylloc>"u"&&(H.yylloc={});var P=H.yylloc;_.push(P);var z=H.options&&H.options.ranges;this.parseError="function"==typeof N.yy.parseError?N.yy.parseError:Object.getPrototypeOf(this).parseError;for(var G,ee,le,te,de,ce,he,Se,q=function(){var ie;return"number"!=typeof(ie=H.lex()||E)&&(ie=A.symbols_[ie]||ie),ie},xe={};;){if(this.defaultActions[le=x[x.length-1]]?te=this.defaultActions[le]:((null===G||typeof G>"u")&&(G=q()),te=C[le]&&C[le][G]),typeof te>"u"||!te.length||!te[0]){var Y="";for(ce in Se=[],C[le])this.terminals_[ce]&&ce>M&&Se.push("'"+this.terminals_[ce]+"'");Y=H.showPosition?"Parse error on line "+(L+1)+":\n"+H.showPosition()+"\nExpecting "+Se.join(", ")+", got '"+(this.terminals_[G]||G)+"'":"Parse error on line "+(L+1)+": Unexpected "+(G==E?"end of input":"'"+(this.terminals_[G]||G)+"'"),this.parseError(Y,{text:H.match,token:this.terminals_[G]||G,line:H.yylineno,loc:P,expected:Se})}if(te[0]instanceof Array&&te.length>1)throw new Error("Parse Error: multiple actions possible at state: "+le+", token: "+G);switch(te[0]){case 1:x.push(G),S.push(H.yytext),_.push(H.yylloc),x.push(te[1]),G=null,ee?(G=ee,ee=null):(D=H.yyleng,I=H.yytext,L=H.yylineno,P=H.yylloc,O>0&&O--);break;case 2:if(xe.$=S[S.length-(he=this.productions_[te[1]][1])],xe._$={first_line:_[_.length-(he||1)].first_line,last_line:_[_.length-1].last_line,first_column:_[_.length-(he||1)].first_column,last_column:_[_.length-1].last_column},z&&(xe._$.range=[_[_.length-(he||1)].range[0],_[_.length-1].range[1]]),typeof(de=this.performAction.apply(xe,[I,D,L,N.yy,te[1],S,_].concat(R)))<"u")return de;he&&(x=x.slice(0,-1*he*2),S=S.slice(0,-1*he),_=_.slice(0,-1*he)),x.push(this.productions_[te[1]][0]),S.push(xe.$),_.push(xe._$),x.push(C[x[x.length-2]][x[x.length-1]]);break;case 3:return!0}}return!0}};function g(b){const w=[];return JS9.tmp.regSelect||JS9.error("region selection parse not configured"),JS9.isImage(JS9.tmp.regSelect.im)||JS9.error("invalid image specified for selection parser"),JS9.tmp.regSelect.layer||JS9.error("no layer specified for selection parser"),JS9.tmp.regSelect.all||JS9.error("all shapes not specified for selection parser"),JS9.tmp.regSelect.im._selectShapes(JS9.tmp.regSelect.layer,b,null,A=>{let x;A.params?A.params.groupid?$.inArray(A.params.groupid,w)<0&&w.push(A.params.groupid):w.push(A.params.id):"group"===A.type&&(x=A.getObjects(),x&&x[0]&&x[0].params.groupid&&$.inArray(A.params.groupid,w)<0&&w.push(x[0].params.groupid))}),w}function m(){this.yy={}}return p.lexer={EOF:1,parseError:function(A,x){if(!this.yy.parser)throw new Error(A);this.yy.parser.parseError(A,x)},setInput:function(w,A){return this.yy=A||this.yy||{},this._input=w,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var w=this._input[0];return this.yytext+=w,this.yyleng++,this.offset++,this.match+=w,this.matched+=w,w.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),w},unput:function(w){var A=w.length,x=w.split(/(?:\r\n?|\n)/g);this._input=w+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-A),this.offset-=A;var y=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),x.length-1&&(this.yylineno-=x.length-1);var S=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:x?(x.length===y.length?this.yylloc.first_column:0)+y[y.length-x.length].length-x[0].length:this.yylloc.first_column-A},this.options.ranges&&(this.yylloc.range=[S[0],S[0]+this.yyleng-A]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(w){this.unput(this.match.slice(w))},pastInput:function(){var w=this.matched.substr(0,this.matched.length-this.match.length);return(w.length>20?"...":"")+w.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var w=this.match;return w.length<20&&(w+=this._input.substr(0,20-w.length)),(w.substr(0,20)+(w.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var w=this.pastInput(),A=new Array(w.length+1).join("-");return w+this.upcomingInput()+"\n"+A+"^"},test_match:function(w,A){var x,y,S;if(this.options.backtrack_lexer&&(S={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(S.yylloc.range=this.yylloc.range.slice(0))),(y=w[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=y.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:y?y[y.length-1].length-y[y.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+w[0].length},this.yytext+=w[0],this.match+=w[0],this.matches=w,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(w[0].length),this.matched+=w[0],x=this.performAction.call(this,this.yy,this,A,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),x)return x;if(this._backtrack){for(var _ in S)this[_]=S[_];return!1}return!1},next:function(){if(this.done)return this.EOF;var w,A,x,y;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var S=this._currentRules(),_=0;_<S.length;_++)if((x=this._input.match(this.rules[S[_]]))&&(!A||x[0].length>A[0].length)){if(A=x,y=_,this.options.backtrack_lexer){if(!1!==(w=this.test_match(x,S[_])))return w;if(this._backtrack){A=!1;continue}return!1}if(!this.options.flex)break}return A?!1!==(w=this.test_match(A,S[y]))&&w:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(A){this.conditionStack.push(A)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(A){return(A=this.conditionStack.length-1-Math.abs(A||0))>=0?this.conditionStack[A]:"INITIAL"},pushState:function(A){this.begin(A)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(A,x,y,S){switch(y){case 0:break;case 1:return 6;case 2:return 7;case 3:return 8;case 4:return 9;case 5:return 13;case 6:return 14;case 7:case 8:return 11;case 9:case 10:return 10;case 11:case 12:return 12;case 13:return 5}},rules:[/^(?:\s+)/,/^(?:[a-zA-Z0-9_@#%^;:.*+/-]+)/,/^(?:"([^"]*)")/,/^(?:'([^']*)')/,/^(?:\/([^\/]*)\/)/,/^(?:\()/,/^(?:\))/,/^(?:\|\|)/,/^(?:OR\b)/,/^(?:&&)/,/^(?:AND\b)/,/^(?:!)/,/^(?:NOT\b)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},m.prototype=p,p.Parser=m,new m}();typeof require<"u"&&typeof exports<"u"&&(exports.parser=regSelect,exports.Parser=regSelect.Parser,exports.parse=function(){return regSelect.parse.apply(regSelect,arguments)},exports.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),process.exit(1));var s=require("fs").readFileSync(require("path").normalize(t[1]),"utf8");return exports.parser.parse(s)},typeof module<"u"&&require.main===module&&exports.main(process.argv.slice(1))),"object"!=typeof Module&&(Module={});var JS9=function(){const e={NAME:"JS9",VERSION:"3.7",COPYRIGHT:"Copyright (c) 2012-2022 Smithsonian Institution"};if(e.ABOUT=`JS9 ${e.VERSION}: astronomical image display everywhere\nEric Mandel, Alexey Vikhlinin\n${e.COPYRIGHT}`,e.DEFID="JS9",e.WIDTH=512,e.HEIGHT=512,e.ANON="Anonymous",e.PREFSFILE="js9Prefs.json",e.WORKERFILE="js9worker.js",e.ZINDEX=0,e.SHAPEZINDEX=4,e.MESSZINDEX=80,e.BTNZINDEX=90,e.MENUZINDEX=1e3,e.COLORSIZE=1024,e.SCALESIZE=16384,e.INVSIZE=1024,e.HISTSIZE=16384,e.INSTALLDIR="",e.TOROOT="",e.PLUGINS="",e.LIGHTWIN="dhtml",e.ANTIALIAS=!1,e.SCALEIREG=!0,e.NOMOVE=3,e.DBLCLICK0=5,e.DBLCLICK=300,e.TIMEOUT=250,e.SPINOUT=250,e.WORKEROUT=2e3,e.SUPERMENU=/^SUPERMENU_/,e.RESIZEDIST=20,e.RESIZEFUDGE=5,e.RAWID0="raw0",e.RAWIDX="alt",e.IDFMT="  (%s)",e.MINZOOM=.125,e.MAXZOOM=32,e.ADDZOOM=.1,e.MODZOOM=2,e.DIRZOOM=1,e.CHROMEFILEWARNING=!0,e.CLIPBOARDERROR="the local clipboard (which only holds data copied from within JS9) does not contain any content. Were you trying to paste something copied outside JS9?",e.CLIPBOARDERROR2="the local clipboard (which only holds data copied from within JS9) does not contain any regions",e.URLEXP=/^(https?|ftp):\/\//,e.WCSEXP=/^(fk4|fk5|icrs|galactic|ecliptic|image|physical|linear)$/,e.REGSIZE=0,e.TOUCHSUPPORTED={}.hasOwnProperty.call(window,"ontouchstart")||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,e.BROWSER=function(){const t=navigator.platform,s=navigator.appName,o=navigator.userAgent,n=o.match(/version\/([.\d]+)/i);let a=o.match(/(opera|chrome|safari|firefox)\/?\s*(\.?\d+(\.\d+)*)/i);return a&&null!==n&&(a[2]=n[1]),a=a?[a[1],a[2],t]:[s,navigator.appVersion,"-?",t],a.push(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(o)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1),a}(),e.PIXEL_RATIO=function(){const t=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}(),e.globalOpts={helperType:"none",helperPort:2718,requireHelper:!1,allinoneHelper:!1,processQueryParams:!0,quietReturn:!1,useWasm:!0,transforms:["flip","rot90","rotate"],rotateRelative:!1,clickToFocus:!1,winType:"light",sortPreloads:!0,defcolor:"#00FF00",fits2fits:"never",requireFits2Fits:!1,localAccess:!0,prependJS9Dir:!0,dataDir:null,alerts:!0,valposTarget:null,valposWidth:"medium",valposDCoords:!1,internalValPos:!0,internalContrastBias:!0,containContrastBias:!1,arrowIncrement:1,wcsCrosshair:!1,localLoadFormat:"image",remoteLoadMethod:"proxy",csvIncludeWCS:!0,regWhichDefault:"auto",regIncludeJSON:!0,regIncludeComments:!0,regListDCoords:!1,regSaveDCoords:!1,regExpandDCoords:!1,regCopyDCoords:!0,regArrowCrosshair:!0,regSaveWCS:"",regSaveFormat:"reg",regSaveWhich1:"all",regSaveWhich2:"selected",regMenuCreate:!0,regMenuSelection:"circle",regToClipboard:!1,regGroupConflict:"skip",regConfigAddParens:!0,regSyncTextColor:!0,regDisplay:"lightwin",reConfigSize:"medium",htimeout:1e4,lhtimeout:1e4,ehtimeout:500,ehretries:20,xtimeout:6e5,extlist:"EVENTS STDEVT",imopts:"IMOPTS",imcmap:"IMCMAP",table:{xdim:4096,ydim:4096,bin:1,bitpix:32},image:{xdim:4096,ydim:4096,bin:1},binMode:"s",reprojSwitches:"",reprojectLimits:!1,rotationCenter:"file",runOnCR:!0,clearImageMemory:"heap",helperProtocol:location.protocol,reloadRefresh:!1,reloadRefreshReg:!0,nextImageMask:!1,panMouseThreshold:1,panzoomRefreshLimit:500,panWithinDisplay:!1,pannerDirections:!0,magnifierRegions:!0,editRegions:!0,svgBorder:!0,unremoveReg:100,resetEmptyShapeId:!1,maxMemory:2e9,loadURL:"params/load.html",corsURL:"params/loadcors.html",proxyURL:"params/loadproxy.html",loadProxy:!1,imsectionURL:"params/imsection.html",postMessage:!1,localStorage:!0,waitType:"spinner",spinColor:"#FF0000",spinOpacity:.35,resize:!0,resizeHandle:!0,resizeRedisplay:!0,logoDisplay:!1,logo:"images/js9logo.png",lightWinPos:"center=1",lightWinClose:"ask",fallbackDisplay:!0,refreshDragDrop:!0,reduceMosaic:"js9",internalRegcnts:!0,reduceRegcnts:!0,plot3d:{cube:"*:*:all",mode:"avg",areaunits:"pixels",color:"green"},imexamLineHeight:1,copyWcsPosFormat:"$ra $dec $sys",floatPrecision:6,mouseActions:["display value/position","change contrast/bias","pan the image"],touchActions:["display value/position","change contrast/bias","pan the image"],keyboardActions:{a:"add last region selected in regions menu",b:"toggle selected region: source/background",c:"toggle crosshair",d:"send selected region to back",e:"toggle selected region: include/exclude","M-e":"edit selected region(s)",i:"refresh image",I:"display full image","M-i":"display selected cutouts","M-k":"toggle keyboard actions plugin",l:"toggle active shape layers","M-l":"new JS9 light window",m:"pan to mouse position","M-m":"toggle mouse/touch plugin","M-o":"open local file",P:"paste regions from local clipboard",p:"paste regions to current position","M-,":"toggle preferences plugin","M-p":"toggle preferences plugin",r:"copy region(s) to clipboard",s:"select region",S:"select all regions","M-s":"toggle shape layers plugin",u:"undo remove of region(s)",U:"unselect all regions",x:"flip image around x axis",y:"flip image around y axis",9:"rotate image by 90 degrees","/":"copy wcs position to clipboard","?":"copy value and position to clipboard",0:"reset zoom","=":"zoom in","+":"zoom in","-":"zoom out","^":"raise region layer to top",">":"display next image","<":"display previous image",delete:"remove selected region",leftArrow:"move region/position left",upArrow:"move region/position up",rightArrow:"move region/position right",downArrow:"move region/position down"},mousetouchZoom:!1,mousetouchLimit:!0,metaClickPan:!0,statusBar:"$colorbar; $colormap; $mag; $scale ($scalemin,$scalemax); $wcssys; $image0",toolbarTooltips:!1,updateTitlebar:!0,centerDivs:["JS9Menubar"],resizeDivs:["JS9Menubar","JS9Colorbar","JS9Toolbar","JS9Statusbar"],pinchWait:8,pinchThresh:6,xeqPlugins:!0,extendedPlugins:!0,intensivePlugins:!1,dynamicSelect:"click",dynamicHighlight:!0,corsProxy:"https://js9.si.edu/cgi-bin/CORS-proxy.cgi",simbadProxy:"https://js9.si.edu/cgi-bin/simbad-proxy.cgi",cgiProxy:"https://js9.si.edu/cgi-bin/FITS-proxy.cgi",catalogs:{ras:["RA","_RAJ2000","RAJ2000"],decs:["Dec","_DEJ2000","DEJ2000"],shape:"circle",color:"yellow",width:7,height:7,radius:3.5,r1:5,r2:3.5,wcssys:"ICRS",skip:"#\n",save:!0,tooltip:"$data.ra $data.dec"},topColormaps:["grey","heat","cool","turbo","viridis","magma","sls","red","green","blue"],infoBox:["file","object","wcsfov","wcscen","wcspos","impos","physpos","value","regions","progress"],infoBoxResize:!0,menuBar:["file","edit","view"],menubarStyle:"classic",menuPosition:"right-5 bottom-5",menuClickEvent:"mouseup",menuSelected:"check",menuImages:!0,userMenus:!1,userMenuDivider:"&nbsp;&nbsp;&nbsp;",imagesFileSubmenu:5,toolBar:["annulus","box","circle","ellipse","line","polygon","text","zoom+","zoom-","zoom1","zoomtofit"],syncOps:["alignment","colormap","contrastbias","flip","pan","regions","rotate","rot90","scale","wcs","zoom"],syncReciprocate:!0,syncWCS:!0,hiddenPluginDivs:[],separate:{layout:"auto",leftMargin:10,topMargin:10},imageTemplates:".fits,.fts,.png,.jpg,.jpeg,.fz,.ftz,.gz",wcsUnits:{FK4:"sexagesimal",FK5:"sexagesimal",ICRS:"sexagesimal",galactic:"degrees",ecliptic:"degrees",linear:"degrees",physical:"pixels",image:"pixels"},wcsSetUpdatesDef:!0,wcsHlength:256e3,regTemplates:".reg",sessionTemplates:".ses,.js9ses",colormapTemplates:".cmap",catalogTemplates:".cat,.tab",localTemplates:".fits,.fts",controlsMatchRegion:!1,internalColorPicker:!0,newWindowWidth:530,newWindowHeight:625,debug:0},e.favorites={scales:["linear","log","histeq"],colormaps:["cool","heat","viridis","magma"],regions:["annulus","box","circle","ellipse"],wcs:["FK5","ICRS","galactic:Galactic","physical","image"]},e.desktopOpts={currentPath:!0,sessionPath:!0},e.imageOpts={inherit:!1,contrast:1,bias:.5,invert:!1,exp:1e3,colormap:"grey",overlay:!0,scale:"linear",scaleclipping:"dataminmax",scalemin:Number.NaN,scalemax:Number.NaN,flip:"none",rot90:0,rotate:0,zscalecontrast:.25,zscalesamples:600,zscaleline:120,wcssys:"native",lcs:"physical",valpos:!0,sigma:"none",opacity:1,alpha:255,nancolor:"#000000",nocolor:{red:0,green:0,blue:0,alpha:0},zoom:1,zooms:6,topZooms:2,wcsalign:!0,rotationMode:"relative",crosshair:!1,disable:[],ltvbug:!1,listonchange:!1,whichonchange:"selected"},e.regionOpts={},e.catalogOpts={},e.crosshairOpts={},e.gridOpts={},e.emscriptenOpts={},e.fabricOpts={},e.socketioOpts={reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:1e4,reconnectionAttempts:100,timeout:e.globalOpts.htimeout},e.blendOpts={active:!0,mode:"screen",opacity:1},e.maskOpts={active:!1,mode:"overlay",opacity:1,vopacity:0,value:0,syncops:["flip","pan","rot90","zoom"],invert:!1},e.analOpts={epattern:/^(ERROR:[^\n]*)\n/,dpathURL:"params/datapath.html",fpathURL:"params/filepath.html"},e.lightOpts={nclick:0,dhtml:{topid:"#dhtmlwindowholder",top:".dhtmlwindow",drag:".drag-contentarea",dragBar:".drag-handle",format:"width=%spx,height=%spx,resize=%s,scrolling=0",textWin:"width=830px,height=400px,resize=1,scrolling=1",plotWin:"width=830px,height=420px,resize=1,scrolling=1",dpathWin:"width=830px,height=175px,resize=1,scrolling=1",lcloseWin:"width=512px,height=190px,resize=1,scrolling=1",paramWin:"width=830px,height=235px,resize=1,scrolling=1",regWin0:"width=640px,height=130px,resize=1,scrolling=1",regWin1:"width=640px,height=200px,resize=1,scrolling=1",regWin:"width=640px,height=470px,resize=1,scrolling=1",imageWin:"width=512px,height=598px,resize=1,scrolling=1",lineWin:"width=400px,height=60px,resize=1,scrolling=1"},lcloseURL:"params/lightclose.html"},e.textColorOpts={regions:"#00FF00",info:"#00FF00",inimage:"#000000"},e.helpOpts={user:{heading:"JS9Help",type:"help",url:"user.html",title:"User Manual"},install:{heading:"JS9Help",type:"help",url:"install.html",title:"Installing JS9"},webpage:{heading:"JS9Help",type:"help",url:"webpage.html",title:"Adding JS9 to a Web Page"},yourdata:{heading:"JS9Help",type:"help",url:"yourdata.html",title:"Adding Data to a Web Page"},localtasks:{heading:"JS9Help",type:"help",url:"localtasks.html",title:"Adding Local Analysis Tasks and Plugins"},helper:{heading:"JS9Help",type:"help",url:"helper.html",title:"Adding Server-side Analysis Tasks"},serverside:{heading:"JS9Help",type:"help",url:"serverside.html",title:"Server-side Analysis with JS9"},publicapi:{heading:"JS9Help",type:"help",url:"publicapi.html",title:"The JS9 Public API"},extmsg:{heading:"JS9Help",type:"help",url:"extmsg.html",title:"External Messaging"},desktop:{heading:"JS9Help",type:"help",url:"desktop.html",title:"JS9 on the Desktop"},python:{heading:"JS9Help",type:"help",url:"python.html",title:"JS9 with Python and Jupyter"},archives:{heading:"JS9Help",type:"help",url:"archives.html",title:"Accessing Data Archives"},preferences:{heading:"JS9Help",type:"help",url:"preferences.html",title:"Setting Site Preferences"},regions:{heading:"JS9Help",type:"help",url:"regions.html",title:"Regions Format"},changelog:{heading:"JS9Help",type:"help",url:"changelog.html",title:"ChangeLog"},repfile:{heading:"JS9Help",type:"help",url:"repfile.html",title:"Dealing with Large Files"},memory:{heading:"JS9Help",type:"help",url:"memory.html",title:"Dealing with Memory Limitations"},issues:{heading:"JS9Help",type:"help",url:"knownissues.html",title:"Known Issues"},security:{heading:"JS9Help",type:"help",url:"securityissues.html",title:"Security Issues"}},e.images=[],e.displays=[],e.colormaps=[],e.commands=[],e.plugins=[],e.preloads=[],e.auxFiles=[],e.supermenus=[],e.preloadwaiting=[],e.publics={},e.helper={},e.fits={},e.userOpts={},e.tmp={},e.scales=["linear","log","histeq","power","sqrt","squared","asinh","sinh"],e.wcssyss=["FK4","FK5","ICRS","galactic","ecliptic","physical","image","native"],e.wcsunitss=["degrees","sexagesimal","pixels"],e.regions=["annulus","box","circle","cross","ellipse","line","point","polygon","text"],e.bugs={},e.bugs.hide_menu=!1,"Firefox"===e.BROWSER[0]&&e.BROWSER[2].search(/Linux/)>=0&&(e.bugs.firefox_linux=!0),"Safari"===e.BROWSER[0]&&(e.bugs.webkit_resize=!0),/iPad|iPhone|iPod/.test(navigator.platform)&&/11_2_(?:[2-9])/.test(navigator.userAgent)&&(e.globalOpts.useWasm=!1),e.BROWSER[3]&&(e.globalOpts.maxMemory=Math.min(e.globalOpts.maxMemory,35e7),e.globalOpts.table.xdim=2048,e.globalOpts.table.ydim=2048,e.globalOpts.image.xdim=2048,e.globalOpts.image.ydim=2048,e.imageOpts.crosshair=!1,e.globalOpts.reproj={xdim:2048,ydim:2048},e.lightOpts.dhtml.regWin0="width=660px,height=130px,resize=1,scrolling=1",e.lightOpts.dhtml.regWin1="width=660px,height=200px,resize=1,scrolling=1",e.lightOpts.dhtml.regWin="width=660px,height=470px,resize=1,scrolling=1"),{}.hasOwnProperty.call(window,"Jupyter")&&(e.globalOpts.useWasm=!1),window.electron&&(window.electron.hostFS&&(e.hostFS=window.electron.hostFS),window.electron.multiElectron&&(e.globalOpts.localStorage=!1),"function"==typeof window.eval&&(window.eval=function(){throw new Error("For security reasons, Desktop JS9 does not support window.eval()")}),window.electron.cmdlineOpts))try{e.cmdlineOpts=JSON.parse(window.electron.cmdlineOpts)}catch{delete e.cmdlineOpts}return e.Image=function(t,s,o){let n,a,l,c,d,h,p,g=null,v=0,r=0;const f=m=>{let b,w,A,x,y,S,_,C,I;const L=e.globalOpts.imopts,D=e.globalOpts.imcmap,O=e.globalOpts.alerts;if(e.images.push(this),this.display.clearMessage(),g&&(e.notNull(g.flip)||e.notNull(g.rotate)||e.notNull(g.rot90))&&this.setTransform(),this.displayImage("all",g),this.notifyHelper(),this.showShapeLayer("regions",!0,{local:!0}),g&&((e.notNull(g.x)&&e.notNull(g.y)||e.notNull(g.px)&&e.notNull(g.py)||e.notNull(g.ra)&&e.notNull(g.dec)||e.notNull(g.wcs))&&this.setPan(g),g.regions&&(g.regions.match(/(annulus|box|circle|ellipse|line|polygon|point|text) *\(/)?this.addShapes("regions",g.regions):e.LoadRegions(g.regions,{display:this.display}))),e.globalOpts.alerts=!1,this.raw&&this.raw.header&&this.raw.header[D]){try{A=JSON.parse(this.raw.header[D])}catch{A=null}if(A)try{e.AddColormap(A)}catch{}}if(x=`${D}1`,this.raw&&this.raw.header&&this.raw.header[x]){for(b=1,w="";b<100&&(x=D+String(b),this.raw.header[x]);b++)w+=this.raw.header[x];if(w){try{A=JSON.parse(w)}catch{A=null}if(A)try{e.AddColormap(A)}catch{}}}if(this.raw&&this.raw.header&&this.raw.header[L]){try{A=JSON.parse(this.raw.header[L])}catch{A=null}if(A)try{this.setParam("all",A)}catch{}}if(x=`${L}1`,this.raw&&this.raw.header&&this.raw.header[x]){for(b=1,w="";b<100&&(x=L+String(b),this.raw.header[x]);b++)w+=this.raw.header[x];if(w){try{A=JSON.parse(w)}catch{A=null}if(A)try{this.setParam("all",A)}catch{}}}if(e.globalOpts.alerts=O,this.xeqPlugins("image","onimageload"),this.setStatus("load","complete"),e.waiting(!1),m)try{e.xeqByName(m,window,this)}catch(E){e.error("in image onload callback",E,!1)}if(e.preloadwaiting&&e.preloadwaiting.length){for(C=e.preloadwaiting.length,y=this.proxyURL||this.file,b=0,_=0;b<C;b++)S=e.preloadwaiting[b],y.match(S.id)||S.id.match(y)?(S.loaded=!0,S.im=this):!1===S.loaded&&_++;if(!_){if(e.globalOpts.sortPreloads?(e.images.sort((E,R)=>{let H=0,N=0;for(b=0;b<C;b++)S=e.preloadwaiting[b],E.id===S.im.id&&(H=b),R.id===S.im.id&&(N=b);return H-N}),I=e.preloadwaiting[C-1].im||this,I.displayImage()):I=this,e.notNull(e.globalOpts.onpreload))try{e.xeqByName(e.globalOpts.onpreload,window,I)}catch(E){e.error("in onpreload callback",E,!1)}finally{delete e.globalOpts.onpreload}e.preloadwaiting=[]}}g&&g.allext&&this.hdus&&this.hdus.length>0&&this.displayExtension("all")};if(s&&("object"==typeof s?(g=s,g.display&&(d=g.display)):d=s),d||(d=e.displays.length>0?e.displays[0].id:e.DEFID),this.type="image",this.display=e.lookupDisplay(d),this.params={},this.regstack=[],this.tmp={},this.groups={},this.params.xeqonchange=!0,this.params=$.extend(!0,this.params,e.imageOpts,g),this.display.image&&(this.params.inherit=this.display.image.params.inherit,this.params.inherit&&(this.params=$.extend(!0,this.params,this.display.image.params))),h=e.globalOpts.xeqPlugins,p=this.params.overlay,e.globalOpts.xeqPlugins=!1,this.setColormap(this.params.colormap),this.params.overlay=p,e.globalOpts.xeqPlugins=h,this.displayMode=!0,this.clickState=0,this.clickInRegion=!1,this.clickInLayer=null,this.queried=!1,g&&g.proxyFile&&(this.proxyFile=g.proxyFile),g&&g.proxyParent&&(this.proxyParent=g.proxyParent),g&&g.proxyURL&&(this.proxyURL=g.proxyURL),g&&g.parentFile&&(this.parentFile=g.parentFile),g&&g.parent&&(this.parent=g.parent,this.parent.cardstr&&this.parent.ncard)){for(this.parent.raw={header:{},history:[],comments:[]},n=0;n<this.parent.ncard;n++)a=this.parent.cardstr.slice(80*n,80*(n+1)),l=e.cardpars(a),void 0!==l&&("HISTORY"===l[0]?this.parent.raw.header[`${l[0]}__${v++}`]=l[1]:"COMMENT"===l[0]?this.parent.raw.header[`${l[0]}__${r++}`]=l[1]:this.parent.raw.header[l[0]]=l[1]);this.parent.lcs={},e.Image.prototype.initLCS.call(this.parent,this.parent.raw.header)}g&&g.id&&(this.id=g.id),this.ix=0,this.iy=0,this.status={},this.rgb={},this.rgb.sect={zoom:1,ozoom:1},this.layers={},this.zlayer=e.SHAPEZINDEX,this.lcs={},this.aux={},this.binning={bin:1,obin:1},this.raws=[],this.blend=$.extend(!0,{},e.blendOpts),this.mask=$.extend(!0,{},e.maskOpts),t&&("object"==(e.waiting(!0,this.display),typeof t)?(this.source=g&&g.source?g.source:"fits",this.mkRawDataFromHDU(t,$.extend({},{file:t.file||t.filename},g)),(m=>{e.isNull((m=m||{}).scaleclipping)?"zscale"===this.params.scaleclipping?this.zscale(!0):"zmax"===this.params.scaleclipping&&this.zscale("zmax"):"zscale"===m.scaleclipping?this.zscale(!0):"zmax"===m.scaleclipping&&this.zscale("zmax"),e.notNull(m.scalemin)&&(this.params.scalemin=m.scalemin),e.notNull(m.scalemax)&&(this.params.scalemax=m.scalemax)})(g),this.params.zoom&&(c=this.parseZoom(this.params.zoom),this.rgb.sect.zoom=c,this.rgb.sect.ozoom=c),this.mkSection(),g&&g.rgbFile?(this.rgbFile=g.rgbFile,this.png={image:new Image},$(this.png.image).on("load",()=>{let m;(this.png.image.width!==this.raw.width||this.png.image.height!==this.raw.height)&&(m=sprintf("rgb dims [%s,%s] don't match image [%s,%s]",this.png.image.width,this.png.image.height,this.raw.width,this.raw.height),e.error(m)),this.mkOffScreenCanvas(),f(o)}).on("error",()=>{e.waiting(!1),e.error(`could not load image: ${this.id}`)}),this.png.image.src=this.rgbFile):f(o)):e.error("unknown specification type for Load: "+typeof t))},e.Image.prototype.getImageData=function(t){let s=null;const{xdim:o,ydim:n}=this.fileDimensions();return t&&(s="array"===t?Array.from(this.raw.data):"base64"===t?(l=>{let c,d="";const h=new Uint8Array(this.raw.data.buffer),p=h.byteLength;for(c=0;c<p;c++)d+=String.fromCharCode(h[c]);return window.btoa(d)})():this.raw.data),{id:this.id,file:this.file,fits:this.fitsFile||"",source:this.source,imtab:this.imtab,width:this.raw.width,height:this.raw.height,bitpix:this.raw.bitpix,bin:this.binning.bin,header:this.raw.header,hdus:this.hdus,dwidth:this.display.width,dheight:this.display.height,fwidth:o,fheight:n,data:s}},e.Image.prototype.closeImage=function(t){let s,o,n,a,l,c,d=!1;const h=e.images.length,p=e.Dysel.getDisplayOr(this.display);if("string"==typeof(t=t||{}))try{t=JSON.parse(t)}catch(g){e.error(`can't parse closeImage opts: ${t}`,g)}for(this.setStatus("close","closing"),s=0;s<h;s++)e.images[s].wcsim===this&&(e.images[s].wcsim=null);for(s=0;s<h;s++)e.images[s].mask.im===this&&(e.images[s].mask.im=null,e.images[s].mask.active=!1);for(s=0;s<h;s++)if(this===e.images[s]){if(n=e.images[s],n===n.display.image&&(d=s+1),d)for(a of(!1!==t.clear&&(n.display.clearMessage(),n.display.context.clear()),Object.keys(n.layers)))("main"===n.layers[a].dlayer.dtype||n.display===p)&&n.showShapeLayer(a,!1,{local:!0});switch(n.xeqPlugins("image","onimageclose"),d&&(n.display.image=null),n.cmapObj.name){case"red":n.display.rgb.rim=null;break;case"green":n.display.rgb.gim=null;break;case"blue":n.display.rgb.bim=null}for(o=0;o<n.raws.length;o++)l=n.raws[o],l.hdu&&l.hdu.fits&&(c=e.lookupVfile(l.hdu.fits.vfile),c.length<=1&&e.cleanupFITSFile(l,!0)),l.altwcs&&this.freeWCS(l);n.removeProxyFile(),n.rgb=null,n.offscreen=null,n.raw=null,n.colorData=null,n.colorCells=null,n.psColors=null,n.psInverse=null,n=null,e.images.splice(s,1);break}if(d){for(d-=2,s=d;s>=0;s--)if(n=e.images[s],this.display===n.display){n.displayImage("all"),n.refreshLayers(),d=e.images.length;break}for(s=e.images.length-1;s>d;s--)if(n=e.images[s],this.display===n.display){n.displayImage("all"),n.refreshLayers();break}}},e.Image.prototype.mkOffScreenCanvas=function(){if(!this.png||!this.png.image)return this;this.offscreen={},this.offscreen.canvas=document.createElement("canvas"),this.offscreen.canvas.setAttribute("width",this.png.image.width),this.offscreen.canvas.setAttribute("height",this.png.image.height),this.offscreen.context=this.offscreen.canvas.getContext("2d"),e.ANTIALIAS||(this.offscreen.context.imageSmoothingEnabled=!1),this.offscreen.context.drawImage(this.png.image,0,0);try{this.offscreen.img=this.offscreen.context.getImageData(0,0,this.png.image.width,this.png.image.height)}catch{e.CHROMEFILEWARNING&&"Chrome"===e.BROWSER[0]&&""===document.domain?alert("When using the file:// URI, Chrome must be run with the --allow-file-access-from-files switch to permit JS9 to access data."):alert("could not read off-screen image data [same-origin policy violation?]")}return this},e.Image.prototype.useOffScreenCanvas=function(){return this.offscreen&&(this.rgbFile||this.params.overlay)},e.Image.prototype.initLCS=function(t){let s,o,n,a,l,c,d;const h=[[0,0,0],[0,0,0],[0,0,0]],p=t||this.raw.header,g=p.CRPIX1||1,v=p.CRPIX2||1;if(p.LCSROTA2&&p.CROTA2&&(l=-p.CROTA2*Math.PI/180,c=Math.sin(l),d=Math.cos(l),a=[[0,0,0],[0,0,0],[0,0,0]],a[0][0]=d,a[0][1]=-c,a[0][2]=0,a[1][0]=c,a[1][1]=d,a[1][2]=0,n=e.invertMatrix3(a),n||(a=null)),h[0][0]=e.defNull(p.LTM1_1,1),h[1][0]=p.LTM2_1||0,h[0][1]=p.LTM1_2||0,h[1][1]=e.defNull(p.LTM2_2,1),h[2][0]=p.LTV1||0,h[2][1]=p.LTV2||0,"image"===this.imtab&&this.params.ltvbug){if(e.notNull(p.LTV1))for(s=0;s<2;s++)o=Math.abs(h[0][s]),o>0&&o<1&&(h[2][0]+=.5*o);if(e.notNull(p.LTV2))for(s=0;s<2;s++)o=Math.abs(h[1][s]),o>0&&o<1&&(h[2][1]+=.5*o)}return this.lcs.physical={forward:$.extend(!0,[],h),reverse:e.invertMatrix3(h)},this.lcs.physical.reverse?a&&(this.lcs.physical.frot=$.extend(!0,[],a),this.lcs.physical.rrot=$.extend(!0,[],n),this.lcs.physical.cx=g-h[2][0]-1,this.lcs.physical.cy=v-h[2][1]-1):delete this.lcs.physical,h[0][0]=e.defNull(p.DTM1_1,1),h[1][0]=p.DTM2_1||0,h[0][1]=p.DTM1_2||0,h[1][1]=e.defNull(p.DTM2_2,1),h[2][0]=p.DTV1||0,h[2][1]=p.DTV2||0,this.lcs.detector={forward:$.extend(!0,[],h),reverse:e.invertMatrix3(h)},this.lcs.detector.reverse?a&&(this.lcs.detector.frot=$.extend(!0,[],a),this.lcs.detector.rrot=$.extend(!0,[],n),this.lcs.detector.cx=g-h[2][0]-1,this.lcs.detector.cy=v-h[2][1]-1):delete this.lcs.detector,h[0][0]=e.defNull(p.ATM1_1,1),h[1][0]=p.ATM2_1||0,h[0][1]=p.ATM1_2||0,h[1][1]=e.defNull(p.ATM2_2,1),h[2][0]=p.ATV1||0,h[2][1]=p.ATV2||0,this.lcs.amplifier={forward:$.extend(!0,[],h),reverse:e.invertMatrix3(h)},this.lcs.amplifier.reverse?a&&(this.lcs.amplifier.frot=$.extend(!0,[],a),this.lcs.amplifier.rrot=$.extend(!0,[],n),this.lcs.amplifier.cx=g-h[2][0]-1,this.lcs.amplifier.cy=v-h[2][1]-1):delete this.lcs.amplifier,this.params&&!this.lcs[this.params.lcs]&&(this.params.lcs="image"),this.params&&!this.params.wcssys0&&(this.setWCSSys("physical"),this.params.wcssys0=this.params.lcs),this.lcs.physical&&!this.lcs.ophysical&&(this.lcs.ophysical=$.extend(!0,{},this.lcs.physical)),this},e.Image.prototype.mkRawDataFromHDU=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C,I=0,L=0;if(s=s||{},$.isArray(t)||e.isTypedArray(t)||t instanceof ArrayBuffer?($.isArray(t[0])&&(t=t.reduce((D,O)=>D.concat(O))),c={image:t}):"object"==typeof t?c=t:e.error("unknown or missing input for HDU creation"),c.data&&!c.image&&(c.image=c.data),c.image||e.error(`data missing from JS9 FITS object: ${JSON.stringify(c)}`),c.naxis<2&&e.error("can't image a FITS file with less than 2 dimensions"),this.raw&&(f=this.raw,m=this.raw.width,b=this.raw.height,w=this.raw.bitpix,A=this.params.wcssys,x=this.params.wcsunits,this.freeWCS()),this.raws=this.raws||[],g=this.raws.length,g){for(s.rawid=s.rawid||e.RAWIDX,p=0,o=0;o<g;o++)if(s.rawid===this.raws[o].id){n=this.raws[o].from,this.raws[o]={from:n,id:s.rawid},this.raw=this.raws[o],p++;break}p||(this.raws.push({from:"hdu",id:s.rawid}),this.raw=this.raws[g],f=null)}else this.raws.push({from:"hdu"}),this.raw=this.raws[g],this.raw.id=e.RAWID0;if(this.raw.hdu=c,c.axis?(this.raw.width=c.axis[1],this.raw.height=c.axis[2]):c.naxis1&&c.naxis2?(this.raw.width=c.naxis1,this.raw.height=c.naxis2):m&&b&&(this.raw.width=m,this.raw.height=b),c.bitpix?this.raw.bitpix=c.bitpix:w&&(this.raw.bitpix=w),"base64"===c.encoding)for(n=window.atob(c.image),c.image=new ArrayBuffer(n.length),a=new Uint8Array(c.image),o=0;o<n.length;o++)a[o]=n.charCodeAt(o);switch($.isArray(c.image[0])&&(c.image=c.image.reduce((D,O)=>D.concat(O))),this.raw.bitpix){case 8:this.raw.data=new Uint8Array(c.image);break;case 16:this.raw.data=new Int16Array(c.image);break;case-16:this.raw.data=new Uint16Array(c.image);break;case 32:this.raw.data=new Int32Array(c.image);break;case-32:this.raw.data=new Float32Array(c.image);break;case-64:this.raw.data=new Float64Array(c.image);break;default:e.error(`unsupported bitpix: ${this.raw.bitpix}`)}if(this.raw.card=c.card,this.raw.cardstr=c.cardstr,this.raw.ncard=c.ncard,c.head)this.raw.header=c.head;else if(this.raw.card)for(this.raw.header={},l=this.raw.card.length,o=0;o<l;o++)d=e.cardpars(this.raw.card[o]),void 0!==d&&("HISTORY"===d[0]?this.raw.header[`${d[0]}__${I++}`]=d[1]:"COMMENT"===d[0]?this.raw.header[`${d[0]}__${L++}`]=d[1]:this.raw.header[d[0]]=d[1]);else if(this.raw.cardstr)for(this.raw.header={},l=this.raw.ncard,o=0;o<l;o++)h=this.raw.cardstr.slice(80*o,80*(o+1)),d=e.cardpars(h),void 0!==d&&("HISTORY"===d[0]?this.raw.header[`${d[0]}__${I++}`]=d[1]:"COMMENT"===d[0]?this.raw.header[`${d[0]}__${L++}`]=d[1]:this.raw.header[d[0]]=d[1]);else this.raw.header={},this.raw.header.SIMPLE=!0,this.raw.header.NAXIS=2,this.raw.header.NAXIS1=this.raw.width,this.raw.header.NAXIS2=this.raw.height,this.raw.header.BITPIX=this.raw.bitpix;if(y=this.raw.header,!f&&!this.parentFile&&!this.parent&&(void 0!==y.LTV1||void 0!==y.LTV2||void 0!==y.LTM1_1||void 0!==y.LTM2_2)&&(this.parent={},this.parent.raw={header:$.extend(!0,{},y)},this.parent.lcs={},e.Image.prototype.initLCS.call(this.parent,this.parent.raw.header)),("image"===c.imtab&&void 0!==c.x1&&1!==c.x1||void 0!==c.y1&&1!==c.y1||void 0===c.bin||1!==c.bin)&&(S=e.defNull(c.x1,1),_=e.defNull(c.y1,1),C=c.bin||1,C<0&&(C=1/Math.abs(C)),e.notNull(y.NAXIS1)&&(y.NAXIS1/=C),e.notNull(y.NAXIS2)&&(y.NAXIS2/=C),e.notNull(y.CRPIX1)&&(y.CRPIX1=(y.CRPIX1+1-S-.5)/C+.5),e.notNull(y.CRPIX2)&&(y.CRPIX2=(y.CRPIX2+1-_-.5)/C+.5),e.notNull(y.CDELT1)&&(y.CDELT1*=C),e.notNull(y.CDELT2)&&(y.CDELT2*=C),e.notNull(y.CD1_1)&&(y.CD1_1*=C),e.notNull(y.CD1_2)&&(y.CD1_2*=C),e.notNull(y.CD2_1)&&(y.CD2_1*=C),e.notNull(y.CD2_2)&&(y.CD2_2*=C),y.LTM1_1=e.defNull(y.LTM1_1,1),y.LTM1_1=y.LTM1_1/C,y.LTM2_1=y.LTM2_1||0,y.LTM2_1=y.LTM2_1/C,y.LTM1_2=y.LTM1_2||0,y.LTM1_2=y.LTM1_2/C,y.LTM2_2=e.defNull(y.LTM2_2,1),y.LTM2_2=y.LTM2_2/C,y.LTV1=y.LTV1||0,y.LTV1=(y.LTV1-S)/C+.5,y.LTV2=y.LTV2||0,y.LTV2=(y.LTV2-_)/C+.5),s.lcsUseRota2&&(y.LCSROTA2=!0),s.file&&s.file!==this.file?(this.file=s.file,this.id=null):s.filename&&s.filename!==this.file?(this.file=s.filename,this.id=null):c.file&&c.file!==this.file&&(this.file=c.file,this.id=null),this.file=e.cleanPath(this.file)||e.ANON+e.uniqueID(),this.file0=this.file,s.id&&(this.id0=s.id,this.id=e.getImageID(s.id,this.display.id,this)),!this.id&&this.file&&!this.file.match(/\[.*[^a-zA-Z0-9_].*\]/)&&(s.extname||s.extnum?(s.extname?(this.file=this.file.replace(/\[.*\]/,""),this.file+=`[${s.extname}]`):s.extnum&&s.extnum>0&&(this.file=this.file.replace(/\[.*\]/,""),this.file+=`[${s.extnum}]`),c.fits&&(s.extname&&(c.fits.extname=s.extname),s.extnum&&s.extnum>0&&(c.fits.extnum=s.extnum))):c.fits?c.fits.extname?(this.file=this.file.replace(/\[.*\]/,""),this.file+=`[${c.fits.extname}]`):c.fits.extnum&&c.fits.extnum>0&&(this.file=this.file.replace(/\[.*\]/,""),this.file+=`[${c.fits.extnum}]`):this.raw.header&&this.raw.header.EXTNAME&&(this.file=this.file.replace(/\[.*\]/,""),this.file+=`[${this.raw.header.EXTNAME}]`)),this.id||(this.id0=(this.parentFile||this.file).split("/").reverse()[0],this.id=e.getImageID(this.id0,this.display.id,this)),s.proxyFile&&(this.proxyFile=s.proxyFile),this.raw.filter=s.filter||"",this.raw.columns=s.columns||"",this.imtab=c.imtab?c.imtab:c.table?"table":"image",this.raw.imtab=this.imtab,void 0!==c.dmin&&void 0!==c.dmax?this.dataminmax(c.dmin,c.dmax):this.dataminmax(),this.object=this.raw.header.OBJECT,this.telescope=this.raw.header.TELESCOP,this.instrument=this.raw.header.INSTRUME,s.binstr)try{n=s.binstr.split(/\s+/),n&&2===n.length&&("table"===this.imtab&&c.table?(c.table.bin=parseFloat(n[0]),c.table.binMode=n[1]):(c.bin=parseFloat(n[0]),c.binMode=n[1]))}catch{}this.binning.bin="table"===this.imtab&&c.table?c.table.bin||1:c.bin?c.bin>0?c.bin:1/Math.abs(c.bin):1,f||(this.binning.obin=this.binning.bin),A&&this.setWCSSys(A),x&&this.setWCSUnits(x),f&&f.header.CTYPE1&&f.header.CTYPE2&&this.raw.header.CTYPE1&&this.raw.header.CTYPE2&&(f.header.CTYPE1!==this.raw.header.CTYPE1||f.header.CTYPE2!==this.raw.header.CTYPE2)&&this.initWCS(),e.notNull(c.offscreen)&&(this.png={image:c.offscreen},this.mkOffScreenCanvas()),this.initWCS(),this.initLCS();try{if(s.hdus)this.hdus=s.hdus;else if(this.parentFile&&e.helper.connected&&e.helper.js9helper)t={id:this.expandMacro("$id"),cmd:this.expandMacro("js9Xeq listhdus $filename"),image:this.file,fits:this.parentFile,rtype:"text"},e.helper.send("listhdus",t,D=>{if(!D.stderr&&!D.errcode&&D.stdout)try{this.hdus=JSON.parse(D.stdout)}catch{this.hdus=null}});else if(this.raw.hdu&&this.raw.hdu.fits&&(n=e.listhdu(this.raw.hdu.fits.vfile),n))try{this.hdus=JSON.parse(n)}catch{this.hdus=null}}catch{}if(this.raw.hdu&&this.raw.hdu.fits&&this.raw.hdu.fits.vfile){for(n=e.globalOpts.clearImageMemory,n=!1===n?["never"]:!0===n?["always"]:n.toLowerCase().split(/[,>]/),v=!1,u=!1,o=0,r=!1;o<n.length&&!r;o++)switch(n[o]){case"never":v=!1,r=!0;break;case"always":v=!0,r=!0;break;case"heap":u=!0;break;case"auto":this.raw.header.NAXIS<=2&&(!this.hdus||1===this.hdus.length)?v=!0:(v=!1,r=!0);break;case"nocube":this.raw.header.NAXIS<=2?v=!0:(v=!1,r=!0);break;case"noext":this.hdus&&1!==this.hdus.length?(v=!1,r=!0):v=!0;break;case"size":n[o+1]&&e.vsize(c.fits.vfile)>1e6*n[o+1]?v=!0:(v=!1,r=!0)}v?(e.DEBUG>2&&e.log("removing underlying FITS vfile for %s: %s",this.id,this.raw.hdu.fits.vfile),e.cleanupFITSFile(this.raw,!0)):u&&(e.DEBUG>2&&e.log("freeing heap space for %s: %s",this.id,this.raw.hdu.fits.vfile),e.cleanupFITSFile(this.raw,!1))}return this.xeqPlugins("image","onrawdata"),this},e.Image.prototype.mkSection=function(...t){let s,o;const n=this.rgb.sect,a=c=>{let d,h=this.display.canvas;return this.params.transformAngle?(d=Math.max(h.width,h.height),Math.min(this.raw.width*c,d)):Math.min(this.raw.width*c,h.width)},l=c=>{let d,h=this.display.canvas;return this.params.transformAngle?(d=Math.max(h.width,h.height),Math.min(this.raw.height*c,d)):Math.min(this.raw.height*c,h.height)};switch(n.ozoom=n.zoom,t.length){case 0:n.xcen=Math.floor(this.raw.width/2),n.ycen=Math.floor(this.raw.height/2),n.width=a(1),n.height=l(1);break;case 1:e.isNumber(t[0])||e.error(`invalid input for generating section: ${t[0]}`),n.zoom=parseFloat(t[0]),n.width=a(n.zoom),n.height=l(n.zoom);break;case 2:(!e.isNumber(t[0])||!e.isNumber(t[1]))&&e.error(`invalid input for generating section: ${t[0]} ${t[1]}`),n.xcen=parseFloat(t[0]),n.ycen=parseFloat(t[1]),e.notNull(n.ix)&&(n.width=a(n.zoom)),e.notNull(n.iy)&&(n.height=l(n.zoom));break;case 3:(!e.isNumber(t[0])||!e.isNumber(t[1])||!e.isNumber(t[2]))&&e.error(`invalid input for generating section: ${t[0]} ${t[1]} ${t[2]}`),n.xcen=parseFloat(t[0]),n.ycen=parseFloat(t[1]),n.zoom=parseFloat(t[2]),n.width=a(n.zoom),n.height=l(n.zoom)}return delete n.ix,delete n.iy,n.x0=n.xcen-n.width/(2*n.zoom),n.y0=n.ycen-n.height/(2*n.zoom),n.x1=n.xcen+n.width/(2*n.zoom),n.y1=n.ycen+n.height/(2*n.zoom),n.x0<0&&(e.globalOpts.panWithinDisplay?n.x1-=n.x0:n.ix=n.x0*n.zoom,n.x0=0),n.y0<0&&(e.globalOpts.panWithinDisplay?n.y1-=n.y0:n.iy=n.y0*n.zoom,n.y0=0),n.x1>this.raw.width&&(e.globalOpts.panWithinDisplay?n.x0-=n.x1-this.raw.width:n.ix=(n.x1-this.raw.width)*n.zoom,n.x1=this.raw.width),n.y1>this.raw.height&&(e.globalOpts.panWithinDisplay?n.y0-=n.y1-this.raw.height:n.iy=(n.y1-this.raw.height)*n.zoom,n.y1=this.raw.height),n.ix>0&&n.x0>0&&(o=Math.min(n.ix,n.x0),n.x0-=o,n.ix+=o*n.zoom),n.ix<0&&n.x1<this.raw.width&&(o=Math.min(this.raw.width-n.x1,Math.abs(n.ix)),n.x1+=o,n.ix-=o*n.zoom),n.iy>0&&n.y0>0&&(o=Math.min(n.iy,n.y0),n.y0-=o,n.iy+=o*n.zoom),n.iy<0&&n.y1<this.raw.height&&(o=Math.min(this.raw.height-n.y1,Math.abs(n.iy)),n.y1+=o,n.iy-=o*n.zoom),n.x0=Math.max(0,n.x0),n.x1=Math.min(this.raw.width,n.x1),n.y0=Math.max(0,n.y0),n.y1=Math.min(this.raw.height,n.y1),n.x0=Math.floor(n.x0),n.y0=Math.floor(n.y0),n.x1=Math.floor(n.x1),n.y1=Math.floor(n.y1),n.width=Math.ceil((n.x1-n.x0)*n.zoom),n.height=Math.ceil((n.y1-n.y0)*n.zoom),(n.width<=0||n.height<=0)&&(s=sprintf("invalid image section: %s,%s [%s,%s, %s,%s, %s]",n.width,n.height,n.x0,n.y0,n.x1,n.y1,n.zoom),e.error(s)),this.params.zoom=n.zoom,this},e.Image.prototype.mkColorData=function(){let t,s,o,n;const a=e.SCALESIZE,c=this.params.scalemin,d=this.params.scalemax,h=this.raw.width*this.raw.height,g=(a-1)/(d-c);if("static"===this.cmapObj.type)return this;for((!this.colorData||this.colorData.length<h)&&(this.colorData=new Int32Array(h)),o=this.raw.data,n=this.colorData,t=0;t<h;t++)s=o[t],n[t]=s<=c?0:s>=d?a-1:Math.floor((s-c)*g+.5);return this},e.Image.prototype.calcContrastBias=function(t){let s,o,n=this.params.bias;const a=e.COLORSIZE,l=this.params.contrast;return n-.5<1e-4&&l-1<1e-4?t:(this.params.invert&&(n=1-n),s=Math.floor(((t/a-n)*l+.5)*a),o=s<0?0:s>=a?a-1:s,o)},e.Image.prototype.mkColorCells=function(){let t,s,o;const n=e.COLORSIZE;if("static"===this.cmapObj.type)return this;for(this.colorCells||(this.colorCells=[]),t=0;t<n;t++)s=this.params.invert?n-t-1:t,o=this.calcContrastBias(s),this.colorCells[t]=this.cmapObj.mkColorCell(o);return this},e.Image.prototype.mkScaledCells=function(){let t,s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A;const x=e.COLORSIZE,y=e.SCALESIZE,S=e.INVSIZE,_=e.HISTSIZE;if(!this.colorCells)return this;if("static"===this.cmapObj.type)return this;switch(this.psColors||(this.psColors=[],this.psColors.NaN=(I=>{let L,D,O,M;const E="0123456789ABCDEF",R=[];for("#"===I.charAt(0)&&(I=I.slice(1)),I=I.toUpperCase(),L=0,D=0;L<6;L+=2,D++)O=E.indexOf(I.charAt(L)),M=E.indexOf(I.charAt(L+1)),R[D]=16*O+M;return R})(this.params.nancolor)),this.psInverse||(this.psInverse=[],this.psInverse.NaN=0),s=this.params.scalemax-this.params.scalemin,c=this.params.scalemin,this.params.scale){case"linear":for(o=0;o<y;o++)t=o/y,a=Math.floor(t*x),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++)t=o/S,this.psInverse[o]=t*s+c;break;case"log":for(l=this.params.exp,o=0;o<y;o++)t=Math.log(l*o/y+1)/Math.log(l),a=Math.floor(t*x),a>=x&&(a=x-1),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++)t=(Math.pow(l,o/S)-1)/l,this.psInverse[o]=t*s+c;break;case"power":for(l=this.params.exp,o=0;o<y;o++)t=(Math.pow(l,o/y)-1)/l,a=Math.floor(t*x),a>=x&&(a=x-1),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++)t=Math.log(l*o/S+1)/Math.log(l),this.psInverse[o]=t*s+c;break;case"sqrt":for(o=0;o<y;o++)t=o/y,a=Math.floor(Math.sqrt(t)*x),a>=x&&(a=x-1),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++)t=o/S,this.psInverse[o]=t*t*s+c;break;case"squared":for(o=0;o<y;o++)t=o/y,a=Math.floor(t*t*x),a>=x&&(a=x-1),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++)t=Math.sqrt(o/S),this.psInverse[o]=t*s+c;break;case"asinh":for(o=0;o<y;o++)t=o/y,a=Math.floor(Math.asinh(10*t)/3*x),a>=x&&(a=x-1),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++)t=o/S,a=Math.sinh(3*t)/10,this.psInverse[o]=a*s+c;break;case"sinh":for(o=0;o<y;o++)t=o/y,a=Math.floor(Math.sinh(3*t)/10*x),a>=x&&(a=x-1),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++)t=o/S,a=Math.asinh(10*t)/3,this.psInverse[o]=a*s+c;break;case"histeq":if(g=this.raw.data,v=this.raw.width*this.raw.height,r=this.raw.dmax-this.raw.dmin,w=this.raw.dmax,b=this.raw.dmin,u=0,f=0,A=[],!this.hist||!this.hist.length){for(this.hist=[],o=0;o<_;o++)A[o]=0;for(o=0;o<v;o++)g[o]>=b&&g[o]<=w&&(n=Math.floor((g[o]-b)/r*_+.5),n<_&&(A[n]+=1));for(o=0;o<_;o++)f+=A[o];for(h=f/_,p=0,o=0;o<_&&p<_;o++)for(this.hist[o]=p/_,u+=A[o];u>=h&&p<_;)u-=h,p++;for(m=(_-1)/_;o<_;)this.hist[o++]=m}for(o=0;o<y;o++)t=this.hist[o*_/y],a=Math.floor(t*x),this.psColors[o]=this.colorCells[a];for(o=0;o<S;o++){for(d=o/S,n=0;n<_-1&&!(this.hist[n]>d);n++);t=n/_,this.psInverse[o]=t*r+b}break;default:e.error(`unknown scale '${this.params.scale}'`)}return this},e.Image.prototype.mkRGBImage=function(){let t,s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C,I,L,D,O,M,E,R,H,N,B,P,z,J,q,G,ee,le,Q=!1,de=null,xe=null,ce=null,he=!1,Pe=!1,Se=!1,Y=!1,ie=[];if(!this.rgb)return this;if(this.display.rgb.active&&(this===this.display.rgb.rim||this===this.display.rgb.gim||this===this.display.rgb.bim)&&(he=!0,this.display.rgb.rim&&(de=this.display.rgb.rim),this.display.rgb.gim&&(xe=this.display.rgb.gim),this.display.rgb.bim&&(ce=this.display.rgb.bim)),h=this.display.context,t=this.rgb,s=t.sect,this.MakeRGBImage&&"function"==typeof this.MakeRGBImage&&this.MakeRGBImage())return this;if(this.MakePrimaryImage&&"function"==typeof this.MakePrimaryImage&&this.MakePrimaryImage())return this;if(this.useOffScreenCanvas()){if(l=s.width/s.zoom,c=s.height/s.zoom,n=s.x0,a=this.offscreen.canvas.height-1-(s.y0+c),d=this.offscreen.context.getImageData(n,a,l,c),1===s.zoom)t.img=d;else{for(t.img=h.createImageData(s.width,s.height),o=t.img,S=0,r=0,f=0;r<d.height;r++,f++)for(M=r*d.width,b=f*s.zoom,v=0,u=0;v<d.width;v++,u++)for(y=4*(M+v),m=u*s.zoom,w=0;w<s.zoom;w++)for(R=Math.floor(b+w),H=R*s.width,A=0;A<s.zoom;A++)E=Math.floor(m+A),S=4*(H+E),o.data[S]=d.data[y],o.data[S+1]=d.data[y+1],o.data[S+2]=d.data[y+2],o.data[S+3]=d.data[y+3];d=null}return this}if((!t.img||t.img.width!==s.width||t.img.height!==s.height)&&(t.img=h.createImageData(s.width,s.height)),o=t.img,_=o.data.length-4,!this.psColors&&!this.staticObj)return this;for(z=void 0!==this.params.opacity?Math.floor(255*this.params.opacity):void 0!==this.params.alpha?this.params.alpha:255,this.mask.active&&this.mask.im?(D=this.mask.im,"mask"===this.mask.mode?(Pe=!0,J=e.notNull(this.mask.vopacity)?255*this.mask.vopacity:0,q=e.notNull(this.params.opacity)?255*this.params.opacity:255,this.mask.invert&&(z=J,J=q,q=z)):"opacity"===this.mask.mode?Se=!0:"overlay"===this.mask.mode&&(Y=!0,O=D.rgb.img,e.isNull(this.mask.opacity)&&(this.mask.opacity=1))):e.notNull(this.params.flooropacity)&&!he&&(G=255*this.params.flooropacity,ee=this.params.floorvalue,Q=!0),S=0,p=Math.max(1,Math.floor(1/s.zoom)),g=s.zoom*p,r=Math.floor(s.y1-1),f=0;r>=s.y0;r-=p,f++)for(M=r*this.raw.width,b=f*g,v=Math.floor(s.x0),u=0;v<s.x1;v+=p,u++){if(Pe?z=D.raw.data[M+v]>this.mask.value?q:J:Se&&(z=255*D.raw.data[M+v]),he){if(C=de?de.colorData[M+v]:0,I=xe?xe.colorData[M+v]:0,L=ce?ce.colorData[M+v]:0,e.isNull(C)||e.isNull(I)||e.isNull(L))return this.display.rgb.active=!1,e.error("RGB images are incompatible. Turning off RGB mode.","",!1),this.mkRGBImage(),this}else this.staticObj||(y=this.colorData[M+v]);for(le=z,Q&&this.raw.data[M+v]<=ee&&(le=G),m=u*g,w=0;w<s.zoom;w++)for(R=Math.ceil(b+w),H=R*s.width,A=0;A<s.zoom;A++)E=Math.ceil(m+A),S=4*(H+E),S<=_&&(he?(o.data[S]=de?de.psColors[C][0]:0,o.data[S+1]=xe?xe.psColors[I][1]:0,o.data[S+2]=ce?ce.psColors[L][2]:0,o.data[S+3]=z):this.staticObj?(P=this.raw.data[M+v],x=e.lookupStaticColor(this,P,ie),o.data[S]=x.red,o.data[S+1]=x.green,o.data[S+2]=x.blue,o.data[S+3]=x.alpha):void 0!==this.psColors[y]&&(Y&&O.data[S+3]?(N=this.mask.opacity*(O.data[S+3]/255),B=1-N,o.data[S]=O.data[S]*N+this.psColors[y][0]*B,o.data[S+1]=O.data[S+1]*N+this.psColors[y][1]*B,o.data[S+2]=O.data[S+2]*N+this.psColors[y][2]*B,o.data[S+3]=255):(o.data[S]=this.psColors[y][0],o.data[S+1]=this.psColors[y][1],o.data[S+2]=this.psColors[y][2],o.data[S+3]=le)))}return this},e.Image.prototype.blendImage=function(...t){let[s,o,n]=t;return 0===t.length?this.blend:!0===s||!1===s||"true"===s||"false"===s?("true"===s?s=!0:"false"===s&&(s=!1),this.blend.active=s,this.xeqPlugins("image","onimageblend"),this.display.blendMode&&this.displayImage(),this):((e.notNull(s)||e.notNull(o))&&(e.notNull(s)&&(/normal|multiply|screen|overlay|darken|lighten|color-dodge|color-burn|hard-light|soft-light|difference|exclusion|hue|saturation|color|luminosity|clear|copy|source-over|destination-over|source-in|destination-in|source-out|destination-out|source-atop|destination-atop|xor|lighter/i.test(s)||e.error(`invalid composite/blend operation: ${s}`),this.blend.mode=s),e.notNull(o)&&("string"==typeof o?o=parseFloat(o):"number"!=typeof o&&e.error(`invalid opacity: ${o}`),this.blend.opacity=Math.min(Math.max(o,0),1)),e.notNull(n)&&("true"===n?n=!0:"false"===n&&(n=!1),this.blend.active=n),this.xeqPlugins("image","onimageblend"),this.display.blendMode&&this.blend.active&&this.displayImage()),this)},e.Image.prototype.maskImage=function(...t){let n,a,[s,o]=t;if(!t.length)return this.mask;if(!0===s||!1===s||"true"===s||"false"===s)return"true"===s?s=!0:"false"===s&&(s=!1),this.mask.active=s,this.xeqPlugins("image","onimagemask"),this.displayImage(),this;if("string"==typeof s&&"{"===s.charAt(0))try{s=JSON.parse(s)}catch(l){e.error(`can't parse JSON in maskImage: ${s}`,l)}if(!e.isImage(s)&&!o&&(o=s,s=null),s&&(n=e.lookupImage(s),n||e.error(`unknown image for maskImage: ${s}`),(this.raw.width!==n.raw.width||this.raw.height!==n.raw.height)&&e.error(`maskImage: mask dims (${n.raw.width},${n.raw.height}) don't match image dims (${this.raw.width},${this.raw.height})`),this.mask.im=n,this.mask.active=!0),o){if("string"==typeof o)try{o=JSON.parse(o)}catch(l){e.error(`can't parse JSON in maskImage: ${o}`,l)}for(a of Object.keys(o))"opacity"===a?this.mask.vopacity=o[a]:this.mask[a]=o[a]}n&&(!o||!1!==o.sync)&&"function"==typeof this.syncImages&&this.syncImages(this.mask.syncops,[n]),(n||o)&&this.displayImage()},e.Image.prototype.calcDisplayOffsets=function(t){let s,o,n,a;const l=this.rgb.sect;return this.ix=(this.display.canvas.width-this.rgb.img.width)/2,this.iy=(this.display.canvas.height-this.rgb.img.height)/2,e.notNull(l.ix)&&(this.ix-=l.ix/2),e.notNull(l.iy)&&(this.iy+=l.iy/2),this.ix=Math.floor(this.ix),this.iy=Math.floor(this.iy),t&&this.wcsAlign()&&(s=this.wcsim,o=s.rgb.sect,n=e.pix2pix(s,this,s.getPan()),a=e.globalOpts.panWithinDisplay,e.globalOpts.panWithinDisplay=!0,this.tmp.ozoom=this.rgb.sect.ozoom,this.mkSection(n.x,n.y,o.zoom),this.rgb.sect.ozoom=this.tmp.ozoom,delete this.tmp.ozoom,e.globalOpts.panWithinDisplay=a,this.ix-=(l.xcen-(l.x0+l.x1)/2)*o.zoom,this.iy+=(l.ycen-(l.y0+l.y1)/2)*o.zoom),this},e.Image.prototype.putImage=function(t){let s,o,n;const a=this.rgb,c=this.display.context;return t=t||{},"reproject"===this.rawDataLayer()&&t.wcsim&&(this.wcsim=t.wcsim,this.wcsim.isawcsim=!0),this.calcDisplayOffsets(!0),c.save(),void 0!==t.opacity&&(c.globalAlpha=t.opacity),void 0!==t.blend&&(c.globalCompositeOperation=t.blend),this.params.transform&&(s=this.params.transform,o=this.display.width/2,n=this.display.height/2,c.translate(o,n),c.transform(s[0][0],s[0][1],s[1][0],s[1][1],s[2][0],s[2][1]),c.translate(-o,-n)),c.drawImage((h=>{let p,g;return this.offscreenRGB||(g=document.createElement("canvas"),p=g.getContext("2d"),e.ANTIALIAS||(p.imageSmoothingEnabled=!1),this.offscreenRGB={canvas:g,context:p}),this.offscreenRGB.canvas.width=h.width,this.offscreenRGB.canvas.height=h.height,this.offscreenRGB.context.putImageData(h,0,0),this.offscreenRGB.canvas})(a.img),this.ix,this.iy),c.restore(),this},e.Image.prototype.displayImage=function(t,s){let o,n,a,l,c=0;const h=[],p={};if(!1===t)return this.displayMode=!1,this;if(!0===t&&(this.displayMode=!0,t="all"),!this.displayMode)return this;if("object"==typeof t&&(s=t,t=null),t?"all"===t?(t="colors,scaled,rgb,display,plugins",p.notify=!0):"rgbonly"===t?(t="rgb,nodisplay",p.notify=!0):"display"===t&&(p.notify=!0):t="rgb",t.split(",").forEach((v,r,u)=>{const f=v.trim();switch(p[f]=!0,f){case"colors":p.scaled=!0,p.rgb=!0;break;case"scaled":p.rgb=!0}}),p.display=!0,p.plugins=!0,this.useOffScreenCanvas()&&(p.colors=!1,p.scaled=!1),"string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(v){e.error(`can't parse displayImage opts: ${s}`,v)}if(this.display.blendMode&&!1!==s.blendMode)for(o=0;o<e.images.length;o++)n=e.images[o],n.display===this.display&&n.blend.active&&(h.push(n),c++);if(p.colors&&this.mkColorData(),p.scaled&&(this.mkColorCells(),this.mkScaledCells()),p.rgb&&(this.mkRGBImage(),c))for(o=h.length-1;o>=0;o--)n=h[o],n.mkRGBImage();if(p.nodisplay)return this;if(p.display){if(this.display.context.clear(),c){for(o=h.length-1;o>=0;o--)h[o].calcDisplayOffsets(!1);for(o=h.length-1;o>=0;o--)n=h[o],a={wcsim:s.wcsim,blend:n.blend.mode,opacity:n.blend.opacity},n.putImage(a),n===this&&n.displayShapeLayers()}else this.putImage(s),this.displayShapeLayers();for(this.display.image=this;this.delayedShapes&&this.delayedShapes.length;){switch(this.tmp.syncRunning=!0,l=this.delayedShapes.shift(),l.mode){case"add":this.addShapes(l.layer,l.shape,l.opts);break;case"change":this.changeShapes(l.layer,l.shape,l.opts)}delete this.tmp.syncRunning}delete this.delayedShapes}return this.xeqPlugins("image","onimagedisplay"),this},e.Image.prototype.refreshImage=function(t,s){let o,n,a,l,c,d,h,p;if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(g){e.error(`can't parse refreshImage opts: ${s}`,g)}if(!t||"string"==typeof t)return s.onrefresh&&(s.onload=s.onrefresh,delete s.onrefresh),s.refresh=this,o=document.domain?t||this.file:t||this.fitsFile||this.file,void e.Load(o,s,{display:this.display});if(s.rawid=s.rawid||e.RAWID0,"function"==typeof s&&(p=s,s={onrefresh:p}),!s.onrefresh&&e.imageOpts.onrefresh&&(s.onrefresh=e.imageOpts.onrefresh),s.resetSection||(d=this.imageToLogicalPos({x:this.rgb.sect.xcen,y:this.rgb.sect.ycen}),this.validWCS()&&(o=e.pix2wcs(this.raw.wcs,this.rgb.sect.xcen,this.rgb.sect.ycen),n=o.trim().split(/\s+/),l=e.saostrtod(n[0]),e.isHMS(this.params.wcssys)&&(l*=15),c=e.saostrtod(n[1]))),a=this.rgb.sect.zoom,this.binning.obin=this.binning.bin,this.mkRawDataFromHDU(t,s),s.resetSection?(this.mkSection(),this.mkSection(a)):(this.validWCS()&&e.notNull(l)&&e.notNull(c)?(n=e.wcs2pix(this.raw.wcs,l,c).trim().split(/ +/),h={x:parseFloat(n[0]),y:parseFloat(n[1])}):h=this.logicalToImagePos({x:d.x,y:d.y}),h.x>0&&h.x<this.raw.width&&h.y>0&&h.y<this.raw.height?this.mkSection(h.x,h.y,a):(this.mkSection(),this.mkSection(a))),this.displayImage("colors",s),this.reFlipRot(),this.notifyHelper(),(s.refreshRegions||s.resetSection||this.binning.obin!==this.binning.bin)&&(this.refreshLayers(),this.updateShapes("regions","all","binning")),this.xeqPlugins("image","onimagerefresh"),e.waiting(!1),s.onrefresh)try{e.xeqByName(s.onrefresh,window,this)}catch(g){e.error("in image refresh callback",g)}return this},e.Image.prototype.fileDimensions=function(){let t,s;return this.parent&&"BINTABLE"!==this.parent.raw.header.XTENSION?(t=this.parent.raw.header.TABDIM1?this.parent.raw.header.TABDIM1:this.parent.raw.header.NAXIS1,s=this.parent.raw.header.TABDIM2?this.parent.raw.header.TABDIM2:this.parent.raw.header.NAXIS2):(t=this.raw.header.TABDIM1?this.raw.header.TABDIM1:this.raw.header.NAXIS1,s=this.raw.header.TABDIM2?this.raw.header.TABDIM2:this.raw.header.NAXIS2),{xdim:t,ydim:s}},e.Image.prototype.maybePhysicalToImage=function(t){let s,o,n;return"image"===this.imtab&&this.parent&&this.parent.lcs&&t.x&&t.y&&(s={x:t.x,y:t.y},o=e.Image.prototype.logicalToImagePos.call(this.parent,s,"ophysical"),n={x:Math.floor(o.x+.5),y:Math.floor(o.y+.5)}),n},e.Image.prototype.displaySection=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m;const b=(x,y,S)=>{let _;return e.isNull(x)?e.isNull(y)||(_=y):_=x,_||S},w=x=>{let y,S,_,C,I,L,D=0,O=0,M=1e6,E=0,R=1e6,H=0;const N=x.shape;switch(!this.parentFile&&x.lcs?(C=(x=x.lcs).x,I=x.y,L=this.maybePhysicalToImage({x:C,y:I}),L&&(C=L.x,I=L.y)):(C=x.x,I=x.y),N){case"annulus":S=2*x.radii[x.radii.length-1],_=2*x.radii[x.radii.length-1];break;case"box":case"cross":S=x.width,_=x.height;break;case"circle":S=2*x.radius,_=2*x.radius;break;case"ellipse":S=2*x.r1,_=2*x.r2;break;case"polygon":case"line":for(y=0;y<x.pts.length;y++)D+=x.pts[y].x,O+=x.pts[y].y,x.pts[y].x>E&&(E=x.pts[y].x),x.pts[y].x<M&&(M=x.pts[y].x),x.pts[y].y>H&&(H=x.pts[y].y),x.pts[y].y<R&&(R=x.pts[y].y);x.x=D/x.pts.length,x.y=O/x.pts.length,"line"===x.shape&&2===x.pts.length?(S=Math.sqrt((x.pts[0].x-x.pts[1].x)*(x.pts[0].x-x.pts[1].x)+(x.pts[0].y-x.pts[1].y)*(x.pts[0].y-x.pts[1].y)),_=1):(S=E-M,_=H-R);break;case"text":S=10,_=10}return{xcen:C,ycen:I,xdim:S,ydim:_}},A=(x,y)=>{let S,_,C,I="";p=$.extend(!0,{},y||{}),e.isNull(p.refreshRegions)&&(p.refreshRegions=!0),e.isNull(p.resetSection)&&(p.resetSection=!0),!1!==p.waiting&&e.waiting(!0,this.display),x.fits.extname?I=`[${x.fits.extname}]`:x.fits.extnum&&x.fits.extnum>0?I=`[${x.fits.extnum}]`:this.parent&&(this.parent.extname?I=`[${this.parent.extname}]`:this.parent.extnum&&this.parent.extnum>0&&(I=`[${this.parent.extnum}]`)),I&&(p.id||(p.id=this.id.replace(/\[.*\]/,"")+I),p.file||(p.file=this.file.replace(/\[.*\]/,"")+I)),p.separate?(delete p.xcen,delete p.ycen,"string"==typeof p.separate?(1===(C=p.separate.split(":"),C.length)?_=C[0]:(_=C[0],p.id=C[1]),p.display=e.lookupDisplay(_)):p.display=this.display,"parentFile"===l&&this.fitsFile&&(S=e.lookupImage(this.fitsFile),p.parentFile=S&&S.parentFile?S.parentFile:this.fitsFile),d=this.listRegions("all",{mode:1,includedcoords:!0,ignoreignore:!0,saveediting:!0,savewcsconfig:!0,sortids:!1,saveid:!0}),h=new e.Image(x,p,s=p.ondisplaysection||p.onrefresh||s),h.binning.obin=h.binning.bin,d&&!1!==p.refreshRegions&&h.addShapes("regions",d,{restoreid:!0}),this.reFlipRot(),h.setStatus("displaySection","complete")):"string"==typeof p.refresh?(1===(delete p.xcen,delete p.ycen,C=p.refresh.split(":"),C.length)?_=C[0]:(_=C[0],p.id=C[1]),p.display=e.lookupDisplay(_),p.display.image?(p.rawid=this.raw.id,p.onrefresh=p.ondisplaysection||p.onrefresh||s,p.display.image.refreshImage(x,p)):("parentFile"===l&&this.fitsFile&&(S=e.lookupImage(this.fitsFile),p.parentFile=S&&S.parentFile?S.parentFile:this.fitsFile),d=this.listRegions("all",{mode:1,includedcoords:!0,ignoreignore:!0,saveediting:!0,savewcsconfig:!0,sortids:!1,saveid:!0}),h=new e.Image(x,p,s=p.ondisplaysection||p.onrefresh||s),h.binning.obin=h.binning.bin,d&&h.addShapes("regions",d,{restoreid:!0}),this.reFlipRot())):(p.rawid=this.raw.id,p.onrefresh=p.ondisplaysection||p.onrefresh||s,this.refreshImage(x,p)),this.setStatus("displaySection","complete"),e.waiting(!1)};if((!this.raw||!this.raw.hdu||!this.raw.hdu.fits)&&e.error("invalid image for displaySection"),"full"===(t=t||{})){const{xdim:x,ydim:y}=this.fileDimensions();t={xdim:x,ydim:y,xcen:0,ycen:0}}else{if("selected"===t)return void this._selectShapes("regions","selected",null,x=>{p=w(x.pub),p.from="virtualFile",p.separate=!0,p.refreshRegions=!1,p.resetSection=!0,this.displaySection(p,s)});if("string"==typeof t)try{t=JSON.parse(t)}catch(x){e.error(`can't parse displaySection opts: ${t}`,x)}}if(t.cubecol=t.cubecol||"",t.cubecol&&(o=this.file.split("/").reverse()[0].replace(/\[.*\]/,"").replace(".fits",`_cube_${t.cubecol}.fits`).replace(/\.ftz$/,`_cube_${t.cubecol}.fits`).replace(/\.gz$/,"").replace(/\.bz2$/,"").replace(/:/g,"_"),t.file||(t.file=o),t.id||(t.id=o),!1!==t.separate&&(t.separate=!0)),a=t.separate?$.extend(!0,{},this.raw.hdu):this.raw.hdu,l=t.from,l||(l=this.parentFile&&e.helper.connected&&e.helper.js9helper?"parentFile":"virtualFile"),"table"===this.imtab&&a.table?m=a.table:(m={},m.bin=a.bin||1,"parentFile"===l&&this.raw.header&&e.notNull(this.raw.header.LTM1_1)&&(m.bin=1/Math.abs(this.raw.header.LTM1_1)),g={x:this.raw.width/2,y:this.raw.height/2},v=this.imageToLogicalPos(g),m.xcen=Math.floor(v.x+.5*(m.bin-1)),m.ycen=Math.floor(v.y+.5*(m.bin-1)),r=this.maybePhysicalToImage({x:m.xcen,y:m.ycen}),r&&(m.xcen=r.x,m.ycen=r.y),m.xdim=Math.floor(a.naxis1*m.bin),m.ydim=Math.floor(a.naxis2*m.bin),m.filter=this.raw.filter||"",m.columns=this.raw.columns||""),"string"==typeof t.bin)switch(t.bin.match(/[as]$/)&&(t.binMode=t.bin.slice(-1),t.bin=t.bin.slice(0,-1)),u=m.bin||this.binning.bin,t.bin.charAt(0)){case"*":case"x":case"X":t.bin=u*parseFloat(t.bin.slice(1));break;case"/":t.bin=u/parseFloat(t.bin.slice(1));break;case"i":case"I":t.bin=2*u;break;case"o":case"O":t.bin=u/2;break;default:e.isNumber(t.bin)?t.bin=parseFloat(t.bin):e.error(`invalid bin for displaySection: ${t.bin}`)}"table"===(t.xcen=b(t.xcen,m.xcen,0),t.ycen=b(t.ycen,m.ycen,0),this.imtab)?(t.xdim=b(t.xdim,m.xdim,e.fits.options.table.xdim),t.ydim=b(t.ydim,m.ydim,e.fits.options.table.ydim),t.bin=b(t.bin,m.bin,e.fits.options.table.bin)):(t.xdim=b(t.xdim,m.xdim,e.fits.options.image.xdim),t.ydim=b(t.ydim,m.ydim,e.fits.options.image.ydim),t.bin=b(t.bin,m.bin,e.fits.options.image.bin)),t.binMode=b(t.binMode,m.binMode,e.globalOpts.binMode),"string"==typeof t.bin&&(t.bin.match(/[as]$/)&&(t.binMode=t.bin.slice(-1)),t.bin=parseFloat(t.bin)),t.bin||(t.bin=1),"image"===this.imtab&&t.bin>0&&t.bin<1&&(t.bin=1/Math.floor(1/t.bin+.5)),t.filter=b(t.filter,m.filter,""),this.raw.filter=t.filter||"",t.columns=b(t.columns,m.columns,""),this.raw.columns=t.columns||"",!1!==t.waiting&&e.waiting(!0,this.display),this.setStatus("displaySection","processing"),window.setTimeout(()=>{switch(l){case"parentFile":n=this.proxyFile,f=[],f.push({name:"xcen",value:t.xcen}),delete t.xcen,f.push({name:"ycen",value:t.ycen}),delete t.ycen,f.push({name:"xdim",value:t.xdim}),f.push({name:"ydim",value:t.ydim}),void 0!==t.xdim&&(t.xdim=0),void 0!==t.ydim&&(t.ydim=0),t.binMode&&(t.bin=`${t.bin}${t.binMode}`,delete t.binMode),f.push({name:"bin",value:t.bin}),delete t.bin,o=`${t.filter||""}@@${t.cols||""}`,f.push({name:"filter",value:o}),f.push({name:"slice",value:t.slice||""}),delete t.slice,c={id:this.expandMacro("$id"),image:this.file,fits:this.parentFile,rtype:"text"},c.cmd=`js9Xeq imsection ${this.parentFile}`,t.extension&&(c.cmd=c.cmd.replace(/\[.*\]/,""),c.cmd+=`[${t.extension}]`,delete t.extension),c.cmd+=this.expandMacro(" $xdim@$xcen,$ydim@$ycen,$bin $filter $slice",f),e.helper.send("imsection",c,x=>{let y,S,_,C,I;if(y="object"==typeof x?x:x.search(e.analOpts.epattern)>=0?{stderr:x}:{stdout:x},y.stderr)e.error(y.stderr);else if(y.errcode)e.error(`in displaySection: ${y.errcode}`);else{if(_=y.stdout.split(/\n/),C=e.cleanPath(_[0]),"/"!==C.charAt(0)&&(C=e.InstallDir(C)),t.proxyFile=C,n&&n!==t.proxyFile&&this.removeProxyFile(n),_[1]){try{S=JSON.parse(_[1])}catch{e.log("couldn't parse imsection as JSON: %s",C),S=null}S&&(t.extname=S.extname,t.extnum=S.extnum,t.hdus=S.hdus,t.binstr=S.binstr,t.parent=S)}_[2]&&(I=e.cleanPath(_[2]),t.parentFile=I),e.fetchURL(C,C,t,L=>{e.cleanupFITSFile(this.raw,!0),!1!==t.waiting&&e.waiting(!0,this.display),e.fits.handleFITSFile(L,t,A)})}});break;case"virtualFile":e.cleanupFITSFile(this.raw,!1),e.getFITSImage(a.fits,a,t,x=>{A(x,t)});break;default:e.error("image section cannot be extracted from this data file")}},e.SPINOUT)},e.Image.prototype.displayExtension=function(t,s,o){let n,a,l,c,d,h;const p=g=>{let v;const r=$.extend(!0,{},s);if(r.separate=!0,g!==this.hdus.length)v=this.hdus[g],"image"===v.type&&v.naxis>=2?this.displayExtension(v.hdu,r,()=>{p(g+1)}):p(g+1);else if(o)try{e.xeqByName(o,window,this)}catch(u){e.error("in displayExtension callback",u,!1)}};if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(g){e.error(`can't parse displayExtension opts: ${s}`,g)}if(s.waiting=!1,this.hdus||e.error("no FITS HDUs found for displayExtension()"),e.isNull(t)&&e.error("missing extname/extnum for displayExtension()"),"all"!==t){if("string"==typeof t){for(s.extension=t,c=t.toLowerCase(),n=0,l=0;n<this.hdus.length;n++)if(this.hdus[n].name&&this.hdus[n].name.toLowerCase()===c){l++;break}l||e.error(`no FITS HDU ${t} for displayExtension()`)}else"number"==typeof t&&(s.extension=t,this.hdus[t]?c=this.hdus[t].name||t.toString():e.error(`no FITS HDU ${t} for displayExtension()`));if(s.separate){for(a=`[${c}]`,h=this.id.replace(/\[.*\]/,"")+a,n=0,l=0;n<e.images.length;n++)if(d=e.images[n],h===d.id&&$(`#${d.display.id}`).length>0&&this.display.id===d.display.id){l++;break}if(l){if(d.displayImage("display",s),d.display.clearMessage(),o)try{e.xeqByName(o,window,this)}catch(g){e.error("in displayExtension callback",g,!1)}return}}return s.separate||e.cleanupFITSFile(this.raw,!1),this.displaySection(s,o),this}p(0)},e.Image.prototype.displaySlice=function(t,s,o){let n,a,l;if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(c){e.error(`can't parse displaySlice opts: ${s}`,c)}if(s.waiting=!1,e.isNull(t)&&e.error("missing slice for displaySlice()"),3!==this.raw.header.NAXIS&&e.error("3D image required for displaySlice()"),"all"===t)for(n=1;n<=this.raw.header.NAXIS3;n++)a=$.extend(!0,{},s,{separate:!0}),this.displaySlice(n,a,o);else{if(s.slice=e.isNumber(t)?`*:*:${t}`:t,s.separate)for(s.id=sprintf("%s_%s",this.id.replace(/_?([0-9])+:x:x/,"").replace(/_?x:([0-9])+:x/,"").replace(/_?x:x:([0-9])+/,""),s.slice.replace(/\*/g,"x")),n=0;n<e.images.length;n++)if(l=e.images[n],s.id===l.id&&$(`#${l.display.id}`).length>0)return l.displayImage("display",{display:l}),this;e.cleanupFITSFile(this.raw,!1),this.displaySection(s,o)}return this},e.Image.prototype.toArray=function(t){let s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w;if((t=t||{}).simple=!0,d=$.extend(!0,{},this.raw.header),e.notNull(t.sect))for(u=t.sect,d.NAXIS1=u.x1-u.x0,d.NAXIS2=u.y1-u.y0,e.notNull(d.CRPIX1)&&(d.CRPIX1=d.CRPIX1-u.x0),e.notNull(d.CRPIX2)&&(d.CRPIX2=d.CRPIX2-u.y0),e.notNull(d.LTV1)&&(d.LTV1=d.LTV1-u.x0),e.notNull(d.LTV2)&&(d.LTV2=d.LTV2-u.y0),m=Math.abs(this.raw.bitpix/8),f=(u.x1-u.x0)*m,b=f*(u.y1-u.y0),w=new ArrayBuffer(b),r=new Uint8Array(w),s=u.y0,o=0;s<u.y1;s++,o++)e.memcpy(r.buffer,o*f,this.raw.data.buffer,(s*this.raw.width+u.x0)*m,f);else r=this.raw.data.buffer;for(d=e.raw2FITS({header:d},t),h=2880-d.length%2880,2880===h&&(h=0),s=0;s<h;s++)d+=" ";for(h=2880-r.byteLength%2880,2880===h&&(h=0),p=new ArrayBuffer(d.length+r.byteLength+h),g=new Uint8Array(p),s=0;s<d.length;s++)g[s]=d.charCodeAt(s);if(c=new Int8Array(new Int16Array([1]).buffer)[0]>0,c)for(l=d.length,a=Math.abs(this.raw.bitpix)/8,v=new Uint8Array(r),s=0;s<v.byteLength;s+=a)for(o=s+a-1,n=0;n<a;o--,n++)g[l++]=v[o];else g.set(new Uint8Array(r),d.length);for(l=d.length+r.byteLength,s=0;s<h;s++)g[l++]=0;return g},e.Image.prototype.wcsAlign=function(){return this.wcsim&&this.params.wcsalign&&this.display===this.wcsim.display},e.Image.prototype.getPan=function(){const t=this.rgb.sect;let s=(t.x0+t.x1)/2,o=(t.y0+t.y1)/2;return e.notNull(t.ix)&&(s+=t.ix/(2*t.zoom)),e.notNull(t.iy)&&(o+=t.iy/(2*t.zoom)),{x:s,y:o,ox:t.xcen,oy:t.ycen,x0:t.x0,y0:t.y0,x1:t.x1,y1:t.y1,ix:t.ix||0,iy:t.iy||0}},e.Image.prototype.setPan=function(...t){let s,o,n,a,l,c,d,h,p,[g,v]=t;if(!($.inArray("pan",this.params.disable)>=0)){if(0===t.length&&(g=this.raw.width/2,v=this.raw.height/2),1===t.length&&"string"==typeof g)if("mouse"===g&&this.ipos)g=this.ipos.x,v=this.ipos.y;else try{g=JSON.parse(g)}catch(r){e.error(`can't parse setPan JSON: ${g}`,r)}if("object"==typeof g&&(o=g,e.notNull(o.x)&&e.notNull(o.y)&&(g=o.x,v=o.y),e.notNull(o.px)&&e.notNull(o.py)&&(a=this.logicalToImagePos({x:o.px,y:o.py}),g=a.x,v=a.y),"string"==typeof o.wcs&&(d=o.wcs.trim().split(/ +/),o.ra=d[0],o.dec=d[1],d.length>=3&&(o.wcssys=d[2])),this.validWCS()&&e.notNull(o.ra)&&e.notNull(o.dec)&&(o.wcssys&&(l=this.getWCSSys(),c=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(o.wcssys,!1)),"string"==typeof o.ra&&(o.ra=e.saostrtod(o.ra),e.isHMS(this.params.wcssys)&&(o.ra*=15)),"string"==typeof o.dec&&(o.dec=e.saostrtod(o.dec)),d=e.wcs2pix(this.raw.wcs,o.ra,o.dec).trim().split(/ +/),g=parseFloat(d[0]),v=parseFloat(d[1]),l&&(this.setWCSSys(l,!1),e.globalOpts.xeqPlugins=c))),(!e.isNumber(g)||!e.isNumber(v))&&e.error(`invalid input for setPan: ${g} ${v}`),(this.wcsAlign()||this.isawcsim)&&(h=e.globalOpts.panWithinDisplay,e.globalOpts.panWithinDisplay=!0),this.mkSection(g,v),this.wcsAlign()||this.isawcsim){for(s=0;s<e.images.length;s++)n=e.images[s],n!==this&&n.display===this.display&&(n.wcsim===this||this.wcsim===n||n.wcsim&&n.wcsim===this.wcsim)&&(n.params.wcsalign||this.params.wcsalign)&&(p=e.pix2pix(this,n,{x:g,y:v}),n.mkSection(p.x,p.y));e.globalOpts.panWithinDisplay=h}return this.displayImage("rgb"),this.refreshLayers(),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetpan"),this}},e.Image.prototype.getZoom=function(){return this.rgb.sect.zoom},e.Image.prototype.parseZoom=function(t){let s,o,n,a,l,c,d,h,p,g,v;const r=[];switch(o=this.rgb.sect.zoom,typeof t){case"string":switch(t.charAt(0)){case"*":case"x":case"X":n=o*parseFloat(t.slice(1));break;case"/":n=o/parseFloat(t.slice(1));break;case"I":case"i":n=2*o;break;case"O":case"o":n=o/2;break;case"T":case"t":if(this.params.transformAngle){for(d=-this.params.transformAngle,c={x:-this.raw.width/2,y:this.raw.height/2},r[0]=e.rotatePoint(c,d),c={x:this.raw.width/2,y:this.raw.height/2},r[1]=e.rotatePoint(c,d),c={x:-this.raw.width/2,y:-this.raw.height/2},r[2]=e.rotatePoint(c,d),c={x:this.raw.width/2,y:-this.raw.height/2},r[3]=e.rotatePoint(c,d),s=0;s<r.length;s++)(e.isNull(h)||r[s].x<h)&&(h=r[s].x),(e.isNull(p)||r[s].x>p)&&(p=r[s].x),(e.isNull(g)||r[s].y<g)&&(g=r[s].y),(e.isNull(v)||r[s].y>v)&&(v=r[s].y);a=p-h,l=v-g}else a=this.raw.width,l=this.raw.height;n=Math.min(this.display.width/a,this.display.height/l),n=Math.round(1e6*(n+1e-7))/1e6;break;default:n=parseFloat(t)}break;case"number":n=t;break;default:return}return n},e.Image.prototype.setZoom=function(t){let s,o,n,a,l;if(!($.inArray("zoom",this.params.disable)>=0)){if(o=this.parseZoom(t),o||e.error(`invalid input for setZoom: ${t}`),(this.wcsAlign()||this.isawcsim)&&(l=e.globalOpts.panWithinDisplay,e.globalOpts.panWithinDisplay=!0),this.mkSection(o),this.wcsAlign()||this.isawcsim){for(s=0;s<e.images.length;s++)n=e.images[s],n!==this&&n.display===this.display&&(n.wcsim===this||this.wcsim===n||n.wcsim&&n.wcsim===this.wcsim)&&(n.params.wcsalign||this.params.wcsalign)&&(a=e.pix2pix(this,n,this.getPan()),n.mkSection(a.x,a.y,o));e.globalOpts.panWithinDisplay=l}return this.displayImage("rgb"),this.refreshLayers(),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetzoom"),this}},e.Image.prototype.alignPanZoom=function(t,s){let o,n,a,l,c,d;if(t)return"string"==typeof t&&(o=e.getImage(t),o?t=o:e.error(`unknown image for alignPanZoom: ${t}`)),s=s||{},n=t.getPan(),l=t.rgb.sect.zoom||1,d=e.notNull(s.syncwcs)?s.syncwcs:e.globalOpts.syncWCS,d?(c=this.raw.wcsinfo||{cdelt1:1,crot:0},a=t.raw.wcsinfo||{cdelt1:1,crot:0},this.setPan(e.pix2pix(t,this,{x:n.ox,y:n.oy})),this.setZoom(l*c.cdelt1/a.cdelt1),this.setRotate(a.crot-c.crot)):(this.setPan({x:n.ox,y:n.oy}),this.setZoom(l)),this},e.Image.prototype.getNorthIsUp=function(t){let s,o,n,a,l,c,d,h={},p={galactic:{ra:15*e.saostrtod("12h51m26.00s"),dec:e.saostrtod("27d7m42.0s"),wcssys:"FK5"},ecliptic:{ra:15*e.saostrtod("18h0m0.0s"),dec:e.saostrtod("66d33m38.55s"),wcssys:"ICRS"}};switch(d=this.raw.wcsinfo||{cdelt1:1,cdelt2:1,crot:0},t||(t=this.getWCSSys()),h.angle=0,d.cdelt1>0&&(h.flip="x"),d.cdelt2<0&&(h.flip=(h.flip||"")+"y"),t){case"galactic":case"ecliptic":break;default:return d.crot&&(h.angle=-d.crot),h}return s=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(p[t].wcssys,!1),o=this.raw.width/2,n=this.raw.height/2,a=e.pix2wcs(this.raw.wcs,o,n).trim().split(/\s+/),l=e.saostrtod(a[0]),e.isHMS()&&(l*=15),c=e.saostrtod(a[1]),h.angle=e.angdist(l,c,p[t].ra,p[t].dec),e.notNull(this.raw.wcsinfo.crot)&&(h.angle-=this.raw.wcsinfo.crot),this.setWCSSys(t,!1),e.globalOpts.xeqPlugins=s,h},e.Image.prototype.getTransform=function(){return this.params.transform},e.Image.prototype.setTransform=function(...t){let s,o,n,a,l,c,d=0,h=1,[p]=t;if((!this||!this.raw||!this.raw.header)&&e.error("invalid image for setTransform"),"reset"===p)return delete this.params.transform,delete this.params.transformInverse,delete this.params.transformAngle,void delete this.params.transformScale;for(c=[[1,0,0],[0,1,0],[0,0,1]],o=0;o<e.globalOpts.transforms.length;o++)switch(e.globalOpts.transforms[o]){case"flip":switch(this.params.flip){case"x":l=[[-1,0,0],[0,1,0],[0,0,1]],c=e.matrixMultiply(c,l),h=-1;break;case"y":l=[[1,0,0],[0,-1,0],[0,0,1]],c=e.matrixMultiply(c,l),h=-1;break;case"xy":l=[[-1,0,0],[0,-1,0],[0,0,1]],c=e.matrixMultiply(c,l)}break;case"rot90":e.notNull(this.params.rot90)&&(s=this.params.rot90*Math.PI/180,a=Math.cos(s),n=Math.sin(s),l=[[a,-n,0],[n,a,0],[0,0,1]],c=e.matrixMultiply(c,l),d+=this.params.rot90);break;case"rotate":e.notNull(this.params.rotate)&&(s=this.params.rotate*Math.PI/180,a=Math.cos(s),n=Math.sin(s),l=[[a,-n,0],[n,a,0],[0,0,1]],c=e.matrixMultiply(c,l),d+=this.params.rotate)}return this.params.transform=c,this.params.transformInverse=e.invertMatrix3(c),this.params.transformAngle=h*d,this.params.transformScale=h,this},e.Image.prototype.getFlip=function(){return this.params.flip},e.Image.prototype.setFlip=function(...t){let[s,o]=t;if(e.isNull(s))return this;if("reset"===s)return this.params.flip="none",this.setFlip(0);if(o=o||{},"string"==typeof o)try{o=JSON.parse(o)}catch(a){e.error(`can't parse setFlip opts: ${o}`,a)}return this.xeqStashSave("setFlip",[s]),this.params.flip=(a=>{let l,c,d=0,h=0,p="";for(c=(a+(this.params.flip||"")).split(""),l=0;l<c.length;l++)switch(c[l]){case"x":d++;break;case"y":h++}return d%2==1&&(p+="x"),h%2==1&&(p+="y"),p||"none"})(s),this.setTransform(),this.displayImage("all",o),this.refreshLayers(),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetflip"),this},e.Image.prototype.getRotate=function(){return this.params.rotate},e.Image.prototype.setRotate=function(...t){let s,[o,n]=t;if(e.isNull(o))return this;if("reset"===o)return this.params.rotate=0,this.setRotate(0);if("string"==typeof o&&o.match(/north/i)&&(s=this.getNorthIsUp(),o=s.angle,e.notNull(s.flip)&&this.setParam("flip",s.flip)),"string"==typeof o&&(o=parseFloat(o)),e.isNumber(o)||e.error(`invalid rotation for setRotate: ${o}`),(!this||!this.raw||!this.raw.header)&&e.error("invalid image for setRotate"),n=n||{},"string"==typeof n)try{n=JSON.parse(n)}catch(l){e.error(`can't parse setRotate opts: ${n}`,l)}return this.xeqStashSave("setRotate",[o]),this.params.rotate=(l=>{for(e.globalOpts.rotateRelative&&(l+=this.params.rotate||0);l<0;)l+=360;for(;l>=360;)l-=360;return l})(o),this.setTransform(),this.params.transformAngle&&this.display.canvas.width!==this.display.canvas.height&&this.mkSection(this.getZoom()),this.displayImage("all",n),this.refreshLayers(),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetrotate"),this},e.Image.prototype.getRot90=function(){return this.params.rot90},e.Image.prototype.setRot90=function(...t){let[s,o]=t;if(e.isNull(s))return this;if("reset"===s)return this.params.rot90=0,this.setRot90(0);if("string"==typeof s&&(s=parseFloat(s)),(!this||!this.raw||!this.raw.header)&&e.error("invalid image for setRot90"),o=o||{},"string"==typeof o)try{o=JSON.parse(o)}catch(a){e.error(`can't parse setRot90 opts: ${o}`,a)}switch(s){case 0:s=0;break;case 1:s=90;break;case-1:s=-90;break;case 90:case-90:break;default:e.error(`invalid setRot90 rotation value: ${s} (use: +/1, +/90)`)}return this.xeqStashSave("setRot90",[s]),this.params.rot90=(a=>{for(a+=this.params.rot90||0;a<0;)a+=360;for(;a>=360;)a-=360;return 270===a&&(a=-90),a})(s),this.setTransform(),this.params.transformAngle&&this.display.canvas.width!==this.display.canvas.height&&this.mkSection(this.getZoom()),this.displayImage("all",o),this.refreshLayers(),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetrot90"),this},e.Image.prototype.reFlipRot=function(){let t,s,o,n=this.params.flip,a=this.params.rot90,l=this.params.rotate;if("none"!==n)for(this.params.flip="none",s=n.split(""),t=0;t<s.length;t++)("x"===s[t]||"y"===s[t])&&this.setFlip(s[t]);if(a)for(this.params.rot90=0,o=Math.floor(Math.abs(a)/90),l=Math.sign(a),t=0;t<o;t++)this.setRot90(l);return l&&this.setRotate(l),this},e.Image.prototype.refreshLayers=function(t){let s;for(s of Object.keys(this.layers))this.layers[s].show&&this.layers[s].opts.panzoom&&(t&&t[s]&&(t[s].refresh=!0),this.refreshShapes(s));this.selectShapes("regions","selected")},e.Image.prototype.imageToLogicalPos=function(t,s){let o,n,a,l,c,d,h,p="image";const g={x:t.x,y:t.y};switch(s=s||this.params.lcs||"image"){case"image":break;case"physical":this.lcs.physical&&(p=s,o=this.lcs.physical.reverse,n=this.lcs.physical.rrot,c=this.lcs.physical.cx,d=this.lcs.physical.cy);break;case"detector":this.lcs.detector&&(p=s,o=this.lcs.detector.reverse,n=this.lcs.detector.rrot,c=this.lcs.detector.cx,d=this.lcs.detector.cy);break;case"amplifier":this.lcs.amplifier&&(p=s,o=this.lcs.amplifier.reverse,n=this.lcs.amplifier.rrot,c=this.lcs.amplifier.cx,d=this.lcs.amplifier.cy)}return o&&(g.x=t.x*o[0][0]+t.y*o[1][0]+o[2][0],g.y=t.x*o[0][1]+t.y*o[1][1]+o[2][1],n&&(a=c+(g.x-c)*n[0][0]+(g.y-d)*n[1][0]+n[2][0],l=d+(g.x-c)*n[0][1]+(g.y-d)*n[1][1]+n[2][1],g.x=a,g.y=l),"table"===this.imtab&&(h=this.raw.bitpix<0?.5:1,void 0!==this.raw.header.TABMIN1&&(g.x=g.x-h+this.raw.header.TABMIN1),void 0!==this.raw.header.TABMIN2&&(g.y=g.y-h+this.raw.header.TABMIN2))),{x:g.x,y:g.y,sys:p}},e.Image.prototype.logicalToImagePos=function(t,s){let o,n,a,l,c,d,h;const p={x:t.x,y:t.y};switch(c=this.raw.header.CRPIX1||1,d=this.raw.header.CRPIX2||1,s=s||this.params.lcs||"image"){case"image":break;case"ophysical":this.lcs.ophysical?(o=this.lcs.ophysical.forward,n=this.lcs.ophysical.frot):this.lcs.physical&&(o=this.lcs.physical.forward,n=this.lcs.physical.frot);break;case"physical":this.lcs.physical&&(o=this.lcs.physical.forward,n=this.lcs.physical.frot);break;case"detector":this.lcs.detector&&(o=this.lcs.detector.forward,n=this.lcs.detector.frot);break;case"amplifier":this.lcs.amplifier&&(o=this.lcs.amplifier.forward,n=this.lcs.amplifier.frot)}return o&&("table"===this.imtab&&(h=this.raw.bitpix<0?.5:1,void 0!==this.raw.header.TABMIN1&&(t.x=t.x-this.raw.header.TABMIN1+h),void 0!==this.raw.header.TABMIN2&&(t.y=t.y-this.raw.header.TABMIN2+h)),p.x=t.x*o[0][0]+t.y*o[1][0]+o[2][0],p.y=t.x*o[0][1]+t.y*o[1][1]+o[2][1],n&&(a=c+(p.x-c)*n[0][0]+(p.y-d)*n[1][0]+n[2][0],l=d+(p.x-c)*n[0][1]+(p.y-d)*n[1][1]+n[2][1],p.x=a,p.y=l)),p},e.Image.prototype.displayToImagePos=function(t){let s,o,n,a,l,c,d;const h=this.rgb.sect,g=this.display.width/2,v=this.display.height/2;return this.params.transformInverse?(n=this.params.transformInverse,a=t.x-g,l=t.y-v,c=a*n[0][0]+l*n[1][0]+g,d=a*n[0][1]+l*n[1][1]+v):(c=t.x,d=t.y),s=(c-this.ix+.5)/h.zoom+h.x0+.5,o=(this.rgb.img.height-(d-this.iy+.5))/h.zoom+h.y0+.5,{x:s,y:o}},e.Image.prototype.imageToDisplayPos=function(t){let s,o,n,a,l;const c=this.rgb.sect,h=this.display.width/2,p=this.display.height/2;return s=(t.x-.5-c.x0)*c.zoom+this.ix-.5,o=(c.y0-(t.y-.5))*c.zoom+this.rgb.img.height+this.iy-.5,this.params.transform&&(n=this.params.transform,a=s-h,l=o-p,s=a*n[0][0]+l*n[1][0]+h,o=a*n[0][1]+l*n[1][1]+p),{x:s,y:o}},e.Image.prototype.logicalToDisplayPos=function(t,s,o){return this.imageToDisplayPos(this.logicalToImagePos(t,s,o))},e.Image.prototype.displayToLogicalPos=function(t){return this.imageToLogicalPos(this.displayToImagePos(t))},e.Image.prototype.getWCSSys=function(){if(this.params.wcssys)return this.params.wcssys},e.Image.prototype.setWCSSys=function(t,s){let o,n;if(!($.inArray("wcs",this.params.disable)>=0))return e.isNull(s)&&(s=e.globalOpts.wcsSetUpdatesDef),"image"===t?(this.params.wcssys="image",this.params.wcsunits="pixels",e.wcsunits.image="pixels"):"physical"===t?(this.params.wcssys="physical",this.params.wcsunits="pixels",s&&(e.globalOpts.wcsUnits.physical="pixels")):this.validWCS()&&("native"===t&&(t=this.params.wcssys0),o=e.wcssys(this.raw.wcs,t),o&&(this.params.wcssys=o.trim(),n=e.globalOpts.wcsUnits[this.params.wcssys]||"sexagesimal",this.setWCSUnits(n,s))),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetwcssys"),this},e.Image.prototype.initWCS=function(t){let s,o,n,a,l,c;const d=e.globalOpts.wcsHlength,h=/(WCSNAME|WCSAXES|CRVAL[0-9]|CRPIX[0-9]|PC[0-9]_[0-9]|CDELT[0-9]|CD[0-9]_[0-9]|CTYPE[0-9]|CUNIT[0-9]|CRVAL[0-9]|PV[0-9]_[0-9]|PS[0-9]_[0-9]|RADESYS|LONPOLE|LATPOLE)([A-Z])/;if(!this.raw.header)return this;for(o of(t=t||this.raw.header,this.freeWCS(),this.raw.altwcs={},s="default",this.raw.altwcs[s]={},this.raw.altwcs[s].header=t,Object.keys(t)))n=o.match(h),n&&n.length&&(s=n[2],this.raw.altwcs[s]||(this.raw.altwcs[s]={},this.raw.altwcs[s].header=$.extend({},t)),"RADESYS"===n[1]&&(n[1]="RADECSYS"),this.raw.altwcs[s].header[n[1]]=t[n[0]]);for(o of Object.keys(this.raw.altwcs)){a=e.raw2FITS(this.raw.altwcs[o].header),l=a.length+1;try{c=e.vmalloc(l)}catch(p){e.error(`can't malloc for wcsinit: ${l}`,p)}try{e.vstrcpy(a,c)}catch(p){e.error(`can't copy for wcsinit: ${l}`,p)}if(this.raw.altwcs[o].wcs=e.initwcs(c,d),e.vfree(c),this.raw.altwcs[o].wcs>0)try{this.raw.altwcs[o].wcsinfo=JSON.parse(e.wcsinfo(this.raw.altwcs[o].wcs))}catch{}}return this.setWCS("default"),this},e.Image.prototype.freeWCS=function(t){let s;if((t=t||this.raw).altwcs)for(s of Object.keys(t.altwcs))t.altwcs[s].wcs>0&&(e.freewcs(t.altwcs[s].wcs),t.altwcs[s].wcs=null)},e.Image.prototype.getWCS=function(){let t,s;for(t of Object.keys(this.raw.altwcs))if(this.raw.wcs===this.raw.altwcs[t].wcs)return s=$.extend(!0,{},this.raw.altwcs[t].wcsinfo),s.version=t,s.wcsname=this.raw.altwcs[t].header.WCSNAME,s;return null},e.Image.prototype.setWCS=function(t){let s,o,n;if(t=t||"default",!this.raw||!this.raw.altwcs)return this;for(s of Object.keys(this.raw.altwcs))if(o=this.raw.altwcs[s].header.WCSNAME,t===s||t===o)return this.raw.altwcs[s].wcs<=0&&e.error("invalid WCS for version: %s",t),this.raw.wcs=this.raw.altwcs[s].wcs,this.raw.wcsinfo=this.raw.altwcs[s].wcsinfo,n=this.raw.wcsinfo&&this.raw.wcsinfo.radecsys?this.raw.wcsinfo.radecsys:"native"!==this.params.wcssys?this.params.wcssys.trim():this.params.lcs,this.setWCSSys(n),this.params.wcssys0||(this.params.wcssys0=n),this.setWCSUnits(this.params.wcsunits),this;e.error(`could not find WCS version: ${t}`)},e.Image.prototype.validWCS=function(){return this.raw&&this.raw.wcs&&this.raw.wcs>0},e.Image.prototype.getWCSUnits=function(){return this.params.wcsunits?this.params.wcsunits:"pixels"},e.Image.prototype.setWCSUnits=function(t,s){let o,n;if(!($.inArray("wcs",this.params.disable)>=0))return e.isNull(s)&&(s=e.globalOpts.wcsSetUpdatesDef),"pixels"===t?(e.isWCSSys(this.params.wcssys)&&(this.params.wcssys="physical"),this.params.wcsunits="pixels",s&&(e.globalOpts.wcsUnits[this.params.wcssys]="pixels")):this.validWCS()&&(e.notWCS(this.params.wcssys)&&(n=e.imageOpts.wcssys,this.setWCSSys(n)),o=e.wcsunits(this.raw.wcs,t),o&&(this.params.wcsunits=o.trim(),s&&(e.globalOpts.wcsUnits[this.params.wcssys]=this.params.wcsunits))),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetwcsunits"),this},e.Image.prototype.notifyHelper=function(){let t,s,o;const n=new RegExp(`^${e.ANON}[0-9]*`),a=e.INSTALLDIR?new RegExp(`^${e.INSTALLDIR}`):null;if(e.helper.connected&&!this.file.match(n)){switch(e.helper.type){case"get":case"post":if(!e.helper.pageid){e.helper.send("pageid",null,l=>{l&&l.trim().match(/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/)&&(e.helper.pageid=l,e.helper.js9helper="js9helper")});break}}s=this.file,"/"!==s.charAt(0)&&a&&(o=this.file.replace(a,"")),e.helper.send("image",{image:s,image2:o},l=>{let c,d,h,p,g;"object"==typeof l?(c=l.stdout,l.stderr&&e.DEBUG>1&&e.log(l.stderr)):c=l,c&&(d=c.trim().match(/(?:[^\s[]+|\[[^\]]*\])+/g),h=d[1],"?"!==h&&(e.globalOpts.dataDir?(p=h.lastIndexOf("/")+1,this.fitsFile=`${e.globalOpts.dataDir}/${h.slice(p)}`):(this.fitsFile=h,this.fitsFile.includes("/")||(t=this.file.match(/.*\//),t&&t.length&&(g=new RegExp(`^${e.INSTALLDIR}`),t=t[0].replace(g,""),this.fitsFile=t+this.fitsFile)),e.globalOpts.prependJS9Dir&&(this.fitsFile&&!this.fitsFile.match(/^\${JS9_DIR}/)&&"/"!==this.fitsFile.charAt(0)&&(this.fitsFile=`\${JS9_DIR}/${this.fitsFile}`),this.parentFile&&!this.parentFile.match(/^\${JS9_DIR}/)&&"/"!==this.parentFile.charAt(0)&&(this.parentFile=`\${JS9_DIR}/${this.parentFile}`))),e.DEBUG>1&&e.log("JS9 fitsFile: %s %s",this.file,this.fitsFile)),this.fitsFile&&(this.fitsFile=e.cleanPath(this.fitsFile)),this.parentFile&&(this.parentFile=e.cleanPath(this.parentFile)),this.queried||(this.queryHelper("all"),this.queried=!0))})}return this},e.Image.prototype.queryHelper=function(t){const s=t||"all";return e.helper.connected&&("all"===s||"getAnalysis"===s)&&(this.analysisPackages||e.helper.send("getAnalysis",{fits:this.fitsFile},o=>{if(o)try{this.analysisPackages=JSON.parse(o)}catch(n){e.log("can't get analysis",n)}})),this},e.Image.prototype.expandMacro=function(t,s){let o,n;if(t)return o=t.replace(/\${?([a-zA-Z][a-zA-Z0-9_()]+)}?/g,(a,l,c)=>{let d,h,p,g;const v=m=>{const b=this.params.wcssys;if(m)switch(m){case"wcs":e.notWCS(b)&&(this.params.wcssys=this.params.wcssys0);break;case"physical":case"image":this.params.wcssys=m}return b},r=m=>{m&&(this.params.wcssys=m)},u=m=>{let b;return"table"===this.imtab?this.raw.hdu&&this.raw.hdu.table.filter&&!m.match(this.raw.hdu.table.filter)&&(m.match(/\]\[/)?m=`${m.slice(0,-1)}&&${this.raw.hdu.table.filter}]`:m+=`[${this.raw.hdu.table.filter}]`):"image"===this.imtab&&(b=this.file.match(/\[.*\]/),b?m.match(/\[.*\]/)?m=m.replace(/\[.*\]/,b):m+=b:this.raw&&this.raw.hdu&&this.raw.hdu.slice?(b=this.raw.hdu.slice.replace(/:/g,",").replace(/([0-9][0-9]*)/,"$1:$1"),m+=`[${b}]`):this.raw&&this.raw.header&&this.raw.header.NAXIS>2&&(m+="[*,*,1:1]")),m},f=l.split("(");switch(f[1]&&(f[1]=f[1].replace(/\)$/,"")),f[0]){case"id":h=this.display.divjq.attr("id");break;case"image0":h=this.id.replace(/\[EVENTS\]/i,"");break;case"image":h=this.id;break;case"filename":"all"==f[1]&&this.fitsFile&&this.raw&&this.raw.header&&3===this.raw.header.NAXIS?h=this.fitsFile:this.parentFile&&"this"!==f[1]?this.raw&&this.raw.filter?(h=this.parentFile,h.match(/\[.*\]/)||(h+="[EVENTS]"),h+=`[${this.raw.filter}]`):h=u(this.parentFile):this.fitsFile?h=u(this.fitsFile):e.error(`no FITS file for ${this.id}`);break;case"fits":this.fitsFile||e.error(`no FITS file for ${this.id}`),h=u(this.fitsFile);break;case"parent":this.parentFile||e.error(`no parent FITS file for ${this.id}`),h=this.parentFile;break;case"ext":this.fitsFile?(h=this.fitsFile.match(/\[.*\]/),null===h&&(h="")):e.error(`no FITS file for ${this.id}`);break;case"imcenter":g=this.displayToLogicalPos({x:this.display.width/2,y:this.display.height/2}),h=`${g.x},${g.y}`;break;case"wcscenter":g=this.displayToImagePos({x:this.display.width/2,y:this.display.height/2}),h=e.pix2wcs(this.raw.wcs,g.x,g.y).replace(/\s+/g,",");break;case"sregions":p=v(f[1]),h=this.listRegions("source",{mode:0,includedcoords:e.globalOpts.regExpandDCoords}).replace(/\s+/g,""),r(p);break;case"bregions":p=v(f[1]),h=this.listRegions("background",{mode:0,includedcoords:e.globalOpts.regExpandDCoords}).replace(/\s+/g,""),r(p);break;case"regions":p=v(f[1]),h=this.listRegions("all",{mode:0,includedcoords:e.globalOpts.regExpandDCoords}).replace(/\s+/g,""),r(p);break;case"mag":h=this.params.zoom?sprintf("%s%",100*this.params.zoom):"?";break;default:if(s)for(n=s.length,d=0;d<n;d++)if(s[d].name===l){h=s[d].value;break}if(void 0===h&&this&&void 0!==this.params[l])switch(l){case"wcsunits":switch(this.params[l]){case"sexagesimal":h="hms";break;case"degrees":h="deg";break;default:h=this.params[l]}break;case"scaleclipping":h="dataminmax"===this.params[l]?"data":this.params[l];break;case"colormap":h=this.useOffScreenCanvas()?"overlay":this.params[l];break;default:h="number"==typeof this.params[l]&&this.params[l]!==Math.floor(this.params[l])?this.params[l].toFixed(2):this.params[l]}void 0===h&&(h=a)}return h}),o},e.Image.prototype.lookupAnalysis=function(t){let s,o,n,a=null;if(this.analysisPackages){for(o=0;o<this.analysisPackages.length&&!a;o++)for(n=this.analysisPackages[o],s=0;s<n.length&&(a=n[s],!a.xclass||`${a.xclass}:${a.name}`!==t);s++)a=null;if(a)return a;for(o=0;o<this.analysisPackages.length&&!a;o++)for(n=this.analysisPackages[o],s=0;s<n.length&&(a=n[s],a.name!==t);s++)a=null}return a},e.Image.prototype.validateAnalysis=function(t){let s,o;const d=(h,p)=>!(!h||!p)&&String(h).toUpperCase()===String(p).toUpperCase();return!(!t.title||!t.name||t.hidden||t.files&&(t.files.match(/^fits$/)&&!this.fitsFile||t.files.match(/^table$/)&&"table"!==this.imtab||t.files.match(/^image$/)&&"image"!==this.imtab||(o=t.files.match(/fitsHeader\(([A-Za-z0-9_]+),(.*)\)/),o&&(s=this.raw.header[o[1].toUpperCase()],!d(s,o[2])))||(o=t.files.match(/winVar\((.*),(.*)\)/),o&&(s=e.varByName(o[1],window),!d(s,o[2])))||(o=t.files.match(/js9Var\((.*),(.*)\)/),o&&(s=e.varByName(o[1],e),!d(s,o[2])))||(o=t.files.match(/imVar\((.*),(.*)\)/),o&&(s=e.varByName(o[1],this),!d(s,o[2])))))},e.Image.prototype.getAnalysis=function(){let t,s,o,n;const a=[];if(!this.analysisPackages)return a;for(s=0;s<this.analysisPackages.length;s++)for(n=this.analysisPackages[s],t=0;t<n.length;t++)o=n[t],this.validateAnalysis(o)&&a.push(o);return a},e.Image.prototype.runAnalysis=function(t,s,o){let n,a,l,c,d={};const h=(p,g)=>{switch(e.helper||e.error(p,g),e.helper.type){case"nodejs":case"socket.io":e.helper.socket&&"polling"===e.helper.socket.io.engine.transport.name?window.setTimeout(()=>{e.error(p,g)},0):e.error(p,g);break;default:e.error(p,g)}};if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(p){e.error(`can't parse runAnalysis opts: ${s}`,p)}if(o=o||e.globalOpts.analysisFunc,e.helper.connected&&this.analysisPackages){if(a=this.lookupAnalysis(t),!a)return void e.error(`could not find analysis task: ${t}`);if(a.action&&(d.cmd=this.expandMacro(a.action,s)),a.keys)for(d.keys={},n=0;n<a.keys.length;n++)d.keys[a.keys[n]]=this.expandMacro(`$${a.keys[n]}`,s);switch(d.id=this.expandMacro("$id"),d.image=this.file,d.fits=this.fitsFile,d.rtype=a.rtype,e.helper.type){case"nodejs":case"socket.io":l=a.xclass?`${a.xclass}:${a.name}`:a.name;break;default:l="runAnalysis"}return e.waiting(!0,this.display),this.setStatus("runAnalysis","processing"),e.helper.send(l,d,p=>{let g,v,r,u,f,m;if(v="object"==typeof p?p:p.search(e.analOpts.epattern)>=0?{stderr:p}:{stdout:p},v.errcode=v.errcode||0,o)o.call(this,v.stdout,v.stderr,v.errcode,a);else{if(v.stderr){if(g=v.stderr,!(g.search(/WARNING:/i)>=0&&g.search(/ERROR:/i)<0))return void h(g,e.analOpts.epattern);e.log(g)}else if(v.errcode){if(g=`ERROR: running ${a.name} [${v.errcode}]`,!v.stdout)return void h(g,e.analOpts.epattern);e.log(g)}switch(a.rtype){case"text":case void 0:this.displayAnalysis("text",v.stdout,{divid:e.globalOpts.analysisDiv});break;case"plot":this.displayAnalysis("plot",v.stdout,{divid:e.globalOpts.analysisDiv});break;case"alert":v.stdout&&alert(v.stdout);break;case"fits":m=v.stdout.split(/\s+/),m&&m[0]&&(r=e.cleanPath(m[0]),"/"!==r.charAt(0)&&(r=e.InstallDir(r)),f={proxyFile:r},m[1]&&(u=e.cleanPath(m[1]),f.parentFile=u,f.proxyParent=u),f.fits2fits=!1,f.fixpath=!1,e.Load(r,f,{display:this.display}));break;case"regions":if(m=v.stdout.split(/\s+/),m&&m[0]){if(m.length>1)try{c=JSON.parse(m[1])}catch{c=null}c=c||{},"boolean"==typeof c.remove&&(c.remove="all"),"string"===c.type?(c.remove&&this.removeShapes("regions",c.remove),this.addShapes("regions",m[0],s)):(r=e.cleanPath(m[0]),"/"!==r.charAt(0)&&(r=e.InstallDir(r)),d={responseType:"text"},e.fetchURL(null,r,d,(b,w)=>{c.remove&&this.removeShapes("regions",c.remove),this.addShapes("regions",b,w)}))}break;case"catalog":m=v.stdout.split(/\s+/),m&&m[0]&&(r=e.cleanPath(m[0]),d={responseType:"text"},e.fetchURL(null,r,d,(b,w)=>{this.loadCatalog(null,b,w)}));break;case"none":break;default:e.error(`unknown analysis result type: ${a.rtype}`)}}this.setStatus("runAnalysis","complete"),e.waiting(!1)}),this}},e.Image.prototype.displayAnalysis=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x;const y=e.lightOpts[e.LIGHTWIN],S=()=>{let _,C="width=368px,height=110px,resize=1,scrolling=1";const I=e.Plot.opts.title;!p||!f||($(e.lightOpts[e.LIGHTWIN].topid).arrive("#plotConfigForm",{onceOnly:!0},()=>{e.Plot.initConfigForm.call(this,f,h)}),e.allinone?(_=e.allinone.plotConfigHTML,f.winid=this.displayAnalysis("params",_,{title:I,winformat:C})):(_=e.InstallDir(e.Plot.opts.configURL),f.winid=this.displayAnalysis("params",_,{title:I,winformat:C})))};if("string"==typeof(o=o||{}))try{o=JSON.parse(o)}catch(_){e.error(`can't parse displayAnalysis opts: ${o}`,_)}switch(r=o.winformat,o.divid&&$(`#${o.divid}`).length>0&&(u=$(`#${o.divid}`)),g=o.title||"",this&&!g&&(v=this.fitsFile||this.id||"",v=v.split("/").reverse()[0],g=`AnalysisResults: ${v}`,g+=sprintf(e.IDFMT,this.display.id)),l=`Analysis_${e.uniqueID()}`,t){case"text":d="<div class='JS9Analysis'></div>",d+=`<pre class='JS9AnalysisText'>${s=s||""}</pre>`,d+="</div>",u?(u.html(d),window.electron&&e.searchbar(u[0])):(r=r||y.textWin,c=e.lightWin(l,"inline",d,g,r),window.electron&&e.searchbar(c));break;case"plot":if(s&&"string"==typeof s)try{h=JSON.parse(s)}catch(_){e.error(`can't plot return data: ${s}`,_)}else"object"==typeof s&&(h=s);if(!h)return;if(h.curscale={x:"linear",y:"linear"},d=`<div id='${l}' class='JS9Analysis'><div id='${l}Plot' class='JS9Plot' ></div></div>`,u?u.html(d):(r=r||y.plotWin,c=e.lightWin(l,"inline",d,g,r)),p=$(`#${l} #${l}Plot`),u&&(p.css("width",u.css("width")),p.css("height",u.css("height")),p.css("margin",0)),h.data){if("plotly"===e.globalOpts.plotLibrary){for(b=$.extend(!0,{},e.Plot.opts,h.opts),h.label&&(b.title=h.label),m={x:[],y:[],type:"scatter"},h.data[0].length>=3&&(m.error_y={type:"data",array:[],visible:!0},h.points&&h.points.yerr&&h.points.yerr.color&&(m.error_y.color=h.points.yerr.color)),n=0;n<h.data.length;n++)m.x.push(h.data[n][0]),m.y.push(h.data[n][1]),m.error_y&&m.error_y.array&&m.error_y.array.push(h.data[n][2]);e.Plot.opts.annotate&&h.annotations&&(b.annotations=e.Plot.annotate(h)),"log"===b.xscale&&(b.xaxis=b.xaxis||{},b.xaxis.type="log",b.xaxis.autorange=!0,h.curscale.x="log"),"log"===b.yscale&&(b.yaxis=b.yaxis||{},b.yaxis.type="log",b.yaxis.autorange=!0,h.curscale.y="log");try{Plotly.newPlot(p.attr("id"),[m],b)}catch(_){e.error("can't plot data (plotly)",_)}}else{b=$.extend(!0,{},e.Plot.opts,h.opts),e.Plot.opts.annotate&&h.annotations&&(b.zoomStack.func=(_,C)=>{e.Plot.annotate(p,_,h)}),h.color=h.color||b.color,"log"===h.xscale&&(b.xaxis=b.xaxis||{},b.xaxis.transform=e.Plot.logfunc,b.xaxis.inverseTransform=e.Plot.expfunc,h.curscale.x="log"),"log"===h.yscale&&(b.yaxis=b.yaxis||{},b.yaxis.transform=e.Plot.logfunc,b.yaxis.inverseTransform=e.Plot.expfunc,h.curscale.y="log");try{f=$.plot(p,[h],b)}catch(_){e.error("can't plot data (flot)",_)}e.Plot.opts.annotate&&h.annotations&&e.Plot.annotate(p,f,h)}p.css("outline","none"),p.attr("tabindex",0),p.on("keydown",_=>{const C=e.eventToCharStr(_);switch(C){case"c":S();break;case"x":case"y":x="linear"!==h.curscale[C]?"linear":"log",e.Plot.rescale(p,f,h,C,x)}}),w=$(`<img src='${e.InstallDir("images/gears.png")}'>`),w.on("click",S),A=$("<div class='JS9PlotGear'>"),A.append(w),p.append(A)}break;case"params":case"regions":case"textline":u?e.allinone?u.html(s):$.ajax({url:s,cache:!1,dataType:"text",success:_=>{u.html(_)}}):(r="params"===t?r||y.paramWin:"regions"===t?"small"===e.globalOpts.regConfigSize?r||y.regWin0:r||y.regWin:r||y.dpathWin,a=e.allinone?"inline":"ajax",c=e.lightWin(l,a,s,g,r))}return c},e.Image.prototype.saveFITS=function(t,s){let o,n,a,l;if({}.hasOwnProperty.call(window,"saveAs")){if(t?(t=t.replace(/\s+/g,"_").replace(/(png|jpg|jpeg|fz)$/i,"fits")).match(/.fits$/)||(t+=".fits"):t="js9.fits","string"==typeof(s=s||{})){try{a=JSON.parse(s)}catch{a=null}a&&(s=a)}"display"===s||"display"===s.source?(l=this.rgb.sect,o=this.toArray({notab:!0,twoaxes:!0,sect:l})):"virtual"===s||"virtual"===s.source?this.raw.hdu&&this.raw.hdu.fits&&this.raw.hdu.fits.vfile?o=e.vread(this.raw.hdu.fits.vfile,"binary"):e.error("no virtual file available to save"):o=this.toArray({notab:!0,twoaxes:!0}),n=new Blob([o],{type:"application/octet-binary"}),e.saveAs(n,t)}else e.error("no saveAs() available to save FITS file");return t},e.Image.prototype.saveIMG=function(t,s,o){let n,a,l,c,d,h,p;if({}.hasOwnProperty.call(window,"saveAs")){if("number"==typeof o)p=o,o=null;else if("string"==typeof o){if(e.isNumber(o))p=parseFloat(o),o=null;else try{o=JSON.parse(o)}catch{o=null}o&&(p=o.quality)}if(o=o||{},t=t||"js9.png",s=s||"image/png",d=this.display.width,h=this.display.height,a=document.createElement("canvas"),a.setAttribute("width",d),a.setAttribute("height",h),l=a.getContext("2d"),"image"===o.source?l.putImageData(this.rgb.img,0,0):l.drawImage(this.display.canvas,0,0),!1!==o.layers)for(n of Object.keys(this.layers))"main"===this.layers[n].dlayer.dtype&&this.layers[n].show&&(c=this.layers[n].dlayer.canvasjq[0],l.drawImage(c,0,0,d,h));e.notNull(p)&&(p<0||p>1)&&(p=.95),a.toBlob(g=>{e.saveAs(g,t)},s,p)}else e.error("no saveAs() available for saving image");return t},e.Image.prototype.savePNG=function(t,s){return(t=t||"js9.png").match(/\.png$/)||(t+=".png"),this.saveIMG(t,"image/png",s)},e.Image.prototype.saveJPEG=function(t,s){return!(t=t||"js9.jpg").match(/\.jpg$/)&&!t.match(/\.jpeg$/)&&(t+=".jpg"),this.saveIMG(t,"image/jpeg",s)},e.Image.prototype.updateValpos=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x=null;const S="\t\t ",_="&nbsp;&nbsp;&nbsp;&nbsp;",C=D=>e.floatFormattedString(D,this.params.precision,3),I=(D,O)=>D.toFixed(O=O||3),L=(D,O)=>{let M="",E="";for(O=O||3,D<0&&(D=Math.abs(D),E="-"),M+=D;M.length<O;)M=`0${M}`;return E+M};if(this.params.valpos){if(void 0===s&&(s=!0),this.valpos)return s&&this.display.displayMessage("info",this.valpos,e.globalOpts.valposTarget),this.valpos;switch(h={x:t.x,y:t.y,sys:"image"},v=this.imageToLogicalPos(t),g=this.imageToDisplayPos(t),g.sys="display",p="image"===this.params.wcssys?h:v,o=this.raw.data[Math.floor(t.y-.5)*this.raw.width+Math.floor(t.x-.5)],this.raw.bitpix){case 8:case 16:case-16:case 32:d=L(o);break;case-32:case-64:d=C(o);break;default:d=L(o)}a=d,l=`${I(p.x,3)} ${I(p.y,3)} (${p.sys})`,e.globalOpts.valposDCoords&&"image"===p.sys&&(l+=`${_}${I(g.x,3)} ${I(g.y,3)} (${g.sys})`),n=a+_+l,x={ix:h.x,iy:h.y,ipos:I(h.x,2)+S+I(h.y,2),isys:"image",px:v.x,py:v.y,ppos:I(v.x,2)+S+I(v.y,2),psys:"physical",dx:g.x,dy:g.y,dpos:I(g.x,2)+S+I(g.y,2),dsys:"display",cx:p.x,cy:p.y,cpos:I(p.x,2)+S+I(p.y,2),csys:p.sys,ra:"",dec:"",wcspos:"",wcssys:"",racen:"",deccen:"",wcsfov:"",wcspix:"",val:o,val3:d,id:this.id,file:this.file,object:this.object||""},(this.telescope||this.instrument)&&(x.object&&(x.object+="  "),x.object+="(",this.telescope&&(x.object+=this.telescope,this.instrument&&(x.object+=", ")),this.instrument&&(x.object+=this.instrument),x.object+=")"),this.validWCS()&&e.isWCSSys(this.params.wcssys)&&(r=e.pix2wcs(this.raw.wcs,t.x,t.y).trim().split(/\s+/),c=`${r[0]} ${r[1]} (${r[2]||"wcs"})`,n=a+_+c+_+l,x.ra=r[0],x.dec=r[1],x.wcspos=r[0]+"\t "+r[1],x.wcssys=r[2],this.raw.wcsinfo&&(u=Math.abs(this.raw.wcsinfo.cdelt1),f=Math.abs(this.raw.wcsinfo.cdelt2),m=1/60,this.raw.header.CUNIT1&&(w=this.raw.header.CUNIT1),(!w||w.match(/^deg/i))&&(u>=1||f>=1?w="deg":u>=m||f>=m?(w="'",u*=60,f*=60):(w='"',u*=3600,f*=3600)),A=this.rgb.sect,m=((A.x1-A.x0)*u).toFixed(0),b=((A.y1-A.y0)*f).toFixed(0),x.wcsfov=`${m}${w} \xd7 ${b}${w}`,m=I(u/A.zoom,3),x.wcspix=`${m}${w}/pix`,x.wcsfovpix=`${x.wcsfov}  (${x.wcspix})`,r=e.pix2wcs(this.raw.wcs,(A.x1+A.x0)/2,(A.y1+A.y0)/2).trim().split(/\s+/),x.racen=r[0],x.deccen=r[1],x.wcscen=r[0]+"\t "+r[1])),x.vstrsmall=a+_+l,x.vstr=n,x.vstrmedium=n,x.vstrlarge=n+_+this.file,s&&this.display.displayMessage("info",x,e.globalOpts.valposTarget)}return x},e.Image.prototype.toggleValpos=function(){this.params.valpos=!this.params.valpos,this.params.valpos||this.display.clearMessage()},e.Image.prototype.getColormap=function(){if(this.cmapObj)return{colormap:this.cmapObj.name,contrast:this.params.contrast,bias:this.params.bias}},e.Image.prototype.setColormap=function(...t){let a,[s,o,n]=t;const l=h=>{if(this.cmapObj)switch(this.cmapObj.name){case"red":this.display.rgb.rim===this&&(this.display.rgb.rim=null);break;case"green":this.display.rgb.gim===this&&(this.display.rgb.gim=null);break;case"blue":this.display.rgb.bim===this&&(this.display.rgb.bim=null)}switch(delete this.staticObj,this.cmapObj=e.lookupColormap(h),this.params.colormap=this.cmapObj.name,"static"===this.cmapObj.type&&(this.staticObj=$.extend(!0,{},this.cmapObj)),h){case"red":this.display.rgb.rim=this;break;case"green":this.display.rgb.gim=this;break;case"blue":this.display.rgb.bim=this}this.params.overlay=!1},c=(h,p)=>{h=parseFloat(h),Number.isNaN(h)||(this.params.contrast=h),p=parseFloat(p),Number.isNaN(p)||(this.params.bias=p)},d=h=>{let p,g,v,r;for(p=0;p<h.length;p++)if($.isArray(h[p])&&"string"==typeof h[p][0])for(g=0;g<this.staticObj.colors.length;g++)if(v=this.staticObj.colors[g],h[p][0]===v.name){switch(h[p].length){case 2:!1===h[p][1]||"false"===h[p][1]?v.active=!1:!0===h[p][1]||"true"===h[p][1]?v.active=!0:(r=parseFloat(h[p][1]),r>0&&r<=1&&(r*=255),v.alpha=r);break;case 3:v.min=parseFloat(h[p][1]),Number.isNaN(v.min)&&(v.min=-1/0),v.max=parseFloat(h[p][2]),Number.isNaN(v.max)&&(v.max=1/0)}break}this.params.overlay=!1};if(!($.inArray("colormap",this.params.disable)>=0&&this.cmapObj)){switch(t.length){case 1:switch(s){case"rgb":this.display.rgb.active=!this.display.rgb.active;break;case"overlay":this.offscreen&&(this.params.overlay=!this.params.overlay);break;case"invert":this.params.invert=!this.params.invert;break;case"reset":this.params.invert=e.imageOpts.invert,this.params.contrast=e.imageOpts.contrast,this.params.bias=e.imageOpts.bias;break;default:if(this.cmapObj&&"static"===this.cmapObj.type)if($.isArray(s))d(s);else if("string"==typeof s&&"["===s.charAt(0))try{a=JSON.parse(s),d(a)}catch(h){e.error(`can't parse JSON in setColormap: ${s}`,h)}else l(s);else"string"==typeof s&&l(s)}break;case 2:e.isNumber(s)&&e.isNumber(o)?c(s,o):this.cmapObj&&"static"===this.cmapObj.type&&(l(s),d(o));break;case 3:l(s),c(o,n)}return this.displayImage("colors"),this.xeqStashDiscard("filterRGBImage"),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetcolormap"),this}},e.Image.prototype.getScale=function(){if(this.params.scale)return{scale:this.params.scale,scalemin:this.params.scalemin,scalemax:this.params.scalemax,scaleclipping:this.params.scaleclipping}},e.Image.prototype.setScale=function(...t){let[s,o,n]=t;const a=l=>{e.scales.includes(l)?this.params.scale=l:"dataminmax"===l?(this.params.scaleclipping="dataminmax",this.params.scalemin=this.raw.dmin,this.params.scalemax=this.raw.dmax):"zscale"===l?((void 0===this.params.z1||void 0===this.params.z2)&&this.zscale(!1),this.params.scaleclipping="zscale",this.params.scalemin=this.params.z1,this.params.scalemax=this.params.z2):"zmax"===l?(void 0===this.params.z1&&this.zscale(!1),this.params.scaleclipping="zmax",this.params.scalemin=this.params.z1,this.params.scalemax=this.raw.dmax):"user"===l?this.params.scaleclipping="user":e.error(`unknown scale: ${l}`)};if(!($.inArray("scale",this.params.disable)>=0)){if(t.length){switch(t.length){case 1:a(s);break;case 2:this.params.scalemin=parseFloat(s),this.params.scalemax=parseFloat(o),this.params.scaleclipping="user";break;default:a(s),"zscale"!==s&&"zmax"!==s&&(this.params.scalemin=parseFloat(o),this.params.scalemax=parseFloat(n),this.params.scaleclipping="user")}this.params.precision=e.floatPrecision(this.params.scalemin,this.params.scalemax),this.displayImage("colors")}return e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetscale"),this}},e.Image.prototype.getOpacity=function(){let t={};return t.opacity=e.notNull(this.params.opacity)?this.params.opacity:1,e.notNull(this.params.flooropacity)&&(t.flooropacity=this.params.flooropacity,t.floorvalue=this.params.floorvalue),t},e.Image.prototype.setOpacity=function(...t){let[s,o,n]=t;if(!($.inArray("opacity",this.params.disable)>=0)){if(t.length){switch(t.length){case 1:"string"==typeof s?"reset"===s.toLowerCase()?this.params.opacity=1:"resetfloor"===s.toLowerCase()?(delete this.params.floorvalue,delete this.params.flooropacity):"resetall"===s.toLowerCase()&&(this.params.opacity=1,delete this.params.floorvalue,delete this.params.flooropacity):e.isNumber(s)&&(this.params.opacity=parseFloat(s));break;case 2:e.isNumber(s)&&e.isNumber(o)&&(this.params.floorvalue=parseFloat(s),this.params.flooropacity=parseFloat(o));break;case 3:e.isNumber(s)&&(this.params.opacity=parseFloat(s)),e.isNumber(o)&&e.isNumber(n)&&(this.params.floorvalue=parseFloat(o),this.params.flooropacity=parseFloat(n))}("number"==typeof s||"string"==typeof s&&!s.match(/reset/))&&this.mask.active&&this.mask.im&&(this.mask.active=!1),this.displayImage("colors")}return e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetopacity"),this}},e.Image.prototype.getParam=function(t){return t?"all"===t?this.params:this.params[t]:null},e.Image.prototype.setParam=function(t,s){let o,n,a,l;if(!t)return null;if(s="true"===(d=s)||"false"!==d&&(e.isNumber(d)?parseFloat(d):d),"all"===t&&"object"==typeof s)return $.extend(!0,this.params,s),(s.colormap||s.contrast||s.bias)&&(l=this.getColormap(),s.colormap=s.colormap||l.colormap,s.contrast=s.contrast||l.contrast,s.bias=s.bias||l.bias,this.setColormap(s.colormap,s.contrast,s.bias)),(s.scale||s.scalemin||s.scalemax)&&(l=this.getScale(),s.scale=s.scale||l.scale,s.scalemin=s.scalemin||l.scalemin,s.scalemax=s.scalemax||l.scalemax,this.setScale(s.scale,s.scalemin,s.scalemax)),s.flip&&(this.setFlip("reset"),this.setFlip(s.flip)),s.rot90&&(this.setRot90("reset"),this.setRot90(s.rot90)),s.rotate&&(this.setRotate("reset"),this.setRotate(s.rotate)),s.invert&&(this.params.invert=s.invert,this.displayImage("colors")),s.zoom&&this.setZoom(s.zoom),s.wcssys&&this.setWCSSys(s.wcssys),s.wcsunits&&this.setWCSUnits(s.wcsunits),this.params;var d;if("disable"===t){for($.isArray(s)||(s=[s]),o=0;o<s.length;o++)n=$.inArray(s[o],this.params.disable),n<0&&this.params.disable.push(s[o]);return this.params.disable}if("enable"===t){for($.isArray(s)||(s=[s]),o=0;o<s.length;o++)n=$.inArray(s[o],this.params.disable),n>=0&&this.params.disable.splice(n,1);return this.params.disable}switch(a=this.params[t],this.params[t]=s,t){case"colormap":this.setColormap(s);break;case"invert":case"overlay":this.displayImage("colors");break;case"contrast":l=this.getColormap(),this.setColormap(l.colormap,s,l.bias);break;case"bias":l=this.getColormap(),this.setColormap(l.colormap,l.contrast,s);break;case"flip":this.setFlip("reset"),this.setFlip(s);break;case"rot90":this.setRot90("reset"),this.setRot90(s);break;case"rotate":this.setRotate("reset"),this.setRotate(s);break;case"scale":this.setScale(s);break;case"scalemin":l=this.getScale(),this.setScale("user",s,l.scalemax);break;case"scalemax":l=this.getScale(),this.setScale("user",l.scalemin,s);break;case"scaleclipping":l=this.getScale(),this.setScale(s,l.scalemin,l.scalemax);break;case"wcssys":this.setWCSSys(s);break;case"wcsunits":this.setWCSUnits(s);break;case"zoom":this.setZoom(s)}return a},e.Image.prototype.copyParams=function(t,s,o){let n,a,l,c,d,h=[];if(t){if(o=o||{},"string"==typeof t&&"["===t.charAt(0))try{t=JSON.parse(t)}catch(p){e.error(`can't parse JSON in copyParams: ${t}`,p)}if($.isArray(t)||(t=[t]),n=$.inArray("regions",t),n>=0&&(t.splice(n,1),t.unshift("regions")),"string"==typeof(s=s||e.images)&&"["===s.charAt(0))try{s=JSON.parse(s)}catch(p){e.error(`can't parse JSON in copyParams: ${s}`,p)}for($.isArray(s)||(s=[s]),n=0;n<s.length;n++)if(l=s[n],"string"==typeof l&&(l=e.lookupImage(l),l||e.error("unknown image for copyParams")),l!==this){l!==l.display.image&&$.inArray(l.display.image,h)<0&&h.push(l.display.image);try{for(a=0;a<t.length;a++)switch(c=t[a],c){case"alignment":l.alignPanZoom(this);break;case"contrastbias":d=this.getParam("contrast"),l.setParam("contrast",d),d=this.getParam("bias"),l.setParam("bias",d);break;case"pan":d=this.getPan(),l.setPan(e.pix2pix(this,l,{x:d.ox,y:d.oy}));break;case"regions":this.copyRegions(l);break;case"shapes":o.layer&&this.copyShapes(o.layer,l);break;case"wcs":d=this.getParam("wcssys"),l.setParam("wcssys",d),d=this.getParam("wcsunits"),l.setParam("wcsunits",d);break;default:d=this.getParam(c),l.setParam(c,d)}}catch{e.error(`could not copy params for ${l.id}`)}finally{if(h.length)for(n=0;n<h.length;n++)h[n].displayImage()}}}},e.Image.prototype.getStatus=function(t){if(!e.isNull(t)&&"string"==typeof t)switch(t.toLowerCase()){case"close":return this.status.close;case"displaysection":case"displayextension":return this.status.displaySection;case"createmosaic":return this.status.createMosaic;case"load":case"preload":return e.fetchURL.status?e.fetchURL.status:this.status.load;case"loadcatalog":return this.status.loadCatalog;case"loadcolormap":return this.status.loadColormap;case"loadproxy":return this.status.loadProxy;case"loadregions":return this.status.loadRegions;case"loadsession":return this.status.loadSession;case"reproject":case"reprojectdata":case"rotate":case"rotatedata":return this.status.reprojectData;case"runanalysis":return this.status.runAnalysis;case"separate":return this.status.separate;case"uploadfitsfile":return this.status.uploadFITSFile;default:return}},e.Image.prototype.setStatus=function(t,s){if(e.notNull(t)&&e.notNull(s))switch(s){case"error":case"complete":delete this.status.cur;break;default:this.status.cur=t}this.status[t]=s},e.Image.prototype.dataminmax=function(t,s){let o,n,a,l,c,d,h,p;if(n=this.raw,a=this.params,l=this.raw.data,h=Number.isNaN(a.scalemin)||!Number.isFinite(a.scalemin)||e.isNull(a.scalemin),p=Number.isNaN(a.scalemax)||!Number.isFinite(a.scalemax)||e.isNull(a.scalemax),"dataminmax"===a.scaleclipping&&((n.dmin===a.scalemin||e.isNull(n.dmin))&&(h=!0),(n.dmax===a.scalemax||e.isNull(n.dmax))&&(p=!0)),e.notNull(t)&&e.notNull(s))n.dmin=t,n.dmax=s;else if(n.dmin=Number.MAX_VALUE,n.dmax=Number.MIN_VALUE,n.bitpix>0)if(void 0!==n.header.BLANK)for(d=n.header.BLANK,o=0;o<l.length;o++)c=l[o],c!==d&&(c<n.dmin&&(n.dmin=c),c>n.dmax&&(n.dmax=c));else for(o=0;o<l.length;o++)c=l[o],c<n.dmin&&(n.dmin=c),c>n.dmax&&(n.dmax=c);else for(o=0;o<l.length;o++)c=l[o],!Number.isNaN(c)&&Number.isFinite(c)&&(c<n.dmin&&(n.dmin=c),c>n.dmax&&(n.dmax=c));return h&&(a.scalemin=n.dmin),p&&(a.scalemax=n.dmax),a.precision=e.floatPrecision(a.scalemin,a.scalemax),this},e.Image.prototype.zscale=function(t){let s,o,n,a,l;if(!e.zscale||!this.raw||!this.raw.data)return this;o=this.raw.data,n=o.length*o.BYTES_PER_ELEMENT;try{a=e.vmalloc(n)}catch(c){e.error(`image too large for zscale malloc: ${n}`,c)}try{e.vmemcpy(new Uint8Array(o.buffer),a)}catch(c){e.error(`can't copy image to zscale heap: ${n}`,c)}return s=e.zscale(a,this.raw.width,this.raw.height,this.raw.bitpix,this.params.zscalecontrast,this.params.zscalesamples,this.params.zscaleline),e.vfree(a),l=s.trim().split(/\s+/),this.params.z1=parseFloat(l[0]),this.params.z2=parseFloat(l[1]),"zmax"===t?(this.params.scalemin=this.params.z1,this.params.scalemax=this.raw.dmax):t&&(this.params.scalemin=this.params.z1,this.params.scalemax=this.params.z2),this.params.precision=e.floatPrecision(this.params.scalemin,this.params.scalemax),this},e.Image.prototype.countsInRegions=function(...t){let s,o,n,a,l,c,d,h,p,g,v="field",r="";const u=(f,m)=>{let b,w,A,x;const y=/(annulus|box|circle|ellipse|line|polygon|point|text) *\(/;if(!f)return m;if("string"==typeof f){if(x=this.expandMacro(f),!x)return m;if(x.match(y))return x}for(w=this.getShapes("regions",f),(!w||!w.length)&&e.error(`no regions found: ${f}`),x="",b=0;b<w.length;b++)A=w[b],this.params.wcssys?(x||(x=A.wcssys||""),x+=`; ${A.wcsstr}`):(x||(x=A.imsys||""),x+=`; ${A.imstr}`);return x||m};for((!this.raw.hdu||!this.raw.hdu.fits||!this.raw.hdu.fits.vfile)&&e.error(`no virtual file available for regcnts: ${this.id}`),s=0;s<t.length;s++)if(o=t[s],"string"==typeof o&&"{"===o.charAt(0))try{t[s]=JSON.parse(o)}catch(f){e.error(`can't parse JSON arg in regcnts: ${o}`,f)}switch(t.length){case 0:break;case 1:"object"==typeof t[0]?p=t[0]:v=u(t[0],"field");break;case 2:v=u(t[0],"field"),"object"==typeof t[1]?p=t[1]:r=u(t[1],"");break;default:v=u(t[0],"field"),r=u(t[1],""),p=t[2]}if(p=p||{},p.reduce=p.reduce||e.globalOpts.reduceRegcnts,p.dim=p.dim||Math.max(e.globalOpts.image.xdim,e.globalOpts.image.ydim),g=p.cmdswitches||"",n=this.raw.hdu.fits.vfile,c=this.file.match(/\[.*\]/),c&&(n+=c),"table"===this.imtab?(d=this.raw.hdu.table.filter,d&&!n.match(d)&&(n.match(/\]\[/)?n=`${n.slice(0,-1)}&&${d}]`:n+=`[${d}]`)):3===this.raw.header.NAXIS&&g.search(/(^| )-c/)<0&&(g+=` -c ${this.raw.hdu.slice||1}`),p.reduce&&!this.parentFile&&this.raw.header.NAXIS<3){const{xdim:f,ydim:m}=this.fileDimensions();h=Math.floor(Math.max(f,m)/p.dim+.5),h>1&&("table"===this.imtab?g+=` -b ${h}`:(a=`bin${h}_${n.split("/").reverse()[0]}`,l=`0@0,0@0,${h}`,e.imsection(n,a,l,""),n=a))}return e.waiting(!0,this.display),o=e.regcnts(n,v,r,g),e.waiting(!1),a&&e.vunlink(a),(o.match(/^ERROR/)||o.match(/FITSIO status/))&&e.error(o),p.lightwin&&this.displayAnalysis("text",o,{divid:e.globalOpts.analysisDiv}),o},e.Image.prototype.radialProfile=function(...t){let s,o,n,a,l,c,d,h,p,g,v,r,u;const f=[],m={cmdswitches:"-G -j -r"};for(s=0;s<t.length;s++)"object"==typeof t[s]?(c=$.extend(!0,{},t[s],m),f.push(c),g=c):f.push(t[s]);if(c||f.push(m),g=g||{},o=this.countsInRegions(...f),o)try{l=JSON.parse(o)}catch(b){e.error("can't parse regcnts JSON",b)}for((!l||!l.columnUnits||!l.columnUnits.radii)&&e.error("no radii available for radial profile"),n=l.columnUnits.radii,a=l.columnUnits.surfBrightness,v=g.color||"green",u=g.errorcolor||"red",r=e.isNull(g.errorbars)||g.errorbars?"y":"n",d={color:sprintf("%s",v),label:sprintf("surface brightness(%s) vs. radius(%s)",a,n),points:{errorbars:sprintf("%s",r),yerr:{show:"true",color:sprintf("%s",u)}},data:[]},s=0;s<l.backgroundSubtractedResults.length;s++)h=l.backgroundSubtractedResults[s],("undefined"===h.radius2||"NA"===h.radius2||h.radius1>h.radius2)&&e.error("radial profile source region must be an annulus"),p=[(h.radius1+h.radius2)/2,h.surfBrightness,h.surfError],d.data.push(p);return this.displayAnalysis("plot",d,{divid:e.globalOpts.analysisDiv})},e.Image.prototype.plot3d=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w;const A=[];for((!this.raw.header||3!==this.raw.header.NAXIS)&&e.error("plot3d requires a data cube with 3 dimensions"),(o=$.extend(!0,{},o,e.globalOpts.plot3d)).cube=o.cube||"*:*:all",c=o.cube.split(":"),n=0;n<c.length;n++)if("all"===c[n]){m=n+1;break}if(m||e.error("plot3d requires specification of cube's third index"),o.cmdswitches=`-j -c ${o.cube}`,v=o.mode||"avg",o.areaunits?o.areaunits.match(/^p/)?(o.areaunits="pixels",o.cmdswitches+=" -p"):o.areaunits.match(/^a/)?o.areaunits="arcsec":(o.areaunits="pixels",o.cmdswitches+=" -p"):(o.areaunits="pixels",o.cmdswitches+=" -p"),g=o.color||"green",l=this.countsInRegions(t,s,o),l)try{d=JSON.parse(l)}catch(x){e.error(`can't parse regcnts results: ${l}`,x)}for(d||e.error("no regcnts info available for plot3d"),l=this.raw.header[`CTYPE${String(m)}`],u=l?l.toLowerCase():"slice",f="avg"===v?"pixels"===o.areaunits?"counts/pixel**2":"counts/arcsec**2":"summed counts",p={color:sprintf("%s",g),label:sprintf("%s vs %s ",f,u),data:[]},b=this.raw.header[`CRVAL${String(m)}`]||0,w=this.raw.header[`CDELT${String(m)}`]||1,n=0;n<d.source.cubeSlices;n++){for(l=`backgroundSubtractedResults${String(n+1)}`,A[n]=0,a=0;a<d[l].length;a++)A[n]+="avg"===v?d[l][a].surfBrightness:d[l][a].netCounts;h=[n*w+b,A[n]],p.data.push(h)}return r=o.divid||e.globalOpts.analysisDiv,this.displayAnalysis("plot",p,{divid:r})},e.Image.prototype.rawDataLayer=function(...t){let s,o,n,a,l,c,d,h,p,g,v,r,[u,f]=t;if(!t.length)return this.raw.id;if(u=u||{},"string"==typeof u){if("function"!=typeof f){for(n=u,a=f,s=0;s<this.raws.length;s++)if(l=this.raws[s],n===l.id){if("remove"===a){if(n===e.RAWID0&&e.error("can't remove primary (raw0) data layer"),l.hdu&&l.hdu.fits&&(v=e.lookupVfile(l.hdu.fits.vfile),v.length<=1&&e.cleanupFITSFile(l,!0)),this.raw=this.raws[0],l.current0&&l.current0.id)for(o=0;o<this.raws.length;o++)if(l.current0.id===this.raws[o].id){this.raw=this.raws[o];break}for(o=0;o<e.images.length;o++)r=e.images[o],r&&r.xeqstash&&r.xeqStashDiscard(n);this.raws.splice(s,1)}else this.raw=l;return this.raw.header.BITPIX&&(this.raw.bitpix=this.raw.header.BITPIX),this.imtab=this.raw.imtab||this.imtab,this.params.scalemin=void 0,this.params.scalemax=void 0,this.dataminmax(),this.mkSection(),this.initWCS(),this.initLCS(),this.displayImage("all"),this.refreshLayers(),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onrawdatalayer"),!0}return!1}u={rawid:u}}if("function"!=typeof f)return!1;if(h=u.rawid||e.RAWIDX,void 0===u.oraw&&(u.oraw="current0"),"current"===u.oraw)c=this.raw;else if("current0"===u.oraw)c=this.raw.id===h?this.raw.current0:this.raw;else for(s=0;s<this.raws.length;s++)if(l=this.raws[s],u.oraw===l.id){c=l;break}for(c||(c=this.raws[0]),p=-1,s=0;s<this.raws.length;s++)if(h===this.raws[s].id){d=this.raws[s],p=s;break}if(p<0||u.alwaysCopy){if(d=$.extend(!0,{},c),d.current0=c,u.bitpix){switch(u.bitpix){case 8:d.data=new Uint8Array(c.height*c.width);break;case 16:d.data=new Int16Array(c.height*c.width);break;case-16:d.data=new Uint16Array(c.height*c.width);break;case 32:d.data=new Int32Array(c.height*c.width);break;case-32:d.data=new Float32Array(c.height*c.width);break;case-64:d.data=new Float64Array(c.height*c.width);break;default:e.error(`unsupported bitpix: ${u.bitpix}`)}for(g=d.width*d.height,s=0;s<g;s++)d.data[s]=c.data[s];d.bitpix=u.bitpix}else switch(c.bitpix){case 8:d.data=new Uint8Array(c.data);break;case 16:d.data=new Int16Array(c.data);break;case-16:d.data=new Uint16Array(c.data);break;case 32:d.data=new Int32Array(c.data);break;case-32:d.data=new Float32Array(c.data);break;case-64:d.data=new Float64Array(c.data);break;default:e.error(`unsupported bitpix: ${c.bitpix}`)}d.id=h,d.from=u.from||d.from||"func"}return f.call(this,c,d,u)&&(p>=0?this.raws[p]=d:this.raws.push(d),this.raw=d,this.raw.header.bitpix&&(this.raw.bitpix=this.raw.header.bitpix),!1!==u.dataminmax&&this.dataminmax(),u.updatewcs&&(this.initWCS(),this.initLCS()),u.resetpan&&this.setPan(),this.refreshLayers(),this.displayImage("all",u),this.reFlipRot()),!0},e.Image.prototype.gaussBlurData=function(t,s){if(void 0===t&&e.error("missing sigma value for gaussBlurData"),this.params.sigma=t,"string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(o){e.error(`can't parse gaussBlur opts: ${s}`,o)}return s.bitpix=-64===this.raw.bitpix?-64:-32,s.oraw="current0",s.alwaysCopy=!0,s.rawid=s.rawid||"gaussBlur",s.sigma=t,this.xeqStashSave("gaussBlurData",[t],s.rawid),this.rawDataLayer(s,(o,n)=>{let a;switch(n.bitpix){case-32:a=new Float32Array(n.data);break;case-64:a=new Float64Array(n.data);break;default:e.error(`invalid temp bitpix for gaussBlur: ${n.bitpix}`)}return gaussBlur(a,n.data,n.width,n.height,t),!0}),this},e.Image.prototype.imarithData=function(...t){let s,[o,n,a]=t;if(!t.length)return["add","sub","mul","div","min","max","reset"];if(a=a||{},"string"==typeof a)try{a=JSON.parse(a)}catch(l){e.error(`can't parse imarith opts: ${a}`,l)}if(a.rawid=a.rawid||"imarith","reset"!==o&&"remove"!==o){switch((void 0===o||void 0===n)&&e.error("missing arg(s) for image arithmetic"),this.xeqStashSave("imarithData",t.slice(),a.rawid),o){case"add":case"sub":case"mul":case"div":case"min":case"max":a.op=o;break;default:e.error(`invalid operator for image arithmetic: ${o}`)}if("object"==typeof n?((this.raw.width!==n.raw.width||this.raw.height!==n.raw.height)&&e.error("images must be the same size for image arithmetic"),a.argtype="image",a.argval=n):e.isNumber(n)?(a.argtype="value",a.argval=n):(s=e.lookupImage(n),s||e.error(`imarith arg1 must be an image or a constant: ${n}`),a.argval=s,a.argtype="image"),"div"===a.op&&"value"===a.argtype&&0===a.argval&&e.error("imarith can't divide by zero (nor can anyone else)"),!a.bitpix)switch(a.argtype){case"image":a.bitpix=this.raw.bitpix>0&&a.argval.raw.bitpix>0?Math.max(this.raw.bitpix,a.argval.raw.bitpix):this.raw.bitpix<0&&a.argval.raw.bitpix<0?Math.min(this.raw.bitpix,a.argval.raw.bitpix):this.raw.bitpix<0&&a.argval.raw.bitpix>0?this.raw.bitpix:a.argval.raw.bitpix;break;case"value":a.bitpix=-64===this.raw.bitpix?-64:-32}return a.alwaysCopy=!0,a.oraw="current",this.rawDataLayer(a,(l,c,d)=>{let h,p;switch(d.argtype){case"image":switch(p=d.argval.raw.data,d.op){case"add":for(h=0;h<c.data.length;h++)c.data[h]+=p[h];break;case"sub":for(h=0;h<c.data.length;h++)c.data[h]-=p[h];break;case"mul":for(h=0;h<c.data.length;h++)c.data[h]*=p[h];break;case"div":for(h=0;h<c.data.length;h++)0===p[h]?c.data[h]=0:c.data[h]/=p[h];break;case"min":for(h=0;h<c.data.length;h++)c.data[h]=Math.min(c.data[h],p[h]);break;case"max":for(h=0;h<c.data.length;h++)c.data[h]=Math.max(c.data[h],p[h]);break;default:e.error(`unknown operation for imarith: ${d.op}`)}break;case"value":switch(p=d.argval,d.op){case"add":for(h=0;h<c.data.length;h++)c.data[h]+=p;break;case"sub":for(h=0;h<c.data.length;h++)c.data[h]-=p;break;case"mul":for(h=0;h<c.data.length;h++)c.data[h]*=p;break;case"div":for(h=0;h<c.data.length;h++)0===p?c.data[h]=0:c.data[h]/=p;break;case"min":for(h=0;h<c.data.length;h++)c.data[h]=Math.min(c.data[h],p);break;case"max":for(h=0;h<c.data.length;h++)c.data[h]=Math.max(c.data[h],p);break;default:e.error(`unknown op for imarith: ${d.op}`)}break;default:e.error(`unknown arg type for imarith: ${d.argtype}`)}return!0}),this}this.rawDataLayer(a.rawid,"remove")},e.Image.prototype.shiftData=function(...t){let[s,o,n]=t;if((void 0===s||void 0===o)&&e.error("missing translation value(s) for shiftData"),n=n||{},"string"==typeof n)try{n=JSON.parse(n)}catch(a){e.error(`can't parse shift opts: ${n}`,a)}return n.rawid=n.rawid||"shift",n.x=parseFloat(s),n.y=parseFloat(o),this.xeqStashSave("shiftData",t.slice(),n.rawid),this.rawDataLayer(n,(a,l,c)=>{let d,h,p,g,v,r,u,f,m,b,w;const A=a.data.BYTES_PER_ELEMENT;if(void 0===l.xoff&&(l.xoff=0),void 0===l.yoff&&(l.yoff=0),l.xoff+=c.x,l.yoff+=c.y,!c.fill||"clear"===c.fill)if(l.bitpix>0?(w=c.blank||l.header.BLANK||0,l.header.BLANK=w):w=NaN,"function"==typeof l.data.fill)l.data.fill(w);else for(d=0;d<l.data.length;d++)l.data[d]=w;for(p=0;p<a.height;p++)if(v=p+l.yoff,!(v<0||v>=a.height)){if(h=0,g=h+l.xoff,r=a.width,g<0&&(h-=g,r+=g,g=0),g+r>a.width&&(r-=g+r-a.width),r<=0)return!1;m=(p*a.width+h)*A,u=new Uint8Array(a.data.buffer,m,r*A),b=(v*a.width+g)*A,f=new Uint8Array(l.data.buffer,b,r*A),f.set(u)}return!0}),this},e.Image.prototype.rotateData=function(...t){let s,o,n,a,l,c,d,h,p=0,g=0,[v,r]=t;if((!this.raws||!this.raws[0])&&e.error("no raw data for reprojection"),s=this.raws[0],(!s.header||!s.wcsinfo)&&e.error("no WCS info available for reprojection"),r=r||{},"string"==typeof r)try{r=JSON.parse(r)}catch(u){e.error(`can't parse rotate opts: ${r}`,u)}if(r.stash="rotateData",r.rawid="rotate",r.oraw=e.RAWID0,!0!==r.resetSection&&(r.resetSection=!1),o=s.header,n=$.extend(!0,{},o),r.center=r.center||e.globalOpts.rotationCenter,"file"!==r.center&&this.validWCS()&&(d=this.getPan(),h=e.pix2wcs(this.raw.wcs,d.x,d.y).trim().split(/\s+/),h&&h.length>1&&(n.CRPIX1=d.x,n.CRPIX2=d.y,n.CRVAL1=e.saostrtod(h[0]),e.isHMS(this.params.wcssys)&&(n.CRVAL1*=15),n.CRVAL2=e.saostrtod(h[1]))),s.wcsinfo&&(p=s.wcsinfo.cdelt1||0,g=s.wcsinfo.cdelt2||0),"string"==typeof v)switch(v.toLowerCase()){case"northisup":case"northup":v=0,p>0&&(p=-p),g<0&&(g=-g);break;default:v=parseInt(v,10)}return e.notNull(o.CD1_1)?(a=-v*Math.PI/180,l=Math.sin(a),c=Math.cos(a),n.CD1_1=o.CD1_1*c+o.CD1_2*l,n.CD1_2=o.CD1_1*-l+o.CD1_2*c,n.CD2_1=o.CD2_1*c+o.CD2_2*l,n.CD2_2=o.CD2_1*-l+o.CD2_2*c):(n.CROTA2=v,n.CDELT1=p,n.CDELT2=g),r.lcsUseRota2=!0,s.wcsinfo&&(n.ptype=s.wcsinfo.ptype),this.xeqStashSave("rotateData",t.slice(),r.rawid),this.reprojectData(n,r)},e.Image.prototype.reproject=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C,I,L,D,O,M,E,R,H,N,B=!1;const P={},z=/SIMPLE|BITPIX|NAXIS|NAXIS[1-4]|AMDX|AMDY|CD[1-2]_[1-2]|CDELT[1-4]|CNPIX[1-4]|CO1_[1-9][0-9]|CO2_[1-9][0-9]|CROTA[1-4]|CRPIX[1-4]|CRVAL[1-4]|CTYPE[1-4]|CUNIT[1-4]|DATE|DATE_OBS|DC-FLAG|DEC|DETSEC|DETSIZE|EPOCH|EQUINOX|EQUINOX[a-z]|IMAGEH|IMAGEW|LATPOLE|LONGPOLE|MJD-OBS|PC00[1-4]00[1-4]|PC[1-4]_[1-4]|PIXSCALE|PIXSCAL[1-2]|PLTDECH|PLTDECM|PLTDECS|PLTDECSN|PLTRAH|PLTRAM|PLTRAS|PPO|PROJP[1-9]|PROJR0|PV[1-3]_[1-3]|PV[1-4]_[1-4]|RA|RADECSYS|SECPIX|SECPIX|SECPIX[1-2]|UT|UTMID|VELOCITY|VSOURCE|WCSAXES|WCSDEP|WCSDIM|WCSNAME|XPIXSIZE|YPIXSIZE|ZSOURCE|LTM|LTV/,J=/TAN|SIN|ZEA|STG|ARC/,q=(G,ee)=>{let le;return ee?(le=$.extend(!0,{},G),e.isNull(le.CRVAL1)&&!e.isNull(ee.crval1)&&(le.CRVAL1=ee.crval1),e.isNull(le.CRVAL2)&&!e.isNull(ee.crval2)&&(le.CRVAL2=ee.crval2),e.isNull(le.CRPIX1)&&!e.isNull(ee.crpix1)&&(le.CRPIX1=ee.crpix1),e.isNull(le.CRPIX2)&&!e.isNull(ee.crpix2)&&(le.CRPIX2=ee.crpix2),e.isNull(le.CDELT1)&&!e.isNull(ee.cdelt1)&&(le.CDELT1=ee.cdelt1),e.isNull(le.CDELT2)&&!e.isNull(ee.cdelt2)&&(le.CDELT2=ee.cdelt2),e.isNull(le.CROTA2)&&!e.isNull(ee.crot)&&(le.CROTA2=ee.crot),le):G};if(e.reproject&&t&&this!==t){for(m of((!this.raws||!this.raws[0])&&e.error("no raw data for reprojection"),C=this.raws[0],(!C.header||!C.wcsinfo)&&e.error("no WCS info available for reprojection"),s=s||{},h=$.extend(!0,{},C.header),Object.keys(h)))z.test(m)&&delete h[m];if("object"==typeof t){for(m of(t.raw&&t.raw.header?p=t.raw.header:t.BITPIX&&t.NAXIS1&&t.NAXIS2?p=t:e.error("invalid wcs object input to reproject()"),Object.keys(p)))z.test(m)&&(P[m]=p[m]);if(c=$.extend(!0,{},P,h),!c.NAXIS||!c.NAXIS1||!c.NAXIS2)return;c.NAXIS1=Math.min(c.NAXIS1,e.globalOpts.image.xdim),c.NAXIS2=Math.min(c.NAXIS2,e.globalOpts.image.ydim),d=e.raw2FITS(c,{addcr:!0}),a=`wcs_${e.uniqueID()}.txt`,e.vfile(a,d),e.globalOpts.reprojectLimits&&(R=e.globalOpts.image.xdim,H=e.globalOpts.image.ydim,N=e.globalOpts.image.xdim*e.globalOpts.image.ydim,C.header.NAXIS1*C.header.NAXIS2>N&&e.error(`the max reproject size is ${R} * ${H}. You can use the Bin/Filter/Section plugin to extract a section, then save it as FITS and reproject the smaller image.`))}else a=t;try{J.test(C.wcsinfo.ptype)||(g=q(C.header,C.wcsinfo),l=`owcs_${e.uniqueID()}.txt`,e.vfile(l,e.raw2FITS(g,{addcr:!0})),o=`awcs_${e.uniqueID()}.txt`,f=e.tanhdr(l,o,""),e.DEBUG>1&&e.log("tanhdr (input): %s %s -> %s",l,o,f),e.vunlink(l),f.search(/\[struct stat="OK"/)>=0&&(s.cmdswitches=s.cmdswitches||"",s.cmdswitches+=` -i ${o}`)),(t.raw&&!J.test(t.raw.wcsinfo.ptype)||t.ptype&&!J.test(t.ptype))&&(g=q(p,t.raw.wcsinfo),l=`owcs_${e.uniqueID()}.txt`,e.vfile(l,e.raw2FITS(g,{addcr:!0})),n=`awcs_${e.uniqueID()}.txt`,f=e.tanhdr(l,n,""),e.DEBUG>1&&e.log("tanhdr (reproj): %s %s -> %s",l,n,f),e.vunlink(l),f.search(/\[struct stat="OK"/)>=0&&(e.vunlink(a),a=n))}catch{}for(C.hdu&&C.hdu.fits.vfile?(r=C.hdu.fits.vfile,C.hdu.fits.extname?r+=`[${C.hdu.fits.extname}]`:C.hdu.fits.extnum&&C.hdu.fits.extnum>0&&(r+=`[${C.hdu.fits.extnum}]`)):(v=this.toArray(),r=this.id.replace(/\.png$/,"_png.fits"),e.vfile(r,v)),S=this.id.replace(/\[.*\]/,"").replace(/\.png$/i,".fits").replace(/\.fz$/i,"").replace(/\.gz$/i,""),u=`reproj_${e.uniqueID()}_${S}`,M=s.rawid||"reproject",O=0;O<this.raws.length&&(E=this.raws[O],E.id!==M||!e.cleanupFITSFile(E,!0));O++);C.hdu&&"table"===C.hdu.imtab&&C.hdu.table&&(r.match(/\[bin /)||(r.match(/\[EVENTS\]/)||(r+="[EVENTS]"),b=C.hdu.table,w=Math.floor(b.xcen-b.xdim/2+1),A=Math.floor(b.xcen+b.xdim/2),x=Math.floor(b.ycen-b.ydim/2+1),y=Math.floor(b.ycen+b.ydim/2),r+=`[bin X=${w}:${A},Y=${x}:${y}]`));try{_=u.lastIndexOf("."),_>=0&&(I=`${u.substring(0,_)}_area${u.substring(_)}`),D=s.cmdswitches||"",D+=` -a 0 ${e.globalOpts.reprojSwitches}`,f=e.reproject(r,u,a,D),e.DEBUG>1&&e.log("reproject: %s %s %s [%s] -> %s",r,u,a,D,f),e.vunlink(I),e.vunlink(a),o&&e.vunlink(o),v&&e.vunlink(r),f.search(/\[struct stat="OK"/)<0&&(B=!0,L=f.match(/msg="(.*)"/),e.error(L&&L[1]?`${L[1]} (from mProjectPP)`:f))}catch(G){if(B)return;e.vunlink(I),e.vunlink(a),f?e.error(f):e.error("WCS reproject failed",G)}return u}},e.Image.prototype.reprojectData=function(...t){let s,o,n,[a,l]=t;if(a&&e.reproject){if("string"==typeof a){if("all"===a){for(s=0;s<e.images.length;s++)o=e.images[s],this.display.id===o.display.id&&o.reprojectData(this);return}o=e.getImage(a),o?a=o:e.error(`unknown WCS for reproject: ${a}`)}if(this!==a){if(l=l||{},"string"==typeof l)try{l=JSON.parse(l)}catch(c){e.error(`can't parse reproject opts: ${l}`,c)}return l.rawid||this.xeqStashSave("reprojectData",t.slice(),"reproject"),l.stash||(l.stash="reprojectData"),e.waiting(!0,this.display),this.setStatus("reprojectData","processing"),window.setTimeout(()=>{let c,d;if(l=l||{},d=l.reprojHandler||(p=>{if(this.xeqPlugins("image","onreprojectdata"),c=c||{},c.refreshRegions=!0,!1!==l.resetSection&&(c.resetSection=!0),l.lcsUseRota2&&(c.lcsUseRota2=!0),this.refreshImage(p,c),this.setStatus("reprojectData","complete"),this.xeqStashCall(this.xeqstash,[l.stash,"reprojectData"]),"function"==typeof l.onreproject)try{e.xeqByName(l.onreproject,window,this)}catch(g){e.error("in onreproject callback",g,!1)}}),n=this.reproject(a,l),n){c=$.extend(!0,{},e.fits.options,l),c.rawid=c.rawid||"reproject",a.raw&&a.raw.header&&(c.wcsim=a);try{e.handleFITSFile(n,c,d)}catch(p){e.error("can't process reprojected FITS file",p)}}},e.SPINOUT),this}}},e.Image.prototype.filterRGBImage=function(...t){let[s]=t;if(!s)return Object.keys(e.ImageFilters);switch(s){case"reset":return this.setColormap("reset"),this;case"median":s="medianFilter";break;case"edge":s="edgeDetect"}e.ImageFilters[s]||e.error(`JS9 image filter '${s}' not available`),this.xeqStashSave("filterRGBImage",t.slice()),t.shift(),t.unshift(this.display.context,this.rgb.img);try{e.ImageFilters[s](...t)}catch(o){e.error(`JS9 image filter '${s}' failed`,o)}return this.displayImage("display"),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onfilterrgbimage"),this},e.Image.prototype.moveToDisplay=function(t){let s,o,n,a,l,c=0;const d=this.display,h=e.lookupDisplay(t);for(n of((!t||!h)&&e.error(`could not find display: ${t}`),this.display.clearMessage(),this.display.context.clear(),this.xeqPlugins("image","onimageclear"),Object.keys(d.layers)))"main"===d.layers[n].dtype&&!h.layers[n]&&h.newShapeLayer(n,d.layers[n].opts);if(h.image)for(n of Object.keys(h.layers))"main"===h.layers[n].dtype&&h.image.showShapeLayer(n,!1,{local:!0});for(n of Object.keys(this.layers))a=this.layers[n],l=h.layers[n],l?(this.showShapeLayer(n,!1,{local:!0}),a.dlayer=l,a.divjq=l.divjq,a.canvasjq=l.canvasjq,a.canvas=l.canvas):delete this.layers[n];for(n of(this.display=h,this.display.image=this,this.mkSection(),this.displayImage("all"),Object.keys(this.layers)))this.showShapeLayer(n,!0,{local:!0});for(d.rgb.rim===this&&(d.rgb.rim=null,h.rgb.rim=this),d.rgb.gim===this&&(d.rgb.gim=null,h.rgb.gim=this),d.rgb.bim===this&&(d.rgb.bim=null,h.rgb.bim=this),d.image=null,this.refreshLayers(),s=0;s<e.images.length;s++)if(o=e.images[s],d===o.display){o.display.image=null,o.displayImage("all"),o.refreshLayers(),c++;break}return!c&&d.winid&&d.winid.close&&(s=$.inArray(d,e.displays),s>=0&&e.displays.splice(s,1),d.winid.close()),this},e.Image.prototype.saveSession=function(t,s){let o,n,a,l,c,d,h,p,g,v,r;const u=f=>{let m;const b={};for(p of(window.electron?(m=new RegExp(`^${window.electron.currentDir}/`),b.file=f.file.replace(m,"")):b.file=f.file,b.dwidth=f.display.width,b.dheight=f.display.height,b.params=$.extend(!0,{},f.params),b.tmp={},"active"===f.tmp.gridStatus&&(b.tmp.gridStatus="active"),v=f.imageToLogicalPos({x:f.rgb.sect.xcen,y:f.rgb.sect.ycen}),r=f.maybePhysicalToImage(v),r&&(v=r),b.sect={},b.sect.xcen=v.x,b.sect.ycen=v.y,b.sect.xdim=f.raw.width,b.sect.ydim=f.raw.height,b.sect.zoom=f.rgb.sect.zoom,b.layers=[],Object.keys(f.layers)))c=f.layers[p],d=c.dlayer,"main"===d.dtype&&"crosshair"!==p&&"grid"!==p&&(h={},h.name=p,h.json=d.canvas.toJSON(d.el),h.dopts=$.extend(!0,{},d.opts),c.catalog&&(h.catalog=c.catalog),c.starbase&&(h.starbase=JSON.stringify(c.starbase)),b.layers.push(h)),d.canvas.forEachObject(w=>{w.params&&w.params.winid&&($(w.params.winid).is(":visible")?e.error("please close your region dialog box(es) to avoid a JSON circular reference error when saving this session"):w.params.winid=null)});return b.blend=f.blend,b.xeqstash=f.xeqstash,f.wcsim&&f.wcsim.id&&(b.wcsim=f.wcsim.id),delete b.params.display,b.params.rot90=0,b.params.flip="none",b.params.crosshair=!1,b};if({}.hasOwnProperty.call(window,"saveAs")||e.error("no saveAs() available to save session"),(t=t||"js9.ses").match(/\.ses$/)||(t+=".ses"),"string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(f){e.error(`can't parse session opts: ${s}`,f)}if(e.waiting(!0,this.display),n={},n.images=[],"display"===s.mode)for(o=0;o<e.images.length;o++)g=e.images[o],g.display.id===this.display.id&&n.images.push(u(g));else n.images.push(u(this));for(n.display={blendMode:this.display.blendMode},n.globals=$.extend(!0,{},e.globalOpts),delete n.globals.rgb,n.cmaps=[],o=0;o<e.colormaps.length;o++)"user"===e.colormaps[o].source&&n.cmaps.push(e.colormaps[o]);try{a=JSON.stringify(n,null,4)}catch(f){e.error("can't create json file for save session",f)}return l=new Blob([a],{type:"application/json"}),e.saveAs(l,t),e.waiting(!1),t},e.Image.prototype.xeqStashSave=function(t,s,o,n){let a,l,c;for(n=n||"image",this.xeqstash=this.xeqstash||[],a=0;a<s.length;a++)"object"==typeof s[a]&&(s[a]instanceof e.Image||s[a]instanceof e.Display)&&(s[a]=s[a].id);switch(t){case"setRot90":if(c=this.xeqstash.length,c>=1&&this.xeqstash[c-1]&&this.xeqstash[c-1].args[0]===-s[0])return this.xeqstash.pop(),this;break;case"setFlip":if(c=this.xeqstash.length,c>=1&&this.xeqstash[c-1]&&this.xeqstash[c-1].args[0]===s[0])return this.xeqstash.pop(),this;break;default:for(a=0;a<this.xeqstash.length;a++)if(l=this.xeqstash[a],l&&l.func===t&&l.context===n)return l.args=s,this}return this.xeqstash.push({func:t,args:s,id:o,context:n}),this},e.Image.prototype.xeqStashCall=function(t,s){let o,n,a;const l=(c,d)=>{let h=d.context||"image";try{switch(h){case"image":default:this[c](...d.args);break;case"display":this.display[c](...d.args)}}catch(p){e.error(`error executing stash: ${c}`,p,!1)}};if(t=t||this.xeqstash,$.isArray(t))for(o=0;o<t.length;o++)a=t[o],n=a.func,!($.inArray(n,s)>=0)&&l(n,a);else for(n of Object.keys(t))$.inArray(n,s)>=0||(a=t[n],l(n,a))},e.Image.prototype.xeqStashDiscard=function(t){let s,o;if(this.xeqstash)if($.isArray(this.xeqstash))for(s=this.xeqstash.length-1;s>=0;s--)(t===this.xeqstash[s].func||t===this.xeqstash[s].id)&&this.xeqstash.splice(s,1);else for(o of Object.keys(this.xeqstash))(t===o||t===this.xeqstash[o].id)&&delete this.xeqstash[o]},e.Image.prototype.xeqPlugins=function(t,s,o){let n,a,l,c,d;const h=(p,g)=>{const v=`JS9:${p}`;$(document).trigger(v,g)};if(t&&s&&e.globalOpts.xeqPlugins){for(n of(c=this.display.pluginInstances||{},Object.keys(c)))if(a=c[n],l=a.plugin.opts,a.isActive(s)&&"function"==typeof l[s]){switch(this.callingPlugin=s,t){case"image":try{l[s].call(a,this),h(s,{im:this})}catch(p){a.errLog(s,p)}break;case"region":case"shape":try{l[s].call(a,this,o),h(s,{im:this,xreg:o})}catch(p){a.errLog(s,p)}break;case"keydown":case"keypress":d=o.originalEvent||o;try{l[s].call(a,this,this.ipos,d),h(s,{im:this,ipos:this.ipos,evt:d})}catch(p){a.errLog(s,p)}break;case"mouse":if(!this.clickInRegion||l[`${s}_inRegion`]){d=o.originalEvent||o;try{l[s].call(a,this,this.ipos,d),h(s,{im:this,ipos:this.ipos,evt:d})}catch(p){a.errLog(s,p)}}}delete this.callingPlugin}return this}},e.Image.prototype.uploadFITSFile=function(){let t,s;const o=n=>{delete e.worker.uploadActive,window.setTimeout(()=>{e.progress(!1)},1e3),n.stderr?e.error(n.stderr):n.stdout&&(this.fitsFile=n.stdout.trim(),this.proxyFile=this.fitsFile,e.globalOpts.prependJS9Dir&&!this.fitsFile.match(/^\${JS9_DIR}/)&&"/"!==this.fitsFile.charAt(0)&&(this.fitsFile=`\${JS9_DIR}/${this.fitsFile}`),this.queryHelper("all"))};if(e.worker&&("nodejs"===e.helper.type||"socket.io"===e.helper.type)&&this.raw.hdu&&this.raw.hdu.fits&&this.raw.hdu.fits.vfile)return e.worker.uploadActive&&e.error("only one upload allowed at a time"),t=this.raw.hdu.fits.vfile,e.helper.send("quotacheck",null,n=>{(n.stderr||n.errcode)&&e.error(n.stderr||`from quotacheck: ${n.errcode}`),s=e.vread(t,"binary"),e.worker.socketio(()=>{e.worker.uploadActive=!0,e.progress(!0,this.display),e.worker.send("uploadFITS",[t,s],o,[s.buffer])})}),this},e.Image.prototype.removeProxyFile=function(t){let s,o,n,a;if("boolean"==typeof t)o=t;else if("string"==typeof t){if(t.match(/^\//)||(a=new RegExp(`^${e.INSTALLDIR}`),s=t.replace(a,""),s.match(/\.\./)))return;n=t}else{if(!this.proxyFile)return;n=this.proxyFile,this.proxyParent&&(n=`${n} ${this.proxyParent}`)}!n||e.Send("removeproxy",{cmd:`js9Xeq removeproxy ${n}`},c=>{o&&c&&"OK"===c.stdout.trim()&&(this.proxyFile=null,this.proxyParent=null,this.fitsFile=null,this.analysisPackages=null,this.queryHelper("all"))})},e.Image.prototype.starbaseToShapes=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y;const S=e.globalOpts.catalogs,C=e.globalOpts.catalogs.decs,I=[],L=(O,M)=>{let E;return E=e.wcs2pix(this.raw.wcs,O,M).trim().split(/ +/),E&&E.length?{x:parseFloat(E[0]),y:parseFloat(E[1])}:null},D=(O,M,E,R)=>{let H,N,B;if(void 0!==R)B=R;else{for(B=-1,N=0;N<E.length;N++){for(H=0;H<M.length;H++)if(E[N].toLowerCase()===M[H].toLowerCase()){B=O[M[H]];break}if(B>=0)break}if(B<0)for(x=E[0],y=new RegExp(`^${x}`,"i"),H=0;H<M.length;H++)if(M[H].match(y)){B=O[M[H]];break}if(B<0)for(x=E[0],y=new RegExp(`.*${x}.*`,"i"),H=0;H<M.length;H++)if(M[H].match(y)){B=O[M[H]];break}}return B};if(t&&t.data&&t.headline){switch(p=t.data,g=t.headline,v=t.delims,u=D(t,g,e.globalOpts.catalogs.ras,(s=s||{}).xcol),u<0&&e.error("can't find an RA column (see Preferences:catalogs)"),f=D(t,g,C,s.ycol),f<0&&e.error("can't find a Dec column (see Preferences:catalogs)"),l=s.shape||S.shape||"circle",l){case"box":r=()=>({width:s.width||S.width||7,height:s.height||S.height||7});break;case"circle":r=()=>({radius:s.radius||S.radius||3.5});break;case"ellipse":r=()=>({r1:s.r1||S.r1||3.5,r2:s.r2||S.r2||3.5});break;default:r=()=>({width:s.width||7,height:s.height||7})}for(w=this.getWCSSys(),A=s.wcssys?s.wcssys:S.wcssys?S.wcssys:"ICRS",this.setWCSSys(A,!1),o=0,n=0;o<p.length;o++)if(m=p[o][u],b=p[o][f],"\0"!==v[u]&&":h ".includes(v[u])&&"galactic"!==A&&"ecliptic"!==A&&(m*=15),c=L(m,b),c){if(d=r(),h={id:o.toString(),shape:l,x:c.x,y:c.y,width:d.width,height:d.height,radius:d.radius,r1:d.r1,r2:d.r2,angle:0,data:{ra:m,dec:b}},!1!==s.save&&!1!==e.globalOpts.catalogs.save)for(a=0;a<=g.length;a++)g[a]&&(h.data[g[a]]=p[o][a]);s.color&&(h.color=s.color),I[n++]=h}return this.setWCSSys(w,!1),I}},e.Image.prototype.loadCatalog=function(...t){let a,l,c,[s,o,n]=t;const d=$.extend(!0,{},e.Catalogs.opts),h=e.globalOpts.catalogs,p=g=>{const r={};return r.val=e.saostrtod(g),r.delim=String.fromCharCode(e.saodtype()),"\0"!==r.delim&&" \t-.:hdmsr'\"".includes(r.delim)||e.isNumber(g)||(r.val=g),r};if(1===t.length&&"string"!=typeof s&&(o=s,s=null),2===t.length&&"string"!=typeof s&&(n=o,o=s,s=null),o){if(h.tooltip&&(d.tooltip=h.tooltip),n=n||{},"string"==typeof n)try{n=JSON.parse(n)}catch(g){e.error(`can't parse catalog opts: ${n}`,g)}n.color=n.color||h.color||"#00FF00",n.wcssys=n.wcssys||h.wcssys,n.updateWCS=!0,l={convFuncs:{def:p},units:n.units||h.units,skip:n.skip||h.skip};try{c=new e.Starbase(o,l)}catch{e.error("could not parse catalog. Is it in tab-separated column format?")}return(!c||!c.data||!c.data.length)&&e.error("no objects found in catalog"),a=this.starbaseToShapes(c,n),a.length?(s=s||`catalog_${e.uniqueID()}`,this.display.newShapeLayer(s,d),this.removeShapes(s),this.layers[s].catalog=o,this.layers[s].starbase=c,this.addShapes(s,a,n)):e.error("no catalog objects found"),this}},e.Image.prototype.saveCatalog=function(t,s){let o,n,a;return o=s||this.activeShapeLayer(),(!this.layers[o]||!this.layers[o].catalog)&&e.error(o&&"undefined"!==o?`no catalog available: ${o}`:"no active catalog available"),n=this.layers[o].catalog,a=new Blob([n],{type:"text/plain;charset=utf-8"}),(t=t||`${o}.cat`).match(/\.cat$/)||(t+=".cat"),{}.hasOwnProperty.call(window,"saveAs")?e.saveAs(a,t):e.error("no saveAs() available to save catalog"),t},e.Image.prototype.wcs2wcs=function(t,s,o,n){let a,l,c,d,h,p,g,v;return a=this.getWCSSys(),l=this.getWCSUnits(),t=t||a,s=s||a,"string"==typeof o&&(v=e.strtoscaled(o),e.isHMS(t,v.dtype)&&(v.dval*=15),o=v.dval),"string"==typeof n&&(v=e.strtoscaled(n),n=v.dval),c=this.setWCSSys(t,!1).getWCSSys(),"native"!==t&&c!==t&&e.error(`unknown or invalid wcs: ${t}`),d=e.wcs2pix(this.raw.wcs,o,n).trim().split(/ +/),h=parseFloat(d[0]),p=parseFloat(d[1]),this.setWCSSys(s,!1),this.setWCSUnits("degrees",!1),g=e.pix2wcs(this.raw.wcs,h,p).trim(),this.setWCSUnits(l,!1),a!==s&&this.setWCSSys(a,!1),g},e.Image.prototype.wcs2imlen=function(t){let s,o,n,a=1;if(t){switch(s=e.strtoscaled(t),o=this.raw.wcsinfo||{cdelt1:1,cdelt2:1},void 0!==o.cdelt1?a=o.cdelt1:void 0!==o.cdelt2&&(a=o.cdelt2),this.params.wcssys){case"image":break;case"physical":this.lcs&&this.lcs.physical&&(n=Math.sqrt(Math.pow(this.lcs.physical.forward[0][0],2)+Math.pow(this.lcs.physical.forward[0][1],2)),s.dval=Math.abs(s.dval*n));break;default:s.dtype&&"."!==s.dtype&&"\0"!==s.dtype&&(s.dval=Math.abs(s.dval/a))}return s.dval}},e.Colormap=function(...t){let l,c,[s,o,n,a]=t;if(s){switch(this.name=s,t.length){case 2:$.isArray(o[0])&&"number"==typeof o[0][0]?(this.type="lut",this.colors=o):(this.type="static",this.colors=e.parseStaticColors(o));break;case 4:this.type="sao",this.vertices=[o,n,a];break;default:e.error("colormap requires a colormap name and 1 or 3 array args")}for(this.source=e.inited?"user":"core",l=0;l<e.colormaps.length;l++)if(e.colormaps[l].name===this.name){e.colormaps[l]=this,c=!0;break}c||e.colormaps.push(this),e.DEBUG>1&&e.log("JS9 colormap:  %s",this.name)}},e.Colormap.prototype.mkColorCell=function(t){let s,o,n,a,l,c,d,h,p;const g=e.COLORSIZE,v=255,r=[0,0,0];switch(this.type){case"sao":for(o=t/g,a=0;a<3;a++){for(c=this.vertices[a],d=c.length,n=0;n<d&&!(c[n][0]>o);n++);0===n?l=c[0][1]:n===d?l=c[d-1][1]:(s=(c[n][1]-c[n-1][1])/(c[n][0]-c[n-1][0]),l=s?s*(o-c[n-1][0])+c[n-1][1]:c[n][1]),r[a]=l*v}break;case"lut":h=this.colors.length,p=Math.floor(t*h/g),p<0?(r[0]=this.colors[0][0]*v,r[1]=this.colors[0][1]*v,r[2]=this.colors[0][2]*v):p<h?(r[0]=this.colors[p][0]*v,r[1]=this.colors[p][1]*v,r[2]=this.colors[p][2]*v):(r[0]=this.colors[h-1][0]*v,r[1]=this.colors[h-1][1]*v,r[2]=this.colors[h-1][2]*v);break;case"static":break;default:e.error("unknown colormap type")}return r},e.Display=function(t){this.divjq=t instanceof jQuery?t:"object"==typeof t?$(t):$(`#${t}`),this.divjq.attr("id")||this.divjq.attr("id",e.DEFID),this.id=this.divjq.attr("id"),this.tmp={},this.rgb={active:!1,rim:null,gim:null,bim:null},this.divjq.addClass("JS9"),this.width=this.divjq.attr("data-width"),this.width||(this.width=e.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=e.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.width0=this.width,this.height0=this.height,this.divjq.attr("tabindex",0),this.canvas=document.createElement("canvas"),this.canvasjq=$(this.canvas).addClass("JS9Image").attr("id",`${this.id}Image`).attr("width",this.width).attr("height",this.height).css("z-index",e.ZINDEX),this.displayConjq=$("<div>").addClass("JS9Container").attr("id",`${this.id}DisplayConjq`).css("z-index",e.ZINDEX).attr("tabindex","0").append(this.canvasjq).appendTo(this.divjq),e.allinone||(this.iconjq=$("<div>").addClass("JS9Logo").css("display","none").css("z-index",e.ZINDEX+1).appendTo(this.divjq),this.iconimgjs=$("<img>").addClass("JS9Logo").attr("src",e.InstallDir(e.globalOpts.logo)).attr("alt","js9").attr("title","js9").appendTo(this.iconjq),e.globalOpts.logoDisplay&&this.iconjq.css("display","block")),e.globalOpts.resizeHandle&&{}.hasOwnProperty.call(window,"ResizeSensor")&&(this.divjq.css("resize","both").css("overflow","hidden"),e.bugs.webkit_resize&&(this.owidth=parseInt(this.divjq.css("width"),10),this.oheight=parseInt(this.divjq.css("height"),10),this.divjq.css("width",this.width+e.RESIZEFUDGE).css("height",this.height+e.RESIZEFUDGE)),this.resizeSensor=new ResizeSensor(this.divjq,()=>{let s=this.divjq.width(),o=this.divjq.height();e.bugs.webkit_resize&&(s-=e.RESIZEFUDGE,o-=e.RESIZEFUDGE),this.resize(s,o)})),this.context=this.canvas.getContext("2d"),e.ANTIALIAS||(this.context.imageSmoothingEnabled=!1),this.tooltip=$("<div>").attr("id",`tooltip_${this.id}`).addClass("JS9Tooltip").appendTo(this.divjq),this.image=null,this.pluginInstances={},this.layers={},this.initMessages(),this.blendMode=!1,this.mouseActions=e.globalOpts.mouseActions.slice(0),this.touchActions=e.globalOpts.touchActions.slice(0),this.divjq.on("mouseenter",this,s=>e.mouseEnterCB(s)),this.divjq.on("mouseover",this,s=>e.mouseOverCB(s)),this.divjq.on("mousedown touchstart",this,s=>e.mouseDownCB(s)),this.divjq.on("mousemove touchmove",this,s=>e.mouseMoveCB(s)),this.divjq.on("mouseup touchend",this,s=>e.mouseUpCB(s)),this.divjq.on("mouseout",this,s=>e.mouseOutCB(s)),this.divjq.on("keypress",this,s=>e.keyPressCB(s)),this.divjq.on("keydown",this,s=>e.keyDownCB(s)),this.divjq.on("keyup",this,s=>e.keyUpCB(s)),this.divjq.on("wheel",this,s=>e.wheelCB(s)),this.divjq.on("dragenter",this,s=>e.dragenterCB(this.id,s)),this.divjq.on("dragover",this,s=>e.dragoverCB(this.id,s)),this.divjq.on("dragexit",this,s=>e.dragexitCB(this.id,s)),this.divjq.on("drop",this,s=>e.dragdropCB(this.id,s)),this.divjq.on("contextmenu",this,()=>!1),this.addFileDialog("Load",e.globalOpts.imageTemplates),this.addFileDialog("RefreshImage",e.globalOpts.imageTemplates),this.addFileDialog("LoadRegions",e.globalOpts.regTemplates),this.addFileDialog("LoadSession",e.globalOpts.sessionTemplates),this.addFileDialog("LoadColormap",e.globalOpts.colormapTemplates),this.addFileDialog("LoadCatalog",e.globalOpts.catalogTemplates),e.displays.push(this),this.displayConjq.focus(),e.DEBUG&&e.log("JS9 display:  %s",this.id)},e.Display.prototype.addFileDialog=function(t,s){let o,n,a;!t||!e.publics[t]||(a=`openLocal${t}-${this.id}`,o=$("<div>").addClass("JS9Hidden").appendTo(this.divjq),n=$("<input>").attr("type","file").attr("id",a).attr("multiple",!0).appendTo(o),s&&n.attr("accept",s),n.on("change",l=>{let c,d;const h=l.currentTarget;if(h.files.length)switch(t){case"Load":case"RefreshImage":d={localAccess:!0},e.waiting(!0,this)}for(c=0;c<h.files.length;c++)e.publics[t](h.files[c],d,{display:this.id});return h.value=null,!1}))},e.Display.prototype.initMessages=function(){this.messageContainer=$("<div>").addClass("JS9Container").css("z-index",e.MESSZINDEX).appendTo(this.divjq),this.infoArea=$("<div>").addClass("JS9Message").appendTo(this.messageContainer),this.regionsArea=$("<div>").addClass("JS9Message").appendTo(this.messageContainer),this.progressArea=$("<div>").addClass("JS9Progress").addClass("JS9Message").appendTo(this.messageContainer),this.progressBar=$("<progress>").addClass("JS9ProgressBar").attr("value",0).attr("max",100).attr("name","progress").appendTo(this.progressArea);try{this.messageContainer.draggable({start(t,s){this.oicb=e.globalOpts.internalContrastBias,e.globalOpts.internalContrastBias=!1},stop(t,s){e.globalOpts.internalContrastBias=this.oicb}})}catch{}return this},e.Display.prototype.displayPlugin=function(t){let s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b;if("string"==typeof t)for(s=0;s<e.plugins.length;s++)if(l=e.plugins[s],l.name===t){t=l;break}switch(("object"!=typeof t||!t.name)&&e.error("unknown plugin type for displayPlugin"),m=this.pluginInstances[t.name],e.globalOpts.winType){case"light":if(o=e.lightOpts[e.LIGHTWIN],m&&m.status){if("inactive"===m.status){if(m.winHandle&&(m.winHandle.show(),m.status="active",t.opts.onplugindisplay))try{t.opts.onplugindisplay.call(m,this.image)}catch(w){e.log("onplugindisplayCB: %s [%s]\n%s",t.name,w.message,e.strace(w))}}else if("active"===m.status&&m.winHandle&&(m.winHandle.hide(),m.status="inactive",t.opts.onpluginclose))try{t.opts.onpluginclose.call(m,this.image)}catch(w){e.log("onplugincloseCB: %s [%s]\n%s",t.name,w.message,e.strace(w))}}else if(p=t.name.replace(/\s/g,"_"),g=`${this.id}_${p}_lightDiv`,v=`${this.id}_${p}_outerDiv`,r=`${this.id}_${p}_innerDiv`,m||(u=$("<div>").attr("id",v).css("display","none").appendTo($(this.divjq)),$("<div>").addClass(t.name).attr("id",r).attr("data-js9id",this.divjq.attr("id")).css("height","100%").css("width","100%").appendTo(u)),n=t.opts.winDims[0]||e.WIDTH,a=t.opts.winDims[1]||e.HEIGHT,c=t.opts.winResize?"1":"0",d=sprintf(o.format,n,a,c),h=t.opts.toolbarHTML&&t.opts.toolbarHTML.search(/\$title/)>=0?"":t.opts.winTitle||"",h+=sprintf(e.IDFMT,this.id),b=e.lightWin(g,"div",v,h,d),f=$(`#${g} #${r}`),m=e.instantiatePlugin(f,t,b),m.winHandle.onclose=()=>{if(m.winHandle.hide(),m.status="inactive",t.opts.onpluginclose)try{t.opts.onpluginclose.call(m,this.image)}catch(w){e.log("onplugincloseCB: %s [%s]\n%s",t.name,w.message,e.strace(w))}return!1},m.status="active",t.opts.onplugindisplay)try{t.opts.onplugindisplay.call(m,this.image)}catch(w){e.log("onplugindisplayCB: %s [%s]\n%s",t.name,w.message,e.strace(w))}break;case"new":e.error("external window support for plugins not yet implemented")}},e.Display.prototype.displayLoadForm=function(t){let s,o,n;const a=e.globalOpts.localLoadFormat;"proxy"===e.globalOpts.remoteLoadMethod&&!e.proxyAvailable()&&(e.globalOpts.remoteLoadMethod="cgiproxy"),n=e.globalOpts.remoteLoadMethod,e.isNull((t=t||{local:!0,remote:!0}).title)&&(t.title="",t.local&&(t.title="Open "),t.remote&&(t.title&&(t.title+="or "),t.title+="Retrieve "),t.title+="an Image ",t.local&&(t.title+="or Auxiliary File")),t.winformat=t.winformat||"width=640px,height=300px,resize=1,scrolling=1",s=e.allinone?e.allinone.loadHTML:e.InstallDir(e.globalOpts.loadURL),$(e.lightOpts[e.LIGHTWIN].topid).arrive(".loadForm",{onceOnly:!0},l=>{const c=$(l).data("localfile")||this.tmp.localfile,d=$(l).data("remotefile")||this.tmp.remotefile;t.local&&($(o).find(".localfile").removeClass("nodisplay"),$(o).find(".localdoc").removeClass("nodisplay"),c&&$(o).find('input[name="localfile"]').val(c),$(o).find(`input[value=${a}]`).click()),t.remote&&($(o).find(".remotefile").removeClass("nodisplay"),$(o).find(".remotedoc").removeClass("nodisplay"),d&&$(o).find('input[name="remotefile"]').val(d),e.proxyAvailable()||$(o).find('input[value="proxy"]').prop("disabled",!0),$(o).find(`input[value=${n}]`).click())}),o=e.Image.prototype.displayAnalysis.call(null,"params",s,t),$(o).data("dispid",this.id)},e.Display.prototype.resize=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u;const f=m=>{m.left+=g,m.top+=v,m.setCoords()};if(e.globalOpts.resize||e.error("display resize not enabled"),!t&&!s)return{width:this.width,height:this.height};if("full"===t){if(o=s,window.innerWidth&&(t=window.innerWidth),window.innerHeight)for(s=window.innerHeight,n=0;n<e.globalOpts.centerDivs.length;n++)a=e.globalOpts.centerDivs[n],this.pluginInstances[a]&&(s-=this.pluginInstances[a].divjq.height())}else"image"===t?(this.image||e.error("can't resize display to 'image' without an image"),o=s,t=this.image.raw.width,s=this.image.raw.height):"reset"===t&&(o=s,t=this.width0||t,s=this.height0||s);if(t=Math.floor(t),s=s?Math.floor(s):t,(t<10||s<10)&&e.error("invalid dimension(s) passed to display resize"),t===this.width&&s===this.height)return this;if("string"==typeof(o=o||{}))try{o=JSON.parse(o)}catch(m){e.error(`can't parse resize opts: ${o}`,m)}for(c of(h=t,p=s,g=(h-this.width)/2,v=(p-this.height)/2,u=this.width,this.width=h,this.height=p,this.divjq.css("width",h),this.divjq.css("height",p),this.canvasjq.attr("width",h),this.canvasjq.attr("height",p),e.bugs.webkit_resize&&(this.resizing||(this.owidth=Math.min(this.owidth,h),this.oheight=Math.min(this.oheight,p))),$.inArray("JS9Menubar",e.globalOpts.resizeDivs)>=0&&(e.isNull(o.resizeMenubar)||o.resizeMenubar)&&(r=this.pluginInstances.JS9Menubar,r&&$(`#${this.id}Menubar`).css("width",h)),$.inArray("JS9Toolbar",e.globalOpts.resizeDivs)>=0&&(e.isNull(o.resizeToolbar)||o.resizeToolbar)&&(r=this.pluginInstances.JS9Toolbar,r&&(r.divjq.attr("data-width",`${String(h)}px`),e.Toolbar.init.call(r))),$.inArray("JS9Colorbar",e.globalOpts.resizeDivs)>=0&&(e.isNull(o.resizeColorbar)||o.resizeColorbar)&&(r=this.pluginInstances.JS9Colorbar,r&&(r.divjq.attr("data-width",`${String(h)}px`),e.Colorbar.init.call(r))),$.inArray("JS9Statusbar",e.globalOpts.resizeDivs)>=0&&(e.isNull(o.resizeStatusbar)||o.resizeStatusbar)&&(r=this.pluginInstances.JS9Statusbar,r&&($(`#${this.id}Statusbar`).css("width",h),r.statusBar&&r.statusBar.match(/\$colorbar/)&&!1!==o.resizeStatusbarColorbar&&(r.colorwidth=Math.max(r.colorwidth+t-u,e.Statusbar.COLORWIDTH),e.Statusbar.display.call(r,this.image,{reinit:!0})))),Object.keys(this.layers)))d=this.layers[c],"main"===d.dtype&&(d.divjq.css("width",h),d.divjq.css("height",p),d.canvasjq.attr("width",h),d.canvasjq.attr("height",p),d.canvas.setWidth(h),d.canvas.setHeight(p),d.canvas.calcOffset());for(n=0;n<e.images.length;n++)if(l=e.images[n],l.mkSection(),l.display&&this===l.display&&(l.resize?(l.resize.left+=g,l.resize.top+=v):l.resize={left:g,top:v},l===l.display.image))for(c of Object.keys(l.layers))d=l.layers[c],"main"===d.dlayer.type&&!d.json&&(d.canvas.getObjects().forEach(f),d.canvas.renderAll());return e.bugs.webkit_resize&&this.divjq.css("width",this.width+e.RESIZEFUDGE).css("height",this.height+e.RESIZEFUDGE),this.image&&(e.globalOpts.resizeRedisplay||!this.resizing)&&(this.image.displayImage("all",o),this.image.refreshLayers()),o.center&&this.center(),this},e.Display.prototype.inResize=function(t){return!!(e.globalOpts.resizeHandle&&t.x+e.RESIZEDIST>=this.divjq.width()&&t.y+e.RESIZEDIST>=this.divjq.height())},e.Display.prototype.center=function(){const t=this.divjq;let s,o,n,a,l,c=t.offset().top,d=t.height();const h=$(window).height(),p=t.offset().left,g=t.width(),v=$(window).width();for(s=0;s<e.globalOpts.centerDivs.length;s++)o=e.globalOpts.centerDivs[s],this.pluginInstances[o]&&(n=this.pluginInstances[o].divjq,d+=n.height(),c=Math.min(n.offset().top,c));return a=d<h?c-(h/2-d/2):c,l=g<v?p-(v/2-g/2):p,$("html, body").animate({scrollTop:a,scrollLeft:l},250),this},e.Display.prototype.gather=function(t){let s,o,n,a,l,c;if("string"==typeof(t=t||{}))try{t=JSON.parse(t)}catch(d){e.error(`can't parse gather opts: ${t}`,d)}for(n=t.images||e.images,s=0;s<n.length;s++)a="number"==typeof n[s]?e.images[n[s]]:n[s],a&&a.display!==this&&(l=a.display,c=l.divjq.closest(".JS9GridItem"),a.moveToDisplay(this),c.length>0&&(o=$.inArray(l,e.displays),o>=0&&e.displays.splice(o,1),c.remove()));e.globalOpts.extendedPlugins&&this.image&&this.image.xeqPlugins("image","ongatherdisplay")},e.Display.prototype.separate=function(t){let s,o,n,a,l=0,c=0,d=0,h=1;const p={},g={},v=/_sep[0-9][0-9]*/,r=e.globalOpts.separate,I=L=>{let D,O,M;const E=l++;L.length>E?(D="number"==typeof L[E]?e.images[L[E]]:L[E],D&&D.display===this?(D.displayImage("all"),void 0===o?(o=D.display.id,((L,D,O)=>{switch(D||e.error("can't init separation ops: no 'from' id"),p.layout=O.layout||e.globalOpts.separate.layout||"auto",p.leftMargin=O.leftMargin||r.leftMargin||0,p.topMargin=O.topMargin||r.topMargin||0,"auto"===p.layout&&L.divjq.closest(".JS9GridContainer").length>0&&(p.layout="grid"),"grid"===p.layout&&(CSS.supports("display","grid")?(a=L.divjq.closest(".JS9GridContainer"),a.length>0&&(p.container=a)):p.layout="auto"),p.layout){case"auto":case"horizontal":default:d=1,c=0;break;case"vertical":d=0,c=1}p.topExtra=43,p.leftExtra=0,p.js9=$(`#${D}`),p.menubar=$(`#${D}Menubar`),p.menubar.length>0&&(p.menubar.isactive="visible"===p.menubar.closest(".JS9PluginContainer").css("visibility")),p.toolbar=$(`#${D}Toolbar`),p.toolbar.length>0&&(p.toolbar.isactive="visible"===p.toolbar.closest(".JS9PluginContainer").css("visibility")),p.statusbar=$(`#${D}Statusbar`),p.statusbar.length>0&&(p.statusbar.isactive="visible"===p.statusbar.closest(".JS9PluginContainer").css("visibility")),p.colorbar=$(`#${D}Colorbar`),p.colorbar.length>0&&!p.statusbar.length&&(p.colorbar.isactive="visible"===p.colorbar.closest(".JS9PluginContainer").css("visibility")),p.js9.length>0&&(p.width=p.js9.width(),p.height=p.js9.height(),p.top=p.js9.offset().top-$(window).scrollTop()-5,p.left=p.js9.offset().left-$(document).scrollLeft(),p.menubar.isactive&&(p.height+=p.menubar.height(),p.top-=p.menubar.height()),p.toolbar.isactive&&(p.height+=p.toolbar.height(),p.top-=p.toolbar.height()),p.statusbar.isactive?(p.height+=p.statusbar.height(),p.top-=p.statusbar.height()):p.colorbar.isactive&&(p.height+=p.colorbar.height(),p.top-=p.colorbar.height(),p.top+=7))})(D.display,o,t),!1===t.firstinplace&&l--,I(L)):("string"==typeof t.idbase?(M=t.idbase+h++,n=M):n=`${o.replace(v,"")}_sep${e.uniqueID()}`,g[n]=D,O=((L,D)=>{let O,M;return L&&(p.js9.length>0&&(O="",p.menubar.isactive&&(O+=sprintf("<div class='JS9Menubar' id='%sMenubar' data-width=%s></div>",D,p.js9.width())),p.toolbar.isactive&&(O+=sprintf("<div class='JS9Toolbar' id='%sToolbar' data-width=%s></div>",D,p.js9.width())),O+=sprintf("<div class='JS9' id='%s' data-width=%s data-height=%s></div>",D,p.js9.width(),p.js9.height()),p.statusbar.isactive?O+=sprintf("<div style='margin-top: 2px;'><div class='JS9Statusbar' id='%sStatusbar' data-width=%s></div></div>",D,p.js9.width()):p.colorbar.isactive&&(O+=sprintf("<div style='margin-top: 2px;'><div class='JS9Colorbar' id='%sColorbar' data-width=%s></div></div>",D,p.js9.width()))),"auto"===p.layout&&p.left+p.width*(d+.5)>window.innerWidth&&(c++,d=0),M=sprintf("width=%s,height=%s,top=%s,left=%s,resize=1,scolling=1",p.width,p.height,p.top+(p.height+p.topMargin+p.topExtra)*c,p.left+(p.width+p.leftMargin+p.leftExtra)*d),"auto"===p.layout||"horizontal"===p.layout?d++:"vertical"===p.layout&&c++),{id:D,html:O,winopts:M}})(o,n),M&&(O.id=M),"grid"===p.layout?($("<div>").prop("id",O.id+"GridItem").addClass("JS9GridItem").append($(O.html)).appendTo(p.container),e.AddDivs(O.id),g[O.id].moveToDisplay(O.id),I(L)):($(e.lightOpts[e.LIGHTWIN].topid).arrive(`#${n}`,{onceOnly:!0},R=>{M=$(R).attr("id"),window.setTimeout(()=>{g[M].moveToDisplay(M),I(L)},0)}),e.LoadWindow(null,{id:O.id},"light",O.html,O.winopts)))):I(L)):e.globalOpts.extendedPlugins&&this.image&&this.image.xeqPlugins("image","onseparatedisplay")};if("string"==typeof(t=t||{}))try{t=JSON.parse(t)}catch(L){e.error(`can't parse separate opts: ${t}`,L)}s=t.images||e.images,I(s)},e.Display.prototype.nextImage=function(t){let s,o,n,a,l,c,d=[],h=[];if(t=t||1,!this.image)return this;if(l=this.image.pos,!e.globalOpts.nextImageMask)for(s=0;s<e.images.length;s++)a=e.images[s],a.display===this&&a.mask.active&&a.mask.im&&h.push(a.mask.im);for(s=0;s<e.images.length;s++)a=e.images[s],a.display===this&&(!e.globalOpts.nextImageMask&&$.inArray(a,h)>=0||d.push(a));if(d.length<=1)return this;for(o=0;o<d.length&&this.image!==d[o];o++);for(n=o+t;n>=d.length;)n-=d.length;for(;n<0;)n+=d.length;return o!==n&&(a=d[n],a.displayImage("all"),a.display.clearMessage(),l&&(c=a.displayToImagePos(l),a.valpos=null,a.valpos=a.updateValpos(c,!0))),this},e.Display.prototype.loadSession=function(t,s){let o,n;const a={},l=h=>{let p,g,v,r,u;const f=()=>{const b=g.canvas.getObjects();b&&typeof b.length<"u"&&(h.layers[g.layerName].nshape=b.length+1),e.Fabric.updateChildren(g,null,"objects"),h.refreshLayers()},m=(b,w)=>{parseInt(b.version.slice(0,1),10)<5&&(w.startAngle&&(w.startAngle*=180/Math.PI),w.endAngle&&(w.endAngle*=180/Math.PI))};if(u=a[h.file]||{},u.blend&&(h.blend=$.extend(!0,{},u.blend)),u.tmp&&(h.tmp=$.extend(!0,{},u.tmp)),u.wcsim&&(h.wcsim=e.lookupImage(u.wcsim)),u.layers&&u.layers.length)for(p=0;p<u.layers.length;p++)if(v=u.layers[p],r=v.name,!($.inArray("regions",h.params.disable)>=0&&"regions"===r)&&"crosshair"!==r&&"grid"!==r&&(g=this.newShapeLayer(r,v.dopts),h.addShapes(r,[]),g.canvas.loadFromJSON(v.json,f,m),v.catalog&&(h.layers[r].catalog=v.catalog),v.starbase))try{h.layers[r].starbase=JSON.parse(v.starbase)}catch{}if(h.tmp&&"active"===h.tmp.gridStatus&&h.displayCoordGrid(!0),e.notNull(n)&&(n-=1,0===n&&e.images.sort((b,w)=>{let A=0,x=0;return a[b.file]&&(A=a[b.file].i),a[w.file]&&(x=a[w.file].i),A-x})),u.xeqstash&&h.xeqStashCall(u.xeqstash),e.globalOpts.extendedPlugins&&h.xeqPlugins("image","onsessionload"),"function"==typeof s.onsessionload)try{e.xeqByName(s.onsessionload,window,h)}catch(b){e.error("in onsessionload callback",b,!1)}},c=h=>{let p;h.file||e.error("session does not contain a filename"),o=$.extend(!0,{},h),delete o.params.display,o.params.crosshair=!1,o.params.onload=l,p=o.file,o.sect&&(o.params.xcen=o.sect.xcen,o.params.ycen=o.sect.ycen,o.params.xdim=o.sect.xdim,o.params.ydim=o.sect.ydim,o.params.zoom=o.sect.zoom,delete o.sect),window.electron&&e.desktopOpts.sessionPath&&s.sessionPath&&"/"!==o.file.charAt(0)&&!o.file.match(e.URLEXP)&&(p=e.fixPath(s.sessionPath+o.file,s)),a[p]=o,e.Load(p,o.params,{display:this.id})},d=h=>{let p,g,v,r;if(h.globalOpts&&($.extend(!0,e.globalOpts,h.globalOpts),delete h.globalOpts),h.cmaps)for(p=0;p<h.cmaps.length;p++)v=h.cmaps[p],v.name&&(r=$.inArray(v.name,e.globalOpts.topColormaps)>=0?{toplevel:!0}:{toplevel:!1},e.AddColormap(v,r));if(h.images)for(n=h.images.length,p=0;p<h.images.length;p++)h.images[p].i=p,c(h.images[p]);else c(h);if(h.display)for(g of Object.keys(h.display))"blendMode"===g?e.BlendDisplay(h.display[g],{display:this}):this[g]=h.display[g]};if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(h){e.error(`can't parse loadSession opts: ${s}`,h)}return e.waiting(!0,this),"object"==typeof t?d(t):$.ajax({url:t,cache:!1,dataType:"json",mimeType:"application/json",async:!1,success:h=>{d(h)},error:(h,p,g)=>{e.error(`could not load session: ${t}`,g)}}),this},e.Display.prototype.displayMessage=function(t,s,o){},e.Display.prototype.clearMessage=function(t){},e.Display.prototype.createMosaic=function(t,s){let o,n,a,l;const c=this.image,d="|                                                    fname|",h="|                                                     char|",p=()=>{let u;for(u=0;u<l.length;u++)e.vunlink(l[u])},g=(u,f)=>{let m;f.search(/\[struct stat="OK"/)<0&&(e.waiting(!1),p(),m=f.match(/msg="(.*)"/),e.error(m&&m[1]?`${m[1]} (from ${u})`:f||`unknown ${u} failure`))},v=(u,f)=>{let m,b;if(f=f||{},m=$.extend(!0,{},f),!1!==f.waiting&&e.waiting(!0,this),m.display=this.id,b=new e.Image(u,m),c.setStatus("createMosaic","complete"),b.setStatus("createMosaic","complete"),e.waiting(!1),f.onmosaic)try{e.xeqByName(f.onmosaic,window,b)}catch(w){e.error("in create mosaic callback",w,!1)}},r=(...u)=>{let f;(s.verbose||e.DEBUG>1)&&(f=sprintf(...u),e.log(f))};if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(u){e.error(`can't parse createMosaic opts: ${s}`,u)}if(s.reduce=s.reduce||e.globalOpts.reduceMosaic,s.dim=s.dim||Math.max(e.globalOpts.image.xdim,e.globalOpts.image.ydim),t)if("string"==typeof t)if("current"===t)t=this.image?[this.image]:[];else if("all"===t)for(t=[],o=0;o<e.images.length;o++)e.images[o].display.id===this.id&&t.push(e.images[o]);else t=[t];else $.isArray(t)||e.error("unknown input type for createMosaic()");else t=this.image?[this.image]:[];for(t.length||e.error("no images specified for createMosaic()"),o=0;o<t.length;o++)"string"==typeof t[o]&&(n=e.lookupImage(t[o]),n?t[o]=n:e.error(`unknown image for mosaic: ${t[o]}`)),n=t[o],(!n.raw.hdu||!n.raw.hdu.fits||!n.raw.hdu.fits.vfile)&&e.error(`no virtual file available for mosaic: ${n.id}`);return e.waiting(!0,this),c.setStatus("createMosaic","processing"),window.setTimeout(()=>{let u,f,m,b,w,A,x,y,S,_,C,I,L,D,O,M,E,R,H,N,B,P,z,J,q;const G=e.uniqueID(),le=te=>`mosaic_${G}_${te}`;for(O=le("in.lst"),M=le("in.tbl"),E=le("in.hdr"),H=le("bin.lst"),N=le("bin.tbl"),B=le("out.lst"),P=le("out.tbl"),z=le("out.hdr"),q=t[0].id.replace(/\[.*\]/,"").replace(/\.fz$/i,"").replace(/\.gz$/i,"").replace(/\.fits$/i,"_mosaic.fits"),J=q.replace(/\.fits$/,"_area.fits"),l=[O,M,E,H,N,B,P,z,J],u=`${d}\n${h}\n`,o=0;o<t.length;o++)u+=`${t[o].raw.hdu.fits.vfile}\n`;if(e.vfile(O,u),A=e.imgtbl(O,".",M,"-C"),g("mImgtbl",A),e.vsize(M)||e.error("no image data found with which to construct a mosaic"),A=e.makehdr(M,E,""),g("mMakeHdr",A),"js9"===s.reduce){for(u=e.vread(E).split("\n"),w=0,o=0;o<u.length;o++)switch(f=u[o].split("="),f[0].trim()){case"NAXIS1":case"NAXIS2":w=Math.max(w,parseFloat(f[1].trim()))}for(a=Math.max(1,Math.floor(w/s.dim+.5)),u=`${d}\n${h}\n`,x=e.vread(M),R=x.trim().split("\n"),R.splice(0,3),o=0;o<R.length;o++)f=R[o].trim().split(/\s+/),y=f[f.length-2],S=f[f.length-1],y&&S&&(_=`${S}[${y}]`,m=S.split("/").reverse()[0].replace(/\.(g|f)z$/,""),I=`bin_${y}_${m}`,l.push(I),L=`0@0,0@0,${a}`,r("bin %s [%s]",_,a),e.imsection(_,I,L,""),u+=`${I}\n`);e.vfile(H,u),A=e.imgtbl(H,".",N,"-C"),g("mImgtbl",A),e.vsize(N)||e.error("no image data found to construct a mosaic"),A=e.makehdr(N,z,""),g("mMakeHdr",A),x=e.vread(N)}else A=e.shrinkhdr(s.dim,E,z),g("mShrinkHdr",A),x=e.vread(M);for(R=x.trim().split("\n"),R.splice(0,3),u=`${d}\n${h}\n`,o=0;o<R.length;o++)f=R[o].trim().split(/\s+/),y=f[f.length-2],S=f[f.length-1],y&&S&&(b="-a 1","shrink"===s.reduce&&(b+=` -h ${y}`),b+=` ${e.globalOpts.reprojSwitches}`,m=S.split("/").reverse()[0].replace(/\.(g|f)z$/,""),C=`reproj_${y}_${m}`,u+=`${C}\n`,l.push(C),l.push(C.replace(/\.fits$/i,"_area.fits")),r("reproject: %s [%s] -> %s",S,y,C),A=e.reproject(S,C,z,b),g("mProjectPP",A));e.vfile(B,u),A=e.imgtbl(B,".",P,""),g("mImgtbl",A),e.vsize(P)||e.error("no FITS files were added to output table for mosaic"),r("create mosaic: %s",q),A=e.madd(P,z,q,""),g("mAdd",A),p(),D=$.extend(!0,{},e.fits.options,s),D.image={xdim:0,ydim:0},D.file=q,e.fits.handleFITSFile(q,D,v)},e.SPINOUT),this},e.Display.prototype.moveImageInStack=function(t,s){let o,n,a,l;for(o=0,n=0;o<e.images.length;o++)if(e.images[o].display.id===this.id&&(t===n&&(a=o),s===n&&(l=o),n++),e.notNull(a)&&e.notNull(l))return void e.images.splice(l,0,e.images.splice(a,1)[0])},e.Command=function(t){let s;for(s of(t=t||{},Object.keys(t)))this[s]=t[s];t.name||e.error("command has no name"),!t.get&&!t.set&&e.error("command requires get and/or set routine"),e.commands.push(this),e.DEBUG>1&&e.log("JS9 command:  %s",this.name)},e.Command.prototype.getDisplayInfo=function(t){return t&&t.id&&(this.display=t,this.image=t.image),this},e.Command.prototype.getWhich=function(t){let s;return s=this.get&&!this.set?"get":this.set&&!this.get?"set":this.which?this.which(t):0===t.length?"get":"set",s},e.Helper=function(){"file:"===e.globalOpts.helperProtocol&&(e.globalOpts.helperProtocol="http:"),(!document.domain||"localhost"===document.domain)&&(e.globalOpts.htimeout=e.globalOpts.lhtimeout),e.globalOpts.helperProtocol.match(/\/\/$/)||(e.globalOpts.helperProtocol+="//"),this.connected=!1,this.helper=!1,this.type=e.allinone&&!e.globalOpts.allinoneHelper?"none":e.globalOpts.helperType||"sock.io",this.pageid=null,this.connect()},e.Helper.prototype.connectinfo=function(){let t;return null===e.helper.connected?"notConfigured":e.helper.connected?(t=`connected ${e.helper.type} ${e.helper.url}`,e.helper.pageid&&(t+=`<p>${e.helper.pageid}`),t):`notConnected ${e.helper.type}`},e.Helper.prototype.connect=function(t){let s,o;const n=e.globalOpts.ehretries,a=e.globalOpts.ehtimeout,l=(h,p)=>{this.connected=!1,this.helper=!1,this.ready=!0,$(document).trigger("JS9:helperReady",{type:"socket.io",status:"error"}),(!p||"timeout"===p)&&(p="or connection refused"),p===(h=h||"timeout")&&(h=""),"error"===p&&(p="is the helper running?"),e.globalOpts.requireHelper?e.error(`helper connect error: ${h} (${p})`):e.DEBUG&&e.log(`JS9 helper connect error: ${h} (${p})`)},c=h=>{$.ajax({url:h,dataType:"script",timeout:e.globalOpts.htimeout,cache:!0,success:()=>{typeof io>"u"?l("socket io object is undefined",null):(this.socket=io.connect(this.url,e.socketioOpts),this.socket.on("connect",()=>{let p,g,v;for(this.connected=!0,this.helper=!0,g=[],p=0;p<e.displays.length;p++)g.push(e.displays[p].id);v=this.pageid,this.socket.emit("initialize",{displays:g,pageid:v},r=>{this.pageid=r.pageid,this.js9helper=r.js9helper,e.globalOpts.dataPathModify=r.dataPathModify,this.ready=!0,$(document).trigger("JS9:helperReady",{type:"socket.io",status:"OK"}),e.DEBUG&&e.log(`JS9 helper: connect: ${this.type}`)}),$(document).trigger("JS9:connected",{type:"socket.io",status:"OK"})}),this.socket.on("connect_error",()=>{this.connected=!1,this.helper=!1,e.DEBUG>1&&e.log("JS9 helper: connect error")}),this.socket.on("connect_timeout",()=>{this.connected=!1,this.helper=!1,e.DEBUG>1&&e.log("JS9 helper: connect timeout")}),this.socket.on("disconnect",p=>{this.connected=!1,this.helper=!1,e.DEBUG>1&&e.log(`JS9 helper: disconnect: ${p}`),"io server disconnect"===p&&(e.DEBUG>1&&e.log("JS9 helper: manual reconnect"),this.socket.connect())}),this.socket.on("reconnect",()=>{this.connected=!0,this.helper=!0,e.DEBUG>1&&e.log("JS9 helper: reconnect")}),this.socket.on("msg",e.msgHandler))},error:(p,g,v)=>{l(g,v)}})},d=(h,p,g)=>{$.ajax({url:h,dataType:"jsonp",success:()=>{c(p)},error:()=>{--g>0?window.setTimeout(()=>{d(h,p,g)},a):l()}})};if(t&&(this.type=t),this.socket){try{this.socket.disconnect()}catch{e.log("warning: can't disconnect from socket")}this.socket=null}switch(this.url=e.globalOpts.helperURL?e.globalOpts.helperURL.search(/:\/\//)>=0?e.globalOpts.helperURL:e.globalOpts.helperProtocol+e.globalOpts.helperURL:document.domain?location.origin?location.origin:e.globalOpts.helperProtocol+document.domain:`${e.globalOpts.helperProtocol}localhost`,this.baseurl=this.url,this.type){case"none":this.connected=null,this.ready=!0,$(document).trigger("JS9:helperReady",{type:"none",status:"OK"});break;case"get":case"post":e.globalOpts.helperCGI||e.error("cgi script name missing for helper"),this.url+=`/${e.globalOpts.helperCGI}`,this.connected=!0,this.helper=!0,e.DEBUG&&e.log(`JS9 helper: connect: ${this.type}`),this.ready=!0,$(document).trigger("JS9:helperReady",{type:"get",status:"OK"});break;case"sock.io":case"nodejs":e.globalOpts.helperPort||e.error("port missing for helper"),this.url=`${this.url.replace(/:[0-9][0-9]*$/,"")}:${e.globalOpts.helperPort}`,s="socket.io",o=e.DEBUG<=2?"socket.io.min.js":"socket.io.js",this.sockurl=`${this.url}/socket.io/${o}`,window.electron?(this.aliveurl=`${this.url}/alive`,d(this.aliveurl,this.sockurl,n)):c(this.sockurl);break;default:e.error(`unknown helper type: ${this.type}`)}},e.Helper.prototype.send=function(t,s,o){if(!this.connected)return null;if(s&&"object"==typeof s){try{s.cookie=document.cookie}catch{delete s.cookie}e.globalOpts.dataPath&&!s.dataPath&&(s.dataPath=`${e.globalOpts.dataPath}:.`)}else s={dataPath:"."};switch(e.TOROOT&&(s.dataPath+=`:${e.TOROOT}`),this.type){case"get":case"post":s.key=t,e.helper.pageid&&(s.pageid=e.helper.pageid),e.DEBUG&&e.log("JS9 cgi helper [%s, %s]: %s",this.type,JSON.stringify(s),this.url),$.ajax({url:this.url,type:this.type.toUpperCase(),data:s,dataType:"text",success:n=>{"string"==typeof n&&n.search(e.analOpts.epattern)>=0&&e.log(n),o&&o(n)},error:(n,a,l)=>{e.DEBUG&&e.log(`JS9 helper: ${this.type} failure: ${a} ${l}`)}});break;case"sock.io":case"nodejs":e.helper.socket.emit(t,s,o)}return this},e.WebWorker=function(t){const s=()=>{this.worker.onmessage=e.WebWorker.prototype.msgHandler.bind(this),this.handlers=[]};t.match(e.URLEXP)?e.fetchURL(null,t,null,o=>{this.worker=new Worker(URL.createObjectURL(o)),s()}):(this.worker=new Worker(t),s())},e.WebWorker.prototype.msgHandler=function(t){let s,o;const n=e.helper,a=t.data;switch(a.cmd){case"progress":e.progress(a.result.value,a.result.max);break;case"initsocketio":if("OK"===a.result)for(this.sockinit=!0,s=0;s<this.handlers.length;s++)if(o=this.handlers[s],o.id===a.id){o.func(a.result),this.handlers.splice(s,1);break}break;case"uploadFITS":for(s=0;s<this.handlers.length;s++)if(o=this.handlers[s],o.id===a.id){o.func(a.result),this.handlers.splice(s,1);break}break;case"connect_error":case"connect_timeout":delete e.worker.uploadActive,e.progress(!1),e.DEBUG>1&&e.log(`JS9 worker socketio: ${a.cmd}`);break;case"disconnect":delete e.worker.uploadActive,e.progress(!1),a.result=a.result||"JS9 worker socket was disconnected",window.setTimeout(()=>{e.worker.send("initsocketio",[n.url,n.pageid],()=>{a.alert?alert(a.result):e.DEBUG>1&&e.log(a.result)})},e.WORKEROUT);break;case"error":delete e.worker.uploadActive,e.progress(!1),e.error(a.result||"in web worker")}},e.WebWorker.prototype.send=function(t,s,o,n){const a=t+e.uniqueID(),l={id:a,cmd:t,args:s};o&&this.handlers.push({id:a,cmd:t,args:s=s||[],func:o}),n?this.worker.postMessage(l,n):this.worker.postMessage(l)},e.WebWorker.prototype.socketio=function(t){const s=e.helper;e.worker.send("initsocketio",[s.url,s.pageid],o=>{"OK"===o?t&&t():e.error(`can't init socket.io for JS9 worker: ${o}`)})},e.WebWorker.prototype.terminate=function(){this.worker.terminate()},fabric.major_version=parseFloat(fabric.version.split(".")[0]),fabric.minor_version=parseFloat(fabric.version.split(".")[1]),fabric.patch_version=parseFloat(fabric.version.split(".")[2]),e.Fabric={},e.Fabric.elements=["cornerSize","cornerColor","cornerStyle","borderColor","transparentCorners","selectionLineWidth","centeredScaling","hasControls","hasRotatingPoint","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockUniScaling","selectable","hasBorders","params","pub"],e.Fabric.opts={originX:"center",originY:"center",strokeWidth:2,selectionLineWidth:2,borderColor:"#00EEFF",cornerColor:"#00EEFF",cornerSize:fabric.isTouchSupported?10:6,cornerStyle:"circle",hasControls:!0,hasRotatingPoint:!0,hasBorders:!0,transparentCorners:!1,centeredScaling:!0,strokeUniform:!0,selectable:!0,padding:0,canvas:{selection:!0},fill:"transparent",objectCaching:!1},e.Fabric.rescaleStrokeWidth=function(t,s){fabric.major_version>=4||3===fabric.major_version&&6===fabric.minor_version&&fabric.patch_version>=3||fabric.major_version>=2&&this.params&&"annulus"!==this.params.shape&&"cross"!==this.params.shape||(t=t||1,t*=(this.scaleX+this.scaleY)/2,!s&&this.params&&(s=this.params.sw1),s&&("group"===this.type?this.forEachObject(n=>{n.rescaleBorder(t,s)}):this.set("strokeWidth",s/t)))},e.Fabric.rescaleEvenly=function(){let t;if(this.params&&this.scaleX!==this.scaleY)switch(this.params.shape){case"annulus":case"circle":t=this.params.lastscale||1,this.scaleX!==t?this.scaleY=this.scaleX:this.scaleY!==t&&(this.scaleX=this.scaleY),this.params.lastscale=this.scaleX}},fabric.Object.prototype.rescaleBorder=e.Fabric.rescaleStrokeWidth,fabric.Object.prototype.rescaleEvenly=e.Fabric.rescaleEvenly,e.Fabric.newShapeLayer=function(t,s,o){let n,a;const l=this,c=(r,u)=>{let f,m,b,w=a.display.image,A=a.canvas.getActiveObject(),x={};if(w)if(r.params)"activeSelection"===A.type&&(x.group=A),w._updateShape(t,r,x,u);else if("activeSelection"===r.type||"group"===r.type&&!r.params)for(b=r.getObjects(),f=0;f<b.length;f++)m=b[f],m.params&&(x.group=r,w._updateShape(t,m,x,u))},d=r=>{!l.image||a.display.image._updateMultiDialogs(r)},h=(r,u)=>{if(r.params.sel=null,r.display.image&&(r.display.image.layer=null),u){switch(u.type){case"polyline":case"polygon":e.Fabric.removePolygonAnchors(r,u)}c(u,"unselect"),d(-1)}},g=(r,u)=>{if(r.params.sel&&u.params&&r.params.sel!==u&&h(r,r.params.sel),r.display.image&&(r.display.image.layer=t),u){switch(u.type){case"polyline":case"polygon":e.Fabric.addPolygonAnchors(r,u),r.canvas.renderAll()}u.polyparams?r.params.sel=u.polyparams.polygon:u.params&&(r.params.sel=u),c(u,"select"),d(1)}},v=(r,u,f)=>{let m,b,w,A,x,y;for(r.params.sel&&r.params.sel!==f&&h(r,r.params.sel),f=f||r.canvas.getActiveObject(),y=r.canvas.getActiveObjects(),m=0;m<y.length;m++){if(w=y[m],w.params&&w.params.parent&&w.params.parent.obj&&(A=w.params.parent.obj,$.inArray(A,y)<0&&f.addWithUpdate(A)),w.params&&w.params.children)for(b=0;b<w.params.children.length;b++)x=w.params.children[b].obj,$.inArray(x,y)<0&&f.addWithUpdate(x);switch(w.type){case"polyline":case"polygon":w.params&&e.Fabric.removePolygonAnchors(r,w)}c(w,"select")}r.canvas.renderAll(),d(1)};if(l&&t)return l.layers[t]?l.layers[t]:(l.layers[t]={},a=l.layers[t],a.layerName=t,a.params=[],a.params.sel=null,a.params.sellayer=null,o?a.dtype="other":(a.dtype="main",o=l.divjq),n=`${o.attr("id")}-${t.replace(/\s+/,"_")}-shapeLayer`,a.display=l,a.opts=$.extend(!0,{},s),a.opts.canvas=a.opts.canvas||{},void 0===a.opts.canvas.selection&&(a.opts.canvas.selection=!0),a.el=e.Fabric.elements,a.divjq=$("<div>").addClass("JS9Container").css("z-index",0).appendTo(o),a.canvasjq=$("<canvas>").addClass("JS9Layer").attr("id",n).attr("width",o.css("width")).attr("height",o.css("height")).appendTo(a.divjq),e.bugs.webkit_resize&&"main"===a.dtype&&a.canvasjq.attr("width",l.width).attr("height",l.height),a.canvas=new fabric.Canvas(a.canvasjq[0]),a.canvas.renderOnAddRemove=!1,a.canvas.preserveObjectStacking=!0,a.opts.movable?(a.opts.lockMovementX=!1,a.opts.lockMovementY=!1,a.opts.selectable=!0,a.opts.evented=!0):!1===a.opts.movable&&(a.opts.lockMovementX=!0,a.opts.lockMovementY=!0,a.opts.selectable=!1,a.opts.evented=!1),void 0===a.opts.changeable&&void 0!==a.opts.fixinplace&&(a.opts.changeable=!a.opts.fixinplace),void 0===a.opts.changeable&&void 0!==a.opts.locked&&(a.opts.changeable=!a.opts.locked),a.opts.changeable?(a.opts.hasControls=!0,a.opts.hasRotatingPoint=!0,a.opts.hasBorders=!0,a.opts.lockMovementX=!1,a.opts.lockMovementY=!1,a.opts.lockRotation=!1,a.opts.lockScalingX=!1,a.opts.lockScalingY=!1,a.opts.lockUniScaling=!1,a.opts.selectable=!0,a.opts.evented=!0,a.opts.usekeyboard=!0):!1===a.opts.changeable&&(a.opts.hasControls=!1,a.opts.hasRotatingPoint=!1,a.opts.hasBorders=!1,a.opts.lockMovementX=!0,a.opts.lockMovementY=!0,a.opts.lockRotation=!0,a.opts.lockScalingX=!0,a.opts.lockScalingY=!0,a.opts.lockUniScaling=!0,a.opts.selectable=!1,a.opts.evented=!1,a.opts.usekeyboard=!1),a.opts.selectable&&(a.opts.canvas.selection=!0),a.opts.onmousedown||a.opts.onmouseup||a.opts.onmousemove||a.opts.tooltip||a.opts.onmouseover||a.opts.onmouseout?(a.opts.evented=!0,a.canvas.on("mouse:down",a.opts.onmousedown?r=>{if(a.display.image&&r.target){let u=r.target,f=u.params;(!f||f&&!1!==f.changeable)&&("main"===a.dtype&&(a.display.image.clickInRegion=!0,a.display.image.clickInLayer=t),a.opts.onmousedown.call(a.canvas,a.display.image,u.pub,r.e,u))}else a.canvas._selection=a.canvas.selection,a.canvas.selection&&(a.canvas.selection=e.specialKey(r.e))}:r=>{a.canvas._selection=a.canvas.selection,a.canvas.selection&&(a.canvas.selection=e.specialKey(r.e))}),a.canvas.on("mouse:up",a.opts.onmouseup?r=>{a.display.image&&r.target&&a.opts.onmouseup.call(a.canvas,a.display.image,r.target.pub,r.e,r.target),a.canvas.selection=a.canvas._selection||a.canvas.selection}:()=>{a.canvas.selection=a.canvas._selection||a.canvas.selection}),a.opts.onmousemove&&a.canvas.on("mouse:move",r=>{a.display.image&&r.target&&a.opts.onmousemove.call(a.canvas,a.display.image,r.target.pub,r.e,r.target)}),a.opts.onmouseover&&a.canvas.on("mouse:over",r=>{a.display.image&&r.target&&a.opts.onmouseover.call(a.canvas,a.display.image,r.target.pub,r.e,r.target)}),a.opts.onmouseout&&a.canvas.on("mouse:out",r=>{a.display.image&&r.target&&a.opts.onmouseout.call(a.canvas,a.display.image,r.target.pub,r.e,r.target)}),a.opts.onmousedblclick&&a.canvas.on("mouse:dblclick",r=>{a.display.image&&r.target&&a.opts.onmousedblclick.call(a.canvas,a.display.image,r.target.pub,r.e,r.target)}),a.opts.tooltip&&(a.canvas.on("mouse:over",r=>{a.display.image&&r.target&&e.tooltip(r.target.left+r.target.width+2,r.target.top+r.target.height+2,a.opts.tooltip,a.display.image,r.target.pub,r.e,r.target)}),a.canvas.on("mouse:out",r=>{a.display.image&&r.target&&e.tooltip(r.target.left,r.target.top,null,a.display.image,r.target.pub,r.e,r.target)}))):(a.canvas.on("mouse:down",r=>{a.canvas._selection=a.canvas.selection,a.canvas.selection&&(a.canvas.selection=e.specialKey(r.e))}),a.canvas.on("mouse:up",()=>{a.canvas.selection=a.canvas._selection||a.canvas.selection})),a.canvas.on("object:modified",r=>{let u,f,m,b,w;const A=[];if(r.target&&(u=r.target,e.Fabric.updateChildren(a,u,"deltas"),a.opts.sortOverlapping)){if(u.setCoords(),a.canvas.forEachObject(x=>{x!==u&&u.intersectsWithObject(x)&&(b=x.getScaledWidth(),w=x.getScaledHeight(),A.push({obj:x,siz:b*w}))}),!A.length)return;for(b=u.getScaledWidth(),w=u.getScaledHeight(),A.push({obj:u,siz:b*w}),A.sort((x,y)=>x.siz<=y.siz?-1:1),m=A.length,f=0;f<m;f++)try{A[f].obj.sendToBack()}catch{}}}),a.canvas.on("object:scaling",r=>{let u;!r.target||(u=r.target,u.rescaleEvenly(),u.rescaleBorder(),e.Fabric.updateChildren(a,u,"scaling"),("activeSelection"===u.type||"group"===u.type)&&c(u,"scaling"))}),a.canvas.on("object:moving",r=>{let u;!r.target||(u=r.target,e.Fabric.updateChildren(a,u,"moving"),("activeSelection"===u.type||"group"===u.type)&&c(u,"moving"))}),a.canvas.on("object:rotating",r=>{let u;!r.target||(u=r.target,e.Fabric.updateChildren(a,u,"rotating"),("activeSelection"===u.type||"group"===u.type)&&c(u,"rotating"))}),a.canvas.on("selection:created",r=>{let u;e.globalOpts.skipSelectionProcessing||(r.target?(u=r.target,"activeSelection"===u.type||"group"===u.type&&!u.params?v(a,0,u):g(a,u)):r.selected&&r.selected.length&&(1===r.selected.length?(u=r.selected[0],g(a,u)):v(a)))}),a.canvas.on("selection:updated",r=>{let u;e.globalOpts.skipSelectionProcessing||(r.target?(u=r.target,"activeSelection"===u.type||"group"===u.type&&!u.params?v(a,0,u):g(a,u)):r.selected&&r.selected.length&&(1===r.selected.length?(u=r.selected[0],g(a,u)):v(a)))}),a.canvas.on("before:selection:cleared",r=>{let u;e.globalOpts.skipSelectionProcessing||!r.target||(u=r.target,"activeSelection"===u.type||"group"===u.type&&!u.params?((r,u)=>{let f,m,b;for(b=r.canvas.getActiveObjects(),f=0;f<b.length;f++)m=b[f],h(r,m);d(-1)})(a):h(a,u))}),a.divjq.closest(e.lightOpts[e.LIGHTWIN].drag).length&&a.divjq.on(fabric.isTouchSupported?"touchstart":"mouseenter",()=>{a.canvas.calcOffset()}),a)},e.Fabric.showShapeLayer=function(t,s,o){let n,a,l,c,d,h,p,g,v=0;if(l=this.getShapeLayer(t),l){if("string"==typeof(o=o||{}))try{o=JSON.parse(o)}catch(r){e.error(`can't parse showShapeLayer opts: ${o}`,r)}if(d=l.canvas,c=this.display.layers[t],e.isNull(s))return l.show;if(!0===s||"true"===s){if(!o.local&&(l.show=!0,this!==this.display.image))return;for(a of(l.show&&(d.selection=l.opts.canvas.selection),l.json&&l.show&&d.loadFromJSON(l.json,()=>{let r,u,f;for(r of(e.Fabric.updateChildren(l.dlayer,null,"objects"),this.resize&&(d.getObjects().forEach(m=>{m.left+=this.resize.left,m.top+=this.resize.top,m.setCoords()}),d.calcOffset()),l.zindex=Math.abs(l.zindex),c.divjq.css("z-index",l.zindex),Object.keys(this.layers)))t!==r&&this.layers[r].show&&(u=this.display.layers[r],u.divjq.css("z-index")<l.zindex&&(f=u.canvas.getActiveObject(),f&&(e.Fabric.removePolygonAnchors(u,f),u.canvas.getActiveObject()&&u.canvas.discardActiveObject())));this.restoreSelection(t)}),Object.keys(this.layers)))this.layers[a].json&&v++;v||(this.resize=null),this.xeqPlugins("shape","onshapelayershow",t)}else{if(!o.local&&this!==this.display.image)return void(l.show=!1);if(l.show){for(h=d.getObjects(),p=h.length;p--;)g=h[p],g.params&&(g.params.winid&&(g.params.winid.close(),g.params.winid=null),g.params.anchors&&e.Fabric.removePolygonAnchors(l.dlayer,g));n=d.toJSON(l.dlayer.el),l.json=JSON.stringify(n),this.saveSelection(t),d.selection=!1,c&&(l.zindex=-Math.abs(l.zindex),c.divjq.css("z-index",l.zindex)),d.clear()}o.local||(l.show=!1),this.xeqPlugins("shape","onshapelayerhide",t)}return this}},e.Fabric.displayShapeLayers=function(){let t;if(this!==this.display.image){if(this.display.image&&this.display.image.layers)for(t of Object.keys(this.display.image.layers))this.display.image.showShapeLayer(t,!1,{local:!0});if(this.layers)for(t of Object.keys(this.layers))this.showShapeLayer(t,!0,{local:!0})}},e.Fabric.toggleShapeLayers=function(){let t,s;if(this.toggleLayers){for(t of Object.keys(this.layers))s=this.layers[t],s&&this.toggleLayers[t]&&this.showShapeLayer(t,!0);delete this.toggleLayers}else for(t of(this.toggleLayers={},Object.keys(this.layers)))"crosshair"!==t&&(s=this.layers[t],s&&s.show&&"main"===s.dlayer.dtype&&(this.toggleLayers[t]=!0,this.showShapeLayer(t,!1)))},e.Fabric.getShapeLayer=function(t,s){let o,n;if(!t)return null;if(n=this.layers[t],!n){if(o=this.display.layers[t],!o)return null;this.layers[t]={},n=this.layers[t],n.show=!0,n.nshape=0,n.dlayer=o,n.opts=n.dlayer.opts,n.canvas=n.dlayer.canvas,n.canvas.calcOffset()}return n},e.Fabric.activeShapeLayer=function(t){let s,o,n,a,l,c,d,h,p;if(t)if($.isArray(t)){for(s=0,o=this.zlayer-1;s<t.length;s++)l=this.layers[t[s]],"main"===l.dlayer.dtype&&(l.zindex=o--,l.show?n||(n=t[s]):l.zindex=-l.zindex,l.dlayer.divjq.css("z-index",l.zindex));p=n}else{if(l=this.layers[t],l&&l.show){for(a of(d=l.zindex,l.zindex=this.zlayer-1,l.dlayer.divjq.css("z-index",l.zindex),Object.keys(this.layers)))c=this.layers[a],c!==l&&c.zindex===l.zindex&&"main"===c.dlayer.dtype&&(c.zindex=d,c.dlayer.divjq.css("z-index",c.zindex));this.xeqPlugins("shape","onshapelayeractive",t)}p=this}else{for(a of Object.keys(this.layers))c=this.layers[a],"main"===c.dlayer.dtype&&(void 0===h||c.zindex>h)&&(h=c.zindex,n=a);p=n}return p},e.Fabric._parseShapeOptions=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S;const _={},C={};if((s=s||{}).remove)return{remove:s.remove};if(S=s.parent||o&&o.params&&o.params.parent,delete s.parent,s.restoreid||delete s.id,delete s.restoreid,C.tags=[],s.tags)if("string"==typeof s.tags)for(c=s.tags.toLowerCase().split(","),n=0;n<c.length;n++)C.tags[n]=c[n].trim();else if($.isArray(s.tags))for(n=0;n<s.tags.length;n++)C.tags[n]=s.tags[n].trim();if(e.notNull(s.angle)){if(!S)switch(s.shape){case"box":case"cross":case"ellipse":case"text":if(this.raw.wcsinfo)this.raw.wcsinfo.crot&&(s.angle+=this.raw.wcsinfo.crot);else if(e.notNull(this.raw.header.LTM1_1)||e.notNull(this.raw.header.LTM1_2)){try{l=Math.atan((this.raw.header.LTM1_2||0)/(this.raw.header.LTM1_1||0))}catch{l=0}l&&(l=180*-l/Math.PI,s.angle+=l)}e.notNull(this.params.transformAngle)&&(s.angle+=this.params.transformAngle),e.notNull(this.params.transformScale)&&(s.angle*=this.params.transformScale)}_.angle=-s.angle}switch(void 0!==s.dx&&void 0!==s.dy&&(_.left=s.dx,_.top=s.dy),void 0!==s.x&&void 0!==s.y&&(d=this.imageToDisplayPos(s),_.left=d.x,_.top=d.y),void 0!==s.px&&void 0!==s.py&&(d=this.logicalToDisplayPos({x:s.px,y:s.py}),_.left=d.x,_.top=d.y),"string"==typeof s.wcs&&(y=s.wcs.trim().split(/ +/),s.ra=y[0],s.dec=y[1],y.length>=3&&(s.wcssys=y[2])),this.validWCS()&&e.notNull(s.ra)&&e.notNull(s.dec)&&(s.wcssys?(v=this.getWCSSys(),r=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(s.wcssys,!1)):s._wcssys&&(v=this.getWCSSys(),r=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(s._wcssys,!1),delete s._wcssys),"string"==typeof s.ra&&(s.ra=e.saostrtod(s.ra),e.isHMS(this.params.wcssys)&&(s.ra*=15)),"string"==typeof s.dec&&(s.dec=e.saostrtod(s.dec)),y=e.wcs2pix(this.raw.wcs,s.ra,s.dec).trim().split(/ +/),v&&(this.setWCSSys(v,!1),e.globalOpts.xeqPlugins=r),d=this.imageToDisplayPos({x:parseFloat(y[0]),y:parseFloat(y[1])}),_.left=d.x,_.top=d.y),void 0!==s.left&&(_.left=s.left),void 0!==s.top&&(_.top=s.top),void 0===_.left&&!0!==s.noLeftTop&&(_.left=o&&void 0!==o.left?o.left:this.display.canvasjq.attr("width")/2-1),void 0===_.top&&!0!==s.noLeftTop&&(_.top=o&&void 0!==o.top?o.top:this.display.canvasjq.attr("height")/2-1+1),s.deltax&&(_.left+=s.deltax),s.deltay&&(_.top-=s.deltay),g="main"!==this.display.layers[t].dtype||s.preservedcoords?1:this.rgb.sect.zoom,(""===s.strokeDashes||""===s.strokeDashArray)&&(s.strokeDashArray=[]),""===s.strokeWidth&&(s.strokeWidth=e.Fabric.opts.strokeWidth),s.shape){case"annulus":if(C.radii=[],void 0!==s.radii){if("string"==typeof s.radii)for(C.radii=s.radii.replace(/ /g,"").split(","),n=0,a=0;n<C.radii.length;n++)""!==C.radii[n]&&(s.sizeScale&&(C.radii[n]*=s.sizeScale),C.radii[a++]=this.wcs2imlen(C.radii[n]));else if(C.radii=s.radii,s.sizeScale)for(n=0;n<C.radii.length;n++)C.radii[n]*=s.sizeScale}else for(s.ireg&&e.SCALEIREG&&(e.notNull(s.iradius)&&(s.iradius/=g),e.notNull(s.oradius)&&(s.oradius/=g)),s.sizeScale&&(e.notNull(s.iradius)&&(s.iradius*=s.sizeScale),e.notNull(s.oradius)&&(s.oradius*=s.sizeScale)),b=(s.oradius-s.iradius)/s.nannuli,w=s.nannuli+1,n=0;n<w;n++)A=s.iradius+b*n,s.sizeScale&&(A*=s.sizeScale),C.radii.push(A);break;case"box":case"cross":s.ireg&&e.SCALEIREG&&(e.notNull(s.width)&&(s.width/=g),e.notNull(s.height)&&(s.height/=g)),s.sizeScale&&(e.notNull(s.width)&&(s.width*=s.sizeScale),e.notNull(s.height)&&(s.height*=s.sizeScale));break;case"circle":s.ireg&&e.SCALEIREG&&e.notNull(s.radius)&&(s.radius/=g),s.sizeScale&&e.notNull(s.radius)&&(s.radius*=s.sizeScale);break;case"ellipse":s.ireg&&e.SCALEIREG&&(e.notNull(s.r1)&&(s.r1/=g),e.notNull(s.r2)&&(s.r2/=g)),s.sizeScale&&(e.notNull(s.r1)&&(s.r1*=s.sizeScale),e.notNull(s.r2)&&(s.r2*=s.sizeScale));break;case"point":switch(s.ptshape){case"box":s.width=2*s.ptsize,s.height=2*s.ptsize;break;case"circle":s.radius=s.ptsize;break;case"ellipse":s.rx=s.ptsize,s.ry=s.ptsize/2}s.lockRotation=!0,s.lockScalingX=!0,s.lockScalingY=!0,s.lockUniScaling=!0,s.hasControls=!1,s.hasRotatingPoint=!1,s.hasBorders=!0;break;case"line":case"polygon":if(e.notNull(s.wcspts)&&this.validWCS()){for(s.pts=[],s.wcssys&&(v=this.getWCSSys(),r=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(s.wcssys,!1)),n=0;n<s.wcspts.length;n++)y=e.wcs2pix(this.raw.wcs,s.wcspts[n].ra,s.wcspts[n].dec).trim().split(/ +/),s.pts.push({x:parseFloat(y[0]),y:parseFloat(y[1])});v&&(this.setWCSSys(v,!1),e.globalOpts.xeqPlugins=r)}if(s.pts&&s.pts.length){if("string"==typeof s.pts){if(y=s.pts.replace(/ /g,"").split(","),p=y.length,"string"==typeof y[0])for(n=0;n<p;n++)y[n]=parseFloat(y[n]);for(s.pts=[],n=0,a=0;n<p;n+=2,a++)s.pts[a]={x:y[n],y:y[n+1]}}for(p=s.pts.length,n=0;n<p;n++)u=s.pts[n],e.notNull(u.x)&&e.notNull(u.y)?s.pts[n]=this.imageToDisplayPos(s.pts[n]):e.notNull(u.dx)&&e.notNull(u.dy)&&(s.pts[n].x=u.dx,delete s.pts[n].dx,s.pts[n].y=u.dy,delete s.pts[n].dy);for(s.left&&s.top?h={x:s.left,y:s.top}:s.dx&&s.dy?h={x:s.dx,y:s.dy}:(h=e.centerPolygon(s.pts),_.left=h.x,_.top=h.y),s.points=[],n=0;n<p;n++)d={x:(s.pts[n].x-h.x)/g,y:(s.pts[n].y-h.y)/g},s.points.push(d)}else(!o||!o.points||!o.points.length)&&("polygon"===s.shape&&s.polypoints?s.points=s.points||s.polypoints:"line"===s.shape&&s.linepoints&&(s.points=s.points||s.linepoints));if(s.ireg&&e.SCALEIREG)for(p=s.points.length,n=0;n<p;n++)s.points[n].x/=g,s.points[n].y/=g}for(f of Object.keys(s))switch(f){case"tags":case"x":case"y":case"px":case"py":case"deltax":case"deltay":case"ra":case"dec":case"pts":case"left":case"top":case"angle":case"radii":case"ireg":break;case"type":case"originX":case"originY":case"width":case"height":case"scaleX":case"scaleY":case"flipX":case"flipY":case"opacity":case"cornerSize":case"transparentCorners":case"hoverCursor":case"padding":case"borderColor":case"cornerColor":case"centeredScaling":case"centeredRotation":case"fill":case"fillRule":case"backgroundColor":case"stroke":case"strokeWidth":case"strokeDashArray":case"strokeLineCap":case"strokeLineJoin":case"strokeMiterLimit":case"shadow":case"borderOpacityWhenMoving":case"borderScaleFactor":case"borderDashArray":case"transformMatrix":case"minScaleLimit":case"selectable":case"evented":case"visible":case"hasControls":case"hasBorders":case"hasRotatingPoint":case"rotatingPointOffset":case"perPixelTargetFind":case"includeDefaultValues":case"clipTo":case"lockMovementX":case"lockMovementY":case"lockRotation":case"lockScalingX":case"lockScalingY":case"lockUniScaling":case"send":case"radius":case"rx":case"ry":case"points":case"selectionLineWidth":case"fontFamily":case"fontSize":case"fontStyle":case"fontWeight":case"text":case"textDecoration":case"textAlign":case"lineHeight":case"textBackgroundColor":case"textOpts":case"groupid":_[f]=s[f];break;case"shape":m=s[f];break;default:C[f]=s[f]}return _.stroke=C.color||_.stroke||((D,O,M)=>{let E,R,H;for(E of(O=O||{},Object.keys(O)))if(R=E.split("_"),0===$(D).not(R).length&&0===$(R).not(D).length){H=O[E];break}if(!H)for(E of Object.keys(O))if(R=E.split("_"),0===$(D).not(R).length){H=O[E];break}if(!H)for(E of Object.keys(O))if(R=E.split("_"),0===$(R).not(D).length){H=O[E];break}return H=H||M&&M.get("stroke")||O.defcolor||e.globalOpts.defcolor||"#000000",H})(C.tags,C.tagcolors,o),_.selectColor=_.stroke,(!0===e.globalOpts.controlsMatchRegion||"corner"===e.globalOpts.controlsMatchRegion)&&(_.cornerColor=_.stroke),(!0===e.globalOpts.controlsMatchRegion||"border"===e.globalOpts.controlsMatchRegion)&&(_.borderColor=_.stroke),void 0===C.changeable&&void 0!==C.fixinplace&&(C.changeable=!C.fixinplace),void 0===C.changeable&&void 0!==C.locked&&(C.changeable=!C.locked),(void 0!==C.changeable||void 0!==C.editing)&&(x=void 0!==C.editing?C.editing:!C.changeable,_.lockMovementX=x,_.lockMovementY=x,_.lockRotation=x,_.lockScalingX=x,_.lockScalingY=x,_.hasControls=!x,_.hasRotatingPoint=!x,_.hasBorders=!x),void 0!==C.movable&&(x=!C.movable,_.lockMovementX=x,_.lockMovementY=x),void 0!==C.resizable&&(x=C.resizable,_.hasControls=x,_.hasBorders=x),void 0!==C.rotatable&&(x=!C.rotatable,void 0===_.lockRotation&&(_.lockRotation=x,_.hasRotatingPoint=!x)),void 0!==C.editing&&(_.visible=!C.editing),{shape:m,opts:_,params:C}},e.Fabric._exportShapeOptions=function(t){return"object"!=typeof t?[]:Object.keys(t).filter(s=>{switch(s){case"top":case"left":case"width":case"height":case"radii":case"radius":case"rx":case"ry":case"angle":case"panzoom":case"iradius":case"oradius":case"nannuli":case"aradius1":case"aradius2":case"configURL":case"sortOverlapping":case"tagcolors":case"pts":case"ptshape":case"ptsize":case"linepoints":case"polypoints":case"responseType":case"display":case"tags":case"r1":case"r2":case"x":case"y":case"dx":case"dy":case"px":case"py":case"ra":case"dec":case"shape":case"parent":case"rtn":case"_wcssys":case"file":case"savefile":case"savewhich":case"saveformat":case"saveselection":case"savewcs":case"sortids":case"send":case"listonchange":case"multitext":return!1;case"text":return"text"!==t.shape;case"editing":return t.editing;default:return!0}})},e.Fabric._handleChildText=function(t,s,o){let n,a,l,c,d,h,p;if("regions"===t)if(o=o||{},"text"===s.params.shape||!o.text||s.params.children&&s.params.children.length){if(s.params.children&&s.params.children.length>0&&(e.notNull(o.text)||e.notNull(o.textOpts)||e.notNull(o.color)))for(n=0;n<s.params.children.length;n++)p=s.params.children[n].obj,d=$.extend(!0,{},o.textOpts||{}),e.notNull(o.text)&&(d.text=o.text),e.globalOpts.regSyncTextColor&&!d.color&&!1!==o.synctextcolor&&e.notNull(o.color)&&(d.color=o.color),Object.keys(d).length>0&&this.changeShapes(t,p.params.id,d)}else h=s.height*s.scaleX/2-12,l=Math.abs(s.angle)<1e-6?{x:s.left,y:s.top-h}:e.rotatePoint({x:s.left,y:s.top-h},s.angle,{x:s.left,y:s.top}),c=this.displayToImagePos(l),d={x:c.x,y:c.y,angle:-s.angle,color:s.stroke,text:o.text,tags:s.params.tags,parent:"TBD",rtn:"object"},o.textOpts&&(d=$.extend(!0,{},d,o.textOpts)),a=this.addShapes(t,"text",d),a.params.parent={id:s.params.id,obj:s,dleft:s.left-a.left,dtop:s.top-a.top,lastscalex:s.scaleX,lastscaley:s.scaleY,lastangle:s.angle,textheight:12},this._updateShape(t,a,null,"child",a.params),void 0!==o.strokeWidth&&(a.params.parent.strokeWidth=o.strokeWidth),(c.x!==d.x||c.y!==d.y)&&(a.params.parent.moved=!0),o.textOpts&&void 0!==o.textOpts.ra&&void 0!==o.textOpts.dec&&(a.params.hasTextOpts=!0),s.params.children.push({id:a.params.id,obj:a}),this._updateShape(t,s,null,"addchild",s.params)},e.Fabric.addShapes=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S={},_=[],C=[];const I=[],L={};if(!($.inArray("regions",this.params.disable)>=0&&"regions"===t)){if("string"==typeof(o=o||{}))try{o=JSON.parse(o)}catch(D){e.error(`can't parse shape opts: ${o}`,D)}if(this.display.image!==this)return this.delayedShapes=this.delayedShapes||[],void this.delayedShapes.push({layer:t,shape:s,mode:"add",opts:o});if(o.file&&e.globalOpts.reloadRefreshReg)try{this.removeShapes("regions",o.file)}catch{}if(v=this.getShapeLayer(t),v&&v.show){if(r=v.canvas,"string"==typeof s)h=this.parseRegions(s,o),l="string"==typeof h?[{shape:h}]:h;else if($.isArray(s))l=s;else{if("object"!=typeof s)return;l=[s]}if(e.isNull(v.zindex)||Number.isNaN(v.zindex)){if("main"===this.display.layers[t].dtype)switch(t){case e.Crosshair.LAYERNAME:case e.Grid.LAYERNAME:v.zindex=1;break;default:v.zindex=this.zlayer++}else v.zindex=e.SHAPEZINDEX;u=this.display.layers[t],u.divjq.css("z-index",v.zindex),this.xeqPlugins("shape","onshapelayercreate",t)}for(p=$.extend(!0,{},e.Fabric.opts,v.opts,o),d=0;d<l.length;d++)if(c=l[d],!0===c.preservedcoords&&((e.isNull(c.dx)||e.isNull(c.dy))&&$.isArray(c.pts)&&e.isNull(c.pts[0].dx)&&e.error("preservedcoords requires positions in display coords"),c.sticky=!0,c.preservedcoords=Object.keys(c),c.wcsconfig={wcssys:"image"}),g=$.extend(!0,{},p,c),a=this._parseShapeOptions(t,g),a.remove&&((!0===a.remove||"true"===a.remove)&&(a.remove="all"),!1!==a.remove&&"false"!==a.remove))this.removeShapes(t,a.remove);else if(a.shape){switch(g=a.opts,S=a.params,void 0===S.id&&(S.id=++v.nshape),void 0===S.wcsconfig&&(S.wcsconfig={wcssys:this.getWCSSys()}),S.exports=this._exportShapeOptions(o).concat(this._exportShapeOptions(c)),S.parent=null,S.children=[],g.stroke&&(g.color=g.stroke,g.stroke=e.colorToHex(g.stroke)),v.opts.noCenteredScaling&&$.inArray(a.shape,v.opts.noCenteredScaling)>=0&&(g.centeredScaling=!1),a.shape){case"annulus":if(S.shape="annulus",m=g.top,b=g.left,g.top=0,g.left=0,_=[],S.radii)for(n=0;n<S.radii.length;n++)g.radius=S.radii[n],_.push(new fabric.Circle(g));g.top=m,g.left=b,g.width=2*g.radius,g.height=2*g.radius,h=new fabric.Group(_,g);break;case"box":S.shape="box",h=new fabric.Rect(g);break;case"circle":S.shape="circle",h=new fabric.Circle(g);break;case"cross":S.shape="cross",m=g.top,b=g.left,w=g.angle,A=g.width/2,x=g.height/2,C=[],g.left=0,g.top=0,g.angle=0,g.points=[{x:-A,y:0},{x:A,y:0}],C.push(new fabric.Polyline(g.points,g)),g.points=[{x:0,y:-x},{x:0,y:x}],C.push(new fabric.Polyline(g.points,g)),g.top=m,g.left=b,g.angle=w,h=new fabric.Group(C,g);break;case"ellipse":S.shape="ellipse",g.rx=S.r1,g.ry=S.r2,h=new fabric.Ellipse(g);break;case"point":switch(S.shape="point",S.ptshape){case"box":default:h=new fabric.Rect(g);break;case"circle":h=new fabric.Circle(g);break;case"ellipse":h=new fabric.Ellipse(g)}break;case"line":S.shape="line",h=new fabric.Polyline(g.points,g);break;case"polygon":S.shape="polygon",h=new fabric.Polygon(g.points,g,!0);break;case"text":S.shape="text",S.text=g.text||"Double-click to add text here",g.fill=g.stroke,g.strokeWidth=0,h=new fabric.Text(S.text,g);break;default:e.error(`unknown shape: ${a.shape}`)}if(r.add(h),S.layerName=t,S.sw1=Math.max(1,Math.floor(h.strokeWidth+.5)),S.listonchange=!1,h.params=S,f="main"!==this.display.layers[t].dtype||h.params.preservedcoords?1:this.rgb.sect.zoom,v.opts.panzoom)switch(S.shape){case"point":case"text":break;default:h.scale(f)}if(h.rescaleBorder(),!1===h.params.changeable&&r.sendToBack(h),this._handleChildText(t,h,g),"TBD"!==o.parent&&this._updateShape(t,h,null,"add",S),o.onaddshapes&&h.pub)try{e.xeqByName(o.onaddshapes,this,this,h.pub)}catch(D){e.error("in onaddshapes callback",D,!1)}I.push(h),g.groupid&&(L[g.groupid]=L[g.groupid]||[],L[g.groupid].push(h))}for(y of Object.keys(L))this.groupShapes(t,L[y],{groupid:y,select:!1});return(void 0===S.redraw||S.redraw)&&r.renderAll(),"object"===o.rtn?h:"objs"===o.rtn?I:S.id}}},e.Fabric._parseShapes=function(t,s,o){let n;if(!this.layers||!t||!this.layers[t])return null;n=this.layers[t].canvas,o=o||{},e.tmp.regSelect={layer:t,im:this,all:[]},n.getObjects().forEach(a=>{let l;a.params?a.params.parent||e.tmp.regSelect.all.push(a.params.id):"group"===a.type&&(l=this.lookupGroup(a),l&&e.tmp.regSelect.all.push(l))});try{regSelect.parse(s)}catch(a){e.error(`parsing selection filter: ${s}`,a)}if(o.saveselection&&s)switch(s.trim()){case"all":case"saved":case"selected":break;default:this.layers[t].selection=s}return s=e.tmp.regSelect.ids,delete e.tmp.regSelect,s},e.Fabric._selectShapes=function(t,s,o,n){let a,l,c,d,h,p,g,v,r,u,f,m,b;const w=[],A=(_,C)=>{$.inArray(_,w)<0&&(n.call(this,_,C),w.push(_))},x=_=>{let C,I,L;if(!_)return[];L=_.length;do{for(C=0;L--;)I=_[L],"group"===I.type&&!I.params&&(_.splice(L,1,...I.getObjects()),C++);L=_.length}while(C);return _},y=(_,C)=>{let I,L,D,O,M,E,R,H=[],N=[];for(M=C.length,I=0;I<M;I++)O=C[I],("activeSelection"===O.type||"group"===O.type&&!O.params)&&H.push(O);if(E=H.length,R=_.getActiveObject(),R&&("activeSelection"===R.type||"group"===R.type&&!R.params||(R=null)),E||R)for(I=0;I<M;I++){for(D=C[I],L=0;L<E;L++)O=H[L],O.contains(D)&&(N[I]=O);N[I]||R&&R.contains(D)&&(N[I]=R)}return N},S=(_,C)=>{let I,L;for(I=0;I<C.length;I++)if(L=C[I],"activeSelection"===L.type||"group"===L.type&&!L.params){if(L.contains(_))return L}else if(L.params&&L===_)return g[I];return null};if(!this.layers||!t||!this.layers[t])return null;if("function"!=typeof n&&e.error("selectShapes requires a callback"),o=o||{},u=this.layers[t].canvas,s||(s=u.getActiveObject()&&"auto"===e.globalOpts.regWhichDefault?"selected":"all"),"string"==typeof s&&s.startsWith("["))try{s=JSON.parse(s)}catch{e.error("can't parse array selection")}if("string"==typeof s)if(this.layers[t].selection&&("and"===o.saved?s=`(saved) && (${s})`:("or"===o.saved||!0===o.saved)&&(s=`(saved) || (${s})`),s=s.replace(/saved/gi,this.layers[t].selection)),s.match(/&|\||!/))s=this._parseShapes(t,s,o);else if(o.saveselection&&s)switch(s.trim()){case"all":case"saved":case"selected":break;default:this.layers[t].selection=s}for($.isArray(s)||(s=[s]),l=0;l<s.length;l++)switch(c=u.getObjects().reverse(),d=c.length,g=y(u,c),v=s[l],"string"==typeof v&&/^[1-9]\d*$/.test(v)&&(v=parseInt(v,10)),r={group:null,canvas:u,layer:t},typeof v){case"object":for(h=x(c),p=h.length;p--;)if(b=h[p],b&&b.params&&b===v){r.group=S(b,c),A(b,r);break}break;case"number":for(h=x(c),p=h.length;p--;)if(b=h[p],b&&b.params&&b.params.id===v){r.group=S(b,c),A(b,r);break}break;case"string":if("selected"===v)for(h=x(u.getActiveObjects()),p=h.length;p--;)b=h[p],r.group=S(b,c),b.params&&!b.params.parent&&A(b,r);else for(;d--;)if(b=c[d],"group"!==b.type||b.params){if(b.params&&(f=b.stroke.toLowerCase(),(!b.params.parent||"child"===v||"All"===v)&&("child"!==v||b.params.parent)))if(r.group=g[d],"all"===v.toLowerCase())A(b,r);else if(v.toLowerCase()===f||e.colorToHex(v).toLowerCase()===f)A(b,r);else if(v===b.params.shape)A(b,r);else if(v===b.params.file)A(b,r);else if("object"==typeof b.params.data&&v===b.params.data.syncid)A(b,r);else if("child"===v&&b.params.parent)A(b,r);else if("dcoords"===v&&b.params.preservedcoords)A(b,r);else if("nodcoords"!==v||b.params.preservedcoords){if("parent"===v&&b.params.children&&b.params.children.length)A(b,r);else if($.inArray(v,e.wcssyss)>=0&&b.params.wcsconfig&&b.params.wcsconfig.wcssys===v)A(b,r);else if(b.params.tags)for(a=0;a<b.params.tags.length;a++)m=b.params.tags[a],(v.match(/^\/.*\/$/)&&m.match(new RegExp(v.slice(1,-1)))||v===m)&&A(b,r)}else A(b,r)}else v===this.lookupGroup(b)||"all"===v.toLowerCase()?(r.group=b,!1!==o.transparentgroup?b.forEachObject(_=>{_.params&&!_.params.parent&&A(_,r)}):A(b,r)):b.forEachObject(_=>{_.params&&v===_.params.file&&A(_,r)})}return this},e.Fabric.selectShapes=function(t,s,o){let n,a,l;const c=[];if(a=this.getShapeLayer(t),a){if(l=a.canvas,"string"==typeof(o=o||{}))try{o=JSON.parse(o)}catch(d){e.error(`can't parse selectShapes opts: ${o}`,d)}return e.isNull(o.transparentgroup)&&(o.transparentgroup=!1),e.isNull(o.saveselection)&&(o.saveselection=!0),"reset"===(s=s||"all")?(delete a.selection,!1!==o.activateselection&&(l.getActiveObject()&&l.discardActiveObject(),l.renderAll()),this):(this._selectShapes(t,s,o,d=>{$.inArray(d,c)<0&&(!d.params||!d.params.groupid)&&c.push(d)}),c.length&&(l.getActiveObject()&&l.discardActiveObject(),n=1===c.length?c[0]:new fabric.ActiveSelection(c,{canvas:l}),l.setActiveObject(n),l.renderAll()),this)}},e.Fabric.unselectShapes=function(t,s,o){let n,a,l;if(n=this.getShapeLayer(t),n&&this.layers[t])return s&&"all"!==s&&"selected"!==s?(l=this.layers[t].selection||"selected",a=`${l} && !(${s})`,this.selectShapes(t,a,o)):this.selectShapes(t,"reset")},e.Fabric.updateShapes=function(t,s,o,n){return this._selectShapes(t,s,null,(a,l)=>{this._updateShape(t,a,l,o,n)}),this},e.Fabric._updateMultiDialogs=function(t){$("form[class*='regionsConfigForm']").each((s,o)=>{const n=$(o).data("multi"),a=$(o).data("winid"),l=$(o).data("im");n&&a&&l===this&&!1!==l.tmp.updateMulti&&l.initRegionsForm(null,{winid:a,multi:n,setmode:t})})},e.Fabric._updateShape=function(t,s,o,n,a){let l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C,I,L,D,O,M,E,R,H;const N={},B=this.layers[t],P=/^(child||export|unexport|move|mouseout)$/,z=ee=>ee.toFixed(2),J=ee=>ee.toFixed(4),q=(ee,le,te,Q,de,xe,ce)=>{let he,Pe,Se,Y;if(Pe=e.pix2wcs(ee,te.x,te.y).trim().split(/\s+/),ce.rastr=Pe[0],ce.decstr=Pe[1],ce.wcssys=Pe[2],Se=e.strtoscaled(Pe[0]),e.isHMS(Pe[2],Se.dtype)&&(Se.dval*=15),Y=e.strtoscaled(Pe[1]),ce.ra=Se.dval,ce.dec=Y.dval,!1!==xe.updateWCS&&(xe.updateWCS||le.opts.updateWCS)){for(ce.wcsstr=e.reg2wcs(ee,Q,e.REGSIZE).replace(/;$/,""),"line"===te.shape&&de&&(ce.wcsstr=ce.wcsstr.replace(/} *$/,de+"}")),Pe=ce.wcsstr.replace(/.*\(/,"").replace(/\).*/,"").split(","),he=0;he<Pe.length;he++)Pe[he]=Pe[he].trim();switch(ce.wcsposstr=[Pe[0],Pe[1]],te.shape){case"annulus":ce.wcssizestr=[Pe[Pe.length-1]];break;case"box":case"cross":case"ellipse":ce.wcssizestr=[Pe[2],Pe[3]];break;case"circle":ce.wcssizestr=[Pe[2]];break;case"point":case"text":default:break;case"line":case"polygon":for(ce.wcspts=[],he=0;he<Pe.length;he+=2)Se=e.strtoscaled(Pe[he]),e.isHMS(ce.wcssys,Se.dtype)&&(Se.dval*=15),Y=e.strtoscaled(Pe[he+1]),ce.wcspts.push({ra:Se.dval,dec:Y.dval})}}},G=()=>{let ee;const le=te=>{try{this.params.xeqonchange=!1,e.xeqByName(te,window,this,N)}catch(Q){e.log("error in onchange: %s [%s]\n%s",this.id,Q.message,e.strace(Q))}finally{this.params.xeqonchange=!0}};!s.params.parent&&!n.match(P)&&(this.params.xeqonchange&&B.show&&(B.opts.onchange?le(B.opts.onchange):"regions"===t&&e.Regions.opts.onchange&&le(e.Regions.opts.onchange)),ee=`on${t}change`,this.xeqPlugins("shape",ee,N))};if(s&&s.params){if(o=o||{},a=a||{},m="main"!==this.display.layers[t].dtype||s.params.preservedcoords?1:this.rgb.sect.zoom,N.mode=n=n||"update",N.id=s.params.id,N.groupid=s.params.groupid,N.shape=s.params.shape,N.layer=t,N.color=s.color||s.stroke,N.tags=s.params.tags,N.sticky=s.params.sticky,N.preservedcoords=s.params.preservedcoords,s.params.ignore&&(N.ignore=!0),N.parent=s.params.parent?s.params.parent.obj.params.id:null,N.child=s.params.children&&s.params.children.length?s.params.children[0].id:null,w=s.getCenterPoint(),A={x:0,y:0},o.group&&(A=o.group.getCenterPoint(),w={x:A.x+w.x*o.group.scaleX,y:A.y+w.y*o.group.scaleY},o.group.angle&&(w=e.rotatePoint(w,o.group.angle,A)),"activeSelection"!==o.group.type)){if(R=B.canvas.getActiveObject(),R&&"activeSelection"===R.type)for(S=R.getObjects(),_=S.length,l=0;l<_;l++)if(S[l]===o.group){H=R.getCenterPoint();break}H||(R=null),R&&(w={x:H.x+w.x*R.scaleX,y:H.y+w.y*R.scaleY},R.angle&&(w=e.rotatePoint(w,R.angle,H)))}if(N.preservedcoords&&(N.dx=w.x,N.dy=w.y),x=this.displayToImagePos(w),N.x=x.x,N.y=x.y,N.lcs=this.imageToLogicalPos(x),"export"!==n&&s.params.wcsconfig&&("image"===s.params.wcsconfig.wcssys?E="image":"physical"===s.params.wcsconfig.wcssys&&(E="physical")),"image"===E||"image"===this.params.wcssys&&"physical"!==E?(N.imsys="image",p=N.x,g=N.y,f=1):(N.imsys=N.lcs.sys,p=N.lcs.x,g=N.lcs.y,f=Math.sqrt(Math.pow(this.lcs.physical.reverse[0][0],2)+Math.pow(this.lcs.physical.reverse[0][1],2))),N.angle=-s.angle,o.group&&(N.angle-=o.group.angle),R&&(N.angle-=R.angle),I=N.angle,!N.parent)switch(N.shape){case"box":case"cross":case"ellipse":case"text":if(e.notNull(this.params.transformScale)&&(N.angle/=this.params.transformScale),e.notNull(this.params.transformAngle)&&(N.angle-=this.params.transformAngle),this.raw.wcsinfo)this.raw.wcsinfo.crot&&(N.angle-=this.raw.wcsinfo.crot);else if(e.notNull(this.raw.header.LTM1_1)||e.notNull(this.raw.header.LTM1_2)){try{v=Math.atan((this.raw.header.LTM1_2||0)/(this.raw.header.LTM1_1||0))}catch{v=0}v&&(v=180*-v/Math.PI,N.angle-=v)}}for(;N.angle<0;)N.angle+=360;for(;N.angle>=360;)N.angle-=360;switch(d=s.scaleX/m,h=s.scaleY/m,o.group&&(d*=o.group.scaleX,h*=o.group.scaleY),N.shape){case"annulus":for(N.shape="annulus",N.radii=[],"image"!==N.imsys&&(N.lcs.radii=[]),N.imstr=`annulus(${z(p)},${z(g)},`,b=`annulus ${N.x} ${N.y} `,S=s.getObjects(),_=S.length,l=0;l<_;l++)C=S[l].radius*d,v=C*f,N.imstr+=z(v),b+=e.REGSIZE?`${N.x} ${N.y} ${N.x+C} ${N.y} `:`${C} `,N.imstr+=l===_-1?")":",",N.radii.push(C),"image"!==N.imsys&&N.lcs.radii.push(v);break;case"box":case"cross":N.width=s.width*d,N.height=s.height*h,v=N.width*f,r=N.height*f,"image"!==N.imsys&&(N.lcs.width=v,N.lcs.height=r),N.imstr=`${N.shape}(${z(p)},${z(g)},${z(v)},${z(r)},${J(N.angle)})`,b=e.REGSIZE?`${N.shape} ${N.x} ${N.y} ${N.x} ${N.y} ${N.x+N.width} ${N.y} ${N.x} ${N.y} ${N.x} ${N.y+N.height} ${N.angle*Math.PI/180}`:`${N.shape} ${N.x} ${N.y} ${N.width} ${N.height} ${N.angle*Math.PI/180}`;break;case"circle":N.radius=s.radius*d,v=N.radius*f,"image"!==N.imsys&&(N.lcs.radius=v),N.imstr=`circle(${z(p)},${z(g)},${z(v)})`,b=e.REGSIZE?`circle ${N.x} ${N.y} ${N.x} ${N.y} ${N.x+N.radius} ${N.y}`:`circle ${N.x} ${N.y} ${N.radius}`;break;case"ellipse":N.r1=s.width*d/2,N.r2=s.height*h/2,v=N.r1*f,r=N.r2*f,"image"!==N.imsys&&(N.lcs.r1=v,N.lcs.r2=r),N.imstr=`ellipse(${z(p)},${z(g)},${z(v)},${z(r)},${J(N.angle)})`,b=e.REGSIZE?`ellipse ${N.x} ${N.y} ${N.x} ${N.y} ${N.x+N.r1} ${N.y} ${N.x} ${N.y} ${N.x} ${N.y+N.r2} ${N.angle*Math.PI/180}`:`ellipse ${N.x} ${N.y} ${N.r1} ${N.r2} ${N.angle*Math.PI/180}`;break;case"point":N.width=s.width*d,N.height=s.height*h,v=N.width*f,r=N.height*f,"image"!==N.imsys&&(N.lcs.width=v,N.lcs.height=r),N.imstr=`point(${z(p)},${z(g)})`,b=`point ${N.x} ${N.y}`;break;case"line":case"polygon":for(N.imstr=`${N.shape}(`,b=`${N.shape} `,N.pts=[],"image"!==N.imsys&&(N.lcs.pts=[]),l=0;l<s.points.length;l++){if(l>0&&(N.imstr+=",",b+=" "),y=this.displayToImagePos({x:A.x+s.left+s.points[l].x*s.scaleX,y:A.y+s.top+s.points[l].y*s.scaleY}),y=e.rotatePoint(y,I,{x:N.x,y:N.y}),"image"===N.imsys)N.imstr+=`${z(y.x)},${z(y.y)}`;else{const{x:ee,y:le}=this.imageToLogicalPos(y);N.imstr+=`${z(ee)},${z(le)}`,N.lcs.pts.push({x:ee,y:le})}b+=`${y.x} ${y.y}`,N.pts.push(y),"line"===N.shape&&(0===l?D=0:(L=N.pts[l-1],D+=Math.sqrt((y.x-L.x)*(y.x-L.x)+(y.y-L.y)*(y.y-L.y))))}if("line"===N.shape&&e.notNull(D)){if(N.imstr+=`) {"size":${z(D)},"units":"pixels"`,2===N.pts.length){for(v=180*Math.atan2(N.pts[1].y-N.pts[0].y,N.pts[1].x-N.pts[0].x)/Math.PI;v<0;)v+=360;u=`,"posang":${J(v)},"posunits":"degrees"`,N.imstr+=u}N.imstr+="}"}else N.imstr+=")";N.angle=0;break;case"text":N.imstr=`text(${z(p)},${z(g)},"${s.text}",${J(N.angle)})`,b=`text ${N.x} ${N.y} "${s.text}" ${N.angle*Math.PI/180}`,N.text=s.text}if(this.validWCS()&&(q(this.raw.wcs,B,N,b,u,a,N),"export"!==n&&s.params.wcsconfig&&s.params.wcsconfig.wcssys&&(O=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,M=this.getWCSSys(),e.notWCS(s.params.wcsconfig.wcssys)||(this.setWCSSys(s.params.wcsconfig.wcssys,!1),q(this.raw.wcs,B,N,b,u,a,s.params.wcsconfig)),N.wcsconfig=$.extend(!0,{},s.params.wcsconfig),this.setWCSSys(M,!1),e.globalOpts.xeqPlugins=O)),N.data=s.params.data,s.set("pub",N),s.params.winid&&($(s.params.winid).is(":visible")?this.initRegionsForm(s):s.params.winid=null),a.nocb)return N;if(G(),"regions"===t&&e.globalOpts.regToClipboard&&(l="update"===n?N.parent||N.id:null,e.notNull(l))){try{c=this.listRegions(l,{mode:1,includedcoords:!0})}catch{c=null}c&&(e.clipboard=c)}return"regions"===t&&"wcs"===n&&this._updateMultiDialogs(!0),N}},e.Fabric.lookupGroup=function(t,s){let o,n,a,l,c,d,h,p;if(h=this.getShapeLayer(s=s||"regions"),!h)return null;if(p=this.layers[s].canvas,"string"==typeof t){for(a=p.getObjects(),o=0;o<a.length;o++)if(l=a[o],"group"===l.type&&!l.params)for(c=l.getObjects(),n=0;n<c.length;n++)if(d=c[n],d.params&&d.params.groupid===t)return l}else if("object"==typeof t&&"group"===t.type&&!t.params&&(a=t.getObjects(),a&&a.length&&a[0]&&a[0].params))return a[0].params.groupid;return null},e.Fabric.listGroups=function(t,s,o){let n,a,l,c,d,h,p,g="";if(d=this.getShapeLayer(o=o||"regions"),!d)return g;if(t=t||"all","string"==typeof s)try{s=JSON.parse(s)}catch(v){e.error(`can't parse listGroups opts: ${s}`,v)}for(s=s||{},h=d.canvas,l=h.getObjects(),n=0;n<l.length;n++)c=l[n],"group"===c.type&&!c.params&&(p=c.getObjects()[0].params.groupid,("all"===t||t===p)&&(!1===s.includeregions?g+=`${p};`:(a=`${this.getShapes(o,p,{format:"text",includejson:!1,includecomments:!0})};;`,a=a.substring(a.indexOf(";")+1),g+=`${p}:;${a}`)));return e.notNull(s.mode)&&s.mode>0&&this.display.displayMessage("regions",g),g.replace(/;\s*/g,"\n").replace(/\n\n$/,"\n")},e.Fabric.groupShapes=function(t,s,o){let n,a,l,c,d,h,p,g,v;const r=[],u=[];if(l=this.getShapeLayer(t),!l)return 0;if(c=l.dlayer,"string"==typeof(o=o||{}))try{o=JSON.parse(o)}catch(m){e.error(`can't parse groupShapes opts: ${o}`,m)}return d=l.canvas,p=(m=>{let b=1,w=m.groupid||`group_${b}`;for(;this.lookupGroup(w);)b+=1,w=w.replace(/_[0-9][0-9]*$/,"")+`_${b}`;return w})(o),this._selectShapes(t,s,o,m=>{if($.inArray(m,r)<0&&(g=!1,m.params.groupid&&("skip"===e.globalOpts.regGroupConflict?(v=m.params.groupid,g=!0):(a=sprintf("%s can only be a member of one group [%s,%s]","regions"===t?"regions":"shapes",m.params.id,m.params.groupid),e.error(a))),!g&&(m.params.groupid=p,$.inArray("groupid",m.params.exports)<0&&m.params.exports.push("groupid"),r.push(m),u.push(m.pub),m.params&&m.params.children.length)))for(n=0;n<m.params.children.length;n++)m.params.children[n].obj&&r.push(m.params.children[n].obj)}),r.length?(d.getActiveObject()&&d.discardActiveObject(),h=new fabric.ActiveSelection(r,{canvas:d}),e.globalOpts.skipSelectionProcessing=!0,d.setActiveObject(h),d.getActiveObject().toGroup(),!1===o.select&&d.getActiveObject()&&d.discardActiveObject(),delete e.globalOpts.skipSelectionProcessing,d.renderAll(),this.groups[t]=this.groups[t]||[],this.groups[t].push(p),"function"==typeof c.opts.ongroupcreate&&c.opts.ongroupcreate.call(c.canvas,p,this,u,r),p):v},e.Fabric.ungroupShapes=function(t,s,o){let n,a,l,c,d,h,p,g,v,r;if(d=this.getShapeLayer(t),!d||!this.layers[t])return this;for(e.isNull(s)&&e.error("ungroup requires a group id or selection"),o=o||{},h=d.canvas,p=h.getObjects(),n=0;n<p.length;n++)if(g=p[n],"group"===g.type&&!g.params)for(v=g.getObjects(),a=0,c=0;a<v.length;a++)r=v[a],r.params&&("all"===s||s===r.params.groupid)&&(c||(h.getActiveObject()&&h.discardActiveObject(),e.globalOpts.skipSelectionProcessing=!0,h.setActiveObject(g),h.getActiveObject().toActiveSelection(),o.select||h.discardActiveObject(),h.requestRenderAll(),delete e.globalOpts.skipSelectionProcessing,c++),delete r.params.groupid,l=$.inArray("groupid",r.params.exports),l>=0&&r.params.exports.splice(l,1));return this.groups[t]&&(l=$.inArray(s,this.groups[t]),l>=0&&this.groups[t].splice(l,1)),this},e.Fabric.removeShapes=function(t,s,o){let n,a,l,c,d=!1;const h={mode:1,includedcoords:!0,sortids:!1},p=[],g=[];if(a=this.getShapeLayer(t),a){for(l=a.canvas,o=o||{},l.getActiveObject()&&(c=l.getActiveObjects()),"regions"===t&&e.globalOpts.unremoveReg&&(this.regstack.push(this.listRegions(s,h,t)),this.regstack.length>e.globalOpts.unremoveReg&&(this.regstack=this.regstack.slice(0,e.globalOpts.unremoveReg))),this._selectShapes(t,s,o,(v,r)=>{let u,f,m;if((!1!==v.params.removable||o.overrideRemovable)&&(!v.params.sticky||!1!==o.sticky)){if("main"===a.dlayer.dtype&&this._updateShape(t,v,r,"remove"),v.params.winid&&(v.params.winid.close(),v.params.winid=null),v.params.parent)for(m=v.params.parent.obj,u=m.params.children.length-1;u>=0;u--)if(v===m.params.children[u].obj){m.params.children.splice(u,1);break}for(u=0;u<v.params.children.length;u++)f=v.params.children[u].obj,p.push(f);v.params.groupid&&$.inArray(v.params.groupid,g)<0&&g.push(v.params.groupid),c&&!d&&$.inArray(v,c)>=0&&(d=!0),p.push(v)}}),d&&l.discardActiveObject(),n=0;n<g.length;n++)this.ungroupShapes(t,g[n]);for(n=0;n<p.length;n++)l.remove(p[n]);return l.renderAll(),!l.size()&&e.globalOpts.resetEmptyShapeId&&(a.nshape=0),this}},e.Fabric.getShapes=function(t,s,o){let n,a,l,c,d={};const h=[];if("string"==typeof(o=o||{}))try{o=JSON.parse(o)}catch(p){e.error(`can't parse getShapes opts: ${o}`,p)}if("regions"===t&&("text"===o.format||"csv"===o.format||"regions"===o.format)){if(o.mode=o.mode||1,a=this.listRegions(s,o),"csv"===o.format)for(c=a.split(";"),n=0,a="";n<c.length;n++)!c[n]||(c[n].toLowerCase().match(e.WCSEXP)?o.includewcs&&(a+=`${c[n].trim()}\n`):(l=c[n].replace(/\(/,",").replace(/\).*/,"").trim(),a+=`${l}\n`));else"regions"===o.format&&(a=a.replace(/ *; */g,"\n"));return a}return this._selectShapes(t,s,o,p=>{d=p.pub||{},o.includeObj&&(d.obj=p),h.push(d)}),!1!==o.sortids&&h.sort((p,g)=>(p.id||0)-(g.id||0)),h},e.Fabric.changeShapes=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b;const w=[],A=[];if(d=this.getShapeLayer(t),d&&o){if("string"==typeof o)try{o=JSON.parse(o)}catch(x){e.error(`can't parse shape opts: ${o}`,x)}return this.display.image!==this?(this.delayedShapes=this.delayedShapes||[],void this.delayedShapes.push({layer:t,shape:s,mode:"change",opts:o})):(h=d.canvas,p=h.getActiveObject(),p&&"activeSelection"===p.type&&(g=h.getActiveObjects(),h.discardActiveObject(),h.renderAll(),p=null),e.isNull(o.saveselection)&&(o.saveselection=!0),this._selectShapes(t,s,o,(x,y)=>{if(u="main"!==this.display.layers[t].dtype||x.params.preservedcoords?1:this.rgb.sect.zoom,o.radii&&(x.params.radii=[]),o.tags&&(x.params.tags=[]),void 0!==o.locked&&delete x.params.changeable,c=$.extend(!0,{},x.params,o),l=this._parseShapeOptions(t,c,x),l.remove&&((!0===l.remove||"true"===l.remove)&&(l.remove="all"),!1!==l.remove&&"false"!==l.remove))this.removeShapes(t,l.remove||"all");else{switch(f=this._exportShapeOptions(o).filter(S=>!{}.hasOwnProperty.call(x.params.exports,S)),l.params.exports=x.params.exports.concat(f),l.opts.stroke&&(l.opts.color=l.opts.stroke,l.opts.stroke=e.colorToHex(l.opts.stroke)),x.params.shape){case"text":l.opts.stroke&&(l.opts.fill=l.opts.stroke),l.opts.strokeWidth=0;break;case"line":case"polygon":l.opts.points&&l.opts.points.length&&(x.angle=0)}switch(x.set(l.opts),x.params=$.extend(!1,{},x.params,l.params),l.opts.strokeWidth&&(x.params.sw1=l.opts.strokeWidth),x.params.shape){case"annulus":if(o.radii&&o.radii.length){for(x.forEachObject(S=>{w.push(S)}),v=w.length,n=0;n<v;n++)x.remove(w[n]),h.remove(w[n]);for(v=x.params.radii.length,r=0,m=$.extend(!0,{},o),m.stroke=m.stroke||x.get("stroke"),m.strokeWidth=m.strokeWidth||x.get("strokeWidth"),m.strokeDashArray=m.strokeDashArray||x.get("strokeDashArray"),n=0;n<v;n++)m.radius=x.params.radii[n],a=new fabric.Circle(m),r=Math.max(r,x.params.radii[n]),x.add(a);x.scaleX=u,x.scaleY=u,x.width=2*r,x.height=2*r,p===x&&h.setActiveObject(x)}break;case"box":o.width&&(x.scaleX=u),o.height&&(x.scaleY=u);break;case"circle":o.radius&&(x.scaleX=u,x.scaleY=u);break;case"cross":m=$.extend(!0,{},o),m.stroke=m.stroke||x.get("stroke"),m.width&&(x.scaleX=u,A[0]=[{x:-m.width/2,y:0},{x:m.width/2,y:0}],delete m.width),m.height&&(x.scaleY=u,A[1]=[{x:0,y:-m.height/2},{x:0,y:m.height/2}],delete m.height),m.angle&&delete m.angle,x.forEachObject((S,_)=>{b=$.extend(!0,{},m),A[_]&&(b.points=A[_]),S.set(b)});break;case"ellipse":o.r1&&(x.rx=x.params.r1,x.scaleX=u,x.width=2*x.rx),o.r2&&(x.ry=x.params.r2,x.scaleY=u,x.height=2*x.ry);break;case"line":case"polygon":(o.points&&o.points.length||o.pts&&o.pts.length)&&(x.scaleX=u,x.scaleY=u),p===x&&(e.Fabric.removePolygonAnchors(d.dlayer,x),e.Fabric.addPolygonAnchors(d.dlayer,x)),e.resetPolygonCenter(x);break;case"text":o.text&&(x.params.text=o.text)}switch(x.rescaleBorder(),!1===x.params.changeable&&h.sendToBack(x),l.opts.send){case"front":h.bringToFront(x),p===x&&h.discardActiveObject();break;case"back":h.sendToBack(x),p===x&&h.discardActiveObject()}if(e.Fabric.updateChildren(d.dlayer,x,"moving"),e.Fabric.updateChildren(d.dlayer,x,"scaling"),e.Fabric.updateChildren(d.dlayer,x,"rotating"),e.Fabric.updateChildren(d.dlayer,x,"deltas"),x.setCoords(),this._handleChildText(t,x,o),this._updateShape(t,x,y,"update"),o.onchangeshapes&&x.pub)try{e.xeqByName(o.onchangeshapes,this,this,x.pub)}catch(S){e.error("in onchangeshapes callback",S,!1)}}}),g&&this.selectShapes(t,g),(void 0===o.redraw||o.redraw)&&h.renderAll(),this)}},e.Fabric.refreshShapes=function(t){let s,o,n,a;if(t)return a={mode:1,sticky:!1,ignoreignore:!0,saveediting:!0,savewcsconfig:!0,sortids:!1,saveid:!0},n=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,o=this.getWCSSys(),"image"===o&&(this.validWCS()?this.setWCSSys("native",!1):this.setWCSSys("physical",!1)),this.tmp.panzoomRefresh&&this.tmp.panzoomRefresh[t]?this.tmp.panzoomRefresh[t].regstr?this.tmp.panzoomRefresh[t].refresh&&(s=this.tmp.panzoomRefresh[t].regstr,this.addShapes(t,s,{restoreid:!0})):(s=this.listRegions("all",a,t),this.tmp.panzoomRefresh[t]={regstr:s,refresh:!1},this.removeShapes(t,"all",{overrideRemovable:!0,sticky:!1})):(s=this.listRegions("all",a,t),s&&(this.saveSelection(t),this.removeShapes(t,"all",{overrideRemovable:!0,sticky:!1}),this.addShapes(t,s,{restoreid:!0,sortids:!1}),this.restoreSelection(t))),"image"===o&&(this.setWCSSys(o,!1),this.updateShapes(t,"all","refresh")),e.globalOpts.xeqPlugins=n,this},e.Fabric.copyShapes=function(t,s,o){let n,a,l,c,d;const h=[];if(d=this.getShapeLayer(t),d){if("object"==typeof s)h.push(s);else if("all"===s)for(n=0;n<e.images.length;n++)this!==e.images[n]&&h.push(e.images[n]);else a=e.lookupImage(s),a&&h.push(a);if(h.length){for(c={mode:1,includedcoords:e.globalOpts.regCopyDCoords,sortids:!1},l=this.listRegions(o,c,t),n=0;n<h.length;n++)c=this.display.layers[t]?this.display.layers[t].opts:e.Regions.opts,h[n].display.newShapeLayer(t,c),h[n].addShapes(t,l);return this}}},e.Fabric._addPolygonPoint=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w={},A={},x={},y=Number.MAX_VALUE;const S={},_={},C={},I={};if(s&&s.points){for(w=e.eventToDisplayPos(o),S.x=s.getCenterPoint().x,S.y=s.getCenterPoint().y,_.x=(w.x-S.x)/s.get("scaleX"),_.y=(w.y-S.y)/s.get("scaleY"),m=-s.get("angle")*Math.PI/180;m>2*Math.PI;)m-=2*Math.PI;for(I.x=Math.cos(m)*_.x-Math.sin(m)*_.y,I.y=Math.sin(m)*_.x+Math.cos(m)*_.y,a=s.points,n=0;n<a.length;n++)l=a[n],c=a[(n+1)%a.length],d=l.x<c.x?l.x:c.x,h=l.y<c.y?l.y:c.y,p=l.x>c.x?l.x:c.x,g=l.y>c.y?l.y:c.y,v={x:l.x-c.x,y:l.y-c.y},r=Math.sqrt(v.x*v.x+v.y*v.y),0!==r&&(v.x=v.x/r,v.y=v.y/r),A={x:I.x-c.x,y:I.y-c.y},u=A.x*v.x+A.y*v.y,x={x:c.x+v.x*u,y:c.y+v.y*u},x.x<d?x.x=d:x.x>p&&(x.x=p),x.y<h?x.y=h:x.y>g&&(x.y=g),f=(x.x-I.x)*(x.x-I.x)+(x.y-I.y)*(x.y-I.y),f<y&&(y=f,C.x=x.x,C.y=x.y,C.i=n===a.length?0:n);switch(b=this.getShapeLayer(t),e.Fabric.removePolygonAnchors(b.dlayer,s),a.splice(C.i+1,0,{x:C.x,y:C.y}),s.type){case"polyline":case"polygon":e.Fabric.addPolygonAnchors(b.dlayer,s),b.dlayer.canvas.renderAll()}s.polyparams?b.dlayer.params.sel=s.polyparams.polygon:s.params&&(b.dlayer.params.sel=s)}},e.Fabric._removePolygonPoint=function(t,s){let o,n,a,l;!s||!s.polyparams||(n=s.polyparams.polygon,a=n.points,!("polygon"===n.type&&a.length<=3)&&("polyline"===n.type&&a.length<=2||(l=s.polyparams.point,delete s.polyparams.point,o=this.getShapeLayer(t),e.Fabric.removePolygonAnchors(o.dlayer,n),a.splice(l,1),e.resetPolygonCenter(n),o.canvas.setActiveObject(n))))},e.Fabric.addPolygonAnchors=function(t,s){let o,n,a={};const l=t.canvas,c=h=>{let p,g,v,r,u;h.target&&h.target.polyparams?p=h.target:h.transform&&h.transform.target&&h.transform.target.polyparams&&(p=h.transform.target),p&&(g=p.polyparams.polygon,!1!==g.params.changeable&&(r=g.get("points"),v=p.polyparams.point,void 0!==v&&void 0!==r[v]&&(g.angle?a=e.rotatePoint({x:p.left,y:p.top},-g.angle,{x:g.left,y:g.top}):(a.x=p.left,a.y=p.top),r[v].x=(a.x-g.left)/g.scaleX,r[v].y=(a.y-g.top)/g.scaleY,e.resetPolygonCenter(g),t.display.image&&(u=t.display.image,u._updateShape(g.params.layerName,g,null,"update"),(u.params.listonchange||g.params.listonchange)&&u.listRegions(g,{mode:2})),l.renderAll())))},d=h=>{let p,g={};for(p=0;p<h.params.anchors.length;p++)g.x=h.left+h.points[p].x*h.scaleX,g.y=h.top+h.points[p].y*h.scaleY,h.angle&&(g=e.rotatePoint(g,h.angle,{x:h.left,y:h.top})),h.params.anchors[p].set({left:g.x,top:g.y,angle:h.angle}),h.params.anchors[p].setCoords();h._calcDimensions(!0),l.renderAll()};if(!s.params.anchors&&!1!==s.params.changeable){for(s.params.anchors=[],o=0;o<s.points.length;o++)a.x=s.left+s.points[o].x*s.scaleX,a.y=s.top+s.points[o].y*s.scaleY,s.angle&&(a=e.rotatePoint(a,s.angle,s.getCenterPoint())),n=new fabric.Rect({left:a.x,top:a.y,hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,selectable:!0,fill:s.get("stroke"),hoverCursor:"pointer",width:e.Fabric.opts.cornerSize+2,height:e.Fabric.opts.cornerSize+2,padding:2}),n.on("moving",c),n.polyparams={},n.polyparams.polygon=s,n.polyparams.point=o,s.params.anchors[o]=n,l.add(n);s.on("moving",()=>{d(s)}),s.on("rotating",()=>{d(s)}),s.on("scaling",()=>{d(s)}),s.setCoords()}},e.Fabric.removePolygonAnchors=function(t,s){let o;const n=t.canvas;if(s&&s.params&&s.params.anchors){for(o=0;o<s.params.anchors.length;o++)n.remove(s.params.anchors[o]);delete s.params.anchors}},e.Fabric._ungroupAnnulus=function(t,s){let o,n,a,l,c;if(a=this.getShapeLayer(t),a){for(this.editAnnulus={annulus:s.params.id,ids:[]},c={top:s.top,left:s.left,lockMovementX:!0,lockMovementY:!0,stroke:s.stroke,strokeDashArray:[3,1]},l=s.getObjects(),l.sort((h,p)=>p.radius-h.radius),o=0;o<l.length;o++)c.radius=l[o].radius,0===c.radius&&(c.radius=1e-6),c.ignore=!0,n=this.addShapes(t,"circle",c),this.editAnnulus.ids.push(n);c={editing:!0},this.changeShapes(t,s,c),a.canvas.getActiveObject()===s&&a.canvas.discardActiveObject(),a.canvas.sendToBack(s),a.canvas.renderAll()}},e.Fabric._regroupAnnulus=function(t,s){let o,n,a,l,c,d,h,p;const v=[];if(this.editAnnulus&&(d=this.getShapeLayer(t),d)){if("boolean"==typeof s?p=s:"object"==typeof s&&(p=s.shiftKey),h={editing:!1},!p){for(d.canvas.getObjects().forEach(r=>{r.params&&"circle"===r.params.shape&&v.push(r)}),h.radii=[],l=[...this.editAnnulus.ids],n=v.length-1;n>=0;n--){for(c=v[n].params.id,o=l.length-1;o>=0;o--)if(a=l[o],c===a){1e-6===v[n].pub.radius&&(v[n].pub.radius=0),h.radii.push(v[n].pub.radius),l.splice(o,1);break}if(!l.length)break}h.radii.sort((r,u)=>r-u)}this.changeShapes(t,this.editAnnulus.annulus,h),this.removeShapes(t,this.editAnnulus.ids),delete this.editAnnulus}},e.Fabric.updateChildren=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m={};if("regions"===t.layerName){if("objects"===o){g=t.canvas.getObjects().reverse(),v=g.length;do{for(r=0;v--;)a=g[v],"group"===a.type&&!a.params&&(g.splice(v,1,...a.getObjects()),r++);v=g.length}while(r);return g.forEach(b=>{b.params&&(b.params.parent||b.params.children.length)&&(m[b.params.id]=b)}),void g.forEach(b=>{if(b.params)for(b.params.parent&&(b.params.parent.obj=m[b.params.parent.id]),n=0;n<b.params.children.length;n++)b.params.children[n].obj=m[b.params.children[n].id]})}if(s&&s.params){if("deltas"===o)return void(s.params.parent&&(l=s.params.parent,u=l.obj.left-s.left,f=l.obj.top-s.top,u!==l.dleft||f!==l.dtop?(l.dleft=u,l.dtop=f,l.moved=!0):delete l.moved));for(n=0;n<s.params.children.length;n++){switch(c=s.params.children[n].obj,l=c.params.parent,o){case"moving":c.left=s.left-l.dleft,c.top=s.top-l.dtop;break;case"rotating":for(p=s.angle;p<0;)p+=360;for(;p>=360;)p-=360;for(d=p-l.lastangle,h=e.rotatePoint({x:c.left,y:c.top},d,{x:s.left,y:s.top}),c.left=h.x,c.top=h.y,l.dleft=s.left-c.left,l.dtop=s.top-c.top,c.angle=c.angle+d;c.angle<0;)c.angle+=360;for(;c.angle>=360;)c.angle-=360;l.lastangle=p;break;case"scaling":l.dleft=l.dleft*(s.scaleX/l.lastscalex),l.dtop=s.scaleY/l.lastscaley*(l.dtop-l.textheight)+l.textheight,l.lastscalex=s.scaleX,l.lastscaley=s.scaleY,l.moved=!0,c.left=s.left-l.dleft,c.top=s.top-l.dtop}c.setCoords(),t.display.image&&t.display.image.updateShapes(t.layerName,c,"updatechild")}}}},e.resetPolygonCenter=function(t){let s,o,n,a,l,c,d,h={};for(a=t._calcDimensions(),c=(a.left+a.width/2)*t.scaleX,d=(a.top+a.height/2)*t.scaleY,t.angle?h=e.rotatePoint({x:t.left+c,y:t.top+d},t.angle,{x:t.left,y:t.top}):(h.x=t.left+c,h.y=t.top+d),o=c/t.scaleX,n=d/t.scaleY,s=0;s<t.points.length;s++)t.points[s].x-=o,t.points[s].y-=n;t.left=h.x,t.top=h.y,l=t._calcDimensions(),t.width=l.width,t.height=l.height,t.pathOffset={x:l.left+t.width/2,y:l.top+t.height/2},t.setCoords()},e.Fabric.saveSelection=function(t){let s,o,n,a,l,c;o=this.getShapeLayer(t),o&&(n=o.canvas,l=n.getActiveObjects(),c=l.length,1===c&&(a=l[0],a.params?!1!==a.params.changeable&&(o.savesel=a.params.id):"group"===a.type&&(s=this.lookupGroup(a),s&&(o.savesel=s))))},e.Fabric.restoreSelection=function(t){let s,o,n,a,l,c,d,h;if(a=this.getShapeLayer(t),a&&a.savesel){for(c=a.canvas,l=a.savesel,d=c.getObjects(),h=d.length,s=0;s<h;s++){if(o=d[s],o.params&&o.params.id===l){n=o.params.id;break}if("group"===o.type&&this.lookupGroup(o)===l){n=l;break}}n&&(e.globalOpts.skipSelectionProcessing=!0,this.selectShapes(t,n,{saveselection:!1}),delete e.globalOpts.skipSelectionProcessing,this.updateShapes(t,n,"restore")),delete a.savesel}},e.Fabric.print=function(t){let s,o,n,a,l,c,d,h="",p=0;const v="<div style='position:absolute; left:%spx; top:%spx'>",r=sprintf("width=%s,height=%s,menubar=1,toolbar=1,status=0,scrollbars=1,resizable=1",this.display.canvasjq.attr("width"),this.display.canvasjq.attr("height"));if("string"==typeof(t=t||{}))try{t=JSON.parse(t)}catch(u){e.error(`can't parse print opts: ${t}`,u)}for(o of(a=this.display.canvas.toDataURL("image/png"),s="<html><body style='padding: 0px; margin: 0px' onload='window.print(); return false'>",l=sprintf(v,0,p),s+=`${l}<img src='${a}'></div>`,Object.keys(this.layers)))d=this.layers[o],"main"===d.dlayer.dtype&&d.show&&(s+=`${l}${d.dlayer.canvas.toSVG()}</div>`);(void 0===t.colorbar||t.colorbar)&&(c=this.display.pluginInstances.JS9Colorbar,c&&c.isActive()&&(p+=2,a=c.colorbarjq[0].toDataURL("image/png"),p+=this.display.height,l=sprintf(v,0,p),s+=`${l}<img src='${a}'></div>`,c.textjq&&c.textjq[0]&&(a=c.textjq[0].toDataURL("image/png"),p+=c.colorbarjq.height()+1,l=sprintf(v,0,p),s+=`${l}<img style='width:${this.display.width}px;'src='${a}'></div>`))),s+="</body></html>",window.electron&&(h="data:text/html,"+s),n=window.open(h,this.id,r),n?n.document?(n.document.open(),n.document.write(s),n.document.close()):e.error("no method available for drawing image into print window"):e.error("could not create print window (check your pop-up blockers)")},e.Fabric.initGraphics=function(){e.Display.prototype.newShapeLayer=e.Fabric.newShapeLayer,e.Image.prototype._selectShapes=e.Fabric._selectShapes,e.Image.prototype._updateShape=e.Fabric._updateShape,e.Image.prototype._parseShapes=e.Fabric._parseShapes,e.Image.prototype._parseShapeOptions=e.Fabric._parseShapeOptions,e.Image.prototype._exportShapeOptions=e.Fabric._exportShapeOptions,e.Image.prototype._handleChildText=e.Fabric._handleChildText,e.Image.prototype._addPolygonPoint=e.Fabric._addPolygonPoint,e.Image.prototype._removePolygonPoint=e.Fabric._removePolygonPoint,e.Image.prototype._ungroupAnnulus=e.Fabric._ungroupAnnulus,e.Image.prototype._regroupAnnulus=e.Fabric._regroupAnnulus,e.Image.prototype._updateMultiDialogs=e.Fabric._updateMultiDialogs,e.Image.prototype.addShapes=e.Fabric.addShapes,e.Image.prototype.updateShapes=e.Fabric.updateShapes,e.Image.prototype.getShapes=e.Fabric.getShapes,e.Image.prototype.changeShapes=e.Fabric.changeShapes,e.Image.prototype.removeShapes=e.Fabric.removeShapes,e.Image.prototype.refreshShapes=e.Fabric.refreshShapes,e.Image.prototype.copyShapes=e.Fabric.copyShapes,e.Image.prototype.selectShapes=e.Fabric.selectShapes,e.Image.prototype.unselectShapes=e.Fabric.unselectShapes,e.Image.prototype.groupShapes=e.Fabric.groupShapes,e.Image.prototype.ungroupShapes=e.Fabric.ungroupShapes,e.Image.prototype.listGroups=e.Fabric.listGroups,e.Image.prototype.lookupGroup=e.Fabric.lookupGroup,e.Image.prototype.saveSelection=e.Fabric.saveSelection,e.Image.prototype.restoreSelection=e.Fabric.restoreSelection,e.Image.prototype.getShapeLayer=e.Fabric.getShapeLayer,e.Image.prototype.showShapeLayer=e.Fabric.showShapeLayer,e.Image.prototype.activeShapeLayer=e.Fabric.activeShapeLayer,e.Image.prototype.displayShapeLayers=e.Fabric.displayShapeLayers,e.Image.prototype.toggleShapeLayers=e.Fabric.toggleShapeLayers,e.Image.prototype.print=e.Fabric.print},e.Fabric.initGraphics(),e.MouseTouch={},e.MouseTouch.CLASS="JS9",e.MouseTouch.NAME="MouseTouch",e.MouseTouch.WIDTH=512,e.MouseTouch.HEIGHT=220,e.MouseTouch.BASE=e.MouseTouch.CLASS+e.MouseTouch.NAME,e.MouseTouch.mouseText=[],e.MouseTouch.mouseText[0]="Move mouse, no buttons pressed:",e.MouseTouch.mouseText[1]="Move mouse, primary button pressed:",e.MouseTouch.mouseText[2]="Move mouse, secondary button pressed:",e.MouseTouch.touchText=[],e.MouseTouch.touchText[0]="Touch move, with one finger:",e.MouseTouch.touchText[1]="Touch move, with two fingers:",e.MouseTouch.touchText[2]="Touch move, with three fingers:",e.MouseTouch.textHTML="<div style='float: left'>%s</div>",e.MouseTouch.actionHTML="<div style='float: left'><b>%s</b></div>",e.MouseTouch.actionid=function(t,s){return`${t}_${s}`.replace(/[^A-Za-z0-9_]/g,"_")},e.MouseTouch.addText=function(t,s){let o,n;return o=sprintf(e.MouseTouch.textHTML,s),n=$("<div>").addClass(`${e.MouseTouch.BASE}Text`).html(o).appendTo(t),n},e.MouseTouch.addAction=function(t,s,o){let n,a,l;return a=e.MouseTouch.actionid(s,o),n=sprintf(e.MouseTouch.actionHTML,o),l=$("<div>").addClass(`${e.MouseTouch.BASE}Action`).attr("id",a).html(n).appendTo(t),l},e.MouseTouch.isPinch=function(t,s){let o,n,a,l,c;const d=e.globalOpts.pinchWait,h=e.globalOpts.pinchThresh;if(!t||(n=t.display,!e.globalOpts.mousetouchZoom||2!==t.pos.touches.length))return-1;switch(n.ispinch){case-1:case 1:return n.ispinch}if(a=Math.sqrt((t.pos.touches[0].x-t.pos.touches[1].x)*(t.pos.touches[0].x-t.pos.touches[1].x)+(t.pos.touches[0].y-t.pos.touches[1].y)*(t.pos.touches[0].y-t.pos.touches[1].y)),n.dist0||(n.dist0=a),n.deltas.push(Math.floor(a-n.dist0)),n.deltas.length>=d){for(o=1,l=0,c=0;o<d;o++)n.deltas[o]>n.deltas[o-1]?l++:n.deltas[o]<n.deltas[o-1]&&c++;return n.ispinch=l>=h||c>=h?1:-1,n.lastzoom=0,n.ispinch}return 0},e.MouseTouch.Actions={},e.MouseTouch.Actions["display value/position"]=function(t,s,o){e.specialKey(o)||e.globalOpts.internalValPos&&t&&s&&s.x>0&&s.y>0&&s.x<=t.raw.width&&s.y<=t.raw.height&&(t.valpos=t.updateValpos(s,!0))},e.MouseTouch.Actions["change contrast/bias"]=function(t,s,o){let n,a,l,c;!e.globalOpts.internalContrastBias||!t||!s||"static"!==t.cmapObj.type&&(c=t.display,!(t.pos0&&t.pos&&Math.abs(t.pos0.x-t.pos.x)<e.NOMOVE&&Math.abs(t.pos0.y-t.pos.y)<e.NOMOVE)&&(t.clickInRegion||e.specialKey(o)||t.useOffScreenCanvas()||(l=e.eventToDisplayPos(o,t.posOffset),n=Math.floor(l.x+.5),a=Math.floor(l.y+.5),(!e.globalOpts.containContrastBias||!(n<0||a<0||n>=c.canvas.width||a>=c.canvas.height))&&(t.params.bias=n/c.canvas.width,t.params.contrast=a/c.canvas.height*10,e.bugs.firefox_linux?window.setTimeout(()=>{t.displayImage("scaled",{blendMode:!1})},0):t.displayImage("scaled",{blendMode:!1}),t.xeqStashDiscard("filterRGBImage"),e.globalOpts.extendedPlugins&&t.xeqPlugins("image","onchangecontrastbias")))))},e.MouseTouch.Actions["change contrast/bias"].stop=function(t,s,o){t.display.blendMode&&t.displayImage("rgb")},e.MouseTouch.Actions["wheel zoom"]=function(t,s){let o,n,a,l,c=e.globalOpts.panzoomRefreshLimit,d=0;const h=s.originalEvent.deltaY*Math.sign(e.DIRZOOM);if(t&&e.globalOpts.mousetouchZoom&&(t.tmp.wheelzooms=t.tmp.wheelzooms||0,t.tmp.wheelzooms++%e.MODZOOM==0&&(o=t.getZoom(),n=h<0?Math.min(e.MAXZOOM,o+e.ADDZOOM):Math.max(e.MINZOOM,o-e.ADDZOOM),!(e.globalOpts.mousetouchLimit&&(a=Math.min(t.display.width/t.raw.width,t.display.height/t.raw.height),a>n&&o>n))))){for(l of(n=Math.round(100*(n+1e-5))/100,Object.keys(t.layers)))t.layers[l].show&&t.layers[l].opts.panzoom&&t.layers[l].canvas.size()>c&&(t.tmp.panzoomRefresh=t.tmp.panzoomRefresh||{},t.tmp.panzoomRefresh[l]={},d++);t.tmp.panzoomTimeout&&(clearTimeout(t.tmp.panzoomTimeout),delete t.tmp.panzoomTimeout),(d||t.tmp.panzoomRefresh)&&(t.tmp.panzoomTimeout=setTimeout(()=>{t.refreshLayers(t.tmp.panzoomRefresh),delete t.tmp.panzoomRefresh},e.TIMEOUT)),t.setZoom(n)}},e.MouseTouch.Actions["pan the image"]=function(t,s,o){let n,a,l,c,d,h,p=e.globalOpts.panMouseThreshold,g=e.globalOpts.panzoomRefreshLimit;if(t&&(c=t.rgb.sect,n=(t.pos0.x-t.pos.x)/c.zoom,a=(t.pos0.y-t.pos.y)/c.zoom,Math.abs(n)>=p||Math.abs(a)>=p)){for(h of("x"===t.params.flip?n=-n:"y"===t.params.flip?a=-a:"xy"===t.params.flip&&(n=-n,a=-a),90===t.params.rot90?(l=n,n=-a,a=l):180===t.params.rot90?(n=-n,a=-a):-90===t.params.rot90&&(l=n,n=a,a=-l),d={x:c.xcen+n,y:c.ycen-a},t.params.rotate&&(d=e.rotatePoint(d,-t.params.rotate,{x:c.xcen,y:c.ycen})),Object.keys(t.layers)))t.layers[h].show&&t.layers[h].opts.panzoom&&t.layers[h].canvas.size()>g&&(t.tmp.panzoomRefresh=t.tmp.panzoomRefresh||{},t.tmp.panzoomRefresh[h]={});t.setPan(d),t.pos0=t.pos}},e.MouseTouch.Actions.pinch=function(t,s,o){let n,a,l;!t||(n=t.display,a=Math.sqrt((t.pos.touches[0].x-t.pos.touches[1].x)*(t.pos.touches[0].x-t.pos.touches[1].x)+(t.pos.touches[0].y-t.pos.touches[1].y)*(t.pos.touches[0].y-t.pos.touches[1].y)),l=n.zoom0*a/n.dist0,l=Math.max(e.MINZOOM,Math.min(e.MAXZOOM,Math.round(100*(l+1e-5))/100)),l!==n.lastzoom&&t.setZoom(l),n.lastzoom=l)},e.MouseTouch.Actions.start=function(t,s,o){let n,a;t&&(n=t.display,n.ispinch=0,n.dist0=0,n.zoom0=t.rgb.sect.zoom,n.deltas=[]),a=e.MouseTouch.getAction(t,o),e.MouseTouch.Actions[a]&&e.MouseTouch.Actions[a].start&&e.MouseTouch.Actions[a].start(t,t.ipos,o)},e.MouseTouch.Actions.stop=function(t,s,o){const n=e.MouseTouch.getAction(t,o);e.MouseTouch.Actions[n]&&e.MouseTouch.Actions[n].stop&&e.MouseTouch.Actions[n].stop(t,t.ipos,o)},e.MouseTouch.getAction=function(t,s){let o,n;if(!t)return o;switch(n=t.display,t.clickState){case 0:o=n.mouseActions[0];break;case 1:o=n.mouseActions[1];break;case 2:o=n.mouseActions[2];break;case-1:o=n.touchActions[0];break;case-2:switch(e.MouseTouch.isPinch(t,s)){case-1:o=n.touchActions[1];break;case 0:break;case 1:o="pinch"}break;case-3:o=n.touchActions[2]}return o},e.MouseTouch.action=function(t,s,o){(o=o||e.MouseTouch.getAction(t,s))&&e.MouseTouch.Actions[o]&&e.MouseTouch.Actions[o](t,t.ipos,s)},e.MouseTouch.mousetouchzoom=function(t,s){e.lookupDisplay(t)&&(e.globalOpts.mousetouchZoom=s.checked)},e.MouseTouch.init=function(){let t,s;if(this.divjq.html(""),this.divjq.addClass("JS9PluginScrolling"),this.mousetouchContainer=$("<div>").addClass(`${e.MouseTouch.BASE}Container`).attr("id",`${this.id}MouseTouchContainer`).appendTo(this.divjq),s=sprintf("<div class='%s'><span><b>Drag an action to reconfigure JS9 mouse/touch events:</b></span><p>",`${e.MouseTouch.BASE}Header`),this.mousetouchHeadContainer=$("<span style='float: left'>").addClass(`${e.MouseTouch.BASE}Container`).attr("id",`${this.id}MouseTouchHeadContainer`).html(s).appendTo(this.mousetouchContainer),this.mousetouchTextContainer=$("<span style='float: left'>").addClass(`${e.MouseTouch.BASE}Container`).attr("id",`${this.id}MouseTouchTextContainer`).appendTo(this.mousetouchContainer),this.mousetouchActionContainer=$("<span style='float: left'>").addClass(`${e.MouseTouch.BASE}Container`).attr("id",`${this.id}MouseTouchActionContainer`).appendTo(this.mousetouchContainer),e.TOUCHSUPPORTED){for(this.mousetouchTouchTextContainer=$("<div>").addClass(`${e.MouseTouch.BASE}TextContainer`).attr("id",`${this.id}TouchTextContainer`).html("").appendTo(this.mousetouchTextContainer),t=0;t<e.MouseTouch.touchText.length;t++)e.MouseTouch.addText.call(this,this.mousetouchTouchTextContainer,e.MouseTouch.touchText[t]);for(t=e.MouseTouch.touchText.length;t<this.display.touchActions.length;t++)e.MouseTouch.addText.call(this,this.mousetouchMouseTextContainer,"&nbsp;");for(this.mousetouchTouchContainer=$("<div>").addClass(`${e.MouseTouch.BASE}ActionContainer`).attr("id",`${this.id}TouchContainer`).html("").appendTo(this.mousetouchActionContainer),t=0;t<this.display.touchActions.length;t++)s=this.display.touchActions[t],e.MouseTouch.addAction.call(this,this.mousetouchTouchContainer,"touch",s);this.mousetouchTouchContainer.sortable({start:(o,n)=>{this.oidx=n.item.index()},stop:(o,n)=>{const a=n.item.index(),l=this.display.touchActions.splice(this.oidx,1)[0];this.display.touchActions.splice(a,0,l),delete this.oidx}})}if(!/iPad|iPhone|iPod/.test(navigator.platform)){for(this.mousetouchMouseTextContainer=$("<div>").addClass(`${e.MouseTouch.BASE}TextContainer`).attr("id",`${this.id}MouseTextContainer`).appendTo(this.mousetouchTextContainer),t=0;t<3;t++)e.MouseTouch.addText.call(this,this.mousetouchMouseTextContainer,e.MouseTouch.mouseText[t]);for(t=3;t<this.display.mouseActions.length;t++)e.MouseTouch.addText.call(this,this.mousetouchMouseTextContainer,"&nbsp;");for(this.mousetouchMouseContainer=$("<div>").addClass(`${e.MouseTouch.BASE}ActionContainer`).attr("id",`${this.id}MouseContainer`).html("").appendTo(this.mousetouchActionContainer),t=0;t<this.display.mouseActions.length;t++)s=this.display.mouseActions[t],e.MouseTouch.addAction.call(this,this.mousetouchMouseContainer,"mouse",s);this.mousetouchMouseContainer.sortable({start:(o,n)=>{this.oidx=n.item.index()},stop:(o,n)=>{const a=n.item.index(),l=this.display.mouseActions.splice(this.oidx,1)[0];this.display.mouseActions.splice(a,0,l),delete this.oidx}})}s=sprintf("<p><div class='%s'>Use mouse wheel or pinch to zoom:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='checkbox' value='1' onclick='javascript:JS9.MouseTouch.mousetouchzoom(\"%s\", this);'></div>",`${e.MouseTouch.BASE}Footer`,this.display.id),this.mousetouchFootContainer=$("<span style='float: left'>").addClass(`${e.MouseTouch.BASE}Container`).attr("id",`${this.id}MouseTouchFootContainer`).html(s).appendTo(this.mousetouchContainer),e.globalOpts.mousetouchZoom&&this.mousetouchContainer.find("input").attr("checked",!0)},e.Regions={},e.Regions.CLASS="JS9",e.Regions.NAME="Regions",e.Regions.opts={updateWCS:!0,panzoom:!0,tags:"source,include",strokeWidth:2,iradius:15,oradius:30,nannuli:1,width:60,height:60,radius:30,r1:30,r2:20,ptshape:"box",ptsize:2,linepoints:[{x:-30,y:30},{x:30,y:-30}],polypoints:[{x:-30,y:30},{x:30,y:30},{x:0,y:-30}],fontFamily:"Helvetica",fontSize:14,fontStyle:"normal",fontWeight:300,textAlign:"left",angle:0,aradius1:4,aradius2:8,configURL:"./params/regionsconfig.html",saveURL:"./params/regionssave.html",sortOverlapping:!0,title:"Edit region",noCenteredScaling:["box","line"],tagcolors:{include_source:"#00FF00",exclude_source:"#FF0000",include_background:"#FFD700",exclude_background:"#FF8C00",source:"#00FF00",background:"#FFD700",defcolor:"#00FF00"},onmousedblclick(t,s,o,n){let a=n.params;(a&&!a.winid&&!a.ignore||!a&&"activeSelection"===n.type||!a&&"group"===n.type)&&e.globalOpts.editRegions&&t.displayRegionsForm(n)},onmousedown(t,s,o,n){let a,l=n.params;e.specialKey(o)&&(l&&t._regroupAnnulus(l.layerName,o),"polygon"===n.type||"polyline"===n.type?(t._addPolygonPoint(l.layerName,n,o),t._updateShape(l.layerName,n,null,"update")):n.polyparams&&n.polyparams.polygon?(a=n.polyparams.polygon,t._removePolygonPoint(a.params.layerName,n),t._updateShape(a.params.layerName,a,null,"update")):l&&"annulus"===l.shape&&t._ungroupAnnulus(l.layerName,n))},onmouseup(){let t,s=[];for(this.getActiveObject()&&s.push(this.getActiveObject()),s.push(this.getActiveObjects()),t=0;t<s.length;t++)s[t].polyparams&&this.setActiveObject(s[t].polyparams.polygon)},onchange:null},e.Regions.init=function(t){let s;return t=t||"regions",e.Image.prototype.parseRegions=e.Regions.parseRegions,e.Image.prototype.saveRegions=e.Regions.saveRegions,e.Image.prototype.listRegions=e.Regions.listRegions,e.Image.prototype.copyRegions=e.Regions.copyRegions,e.Image.prototype.changeRegionTags=e.Regions.changeRegionTags,e.Image.prototype.toggleRegionTags=e.Regions.toggleRegionTags,e.Image.prototype.unremoveRegions=e.Regions.unremoveRegions,e.Image.prototype.initRegionsForm=e.Regions.initConfigForm,e.Image.prototype.displayRegionsForm=e.Regions.displayConfigForm,e.Image.prototype.processRegionsForm=e.Regions.processConfigForm,s=this.display.newShapeLayer(t,e.Regions.opts),s.canvas.on("mouse:up",()=>{let o,n,a=[];if(s.display.image)for(n=s.display.image,a.push(s.canvas.getActiveObjects()),o=0;o<a.length;o++)if(a[o].params){n.params.listonchange?n.listRegions("all"===n.params.whichonchange?"all":"selected",{mode:2}):a[o].params.listonchange&&n.listRegions("selected",{mode:2});break}}),this},e.Regions.displayConfigForm=function(t,s){let o,n,a=0,l=e.Regions.opts.title;this&&(s=s||{},t||this.getShapes("regions").length)&&("save"===(s.type=s.type||"config",s.type)?(o=e.allinone?e.allinone.regionsSaveHTML:e.InstallDir(e.Regions.opts.saveURL),l="Save regions",n=e.lightOpts[e.LIGHTWIN].regWin1):(o=e.allinone?e.allinone.regionsConfigHTML:e.InstallDir(e.Regions.opts.configURL),(!t||!t.params&&"activeSelection"===t.type||!t.params&&"group"===t.type)&&(s.multi=!0)),s.multi&&($("form[class='regionsConfigForm']").each((c,d)=>{const h=$(d).data("multi"),p=$(d).data("winid"),g=$(d).data("im");h&&p&&g===this&&(s.winid=p,g.initRegionsForm(null,s),a++)}),l=l.replace(/regions?/,"selected regions"),a)||($(e.lightOpts[e.LIGHTWIN].topid).arrive(".regionsConfigForm",{onceOnly:!0},()=>{s.firsttime=!0,t&&t.params&&this.updateShapes("regions",t,"wcsconfig"),this.initRegionsForm(t,s)}),s.winid=this.displayAnalysis("regions",o,{title:l,winformat:n}),t&&t.params&&(t.params.winid=s.winid)))},e.Regions.initConfigForm=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C,I,L,D,O,M=!1;const E=this.raw.wcsinfo||{cdelt1:1,cdelt2:1},H=B=>{if(void 0!==B)return"number"==typeof B&&B%1!=0&&(B=Math.round(1e4*(B+1e-5))/1e4),String(B)},N=B=>{const P=String.fromCharCode(13,10);return"string"==typeof B?B.replace(/\\n/g,P):B};if(t&&t.pub?d=t.pub.wcsconfig&&t.pub.wcsconfig.wcssys?t.pub.wcsconfig.wcssys:this.params.wcssys:(d=this.params.wcssys,t={type:"multi",pub:{shape:"multi",wcsconfig:{}},params:{}}),u=!1===t.params.changeable,s=s||{},t.params.winid?A=t.params.winid:s.winid&&(A=s.winid),A&&(x=$(A).attr("id"),y=`#${x} .regionsConfigForm `,$(y).length)){if(M=!!$(y).data("multi")||s.multi,$(`${y}.${t.pub.shape}`).each((B,P)=>{$(P).removeClass("nodisplay")}),$(`${y}.val`).each((B,P)=>{switch(a="",n=$(P).attr("name"),n){case"x":case"y":t.pub.lcs&&void 0!==t.pub.lcs[n]?a=H(t.pub.lcs[n]):void 0!==t.pub[n]&&(a=H(t.pub[n]));break;case"radii":t.pub.radii&&(a=!e.notWCS(d)&&t.pub.wcsconfig&&t.pub.wcsconfig.wcsstr?t.pub.wcsconfig.wcsstr.replace(/^annulus\(/,"").replace(/\)$/,"").split(",").slice(2).join(","):t.pub.imstr.replace(/^annulus\(/,"").replace(/\)$/,"").split(",").slice(2).join(","));break;case"pts":t.pub.pts?t.pub.pts.forEach(z=>{a&&(a+=", "),a+=`${z.x.toFixed(2)}, ${z.y.toFixed(2)}`}):t.pub.imstr&&(a=t.pub.imstr.replace(/^.*\(/,"").replace(/\)$/,""));break;case"linelength":if(t.pub.pts&&2===t.pub.pts.length){switch(v=t.pub.pts[0],r=t.pub.pts[1],a=H(Math.sqrt((r.x-v.x)*(r.x-v.x)+(r.y-v.y)*(r.y-v.y))),d){case"image":case"physical":break;default:a*=Math.abs(E.cdelt1),a*=Math.abs(E.cdelt2)}a=H(a),this.tmp.linelength=a}break;case"lineangle":if(t.pub.pts&&2===t.pub.pts.length){for(v=t.pub.pts[0],r=t.pub.pts[1],a=180*Math.atan2(r.y-v.y,r.x-v.x)/Math.PI;a<0;)a+=360;a=H(a),this.tmp.lineangle=a}break;case"fontFamily":t.getFontFamily&&(a=t.getFontFamily());break;case"fontSize":t.getFontSize&&(a=t.getFontSize());break;case"fontStyle":t.getFontStyle&&(a=t.getFontStyle());break;case"fontWeight":t.getFontWeight&&(a=t.getFontWeight());break;case"colorPicker":a=void 0!==t.pub.color?e.colorToHex(t.pub.color):$(y).data("colorpicker")||e.globalOpts.defcolor;break;case"color":M||(void 0!==t.pub.color?a=H(t.pub.color):$(y).data("colorpicker")&&(a=$(y).data("colorpicker")));break;case"strokeWidth":a=t.params.sw1?t.params.sw1:$(y).data("strokewidth")||"";break;case"strokeDashes":t.strokeDashArray?(a=t.strokeDashArray.join(" "),a.match(/NaN/)&&(a="")):a=$(y).data("strokedashes")||"";break;case"regstr":a=!e.notWCS(d)&&t.pub.wcsconfig&&t.pub.wcsconfig.wcsstr?`${t.pub.wcsconfig.wcssys};${t.pub.wcsconfig.wcsstr}`:`${t.pub.imsys};${t.pub.imstr}`;break;case"xpos":switch(d){case"image":t.pub.preservedcoords&&void 0!==t.pub.dx?a=sprintf("d%.1f",t.pub.dx):void 0!==t.pub.x&&(a=sprintf("%.1f",t.pub.x));break;case"physical":t.pub.lcs?a=sprintf("%.1f",t.pub.lcs.x):void 0!==t.pub.x&&(a=sprintf("%.1f",t.pub.x));break;default:t.pub.wcsconfig&&e.notNull(t.pub.wcsconfig.ra)?a=sprintf("%.6f",t.pub.wcsconfig.ra):void 0!==t.pub.x&&(a=sprintf("%.1f",t.pub.x))}$(`${y}[name='${n}']`).prop("readonly",u);break;case"ypos":switch(d){case"image":t.pub.preservedcoords&&void 0!==t.pub.dy?a=sprintf("d%.1f",t.pub.dy):void 0!==t.pub.y&&(a=sprintf("%.1f",t.pub.y));break;case"physical":t.pub.lcs?a=sprintf("%.1f",t.pub.lcs.y):void 0!==t.pub.y&&(a=sprintf("%.1f",t.pub.y));break;default:t.pub.wcsconfig&&e.notNull(t.pub.wcsconfig.dec)?a=sprintf("%.6f",t.pub.wcsconfig.dec):void 0!==t.pub.y&&(a=sprintf("%.1f",t.pub.y))}$(`${y}[name='${n}']`).prop("readonly",u);break;case"radius":case"oradius":case"length":case"width":case"r1":switch(d){case"image":void 0!==t.pub[n]&&(a=H(t.pub[n]));break;case"physical":t.pub.lcs&&void 0!==t.pub.lcs[n]&&(a=H(t.pub.lcs[n]));break;default:t.pub.wcsconfig&&e.notNull(t.pub.wcsconfig.wcssizestr)?a=H(t.pub.wcsconfig.wcssizestr[0]):void 0!==t.pub[n]&&(a=H(t.pub[n]))}$(`${y}[name='${n}']`).prop("readonly",u);break;case"height":case"r2":switch(d){case"image":void 0!==t.pub[n]&&(a=H(t.pub[n]));break;case"physical":t.pub.lcs&&void 0!==t.pub.lcs[n]&&(a=H(t.pub.lcs[n]));break;default:t.pub.wcsconfig&&e.notNull(t.pub.wcsconfig.wcssizestr)?a=H(t.pub.wcsconfig.wcssizestr[1]):void 0!==t.pub[n]&&(a=H(t.pub[n]))}$(`${y}[name='${n}']`).prop("readonly",u);break;case"wcssys":case"savewcs":if(l=$(y).find(`[name='${n}']`),!l.find("option").length)for(o=0;o<e.wcssyss.length;o++)l.append(`<option>${e.wcssyss[o]}</option>`);h="savewcs"===n&&e.globalOpts.regSaveWCS||d,l.find("option").each((z,J)=>{h===J.value&&(a=J.value)});break;case"wcsunits":t.pub.wcsunits&&(a=t.pub.wcsunits);break;case"childtext":t.params.children&&t.params.children.length>0&&(a=N(t.params.children[0].obj.text));break;case"text":void 0!==t.pub[n]&&(a=N(H(t.pub[n])));break;case"id":M?a="selected":void 0!==t.pub.id&&(a=String(t.pub.id),$(P).css("width",`${a.length}ch`));break;case"tags":default:void 0!==t.pub[n]&&(a=H(t.pub[n]));break;case"savefile":a=$(y).data("savefile")||this.tmp.saveregionsFile||"js9.reg",window.electron&&!a.match(/.*\//)&&(a=`${window.electron.currentDir}/${a}`);break;case"selectfilter":a=$(y).data("selectfilter");break;case"selectshape":case"selectcolor":case"selecttag":case"selectwcs":case"selectgroup":e.Regions.regionsConfigSetSelectMenu(this,$(y),n)}$(P).val(a)}),(M||!this.raw.wcs||this.raw.wcs<0)&&$(y).find("[name='wcssys']").hide(),"text"!==t.type&&t.params.children&&$(`${y}.childtext`).removeClass("nodisplay"),s.firsttime){if(window.electron&&$(y).find(".rsavebrowse, .rconfigbrowse").removeClass("nodisplay"),M?($(y).find("label[for='savecur']").text("sel"),$(y).find("input[id='savecur']").data("tooltip","save selected regions"),$(y).find("[id='selectreg']").prop("checked",!0)):$(y).find(".checkboxes").removeClass("nodisplay"),e.favorites.wcs&&e.favorites.wcs.length&&(l=$(y).find(".rwcsbuttons").removeClass("nodisplay"),c=l.find(".rwcsbuttoncontainer"),c.length&&!c.find(".rwcsbutton").length)){for(o=0;o<e.favorites.wcs.length;o++)_=e.favorites.wcs[o],C="string"==typeof _?_.split(":"):_,f=C[0],m=C[1]||f,"save"===s.type?(b=`rsavecol_R${o+2}`,w="rsaveradio"):(b=`rconfigcol_R${o+2}`,w="rconfigradio"),c.append(`<span class='rconfigcol_R rwcsbutton ${b}'>\n                                <input type='radio'\n                                       id='rwcsbutton_${f}'\n                                       name='rwcsbutton'\n                                       class='rwcsradio ${w}}'\n                                       value='${f}'\n                                       data-tooltip='save using ${f} wcs'\n                                       onclick='\n                                           $(this).closest("form")\n                                           .find("[name=savewcs]")\n                                           .val("${f}")\n                                           .trigger("change");'>\n                                <label for='rwcsbutton_${f}'>${m}</label>\n                                </span>`);$(y).find(".rwcsbuttons").find(`[value='${d}']`).prop("checked",!0)}(!e.globalOpts.internalColorPicker||!$.fn.spectrum.inputTypeColorSupport())&&(l=$(y).find("input[name='colorPicker']"),l.spectrum({showButtons:!1,showInput:!1,preferredFormat:"hex6"}),l.on("move.spectrum",(B,P)=>{let z=P.toHexString();$(y).find("input[name='color']").val(z),$(y).data("colorpicker",z)}))}if(void 0===t.params.listonchange&&(t.params.listonchange=!1),t.params.listonchange?$(`${y}[name='listonchange']`).prop("checked",!0):$(`${y}[name='listonchange']`).prop("checked",!1),!1!==t.params.changeable?$(`${y}[name='locked']`).prop("checked",!1):$(`${y}[name='locked']`).prop("checked",!0),t.params.sticky?$(`${y}[name='sticky']`).prop("checked",!0):$(`${y}[name='sticky']`).prop("checked",!1),$(`${y}[id='includejson']`).prop("checked",e.globalOpts.regIncludeJSON),$(`${y}[id='includecomments']`).prop("checked",e.globalOpts.regIncludeComments),$(`${y}[id='savedcoords']`).prop("checked",e.globalOpts.regSaveDCoords),$(`${y}[id='includewcs']`).prop("checked",e.globalOpts.csvIncludeWCS),$(y).find("input[name='saveformat']").prop("checked",!1),$(y).find(`input[value='${e.globalOpts.regSaveFormat}']`).prop("checked",!0),$(y).find("input[name='rwcsbutton']").prop("checked",!1),$(y).find(`input[value='${e.globalOpts.regSaveWCS||d}']`).prop("checked",!0),f="save"===s.type?`save${e.globalOpts.regSaveWhich1}`:`save${e.globalOpts.regSaveWhich2}`,$(`${y}[id='${f}']`).prop("checked",!0),"save"===s.type&&$(y).find("input[name='savefile']").trigger("change"),$(y).find("input[name='strokeMenu']").prop("selectedIndex",0),$(y).find("input[name='dashesMenu']").prop("selectedIndex",0),M)if($(y).find(".regid").hide(),$(y).find(".edit").hide(),$(y).find(".childtext").hide(),$(y).find(".multi").removeClass("nodisplay"),s.setmode<=0)$(y).find("[name='multitext']").val(""),$(y).find('input[name="color"]').val(""),$(y).find('input[name="strokeWidth"]').val(""),$(y).find('input[name="strokeDashes"]').val(""),$(y).data("strokewidth",""),$(y).data("strokedashes",""),s.setmode<0&&($(y).find("[name='selectfilter']").val(""),$(y).data("selectfilter",""));else if(I=this.layers.regions.canvas.getActiveObject(),I&&"group"===I.type&&!I.params)O=I.getObjects(),O&&O.length&&O[0]&&O[0].params&&(L=O[0].params.groupid),L?($(y).find("[name='selectfilter']").val(L),$(y).data("selectfilter",L),f=this.listGroups(L),m=f.substring(f.indexOf("\n")+1),$(y).find("[name='multitext']").val(m)):$(y).find("[name='multitext']").val("");else if(I){for(I=this.layers.regions.canvas.getActiveObjects(),o=0,f=[],m="";o<I.length;o++)D=I[o],"group"!==D.type||D.params?f.push(D):m+=`${this.lookupGroup(D)}\n`;b=this.listRegions(f,{mode:1,includejson:!1,includecomments:!1}).replace(/ *; */g,"\n"),m+=b.substring(b.indexOf("\n")+1),m&&(w="selected",$(y).find("[name='selectfilter']").val(w),$(y).data("selectfilter",w),$(y).find("[name='multitext']").val(m))}else f=$(y).find("[name='selectfilter']").val()||"selected",m=this.listRegions(f,{mode:1,includejson:!1,includecomments:!1}).replace(/ *; */g,"\n"),m&&($(y).find("[name='selectfilter']").val(f),$(y).data("selectfilter",f),$(y).find("[name='multitext']").val(m));else switch($(y).find("input:text[readonly]").css("border-color","#A5A5A5").css("background","#E9E9E9"),$(y).find("input:text:not([readonly])").css("border-color","#E9E9E9").css("background","white"),t.pub.shape){case"box":case"cross":case"ellipse":$(`${y}.angle`).removeClass("nodisplay");break;case"text":$(`${y}.textangle`).removeClass("nodisplay");break;case"line":t.pub.pts&&2===t.pub.pts.length?($(`${y}.linelength`).removeClass("nodisplay"),$(`${y}.lineangle`).removeClass("nodisplay")):($(`${y}.linelength`).addClass("nodisplay"),$(`${y}.lineangle`).addClass("nodisplay"))}$(`${y}.xtrareg`).addClass("nodisplay"),$(`${y}.xtracsv`).addClass("nodisplay"),$(`${y}.xtrasvg`).addClass("nodisplay"),$(`${y}.xtra${e.globalOpts.regSaveFormat}`).removeClass("nodisplay"),$(y).data("im",this),$(y).data("shape",t),$(y).data("winid",A),$(y).data("multi",M),e.BROWSER[3]?(p="touchstart",g="touchend"):(p="mouseover",g="mouseout"),"save"===s.type&&$(y).on(p,()=>{$(y).find("input[name='savefile']").focus()}),$(y).data("tooltipInit")||($(y).data("tooltipInit",!0),$(".rconfigcol_R, .rsavecol_R").on(p,B=>{const P=B.currentTarget,z=$(P).find("input, textarea, span").data("tooltip"),J=$(P).closest(e.lightOpts[e.LIGHTWIN].top).find(e.lightOpts[e.LIGHTWIN].dragBar);z&&J.length&&(S=$(J)[0].childNodes[0].nodeValue.replace(/:.*/,""),$(J)[0].childNodes[0].nodeValue=`${S}: ${z}`)}),$(".rconfigcol_R, .rsavecol_R").on(g,B=>{const z=$(B.currentTarget).closest(e.lightOpts[e.LIGHTWIN].top).find(e.lightOpts[e.LIGHTWIN].dragBar);z.length&&(S=$(z)[0].childNodes[0].nodeValue.replace(/:.*/,""),$(z)[0].childNodes[0].nodeValue=S)}))}},e.Regions.processConfigForm=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y=1;const S={type:"multi",pub:{shape:"multi"},params:{}},_=o.length,C={},I=this.raw.wcsinfo||{cdelt1:1,cdelt2:1},L=R=>{if(void 0!==R)return"number"==typeof R&&R%1!=0&&(R=Math.round(1e4*(R+1e-5))/1e4),String(R)},D=(R,H)=>!!p||void 0!==R&&L(R)!==L(H),O=(R,H,N)=>{if("remove"===H)return"selected"===N;if("childtext"===H)return R.params.children&&R.params.children.length>0?!(!R.params.children[0].obj||!R.params.children[0].obj.params)&&N!==R.params.children[0].obj.params.text:N!==R.params.text;if("strokeWidth"===H)return!R.params||!R.params.sw1||N!==R.params.sw1;if("strokeDashes"===H){if(R.strokeDashArray)return JSON.stringify(R.strokeDashArray)!==JSON.stringify(N);if(!$.isArray(N))return""!==N;switch(N.length){case 0:return!1;case 1:return""!==N[0];default:return""!==N[0]&&""!==N[1]}}if("tags"!==H&&""===N)return!1;if("misc"===H&&""!==N||"radii"===H&&R.params.radii)return!0;if("angle"===H)return R.angle!==-parseFloat(N);if("ix"===H)return R.pub.preservedcoords&&"d"===N.charAt(0).toLowerCase()?D(R.pub.dx,e.saostrtod(N.substring(1))):D(R.pub.x,e.saostrtod(N));if("iy"===H)return R.pub.preservedcoords&&"d"===N.charAt(0).toLowerCase()?D(R.pub.dy,e.saostrtod(N.substring(1))):D(R.pub.y,e.saostrtod(N));if("px"===H&&R.pub.lcs)return D(R.pub.lcs.x.toFixed(1),N);if("py"===H&&R.pub.lcs)return D(R.pub.lcs.y.toFixed(1),N);if("ra"===H)return R.pub.wcsconfig&&R.pub.wcsconfig.wcsposstr?D(e.saostrtod(R.pub.wcsconfig.wcsposstr[0]),e.saostrtod(N)):!!R.pub.wcsposstr&&D(e.saostrtod(R.pub.wcsposstr[0]),e.saostrtod(N));if("dec"===H){if(R.pub.wcsconfig&&R.pub.wcsconfig.wcsposstr)return D(e.saostrtod(R.pub.wcsconfig.wcsposstr[1]),e.saostrtod(N));if(R.pub.wcsposstr)return D(e.saostrtod(R.pub.wcsposstr[1]),e.saostrtod(N))}return"sticky"===H?!p&&D(R.pub.sticky||!1,N):"locked"===H?!p&&(!1!==R.params.changeable?!1===N:!0===N):!("listonchange"===H&&p||(R.pub.lcs&&void 0!==R.pub.lcs[H]?!D(R.pub.lcs[H],N):!(D(R.pub[H],N)||D(R.params[H],N)||D(R[H],N))))},M=R=>"true"===R||"false"!==R&&(e.isNumber(R)?parseFloat(R):R),E=R=>{const H=String.fromCharCode(13,10);return"string"==typeof R?R.replace(/\\n/g,H):R};for(this.lcs&&this.lcs.physical&&(y=Math.sqrt(Math.pow(this.lcs.physical.forward[0][0],2)+Math.pow(this.lcs.physical.forward[0][1],2))),s&&s.pub?v=s.pub.wcsconfig&&s.pub.wcsconfig.wcssys?s.pub.wcsconfig.wcssys:this.params.wcssys:(v=this.params.wcssys,s=S),p=$(t).data("multi"),g=s.pub.layer||"regions",n=0;n<_;n++){if(a=o[n].name,c=o[n].value,"xpos"===a||"ypos"===a)switch(v){case"image":a=`i${a.charAt(0)}`;break;case"physical":a=`p${a.charAt(0)}`;break;default:a=this.validWCS()?"xpos"===a?"ra":"dec":"xpos"===a?"ix":"iy"}switch(a){case"multitext":case"colorPicker":case"savefile":case"rwcsbutton":case"savewcs":case"saveformat":case"includejson":case"includecomments":case"savewhich":case"savedcoords":case"wcssys":break;case"text":"text"===s.type&&O(s,a,c)&&(C[a]=E(c));break;case"selectfilter":if(c&&c!==$(t).data("selectfilter"))return $(t).data("selectfilter",c),void(this.lookupGroup(c)?this.groupShapes(g,c):this.selectShapes(g,c));break;case"strokeDashes":""===c?C.strokeDashArray=[]:(d=c.trim().split(/\s+/),(p&&c||O(s,a,d))&&(C.strokeDashArray=0===d.length?[]:d.map(R=>parseInt(R,10))));break;case"strokeWidth":""===c?C[a]="":e.isNumber(c)&&(d=parseInt(c,10),d<=0?C[a]="":(p&&c||!p&&O(s,a,d))&&(C[a]=M(d)));break;case"color":""===c?C[a]="":O(s,a,c)&&(C[a]=M(c));break;case"tags":p?c&&(C[a]='""'===c||"''"===c?"":M(c)):O(s,a,c)&&(C[a]=M(c));break;case"childtext":"text"!==s.type&&O(s,a,c)&&(C.text=E(c));break;case"ix":O(s,a,c)&&(s.pub.preservedcoords&&"d"===c.charAt(0).toLowerCase()?(C.dx=M(c.substring(1)),void 0===C.dy&&void 0!==s.pub.dy&&(C.dy=s.pub.dy)):(C.x=M(c),void 0===C.y&&void 0!==s.pub.y&&(C.y=s.pub.y)));break;case"iy":O(s,a,c)&&(s.pub.preservedcoords&&"d"===c.charAt(0).toLowerCase()?(C.dy=M(c.substring(1)),void 0===C.dx&&void 0!==s.pub.dx&&(C.dx=s.pub.dx)):(C.y=M(c),void 0===C.x&&void 0!==s.pub.x&&(C.x=s.pub.x)));break;case"px":O(s,a,c)&&(C.px=M(c),void 0===C.py&&s.pub.lcs&&(C.py=s.pub.lcs.y));break;case"py":O(s,a,c)&&(C.py=M(c),void 0===C.px&&s.pub.lcs&&(C.px=s.pub.lcs.x));break;case"ra":O(s,a,c)&&(C.ra=c,void 0===C.dec&&(s.pub.wcsconfig&&s.pub.wcsconfig.wcsposstr?C.dec=s.pub.wcsconfig.wcsposstr[1]:s.pub.wcsposstr&&(C.dec=s.pub.wcsposstr[1])));break;case"dec":O(s,a,c)&&(C.dec=c,void 0===C.ra&&(s.pub.wcsconfig&&s.pub.wcsconfig.wcsposstr?C.ra=s.pub.wcsconfig.wcsposstr[0]:s.pub.wcsposstr&&(C.ra=s.pub.wcsposstr[0])),void 0===C.wcssys&&(C.wcssys=v));break;case"radius":case"length":case"width":case"r1":switch(v){case"image":O(s,a,c)&&(C[a]=M(c));break;case"physical":O(s,a,c)&&(C[a]=M(c)*y);break;default:d=e.strtoscaled(c),c=Math.abs(d.dval/I.cdelt1),l=a.replace("wcs",""),O(s,l,c)&&(C[l]=M(c))}break;case"height":case"r2":switch(v){case"image":O(s,a,c)&&(C[a]=M(c));break;case"physical":O(s,a,c)&&(C[a]=M(c)*y);break;default:d=e.strtoscaled(c),c=Math.abs(d.dval/I.cdelt2),l=a.replace("wcs",""),O(s,l,c)&&(C[l]=M(c))}break;case"radii":O(s,a,c)&&(C[a]=c);break;case"linelength":if(s.pub.pts&&2===s.pub.pts.length&&e.isNumber(c)&&c!==this.tmp.linelength){switch(c=parseFloat(c),v){case"image":case"physical":break;default:void 0!==I.cdelt1?c/=Math.abs(I.cdelt1):void 0!==I.cdelt2&&(c/=Math.abs(I.cdelt2))}C.pts?(u=C.pts[0],f=C.pts[1]):(u=s.pub.pts[0],f=s.pub.pts[1]),$.inArray("line",e.Regions.opts.noCenteredScaling)>=0?(m=Math.sqrt((u.x-f.x)*(u.x-f.x)+(u.y-f.y)*(u.y-f.y)),b=u.x-c*(u.x-f.x)/m,w=u.y-c*(u.y-f.y)/m,C.pts=[u,{x:b,y:w}]):(r={x:(u.x+f.x)/2,y:(u.y+f.y)/2},A=parseFloat(this.tmp.lineangle)||0,u.x=r.x-c/2,u.y=r.y,f.x=r.x+c/2,f.y=r.y,C.pts=[e.rotatePoint(u,A,r),e.rotatePoint(f,A,r)])}break;case"lineangle":s.pub.pts&&2===s.pub.pts.length&&e.isNumber(c)&&c!==this.tmp.lineangle&&(A=parseFloat(c)-parseFloat(this.tmp.lineangle)||0,C.pts?(u=C.pts[0],f=C.pts[1]):(u=s.pub.pts[0],f=s.pub.pts[1]),$.inArray("line",e.Regions.opts.noCenteredScaling)>=0?C.pts=[u,e.rotatePoint(f,A,u)]:(r={x:(u.x+f.x)/2,y:(u.y+f.y)/2},C.pts=[e.rotatePoint(u,A,r),e.rotatePoint(f,A,r)]));break;case"remove":O(s,a,c)&&(p?C[a]="selected":void 0!==s.pub.id&&(C[a]=s.pub.id));break;case"locked":O(s,a,!M(c))&&(C.changeable=!M(c));break;case"misc":if(c.trim())try{h=JSON.parse(c),$.extend(C,h)}catch{e.error(`invalid json: ${c}`)}break;default:O(s,a,c)&&(C[a]=M(c))}}Object.keys(C).length>0&&(p?(x=$(t).find("[name='selectfilter']").val()||"selected",this.changeShapes(g,x,C)):(x=$(t).find("[name='id']").val()||s,this.changeShapes(g,x,C)),this.initRegionsForm(s,{multi:p}))},e.Regions.regionsConfigSetSelectFilter=function(t,s){let o,n,a,l,c,d,h=[],p=[],g=[];const v=t.closest("form"),r=v.find("[name='selectfilter']"),u=v.data("im"),f=m=>{let b;return m?(b=m.trim(),"("===b.charAt(0)&&")"===b.charAt(b.length-1)?b:`(${b})`):""};if(u){if(g=u.listGroups("all",{includeregions:!1}).split("\n"),c=t.val().trim(),a=r.val().trim(),"other"===s&&"saved"===c)return n=u.layers.regions.selection||"",n&&a&&(n=`${f(n)} && ${f(a)}`),r.val(`${n}`),void t.prop("selectedIndex",0);if(a&&(h=a.split(/\s+/)),h.length&&(l=h[h.length-1],!c.match(/[&|]/)&&!l.match(/[&|!]/))){switch(s){case"regions":p=e.regions;break;case"colors":case"tags":break;case"wcssys":p=e.wcssyss;break;case"groups":p=g;break;case"ops":p=["!","&&","||"]}c=$.inArray(l,p)>=0||$.inArray(l,g)>=0||$.inArray(c,g)>=0?`|| ${c}`:`&& ${c}`}if(d=`${a} ${c}`,e.globalOpts.regConfigAddParens){if(h=d.split("||"),h.length>=2)for(o=0;o<h.length;o++)n=h[o].trim(),h[o]=n.indexOf("&&")>0?f(n):n;d=h.join(" || ").replace(/  */g," ")}r.val(d),t.prop("selectedIndex",0)}},e.Regions.regionsConfigSetSelectMenu=function(t,s,o){let n,a,l,c,d,h,p;switch(o.match(/^select/)||(o=`select${o}`),c=s.find(`[name='${o}']`),(v=>{let r;for(r=v.options.length-1;r>=1;r--)v.remove(r)})(c[0]),d=t.getShapes("regions","all"),o){case"selectshape":for(n=0,h=[];n<d.length;n++)l=d[n].shape,$.inArray(l,h)<0&&(c.append(`<option>${l}</option>`),h.push(l));break;case"selectcolor":for(n=0,h=[];n<d.length;n++)l=d[n].color,$.inArray(l,h)<0&&(c.append(`<option>${l}</option>`),h.push(l));break;case"selecttag":for(n=0,h=[];n<d.length;n++)for(l=d[n].tags,a=0;a<l.length;a++)$.inArray(l[a],h)<0&&(c.append(`<option>${l[a]}</option>`),h.push(l[a]));break;case"selectwcs":for(n=0,h=[];n<d.length;n++)d[n].wcsconfig&&(l=d[n].wcsconfig.wcssys,$.inArray(l,h)<0&&(c.append(`<option>${l}</option>`),h.push(l)));break;case"selectgroup":if(l=t.listGroups("all",{includeregions:!1}),l)for(p=l.split("\n"),n=0;n<p.length;n++)c.append(`<option>${p[n]}</option>`)}},e.Regions.regionsConfigSetSelectOrGroup=function(t,s,o,n){let a,l,c,d=s.find('[name="selectfilter"]'),h=s.find('[name="multitext"]'),p=d.val().trim();if(t){switch(c=t.layers.regions.canvas,!1===n&&(t.tmp.updateMulti=!1),p||(d.val(""),h.val(""),s.data("selectfilter",""),c.getActiveObject()&&c.discardActiveObject(),c.renderAll(),o="clear"),o||(o=t.lookupGroup(p)?"group":"select"),o){case"select":s.data("selectfilter",p),t.selectShapes("regions",p,{transparentgroup:!1});break;case"group":s.data("selectfilter",p),l=t.groupShapes("regions",p),d.val(l),h.val(t.listGroups(l)),a=t.lookupGroup(l),a&&(c.setActiveObject(a),c.renderAll(),e.Regions.regionsConfigSetSelectMenu(t,s,"selectgroup"));break;case"ungroup":t.ungroupShapes("regions",p),d.val(""),h.val(""),s.data("selectfilter",""),c.getActiveObject()&&c.discardActiveObject(),e.Regions.regionsConfigSetSelectMenu(t,s,"selectgroup");break;case"clear":s.find('input[name="color"]').val(""),s.find('input[name="strokeWidth"]').val(""),s.find('input[name="strokeDashes"]').val(""),s.data("strokewidth",""),s.data("strokedashes","")}delete t.tmp.updateMulti}},e.Regions.pasteFromClipboard=function(t){let s,o,n,a,l,c,d=[],h=0,p=0;const g=/(annulus|box|circle|cross|ellipse|line|polygon|point|text) *\(/;if(this){if(o=e.CopyFromClipboard().trim(),o||e.error(e.CLIPBOARDERROR),o.match(g)){if(c=e.globalOpts.regToClipboard,e.globalOpts.regToClipboard=!1,d=this.addShapes("regions",o,{rtn:"objs"}),t){for(n=d.length,s=0;s<n;s++)h+=d[s].pub.x,p+=d[s].pub.y;for(h/=n,p/=n,s=0;s<n;s++)a=d[s].pub.x-h+this.ipos.x,l=d[s].pub.y-p+this.ipos.y,this.changeShapes("regions",d[s].pub.id,{x:a,y:l})}e.globalOpts.regToClipboard=c}else e.error(e.CLIPBOARDERROR2);return o}},e.Regions.listRegions=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y="",S="none",_=!1,C=[],I={},L=[];const D="; ",O=[],M={includeObj:!0},E=(R,H)=>{let N,B,P,z,J,q;const G={},ee=R.params,le=ee.children,te=ee.exports;for(N=0;N<te.length;N++)if(P=te[N],!("text"===P&&"text"!==R.type||"textOpts"===P||"strokeDashArray"===P&&R.strokeDashArray&&(B=R.strokeDashArray.join(""),""===B||B.match(/NaN/))||"id"===P&&s.file||"wcsconfig"===P&&s.file||"data"===P&&"object"==typeof ee.data&&!1===ee.data.doexport&&s.file)){if("strokeWidth"===P&&ee.sw1){G[P]=ee.sw1;continue}void 0!==R[P]?G[P]=R[P]:void 0!==ee[P]?G[P]=ee[P]:H&&void 0!==H[P]&&(G[P]=H[P])}return le.length>0&&le[0].obj.text&&(z=le[0].obj,G.text=z.text,G.textOpts=E(z),R.angle!==z.angle?(G.textOpts.angle=-z.angle,("circle"===R.params.shape||"annulus"===R.params.shape)&&(z.params.hasTextOpts=!0)):0!==z.angle&&("circle"===R.params.shape||"annulus"===R.params.shape)&&(G.textOpts.angle=-z.angle,z.params.hasTextOpts=!0),(z.params.parent.moved||z.params.hasTextOpts)&&(z.pub.ra&&z.pub.dec?(w&&A&&w!==A?(B=this.wcs2wcs(w,A,z.pub.ra,z.pub.dec),B=B.trim().split(/\s+/),J=e.saostrtod(B[0]),e.isHMS(A)&&(J*=15),q=e.saostrtod(B[1])):(J=z.pub.ra,q=z.pub.dec),G.textOpts.ra=J,G.textOpts.dec=q):z.pub.lcs?(G.textOpts.px=z.pub.lcs.x,G.textOpts.py=z.pub.lcs.y):(G.textOpts.x=z.pub.x,G.textOpts.y=z.pub.y)),G.textOpts.color===R.stroke&&delete G.textOpts.color,G.textOpts.text&&delete G.textOpts.text,Object.keys(G.textOpts).length||delete G.textOpts),G};if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(R){e.error(`can't parse listRegions opts: ${s}`,R)}if(e.notNull(s.sortids)&&(M.sortids=s.sortids),r=s.mode,e.isNull(r)&&(r=3),x=this.getShapeLayer(o=o||"regions"),x){if((s.wcssys||s.wcsunits)&&(m=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,s.wcssys&&(w=this.getWCSSys(),this.setWCSSys(s.wcssys,!1),A=this.getWCSSys()),s.wcsunits&&(b=this.getWCSUnits(),this.setWCSUnits(s.wcsunits,!1)),this.updateShapes(o,t,"export")),e.isNull(s.includedcoords)&&(s.includedcoords=e.globalOpts.regListDCoords),C=this.getShapes(o,t,M),c=C.length,r)for(n=0;n<c;n++)if(l=C[n],p=l.tags.join(","),p&&"source,include"!==p&&"include,source"!==p){_=!0;break}for(d of Object.keys(e.Regions.opts.tagcolors))O.push(e.Regions.opts.tagcolors[d]);for(n=0;n<c;n++)if(l=C[n],h=l.obj,L=[],(!l.sticky||!1!==s.sticky)&&(!l.preservedcoords||s.includedcoords)&&(!l.ignore||s.ignoreignore)){if($.isArray(h.params.preservedcoords)){for(a=0;a<h.params.preservedcoords.length;a++)"pts"===(d=h.params.preservedcoords[a],d)?($.inArray("dx",L)<0&&L.push("dx"),$.inArray("dy",L)<0&&L.push("dy"),$.inArray("points",L)<0&&L.push("points")):L.push(d);for("none"!==S&&(y+=D),"image"!==S&&(y+="image",y+=D),y+=`${l.shape}({`,a=0,f=0;a<L.length;a++)if(d=L[a],"shape"!==d&&"sticky"!==d&&"wcsconfig"!==d){if("pts"===d&&(d="dx",h.params.preservedcoords.push("dy"),h.params.preservedcoords.push("points")),"preservedcoords"===d)u=!0;else if(e.notNull(l[d]))u=l[d];else if(e.notNull(h[d]))u=h[d];else switch(d){case"dx":u=h.left;break;case"dy":u=h.top;break;case"color":u=h.stroke;break;default:u=null}if(u)switch(f++>0&&(y+=","),y+=`"${d}":`,typeof u){case"string":y+=`"${u}"`;break;case"object":try{y+=JSON.stringify(u)}catch(R){e.error(`can't parse: ${u}`,R)}break;default:y+=`${u}`}}y+="})",S="image";continue}p=l.tags.join(","),v=p.includes("exclude")?"-":"",I=E(h,l),s.saveid?I.id=l.id:delete I.id,s.savewcsconfig&&l.wcsconfig&&Object.keys(l.wcsconfig).length>0?I.wcsconfig=$.extend(!0,{},l.wcsconfig):delete I.wcsconfig,l.color&&!O.includes(l.color)&&(I.color=l.color),_&&(g=` # ${p}`),s.saveediting||delete I.editing,l.wcsstr&&e.isWCSSys(this.params.wcssys)?("wcs"!==S&&("none"!==S&&(y+=D),y+=l.wcssys?l.wcssys:this.params.wcssys,S="wcs"),y+=D+v+l.wcsstr):l.imstr&&(S!==l.imsys&&("none"!==S&&(y+=D),y+=l.imsys,S=l.imsys),y+=D+v+l.imstr),!1!==s.includejson&&r%2==1&&Object.keys(I).length>0&&("line"===l.shape&&(y=y.replace(/ *{[^{}]*}$/,"")),y+=` ${JSON.stringify(I)}`),g&&(y+=g)}return!1===s.includecomments&&(y=y.replace(/ *#[^;]*/g,"")),(w||b)&&(w&&this.setWCSSys(w,!1),b&&this.setWCSUnits(b,!1),this.updateShapes(o,t,"export"),e.globalOpts.xeqPlugins=m),r>1&&this.display.displayMessage("regions",y),y}},e.Regions.copyRegions=function(t,s){return this.copyShapes("regions",t,s)},e.Regions.parseRegions=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m;const b=[],w=/^-?(annulus|box|circle|cross|ellipse|line|polygon|point|text)$/,A=/^(fk4|fk5|icrs|galactic|ecliptic|image|physical|linear)$/,x=/^(image|physical)$/,y=/[dr:]/,S=/\(\s*([^)]+?)\s*\)/,_=/\n|;/,C=/(\{.*\})/,I=/\s*,\s*/,D=/#(?![a-zA-Z0-9]{6}['"])/,O=P=>!("0"===P||"false"===P.toLowerCase()),E=P=>{let z,J,q;const G={opts:{},args:[],isregion:0};if(G.cmd=P.includes("(")?P.split("(")[0].trim().toLowerCase():P.includes("{")?P.split("{")[0].trim().toLowerCase():P.includes("#")?P.split("#")[0].trim().toLowerCase():P.trim().toLowerCase(),G.cmd&&(G.isregion=G.cmd.search(w)>=0),z=P.trim().split(D),J=C.exec(z[0]),J&&J[0])try{G.opts=JSON.parse(J[0].trim())}catch(ee){e.error(`can't parse opts: ${J[0]}`,ee)}return G.comment=z[1],G.comment&&(q=(P=>{let z,J,q,G,ee;const le={},te=/([a-zA-Z][a-zA-Z0-9_]*)\s*=\s*(\d+(\s*\d+)*|[^ '"{]+|['"{][^'"}]*['"}])/g,Q={color:de=>({color:de}),dash(de){if(de)return{strokeDashArray:[3,1]}},dashlist(de){let xe,ce;if(de){for(ce=de.split(" "),xe=0;xe<ce.length;xe++)ce[xe]=parseFloat(ce[xe]);return{strokeDashArray:ce}}},delete:de=>({removable:O(de)}),edit:de=>({selectable:O(de)}),fixed:de=>({zoomable:!O(de)}),font(de){const xe={},ce=de.split(" "),he=ce.length;return he>=1&&(xe.fontFamily=ce[0]),he>=2&&(xe.fontSize=parseFloat(ce[1])),he>=3&&(xe.fontStyle=ce[2]),he>=4&&(xe.fontWeight=ce[3]),xe},highlite:de=>({hasControls:O(de),hasBorders:O(de),hasRotatingPoint:O(de)}),move:de=>({movable:O(de)}),rotate:de=>({rotatable:O(de)}),resize:de=>({resizable:O(de)}),changeable:de=>({changeable:O(de)}),select:de=>({selectable:O(de)}),text:de=>({text:de}),tag:de=>({tags:de}),width:de=>({strokeWidth:parseFloat(de)})};for(s=s||{};null!==(z=te.exec(P));)if(J=z[1].toLowerCase(),G=z[2].replace(/^['"{]|['"}]$/g,""),{}.hasOwnProperty.call(Q,J)&&"function"==typeof Q[J])for(q of(ee=Q[J](G)||{},Object.keys(ee)))"tags"===q&&{}.hasOwnProperty.call(le,q)?le[q]+=`,${ee[q]}`:le[q]=ee[q];else le[J]=G;return(P=P.replace(te,""))&&(le._comment=P.trim()),le})(G.comment.trim()),void 0!==q._comment&&(G.comment=q._comment,delete q._comment)),q&&(G.opts=$.extend({},q,G.opts)),J=S.exec(P),J&&J[0].match(C)?G.args=[]:J&&J[1]&&(G.args=J[1].split(I)),G.isregion&&G.cmd.startsWith("-")&&(G.cmd=G.cmd.slice(1),G.comment?G.comment.match(/exclude/)||(G.comment+=",exclude"):G.comment="exclude"),G},R=(P,z)=>{let J,q,G,ee,le={};return"d"===P.charAt(0).toLowerCase()&&"d"===z.charAt(0).toLowerCase()?(le.dx=parseFloat(P.substring(1)),le.dy=parseFloat(z.substring(1)),le):(G=e.strtoscaled(P),ee=e.strtoscaled(z),(G.dtype.match(y)||ee.dtype.match(y))&&!r&&!p.match(x)&&(u=!0,v=p),r||u?(e.isHMS(v,G.dtype)&&(G.dval*=15),"r"===G.dtype&&(G.dval=180*G.dval/Math.PI),"r"===ee.dtype&&(ee.dval=180*ee.dval/Math.PI),q=e.wcs2pix(this.raw.wcs,G.dval,ee.dval).split(/ +/),le.x=parseFloat(q[0]),le.y=parseFloat(q[1]),le):"physical"===v?(J=this.logicalToImagePos({x:G.dval,y:ee.dval}),le.x=J.x,le.y=J.y,le):(le.x=G.dval,le.y=ee.dval,le))},H=(P,z)=>{let J,q;const G=e.strtoscaled(P),ee=this.raw.wcsinfo||{cdelt1:1,cdelt2:1};return G.dtype.match(y)&&!r&&!p.match(x)&&(u=!0,v=p),r||u?("r"===G.dtype&&(G.dval=180*G.dval/Math.PI),0!==e.REGSIZE&&e.error("region size based on ang sep is not implemented"),J=`cdelt${z}`,G.dval=Math.abs(G.dval/ee[J])):"physical"===v&&this.lcs&&this.lcs.physical&&(q=Math.sqrt(Math.pow(this.lcs.physical.forward[0][0],2)+Math.pow(this.lcs.physical.forward[0][1],2)),G.dval=Math.abs(G.dval*q)),G.dval},N=P=>e.strtoscaled(P).dval;if(!(t=t.trim()).match(/(\(|\{|#|;|\n)/))return t;for(p=this.getWCSSys(),g=this.getWCSUnits(),v="physical",r=e.isWCSSys(v),l=t.split(_),o=0;o<l.length;o++)if("#"!==l[o].trim().substr(0,1))if(u=!1,d=E(l[o]),m=d.args.length,d.isregion){switch(c=$.extend(!0,{},d.opts),c.shape=d.cmd,c.wcsconfig=c.wcsconfig||{wcssys:v},m>=2&&"line"!==c.shape&&"polygon"!==c.shape&&$.extend(c,R(d.args[0],d.args[1])),c.textOpts&&void 0!==c.textOpts.ra&&void 0!==c.textOpts.dec&&(c.textOpts._wcssys=v),d.cmd){case"annulus":if(m>0)for(c.radii=[],n=2;n<m;n++)c.radii.push(H(d.args[n],1));break;case"box":case"cross":m>=3&&(c.width=H(d.args[2],1)),m>=4&&(c.height=H(d.args[3],2)),m>=5&&(c.angle=N(d.args[4]));break;case"circle":m>=3&&(c.radius=H(d.args[2],1));break;case"ellipse":m>=3&&(c.r1=H(d.args[2],1)),m>=4&&(c.r2=H(d.args[3],2)),m>=5&&(c.angle=N(d.args[4]));break;case"line":case"polygon":if(m>0)for(c.pts=[],n=0,a=0;n<m;n+=2,a++)f=R(d.args[n],d.args[n+1]),c.pts[a]=e.notNull(f.dx)&&e.notNull(f.dy)?{dx:f.dx,dy:f.dy}:{x:f.x,y:f.y};break;case"point":default:break;case"text":m>=3&&(c.text=d.args[2].replace(/^['"]/,"").replace(/["']$/,"")),m>=4&&(c.angle=N(d.args[3]))}d.comment&&(c.tags=d.comment),b.push(c)}else d.cmd.match(A)?(h=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(d.cmd,!1),e.globalOpts.xeqPlugins=h,v=this.getWCSSys(),r=e.isWCSSys(v)):("remove"===d.cmd||"delete"===d.cmd)&&b.push({remove:!0});return h=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(p,!1),this.setWCSUnits(g),e.globalOpts.xeqPlugins=h,b},e.Regions.saveRegions=function(t,s,o){let n,a,l,c,d,h,p,g,v,r;if(t&&(v=t.match(/\.([^.]*)$/),v&&v[1]&&v[1].match(/^(reg|svg|csv)$/)&&(h=v[1])),"object"==typeof o)g=o,o=null;else if(o&&"string"==typeof o){try{g=JSON.parse(o)}catch{g=null}g&&(o=null)}switch(g&&(e.notNull(g.layer)&&(o=g.layer),e.notNull(g.type)&&(h=g.type),e.notNull(g.format)&&(h=g.format)),g=g||{},h=h||"reg",this.layers[o=o||"regions"]||e.error(`can't find layer for saveRegions: ${o}`),t||(t="regions"!==o?`js9_${o}.${h}`:`js9.${h}`),h){case"svg":try{e.globalOpts.svgBorder&&(r=this.addShapes(o,"box",{left:this.rgb.img.width/2,top:this.rgb.img.height/2,width:this.rgb.img.width,height:this.rgb.img.height,color:"black",strokeWidth:1,tags:"SVGBorder"})),a=this.layers[o].dlayer.canvas.toSVG(),e.globalOpts.svgBorder&&this.removeShapes(o,r)}catch{e.error(`can't convert layer to SVG: ${o}`)}break;case"csv":try{for(g.mode=1,g.file=t,e.isNull(g.includewcs)&&(g.includewcs=e.globalOpts.csvIncludeWCS),e.isNull(g.savedcoords)&&(g.includedcoords=e.globalOpts.regSaveDCoords),d=this.listRegions(s,g,o),v=d.split(";"),n=0,a="";n<v.length;n++)!v[n]||(v[n].toLowerCase().match(e.WCSEXP)?g.includewcs&&(a+=`${v[n].trim()}\n`):(l=v[n].replace(/\(/,",").replace(/\).*/,"").trim(),a+=`${l}\n`))}catch{e.error(`can't convert layer to region: ${o}`)}break;default:try{c="# Region file format: JS9 version 1.0",g.mode=1,g.file=t,e.isNull(g.includejson)&&(g.includejson=e.globalOpts.regIncludeJSON),e.isNull(g.includecomments)&&(g.includecomments=e.globalOpts.regIncludeComments),g.includedcoords=e.notNull(g.savedcoords)?g.savedcoords:e.globalOpts.regSaveDCoords,d=this.listRegions(s,g,o).replace(/; */g,"\n"),a=!1!==g.includecomments?`# Region file format: JS9 version 1.0\n${d}\n`:`${d}\n`}catch{e.error(`can't convert layer to region: ${o}`)}}return p=new Blob([a],{type:"text/plain;charset=utf-8"}),{}.hasOwnProperty.call(window,"saveAs")?e.saveAs(p,t):e.error("no saveAs() available to save region file"),this.tmp.saveregionsFile=t,t},e.Regions.unremoveRegions=function(){const t=this.regstack.pop();return t?this.addShapes("regions",t):null},e.Regions.changeRegionTags=function(t,s,o){let n,a,l,c,d;for(t=t||"all",s=s||[],o=o||[],$.isArray(s)||(s=s.split(",").map(h=>h.trim())),$.isArray(o)||(o=o.split(",").map(h=>h.trim())),l=this.getShapes("regions",t),n=0;n<l.length;n++){for(c=l[n].tags,d=[],a=0;a<s.length;a++)$.inArray(s[a],c)<0&&d.push(s[a]);for(a=0;a<c.length;a++)$.inArray(c[a],o)<0&&d.push(c[a]);this.changeShapes("regions",l[n].id,{tags:d})}},e.Regions.toggleRegionTags=function(t,s,o){let n,a,l,c,d;for(l=this.getShapes("regions",t=t||"all"),n=0;n<l.length;n++){for(c=l[n].tags,d="",a=0;a<c.length;a++){if(c[a]===s){c[a]=o,d=o;break}if(c[a]===o){c[a]=s,d=s;break}}d&&this.changeShapes("regions",l[n].id,{tags:c})}},e.Plot={},e.Plot.CLASS="JS9",e.Plot.NAME="Plot",e.Plot.opts={annotate:!1,annotateColor:"#FF0000",color:"blue",zoomStack:{enabled:!0},selection:{mode:"xy"},series:{clickable:!0,hoverable:!0,lines:{show:!0},points:{show:!1}},legend:{backgroundColor:null,backgroundOpacity:0},xaxis:{autorange:!0},yaxis:{autorange:!0},title:"Plot Configuration",configURL:"./params/plotconfig.html"},e.Plot.logfunc=function(t){return 0===t?0:Math.log(t)},e.Plot.expfunc=function(t){return 0===t?0:Math.exp(t)},e.Plot.rescale=function(t,s,o,n,a,l,c){let d,h;switch(e.globalOpts.plotLibrary){case"flot":switch(n){case"x":h=s.getAxes().xaxis;break;case"y":h=s.getAxes().yaxis}switch(a){case"linear":h.options.transform=null,h.options.inverseTransform=null,o.curscale[n]=a;break;case"log":h.options.transform=e.Plot.logfunc,h.options.inverseTransform=e.Plot.expfunc,o.curscale[n]=a}e.isNumber(l)?h.options.min=Number.parseFloat(l):""==l&&(h.options.min=null),e.isNumber(c)?h.options.max=Number.parseFloat(c):""==c&&(h.options.max=null),s.setupGrid(),s.draw();break;case"plotly":switch(n){case"x":d={xaxis:{type:a,autorange:!0}},o.curscale[n]=a;break;case"y":d={yaxis:{type:a,autorange:!0}},o.curscale[n]=a}Plotly.restyle(t.attr("id"),d)}},e.Plot.annotate=function(t,s,o){let n,a,l,c,d,h,p;const g=[],v=o.data,r=o.annotations.color||e.Plot.opts.annotateColor,u=(f,m)=>{let b,w,A;if(!f.text)return null;if(w=f.x||0,"%Y"===f.y.toUpperCase()){for(b=1;b<m.length-1;b++)if(m[b][0]>w){A=Math.max(m[b-1][1],m[b][1],m[b+1][1]);break}}else A=f.y;return{x:w,y:A}};switch(e.globalOpts.plotLibrary){case"flot":for(p=-25,t.find(".plotAnnotation").remove(),n=0;n<o.annotations.data.length;n++)a=o.annotations.data[n],d=u(a,v),l=s.pointOffset({x:d.x,y:d.y}),!(l.left<0||l.left>t.width())&&(h=sprintf("<div class='plotAnnotation' style='position: absolute; left: %spx; top:%spx; color: %s; font-size: small'>%s</div>",l.left,l.top+p,r,`&darr;${a.text}`),t.append(h));break;case"plotly":for(p=-30,n=0;n<o.annotations.data.length;n++)a=o.annotations.data[n],d=u(a,v),d&&(c={x:d.x,y:d.y,xref:"x",yref:"y",text:a.text,arrowcolor:r,font:{color:r},showarrow:!0,arrowhead:2,ax:0,ay:p},g.push(c));return g}},e.Plot.initConfigForm=function(t,s){let o,n,a,l,c,d,h;const p=g=>{if(void 0!==g)return"number"==typeof g&&g%1!=0&&(g=Math.round(100*(g+.001))/100),String(g)};!t||!s||(c=t.winid,d=$(c).attr("id"),h=`#${d} #plotConfigForm `,"flot"===e.globalOpts.plotLibrary&&($(`${h}.val`).each((g,v)=>{switch(o="",n=$(v).attr("name"),n){case"xscale":e.notNull(s.curscale.x)&&(o=p(s.curscale.x));break;case"xmin":e.notNull(t.getAxes().xaxis.options.min)&&(o=p(t.getAxes().xaxis.options.min));break;case"xmax":e.notNull(t.getAxes().xaxis.options.max)&&(o=p(t.getAxes().xaxis.options.max));break;case"yscale":e.notNull(s.curscale.y)&&(o=p(s.curscale.y));break;case"ymin":e.notNull(t.getAxes().yaxis.options.min)&&(o=p(t.getAxes().yaxis.options.min));break;case"ymax":e.notNull(t.getAxes().yaxis.options.max)&&(o=p(t.getAxes().yaxis.options.max))}$(v).val(o)}),$(h).data("im",this),$(h).data("plot",t),$(h).data("pobj",s),$(h).data("winid",c),$(h).data("tooltipInit")||($(h).data("tooltipInit",!0),e.BROWSER[3]?(a="touchstart",l="touchend"):(a="mouseover",l="mouseout"),$(".plotcol_P").on(a,g=>{let v;const r=g.currentTarget,u=$(r).find("input").data("tooltip"),f=$(r).closest(e.lightOpts[e.LIGHTWIN].top).find(e.lightOpts[e.LIGHTWIN].dragBar);u&&f.length&&(v=`${e.Plot.opts.title}: ${u}`,$(f)[0].childNodes[0].nodeValue=v)}),$(".plotcol_P").on(l,g=>{const r=$(g.currentTarget).closest(e.lightOpts[e.LIGHTWIN].top).find(e.lightOpts[e.LIGHTWIN].dragBar);r.length&&($(r)[0].childNodes[0].nodeValue=e.Plot.opts.title)}))))},e.Plot.processConfigForm=function(t,s,o,n){let a,l,c;const d=n.length;switch(e.globalOpts.plotLibrary){case"flot":break;case"plotly":return}for(a=0;a<d;a++)switch(l=n[a].name,c=n[a].value,l){case"xscale":""===c&&(c="linear"),e.Plot.rescale(null,s,o,"x",c);break;case"xmin":e.Plot.rescale(null,s,o,"x",null,c,null);break;case"xmax":e.Plot.rescale(null,s,o,"x",null,null,c);break;case"yscale":""===c&&(c="linear"),e.Plot.rescale(null,s,o,"y",c);break;case"ymin":e.Plot.rescale(null,s,o,"y",null,c,null);break;case"ymax":e.Plot.rescale(null,s,o,"y",null,null,c)}e.Plot.initConfigForm.call(this,s,o)},e.plotOpts=e.Plot.opts,e.Catalogs={},e.Catalogs.CLASS="JS9",e.Catalogs.NAME="Catalogs",e.Catalogs.opts={hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,selectable:!1,canvas:{selection:!1},updateWCS:!1,panzoom:!0,shape:"circle",strokeWidth:2,width:10,height:10,radius:5,eradius:{x:5,y:3},angle:0,tagcolors:{defcolor:"#00FF00"},sortOverlapping:!1},e.Crosshair={},e.Crosshair.CLASS="JS9",e.Crosshair.NAME="Crosshair",e.Crosshair.LAYERNAME="crosshair",e.Crosshair.opts={hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,selectable:!1,canvas:{selection:!1},updateWCS:!1,panzoom:!1,arrowSize:14,strokeWidth:1,color:"#00FF00",sortOverlapping:!1,hiddenPts:{pts:[{x:-9999,y:-9999},{x:-9999,y:-9900}]}},e.Crosshair.display=function(t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b;const w=e.Crosshair.LAYERNAME;if(t&&(m=!!/iPad|iPhone|iPod/.test(navigator.platform)||o.shiftKey,(t.tmp.arrowCrosshair||m&&!t.tmp.shiftKey&&t.crosshair&&t.params.crosshair)&&(t.tmp.arrowCrosshair&&!t.params.crosshair?(b=e.Crosshair.opts.arrowSize/t.rgb.sect.zoom,v=s.x-b,p=s.x+b,r=s.y-b,g=s.y+b):(v=0,p=t.raw.width,r=0,g=t.raw.height),u={pts:[{x:v,y:s.y},{x:p,y:s.y}],redraw:!1},t.changeShapes(w,t.crosshair.h,u),f={pts:[{x:s.x,y:r},{x:s.x,y:g}],redraw:!0},t.changeShapes(w,t.crosshair.v,f),t.crosshair.visible=!0,e.globalOpts.wcsCrosshair&&t.validWCS())))for(l=e.pix2wcs(t.raw.wcs,s.x,s.y).trim().split(/\s+/),d=e.saostrtod(l[0]),e.isHMS(t.params.wcssys)&&(d*=15),h=e.saostrtod(l[1]),n=0;n<e.displays.length;n++)if(c=e.displays[n].image,c&&c!==t&&c.crosshair&&c.params.crosshair&&c.validWCS()){p=c.raw.width,g=c.raw.height;try{a=e.wcs2pix(c.raw.wcs,d,h)}catch{a=null}a&&(l=a.trim().split(/\s+/),v=parseFloat(l[0]),r=parseFloat(l[1]),v>0&&v<p&&r>0&&r<g&&(u={pts:[{x:0,y:r},{x:p,y:r}],redraw:!1},c.changeShapes(w,c.crosshair.h,u),f={pts:[{x:v,y:0},{x:v,y:g}],redraw:!0},c.changeShapes(w,c.crosshair.v,f),c.crosshair.visible=!0))}},e.Crosshair.hide=function(t,s,o){const n=e.Crosshair.LAYERNAME,a=e.Crosshair.opts.hiddenPts;!t||(t.crosshair&&t.crosshair.visible||t.tmp.arrowCrosshairVisible)&&(t.changeShapes(n,t.crosshair.h,a),t.changeShapes(n,t.crosshair.v,a),t.crosshair.visible=!1,delete t.tmp.arrowCrosshairVisible)},e.Crosshair.create=function(t){const s=e.Crosshair.opts.hiddenPts,o=e.Crosshair.LAYERNAME;!t||t.crosshair||(t.crosshair={},t.crosshair.h=t.addShapes(o,"line",s),t.crosshair.v=t.addShapes(o,"line",s),t.crosshair.visible=!1)},e.Crosshair.keyaction=function(t,s,o){t&&o&&o.shiftKey&&(t.tmp.shiftKey=!0)},e.Crosshair.keyup=function(t,s,o){t&&t.tmp.shiftKey&&o&&!o.shiftKey&&delete t.tmp.shiftKey},e.Crosshair.init=function(){let t;const s=e.Crosshair.LAYERNAME;for(t=0;t<e.displays.length;t++)e.displays[t].layers.crosshair||e.displays[t].newShapeLayer(s,e.Crosshair.opts);return this},e.Image.prototype.toggleCrosshair=function(){this.params.crosshair=!this.params.crosshair,this.params.crosshair||e.Crosshair.hide(this)},e.Image.prototype.toggleWCSCrosshair=function(){e.globalOpts.wcsCrosshair=!e.globalOpts.wcsCrosshair},e.Grid={},e.Grid.CLASS="JS9",e.Grid.NAME="Grid",e.Grid.LAYERNAME="grid",e.Grid.opts={movable:!1,cover:"display",reduceDims:!0,strokeWidth:1,margin:0,labelMargin:10,stride:32,raLines:8,raSkip:0,raAngle:0,decLines:8,decSkip:0,decAngle:90,sexaPrec:1,degPrec:3,lineColor:"#00FFFF",labelColor:"#00FFFF",labelFontFamily:"Helvetica, sans-serif",labelFontSize:11,labelFontStyle:"normal",labelFontWeight:300,labelRAOffx:3,labelRAOffy:-1,labelDecOffx:-14,labelDecOffy:6},e.Grid.limits=function(t,s,o,n){let a,l,c,d,h;return a=o-s,l=a>1?10:a>.1?100:a>.01?1e3:a>.001?1e4:a>1e-4?1e5:1e6,c=Math.floor(s*l)/l,d=Math.ceil(o*l)/l,h=Math.ceil((d-c)/n*l)/l,{lo:c,hi:d,inc:h}},e.Grid.getLabel=function(t,s,o){let n,a,l,c,d=!1;if("sexagesimal"===t.wcsunits){if("ra"===o&&"galactic"!==t.wcssys&&"ecliptic"!==t.wcssys&&(s/=15),a=e.saodtostr(s,":",t.sexaPrec),c=a.split(":"),t.last[o])for(a="",n=0;n<c.length;n++)a&&(a+=":"),(d||c[n]!==t.last[o][n])&&(a+=c[n],d=!0);t.last[o]=$.extend({},c)}else a=s.toFixed(t.degPrec);return a=a.replace(/0+$/,""),l=a.indexOf("."),l<0?a+=".0":l===a.length-1&&(a+="0"),a=a.replace(/:\.0/,":0.0"),a},e.Grid.display=function(t,s){let o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C,I,L,D,O,M,E,R,H,N,B,P,z,J,q,G,ee={};const le=this.display,te=this.raw,Q=[{ra:0,dec:0},{ra:0,dec:0},{ra:0,dec:0},{ra:0,dec:0}];if(e.isNull(t))switch(this.tmp.gridStatus){case"inactive":case void 0:return!1;default:return!0}if(this.removeShapes(e.Grid.LAYERNAME),!1===t||!this.raw.wcs||this.raw.wcs<=0)this.tmp.gridStatus="inactive";else{if("string"==typeof(s=s||{}))try{s=JSON.parse(s)}catch(de){e.error("can't parse displayCoordGrid JSON",de)}for(this.tmp.gridStatus="processing",G=$.extend(!0,{},e.Grid.opts,s),G.wcsunits=this.getWCSUnits(),G.wcssys=this.getWCSSys(),G.last={},e.wcsunits(this.raw.wcs,"degrees"),"image"===G.cover?(J=[Math.max(1,Math.floor(te.width/le.width)),Math.max(1,Math.floor(te.height/le.height))],q=[{x:0,y:0},{x:te.width-1,y:te.height-1}]):(J=G.reduceDims?te.width<te.height?[te.width/te.height,1]:te.height<te.width?[1,te.height/te.width]:[1,1]:[1,1],q=[],z={x:this.ix+G.margin,y:this.iy-G.margin},P=this.displayToImagePos(z),q[0]={x:P.x,y:P.y},z={x:le.width-1-this.ix-G.margin,y:le.height-1-this.iy-G.margin},P=this.displayToImagePos(z),q[1]={x:P.x,y:P.y}),a=e.pix2wcs(te.wcs,q[0].x,q[0].y).trim().split(/\s+/),Q[0].ra=e.saostrtod(a[0]),Q[0].dec=e.saostrtod(a[1]),a=e.pix2wcs(te.wcs,q[0].x,q[1].y).trim().split(/\s+/),Q[1].ra=e.saostrtod(a[0]),Q[1].dec=e.saostrtod(a[1]),a=e.pix2wcs(te.wcs,q[1].x,q[0].y).trim().split(/\s+/),Q[2].ra=e.saostrtod(a[0]),Q[2].dec=e.saostrtod(a[1]),a=e.pix2wcs(te.wcs,q[1].x,q[1].y).trim().split(/\s+/),Q[3].ra=e.saostrtod(a[0]),Q[3].dec=e.saostrtod(a[1]),f=Q[0].ra,b=Q[0].dec,m=Q[0].ra,w=Q[0].dec,o=1;o<4;o++)f=Math.min(f,Q[o].ra),b=Math.min(b,Q[o].dec),m=Math.max(m,Q[o].ra),w=Math.max(w,Q[o].dec);for(ee=e.Grid.limits.call(this,G,f,m,G.raLines*J[0]),f=ee.lo,m=ee.hi,A=ee.inc,ee=e.Grid.limits.call(this,G,b,w,G.decLines*J[1]),b=ee.lo,w=ee.hi,x=ee.inc,e.wcsunits(this.raw.wcs,G.wcsunits),M=Math.abs(this.raw.wcsinfo.cdelt1),E=M*e.Grid.opts.stride,R=m-E,H=Math.abs(this.raw.wcsinfo.cdelt2),N=H*e.Grid.opts.stride,B=w-N,a="image;",r=f;r<=m;r+=A){for(l="line(",g=H,h=0,n=0,u=b;u<=w;u+=g)p=e.wcs2pix(te.wcs,r,u).trim().split(/ +/),p&&p.length&&(c=parseFloat(p[0]),d=parseFloat(p[1]),c>=-G.margin&&c<=te.width+G.margin&&d>=-G.margin&&d<=te.height+G.margin?(l+=String(`${c+1},${d}1, `),n++,0===h?(h=1,u<B&&(g=N)):1===h&&u>B&&(h=2,g=H)):1===h&&(h=2,u-=g,g=H));n>1&&(a+=l.replace(/,\s+$/,") "),a+=` {"color": "${G.lineColor}"};`)}for(u=b;u<=w;u+=x){for(l="line(",g=M,h=0,n=0,r=f;r<=m;r+=g)p=e.wcs2pix(te.wcs,r,u).trim().split(/ +/),p&&p.length&&(c=parseFloat(p[0]),d=parseFloat(p[1]),c>=-G.margin&&c<=te.width+G.margin&&d>=-G.margin&&d<=te.height+G.margin?(l+=String(`${c+1},${d}1, `),n++,0===h?(h=1,r<R&&(g=E)):1===h&&r>R&&(h=2,g=M)):1===h&&(h=2,r-=g,g=M));n>1&&(a+=l.replace(/,\s+$/,") "),a+=` {"color": "${G.lineColor}"};`)}for(_=G.labelDecOffx/this.rgb.sect.zoom,C=G.labelDecOffy/this.rgb.sect.zoom,L=0,D=f,r=f,v=0;r<=m;r+=A){for(u=b;u<=w;u+=x)p=e.wcs2pix(te.wcs,r,u).trim().split(/ +/),p&&p.length&&(c=parseFloat(p[0]),d=parseFloat(p[1]),z=this.imageToDisplayPos({x:c,y:d}),z.x>this.ix+G.labelMargin&&z.x<this.rgb.img.width+this.ix-G.labelMargin&&z.y>this.iy+G.labelMargin&&z.y<this.rgb.img.height+this.iy-G.labelMargin&&(L>=G.decSkip?(a+=sprintf('text(%s,%s,%s,%s) {"color":"%s", "fontFamily":"%s", "fontSize":%s, "fontStyle":"%s", "fontWeight":"%s", "originX":"left", "originY":"top"};',c+_,d+C,e.Grid.getLabel.call(this,G,u,"dec"),G.decAngle,G.labelColor,G.labelFontFamily,G.labelFontSize,G.labelFontStyle,G.labelFontWeight),v++):(r!==D&&L++,D=r)));if(v)break}for(y=G.labelRAOffx/this.rgb.sect.zoom,S=G.labelRAOffy/this.rgb.sect.zoom,I=0,O=b,u=b,v=0;u<=w;u+=x){for(r=f;r<=m;r+=A)p=e.wcs2pix(te.wcs,r,u).trim().split(/ +/),p&&p.length&&(c=parseFloat(p[0]),d=parseFloat(p[1]),z=this.imageToDisplayPos({x:c,y:d}),z.x>this.ix+G.labelMargin&&z.x<this.rgb.img.width+this.ix-G.labelMargin&&z.y>this.iy+G.labelMargin&&z.y<this.rgb.img.height+this.iy-G.labelMargin&&(I>=G.raSkip?(a+=sprintf('text(%s,%s,%s,%s) {"color":"%s", "fontFamily":"%s", "fontSize":%s, "fontStyle":"%s", "fontWeight":"%s", "originX":"left", "originY":"top"};',c+y,d+S,e.Grid.getLabel.call(this,G,r,"ra"),G.raAngle,G.labelColor,G.labelFontFamily,G.labelFontSize,G.labelFontStyle,G.labelFontWeight),v++):(u!==O&&I++,O=u)));if(v)break}this.addShapes(e.Grid.LAYERNAME,a,G),this.tmp.gridStatus="active"}},e.Grid.toggle=function(t){if(t)switch(t.tmp.gridStatus){case void 0:case null:case"inactive":t.displayCoordGrid(!0);break;case"active":t.displayCoordGrid(!1)}},e.Grid.regrid=function(t){if(t){if("active"!==t.tmp.gridStatus||"complete"!==t.status.load)return;t.displayCoordGrid(!0)}},e.Grid.init=function(t){let s;t=$.extend(!0,{},e.Catalogs.opts,e.Grid.opts,t),s=this.display.newShapeLayer(e.Grid.LAYERNAME,t),s.canvas.on("mouse:up",()=>!1)},e.Image.prototype.displayCoordGrid=e.Grid.display,e.isImage=function(t){return!!("object"==typeof t&&e.notNull(t.id)&&e.notNull(t.raw)&&e.notNull(t.rgb)&&e.notNull(t.params)&&e.notNull(t.display)||"string"==typeof t&&e.lookupImage(t))},e.Dysel={},e.Dysel.CLASS="JS9",e.Dysel.NAME="Dysel",e.Dysel.display=null,e.Dysel.plugins=[],e.Dysel.init=function(t){},e.Dysel.unhighlightSelection=function(){e.bugs.webkit_resize?$(".JS9").find(".JS9Image").removeClass("JS9Highlight"):$(".JS9").removeClass("JS9Highlight")},e.Dysel.highlightSelection=function(t){let s;!t||!e.Dysel.retrievePlugins().length||1!==e.displays.length&&(e.Dysel.unhighlightSelection(),s=t.display,e.bugs.webkit_resize?$(s.divjq).find(".JS9Image").addClass("JS9Highlight"):$(s.divjq).addClass("JS9Highlight"))},e.Dysel.addPlugins=function(t){e.Dysel.plugins.push(t)},e.Dysel.retrievePlugins=function(){return e.Dysel.plugins},e.Dysel.getDisplay=function(t){return e.Dysel.retrievePlugins().length?"previous"===t?e.Dysel.odisplay:e.Dysel.display:null},e.Dysel.getDisplayOr=function(t){return"previous"===t?e.Dysel.getDisplay(t):e.Dysel.getDisplay()||t},e.Dysel.select=function(t){!t||!e.Dysel.retrievePlugins().length||(e.Dysel.odisplay=e.Dysel.display,e.Dysel.display=t,t.image&&(e.Dysel.highlightSelection(t.image),t.image.xeqPlugins("image","ondynamicselect",null)))},e.Dysel.imageload=function(t){t&&e.Dysel.select(t.display)},e.Dysel.imageclose=function(t){let s,o,n;if(t){if(n=e.Dysel.getDisplay(),!n||n.image!==t)return;for(s=0,o=0;s<e.images.length;s++)t.display===e.images[s].display&&o++;if(o<=1)for(s=0;s<e.displays.length;s++)if(n=e.displays[s],t.display!==n&&n.image)return void e.Dysel.select(e.displays[s])}},e.getDynamicDisplayOr=e.Dysel.getDisplayOr,e.Titlebar={},e.Titlebar.CLASS="JS9",e.Titlebar.NAME="Titlebar",e.Titlebar.init=function(t){e.Titlebar.title||(e.Titlebar.title=document.title)},e.Titlebar.imageload=function(t){t&&e.globalOpts.updateTitlebar&&(e.Titlebar.imid=window.electron&&(t.fitsFile||t.file)||t.id,document.title=`${e.Titlebar.title}: ${e.Titlebar.imid}`)},e.Titlebar.imagedisplay=function(t){t&&t.id!==e.Titlebar.imid&&e.globalOpts.updateTitlebar&&(e.Titlebar.imid=window.electron&&(t.fitsFile||t.file)||t.id,document.title=`${e.Titlebar.title}: ${e.Titlebar.imid}`)},e.Titlebar.imageclose=function(){e.globalOpts.updateTitlebar&&(document.title=e.Titlebar.title)},Math.log10=Math.log10||function(t){return Math.log(t)/Math.LN10},"function"!=typeof Object.create&&(Object.create=function(t){const s=function(){};return s.prototype=t,new s}),Math.asinh=Math.asinh||function(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))},Math.sinh=Math.sinh||function(t){return(Math.exp(t)-Math.exp(-t))/2},Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,s){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),n=o.length>>>0;if(0===n)return!1;for(var d,h,a=0|s,l=Math.max(a>=0?a:n-Math.abs(a),0);l<n;){if((d=o[l])===(h=t)||"number"==typeof d&&"number"==typeof h&&isNaN(d)&&isNaN(h))return!0;l++}return!1}}),e.getRawCopy=function(t,s){let o=$.extend(!0,{},t);switch(o.bitpix=s||t.bitpix,o.bitpix){case 8:o.data=new Uint8Array(t.data);break;case 16:o.data=new Int16Array(t.data);break;case-16:o.data=new Uint16Array(t.data);break;case 32:o.data=new Int32Array(t.data);break;case-32:o.data=new Float32Array(t.data);break;case-64:o.data=new Float64Array(t.data);break;default:e.error(`unsupported bitpix: ${o.bitpix}`)}return o},e.getRawLine=function(t,s,o,n){let a,l;switch(t.bitpix){case 8:a=new Uint8Array(t.data.buffer,s,t.width),l=new Uint8Array(o.data.buffer,n,t.width);break;case 16:case-16:a=new Uint16Array(t.data.buffer,s,t.width),l=new Uint16Array(o.data.buffer,n,t.width);break;case 32:a=new Uint32Array(t.data.buffer,s,t.width),l=new Uint32Array(o.data.buffer,n,t.width);break;case-32:a=new Float32Array(t.data.buffer,s,t.width),l=new Float32Array(o.data.buffer,n,t.width);break;case-64:a=new Float64Array(t.data.buffer,s,t.width),l=new Float64Array(o.data.buffer,n,t.width);break;default:e.error(`unsupported bitpix: ${t.bitpix}`)}return[a,l]},e.memcpy=function(t,s,o,n,a){var l=new Uint8Array(t,s,a),c=new Uint8Array(o,n,a);l.set(c)},e.jupyterFocus=function(t,s){let o;({}).hasOwnProperty.call(window,"Jupyter")&&(o=t instanceof jQuery?t:$(t),o.find(s=s||"input, textarea").each((n,a)=>{Jupyter.keyboard_manager.register_events($(a))}))},e.getImageID=function(t,s,o){let n,a,l,c=0,d=1;const h=e.images.length,p=/.*<([0-9][0-9]*)>$/,g=/<[0-9][0-9]*>/;for(t=e.cleanPath(t.replace(g,""),"id"),n=0;n<h;n++)a=e.images[n],a.display.id===s&&a!==o&&t===a.id0.replace(g,"")&&(a.id&&a.id.search(p)>=0&&(l=a.id.replace(p,"$1"),d=Math.max(d,parseInt(l,10))),c++);return c?`${t}<${String(d+1)}>`:t},e.uniqueID=function(){let t=1;return function(){return t++}}(),e.waiting=function(t,s){let o,n,a;switch(t){case!0:!{}.hasOwnProperty.call(window,"Spinner")||"spinner"!==e.globalOpts.waitType?$("body").addClass("waiting"):(s&&("object"==typeof s?o=s.divjq[0]:"string"==typeof s&&(a=e.lookupDisplay(s),a&&(o=a.divjq[0]))),o||(o=$("body").get(0)),e.spinner||(e.spinner={},n={color:e.globalOpts.spinColor,opacity:e.globalOpts.spinOpacity},e.spinner.spinner=new Spinner(n)),e.spinner.spinner.spin(o));break;case!1:!{}.hasOwnProperty.call(window,"Spinner")||"spinner"!==e.globalOpts.waitType?$("body").removeClass("waiting"):e.spinner&&e.spinner.spinner.stop()}},e.progress=function(t,s){if("boolean"==typeof t||"string"==typeof t)switch(t){case!0:case"indeterminate":s&&(e.progress.display=s,e.progress.display.displayMessage("progress",t));break;case!1:case"":e.progress.display&&(e.progress.display.clearMessage("progress"),delete e.progress.display)}else"number"==typeof t&&e.progress.display&&e.progress.display.displayMessage("progress",[t,s])},e.msgHandler=function(t,s){let o,n,a,l,c,d,h=[];const p=t.cmd,g=t.id,v=e.globalOpts.alerts,r=e.globalOpts.quietReturn?"":"OK";if(s&&(e.globalOpts.alerts=!1),e.publics[p]){for($.isArray(t.args)||(t.args=[t.args]),o=0;o<t.args.length;o++)("''"===t.args[o]||'""'===t.args[o])&&(t.args[o]="");"RunAnalysis"===(h=$.extend(!0,[],t.args),d=((f,m)=>{if(f){if(m.length>0){if(n=m[m.length-1],"string"==typeof n)try{a=JSON.parse(n)}catch{a=null}else"object"==typeof n&&(a=n);return a&&"object"==typeof a&&{}.hasOwnProperty.call(a,"display")&&1===Object.keys(a).length?(m.pop(),a):{display:f}}return{display:f}}return null})(g,h),p)&&s&&(1===h.length&&h.push(null),h.push(s)),d&&h.push(d);try{c=e.publics[p](...h)}catch(f){c=`ERROR: ${f.message}`}if(s){switch(e.globalOpts.alerts=v,(c instanceof e.Display||c instanceof e.Image)&&(c=c.id),p){case"NewShapeLayer":c&&c.layerName&&(c=c.layerName);break;case"RunAnalysis":c.match(/^ERROR:/)||(s=null)}s&&s(c)}return c}if(!p||"#"===p)return s&&s(""),void(s&&(e.globalOpts.alerts=v));if(a=e.lookupCommand(p),l=e.lookupDisplay(g,!1),a&&l)switch(a.getDisplayInfo(l),t.args?h=$.extend(!0,[],t.args):t.paramlist&&(h=t.paramlist.split(/ +/)),a.getWhich(h)){case"get":try{c=a.get(h)||""}catch(f){c=`ERROR: ${f.message}`}break;case"set":try{c=a.set(h)||r}catch(f){c=`ERROR: ${f.message}`}break;default:c=`ERROR: unknown cmd type for '${p}'`}else a||(c=`ERROR: unknown cmd '${p}'`),l||(c=`ERROR: unknown display (${g})`);return s&&(e.globalOpts.alerts=v,(c instanceof e.Display||c instanceof e.Image)&&(c=c.id),s(c)),c},e.lightWin=function(t,s,o,n,a){let l;return"dhtml"===(a=a||"",e.LIGHTWIN)&&(a.match(/(left|top|center)=/)||(a&&(a+=","),a+=`${e.globalOpts.lightWinPos}`),l=dhtmlwindow.open(t,s,o,n,a),/iPad|iPhone|iPod/.test(navigator.platform)&&$(`#${t} ${e.lightOpts[e.LIGHTWIN].drag}`).css("-webkit-overflow-scrolling","touch").css("overflow-y","scroll"),$(`#${t} ${e.lightOpts[e.LIGHTWIN].dragBar}`).on("dblclick",()=>{l.close()}).on("touchend",c=>{const d=(new Date).getTime(),h=$(c.currentTarget).data("lasttime");h&&d-h>e.DBLCLICK0&&d-h<e.DBLCLICK&&l.close(),$(c.currentTarget).data("lasttime",d)}),$(`#${t} ${e.lightOpts[e.LIGHTWIN].dragBar}`).on("touchend",()=>{dhtmlwindow.distancex||dhtmlwindow.distancey?e.lightOpts.nclick>0&&(e.lightOpts.nclick=0):e.lightOpts.nclick>=2?(alert("trouble closing this window? double-tap the window handle"),e.lightOpts.nclick=-1):e.lightOpts.nclick>=0&&e.lightOpts.nclick++})),l},e.checkNew=function(t){t||e.error("internal failure in a JS9 constructor")},e.specialKey=function(t){return t.metaKey||t.ctrlKey},e.strace=function(t){let s="";return e.DEBUG>1&&(s=t.stack||t.stacktrace||""),s},e.floatToString=function(t){return"number"==typeof t?sprintf("%g",parseFloat(t.toFixed(e.globalOpts.floatPrecision))):"string"==typeof t?t:String(t)},e.floatPrecision=function(t,s){let o,n=Math.floor(Math.log10(Math.abs(t))),a=Math.floor(Math.log10(Math.abs(s)));return o=Math.max(n,a),o},e.floatFormattedString=function(t,s,o){let n,a="";return void 0===t||(s<-2?(n=`%.${String(2+o)}e`,a=sprintf(n,t)):s<0?a=t.toFixed(Math.abs(s)+3+o):s<2?(n=`%.${String(s+o)}f`,a=sprintf(n,t)):s<5?a=t.toFixed(0+o):(n=`%.${String(2+o)}e`,a=sprintf(n,t))),a},e.centerPolygon=function(t){let s,o,n,a,l,c;if(t&&t.length){for(o=t.length,s=0;s<o;s++)(void 0===n||t[s].x<n)&&(n=t[s].x),(void 0===a||t[s].x>a)&&(a=t[s].x),(void 0===l||t[s].y<l)&&(l=t[s].y),(void 0===c||t[s].y>c)&&(c=t[s].y);return{x:(n+a)/2,y:(l+c)/2}}},e.centroidPolygon=function(t,s){let o,n,a,l,c,d,h=0,p=0,g=0,v=0,r=0;const u=[];if(t&&t.length){if(n=t.length,s){for(o=0;o<n;o++)v+=t[o].x,r+=t[o].y;return{x:v/n,y:r/n}}for(o=0;o<n;o++)u[o]={},u[o].x=t[o].x,u[o].y=t[o].y;for(u[n]={},u[n].x=u[0].x,u[n].y=u[0].y,o=0;o<n;o++)a=u[o].x*u[o+1].y-u[o+1].x*u[o].y,h+=a,p+=(u[o].x+u[o+1].x)*a,g+=(u[o].y+u[o+1].y)*a;return l=h/2,c=p/(6*l),d=g/(6*l),{x:c,y:d}}},e.lookupImage=function(t,s){let o,n,a,l;const c=e.images.length;if(!t)return null;for(window.electron&&(l=`${window.electron.currentDir}/${t}`),o=0;o<c;o++)if(n=e.images[o],(t===n||t===n.id||t===n.file||t===n.file.replace(/\[.*\]$/,"")||l===n.file||l===n.file.replace(/\[.*\]$/,"")||t===n.file0||t===e.TOROOT+n.file||n.fitsFile&&t===n.fitsFile)&&$(`#${n.display.id}`).length>0&&(a=n.display.id,!s||"string"==typeof s&&s===a||"object"==typeof s&&s.id===a))return n;return null},e.lookupDisplay=function(t,s){let o;const n=new RegExp(`[-_]?(${e.PLUGINS})$`);if(void 0===s&&(s=!0),t&&t.toString().search(e.SUPERMENU)<0){for(o=0;o<e.displays.length;o++)if(t===e.displays[o]||t===e.displays[o].id||t===e.displays[o].oid)return e.displays[o];if("string"==typeof t)for(t=t.replace(n,""),o=0;o<e.displays.length;o++)if(t===e.displays[o]||t===e.displays[o].id||t===e.displays[o].oid)return e.displays[o];if(!s)return null;e.error(`can't find JS9 display with id: ${t}`)}return e.displays[0]},e.getImage=function(t){let s=null,o=null;return s=e.lookupImage(t),s||(o=e.lookupDisplay(t,!1),o&&(s=o.image)),s},e.lookupVfile=function(t){let s,o,n,a;const l=[];if(!t)return l;for(s=0;s<e.images.length;s++)for(n=e.images[s],o=0;o<n.raws.length;o++)a=n.raws[o],a.hdu&&a.hdu.fits&&t===a.hdu.fits.vfile&&l.push({im:n,raw:a,idx:o});return l},e.loadScript=function(t,s,o){const n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",s&&(a.onload=s),o&&(a.onerror=o),a.src=t,n.appendChild(a)},e.fetchURL=function(t,s,o,n){let a;const l=new XMLHttpRequest;o=o||{},!t&&!s&&e.error("invalid url specification for fetchURL"),s||(t=/([^\\/]+)$/.exec(s=t)[1]),t||(t=/([^\\/]+)$/.exec(s)[1]),o.proxy&&e.globalOpts.cgiProxy&&s.match(/\.(fits|ftz|fz|fits\.gz|fits\.bz2)(\?.*)?$/)&&(s=`${e.globalOpts.cgiProxy}?fits=${s}`),a=o.allowCache||s.match(/\?/)?s:`${s}?r=${Math.random()}`,a=a.replace(/^\${JS9_DIR}\//,e.INSTALLDIR),l.open("GET",a,!0),l.responseType=o.responseType?o.responseType:"blob",e.globalOpts.xtimeout&&(l.timeout=e.globalOpts.xtimeout),l.onload=()=>{let c;4===l.readyState&&(200===l.status||0===l.status?(delete e.fetchURL.status,"blob"===l.responseType?(c=new Blob([l.response]),c.name=t.match("://")?t.split("/").reverse()[0].replace(/\?.*$/,""):t,"uc"===c.name&&(c.name=`google_${e.uniqueID()}.fits`),n?n(c,o):e.Load(c,o)):o.display?n(l.response,o,{display:o.display}):n(l.response,o)):e.error(404===l.status?`could not find ${s}`:`can't load: ${s} ${l.statusText} ${l.status}`))},l.onerror=()=>{e.error(`cannot load: ${s} ... please check the url/pathname`)},l.ontimeout=()=>{e.error(`timeout awaiting response from server: ${s}`)},e.fetchURL.status="processing";try{l.send()}catch(c){e.error(`request to load ${s} failed`,c)}},e.saveAs=function(t,s){let o,n,a;if(window.electron)o=s.match(/.*\//),o&&o[0]&&(n=o[0],e.SaveDir(n,{onceOnly:!0})),a=s.split("/").reverse()[0],window.setTimeout(()=>{try{saveAs(t,a)}catch(l){e.error("could not saveAs",l)}},e.TIMEOUT);else try{saveAs(t,s)}catch(l){e.error("could not saveAs",l)}},e.fitsLibrary=function(t){let s;if(!t)return e.fits.name;switch(s=t.toLowerCase(),s){case"astroem":case"cfitsio":e.fits=Astroem,e.fits.options=e.fits.options||{},e.fits.options.handler=e.NewFitsImage,e.fits.options.error=e.error,e.userOpts.fits?(e.fits.options.extlist=e.userOpts.fits.extlist,e.fits.options.table={xdim:e.userOpts.fits.xdim,ydim:e.userOpts.fits.ydim,bin:e.userOpts.fits.bin||1},e.fits.options.image={xdim:e.userOpts.fits.ixdim||e.userOpts.fits.xmax,ydim:e.userOpts.fits.iydim||e.userOpts.fits.ymax,bin:e.userOpts.fits.ibin||1}):(e.fits.options.extlist=e.globalOpts.extlist,e.fits.options.table={bin:e.globalOpts.table.bin||1},e.notNull(e.globalOpts.table.xdim)?e.fits.options.table.xdim=e.globalOpts.table.xdim:e.notNull(e.globalOpts.dims)&&(e.fits.options.table.xdim=e.globalOpts.dims[0]),e.notNull(e.globalOpts.table.ydim)?e.fits.options.table.ydim=e.globalOpts.table.ydim:e.notNull(e.globalOpts.dims)&&(e.fits.options.table.ydim=e.globalOpts.dims[1]),e.fits.options.image={bin:e.globalOpts.image.bin||1},e.notNull(e.globalOpts.image.xdim)?e.fits.options.image.xdim=e.globalOpts.image.xdim:e.notNull(e.globalOpts.xmax)&&(e.fits.options.image.xdim=e.globalOpts.xmax),e.notNull(e.globalOpts.image.ydim)?e.fits.options.image.ydim=e.globalOpts.image.ydim:e.notNull(e.globalOpts.ymax)&&(e.fits.options.image.ydim=e.globalOpts.ymax)),e.fits.maxFITSMemory&&e.globalOpts.maxMemory&&e.fits.maxFITSMemory(e.globalOpts.maxMemory);break;default:e.error(`unknown fits library: ${t}`)}return e.fits.ready=!0,e.fits.name=s,e.fits.options.error=e.error,e.fits.options.waiting=e.waiting,s},e.handleFITSFile=function(t,s,o){e.fits.handleFITSFile?e.fits.handleFITSFile(t,s,o):e.error("no FITS module available to process FITS file")},e.cleanupFITSFile=function(t,s){let o;return e.hostFS&&(o=new RegExp(`^${e.hostFS}`)),!!(e.fits.cleanupFITSFile&&t&&t.hdu&&t.hdu.fits)&&(o&&t.hdu.fits.vfile&&t.hdu.fits.vfile.match(o)&&(s=!1),e.fits.cleanupFITSFile(t.hdu.fits,s),!0)},e.handleImageFile=function(t,s,o){const n=new FileReader;s=$.extend(!0,{},e.fits.options,s),o=o||e.Load,n.onload=a=>{let l,c,d;const h=new Image;h.onload=()=>{let p,g,v,r,u=0;const f=document.createElement("canvas"),m=f.getContext("2d"),b=h.height,w=h.width;for(f.width=w,f.height=b,m.drawImage(h,0,0),l=m.getImageData(0,0,w,b).data,c=new Float32Array(b*w),g=0;g<b;g++)for(p=0;p<w;p++)v=.299*l[u]+.587*l[u+1]+.114*l[u+2],c[(b-g)*w+p]=v,u+=4;for(r={SIMPLE:!0,BITPIX:-32,NAXIS:2,NAXIS1:w,NAXIS2:b},d={filename:t.name,naxis:2,axis:[0,w,b],bitpix:-32,bin:1,head:r,data:c,offscreen:h},d.dmin=Number.MAX_VALUE,d.dmax=Number.MIN_VALUE,u=0;u<b*w;u++)!Number.isNaN(d.data[u])&&Number.isFinite(d.data[u])&&(d.dmin=Math.min(d.dmin,d.data[u]),d.dmax=Math.max(d.dmax,d.data[u]));s.source="img",o(d,s)},h.src=a.target.result},n.readAsDataURL(t)},e.getFITSImage=function(t,s,o,n){e.fits.getFITSImage?e.fits.getFITSImage(t,s,o,n):e.error("no FITS module available to process FITS image")},e.fits2fits=function(t,s,o,n){let a,l,c,d,h,p,g,v;const r={};if(v=e.notNull((o=o||{}).fits2fits)?o.fits2fits:e.globalOpts.fits2fits,!0===v?v="always":!1===v&&(v="never"),v.match(/never/i))return!1;if(!e.helper.connected||"nodejs"!==e.helper.type&&"socket.io"!==e.helper.type)return"always"===v&&e.globalOpts.requireFits2Fits&&e.error("can't run fits2fits without connected JS9 helper"),!1;if(!e.helper.js9helper){if(!e.globalOpts.requireFits2Fits)return!1;e.error("js9helper not found for fits2fits processing")}if(!e.globalOpts.workDir)return e.globalOpts.requireFits2Fits&&e.error("can't run fits2fits without a workdir"),!1;for(c=o.xdim||e.fits.options.image.xdim||e.fits.options.table.xdim,d=o.ydim||e.fits.options.image.ydim||e.fits.options.table.ydim,h=o.bin||e.fits.options.image.bin||e.fits.options.table.bin,p=o.binMode||e.globalOpts.binMode,p="a"===p?"a":"","string"==typeof h&&(h.match(/[as]$/)&&(p=h.slice(-1)),h=parseInt(h,10)),h=Math.max(1,h||1),r.sect=e.notNull(o.xcen)&&e.notNull(o.ycen)?`${c}@${o.xcen},${d}@${o.ycen},${h}${p}`:`${c},${d},${h}${p}`,l=v.toLowerCase().split(/[>,]/),a=0;a<l.length;a++)"size"===l[a]&&l[a+1]&&(e.isNumber(l[a+1])&&(r.maxsize=1e6*parseFloat(l[a+1])),a++);return r.fits=e.cleanPath(s),r.parent=!0,e.waiting(!0,t),e.helper.send("fits2fits",r,u=>{let f,m,b,w,A;if(f="object"==typeof u?u:u.search(e.analOpts.epattern)>=0?{stderr:u}:{stdout:u},f.stderr&&e.error(f.stderr,e.analOpts.epattern),f.stdout){if(f.stdout.match(/^ERROR:/)&&(e.globalOpts.requireFits2Fits?e.error(f.stdout):f.stdout=r.fits),m=f.stdout.split(/\n/),b=e.cleanPath(m[0]),b===r.fits)A=$.extend(!0,{},o);else{if("/"!==b.charAt(0)&&(b=e.InstallDir(b)),A=$.extend(!0,{},o),delete A.xcen,delete A.ycen,delete A.bin,void 0!==A.xdim&&(A.xdim=0),void 0!==A.ydim&&(A.ydim=0),A.source="fits2fits",A.proxyFile=b,m[1]){try{g=JSON.parse(m[1])}catch{}g&&(A.extname=g.extname,A.extnum=g.extnum,A.hdus=g.hdus,A.parent=g)}m[2]&&(w=e.cleanPath(m[2]),A.parentFile=w,A.extname?(A.parentFile=A.parentFile.replace(/\[.*\]/,""),A.parentFile+=`[${A.extname}]`):A.extnum&&A.extnum>0&&(A.parentFile=A.parentFile.replace(/\[.*\]/,""),A.parentFile.file+=`[${A.extnum}]`)),n&&(A.onload=n)}A.fits2fits=!1,e.Load(b,A,{display:t})}}),!0},e.lookupColormap=function(t,s){let o;if(void 0===s&&(s=!0),t||(t=e.imageOpts.colormap),t)for(o=0;o<e.colormaps.length;o++)if(e.colormaps[o].name===t)return e.colormaps[o];if(!s)return null;e.error(`unknown colormap '${t}'`)},e.lookupCommand=function(t){let s,o,n;if(t)for(n=t.toLowerCase(),o=0;o<e.commands.length;o++)if(s=e.commands[o],s.name===n||s.alias===n||s.alias2===n)return s;return null},e.error=function(...t){let a,l,c,d,h,p,[s,o,n]=t,g="",v="",r=!0;for(e.waiting(!1),"processing"===e.fetchURL.status&&(e.fetchURL.status="error"),c=0;c<e.images.length;c++)h=e.images[c],p=h.status.cur,p&&h.status[p]&&h.setStatus(p,"error");if("string"==typeof o?(l=s.match(o),l?l[1]?s=l[1]:l[0]&&(s=l[0]):r=!1):"object"==typeof o&&(a=o),t.length<3&&(n=!0),r&&(a&&a.message?s+=` (${a.message})`:s&&(a=new Error(s)),d=e.strace(a),d&&(v=`\n\nStacktrace:\n${d}`),e.globalOpts.alerts&&(s&&"string"==typeof s&&s.search(/ERROR/)<0&&(g="JS9 ERROR: "),g+=s+v,alert(g)),n))throw a},e.log=function(...t){void 0!==window.console&&void 0!==window.console.log&&console.log(...t)},e.eventToCharStr=function(t){let s,o;const n={37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",8:"delete"},a={188:"44",109:"45",190:"46",191:"47",192:"96",220:"92",222:"39",221:"93",219:"91",173:"45",187:"61",186:"59",189:"45"},l={96:"~",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",48:")",45:"_",61:"+",91:"{",93:"}",92:"|",59:":",39:'"',44:"<",46:">",47:"?"};return s="number"==typeof t?t:t.which||t.keyCode,o=String(s),{}.hasOwnProperty.call(a,o)&&(s=a[o]),s=!t.shiftKey&&s>=65&&s<=90?String.fromCharCode(s+32):!t.shiftKey&&{}.hasOwnProperty.call(n,s)?n[s]:t.shiftKey&&{}.hasOwnProperty.call(l,s)?l[s]:String.fromCharCode(s),e.specialKey(t)&&(s=`M-${s}`),s},e.eventToDisplayPos=function(t,s){let o,n,a,l,c,d,h,p;if(t||(t=window.event),t.target?n=t.target:t.srcElement&&(n=t.srcElement),3===n.nodeType&&(n=n.parentNode),s=s||$(n).offset(),t.originalEvent?t.originalEvent.touches&&t.originalEvent.touches.length?(h=t.originalEvent.touches,a=h[0].pageX,l=h[0].pageY):t.originalEvent.changedTouches&&t.originalEvent.changedTouches.length?(h=t.originalEvent.changedTouches,a=h[0].pageX,l=h[0].pageY):(a=t.pageX,l=t.pageY):(a=t.pageX,l=t.pageY),c=s.left+1,d=s.top+1,p={x:Math.floor(a-c),y:Math.floor(l-d)},h&&h.length)for(p.touches=[{x:p.x,y:p.y}],o=1;o<h.length;o++)p.touches[o]={x:Math.floor(h[o].pageX-c),y:Math.floor(h[o].pageY-d)};return p},e.pix2pix=function(t,s,o){let n,a,l,c,d,h,p;return!t||!s||t.raw.wcs<=0||s.raw.wcs<=0?o:(c=o.x,d=o.y,n=e.pix2wcs(t.raw.wcs,c,d).trim().split(/\s+/),a=e.saostrtod(n[0]),e.isHMS(t.params.wcssys)&&(a*=15),l=e.saostrtod(n[1]),n=e.wcs2pix(s.raw.wcs,a,l).trim().split(/\s+/),h=parseFloat(n[0]),p=parseFloat(n[1]),Math.abs(h-c)<.5&&(h=c),Math.abs(p-d)<.5&&(p=d),{x:h,y:p})},e.angdist=function(t,s,o,n){let a,l,c;const d=(v,r)=>{let u=[],f=Math.cos(r);return u[0]=Math.cos(v)*f,u[1]=Math.sin(v)*f,u[2]=Math.sin(r),u},p=v=>v*Math.PI/180;return a=d(p(t),p(s)),l=d(p(o),p(n)),c=((v,r)=>{let u,f,m,b,w,A,x,y,S;return u=v[0],f=v[1],m=v[2],b=Math.sqrt(u*u+f*f+m*m),0!=b&&(u/=b,f/=b,m/=b),w=r[0],A=r[1],x=r[2],y=A*u-w*f,S=x*(u*u+f*f)-m*(w*u+A*f),0!=y||0!=S?Math.atan2(y,S):0})(a,l),c=-c,180*c/Math.PI},e.rotatePoint=function(t,s,o){let n,a;return o=o||{x:0,y:0},s=Math.PI*s/180,n=Math.cos(s),a=Math.sin(s),{x:n*(t.x-o.x)-a*(t.y-o.y)+o.x,y:a*(t.x-o.x)+n*(t.y-o.y)+o.y}},e.matrixMultiply=function(t,s){let o,n,a,l;const c=t.length,d=t[0].length,p=s[0].length;for(l=new Array(c),o=0;o<c;++o)for(l[o]=new Array(p),n=0;n<p;++n)for(l[o][n]=0,a=0;a<d;++a)l[o][n]+=t[o][a]*s[a][n];return l},e.invertMatrix3=function(t){let s,o,n,a=0,l=0,c=t[0][0]*t[1][1];const h=[[0,0,0],[0,0,0],[0,0,0]],p=()=>{c>=0?a+=c:l+=c};for(s=0;s<3;s++)for(o=0;o<2;o++)if(void 0===t[s][o]||Number.isNaN(t[s][o]))return null;return p(),c=-t[0][1]*t[1][0],p(),n=a+l,0===n||Math.abs(n/(a-l))<1e-15?null:(n=1/n,h[0][0]=t[1][1]*n,h[1][0]=-t[1][0]*n,h[0][1]=-t[0][1]*n,h[1][1]=t[0][0]*n,h[2][0]=-(t[2][0]*h[0][0]+t[2][1]*h[1][0]),h[2][1]=-(t[2][0]*h[0][1]+t[2][1]*h[1][1]),h)},e.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},e.notNull=function(t){return null!=t},e.isNull=function(t){return null==t},e.defNull=function(t,s){return e.notNull(t)?t:s},e.isWCSSys=function(t){return"image"!==t&&"physical"!==t},e.notWCS=function(t){return"image"===t||"physical"===t},e.isHMS=function(t,s){return(":"===(s=s||String.fromCharCode(e.saodtype()))||"h"===s)&&"galactic"!==t&&"ecliptic"!==t},e.ishealpix=function(t){return t&&"table"===t.imtab&&t.raw&&t.raw.header&&t.raw.header.CTYPE1&&t.raw.header.CTYPE1.match(/--HPX/i)},e.proxyAvailable=function(){return e.globalOpts.loadProxy&&!e.allinone&&"none"!==e.globalOpts.helperType&&e.globalOpts.workDir},e.cardpars=function(t){let s,o=t.slice(0,8).trim();return"HISTORY"===o||"COMMENT"===o?[o,t.slice(9).trim()]:"="===t[8]?(s=t.slice(10).replace(/'/g," ").replace(/ \/.*/,"").trim(),"T"===s?s=!0:"F"===s?s=!1:e.isNumber(s)&&(s=parseFloat(s)),[o,s]):void 0},e.raw2FITS=function(t,s){let o,n,a,l,c,d,h,p,g,v=!1,r="";const u={},f=/^(NAXIS|CRPIX|CRVAL|CTYPE|CUNIT|CDELT)[34567]/,m=(b,w,A,x)=>{let y,S,_,C=b;return"XTENSION"!==w||A?(_=new RegExp(`${w} *= *(-?[-+]?[0-9]*.?[0-9]*([eE][-+]?[0-9]+)?) *`),b?(y=b.replace(_,"$1"),S=parseFloat(y)):S=void 0,S!==A&&(C=sprintf("%-8s= %20s / %-47s",w,A,x||""))):C=sprintf("%s  = %20s / %-47s","SIMPLE","T","file does conform to FITS standard"),u[w]=!0,C};if(!t)return r;if("boolean"==typeof(s=s||{})&&(s={addcr:s}),t.card||t.cardstr){for(p=t.header||{},h=t.card?t.card.length:t.ncard,o=0;o<h;o++)if(d=t.card?t.card[o].slice(0,80):t.cardstr.slice(80*o,80*(o+1)),!s.notab||!d.match(/^TAB(TYP|MIN|MAX|DIM)[1,2]/)){if(d.match(/^XTENSION/)&&0===o&&s.simple)r+=m(d,"XTENSION");else if(d.match(/^BITPIX /)&&t.bitpix)r+=m(d,"BITPIX",t.bitpix,"bits/pixel");else if(d.match(/^NAXIS1 /)&&t.width)r+=m(d,"NAXIS1",t.width,"x image dim");else if(d.match(/^NAXIS2 /)&&t.height)r+=m(d,"NAXIS2",t.height,"y image dim");else if(d.match(/^CRPIX1 /)&&e.notNull(p.CRPIX1))r+=m(d,"CRPIX1",p.CRPIX1,"ref point");else if(d.match(/^CRPIX2 /)&&e.notNull(p.CRPIX2))r+=m(d,"CRPIX2",p.CRPIX2,"ref point");else if(d.match(/^CDELT1 /)&&e.notNull(p.CDELT1))r+=m(d,"CDELT1",p.CDELT1,"deg/pixel");else if(d.match(/^CDELT2 /)&&e.notNull(p.CDELT2))r+=m(d,"CDELT2",p.CDELT2,"deg/pixel");else if(d.match(/^CD1_1 /)&&e.notNull(p.CD1_1))r+=m(d,"CD1_1",p.CD1_1,"WCS matrix value");else if(d.match(/^CD1_2 /)&&e.notNull(p.CD1_2))r+=m(d,"CD1_2",p.CD1_2,"WCS matrix value");else if(d.match(/^CD2_1 /)&&e.notNull(p.CD2_1))r+=m(d,"CD2_1",p.CD2_1,"WCS matrix value");else if(d.match(/^CD2_2 /)&&e.notNull(p.CD2_2))r+=m(d,"CD2_2",p.CD2_2,"WCS matrix value");else if(d.match(/^LTV1 /)&&e.notNull(p.LTV1))r+=m(d,"LTV1",p.LTV1,"IRAF ref. point");else if(d.match(/^LTV2 /)&&e.notNull(p.LTV2))r+=m(d,"LTV2",p.LTV2,"IRAF ref. point");else if(d.match(/^LTM1_1 /)&&e.notNull(p.LTM1_1))r+=m(d,"LTM1_1",p.LTM1_1,"IRAF matrix value");else if(d.match(/^LTM1_2 /)&&e.notNull(p.LTM1_2))r+=m(d,"LTM1_2",p.LTM1_2,"IRAF matrix value");else if(d.match(/^LTM2_1 /)&&e.notNull(p.LTM2_1))r+=m(d,"LTM2_1",p.LTM2_1,"IRAF matrix value");else if(d.match(/^LTM2_2 /)&&e.notNull(p.LTM2_2))r+=m(d,"LTM2_2",p.LTM2_2,"IRAF matrix value");else if(s.twoaxes&&d.match(/^NAXIS /))r+=m(d,"NAXIS",2,"number of data axes");else{if(s.twoaxes&&d.match(/^(NAXIS|CRPIX|CRVAL|CTYPE|CUNIT|CDELT)[34567]/))continue;if(s.twoaxes&&d.match(/^(DATASUM|CHECKSUM)/))continue;"END "===d.substring(0,4)?(e.notNull(p.LTV1)&&!u.LTV1&&(r+=m(null,"LTV1",p.LTV1,"IRAF ref. point"),s.addcr&&(r+="\n")),e.notNull(p.LTV2)&&!u.LTV2&&(r+=m(null,"LTV2",p.LTV2,"IRAF ref. point"),s.addcr&&(r+="\n")),e.notNull(p.LTM1_1)&&!u.LTM1_1&&(r+=m(null,"LTM1_1",p.LTM1_1,"IRAF matrix value"),s.addcr&&(r+="\n")),e.notNull(p.LTM1_2)&&!u.LTM1_2&&(r+=m(null,"LTM1_2",p.LTM1_2,"IRAF matrix value"),s.addcr&&(r+="\n")),e.notNull(p.LTM2_1)&&!u.LTM2_1&&(r+=m(null,"LTM2_1",p.LTM2_1,"IRAF matrix value"),s.addcr&&(r+="\n")),e.notNull(p.LTM2_2)&&!u.LTM2_2&&(r+=m(null,"LTM2_2",p.LTM2_2,"IRAF matrix value"),s.addcr&&(r+="\n")),r+=d,v=!0):r+=d}s.addcr&&(r+="\n")}}else if(t.header||t.BITPIX)for(l of(a=t.header?t.header:t,(void 0!==a.SIMPLE||void 0!==a.simple)&&(c=void 0!==a.SIMPLE?a.SIMPLE:a.simple,!0===c?c="T":!1===c&&(c="F"),r+=sprintf("%-8s= %20s / %-47s","SIMPLE",c,"conforms to FITS standard"),s.addcr&&(r+="\n")),(void 0!==a.BITPIX||void 0!==a.bitpix)&&(c=void 0!==a.BITPIX?a.BITPIX:a.bitpix,r+=sprintf("%-8s= %20s / %-47s","BITPIX",c,"bits/pixel"),s.addcr&&(r+="\n")),Object.keys(a)))if("js9Protocol"!==l&&"js9Endian"!==l&&"SIMPLE"!==l&&"simple"!==l&&"BITPIX"!==l&&"bitpix"!==l&&("END"===l&&(v=!0),s.twoaxes&&"NAXIS"===l&&(a[l]=2),!s.twoaxes||!l.match(f))){if(l.match(/HISTORY__[0-9]+/))r+=sprintf("HISTORY %-72s",a[l]);else if(l.match(/COMMENT__[0-9]+/))r+=sprintf("COMMENT %-72s",a[l]);else{if(c=a[l],!0===c?c="T":!1===c?c="F":""===c?c="' '":Number.isNaN(c)?c="NaN":!e.isNumber(c)&&"'"!==c.charAt(0)&&(c=`'${c}'`),n=sprintf("%-8s= %20s",l,c),g=80-n.length,g>0)for(o=0;o<g;o++)n+=" ";r+=n}s.addcr&&(r+="\n")}return v||(r+=sprintf("%-8s%-72s","END"," "),s.addcr&&(r+="\n")),r},e.hdus2Str=function(t){let s,o,n,a,l="";if(!t)return l;for(s=0;s<t.length;s++){switch(a=t[s],n=a.name?a.name:0===s?"Primary":"N/A",l+=sprintf("<b>#%d</b>:&#09;<b>name</b>: %s&#09;<b>type</b>: %s",a.hdu,n,a.type),a.type){case"image":if(l+=sprintf("&#09;<b>bitpix</b>: %d&#09;<b>naxis</b>: %d",a.bitpix,a.naxis),a.naxes.length){for(l+="&#09;<b>axes</b>: [",o=0;o<a.naxes.length;o++)l+=sprintf("%d",a.naxes[o]),o!==a.naxes.length-1&&(l+=", ");l+="]"}break;case"table":case"ascii":for(n="&#09;",a.rows<=9&&(n+="&#09;"),l+=sprintf("&#09;<b>rows</b>: %d%s<b>cols</b>: [",a.rows,n),o=0;o<a.cols.length;o++)l+=`${a.cols[o].name}`,e.notNull(a.cols[o].min)&&e.notNull(a.cols[o].max)&&(l+=`:${a.cols[o].min}:${a.cols[o].max}`),o!==a.cols.length-1&&(l+=", ");l+="]"}l+="\n\n"}return l},CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(t){t&&(this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),t&&this.restore()},e.searchbar=function(t,s){let o,n,a,l,c,d,h,p,g,v,r;const u=$(t),f="current",b=x=>{let y=x;n.unmark({done:()=>{n.mark(y,{caseSensitive:a.opts.matchcase,diacritics:a.opts.diacritics,accuracy:a.opts.matchwords?"exactly":"partially",wildcards:a.opts.matchwildcards?"enabled":"disabled",done:()=>{a.results=n.find("mark"),a.currentIndex=0,A()}})}})},w=x=>{const y=x.prop("data-btn");a.opts[y]?(x.removeClass("JS9SearchButton-false"),x.addClass("JS9SearchButton-true")):(x.removeClass("JS9SearchButton-true"),x.addClass("JS9SearchButton-false"))},A=()=>{let x,y;a.results.length&&(x=a.results.eq(a.currentIndex),a.results.removeClass(f),x.length&&(x.addClass(f),y=x.position().top,(y<0||y>o.height())&&(y=y+o.scrollTop()-50,o.scrollTop(y))))};if(u.is(s=s||".JS9AnalysisText"))n=u;else if(n=u.find(s),!n.length)return;o=u.find(e.lightOpts[e.LIGHTWIN].drag),o.length||(o=u),a=o.find(".JS9Searchbar"),a.length?a.css("display","block"):(a=$("<div>").addClass("JS9Searchbar").appendTo(o),a.opts={matchcase:!1,matchdiacritics:!1,matchwords:!1,matchwildcards:!1},l=$("<input type='search'>").addClass("JS9SearchInput").appendTo(a),l.on("input",()=>{b(l.val())}),l.prop("placeholder",a.opts.matchwildcards?"sea*rch template?":"search term(s)"),c=$("<button>").addClass("JS9SearchButton").prop("data-btn","next").html("&darr;").appendTo(a),d=$("<button>").addClass("JS9SearchButton").prop("data-btn","prev").html("&uarr;").appendTo(a),c.add(d).on("click",x=>{a.results&&a.results.length&&(a.currentIndex+=$(x.currentTarget).is(d)?-1:1,a.currentIndex<0&&(a.currentIndex=a.results.length-1),a.currentIndex>a.results.length-1&&(a.currentIndex=0),A())}),p=$("<button>").addClass(`JS9SearchButton JS9SearchButton-${a.opts.matchcase}`).prop("data-btn","matchcase").html("Match Case").appendTo(a),p.on("click",()=>{a.opts.matchcase=!a.opts.matchcase,w(p),b(l.val())}),w(p),g=$("<button>").addClass(`JS9SearchButton JS9SearchButton-${a.opts.matchdiacritics}`).prop("data-btn","matchdiacritics").html("Match Diacritics").appendTo(a),g.on("click",()=>{a.opts.matchdiacritics=!a.opts.matchdiacritics,w(g),b(l.val())}),w(g),v=$("<button>").addClass(`JS9SearchButton JS9SearchButton-${a.opts.matchwords}`).prop("data-btn","matchwords").html("Whole Words").appendTo(a),v.on("click",()=>{a.opts.matchwords=!a.opts.matchwords,w(v),b(l.val())}),w(v),r=$("<button>").addClass(`JS9SearchButton JS9SearchButton-${a.opts.matchwildcards}`).prop("data-btn","matchwildcards").html("Wildcards").appendTo(a),r.on("click",()=>{a.opts.matchwildcards=!a.opts.matchwildcards,l.prop("placeholder",a.opts.matchwildcards?"sea*rch template?":"search term(s)"),w(r),b(l.val())}),w(r),h=$("<button>").addClass("JS9SearchButton").prop("data-btn","close").html("Close").appendTo(a),h.on("click",()=>{n.unmark(),l.val(""),a.css("display","none")}),o.css("outline","none"),o.attr("tabindex","0"),o.on("keydown",x=>{const S=String.fromCharCode(x.which||x.keyCode);e.specialKey(x)&&"F"===S&&("none"===a.css("display")?(a.css("display","block"),l.focus()):(n.unmark(),l.val(""),a.css("display","none")))}))},e.tooltip=function(t,s,o,n,a,l){let c,d,h,p,g;o?(c=o.replace(/\$([a-zA-Z0-9_./]+)/g,(f,m,b)=>{let w,A,x;const y=m.split(".");switch(y[0]){case"im":x=n;break;case"xreg":x=a;break;case"evt":x=l;break;case"data":x=a.data;break;default:return f}for(w=1;w<y.length;w++)A=x[y[w]],x=e.isNumber(A)?A.toFixed(6):A;return void 0===x&&(x=""),x}),n.display.tooltip.html(c),p=n.display.tooltip.width(),g=n.display.tooltip.height(),d=Math.max(2,Math.min(t,n.display.width-(p+10))),h=Math.max(2,Math.min(s,n.display.height-(g+10))),n.display.tooltip.css({left:d,top:h,display:"inline-block"})):n.display.tooltip.html("").css({left:-9999,display:"none"})},e.xeqByName=function(...t){let s,o,n,a,[l,c]=t,d=t.slice(2),h=typeof l;switch(h){case"function":return l.apply(c,d);case"string":for(a=/\(\s*([^)]+?)\s*\)/.exec(l),a&&a[1]&&(l=l.slice(0,a.index),d=a[1].split(/\s*,\s*/)),o=l.split("."),n=o.pop(),s=0;s<o.length;s++)c=c[o[s]];return typeof c[n]>"u"&&"function"==typeof e.publics[n]&&(c=e.publics),c[n](...d);default:e.error(`unknown func type: ${h}`)}},e.varByName=function(t,s){let o,n,a;for(s=s||e,n=t.split("."),a=n.pop(),o=0;o<n.length;o++)if(!(s=s[n[o]]))return null;return s[a]},e.mergePrefs=function(t){let s,o,n,a=!1;for(n of(t=t||{},Object.keys(t)))if("config"===n)"merge"===t[n].objects&&(a=!0);else if({}.hasOwnProperty.call(e,n)&&(o=typeof e[n],s=typeof t[n],o===s||"string"===s))switch(o){case"object":$.isArray(t[n])?e[n]=t[n]:a?$.extend(!0,e[n],t[n]):$.extend(e[n],t[n]);break;case"number":case"string":e[n]=t[n]}},e.loadPrefs=function(t,s){$.ajax({url:t,cache:!1,dataType:"json",mimeType:"application/json",async:!1,success:o=>{e.mergePrefs(o)},error:(o,n,a)=>{s&&e.log("JS9 prefs file not available: %s",t)}})},e.isTypedArray=function(t){let s;return s=Object.prototype.toString.call(t),{}.hasOwnProperty.call({"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0},s)},e.Starbase=function(t,s){let o,n,a,l,c,d,h=0;const p=v=>{let r;for(r=0;r<v.length;r++)if(null===v[r].match(/^-+$/))return 0;return r},g=v=>v;if(this.head={},this.convFuncs=[],this.data=[],this.delims=[],t){if(s=s||{},c=t.replace(/\s+$/,"").split("\n"),s.skip&&(a=s.skip.split(""),a&&a.length))for(;h<c.length&&(a[0]===c[h][0]||"\n"===a[1]&&""===c[h]);h++);if(void 0!==c[h]&&void 0!==c[h+1]){for(this.headline=c[h++].trim().split(/ *\t */),s.units&&(this.unitline=c[h++].trim().split(/ *\t */)),this.dashline=c[h++].trim().split(/ *\t */),l=p(this.dashline);0===l||l!==this.headline.length;)s.units?(this.headline=this.unitline,this.unitline=this.dashline):this.headline=this.dashline,this.dashline=c[h++].trim().split(/ *\t */),l=p(this.dashline);for(o=0;o<this.headline.length;o++)this.headline[o]=this.headline[o].replace(/\./g,"_"),this.convFuncs[o]=s.convFuncs&&s.convFuncs[this.headline[o]]?s.convFuncs[this.headline[o]]:s.convFuncs&&s.convFuncs.def?s.convFuncs.def:g;for(n=0;h<c.length&&(!a||!a.length||a[0]!==c[h][0]&&("\n"!==a[1]||""!==c[h]));h++,n++)for(this.data[n]=c[h].split("\t"),o=0;o<this.data[n].length;o++)d=this.convFuncs[o](this.data[n][o]),this.data[n][o]=d.val,this.delims[o]=d.delim||null;for(o=0;o<this.headline.length;o++)this[this.headline[o]]=o}}},e.colorToHex=function(t){let s;const o={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd3",antiquewhite1:"#ffefdb",antiquewhite2:"#eedfcc",antiquewhite3:"#cdc0b0",antiquewhite4:"#8b8378",cadetblue1:"#98f5ff",cadetblue2:"#8ee5ee",cadetblue3:"#7ac5cd",cadetblue4:"#53868b",darkgoldenrod1:"#ffb90f",darkgoldenrod2:"#eead0e",darkgoldenrod3:"#cd950c",darkgoldenrod4:"#8b6508",darkgrey:"#a9a9a9",darkolivegreen1:"#caff70",darkolivegreen2:"#bcee68",darkolivegreen3:"#a2cd5a",darkolivegreen4:"#6e8b3d",darkorange1:"#ff7f00",darkorange2:"#ee7600",darkorange3:"#cd6600",darkorange4:"#8b4500",darkorchid1:"#bf3eff",darkorchid2:"#b23aee",darkorchid3:"#9a32cd",darkorchid4:"#68228b",darkseagreen1:"#c1ffc1",darkseagreen2:"#b4eeb4",darkseagreen3:"#9bcd9b",darkseagreen4:"#698b69",darkslategray1:"#97ffff",darkslategray2:"#8deeee",darkslategray3:"#79cdcd",darkslategray4:"#528b8b",darkslategrey:"#2f4f4f",deeppink1:"#ff1493",deeppink2:"#ee1289",deeppink3:"#cd1076",deeppink4:"#8b0a50",deepskyblue1:"#00bfff",deepskyblue2:"#00b2ee",deepskyblue3:"#009acd",deepskyblue4:"#00688b",dimgrey:"#696969",dodgerblue1:"#1e90ff",dodgerblue2:"#1c86ee",dodgerblue3:"#1874cd",dodgerblue4:"#104e8b",hotpink1:"#ff6eb4",hotpink2:"#ee6aa7",hotpink3:"#cd6090",hotpink4:"#8b3a62",indianred:"#cd5c5c",indianred1:"#ff6a6a",indianred2:"#ee6363",indianred3:"#cd5555",indianred4:"#8b3a3a",lavenderblush1:"#fff0f5",lavenderblush2:"#eee0e5",lavenderblush3:"#cdc1c5",lavenderblush4:"#8b8386",lemonchiffon1:"#fffacd",lemonchiffon2:"#eee9bf",lemonchiffon3:"#cdc9a5",lemonchiffon4:"#8b8970",lightblue1:"#bfefff",lightblue2:"#b2dfee",lightblue3:"#9ac0cd",lightblue4:"#68838b",lightcyan1:"#e0ffff",lightcyan2:"#d1eeee",lightcyan3:"#b4cdcd",lightcyan4:"#7a8b8b",lightgoldenrod:"#eedd82",lightgoldenrod1:"#ffec8b",lightgoldenrod2:"#eedc82",lightgoldenrod3:"#cdbe70",lightgoldenrod4:"#8b814c",lightgray:"#d3d3d3",lightpink1:"#ffaeb9",lightpink2:"#eea2ad",lightpink3:"#cd8c95",lightpink4:"#8b5f65",lightsalmon1:"#ffa07a",lightsalmon2:"#ee9572",lightsalmon3:"#cd8162",lightsalmon4:"#8b5742",lightskyblue1:"#b0e2ff",lightskyblue2:"#a4d3ee",lightskyblue3:"#8db6cd",lightskyblue4:"#607b8b",lightslateblue:"#8470ff",lightslategrey:"#778899",lightsteelblue1:"#cae1ff",lightsteelblue2:"#bcd2ee",lightsteelblue3:"#a2b5cd",lightsteelblue4:"#6e7b8b",lightyellow1:"#ffffe0",lightyellow2:"#eeeed1",lightyellow3:"#cdcdb4",lightyellow4:"#8b8b7a",mediumorchid1:"#e066ff",mediumorchid2:"#d15fee",mediumorchid3:"#b452cd",mediumorchid4:"#7a378b",mediumpurple1:"#ab82ff",mediumpurple2:"#9f79ee",mediumpurple3:"#8968cd",mediumpurple4:"#5d478b",mistyrose1:"#ffe4e1",mistyrose2:"#eed5d2",mistyrose3:"#cdb7b5",mistyrose4:"#8b7d7b",navajowhite1:"#ffdead",navajowhite2:"#eecfa1",navajowhite3:"#cdb38b",navajowhite4:"#8b795e",navyblue:"#000080",olivedrab1:"#c0ff3e",olivedrab2:"#b3ee3a",olivedrab3:"#9acd32",olivedrab4:"#698b22",orangered1:"#ff4500",orangered2:"#ee4000",orangered3:"#cd3700",orangered4:"#8b2500",palegreen1:"#9aff9a",palegreen2:"#90ee90",palegreen3:"#7ccd7c",palegreen4:"#548b54",paleturquoise1:"#bbffff",paleturquoise2:"#aeeeee",paleturquoise3:"#96cdcd",paleturquoise4:"#668b8b",palevioletred1:"#ff82ab",palevioletred2:"#ee799f",palevioletred3:"#cd6889",palevioletred4:"#8b475d",peachpuff1:"#ffdab9",peachpuff2:"#eecbad",peachpuff3:"#cdaf95",peachpuff4:"#8b7765",rosybrown1:"#ffc1c1",rosybrown2:"#eeb4b4",rosybrown3:"#cd9b9b",rosybrown4:"#8b6969",royalblue1:"#4876ff",royalblue2:"#436eee",royalblue3:"#3a5fcd",royalblue4:"#27408b",seagreen1:"#54ff9f",seagreen2:"#4eee94",seagreen3:"#43cd80",seagreen4:"#2e8b57",skyblue1:"#87ceff",skyblue2:"#7ec0ee",skyblue3:"#6ca6cd",skyblue4:"#4a708b",slateblue1:"#836fff",slateblue2:"#7a67ee",slateblue3:"#6959cd",slateblue4:"#473c8b",slategray1:"#c6e2ff",slategray2:"#b9d3ee",slategray3:"#9fb6cd",slategray4:"#6c7b8b",slategrey:"#708090",springgreen1:"#00ff7f",springgreen2:"#00ee76",springgreen3:"#00cd66",springgreen4:"#008b45",steelblue1:"#63b8ff",steelblue2:"#5cacee",steelblue3:"#4f94cd",steelblue4:"#36648b",violetred:"#d02090",violetred1:"#ff3e96",violetred2:"#ee3a8c",violetred3:"#cd3278",violetred4:"#8b2252",webgray:"#808080",webgreen:"#008000",webgrey:"#808080",webmaroon:"#800000",webpurple:"#800080",x11gray:"#bebebe",x11green:"#00ff00",x11grey:"#bebebe",x11maroon:"#b03060",x11purple:"#a020f0",aquamarine1:"#7fffd4",aquamarine2:"#76eec6",aquamarine3:"#66cdaa",aquamarine4:"#458b74",azure1:"#f0ffff",azure2:"#e0eeee",azure3:"#c1cdcd",azure4:"#838b8b",bisque1:"#ffe4c4",bisque2:"#eed5b7",bisque3:"#cdb79e",bisque4:"#8b7d6b",blue1:"#0000ff",blue2:"#0000ee",blue3:"#0000cd",blue4:"#00008b",brown1:"#ff4040",brown2:"#ee3b3b",brown3:"#cd3333",brown4:"#8b2323",burlywood1:"#ffd39b",burlywood2:"#eec591",burlywood3:"#cdaa7d",burlywood4:"#8b7355",chartreuse1:"#7fff00",chartreuse2:"#76ee00",chartreuse3:"#66cd00",chartreuse4:"#458b00",chocolate1:"#ff7f24",chocolate2:"#ee7621",chocolate3:"#cd661d",chocolate4:"#8b4513",coral1:"#ff7256",coral2:"#ee6a50",coral3:"#cd5b45",coral4:"#8b3e2f",cornsilk1:"#fff8dc",cornsilk2:"#eee8cd",cornsilk3:"#cdc8b1",cornsilk4:"#8b8878",cyan1:"#00ffff",cyan2:"#00eeee",cyan3:"#00cdcd",cyan4:"#008b8b",firebrick1:"#ff3030",firebrick2:"#ee2c2c",firebrick3:"#cd2626",firebrick4:"#8b1a1a",gold1:"#ffd700",gold2:"#eec900",gold3:"#cdad00",gold4:"#8b7500",goldenrod1:"#ffc125",goldenrod2:"#eeb422",goldenrod3:"#cd9b1d",goldenrod4:"#8b6914",gray0:"#000000",gray1:"#030303",gray10:"#1a1a1a",gray100:"#ffffff",gray11:"#1c1c1c",gray12:"#1f1f1f",gray13:"#212121",gray14:"#242424",gray15:"#262626",gray16:"#292929",gray17:"#2b2b2b",gray18:"#2e2e2e",gray19:"#303030",gray2:"#050505",gray20:"#333333",gray21:"#363636",gray22:"#383838",gray23:"#3b3b3b",gray24:"#3d3d3d",gray25:"#404040",gray26:"#424242",gray27:"#454545",gray28:"#474747",gray29:"#4a4a4a",gray3:"#080808",gray30:"#4d4d4d",gray31:"#4f4f4f",gray32:"#525252",gray33:"#545454",gray34:"#575757",gray35:"#595959",gray36:"#5c5c5c",gray37:"#5e5e5e",gray38:"#616161",gray39:"#636363",gray4:"#0a0a0a",gray40:"#666666",gray41:"#696969",gray42:"#6b6b6b",gray43:"#6e6e6e",gray44:"#707070",gray45:"#737373",gray46:"#757575",gray47:"#787878",gray48:"#7a7a7a",gray49:"#7d7d7d",gray5:"#0d0d0d",gray50:"#7f7f7f",gray51:"#828282",gray52:"#858585",gray53:"#878787",gray54:"#8a8a8a",gray55:"#8c8c8c",gray56:"#8f8f8f",gray57:"#919191",gray58:"#949494",gray59:"#969696",gray6:"#0f0f0f",gray60:"#999999",gray61:"#9c9c9c",gray62:"#9e9e9e",gray63:"#a1a1a1",gray64:"#a3a3a3",gray65:"#a6a6a6",gray66:"#a8a8a8",gray67:"#ababab",gray68:"#adadad",gray69:"#b0b0b0",gray7:"#121212",gray70:"#b3b3b3",gray71:"#b5b5b5",gray72:"#b8b8b8",gray73:"#bababa",gray74:"#bdbdbd",gray75:"#bfbfbf",gray76:"#c2c2c2",gray77:"#c4c4c4",gray78:"#c7c7c7",gray79:"#c9c9c9",gray8:"#141414",gray80:"#cccccc",gray81:"#cfcfcf",gray82:"#d1d1d1",gray83:"#d4d4d4",gray84:"#d6d6d6",gray85:"#d9d9d9",gray86:"#dbdbdb",gray87:"#dedede",gray88:"#e0e0e0",gray89:"#e3e3e3",gray9:"#171717",gray90:"#e5e5e5",gray91:"#e8e8e8",gray92:"#ebebeb",gray93:"#ededed",gray94:"#f0f0f0",gray95:"#f2f2f2",gray96:"#f5f5f5",gray97:"#f7f7f7",gray98:"#fafafa",gray99:"#fcfcfc",green1:"#00ff00",green2:"#00ee00",green3:"#00cd00",green4:"#008b00",grey:"#bebebe",grey0:"#000000",grey1:"#030303",grey10:"#1a1a1a",grey100:"#ffffff",grey11:"#1c1c1c",grey12:"#1f1f1f",grey13:"#212121",grey14:"#242424",grey15:"#262626",grey16:"#292929",grey17:"#2b2b2b",grey18:"#2e2e2e",grey19:"#303030",grey2:"#050505",grey20:"#333333",grey21:"#363636",grey22:"#383838",grey23:"#3b3b3b",grey24:"#3d3d3d",grey25:"#404040",grey26:"#424242",grey27:"#454545",grey28:"#474747",grey29:"#4a4a4a",grey3:"#080808",grey30:"#4d4d4d",grey31:"#4f4f4f",grey32:"#525252",grey33:"#545454",grey34:"#575757",grey35:"#595959",grey36:"#5c5c5c",grey37:"#5e5e5e",grey38:"#616161",grey39:"#636363",grey4:"#0a0a0a",grey40:"#666666",grey41:"#696969",grey42:"#6b6b6b",grey43:"#6e6e6e",grey44:"#707070",grey45:"#737373",grey46:"#757575",grey47:"#787878",grey48:"#7a7a7a",grey49:"#7d7d7d",grey5:"#0d0d0d",grey50:"#7f7f7f",grey51:"#828282",grey52:"#858585",grey53:"#878787",grey54:"#8a8a8a",grey55:"#8c8c8c",grey56:"#8f8f8f",grey57:"#919191",grey58:"#949494",grey59:"#969696",grey6:"#0f0f0f",grey60:"#999999",grey61:"#9c9c9c",grey62:"#9e9e9e",grey63:"#a1a1a1",grey64:"#a3a3a3",grey65:"#a6a6a6",grey66:"#a8a8a8",grey67:"#ababab",grey68:"#adadad",grey69:"#b0b0b0",grey7:"#121212",grey70:"#b3b3b3",grey71:"#b5b5b5",grey72:"#b8b8b8",grey73:"#bababa",grey74:"#bdbdbd",grey75:"#bfbfbf",grey76:"#c2c2c2",grey77:"#c4c4c4",grey78:"#c7c7c7",grey79:"#c9c9c9",grey8:"#141414",grey80:"#cccccc",grey81:"#cfcfcf",grey82:"#d1d1d1",grey83:"#d4d4d4",grey84:"#d6d6d6",grey85:"#d9d9d9",grey86:"#dbdbdb",grey87:"#dedede",grey88:"#e0e0e0",grey89:"#e3e3e3",grey9:"#171717",grey90:"#e5e5e5",grey91:"#e8e8e8",grey92:"#ebebeb",grey93:"#ededed",grey94:"#f0f0f0",grey95:"#f2f2f2",grey96:"#f5f5f5",grey97:"#f7f7f7",grey98:"#fafafa",grey99:"#fcfcfc",honeydew1:"#f0fff0",honeydew2:"#e0eee0",honeydew3:"#c1cdc1",honeydew4:"#838b83",ivory1:"#fffff0",ivory2:"#eeeee0",ivory3:"#cdcdc1",ivory4:"#8b8b83",khaki1:"#fff68f",khaki2:"#eee685",khaki3:"#cdc673",khaki4:"#8b864e",magenta1:"#ff00ff",magenta2:"#ee00ee",magenta3:"#cd00cd",magenta4:"#8b008b",maroon1:"#ff34b3",maroon2:"#ee30a7",maroon3:"#cd2990",maroon4:"#8b1c62",orange1:"#ffa500",orange2:"#ee9a00",orange3:"#cd8500",orange4:"#8b5a00",orchid1:"#ff83fa",orchid2:"#ee7ae9",orchid3:"#cd69c9",orchid4:"#8b4789",pink1:"#ffb5c5",pink2:"#eea9b8",pink3:"#cd919e",pink4:"#8b636c",plum1:"#ffbbff",plum2:"#eeaeee",plum3:"#cd96cd",plum4:"#8b668b",purple1:"#9b30ff",purple2:"#912cee",purple3:"#7d26cd",purple4:"#551a8b",red1:"#ff0000",red2:"#ee0000",red3:"#cd0000",red4:"#8b0000",salmon1:"#ff8c69",salmon2:"#ee8262",salmon3:"#cd7054",salmon4:"#8b4c39",seashell1:"#fff5ee",seashell2:"#eee5de",seashell3:"#cdc5bf",seashell4:"#8b8682",sienna1:"#ff8247",sienna2:"#ee7942",sienna3:"#cd6839",sienna4:"#8b4726",snow1:"#fffafa",snow2:"#eee9e9",snow3:"#cdc9c9",snow4:"#8b8989",tan1:"#ffa54f",tan2:"#ee9a49",tan3:"#cd853f",tan4:"#8b5a2b",thistle1:"#ffe1ff",thistle2:"#eed2ee",thistle3:"#cdb5cd",thistle4:"#8b7b8b",tomato1:"#ff6347",tomato2:"#ee5c42",tomato3:"#cd4f39",tomato4:"#8b3626",turquoise1:"#00f5ff",turquoise2:"#00e5ee",turquoise3:"#00c5cd",turquoise4:"#00868b",wheat1:"#ffe7ba",wheat2:"#eed8ae",wheat3:"#cdba96",wheat4:"#8b7e66",yellow1:"#ffff00",yellow2:"#eeee00",yellow3:"#cdcd00",yellow4:"#8b8b00"};let n;return t?(n=t.toLowerCase(),typeof o[n]<"u"?o[n]:(s=t.match(/rgb\((\d+)[,\s]+(\d+)[,\s]+(\d+)\)/i),s?sprintf("#%02x%02x%02x",s[1],s[2],s[3]):t)):""},e.parseStaticColors=function(t){let s,o,n,a,l=[];if("string"==typeof t)try{t=JSON.parse(t)}catch{}for($.isArray(t)||e.error("invalid input for static colors"),s=0;s<t.length;s++){if(a="string"==typeof t[s]?t[s].split(":"):t[s],$.isArray(a)){a[0]||e.error(`no color specified: ${t[s]}`);try{n=tinycolor(a[0])}catch{e.error(`invalid color: ${a[0]}`)}e.isNull(a[1])?(a[1]=1,a[2]=1/0):a[1]=""===a[1]?-1/0:parseFloat(a[1]),a[2]=e.isNull(a[2])?a[1]:""===a[2]?1/0:parseFloat(a[2]),o={active:!0,red:n._r,green:n._g,blue:n._b,alpha:255*n._a,min:a[1],max:a[2]},"string"==typeof a[0]&&(o.name=a[0])}else"object"==typeof a&&(o=a);l.push(o)}return l.sort((c,d)=>c.min-d.min),l},e.lookupStaticColor=(t,s,o)=>{let n,a,l={red:0,green:0,blue:0,alpha:0};return t&&t.staticObj?(l=t.params.nocolor||l,s<t.staticObj.colors[0].min?l:o&&o[s]?o[s]:(n=((h,p)=>{let g,v,r=0,u=h.length-1;for(;r<=u;){if(g=Math.floor((r+u)/2),v=h[g],p>=v.min&&p<=v.max)return g;v.max<p?r=g+1:u=g-1}return-1})(t.staticObj.colors,s),n<0?a=l:(a=t.staticObj.colors[n],a.active||(a=l)),o&&s<=1e7&&(o[s]=a),a)):l},e.strtoscaled=function(t){let s=e.saostrtod(t);const o=String.fromCharCode(e.saodtype());switch(o){case'"':s/=3600;break;case"'":s/=60;break;case"r":s*=180/Math.PI}return{dval:s,dtype:o}},e.cleanPath=function(t,s){let o;return t?(o=t.replace(/\[.*\]/,""),o.match(/(<(animation|form|math|maction|svg|script|video)\s|<\?xml|javascript:|on.*&equals;|alert\(|alert&lpar;)|window\./i)&&(e.globalOpts.alerts=!0,e.error(`${s||"filename"} is susceptible to XSS attack: ${o}`)),t.trim().replace(/\/\.\//,"/").replace(/^\.\//,"")):""},e.fixPath=function(t,s){return s=s||{},window.electron&&e.desktopOpts.currentPath&&!1!==s.fixpath&&!t.match(e.URLEXP)&&(t.match(/^\${JS9_DIR}\//)?t=t.replace(/^\${JS9_DIR}\//,e.INSTALLDIR):t.match(/^\${JS9_INSTALLDIR}\//)?t=t.replace(/^\${JS9_INSTALLDIR}\//,e.INSTALLDIR):t.match(/^\${JS9_PAGEDIR}\//)?t=t.replace(/^\${JS9_PAGEDIR}\//,""):"/"!==t.charAt(0)&&(t=`${window.electron.currentDir}/${t}`)),t},e.localAccess=function(t){let s,o;return t&&e.globalOpts.localAccess&&e.hostFS?(s=t.replace(/\[.*\]/,""),o=`.${s.split(".").pop().toLowerCase()}`,s=`${e.hostFS}/${s}`,e.vsize(s)>=0&&$.inArray(o,e.globalOpts.localTemplates.split(","))>=0?(e.DEBUG>2&&e.log("local access file: %s",s),s):null):null},e.dirname=function(t){return t&&t.includes("/")?t.match(/.*\//)[0]:""},e.mouseDownCB=function(t){const s=t.data,o=s.image,n=$(document).scrollLeft(),a=$(document).scrollTop();if(o){if(e.globalOpts.clickToFocus&&(o.display.displayConjq.focus(),window.scrollTo(n,a)),t.target&&(o.posOffset=$(t.target).offset()),o.pos0=e.eventToDisplayPos(t,o.posOffset),o.pos=o.pos0,o.ipos0=o.displayToImagePos(o.pos),o.ipos=o.ipos0,s.resizing=s.inResize(o.pos),!s.resizing){if(t.preventDefault(),{}.hasOwnProperty.call(e,"MouseTouch")&&e.MouseTouch.action(o,t,"start"),o.clickInRegion&&"regions"===o.clickInLayer)return void o.display.clearMessage("regions");e.specialKey(t)||o.xeqPlugins("mouse","onmousedown",t)}switch(o.clickState=t.which,t.which){case 1:case 2:break;case 3:o.clickState=2}t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length&&(o.clickState=-t.originalEvent.touches.length),$(document).on(`mousemove.${s.id}`,s,l=>e.mouseMoveCB(l)),$(document).on(`mouseup.${s.id}`,s,l=>e.mouseUpCB(l))}},e.mouseUpCB=function(t){let s,o,n,a,l;const c=t.data,d=c.image;if(d)for(d.pos=e.eventToDisplayPos(t,d.posOffset),d.ipos=d.displayToImagePos(d.pos),l=Math.abs(d.pos0.x-d.pos.x)<e.NOMOVE&&Math.abs(d.pos0.y-d.pos.y)<e.NOMOVE,c.inResize(d.pos)||t.preventDefault(),{}.hasOwnProperty.call(e,"MouseTouch")&&e.MouseTouch.action(d,t,"stop"),d.clickInRegion&&d.clickInLayer&&(l||d.updateShapes(d.clickInLayer,"selected","update")),e.specialKey(t)?l&&!d.clickInRegion&&e.globalOpts.metaClickPan&&(d.editAnnulus?d._regroupAnnulus("regions",t):d.setPan(d.ipos.x,d.ipos.y)):(d.xeqPlugins("mouse","onmouseup",t),l&&(d.xeqPlugins("mouse","onclick",t),{}.hasOwnProperty.call(e,"Menubar")&&e.Menubar.onclick(d.display)),"click"===e.globalOpts.dynamicSelect&&e.Dysel.getDisplayOr(c)!==c&&e.Dysel.select(c)),d.clickInRegion=!1,d.clickInLayer=null,d.clickState=0,d.posOffset=null,d.tmp.panzoomRefresh&&(d.refreshLayers(d.tmp.panzoomRefresh),delete d.tmp.panzoomRefresh),c.resizing&&(c.resizing=!1,e.bugs.webkit_resize&&(o=parseInt(c.divjq.css("width"),10),n=parseInt(c.divjq.css("height"),10),o<c.owidth&&c.divjq.css("width",c.owidth+e.RESIZEFUDGE),n<c.oheight&&c.divjq.css("height",c.oheight+e.RESIZEFUDGE)),e.globalOpts.resizeRedisplay||(d.displayImage("all"),d.refreshLayers())),$(document).off(`mouseup.${c.id}`),$(document).off(`mousemove.${c.id}`),s=0;s<e.displays.length;s++)a=e.displays[s],a!==c&&a.image&&a.image.clickState&&a.divjq.trigger("mouseup");else({}).hasOwnProperty.call(e,"Menubar")&&e.Menubar.onclick(t.data)},e.mouseMoveCB=function(t){let s;const o=t.data,n=o.image;!n||e.specialKey(t)||(n.pos=e.eventToDisplayPos(t,n.posOffset),n.ipos=n.displayToImagePos(n.pos),n.pos0||(n.pos0=n.pos),n.ipos0||(n.ipos0=n.ipos),!o.resizing&&(t.preventDefault(),n.valpos=null,n.clickInRegion&&"regions"===n.clickInLayer&&(s=n.display.layers.regions.params.sel,s&&s.params&&((n.params.listonchange||s.params.listonchange||e.globalOpts.intensivePlugins)&&n._updateShape("regions",s,null,"move"),(n.params.listonchange||s.params.listonchange)&&n.listRegions("selected",{mode:2}),e.globalOpts.intensivePlugins&&n.xeqPlugins("region","onregionsmove",s.pub))),{}.hasOwnProperty.call(e,"MouseTouch")&&e.MouseTouch.action(n,t),{}.hasOwnProperty.call(e,"Crosshair")&&n.tmp.arrowCrosshairVisible&&!n.params.crosshair&&e.Crosshair.hide(n,n.ipos,t),n.valpos||(n.valpos=n.updateValpos(n.ipos,!1)),e.specialKey(t)||n.xeqPlugins("mouse","onmousemove",t)))},e.mouseEnterCB=function(t){const s=t.data,o=s.image;t.preventDefault(),o&&(e.specialKey(t)||"move"===e.globalOpts.dynamicSelect&&e.Dysel.getDisplayOr(s)!==s&&e.Dysel.select(s))},e.mouseOverCB=function(t){const o=t.data.image,n=$(document).scrollLeft(),a=$(document).scrollTop();t.preventDefault(),o&&(e.globalOpts.clickToFocus||(o.display.displayConjq.focus(),window.scrollTo(n,a)),e.specialKey(t)||(o.pos=e.eventToDisplayPos(t),o.ipos=o.displayToImagePos(o.pos),e.specialKey(t)||o.xeqPlugins("mouse","onmouseover",t)))},e.mouseOutCB=function(t){const o=t.data.image;t.preventDefault(),o&&(e.globalOpts.clickToFocus||o.display.displayConjq.blur(),o.clickInRegion&&o.clickInLayer&&o.updateShapes(o.clickInLayer,"selected","mouseout"),e.specialKey(t)||(o.pos=e.eventToDisplayPos(t),o.ipos=o.displayToImagePos(o.pos),e.specialKey(t)||o.xeqPlugins("mouse","onmouseout",t)))},e.wheelCB=function(t){const o=t.data.image;o&&e.globalOpts.mousetouchZoom&&{}.hasOwnProperty.call(e,"MouseTouch")&&e.MouseTouch.Actions["wheel zoom"]&&(e.MouseTouch.Actions["wheel zoom"](o,t),t.preventDefault())},e.keyPressCB=function(t){const o=t.data.image;t.preventDefault(),o&&o.xeqPlugins("keypress","onkeypress",t)},e.keyDownCB=function(t){let s;const n=t.data.image;t.preventDefault(),{}.hasOwnProperty.call(e,"Keyboard")&&(s=n?n.ipos:{x:null,y:null},e.Keyboard.action(n,s,t)),n&&n.xeqPlugins("keydown","onkeydown",t)},e.keyUpCB=function(t){const o=t.data.image;o&&o.xeqPlugins("keydown","onkeyup",t)},e.dragenterCB=function(t,s){s.stopPropagation(),s.preventDefault()},e.dragoverCB=function(t,s){s.stopPropagation(),s.preventDefault()},e.dragexitCB=function(t,s){s.stopPropagation(),s.preventDefault()},e.dragdropCB=function(t,s){let o,n,a,l,c;if(s.originalEvent&&(s=s.originalEvent),s.stopPropagation(),s.preventDefault(),a=$.extend(!0,{},e.fits.options),a.display=a.display||t,a.extlist=a.extlist||e.globalOpts.extlist,l=s.target.files||s.dataTransfer.files,c=e.lookupDisplay(a.display),!l.length)return n=s.dataTransfer.getData("text"),void(n.match(e.URLEXP)&&(e.proxyAvailable()?e.LoadProxy(n,{display:a.display}):e.globalOpts.cgiProxy&&e.Load(n,{proxy:!0},{display:a.display})));window.setTimeout(()=>{let d,h;for(o=0;o<l.length;o++)d=l[o],h=d.path||d.name||"",h.match(/\.reg$/)?e.LoadRegions(d,{display:a.display}):h.match(/\.cat$/)?e.LoadCatalog(null,d,{display:a.display}):h.match(/\.ses$/)||h.match(/\.js9ses$/)?e.LoadSession(d,{display:a.display}):h.match(/\.cmap$/)?e.LoadColormap(d):(e.waiting(!0,c),a.refresh=e.globalOpts.refreshDragDrop,a.localAccess=!0,e.Load(d,a,{display:a.display}))},e.SPINOUT)},e.RegisterPlugin=function(t,s,o,n){let a,l,c,d,h;const p=t;!t||!s||!o||(a=t+s,n?(n.viewMenuItem&&(n.menuItem=n.viewMenuItem),n.menuItem&&!n.menu&&(n.menu="view"),n.menu&&(n.menu=n.menu.toLowerCase())):n=[],e.PLUGINS&&(e.PLUGINS+="|"),e.PLUGINS+=a.replace(/JS9/,""),e.PLUGINS+="|",e.PLUGINS+=s,e.plugins.push({xclass:t,xname:s,name:a,opts:n,func:o,instances:[]}),n.help&&(l=n.help.match(/^.*[\\/]/),l[0]&&(c=`plugins/${l[0].replace(/[\\/]+$/,"")}`),d=n.help.replace(/^.*[\\/]/,""),h=n.menuItem?n.menuItem:a,e.helpOpts[s]={type:c,url:d,heading:p,title:h}),e.inited&&e.instantiatePlugins())},e.instantiatePlugin=function(t,s,o,n){let a,l,c,d,h,p,g,v,r,u="visible";if("string"==typeof s){for(a=0;a<e.plugins.length;a++)if(l=e.plugins[a],l.name===s){s=l;break}"string"==typeof s&&e.error(`unknown plugin: ${s}`)}if(c=Object.create(s.func.prototype),c.name=s.name,c.isActive=function(f){return!("active"!==this.status||f&&!{}.hasOwnProperty.call(this.plugin.opts,f))&&("virtual"===this.winType||this.divjq.is(":visible"))},c.errLog=function(f,m){e.log("error in %s: %s [%s]\n%s",f,this.name,m.message,e.strace(m))},t){for(h=t instanceof jQuery?t:"object"==typeof t?$(t):$(`#${t}`),a=0;a<s.instances.length;a++)if(h.is(s.instances[a].odivjq))return s.instances[a]}else h=$("div");if(t?o?(c.id=h.attr("id")||s.name,c.winType="light",c.winHandle=o,c.odivjq=h,c.divjq=h,c.outerdivjq=c.divjq.closest(e.lightOpts[e.LIGHTWIN].top)):(c.id=h.attr("id")||s.name,c.winType="div",$.inArray(c.name,e.globalOpts.hiddenPluginDivs)>=0&&(u="hidden"),h.wrap(`<div class='JS9PluginContainer' style='visibility: ${u}'>`),c.odivjq=h,c.divjq=h,c.divjq.addClass(`${s.xclass}Plugin`).addClass("JS9Plugin"),c.odivjq.attr("id")||c.odivjq.attr("id",c.id),c.outerdivjq=c.divjq.closest(".JS9PluginContainer"),!1!==h.data("toolbarseparate")&&(s.opts.toolbarSeparate||h.data("toolbarseparate"))&&(v=`<div class='${e.lightOpts[e.LIGHTWIN].dragBar.substr(1)}'>`,$(v).insertBefore(c.divjq))):(c.id=s.name,c.winType="virtual"),c.plugin=s,c.el=t,c.status="active",s.instances.push(c),"virtual"===c.winType)for(a=0;a<e.displays.length;a++)e.displays[a].pluginInstances[s.name]||(c.div=null,c.display=e.displays[a],s.func.apply(c,n),e.displays[a].pluginInstances[s.name]=c);else if(c.div=c.divjq[0],c.outerdiv=c.outerdivjq[0],s.opts.winDims&&(!c.divjq.width()||!c.divjq.height())&&(c.divjq.css("width",s.opts.winDims[0]),c.divjq.css("height",s.opts.winDims[1])),d=c.divjq.data("js9id")||c.id,"*"===d?s.opts.dynamicSelect?(c.display=e.displays[0],c.isDynamic=!0,e.Dysel.addPlugins(s.name),r="*"):e.error(`${s.name} is not dynamically selectable`):(c.display=e.lookupDisplay(d),r=c.display.id),g=h.data("toolbarhtml")||s.opts.toolbarHTML,g&&(g=e.Image.prototype.expandMacro.call(null,g,[{name:"title",value:s.opts.winTitle||""}]),p=c.divjq.closest(e.lightOpts[e.LIGHTWIN].drag),0===p.length&&(p=c.divjq),$(`<div class='JS9PluginToolbar-${c.winType}'>`).css("z-index",e.BTNZINDEX).html(g).data("displayid",r).insertAfter(p)),c.display.pluginInstances[s.name]=c,s.func.apply(c,n),"*"===r)for(a=0;a<e.displays.length;a++)e.displays[a].pluginInstances[s.name]?c.display=e.displays[a]:e.displays[a].pluginInstances[s.name]=c;return c},e.instantiatePlugins=function(){let t;const s=o=>{let n,a,l;for($(`div.${o.name}`).each((c,d)=>{e.instantiatePlugin($(d),o,null,o.opts.divArgs)}),!o.opts.menuItem&&o.opts.winDims&&!o.opts.winDims[0]&&!o.opts.winDims[1]&&e.instantiatePlugin(null,o,null,o.opts.divArgs),n=0;n<o.instances.length;n++)if(l=o.instances[n],l.isDynamic)for(a=0;a<e.displays.length;a++)e.displays[a].pluginInstances[o.name]||(e.displays[a].pluginInstances[o.name]=l)};for(t=0;t<e.plugins.length;t++)s(e.plugins[t])},e.initEmscripten=function(){if(!{}.hasOwnProperty.call(window,"Astroem"))if("object"==typeof WebAssembly&&e.globalOpts.useWasm)e.globalOpts.astroemWasm=e.InstallDir(Module.wasmBinaryFile||"astroemw.wasm"),e.fetchURL(e.globalOpts.astroemWasm,null,{responseType:"arraybuffer",allowCache:!0},s=>{Module.wasmBinary=s,e.globalOpts.astroemURL=e.InstallDir("astroemw.js");try{e.loadScript(e.globalOpts.astroemURL)}catch{e.error(`can't load ${e.globalOpts.astroemURL}`)}});else{e.globalOpts.astroemURL=e.InstallDir("astroem.js");try{e.loadScript(e.globalOpts.astroemURL)}catch{e.error(`can't load ${e.globalOpts.astroemURL}`)}}},e.initFITS=function(){({}).hasOwnProperty.call(window,"Astroem")&&(e.vmalloc=Astroem.vmalloc,e.vfree=Astroem.vfree,e.vheap=Astroem.vheap,e.vmemcpy=Astroem.vmemcpy,e.vstrcpy=Astroem.vstrcpy,e.vfile=Astroem.vfile,e.vread=Astroem.vread,e.vunlink=Astroem.vunlink,e.vsize=Astroem.vsize,e.vmount=Astroem.vmount,e.arrfile=Astroem.arrfile,e.listhdu=Astroem.listhdu,e.initwcs=Astroem.initwcs,e.freewcs=Astroem.freewcs,e.wcsinfo=Astroem.wcsinfo,e.wcssys=Astroem.wcssys,e.wcsunits=Astroem.wcsunits,e.pix2wcs=Astroem.pix2wcs,e.wcs2pix=Astroem.wcs2pix,e.reg2wcs=Astroem.reg2wcs,e.saostrtod=Astroem.saostrtod,e.saodtostr=Astroem.saodtostr,e.saodtype=Astroem.saodtype,e.zscale=Astroem.zscale,e.tanhdr=Astroem.tanhdr,e.reproject=Astroem.reproject,e.madd=Astroem.madd,e.imgtbl=Astroem.imgtbl,e.makehdr=Astroem.makehdr,e.shrinkhdr=Astroem.shrinkhdr,e.imsection=Astroem.imsection,e.regcnts=Astroem.regcnts,e.fitsLibrary("cfitsio"))},e.initColormaps=function(){!{}.hasOwnProperty.call(e,"Colormap")||(e.checkNew(new e.Colormap("grey",[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]])),e.checkNew(new e.Colormap("red",[[0,0],[1,1]],[[0,0],[0,0]],[[0,0],[0,0]])),e.checkNew(new e.Colormap("green",[[0,0],[0,0]],[[0,0],[1,1]],[[0,0],[0,0]])),e.checkNew(new e.Colormap("blue",[[0,0],[0,0]],[[0,0],[0,0]],[[0,0],[1,1]])),e.checkNew(new e.Colormap("heat",[[0,0],[.34,1],[1,1]],[[0,0],[1,1]],[[0,0],[.65,0],[.98,1],[1,1]])),e.checkNew(new e.Colormap("cool",[[0,0],[.29,0],[.76,.1],[1,1]],[[0,0],[.22,0],[.96,1],[1,1]],[[0,0],[.53,1],[1,1]])),e.checkNew(new e.Colormap("turbo",[[.18995,.07176,.23217],[.19483,.08339,.26149],[.19956,.09498,.29024],[.20415,.10652,.31844],[.2086,.11802,.34607],[.21291,.12947,.37314],[.21708,.14087,.39964],[.22111,.15223,.42558],[.225,.16354,.45096],[.22875,.17481,.47578],[.23236,.18603,.50004],[.23582,.1972,.52373],[.23915,.20833,.54686],[.24234,.21941,.56942],[.24539,.23044,.59142],[.2483,.24143,.61286],[.25107,.25237,.63374],[.25369,.26327,.65406],[.25618,.27412,.67381],[.25853,.28492,.693],[.26074,.29568,.71162],[.2628,.30639,.72968],[.26473,.31706,.74718],[.26652,.32768,.76412],[.26816,.33825,.7805],[.26967,.34878,.79631],[.27103,.35926,.81156],[.27226,.3697,.82624],[.27334,.38008,.84037],[.27429,.39043,.85393],[.27509,.40072,.86692],[.27576,.41097,.87936],[.27628,.42118,.89123],[.27667,.43134,.90254],[.27691,.44145,.91328],[.27701,.45152,.92347],[.27698,.46153,.93309],[.2768,.47151,.94214],[.27648,.48144,.95064],[.27603,.49132,.95857],[.27543,.50115,.96594],[.27469,.51094,.97275],[.27381,.52069,.97899],[.27273,.5304,.98461],[.27106,.54015,.9893],[.26878,.54995,.99303],[.26592,.55979,.99583],[.26252,.56967,.99773],[.25862,.57958,.99876],[.25425,.5895,.99896],[.24946,.59943,.99835],[.24427,.60937,.99697],[.23874,.61931,.99485],[.23288,.62923,.99202],[.22676,.63913,.98851],[.22039,.64901,.98436],[.21382,.65886,.97959],[.20708,.66866,.97423],[.20021,.67842,.96833],[.19326,.68812,.9619],[.18625,.69775,.95498],[.17923,.70732,.94761],[.17223,.7168,.93981],[.16529,.7262,.93161],[.15844,.73551,.92305],[.15173,.74472,.91416],[.14519,.75381,.90496],[.13886,.76279,.8955],[.13278,.77165,.8858],[.12698,.78037,.8759],[.12151,.78896,.86581],[.11639,.7974,.85559],[.11167,.80569,.84525],[.10738,.81381,.83484],[.10357,.82177,.82437],[.10026,.82955,.81389],[.0975,.83714,.80342],[.09532,.84455,.79299],[.09377,.85175,.78264],[.09287,.85875,.7724],[.09267,.86554,.7623],[.0932,.87211,.75237],[.09451,.87844,.74265],[.09662,.88454,.73316],[.09958,.8904,.72393],[.10342,.896,.715],[.10815,.90142,.70599],[.11374,.90673,.69651],[.12014,.91193,.6866],[.12733,.91701,.67627],[.13526,.92197,.66556],[.14391,.9268,.65448],[.15323,.93151,.64308],[.16319,.93609,.63137],[.17377,.94053,.61938],[.18491,.94484,.60713],[.19659,.94901,.59466],[.20877,.95304,.58199],[.22142,.95692,.56914],[.23449,.96065,.55614],[.24797,.96423,.54303],[.2618,.96765,.52981],[.27597,.97092,.51653],[.29042,.97403,.50321],[.30513,.97697,.48987],[.32006,.97974,.47654],[.33517,.98234,.46325],[.35043,.98477,.45002],[.36581,.98702,.43688],[.38127,.98909,.42386],[.39678,.99098,.41098],[.41229,.99268,.39826],[.42778,.99419,.38575],[.44321,.99551,.37345],[.45854,.99663,.3614],[.47375,.99755,.34963],[.48879,.99828,.33816],[.50362,.99879,.32701],[.51822,.9991,.31622],[.53255,.99919,.30581],[.54658,.99907,.29581],[.56026,.99873,.28623],[.57357,.99817,.27712],[.58646,.99739,.26849],[.59891,.99638,.26038],[.61088,.99514,.2528],[.62233,.99366,.24579],[.63323,.99195,.23937],[.64362,.98999,.23356],[.65394,.98775,.22835],[.66428,.98524,.2237],[.67462,.98246,.2196],[.68494,.97941,.21602],[.69525,.9761,.21294],[.70553,.97255,.21032],[.71577,.96875,.20815],[.72596,.9647,.2064],[.7361,.96043,.20504],[.74617,.95593,.20406],[.75617,.95121,.20343],[.76608,.94627,.20311],[.77591,.94113,.2031],[.78563,.93579,.20336],[.79524,.93025,.20386],[.80473,.92452,.20459],[.8141,.91861,.20552],[.82333,.91253,.20663],[.83241,.90627,.20788],[.84133,.89986,.20926],[.8501,.89328,.21074],[.85868,.88655,.2123],[.86709,.87968,.21391],[.8753,.87267,.21555],[.88331,.86553,.21719],[.89112,.85826,.2188],[.8987,.85087,.22038],[.90605,.84337,.22188],[.91317,.83576,.22328],[.92004,.82806,.22456],[.92666,.82025,.2257],[.93301,.81236,.22667],[.93909,.80439,.22744],[.94489,.79634,.228],[.95039,.78823,.22831],[.9556,.78005,.22836],[.96049,.77181,.22811],[.96507,.76352,.22754],[.96931,.75519,.22663],[.97323,.74682,.22536],[.97679,.73842,.22369],[.98,.73,.22161],[.98289,.7214,.21918],[.98549,.7125,.2165],[.98781,.7033,.21358],[.98986,.69382,.21043],[.99163,.68408,.20706],[.99314,.67408,.20348],[.99438,.66386,.19971],[.99535,.65341,.19577],[.99607,.64277,.19165],[.99654,.63193,.18738],[.99675,.62093,.18297],[.99672,.60977,.17842],[.99644,.59846,.17376],[.99593,.58703,.16899],[.99517,.57549,.16412],[.99419,.56386,.15918],[.99297,.55214,.15417],[.99153,.54036,.1491],[.98987,.52854,.14398],[.98799,.51667,.13883],[.9859,.50479,.13367],[.9836,.49291,.12849],[.98108,.48104,.12332],[.97837,.4692,.11817],[.97545,.4574,.11305],[.97234,.44565,.10797],[.96904,.43399,.10294],[.96555,.42241,.09798],[.96187,.41093,.0931],[.95801,.39958,.08831],[.95398,.38836,.08362],[.94977,.37729,.07905],[.94538,.36638,.07461],[.94084,.35566,.07031],[.93612,.34513,.06616],[.93125,.33482,.06218],[.92623,.32473,.05837],[.92105,.31489,.05475],[.91572,.3053,.05134],[.91024,.29599,.04814],[.90463,.28696,.04516],[.89888,.27824,.04243],[.89298,.26981,.03993],[.88691,.26152,.03753],[.88066,.25334,.03521],[.87422,.24526,.03297],[.8676,.2373,.03082],[.86079,.22945,.02875],[.8538,.2217,.02677],[.84662,.21407,.02487],[.83926,.20654,.02305],[.83172,.19912,.02131],[.82399,.19182,.01966],[.81608,.18462,.01809],[.80799,.17753,.0166],[.79971,.17055,.0152],[.79125,.16368,.01387],[.7826,.15693,.01264],[.77377,.15028,.01148],[.76476,.14374,.01041],[.75556,.13731,.00942],[.74617,.13098,.00851],[.73661,.12477,.00769],[.72686,.11867,.00695],[.71692,.11268,.00629],[.7068,.1068,.00571],[.6965,.10102,.00522],[.68602,.09536,.00481],[.67535,.0898,.00449],[.66449,.08436,.00424],[.65345,.07902,.00408],[.64223,.0738,.00401],[.63082,.06868,.00401],[.61923,.06367,.0041],[.60746,.05878,.00427],[.5955,.05399,.00453],[.58336,.04931,.00486],[.57103,.04474,.00529],[.55852,.04028,.00579],[.54583,.03593,.00638],[.53295,.03169,.00705],[.51989,.02756,.0078],[.50664,.02354,.00863],[.49321,.01963,.00955],[.4796,.01583,.01055]])),e.checkNew(new e.Colormap("viridis",[[.267004,.004874,.329415],[.26851,.009605,.335427],[.269944,.014625,.341379],[.271305,.019942,.347269],[.272594,.025563,.353093],[.273809,.031497,.358853],[.274952,.037752,.364543],[.276022,.044167,.370164],[.277018,.050344,.375715],[.277941,.056324,.381191],[.278791,.062145,.386592],[.279566,.067836,.391917],[.280267,.073417,.397163],[.280894,.078907,.402329],[.281446,.08432,.407414],[.281924,.089666,.412415],[.282327,.094955,.417331],[.282656,.100196,.42216],[.28291,.105393,.426902],[.283091,.110553,.431554],[.283197,.11568,.436115],[.283229,.120777,.440584],[.283187,.125848,.44496],[.283072,.130895,.449241],[.282884,.13592,.453427],[.282623,.140926,.457517],[.28229,.145912,.46151],[.281887,.150881,.465405],[.281412,.155834,.469201],[.280868,.160771,.472899],[.280255,.165693,.476498],[.279574,.170599,.479997],[.278826,.17549,.483397],[.278012,.180367,.486697],[.277134,.185228,.489898],[.276194,.190074,.493001],[.275191,.194905,.496005],[.274128,.199721,.498911],[.273006,.20452,.501721],[.271828,.209303,.504434],[.270595,.214069,.507052],[.269308,.218818,.509577],[.267968,.223549,.512008],[.26658,.228262,.514349],[.265145,.232956,.516599],[.263663,.237631,.518762],[.262138,.242286,.520837],[.260571,.246922,.522828],[.258965,.251537,.524736],[.257322,.25613,.526563],[.255645,.260703,.528312],[.253935,.265254,.529983],[.252194,.269783,.531579],[.250425,.27429,.533103],[.248629,.278775,.534556],[.246811,.283237,.535941],[.244972,.287675,.53726],[.243113,.292092,.538516],[.241237,.296485,.539709],[.239346,.300855,.540844],[.237441,.305202,.541921],[.235526,.309527,.542944],[.233603,.313828,.543914],[.231674,.318106,.544834],[.229739,.322361,.545706],[.227802,.326594,.546532],[.225863,.330805,.547314],[.223925,.334994,.548053],[.221989,.339161,.548752],[.220057,.343307,.549413],[.21813,.347432,.550038],[.21621,.351535,.550627],[.214298,.355619,.551184],[.212395,.359683,.55171],[.210503,.363727,.552206],[.208623,.367752,.552675],[.206756,.371758,.553117],[.204903,.375746,.553533],[.203063,.379716,.553925],[.201239,.38367,.554294],[.19943,.387607,.554642],[.197636,.391528,.554969],[.19586,.395433,.555276],[.1941,.399323,.555565],[.192357,.403199,.555836],[.190631,.407061,.556089],[.188923,.41091,.556326],[.187231,.414746,.556547],[.185556,.41857,.556753],[.183898,.422383,.556944],[.182256,.426184,.55712],[.180629,.429975,.557282],[.179019,.433756,.55743],[.177423,.437527,.557565],[.175841,.44129,.557685],[.174274,.445044,.557792],[.172719,.448791,.557885],[.171176,.45253,.557965],[.169646,.456262,.55803],[.168126,.459988,.558082],[.166617,.463708,.558119],[.165117,.467423,.558141],[.163625,.471133,.558148],[.162142,.474838,.55814],[.160665,.47854,.558115],[.159194,.482237,.558073],[.157729,.485932,.558013],[.15627,.489624,.557936],[.154815,.493313,.55784],[.153364,.497,.557724],[.151918,.500685,.557587],[.150476,.504369,.55743],[.149039,.508051,.55725],[.147607,.511733,.557049],[.14618,.515413,.556823],[.144759,.519093,.556572],[.143343,.522773,.556295],[.141935,.526453,.555991],[.140536,.530132,.555659],[.139147,.533812,.555298],[.13777,.537492,.554906],[.136408,.541173,.554483],[.135066,.544853,.554029],[.133743,.548535,.553541],[.132444,.552216,.553018],[.131172,.555899,.552459],[.129933,.559582,.551864],[.128729,.563265,.551229],[.127568,.566949,.550556],[.126453,.570633,.549841],[.125394,.574318,.549086],[.124395,.578002,.548287],[.123463,.581687,.547445],[.122606,.585371,.546557],[.121831,.589055,.545623],[.121148,.592739,.544641],[.120565,.596422,.543611],[.120092,.600104,.54253],[.119738,.603785,.5414],[.119512,.607464,.540218],[.119423,.611141,.538982],[.119483,.614817,.537692],[.119699,.61849,.536347],[.120081,.622161,.534946],[.120638,.625828,.533488],[.12138,.629492,.531973],[.122312,.633153,.530398],[.123444,.636809,.528763],[.12478,.640461,.527068],[.126326,.644107,.525311],[.128087,.647749,.523491],[.130067,.651384,.521608],[.132268,.655014,.519661],[.134692,.658636,.517649],[.137339,.662252,.515571],[.14021,.665859,.513427],[.143303,.669459,.511215],[.146616,.67305,.508936],[.150148,.676631,.506589],[.153894,.680203,.504172],[.157851,.683765,.501686],[.162016,.687316,.499129],[.166383,.690856,.496502],[.170948,.694384,.493803],[.175707,.6979,.491033],[.180653,.701402,.488189],[.185783,.704891,.485273],[.19109,.708366,.482284],[.196571,.711827,.479221],[.202219,.715272,.476084],[.20803,.718701,.472873],[.214,.722114,.469588],[.220124,.725509,.466226],[.226397,.728888,.462789],[.232815,.732247,.459277],[.239374,.735588,.455688],[.24607,.73891,.452024],[.252899,.742211,.448284],[.259857,.745492,.444467],[.266941,.748751,.440573],[.274149,.751988,.436601],[.281477,.755203,.432552],[.288921,.758394,.428426],[.296479,.761561,.424223],[.304148,.764704,.419943],[.311925,.767822,.415586],[.319809,.770914,.411152],[.327796,.77398,.40664],[.335885,.777018,.402049],[.344074,.780029,.397381],[.35236,.783011,.392636],[.360741,.785964,.387814],[.369214,.788888,.382914],[.377779,.791781,.377939],[.386433,.794644,.372886],[.395174,.797475,.367757],[.404001,.800275,.362552],[.412913,.803041,.357269],[.421908,.805774,.35191],[.430983,.808473,.346476],[.440137,.811138,.340967],[.449368,.813768,.335384],[.458674,.816363,.329727],[.468053,.818921,.323998],[.477504,.821444,.318195],[.487026,.823929,.312321],[.496615,.826376,.306377],[.506271,.828786,.300362],[.515992,.831158,.294279],[.525776,.833491,.288127],[.535621,.835785,.281908],[.545524,.838039,.275626],[.555484,.840254,.269281],[.565498,.84243,.262877],[.575563,.844566,.256415],[.585678,.846661,.249897],[.595839,.848717,.243329],[.606045,.850733,.236712],[.616293,.852709,.230052],[.626579,.854645,.223353],[.636902,.856542,.21662],[.647257,.8584,.209861],[.657642,.860219,.203082],[.668054,.861999,.196293],[.678489,.863742,.189503],[.688944,.865448,.182725],[.699415,.867117,.175971],[.709898,.868751,.169257],[.720391,.87035,.162603],[.730889,.871916,.156029],[.741388,.873449,.149561],[.751884,.874951,.143228],[.762373,.876424,.137064],[.772852,.877868,.131109],[.783315,.879285,.125405],[.79376,.880678,.120005],[.804182,.882046,.114965],[.814576,.883393,.110347],[.82494,.88472,.106217],[.83527,.886029,.102646],[.845561,.887322,.099702],[.85581,.888601,.097452],[.866013,.889868,.095953],[.876168,.891125,.09525],[.886271,.892374,.095374],[.89632,.893616,.096335],[.906311,.894855,.098125],[.916242,.896091,.100717],[.926106,.89733,.104071],[.935904,.89857,.108131],[.945636,.899815,.112838],[.9553,.901065,.118128],[.964894,.902323,.123941],[.974417,.90359,.130215],[.983868,.904867,.136897],[.993248,.906157,.143936]])),e.checkNew(new e.Colormap("magma",[[.001462,466e-6,.013866],[.002258,.001295,.018331],[.003279,.002305,.023708],[.004512,.00349,.029965],[.00595,.004843,.03713],[.007588,.006356,.044973],[.009426,.008022,.052844],[.011465,.009828,.06075],[.013708,.011771,.068667],[.016156,.01384,.076603],[.018815,.016026,.084584],[.021692,.01832,.09261],[.024792,.020715,.100676],[.028123,.023201,.108787],[.031696,.025765,.116965],[.03552,.028397,.125209],[.039608,.03109,.133515],[.04383,.03383,.141886],[.048062,.036607,.150327],[.05232,.039407,.158841],[.056615,.04216,.167446],[.060949,.044794,.176129],[.06533,.047318,.184892],[.069764,.049726,.193735],[.074257,.052017,.20266],[.078815,.054184,.211667],[.083446,.056225,.220755],[.088155,.058133,.229922],[.092949,.059904,.239164],[.097833,.061531,.248477],[.102815,.06301,.257854],[.107899,.064335,.267289],[.113094,.065492,.276784],[.118405,.066479,.286321],[.123833,.067295,.295879],[.12938,.067935,.305443],[.135053,.068391,.315],[.140858,.068654,.324538],[.146785,.068738,.334011],[.152839,.068637,.343404],[.159018,.068354,.352688],[.165308,.067911,.361816],[.171713,.067305,.370771],[.178212,.066576,.379497],[.184801,.065732,.387973],[.19146,.064818,.396152],[.198177,.063862,.404009],[.204935,.062907,.411514],[.211718,.061992,.418647],[.218512,.061158,.425392],[.225302,.060445,.431742],[.232077,.059889,.437695],[.238826,.059517,.443256],[.245543,.059352,.448436],[.25222,.059415,.453248],[.258857,.059706,.45771],[.265447,.060237,.46184],[.271994,.060994,.46566],[.278493,.061978,.46919],[.284951,.063168,.472451],[.291366,.064553,.475462],[.29774,.066117,.478243],[.304081,.067835,.480812],[.310382,.069702,.483186],[.316654,.07169,.48538],[.322899,.073782,.487408],[.329114,.075972,.489287],[.335308,.078236,.491024],[.341482,.080564,.492631],[.347636,.082946,.494121],[.353773,.085373,.495501],[.359898,.087831,.496778],[.366012,.090314,.49796],[.372116,.092816,.499053],[.378211,.095332,.500067],[.384299,.097855,.501002],[.390384,.100379,.501864],[.396467,.102902,.502658],[.402548,.10542,.503386],[.408629,.10793,.504052],[.414709,.110431,.504662],[.420791,.11292,.505215],[.426877,.115395,.505714],[.432967,.117855,.50616],[.439062,.120298,.506555],[.445163,.122724,.506901],[.451271,.125132,.507198],[.457386,.127522,.507448],[.463508,.129893,.507652],[.46964,.132245,.507809],[.47578,.134577,.507921],[.481929,.136891,.507989],[.488088,.139186,.508011],[.494258,.141462,.507988],[.500438,.143719,.50792],[.506629,.145958,.507806],[.512831,.148179,.507648],[.519045,.150383,.507443],[.52527,.152569,.507192],[.531507,.154739,.506895],[.537755,.156894,.506551],[.544015,.159033,.506159],[.550287,.161158,.505719],[.556571,.163269,.50523],[.562866,.165368,.504692],[.569172,.167454,.504105],[.57549,.16953,.503466],[.581819,.171596,.502777],[.588158,.173652,.502035],[.594508,.175701,.501241],[.600868,.177743,.500394],[.607238,.179779,.499492],[.613617,.181811,.498536],[.620005,.18384,.497524],[.626401,.185867,.496456],[.632805,.187893,.495332],[.639216,.189921,.49415],[.645633,.191952,.49291],[.652056,.193986,.491611],[.658483,.196027,.490253],[.664915,.198075,.488836],[.671349,.200133,.487358],[.677786,.202203,.485819],[.684224,.204286,.484219],[.690661,.206384,.482558],[.697098,.208501,.480835],[.703532,.210638,.479049],[.709962,.212797,.477201],[.716387,.214982,.47529],[.722805,.217194,.473316],[.729216,.219437,.471279],[.735616,.221713,.46918],[.742004,.224025,.467018],[.748378,.226377,.464794],[.754737,.228772,.462509],[.761077,.231214,.460162],[.767398,.233705,.457755],[.773695,.236249,.455289],[.779968,.238851,.452765],[.786212,.241514,.450184],[.792427,.244242,.447543],[.798608,.24704,.444848],[.804752,.249911,.442102],[.810855,.252861,.439305],[.816914,.255895,.436461],[.822926,.259016,.433573],[.828886,.262229,.430644],[.834791,.26554,.427671],[.840636,.268953,.424666],[.846416,.272473,.421631],[.852126,.276106,.418573],[.857763,.279857,.415496],[.86332,.283729,.412403],[.868793,.287728,.409303],[.874176,.291859,.406205],[.879464,.296125,.403118],[.884651,.30053,.400047],[.889731,.305079,.397002],[.8947,.309773,.393995],[.899552,.314616,.391037],[.904281,.31961,.388137],[.908884,.324755,.385308],[.913354,.330052,.382563],[.917689,.3355,.379915],[.921884,.341098,.377376],[.925937,.346844,.374959],[.929845,.352734,.372677],[.933606,.358764,.370541],[.937221,.364929,.368567],[.940687,.371224,.366762],[.944006,.377643,.365136],[.94718,.384178,.363701],[.95021,.39082,.362468],[.953099,.397563,.361438],[.955849,.4044,.360619],[.958464,.411324,.360014],[.960949,.418323,.35963],[.96331,.42539,.359469],[.965549,.432519,.359529],[.967671,.439703,.35981],[.96968,.446936,.360311],[.971582,.45421,.36103],[.973381,.46152,.361965],[.975082,.468861,.363111],[.97669,.476226,.364466],[.97821,.483612,.366025],[.979645,.491014,.367783],[.981,.498428,.369734],[.982279,.505851,.371874],[.983485,.51328,.374198],[.984622,.520713,.376698],[.985693,.528148,.379371],[.9867,.535582,.38221],[.987646,.543015,.38521],[.988533,.550446,.388365],[.989363,.557873,.391671],[.990138,.565296,.395122],[.990871,.572706,.398714],[.991558,.580107,.402441],[.992196,.587502,.406299],[.992785,.594891,.410283],[.993326,.602275,.41439],[.993834,.609644,.418613],[.994309,.616999,.42295],[.994738,.62435,.427397],[.995122,.631696,.431951],[.99548,.639027,.436607],[.99581,.646344,.441361],[.996096,.653659,.446213],[.996341,.660969,.45116],[.99658,.668256,.456192],[.996775,.675541,.461314],[.996925,.682828,.466526],[.997077,.690088,.471811],[.997186,.697349,.477182],[.997254,.704611,.482635],[.997325,.711848,.488154],[.997351,.719089,.493755],[.997351,.726324,.499428],[.997341,.733545,.505167],[.997285,.740772,.510983],[.997228,.747981,.516859],[.997138,.75519,.522806],[.997019,.762398,.528821],[.996898,.769591,.534892],[.996727,.776795,.541039],[.996571,.783977,.547233],[.996369,.791167,.553499],[.996162,.798348,.55982],[.995932,.805527,.566202],[.99568,.812706,.572645],[.995424,.819875,.57914],[.995131,.827052,.585701],[.994851,.834213,.592307],[.994524,.841387,.598983],[.994222,.84854,.605696],[.993866,.855711,.612482],[.993545,.862859,.619299],[.99317,.870024,.626189],[.992831,.877168,.633109],[.99244,.88433,.640099],[.992089,.89147,.647116],[.991688,.898627,.654202],[.991332,.905763,.661309],[.99093,.912915,.668481],[.99057,.920049,.675675],[.990175,.927196,.682926],[.989815,.934329,.690198],[.989434,.94147,.697519],[.989077,.948604,.704863],[.988717,.955742,.712242],[.988367,.962878,.719649],[.988033,.970012,.727077],[.987691,.977154,.734536],[.987387,.984288,.742002],[.987053,.991438,.749504]])),e.checkNew(new e.Colormap("inferno",[[.001462,466e-6,.013866],[.002267,.00127,.01857],[.003299,.002249,.024239],[.004547,.003392,.030909],[.006006,.004692,.038558],[.007676,.006136,.046836],[.009561,.007713,.055143],[.011663,.009417,.06346],[.013995,.011225,.071862],[.016561,.013136,.080282],[.019373,.015133,.088767],[.022447,.017199,.097327],[.025793,.019331,.10593],[.029432,.021503,.114621],[.033385,.023702,.123397],[.037668,.025921,.132232],[.042253,.028139,.141141],[.046915,.030324,.150164],[.051644,.032474,.159254],[.056449,.034569,.168414],[.06134,.03659,.177642],[.066331,.038504,.186962],[.071429,.040294,.196354],[.076637,.041905,.205799],[.081962,.043328,.215289],[.087411,.044556,.224813],[.09299,.045583,.234358],[.098702,.046402,.243904],[.104551,.047008,.25343],[.110536,.047399,.262912],[.116656,.047574,.272321],[.122908,.047536,.281624],[.129285,.047293,.290788],[.135778,.046856,.299776],[.142378,.046242,.308553],[.149073,.045468,.317085],[.15585,.044559,.325338],[.162689,.043554,.333277],[.169575,.042489,.340874],[.176493,.041402,.348111],[.183429,.040329,.354971],[.190367,.039309,.361447],[.197297,.0384,.367535],[.204209,.037632,.373238],[.211095,.03703,.378563],[.217949,.036615,.383522],[.224763,.036405,.388129],[.231538,.036405,.3924],[.238273,.036621,.396353],[.244967,.037055,.400007],[.25162,.037705,.403378],[.258234,.038571,.406485],[.26481,.039647,.409345],[.271347,.040922,.411976],[.27785,.042353,.414392],[.284321,.043933,.416608],[.290763,.045644,.418637],[.297178,.04747,.420491],[.303568,.049396,.422182],[.309935,.051407,.423721],[.316282,.05349,.425116],[.32261,.055634,.426377],[.328921,.057827,.427511],[.335217,.06006,.428524],[.3415,.062325,.429425],[.347771,.064616,.430217],[.354032,.066925,.430906],[.360284,.069247,.431497],[.366529,.071579,.431994],[.372768,.073915,.4324],[.379001,.076253,.432719],[.385228,.078591,.432955],[.391453,.080927,.433109],[.397674,.083257,.433183],[.403894,.08558,.433179],[.410113,.087896,.433098],[.416331,.090203,.432943],[.422549,.092501,.432714],[.428768,.09479,.432412],[.434987,.097069,.432039],[.441207,.099338,.431594],[.447428,.101597,.43108],[.453651,.103848,.430498],[.459875,.106089,.429846],[.4661,.108322,.429125],[.472328,.110547,.428334],[.478558,.112764,.427475],[.484789,.114974,.426548],[.491022,.117179,.425552],[.497257,.119379,.424488],[.503493,.121575,.423356],[.50973,.123769,.422156],[.515967,.12596,.420887],[.522206,.12815,.419549],[.528444,.130341,.418142],[.534683,.132534,.416667],[.54092,.134729,.415123],[.547157,.136929,.413511],[.553392,.139134,.411829],[.559624,.141346,.410078],[.565854,.143567,.408258],[.572081,.145797,.406369],[.578304,.148039,.404411],[.584521,.150294,.402385],[.590734,.152563,.40029],[.59694,.154848,.398125],[.603139,.157151,.395891],[.60933,.159474,.393589],[.615513,.161817,.391219],[.621685,.164184,.388781],[.627847,.166575,.386276],[.633998,.168992,.383704],[.640135,.171438,.381065],[.64626,.173914,.378359],[.652369,.176421,.375586],[.658463,.178962,.372748],[.66454,.181539,.369846],[.670599,.184153,.366879],[.676638,.186807,.363849],[.682656,.189501,.360757],[.688653,.192239,.357603],[.694627,.195021,.354388],[.700576,.197851,.351113],[.7065,.200728,.347777],[.712396,.203656,.344383],[.718264,.206636,.340931],[.724103,.20967,.337424],[.729909,.212759,.333861],[.735683,.215906,.330245],[.741423,.219112,.326576],[.747127,.222378,.322856],[.752794,.225706,.319085],[.758422,.229097,.315266],[.76401,.232554,.311399],[.769556,.236077,.307485],[.775059,.239667,.303526],[.780517,.243327,.299523],[.785929,.247056,.295477],[.791293,.250856,.29139],[.796607,.254728,.287264],[.801871,.258674,.283099],[.807082,.262692,.278898],[.812239,.266786,.274661],[.817341,.270954,.27039],[.822386,.275197,.266085],[.827372,.279517,.26175],[.832299,.283913,.257383],[.837165,.288385,.252988],[.841969,.292933,.248564],[.846709,.297559,.244113],[.851384,.30226,.239636],[.855992,.307038,.235133],[.860533,.311892,.230606],[.865006,.316822,.226055],[.869409,.321827,.221482],[.873741,.326906,.216886],[.878001,.33206,.212268],[.882188,.337287,.207628],[.886302,.342586,.202968],[.890341,.347957,.198286],[.894305,.353399,.193584],[.898192,.358911,.18886],[.902003,.364492,.184116],[.905735,.37014,.17935],[.90939,.375856,.174563],[.912966,.381636,.169755],[.916462,.387481,.164924],[.919879,.393389,.16007],[.923215,.399359,.155193],[.92647,.405389,.150292],[.929644,.411479,.145367],[.932737,.417627,.140417],[.935747,.423831,.13544],[.938675,.430091,.130438],[.941521,.436405,.125409],[.944285,.442772,.120354],[.946965,.449191,.115272],[.949562,.45566,.110164],[.952075,.462178,.105031],[.954506,.468744,.099874],[.956852,.475356,.094695],[.959114,.482014,.089499],[.961293,.488716,.084289],[.963387,.495462,.079073],[.965397,.502249,.073859],[.967322,.509078,.068659],[.969163,.515946,.063488],[.970919,.522853,.058367],[.97259,.529798,.053324],[.974176,.53678,.048392],[.975677,.543798,.043618],[.977092,.55085,.03905],[.978422,.557937,.034931],[.979666,.565057,.031409],[.980824,.572209,.028508],[.981895,.579392,.02625],[.982881,.586606,.024661],[.983779,.593849,.02377],[.984591,.601122,.023606],[.985315,.608422,.024202],[.985952,.61575,.025592],[.986502,.623105,.027814],[.986964,.630485,.030908],[.987337,.63789,.034916],[.987622,.64532,.039886],[.987819,.652773,.045581],[.987926,.66025,.05175],[.987945,.667748,.058329],[.987874,.675267,.065257],[.987714,.682807,.072489],[.987464,.690366,.07999],[.987124,.697944,.087731],[.986694,.70554,.095694],[.986175,.713153,.103863],[.985566,.720782,.112229],[.984865,.728427,.120785],[.984075,.736087,.129527],[.983196,.743758,.138453],[.982228,.751442,.147565],[.981173,.759135,.156863],[.980032,.766837,.166353],[.978806,.774545,.176037],[.977497,.782258,.185923],[.976108,.789974,.196018],[.974638,.797692,.206332],[.973088,.805409,.216877],[.971468,.813122,.227658],[.969783,.820825,.238686],[.968041,.828515,.249972],[.966243,.836191,.261534],[.964394,.843848,.273391],[.962517,.851476,.285546],[.960626,.859069,.29801],[.95872,.866624,.31082],[.956834,.874129,.323974],[.954997,.881569,.337475],[.953215,.888942,.351369],[.951546,.896226,.365627],[.950018,.903409,.380271],[.948683,.910473,.395289],[.947594,.917399,.410665],[.946809,.924168,.426373],[.946392,.930761,.442367],[.946403,.937159,.458592],[.946903,.943348,.47497],[.947937,.949318,.491426],[.949545,.955063,.50786],[.95174,.960587,.524203],[.954529,.965896,.540361],[.957896,.971003,.556275],[.961812,.975924,.571925],[.966249,.980678,.587206],[.971162,.985282,.602154],[.976511,.989753,.61676],[.982257,.994109,.631017],[.988362,.998364,.644924]])),e.checkNew(new e.Colormap("plasma",[[.050383,.029803,.527975],[.063536,.028426,.533124],[.075353,.027206,.538007],[.086222,.026125,.542658],[.096379,.025165,.547103],[.10598,.024309,.551368],[.115124,.023556,.555468],[.123903,.022878,.559423],[.132381,.022258,.56325],[.140603,.021687,.566959],[.148607,.021154,.570562],[.156421,.020651,.574065],[.16407,.020171,.577478],[.171574,.019706,.580806],[.17895,.019252,.584054],[.186213,.018803,.587228],[.193374,.018354,.59033],[.200445,.017902,.593364],[.207435,.017442,.596333],[.21435,.016973,.599239],[.221197,.016497,.602083],[.227983,.016007,.604867],[.234715,.015502,.607592],[.241396,.014979,.610259],[.248032,.014439,.612868],[.254627,.013882,.615419],[.261183,.013308,.617911],[.267703,.012716,.620346],[.274191,.012109,.622722],[.280648,.011488,.625038],[.287076,.010855,.627295],[.293478,.010213,.62949],[.299855,.009561,.631624],[.30621,.008902,.633694],[.312543,.008239,.6357],[.318856,.007576,.63764],[.32515,.006915,.639512],[.331426,.006261,.641316],[.337683,.005618,.643049],[.343925,.004991,.64471],[.35015,.004382,.646298],[.356359,.003798,.64781],[.362553,.003243,.649245],[.368733,.002724,.650601],[.374897,.002245,.651876],[.381047,.001814,.653068],[.387183,.001434,.654177],[.393304,.001114,.655199],[.399411,859e-6,.656133],[.405503,678e-6,.656977],[.41158,577e-6,.65773],[.417642,564e-6,.65839],[.423689,646e-6,.658956],[.429719,831e-6,.659425],[.435734,.001127,.659797],[.441732,.00154,.660069],[.447714,.00208,.66024],[.453677,.002755,.66031],[.459623,.003574,.660277],[.46555,.004545,.660139],[.471457,.005678,.659897],[.477344,.00698,.659549],[.48321,.00846,.659095],[.489055,.010127,.658534],[.494877,.01199,.657865],[.500678,.014055,.657088],[.506454,.016333,.656202],[.512206,.018833,.655209],[.517933,.021563,.654109],[.523633,.024532,.652901],[.529306,.027747,.651586],[.534952,.031217,.650165],[.54057,.03495,.64864],[.546157,.038954,.64701],[.551715,.043136,.645277],[.557243,.047331,.643443],[.562738,.051545,.641509],[.568201,.055778,.639477],[.573632,.060028,.637349],[.579029,.064296,.635126],[.584391,.068579,.632812],[.589719,.072878,.630408],[.595011,.07719,.627917],[.600266,.081516,.625342],[.605485,.085854,.622686],[.610667,.090204,.619951],[.615812,.094564,.61714],[.620919,.098934,.614257],[.625987,.103312,.611305],[.631017,.107699,.608287],[.636008,.112092,.605205],[.640959,.116492,.602065],[.645872,.120898,.598867],[.650746,.125309,.595617],[.65558,.129725,.592317],[.660374,.134144,.588971],[.665129,.138566,.585582],[.669845,.142992,.582154],[.674522,.147419,.578688],[.67916,.151848,.575189],[.683758,.156278,.57166],[.688318,.160709,.568103],[.69284,.165141,.564522],[.697324,.169573,.560919],[.701769,.174005,.557296],[.706178,.178437,.553657],[.710549,.182868,.550004],[.714883,.187299,.546338],[.719181,.191729,.542663],[.723444,.196158,.538981],[.72767,.200586,.535293],[.731862,.205013,.531601],[.736019,.209439,.527908],[.740143,.213864,.524216],[.744232,.218288,.520524],[.748289,.222711,.516834],[.752312,.227133,.513149],[.756304,.231555,.509468],[.760264,.235976,.505794],[.764193,.240396,.502126],[.76809,.244817,.498465],[.771958,.249237,.494813],[.775796,.253658,.491171],[.779604,.258078,.487539],[.783383,.2625,.483918],[.787133,.266922,.480307],[.790855,.271345,.476706],[.794549,.27577,.473117],[.798216,.280197,.469538],[.801855,.284626,.465971],[.805467,.289057,.462415],[.809052,.293491,.45887],[.812612,.297928,.455338],[.816144,.302368,.451816],[.819651,.306812,.448306],[.823132,.311261,.444806],[.826588,.315714,.441316],[.830018,.320172,.437836],[.833422,.324635,.434366],[.836801,.329105,.430905],[.840155,.33358,.427455],[.843484,.338062,.424013],[.846788,.342551,.420579],[.850066,.347048,.417153],[.853319,.351553,.413734],[.856547,.356066,.410322],[.85975,.360588,.406917],[.862927,.365119,.403519],[.866078,.36966,.400126],[.869203,.374212,.396738],[.872303,.378774,.393355],[.875376,.383347,.389976],[.878423,.387932,.3866],[.881443,.392529,.383229],[.884436,.397139,.37986],[.887402,.401762,.376494],[.89034,.406398,.37313],[.89325,.411048,.369768],[.896131,.415712,.366407],[.898984,.420392,.363047],[.901807,.425087,.359688],[.904601,.429797,.356329],[.907365,.434524,.35297],[.910098,.439268,.34961],[.9128,.444029,.346251],[.915471,.448807,.34289],[.918109,.453603,.339529],[.920714,.458417,.336166],[.923287,.463251,.332801],[.925825,.468103,.329435],[.928329,.472975,.326067],[.930798,.477867,.322697],[.933232,.48278,.319325],[.93563,.487712,.315952],[.93799,.492667,.312575],[.940313,.497642,.309197],[.942598,.502639,.305816],[.944844,.507658,.302433],[.947051,.512699,.299049],[.949217,.517763,.295662],[.951344,.52285,.292275],[.953428,.52796,.288883],[.95547,.533093,.28549],[.957469,.53825,.282096],[.959424,.543431,.278701],[.961336,.548636,.275305],[.963203,.553865,.271909],[.965024,.559118,.268513],[.966798,.564396,.265118],[.968526,.5697,.261721],[.970205,.575028,.258325],[.971835,.580382,.254931],[.973416,.585761,.25154],[.974947,.591165,.248151],[.976428,.596595,.244767],[.977856,.602051,.241387],[.979233,.607532,.238013],[.980556,.613039,.234646],[.981826,.618572,.231287],[.983041,.624131,.227937],[.984199,.629718,.224595],[.985301,.63533,.221265],[.986345,.640969,.217948],[.987332,.646633,.214648],[.98826,.652325,.211364],[.989128,.658043,.2081],[.989935,.663787,.204859],[.990681,.669558,.201642],[.991365,.675355,.198453],[.991985,.681179,.195295],[.992541,.68703,.19217],[.993032,.692907,.189084],[.993456,.69881,.186041],[.993814,.704741,.183043],[.994103,.710698,.180097],[.994324,.716681,.177208],[.994474,.722691,.174381],[.994553,.728728,.171622],[.994561,.734791,.168938],[.994495,.74088,.166335],[.994355,.746995,.163821],[.994141,.753137,.161404],[.993851,.759304,.159092],[.993482,.765499,.156891],[.993033,.77172,.154808],[.992505,.777967,.152855],[.991897,.784239,.151042],[.991209,.790537,.149377],[.990439,.796859,.14787],[.989587,.803205,.146529],[.988648,.809579,.145357],[.987621,.815978,.144363],[.986509,.822401,.143557],[.985314,.828846,.142945],[.984031,.835315,.142528],[.982653,.841812,.142303],[.98119,.848329,.142279],[.979644,.854866,.142453],[.977995,.861432,.142808],[.976265,.868016,.143351],[.974443,.874622,.144061],[.97253,.88125,.144923],[.970533,.887896,.145919],[.968443,.894564,.147014],[.966271,.901249,.14818],[.964021,.90795,.14937],[.961681,.914672,.15052],[.959276,.921407,.151566],[.956808,.928152,.152409],[.954287,.934908,.152921],[.951726,.941671,.152925],[.949151,.948435,.152178],[.946602,.95519,.150328],[.944152,.961916,.146861],[.941896,.96859,.140956],[.940015,.975158,.131326]])),e.checkNew(new e.Colormap("i8",[[0,0,0],[0,1,0],[0,0,1],[0,1,1],[1,0,0],[1,1,0],[1,0,1],[1,1,1]])),e.checkNew(new e.Colormap("aips0",[[.196,.196,.196],[.475,0,.608],[0,0,.785],[.373,.655,.925],[0,.596,0],[0,.965,0],[1,1,0],[1,.694,0],[1,0,0]])),e.checkNew(new e.Colormap("sls",[[0,0,0],[.043442,0,.052883],[.086883,0,.105767],[.130325,0,.15865],[.173767,0,.211533],[.217208,0,.264417],[.26065,0,.3173],[.304092,0,.370183],[.347533,0,.423067],[.390975,0,.47595],[.434417,0,.528833],[.477858,0,.581717],[.5213,0,.6346],[.506742,0,.640217],[.492183,0,.645833],[.477625,0,.65145],[.463067,0,.657067],[.448508,0,.662683],[.43395,0,.6683],[.419392,0,.673917],[.404833,0,.679533],[.390275,0,.68515],[.375717,0,.690767],[.361158,0,.696383],[.3466,0,.702],[.317717,0,.712192],[.288833,0,.722383],[.25995,0,.732575],[.231067,0,.742767],[.202183,0,.752958],[.1733,0,.76315],[.144417,0,.773342],[.115533,0,.783533],[.08665,0,.793725],[.057767,0,.803917],[.028883,0,.814108],[0,0,.8243],[0,.019817,.838942],[0,.039633,.853583],[0,.05945,.868225],[0,.079267,.882867],[0,.099083,.897508],[0,.1189,.91215],[0,.138717,.926792],[0,.158533,.941433],[0,.17835,.956075],[0,.198167,.970717],[0,.217983,.985358],[0,.2378,1],[0,.268533,1],[0,.299267,1],[0,.33,1],[0,.360733,1],[0,.391467,1],[0,.4222,1],[0,.452933,1],[0,.483667,1],[0,.5144,1],[0,.545133,1],[0,.575867,1],[0,.6066,1],[0,.631733,.9753],[0,.656867,.9506],[0,.682,.9259],[0,.707133,.9012],[0,.732267,.8765],[0,.7574,.8518],[0,.782533,.8271],[0,.807667,.8024],[0,.8328,.7777],[0,.857933,.753],[0,.883067,.7283],[0,.9082,.7036],[0,.901908,.676675],[0,.895617,.64975],[0,.889325,.622825],[0,.883033,.5959],[0,.876742,.568975],[0,.87045,.54205],[0,.864158,.515125],[0,.857867,.4882],[0,.851575,.461275],[0,.845283,.43435],[0,.838992,.407425],[0,.8327,.3805],[0,.832308,.354858],[0,.831917,.329217],[0,.831525,.303575],[0,.831133,.277933],[0,.830742,.252292],[0,.83035,.22665],[0,.829958,.201008],[0,.829567,.175367],[0,.829175,.149725],[0,.828783,.124083],[0,.828392,.098442],[0,.828,.0728],[.033167,.834167,.066733],[.066333,.840333,.060667],[.0995,.8465,.0546],[.132667,.852667,.048533],[.165833,.858833,.042467],[.199,.865,.0364],[.232167,.871167,.030333],[.265333,.877333,.024267],[.2985,.8835,.0182],[.331667,.889667,.012133],[.364833,.895833,.006067],[.398,.902,0],[.43095,.902,0],[.4639,.902,0],[.49685,.902,0],[.5298,.902,0],[.56275,.902,0],[.5957,.902,0],[.62865,.902,0],[.6616,.902,0],[.69455,.902,0],[.7275,.902,0],[.76045,.902,0],[.7934,.902,0],[.810617,.897133,.003983],[.827833,.892267,.007967],[.84505,.8874,.01195],[.862267,.882533,.015933],[.879483,.877667,.019917],[.8967,.8728,.0239],[.913917,.867933,.027883],[.931133,.863067,.031867],[.94835,.8582,.03585],[.965567,.853333,.039833],[.982783,.848467,.043817],[1,.8436,.0478],[.995725,.824892,.0516],[.99145,.806183,.0554],[.987175,.787475,.0592],[.9829,.768767,.063],[.978625,.750058,.0668],[.97435,.73135,.0706],[.970075,.712642,.0744],[.9658,.693933,.0782],[.961525,.675225,.082],[.95725,.656517,.0858],[.952975,.637808,.0896],[.9487,.6191,.0934],[.952975,.600408,.085617],[.95725,.581717,.077833],[.961525,.563025,.07005],[.9658,.544333,.062267],[.970075,.525642,.054483],[.97435,.50695,.0467],[.978625,.488258,.038917],[.9829,.469567,.031133],[.987175,.450875,.02335],[.99145,.432183,.015567],[.995725,.413492,.007783],[1,.3948,0],[.998342,.3619,0],[.996683,.329,0],[.995025,.2961,0],[.993367,.2632,0],[.991708,.2303,0],[.99005,.1974,0],[.988392,.1645,0],[.986733,.1316,0],[.985075,.0987,0],[.983417,.0658,0],[.981758,.0329,0],[.9801,0,0],[.955925,0,0],[.93175,0,0],[.907575,0,0],[.8834,0,0],[.859225,0,0],[.83505,0,0],[.810875,0,0],[.7867,0,0],[.762525,0,0],[.73835,0,0],[.714175,0,0],[.69,0,0],[.715833,.083333,.083333],[.741667,.166667,.166667],[.7675,.25,.25],[.793333,.333333,.333333],[.819167,.416667,.416667],[.845,.5,.5],[.870833,.583333,.583333],[.896667,.666667,.666667],[.9225,.75,.75],[.948333,.833333,.833333],[.974167,.916667,.916667],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1]])),e.checkNew(new e.Colormap("a",[[0,0],[.25,0],[.5,1],[1,1]],[[0,0],[.25,1],[.5,0],[.77,0],[1,1]],[[0,0],[.125,0],[.5,1],[.64,.5],[.77,0],[1,0]])),e.checkNew(new e.Colormap("b",[[0,0],[.25,0],[.5,1],[1,1]],[[0,0],[.5,0],[.75,1],[1,1]],[[0,0],[.25,1],[.5,0],[.75,0],[1,1]])),e.checkNew(new e.Colormap("bb",[[0,0],[.5,1],[1,1]],[[0,0],[.25,0],[.75,1],[1,1]],[[0,0],[.5,0],[1,1]])),e.checkNew(new e.Colormap("he",[[0,0],[.015,.5],[.25,.5],[.5,.75],[1,1]],[[0,0],[.065,0],[.125,.5],[.25,.75],[.5,.81],[1,1]],[[0,0],[.015,.125],[.03,.375],[.065,.625],[.25,.25],[1,1]])),e.checkNew(new e.Colormap("hsv",(()=>{let t,s,o,n,a,l,c,d,h,p,g=0;const r=[];for(t=0;t<200;t++,g++){for(s=1-t/199,o=360*s+270,n=Math.abs(Math.sin(3.1416*s)),a=Math.pow(1-s,1/3);o>=360;)o-=360;switch(o/=60,p=Math.floor(o),l=o-p,c=a*(1-n),d=a*(1-n*l),h=a*(1-n*(1-l)),r[g]=[],p){case 0:r[g].push(a),r[g].push(h),r[g].push(c);break;case 1:r[g].push(d),r[g].push(a),r[g].push(c);break;case 2:r[g].push(c),r[g].push(a),r[g].push(h);break;case 3:r[g].push(c),r[g].push(d),r[g].push(a);break;case 4:r[g].push(h),r[g].push(c),r[g].push(a);break;case 5:r[g].push(a),r[g].push(c),r[g].push(d)}}return r})())),e.checkNew(new e.Colormap("rainbow",[[0,1],[.2,0],[.6,0],[.8,1],[1,1]],[[0,0],[.2,0],[.4,1],[.8,1],[1,0]],[[0,1],[.4,1],[.6,0],[1,0]])),e.checkNew(new e.Colormap("standard",[[0,0],[.333,.3],[.333,0],[.666,.3],[.666,.3],[1,1]],[[0,0],[.333,.3],[.333,.3],[.666,1],[.666,0],[1,.3]],[[0,0],[.333,1],[.333,0],[.666,.3],[.666,0],[1,.3]])),e.checkNew(new e.Colormap("staircase",(()=>{let t,s,o=0;const n=[];for(t=1;t<=5;t++,o++)s=t/5,n[o]=[],n[o].push(.3*s),n[o].push(.3*s),n[o].push(s);for(t=1;t<=5;t++,o++)s=t/5,n[o]=[],n[o].push(.3*s),n[o].push(s),n[o].push(.3*s);for(t=1;t<=5;t++,o++)s=t/5,n[o]=[],n[o].push(s),n[o].push(.3*s),n[o].push(.3*s);return n})())),e.checkNew(new e.Colormap("color",[[0,0,0],[.18431,.18431,.18431],[.37255,.37255,.37255],[.56078,.56078,.56078],[.74902,.74902,.74902],[.93725,.93725,.93725],[0,.18431,.93725],[0,.37255,.74902],[0,.49804,.49804],[0,.74902,.3098],[0,.93725,0],[.3098,.62353,0],[.49804,.49804,0],[.62353,.3098,0],[.93725,0,0],[.74902,0,.3098]])))},e.initCommands=function(){!{}.hasOwnProperty.call(e,"Command")||(e.checkNew(new e.Command({name:"analysis",alias:"run",help:"list/run analysis for current image",get(){let t,s,o,n,a,l="";const c=this.image;if(c&&c.analysisPackages)for(s=0;s<c.analysisPackages.length;s++){for(a=c.analysisPackages[s],t=0;t<a.length;t++)n=a[t],l&&(l+=", "),o=n.xclass?`${n.xclass}:${n.name}`:n.name,l+=`${n.title} (${o})`;s<c.analysisPackages.length-1&&(l+="\n")}return l},set(t){let s,o;const n=this.image;!n||(s=n.lookupAnalysis(t[0]),s?s.purl?(o=n.displayAnalysis("params",e.InstallDir(s.purl),{title:`${s.title}: ${n.fitsFile}`}),$(o).data("dispid",n.display.id).data("aname",s.name)):n.runAnalysis(s.name):e.error(`unknown analysis command '${t[0]}'`))}})),e.checkNew(new e.Command({name:"colormap",alias:"cmap",help:"set/get colormap for current image",get(){let t;const s=this.image;if(s)return t=s.getColormap(),`${t.colormap} ${t.contrast} ${t.bias}`},set(t){const s=this.image;s&&s.setColormap(...t)}})),e.checkNew(new e.Command({name:"colormaps",alias:"cmaps",help:"get list of available colormaps",get(){let t,s="";for(t=0;t<e.colormaps.length;t++)s&&(s+=", "),s+=e.colormaps[t].name;return s}})),e.checkNew(new e.Command({name:"global",help:"set/get a JS9.globalOpts parameter",set(t){let s,o;if(1==t.length){if(s=e.globalOpts[t[0]],e.notNull(s))switch(typeof s){case"boolean":return s?"true":"false";case"number":return String(s);case"string":return s;case"object":return JSON.stringify(s);default:return""}}else if(t.length>=2&&(o=t[0],s=t[1],"string"==typeof o&&"string"==typeof s))switch(typeof e.globalOpts[o]){case"boolean":e.globalOpts[o]=!!s.match(/true/i);break;case"number":e.globalOpts[o]=parseFloat(s);break;case"string":e.globalOpts[o]=s;break;case"object":try{s=JSON.parse(s)}catch{e.error(`invalid JSON for global cmd: ${s}`)}e.globalOpts[o]=s}}})),e.checkNew(new e.Command({name:"grid",help:"set/get coordinate grid for current image",get(){let t;const s=this.image;return s&&(t=s.displayCoordGrid()),t?"true":"false"},set(t){let s;const o=this.image;o&&(s=!!t[0].match(/true/i),o.displayCoordGrid(s,t[1]))}})),e.checkNew(new e.Command({name:"help",help:"get list of available commands",get(){let t,s,d="<table class='JS9CmdHelp'>";for(t=0;t<e.commands.length;t++)s=e.commands[t],d+=`<tr><td>${s.name}</td><td>${s.help}`,s.alias&&(d+=` (${s.alias}`,s.alias2&&(d+=`, ${s.alias2}`),d+=")"),d+="</td></tr>";return d+='<tr><td colspan="2">&nbsp;</td></tr>',d+='<tr><td colspan="2">Or execute JS9 public access routines (use spaceless args, please):</td></tr>',d+='<tr><td colspan="2">&nbsp;</td></tr>',d+='<tr><td colspan="2">SetColormap heat</td></tr>',d+='<tr><td colspan="2">GetColormap</td></tr>',d+='<tr><td colspan="2">{"colormap":"heat","contrast":3.75,"bias":0.736328125}</td></tr>',d+='<tr><td colspan="2">AddRegions circle(23:23:27.9,+58:48:42.8,3") {"color":"cyan"}</td></tr>',d+="</table>",d}})),e.checkNew(new e.Command({name:"helper",help:"set/get helper connection",get:()=>e.helper.connectinfo(),set(t){e.helper.connect(t[0].trim())}})),e.checkNew(new e.Command({name:"image",help:"get name of current image or display specified image",get(){const t=this.image;if(t)return t.file},set(t){let s,o;for(s=0;s<e.images.length;s++)if(o=e.images[s],o.file.search(t[0])>=0&&o.display===this.display)return void o.displayImage("display")}})),e.checkNew(new e.Command({name:"images",help:"get list of currently loaded images",get(){let t,s,o="";for(t=0;t<e.images.length;t++)s=e.images[t],s.display===this.display&&(o&&(o+=", "),o+=s.file);return o}})),e.checkNew(new e.Command({name:"load",help:"load image(s)",set(t){let s,o,n;const a=t.length;for(s=0;s<a;s++){if(n=null,o=s+1,o<a&&t[o].startsWith("{"))try{n=JSON.parse(t[o])}catch{n=null}n?(e.Load(t[s],n,{display:this.display.id}),s++):e.Load(t[s],{display:this.display.id})}}})),e.checkNew(new e.Command({name:"pan",help:"set/get pan location for current image",get(){let t;const s=this.image;if(s)return t=s.getPan(),`${t.x} ${t.x}`},set(t){const s=this.image;s&&s.setPan(...t)}})),e.checkNew(new e.Command({name:"pix2wcs",help:"get image pixel value for specified wcs position",set(t){let s;const o=this.image;if(o)return s=e.Pix2WCS(parseFloat(t[0]),parseFloat(t[1]),{display:o}),s.str}})),e.checkNew(new e.Command({name:"print",help:"print image window",get(){const t=this.image;t&&t.print()}})),e.checkNew(new e.Command({name:"refresh",help:"refresh image using specified file (def: use last file)",set(t){let s,o,n;const a=t.length,l=this.image;if(0===a)return n={refresh:l},void e.Load(l.file,n,{display:this.display.id});for(s=0;s<a;s++){if(n=null,o=s+1,o<a&&t[o].startsWith("{"))try{n=JSON.parse(t[o])}catch{n=null}n?(n.refresh=!0,e.Load(t[s],n,{display:this.display.id}),s++):(n={refresh:!0},e.Load(t[s],n,{display:this.display.id}))}}})),e.checkNew(new e.Command({name:"regcnts",help:"counts in regions for current image",get(){const t=this.image;t&&t.countsInRegions("$sregions","$bregions",{lightwin:!0})},set(t){const s=this.image;if(s)return s.countsInRegions(...t)}})),e.checkNew(new e.Command({name:"regions",alias:"reg",alias2:"region",help:"add or list region(s)",get(){const t=this.image;if(t)return t.listRegions("all",{mode:0})||""},set(t){let s;const o=this.image;o&&("delete"===t[0]||"remove"===t[0]?(s=t.slice(1).join(" "),o.removeShapes("regions",s)):(s=t.join(" "),o.addShapes("regions",s)))}})),e.checkNew(new e.Command({name:"resize",help:"set/get display size for current image",get(){let t;const s=this.image;if(s)return t=s.display,`${t.width} ${t.height}`},set(t){let s,o,n;const a=this.image;a&&t.length&&(s=a.display,o=parseInt(t[0],10),n=t.length>1?parseInt(t[1],10):o,s.resize(o,n))}})),e.checkNew(new e.Command({name:"scale",help:"set/get scaling for current image",get(){let t;const s=this.image;if(s)return t=s.getScale(),`${t.scale} ${t.scalemin} ${t.scalemax}`},set(t){const s=this.image;s&&s.setScale(...t)}})),e.checkNew(new e.Command({name:"scales",help:"get list of available scales",get:()=>e.scales.join(", ")})),e.checkNew(new e.Command({name:"section",help:"display section of current image",set(t){let s,o;const a=this.image;if(1===t.length&&"full"===t[0])a.displaySection("full");else if(s=t.join(" "),s){try{o=JSON.parse(s)}catch{e.error("invalid JSON section")}a.displaySection(o)}}})),e.checkNew(new e.Command({name:"status",help:"get status for specified (or current) image",get(t){let s,o,n,a,l,c="";for(s=0;s<e.images.length;s++)if(n=e.images[s],n.file.search(t[0])>=0){a=n;break}if(a?o=1:(o=0,a=this.image),a){if(o>t.length)return a.status.load;for(s=o;s<t.length;s++)"load"===(l=t[s].toLowerCase().trim(),l)&&(c&&(c+="\n"),c+=a.status.load)}return c}})),e.checkNew(new e.Command({name:"url",help:"display a url",set(t){e.DisplayHelp(t[0])}})),e.checkNew(new e.Command({name:"wcssys",help:"set/get wcs system for current image",get(){const t=this.image;if(t)return t.getWCSSys()},set(t){const s=this.image;s&&s.setWCSSys(t[0])}})),e.checkNew(new e.Command({name:"wcsu",help:"set/get wcs units used for current image",get(){const t=this.image;if(t)return t.getWCSUnits()},set(t){const s=this.image;s&&s.setWCSUnits(t[0])}})),e.checkNew(new e.Command({name:"wcssystems",help:"get list of available wcs systems",get:()=>e.wcssyss.join(", ")})),e.checkNew(new e.Command({name:"wcsunits",help:"get list of available wcs units",get:()=>e.wcsunitss.join(", ")})),e.checkNew(new e.Command({name:"wcs2pix",help:"get wcs position for specified image pixel",set(t){let s;const o=this.image;if(o)return s=e.WCS2Pix(parseFloat(t[0]),parseFloat(t[1]),{display:o}),s.str}})),e.checkNew(new e.Command({name:"zoom",help:"set/get zoom for current image",get(){const t=this.image;if(t)return t.getZoom()},set(t){const s=this.image;s&&s.setZoom(t[0])}})))},e.initAnalysis=function(){$(document).on("keypress",".js9AnalysisForm, .js9Form, .js9Input",t=>{let o,n;if(13===(t.which||t.keyCode)&&(o=$(t.currentTarget).data("enterfunc"),o))return t.preventDefault(),n=$(t.currentTarget).find(`[name='${o}']`),n.length?n.click():(n=$(t.currentTarget).siblings(`[name='${o}']`),n.length&&n.click()),!1})},e.parsePublicArgs=function(t){let s=null;const o=Array.from(t),n=o[o.length-1];return n&&"object"==typeof n&&{}.hasOwnProperty.call(n,"display")&&1===Object.keys(n).length&&(s=n.display,o.pop()),{argv:o,display:s}},e.mkPublic=function(t,s){"string"==typeof s?e.Image.prototype[s]?(e[t]=function(...o){let n;const{display:a,argv:l}=e.parsePublicArgs(o),c=e.getImage(a);if(c)return n=c[s](...l),n===c||n===c.display?e.globalOpts.quietReturn?"":"OK":n},e.publics[t]=e[t]):e.error(`unknown image func for mkPublic: ${s}`):"function"==typeof s?(e[t]=s,e.publics[t]=e[t]):e.error("unsupported type for mkPublic: "+typeof s)},e.mkPublic("CloseImage","closeImage"),e.mkPublic("DisplayImage","displayImage"),e.mkPublic("DisplayExtension","displayExtension"),e.mkPublic("DisplaySlice","displaySlice"),e.mkPublic("DisplaySection","displaySection"),e.mkPublic("BlendImage","blendImage"),e.mkPublic("MaskImage","maskImage"),e.mkPublic("GetColormap","getColormap"),e.mkPublic("SetColormap","setColormap"),e.mkPublic("GetZoom","getZoom"),e.mkPublic("SetZoom","setZoom"),e.mkPublic("GetPan","getPan"),e.mkPublic("SetPan","setPan"),e.mkPublic("AlignPanZoom","alignPanZoom"),e.mkPublic("GetScale","getScale"),e.mkPublic("SetScale","setScale"),e.mkPublic("GetOpacity","getOpacity"),e.mkPublic("SetOpacity","setOpacity"),e.mkPublic("SetFlip","setFlip"),e.mkPublic("GetFlip","getFlip"),e.mkPublic("SetRotate","setRotate"),e.mkPublic("GetRotate","getRotate"),e.mkPublic("SetRot90","setRot90"),e.mkPublic("GetRot90","getRot90"),e.mkPublic("GetParam","getParam"),e.mkPublic("SetParam","setParam"),e.mkPublic("CopyParams","copyParams"),e.mkPublic("GetValPos","updateValpos"),e.mkPublic("ImageToDisplayPos","imageToDisplayPos"),e.mkPublic("DisplayToImagePos","displayToImagePos"),e.mkPublic("ImageToLogicalPos","imageToLogicalPos"),e.mkPublic("LogicalToImagePos","logicalToImagePos"),e.mkPublic("GetWCSUnits","getWCSUnits"),e.mkPublic("SetWCSUnits","setWCSUnits"),e.mkPublic("GetWCS","getWCS"),e.mkPublic("SetWCS","setWCS"),e.mkPublic("GetWCSSys","getWCSSys"),e.mkPublic("SetWCSSys","setWCSSys"),e.mkPublic("ShowShapeLayer","showShapeLayer"),e.mkPublic("ActiveShapeLayer","activeShapeLayer"),e.mkPublic("ToggleShapeLayers","toggleShapeLayers"),e.mkPublic("AddShapes","addShapes"),e.mkPublic("RemoveShapes","removeShapes"),e.mkPublic("GetShapes","getShapes"),e.mkPublic("ChangeShapes","changeShapes"),e.mkPublic("CopyShapes","copyShapes"),e.mkPublic("SelectShapes","selectShapes"),e.mkPublic("UnselectShapes","unselectShapes"),e.mkPublic("GroupShapes","groupShapes"),e.mkPublic("UngroupShapes","ungroupShapes"),e.mkPublic("DisplayCoordGrid","displayCoordGrid"),e.mkPublic("Print","print"),e.mkPublic("SavePNG","savePNG"),e.mkPublic("SaveJPEG","saveJPEG"),e.mkPublic("SaveFITS","saveFITS"),e.mkPublic("UploadFITSFile","uploadFITSFile"),e.mkPublic("CountsInRegions","countsInRegions"),e.mkPublic("RadialProfile","radialProfile"),e.mkPublic("Plot3D","plot3d"),e.mkPublic("RunAnalysis","runAnalysis"),e.mkPublic("GetAnalysis","getAnalysis"),e.mkPublic("RawDataLayer","rawDataLayer"),e.mkPublic("GaussBlurData","gaussBlurData"),e.mkPublic("ImarithData","imarithData"),e.mkPublic("RotateData","rotateData"),e.mkPublic("ReprojectData","reprojectData"),e.mkPublic("ShiftData","shiftData"),e.mkPublic("FilterRGBImage","filterRGBImage"),e.mkPublic("MoveToDisplay","moveToDisplay"),e.mkPublic("LookupImage",function(...t){const s=e.parsePublicArgs(t);return e.lookupImage(s.argv[0],s.display)}),e.mkPublic("LookupDisplay",function(...t){const s=e.parsePublicArgs(t);return e.lookupDisplay(s.argv[0]||s.display,s.argv[1])}),e.mkPublic("DisplayNextImage",function(...t){let s,o;const n=e.parsePublicArgs(t);if(o=e.lookupDisplay(n.display),o)return s=parseFloat(n.argv[0])||1,o.nextImage(s)}),e.mkPublic("RenameDisplay",function(...t){let s,o,n;const a=e.parsePublicArgs(t);switch(a.argv.length){case 0:return;case 1:o=a.display,s=a.argv[0];break;default:o=a.argv[0],s=a.argv[1]}n=e.lookupDisplay(o),n&&n.id&&(o=n.id,n.oid||(n.oid=o),n.id=s,e.helper.send("renameDisplay",{odisplay:o,ndisplay:n.id}))}),e.mkPublic("CloseDisplay",function(...t){let s,o,n,a,l,c;const d=e.parsePublicArgs(t);if(a=e.lookupDisplay(d.argv[0],!1),a||(a=e.lookupDisplay(d.display),o=d.argv[0]),l=d.argv[1]||o,l)try{c=new RegExp(l)}catch{e.error(`invalid regexp for CloseDisplay: ${l}`)}for(s=e.images.length-1;s>=0;s--)n=e.images[s],n.display===a&&(c?(n.id.match(c)||n.file.match(c)||n.fitsFile.match(c))&&n.closeImage():n.closeImage())}),e.mkPublic("AddColormap",function(...t){let s,o,n,a,l,c,d;const h=e.parsePublicArgs(t),p=(g,v)=>{let r,u;for("object"!=typeof g&&e.error("invalid colormap object for JS9.AddColormap()"),$.isArray(g)||(g=[g]),r=0;r<g.length;r++)u=g[r],u.name||e.error("missing name for colormap in JS9.AddColormap()"),u.vertices?e.AddColormap(u.name,u.vertices[0],u.vertices[1],u.vertices[2],v):u.colors?e.AddColormap(u.name,u.colors,v):e.error("unknown colormap type for JS9.AddColormap()")};if(s=h.argv[0],o=h.argv[1],n=h.argv[2],a=h.argv[3],l=h.argv[4],s instanceof Blob)c=new FileReader,c.onload=g=>{try{d=JSON.parse(g.target.result)}catch(v){e.error("can't parse JSON colormap",v)}p(d,o)},c.readAsText(s);else if("object"==typeof s)p(s,o);else switch(h.argv.length){case 1:try{d=JSON.parse(s)}catch(g){e.error("can't parse JSON colormap",g)}p(d);break;case 2:case 3:if("string"==typeof o)try{o=JSON.parse(o)}catch(g){e.error("can't parse JSON colormap",g)}e.checkNew(new e.Colormap(s,o)),(2===h.argv.length||"object"!=typeof n||!1!==n.toplevel)&&e.globalOpts.topColormaps.push(s);break;case 4:case 5:if("string"==typeof o)try{o=JSON.parse(o)}catch(g){e.error("can't parse JSON colormap",g)}if("string"==typeof n)try{n=JSON.parse(n)}catch(g){e.error("can't parse JSON colormap",g)}if("string"==typeof a)try{a=JSON.parse(a)}catch(g){e.error("can't parse JSON colormap",g)}e.checkNew(new e.Colormap(s,o,n,a)),(4===h.argv.length||!l||"object"!=typeof l||!1!==l.toplevel)&&e.globalOpts.topColormaps.push(s);break;default:e.error("AddColormap() requires a colormap name and 1 or 3 args")}}),e.mkPublic("LoadColormap",function(...t){let s,o;const n=e.parsePublicArgs(t);s=n.argv[0],o=n.argv[1],s||e.error("JS9.LoadColormap: no file specified for colormap load"),"object"==typeof s?e.AddColormap(s,o):"string"==typeof s?(s=e.fixPath(s,o),e.fetchURL(null,s,null,a=>{e.AddColormap(a,o)})):e.error("unknown file type for LoadColormap: "+typeof s)}),e.mkPublic("SetRGBMode",function(...t){let s,o,n,a;const l=e.parsePublicArgs(t),c=e.lookupDisplay(l.display),d=["red","green","blue"],h=["rid","gid","bid"];if(n=l.argv[0],a=l.argv[1],void 0===n&&(n=!c.rgb.active),a)for(s=0;s<3;s++)o=a[h[s]],"string"==typeof o&&(o=e.LookupImage(o)),o&&o.setColormap(d[s]);return"true"===n?n=!0:"false"===n&&(n=!1),c.rgb.active=!!n,e.DisplayImage({display:l.display}),c.rgb.active}),e.mkPublic("GetRGBMode",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.display);return{active:o.rgb.active,rid:o.rgb.rim?o.rgb.rim.id:null,gid:o.rgb.gim?o.rgb.gim.id:null,bid:o.rgb.bim?o.rgb.bim.id:null}}),e.mkPublic("SetValPos",function(...t){let s,o=null;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],a&&(o=a.params.valpos,a.params.valpos=s),o}),e.mkPublic("SetImageInherit",function(...t){let s,o=null;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],a&&(o=a.params.inherit,a.params.inherit=s),o}),e.mkPublic("GetImageInherit",function(...t){let s=null;const o=e.parsePublicArgs(t),n=e.getImage(o.display);return n&&(s=n.params.inherit),s}),e.mkPublic("Load",function(...t){let s,o,n,a,l,c,d,h,p,g,v,r,u,f="fits";const m=e.parsePublicArgs(t);if(r=m.argv[0],u=m.argv[1],r||e.error("JS9.Load: no file specified for image load"),l=m.display?m.display:e.displays.length>0?e.displays[0].id:e.DEFID,u=u||{},"object"==typeof u)u=$.extend(!0,{},u);else if("string"==typeof u)try{u=JSON.parse(u)}catch{u={}}if(u.display=u.display||l,u.onload?c=u.onload:e.imageOpts.onload&&(c=e.imageOpts.onload,u.onload=c),delete e.fetchURL.status,r instanceof Blob){if(r.path||r.name)if(u.file=e.cleanPath(r.path||r.name),n="object"==typeof u.refresh?u.refresh:e.lookupImage(u.file,u.display),n){if(e.isNull(u.refresh)&&(u.refresh=e.globalOpts.reloadRefresh),!u.refresh){if(n.displayImage("display",u),n.refreshLayers(),n.display.clearMessage(),u.onload)try{e.xeqByName(u.onload,window,n)}catch(b){e.error("in image onload callback",b,!1)}return void e.waiting(!1)}u.refresh=n}else delete u.refresh;else delete u.refresh;switch(u.file||(u.file=e.ANON+e.uniqueID()),r.type&&r.type.includes("image/")?"image/fits"===r.type||(f="img"):u.file.split(".").pop().match(/(png|jpg|jpeg)/i)&&(f="img"),f){case"fits":p=$.extend(!0,{},e.fits.options,u),r.path&&u.localAccess&&(v=e.localAccess(r.path),v&&(r=r.path,p.file=r,p.vfile=v));try{e.handleFITSFile(r,p,e.NewFitsImage)}catch(b){e.error("can't process FITS file",b)}break;case"img":try{e.handleImageFile(r,u,e.Load)}catch(b){e.error("can't process IMG file",b)}}}else if("object"!=typeof r)if("string"!=typeof r&&e.error("unknown file type for Load: "+typeof r),"U0lNUExFICA9"===r.slice(0,12)&&(r=window.atob(r)),"SIMPLE  ="!==r.slice(0,9))if(e.isNull(u.refresh)&&(u.refresh=e.globalOpts.reloadRefresh),u.refresh?"object"==typeof u.refresh?n=u.refresh:(o=r.split("/").reverse()[0],n=e.lookupImage(o,u.display),n&&(u.refresh=n)):(o=r.split("/").reverse()[0],n=e.lookupImage(o,u.display)),!n||u.refresh)r=e.cleanPath(r),!e.fits2fits(u.display,r,u)&&(u.display&&(a=e.lookupDisplay(u.display)),e.waiting(!0,a),n&&u.refresh&&e.cleanupFITSFile(n.raw,!0),r=e.fixPath(r,u),g=r.replace(/\[.*\]/,""),v=e.localAccess(r),v?(p=$.extend(!0,{},e.fits.options,u),p.file=r,p.vfile=v,window.setTimeout(()=>{try{e.handleFITSFile(r,p,e.NewFitsImage)}catch(b){e.error("can't process FITS file",b)}},0)):e.fetchURL(r,g,u));else{if(n.displayImage("all",u),n.display.clearMessage(),u.onload)try{e.xeqByName(u.onload,window,n)}catch(b){e.error("in image onload callback",b,!1)}e.waiting(!1)}else{for(h=[],s=0;s<r.length;s++)h[s]=r.charCodeAt(s);d=new Blob([new Uint8Array(h)]),u.file||(u.file=e.ANON+e.uniqueID()),d.name=u.file,p=$.extend(!0,{},e.fits.options,u);try{e.handleFITSFile(d,p,e.NewFitsImage)}catch(b){e.error("can't process FITS file",b)}}else e.checkNew(new e.Image(r,u,c))}),e.mkPublic("LoadWindow",function(...t){let s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C;const I=e.lightOpts[e.LIGHTWIN],L=e.parsePublicArgs(t),D=R=>{const H=$.inArray(R,e.displays);H>=0&&e.displays.splice(H,1)},O=(R,H,N)=>{let B,P;return(H=H||{}).clone&&(P=e.lookupDisplay(H.clone,!1)),N&&(b=N.match(/(.*width=)([0-9]+)(px,height=)([0-9]+)(px.*)/,"$1@@H@@$3"),w=parseInt(b[2],10),A=parseInt(b[4],10)),B="<hr class='hline0'>",!P||$(`#${H.clone}Menubar`).length>0&&!P.pluginInstances.JS9Menubar.isDynamic?B+=`<div class='JS9Menubar' id='${R}Menubar'></div>`:N&&(A-=40),B+=`<div class='JS9' id='${R}'></div>`,!P||$(`#${H.clone}Colorbar`).length>0&&0===$(`#${H.clone}Statusbar`).length&&!P.pluginInstances.JS9Colorbar.isDynamic?(s=P&&P.pluginInstances.JS9Colorbar?`data-showTicks='${P.pluginInstances.JS9Colorbar.showTicks}'`:"",B+=`<div style='margin-top: 2px;'><div class='JS9Colorbar' id='${R}Colorbar' ${s}></div></div>`,P&&P.pluginInstances.JS9Colorbar&&!P.pluginInstances.JS9Colorbar.showTicks&&(A-=15)):N&&(A-=44),!P||$(`#${H.clone}Statusbar`).length>0&&!P.pluginInstances.JS9Statusbar.isDynamic?B+=`<div class='JS9Statusbar' id='${R}Statusbar'></div>`:N&&(A-=40),N?(e.Dysel.retrievePlugins().length&&(w+=2,A+=2),{html:B,winopts:b[1]+String(w)+b[3]+String(A)+b[5]}):B};if(x=L.argv[0],y=L.argv[1],S=L.argv[2],_=L.argv[3],C=L.argv[4],y=y||{},"object"==typeof y)y=$.extend(!0,{},y);else if("string"==typeof y)try{y=JSON.parse(y)}catch{y={}}switch(S=S||"light",f=`${S}win`,S){case"light":return y.id?(o=y.id,delete y.id):o=f+e.uniqueID(),a=`d${o}`,_?C=C||I.imageWin:(g=O(o,y,I.imageWin),_=g.html,C=C||g.winopts),m=sprintf(`JS9 Display${e.IDFMT}`,o),h=e.lightWin(a,"inline",_,m,C),n=((R,H)=>{let N;return N=new e.Display(o),N.winid=h,e.helper.send("addDisplay",{display:o}),e.instantiatePlugins(),H.display=o,R&&e.Load(R,H),N})(x,y),h.onclose=()=>(R=>{let H,N,B=0;const P=[];for(H=0;H<e.images.length;H++)N=e.images[H],N.display.id===o&&P.push(N);if(!P.length)return D(R),!0;if("move"===e.globalOpts.lightWinClose){if(e.isNull(e.globalOpts.lightWinMoveTo)||e.globalOpts.lightWinMoveTo===o)B=0;else for(H=0,B=0;H<e.displays.length;H++)if(e.displays[H].id===e.globalOpts.lightWinMoveTo){B++;break}B||(e.globalOpts.lightWinClose="ask",delete e.globalOpts.lightWinMoveTo)}switch(e.globalOpts.lightWinClose){case"close":for(D(R),H=0;H<P.length;H++)try{P[H].closeImage()}catch{}return!0;case"move":for(D(R),H=0;H<P.length;H++)try{P[H].moveToDisplay(e.globalOpts.lightWinMoveTo)}catch{}return!0;default:return v=`lightCloseID${e.uniqueID()}`,e.allinone?(r="inline",u=e.allinone.lightCloseHTML):(r="ajax",u=e.InstallDir(e.lightOpts.lcloseURL)),$(e.lightOpts[e.LIGHTWIN].topid).arrive("#lightWinCloseForm",{onceOnly:!0},()=>{let z,J;for(J=$("#lightWinCloseForm").find("#lightWinCloseSel"),z=0;z<e.displays.length;z++)e.displays[z].id!==o&&J.append($("<option>",{value:e.displays[z].id,text:e.displays[z].id}))}),a=e.lightWin(v,r,u,"Closing a light window",I.lcloseWin),$(a).data("dispid",o),$(a).data("winid",h),!1}})(n),o;case"new":return y.id?(o=y.id,delete y.id):o=f+e.uniqueID(),C=C||`width=${e.globalOpts.newWindowWidth}, height=${e.globalOpts.newWindowHeight}`,l=document.getElementsByTagName("head")[0].innerHTML,l=l.replace(/src=['"].*astroemw?\.js['"]/,""),!l.match(/src=["'].*js9\.js/)&&!l.match(/src=["'].*js9\.min\.js/)&&(l+='<script type="text/javascript" src="js9.min.js"><\/script>'),c=_||O(o,y),_=`<html><head>${l}</head><body`,x&&(_+=sprintf(" onload='JS9.Preload(\"%s\",%s);'",x,JSON.stringify(y))),_+=`>${c}</body></html>\n`,window.electron&&(p="data:text/html,<html><body><script>window.addEventListener('message', (ev) => {document.documentElement.innerHTML=ev.data<\/script><p></body></html>"),d=window.open(p,o,C),d?(d.document?(d.document.open(),d.document.write(_),d.document.close()):e.error(d.postMessage?"LoadWindow('new') is disabled on the Desktop for security reasons":"no method available for drawing image into window"),o):void e.error("could not create window (check your pop-up blockers)")}}),e.mkPublic("LoadProxy",function(...t){let s,o,n,a,l;const c=e.parsePublicArgs(t);if(n=c.argv[0],a=c.argv[1],e.globalOpts.loadProxy||e.error("proxy load not available for server"),e.globalOpts.workDir||e.error("proxy load requires a temp workDir for server"),n||e.error("no url specified for proxy load"),n=n.trim(),n.match(/dropbox\.com/)?(n=n.replace("www.dropbox.com","dl.dropboxusercontent.com"),n=`${n.replace("?dl=0","")}?raw=1`):n.match(/drive\.google\.com/)&&(n=n.replace(/\/file\/d\/(\w+)\/\w+\?usp=sharing/,"/uc?export=download&id=$1")),c.display&&(o=e.lookupDisplay(c.display)),a=a||{},"object"==typeof a)a=$.extend(!0,{},a);else if("string"==typeof a)try{a=JSON.parse(a)}catch{a={}}a.ofile?(l=a.ofile,delete a.ofile):l="",e.waiting(!0,o),e.Send("loadproxy",{cmd:`js9Xeq loadproxy ${n} ${l}`},d=>{let h,p,g;h="object"==typeof d?d:d.search(e.analOpts.epattern)>=0?{stderr:d}:{stdout:d},h.errcode=h.errcode||0,h.stderr?e.error(h.stderr):h.stdout?(p=h.stdout.split(/\s+/),p&&p[0]&&(s=e.cleanPath(p[0]),a.proxyFile=s,"/"!==s.charAt(0)&&(s=e.InstallDir(s)),p[1]&&(g=e.cleanPath(p[1]),a.parentFile=g,a.proxyParent=g),a.fixpath=!1,a.proxyURL=n,e.Load(s,a,{display:c.display}))):e.error("internal error: no return from load proxy command")})}),e.mkPublic("Preload",function(...t){let s,o,n,a,l,c,d="",h=null,p=null,g=t.length;const v=e.globalOpts.alerts,r=e.parsePublicArgs(t),u=e.URLEXP,f=/\.ses$/,m=/\.cmap$/;switch(c=r.argv[0],e.globalOpts.loadProxy&&e.helper.baseurl&&(a=new RegExp(`^${e.helper.baseurl}`)),r.display&&(p={display:r.display},g-=1),g){case 0:n=(null===e.helper.connected||e.helper.connected)&&e.fits.name&&e.preloads.length>0?2:3;break;case 1:n="boolean"==typeof c?c&&e.preloads.length>0?2:3:(null===e.helper.connected||e.helper.connected)&&e.fits.name?1:0;break;default:n=(null===e.helper.connected||e.helper.connected)&&e.fits.name?1:0}switch(n){case 0:for(s=0;s<g;s++)if(o=s+1,o<g&&"object"==typeof t[o])h=$.extend(!0,{},t[o]),e.preloads.push([t[s],h,p]),s++;else if(o<g&&t[o].startsWith("{")){try{h=JSON.parse(t[o])}catch{h=null}e.preloads.push([t[s],h,p]),s++}else e.preloads.push([t[s],null,p]);break;case 1:for(e.globalOpts.alerts=!1,s=0;s<g;s++)if(l=a&&t[s].match(u)&&!t[s].match(a)?e.LoadProxy:t[s].match(f)?e.LoadSession:t[s].match(m)?e.LoadColormap:e.Load,o=s+1,o<g&&"object"==typeof t[o]){(l===e.Load||l===e.LoadProxy)&&e.preloadwaiting.push({id:e.cleanPath(t[s]),loaded:!1});try{p?l(t[s],t[o],p):l(t[s],t[o])}catch{d=`${d} ${t[s]}`}s++}else if(o<g&&t[o].startsWith("{")){try{h=JSON.parse(t[o])}catch{h=null}(l===e.Load||l===e.LoadProxy)&&e.preloadwaiting.push({id:e.cleanPath(t[s]),loaded:!1});try{p?l(t[s],h,p):l(t[s],h)}catch{d=`${d} ${t[s]}`}s++}else{(l===e.Load||l===e.LoadProxy)&&e.preloadwaiting.push({id:e.cleanPath(t[s]),loaded:!1});try{p?l(t[s],null,p):l(t[s],null)}catch{d=`${d} ${t[s]}`}}e.globalOpts.alerts=v,d&&e.error(`could not preload image(s): ${d}`);break;case 2:for(e.globalOpts.alerts=!1,s=0;s<e.preloads.length;s++){l=a&&e.preloads[s][0].match(u)&&!e.preloads[s][0].match(a)?e.LoadProxy:e.preloads[s][0].match(f)?e.LoadSession:e.preloads[s][0].match(m)?e.LoadColormap:e.Load,(l===e.Load||l===e.LoadProxy)&&e.preloadwaiting.push({id:e.cleanPath(e.cleanPath(e.preloads[s][0])),loaded:!1});try{e.preloads[s][2]?l(e.preloads[s][0],e.preloads[s][1],e.preloads[s][2]):l(e.preloads[s][0],e.preloads[s][1])}catch{d=`${d} ${e.preloads[s][0]}`}}e.globalOpts.alerts=v,d&&e.error(`could not preload image(s): ${d}`),e.preloads=[]}}),e.mkPublic("RefreshImage",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display),l=c=>{a.refreshImage(c,o)};if(s=n.argv[0],o=n.argv[1]||{},a)if(o.id=a.id,s instanceof Blob){(!o.rawid||o.rawid===a.raw.id)&&e.cleanupFITSFile(a.raw,!0);try{e.handleFITSFile(s,e.fits.options,l)}catch(c){e.error("can't refresh FITS file",c)}}else a.refreshImage(s,o);else s instanceof Blob&&e.Load(...t)}),e.mkPublic("GetStatus",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.argv[1]||s.display),n=s.argv[0]||"load";return s.argv.length?e.fetchURL.status&&n.match(/^(pre)?load$/i)?e.fetchURL.status:o?o.getStatus(n):"none":["Load","CreateMosaic","DisplaySection","LoadCatalog","LoadRegions","ReprojectData","RotateData","RunAnalysis"]}),e.mkPublic("GetLoadStatus",function(...t){return e.GetStatus("load",...t)}),e.mkPublic("CopyToClipboard",function(t,s){let o,n,a;const l=$(document).scrollLeft(),c=$(document).scrollTop();e.clipboard=t,a=document.createElement("textarea"),a.style.position="fixed",a.style.top=0,a.style.left=0,a.style.width="2em",a.style.height="2em",a.style.padding=0,a.style.border="none",a.style.outline="none",a.style.boxShadow="none",a.style.background="transparent",a.value=t,document.body.appendChild(a),a.select();try{n=document.execCommand("copy"),n?o="OK":(o="MANUAL",e.BROWSER[2].match(/Mac/)?window.prompt("copy to clipboard: Cmd+C",t):window.prompt("copy to clipboard: Ctrl+C",t))}catch{o="ERROR"}return document.body.removeChild(a),s&&s.display&&(s.display.displayConjq.focus(),window.scrollTo(l,c)),o}),e.mkPublic("CopyFromClipboard",function(){return e.clipboard||""}),e.mkPublic("OpenFileMenu",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.display);o&&$(`#openLocalLoad-${o.id}`).click()}),e.mkPublic("OpenRegionsMenu",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.display);o&&$(`#openLocalLoadRegions-${o.id}`).click()}),e.mkPublic("OpenSessionMenu",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.display);o&&$(`#openLocalLoadSession-${o.id}`).click()}),e.mkPublic("OpenCatalogsMenu",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.display);o&&$(`#openLocalLoadCatalog-${o.id}`).click()}),e.mkPublic("OpenColormapMenu",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.display);o&&$(`#openLocalLoadColormap-${o.id}`).click()}),e.mkPublic("SaveColormap",function(...t){let s,o,n,a,l,c,d;const h=e.parsePublicArgs(t),p=v=>{let r=v;if("string"==typeof v)try{r=JSON.parse(v)}catch{}return r},g=v=>{let r,u;const f=[];for(r=0;r<v.length;r++)u=e.lookupColormap(v[r]),u&&(u=$.extend(!0,{},u),delete u.type,f.push(u));return 1===f.length?f[0]:f};return c=h.argv[0],d=h.argv[1],{}.hasOwnProperty.call(window,"saveAs")?(o=e.getImage(h.display),o&&(c=p(c),d=p(d),c?"string"==typeof c?(s=c,"string"==typeof d?n=g([d]):$.isArray(d)?n=g(d):(n=$.extend(!0,{},o.cmapObj),delete n.type)):$.isArray(c)&&(s="js9.cmap",n=g(c)):(s="js9.cmap",n=$.extend(!0,{},o.cmapObj),delete n.type),a=JSON.stringify(n),l=new Blob([a],{type:"text/plain"}),e.saveAs(l,s))):e.error("no saveAs() available to save colormap"),s}),e.mkPublic("NewFitsImage",function(...t){let s,o,n,a,l;const c=e.parsePublicArgs(t);a=c.argv[0],l=c.argv[1]||{},o=e.lookupDisplay(c.display||l.display||e.DEFID),l.refresh?("object"==typeof l.refresh?n=l.refresh:o&&o.image&&(n=o.image),n?(l.onload&&(l.onrefresh=l.onload,delete l.onload),n.refreshImage(a,l)):(l.onload&&(s=l.onload),e.checkNew(new e.Image(a,l,s)))):(l.onload&&(s=l.onload),e.checkNew(new e.Image(a,l,s)))}),e.mkPublic("GetImage",function(...t){const s=e.parsePublicArgs(t);let o=s.argv[0];return"string"!=typeof o&&(o=s.display),e.getImage(o)}),e.mkPublic("GetImageData",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o?o.getImageData(s.argv[0]):null}),e.mkPublic("GetDisplayData",function(...t){let s,o,n,a;const l=[],c=e.parsePublicArgs(t);for(o=c.display||e.displays[0].id,a=c.argv[0],s=0;s<e.images.length;s++)n=e.images[s],n.display.id===o&&l.push(n.getImageData(a));return l}),e.mkPublic("GetFITSHeader",function(...t){let s,o="";const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],a&&a.raw&&(o=e.raw2FITS(a.raw,{addcr:s})),o}),e.mkPublic("BlendDisplay",function(...t){let s,o,n;const a=[],l=e.parsePublicArgs(t),c=l.display||e.DEFID,d=e.lookupDisplay(c);if(n=l.argv[0],d||e.error(`no JS9 display found: ${c}`),void 0===n||"mode"===n)return d.blendMode;if("list"===n){for(s=0;s<e.images.length;s++)o=e.images[s],o.display.id===c&&o.blend.active&&a.push(o.id);return a}if("reset"===n){for(s=0;s<e.images.length;s++)o=e.images[s],o.display.id===c&&o.blend.active&&o.blendImage(!1);n=!1}return"true"===n?n=!0:"false"===n&&(n=!1),d.blendMode=!!n,d.image&&(d.image.xeqPlugins("image","ondisplayblend"),d.image.displayImage()),d.blendMode}),e.mkPublic("LoadAuxFile",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);s=n.argv[0],o=n.argv[1],a?a.loadAuxFile(s,o):e.error(`could not find image for aux file: ${s}`)}),e.mkPublic("SubmitAnalysis",function(...t){let s,o,n,a,l,c,d,h,p;const g=e.lightOpts[e.LIGHTWIN],v=e.parsePublicArgs(t);if(c=v.argv[0],d=v.argv[1],h=v.argv[2],d?n=e.lookupDisplay(v.display).id:(s=$(c).closest(g.top),d=s.data("aname"),n=s.data("dispid")),d?n&&(a=e.getImage(n)):l="internal error: could not find analysis task name",a){o=$(c).closest("form");try{p=o.serializeArray(),p=p.concat($(`#${o.attr("id")} input[type=checkbox]:not(:checked)`).map(function(){return{name:this.name,value:"false"}}).get())}catch{p=null}a.runAnalysis(d,p,h)}else l="internal error: could not find image";return l&&e.error(l),!1}),e.mkPublic("Send",function(t,s,o){e.helper.connected?e.helper.send(t,s,o):e.error("no JS9 helper available")}),e.mkPublic("EventToDisplayPos",function(t){return e.eventToDisplayPos(t)}),e.mkPublic("PixToWCS",function(...t){let s,o,n,a,l,c=1;const d=e.parsePublicArgs(t),h=e.getImage(d.display);if(h&&(n=d.argv[0],"object"==typeof n&&e.notNull(n.x)&&e.notNull(n.y)?(a=n.x,l=n.y):(a=d.argv[0],l=d.argv[1]),(!e.isNumber(a)||!e.isNumber(l))&&e.error("invalid input for PixToWCS"),h.validWCS()))return s=e.pix2wcs(h.raw.wcs,a,l).trim(),o=s.split(/ +/),"sexagesimal"===h.params.wcsunits&&"galactic"!==h.params.wcssys&&"ecliptic"!==h.params.wcssys&&(c=15),{ra:e.saostrtod(o[0])*c,dec:e.saostrtod(o[1]),sys:o[2],str:s}}),e.Pix2WCS=e.PixToWCS,e.mkPublic("WCSToPix",function(...t){let s,o,n,a,l,c,d;const h=e.parsePublicArgs(t),p=e.getImage(h.display);return p&&(l=h.argv[0],"object"==typeof l&&e.notNull(l.ra)&&e.notNull(l.dec)?(c=l.ra,d=l.dec):(c=h.argv[0],d=h.argv[1]),(!e.isNumber(c)||!e.isNumber(d))&&e.error("invalid input for WCSToPix"),p.validWCS())?(a=e.wcs2pix(p.raw.wcs,c,d).trim().split(/ +/),o=parseFloat(a[0]),n=parseFloat(a[1]),s=sprintf("%f %f",o,n),{x:o,y:n,str:s}):null}),e.WCS2Pix=e.WCSToPix,e.mkPublic("NewShapeLayer",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],o=n.argv[1],a?a.display.newShapeLayer(s,o):null}),e.mkPublic("AddRegions",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],o=n.argv[1],a?(s||e.error("no region specified for AddRegions"),a.addShapes("regions",s,o)):null}),e.mkPublic("RemoveRegions",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o?(o.removeShapes("regions",s.argv[0]),o.display.clearMessage("regions"),e.globalOpts.quietReturn?"":"OK"):null}),e.mkPublic("CopyRegions",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o?(o.copyRegions(s.argv[0],s.argv[1]),e.globalOpts.quietReturn?"":"OK"):null}),e.mkPublic("GetRegions",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o?(s.argv.unshift("regions"),o.getShapes(...s.argv)):null}),e.mkPublic("ListRegions",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return a?(s=n.argv[0]||"all",o=n.argv[1]||{mode:2},a.listRegions(s,o,o.layer)):null}),e.mkPublic("ListGroups",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return a?(s=n.argv[0]||"all",o=n.argv[1]||{},a.listGroups(s,o,o.layer)):null}),e.mkPublic("EditRegions",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return a&&(s=a.layers.regions,s&&(o=s.canvas.getActiveObject(),o&&"activeSelection"!==o.type?a.displayRegionsForm(o):a.displayRegionsForm(null,{multi:!0}))),null}),e.mkPublic("ChangeRegions",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o&&o.changeShapes("regions",s.argv[0],s.argv[1]),null}),e.mkPublic("SaveRegions",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);let n=s.argv[0];if(o){if(1!==s.argv.length||"dialogbox"!==n)return o.saveRegions(n,s.argv[1],s.argv[2]);o.displayRegionsForm(null,{type:"save"})}return null}),e.mkPublic("SelectRegions",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],o=n.argv[1],a?a.selectShapes("regions",s,o):null}),e.mkPublic("UnselectRegions",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],o=n.argv[1],a?a.unselectShapes("regions",s,o):null}),e.mkPublic("GroupRegions",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],o=n.argv[1],a?a.groupShapes("regions",s,o):null}),e.mkPublic("UngroupRegions",function(...t){let s,o;const n=e.parsePublicArgs(t),a=e.getImage(n.display);return s=n.argv[0],o=n.argv[1],a?a.ungroupShapes("regions",s,o):null}),e.mkPublic("ChangeRegionTags",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o?o.changeRegionTags(s.argv[0],s.argv[1],s.argv[2]):null}),e.mkPublic("ToggleRegionTags",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o?o.toggleRegionTags(s.argv[0],s.argv[1],s.argv[2]):null}),e.mkPublic("UnremoveRegions",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);return o?o.unremoveRegions():null}),e.mkPublic("LoadRegions",function(...t){let s,o,n,a;const l=e.parsePublicArgs(t),c=e.getImage(l.display),d=(h,p)=>{if(p&&void 0!==p.display&&delete p.display,c.addShapes("regions",h,p),c.setStatus("loadRegions","complete"),a&&a.onload)try{e.xeqByName(a.onload,window,c)}catch(g){e.error("in regions onload callback",g,!1)}};if(n=l.argv[0],a=l.argv[1],n||e.error("JS9.LoadRegions: no file specified for regions load"),c){if(c.setStatus("loadRegions","processing"),a=a||{},"object"==typeof a)a=$.extend(!0,{},a);else if("string"==typeof a)try{a=JSON.parse(a)}catch{a={}}"object"==typeof n?(s=n.path||n.name,s&&(a.file=s.split("/").reverse()[0]),o=new FileReader,o.onload=h=>{d(h.target.result,a)},o.readAsText(n)):"string"==typeof n?(a.responseType="text",n=e.fixPath(n,a),a.file=n.split("/").reverse()[0],e.fetchURL(null,n,a,d)):e.error("unknown file type for LoadRegions: "+typeof n)}}),e.mkPublic("InstallDir",function(t){return t?e.cleanPath(e.INSTALLDIR+t):""}),e.mkPublic("AddDivs",function(...t){let s,o,n,a,l;const c=e.parsePublicArgs(t);for(s=0;s<c.argv.length;s++)if(l=c.argv[s],l){if(0===$(`#${l}`).length){e.DEBUG&&e.log("warning: can't find div, skipping AddDivs(): %s",l);continue}for(o=0;o<e.displays.length;o++)if(n=e.displays[o],n.id===l){a=!0;break}a?e.DEBUG&&e.log("warning: div already added, skipping AddDivs(): %s",l):(e.checkNew(new e.Display(l)),e.helper.send("addDisplay",{display:l}))}e.instantiatePlugins()}),e.mkPublic("InstantiatePlugins",function(){e.instantiatePlugins()}),e.mkPublic("ResizeDisplay",function(...t){let s,o;const n=e.parsePublicArgs(t);return"string"!=typeof n.argv[0]||e.isNumber(n.argv[0])||"full"===n.argv[0]||"reset"===n.argv[0]||"image"===n.argv[0]?o=e.lookupDisplay(n.display):(o=e.lookupDisplay(n.argv[0]||n.display),n.argv.splice(0,1)),o||e.error("invalid display for resize"),s=o.resize(...n.argv),s===o?e.globalOpts.quietReturn?"":"OK":s}),e.mkPublic("SelectDisplay",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.argv[0]||s.display);o||e.error("invalid display for select"),{}.hasOwnProperty.call(e,"Menubar")||e.error("Menubar is required for display selection"),e.Menubar.onclick(o)}),e.mkPublic("GatherDisplay",function(...t){let s,o,n;const a=e.parsePublicArgs(t);switch(a.argv.length){case 0:o=a.display,n=null;break;case 1:"object"==typeof a.argv[0]||"string"==typeof a.argv[0]&&"{"===a.argv[0].charAt(0)?(o=a.display,n=a.argv[0]):o=a.argv[0]||a.display;break;default:o=a.argv[0]||a.display,n=a.argv[1]}s=e.lookupDisplay(o),s||e.error("invalid display for gather"),s.gather(n)}),e.mkPublic("SeparateDisplay",function(...t){let s,o,n;const a=e.parsePublicArgs(t);switch(a.argv.length){case 0:o=a.display,n=null;break;case 1:"object"==typeof a.argv[0]||"string"==typeof a.argv[0]&&"{"===a.argv[0].charAt(0)?(o=a.display,n=a.argv[0]):o=a.argv[0]||a.display;break;default:o=a.argv[0]||a.display,n=a.argv[1]}s=e.lookupDisplay(o),s||e.error("invalid display for separate"),s.separate(s,n)}),e.mkPublic("CenterDisplay",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.argv[0]||s.display);o||e.error("invalid display for center"),o.center()}),e.mkPublic("RemoveDisplay",function(...t){let s,o,n;const a=e.parsePublicArgs(t),l=e.lookupDisplay(a.argv[0]||a.display);l||e.error("invalid display for remove"),s=$.inArray(l,e.displays),s>=0?(o=l.divjq.closest(".JS9GridContainer"),n=l.divjq.closest(".JS9GridItem"),o.length>0&&n.length>0?o.find(".JS9GridItem").length>1?(e.CloseDisplay(l.id),n.remove(),e.displays.splice(s,1)):e.error(`can't remove last display in grid: ${l.id}`):l.winid&&l.winid.close?(e.CloseDisplay(l.id),l.winid.close()):e.error("can only remove displays within a grid or lightwins")):e.error(`can't find display in display list: ${l.id}`)}),e.mkPublic("SaveSession",function(...t){let s,o,n,a,l,c={};const d=e.parsePublicArgs(t);if(a=d.argv[0],l=d.argv[1],"object"==typeof a)c=$.extend(!0,{},a);else if("string"==typeof a)try{c=JSON.parse(a)}catch{if(s=a,l)if("object"==typeof l)c=$.extend(!0,{},l);else try{c=JSON.parse(l)}catch{c={}}}return c.mode||(c.mode="display"),o=d.display?d.display:c.display?c.display:e.displays.length>0?e.displays[0].id:e.DEFID,n=e.lookupDisplay(o),n.image?(s||(s="display"===c.mode?`js9-${(new Date).toISOString().slice(0,10)}.ses`:`${n.image.id}.ses`),n.image.saveSession(s,c)):null}),e.mkPublic("LoadSession",function(...t){let s,o,n,a,l;const c=e.parsePublicArgs(t);if(a=c.argv[0],l=c.argv[1],a||e.error("JS9.LoadSession: no file specified for load"),l=l||{},"object"==typeof l)l=$.extend(!0,{},l);else if("string"==typeof l)try{l=JSON.parse(l)}catch{l={}}s=c.display?c.display:l.display?l.display:e.displays.length>0?e.displays[0].id:e.DEFID,n=e.lookupDisplay(s),l.display=n.id,"object"==typeof a?(o=new FileReader,o.onload=d=>{const h=JSON.parse(d.target.result);l.sessionPath=e.dirname(a.path||a.name||""),n.loadSession(h,l)},o.readAsText(a)):"string"==typeof a?(l.responseType="text",l.display=n.id,a=e.fixPath(a,l),e.fetchURL(null,a,l,(d,h)=>{const p=JSON.parse(d);h.sessionPath=e.dirname(a),n.loadSession(p,h)})):e.error("unknown file type for LoadSession: "+typeof a)}),e.mkPublic("SaveCatalog",function(...t){const s=e.parsePublicArgs(t),o=e.getImage(s.display);if(o)return o.saveCatalog(s.argv[0],s.argv[1])}),e.mkPublic("LoadCatalog",function(...t){let s,o,n,a,l;const c=e.parsePublicArgs(t);if(n=c.argv[0],a=c.argv[1],l=c.argv[2],n instanceof Blob&&(l=a,a=n,n=null),a||e.error("JS9.LoadCatalog: no file specified for catalog load"),o=e.getImage(c.display),o){if(o.setStatus("loadCatalog","processing"),l=l||{},"object"==typeof l)l=$.extend(!0,{},l);else if("string"==typeof l)try{l=JSON.parse(l)}catch{l={}}if(a instanceof Blob)s=new FileReader,s.onload=d=>{if(!n&&a.name&&(n=a.name.replace(/\.[^.]*$/,"")),o.loadCatalog(n,d.target.result,l),o.setStatus("loadCatalog","complete"),l&&l.onload)try{e.xeqByName(l.onload,window,o)}catch(h){e.error("in catalog onload callback",h,!1)}},s.readAsText(a);else if("string"==typeof a)if(a.match(/\t/)){if(o.loadCatalog(n,a,l),o.setStatus("loadCatalog","complete"),l&&l.onload)try{e.xeqByName(l.onload,window,o)}catch(d){e.error("in catalog onload callback",d,!1)}}else l.responseType="text",a=e.fixPath(a,l),e.fetchURL(null,a,l,d=>{if(o.loadCatalog(n,d,l),o.setStatus("loadCatalog","complete"),l&&l.onload)try{e.xeqByName(l.onload,window,o)}catch(h){e.error("in catalog onload callback",h,!1)}});else e.error("unknown file type for LoadCatalog: "+typeof a)}}),e.mkPublic("CreateMosaic",function(...t){const s=e.parsePublicArgs(t),o=e.lookupDisplay(s.display);if(o)return o.createMosaic(s.argv[0],s.argv[1])}),e.mkPublic("DisplayPlugin",function(...t){let s,o,n,a,l;const c=e.parsePublicArgs(t),d=e.lookupDisplay(c.display);if(l=c.argv[0],d&&c.argv[0]){for(a=l.toLowerCase(),s=0;s<e.plugins.length;s++)if(o=e.plugins[s],n=o.name,n===l||n.toLowerCase().substr(-a.length)===a)return void d.displayPlugin(o);e.error(`can't find plugin: ${l}`)}}),e.mkPublic("DisplayHelp",function(t){let s,o,n,a;const l=e.lightOpts[e.LIGHTWIN].textWin,c="iframe";!t||(o=t.split("/").reverse()[0],s=`help_${e.uniqueID()}`,a=e.helpOpts[t],a?(n=e.InstallDir(`${a.type}/${a.url}`),e.lightWin(s,c,n,a.title||o,l)):e.lightWin(s,c,t,o,l))}),e.mkPublic("LightWindow",function(...t){const s=e.parsePublicArgs(t);let o=s.argv[0]||`lightWindow${e.uniqueID()}`,n=s.argv[1]||"inline",a=s.argv[2],l=s.argv[3]||"JS9 light window",c=s.argv[4]||e.lightOpts[e.LIGHTWIN].textWin;return a||e.error("no content specified for LightWindow"),e.lightWin(o,n,a,l,c)}),e.mkPublic("WindowPrint",function(...t){const s=e.parsePublicArgs(t),o={cmd:"print"};window.electron?(s.argv[0]&&(o.opts=s.argv[0]),window.setTimeout(()=>{try{window.electron.sendMsg(o)}catch(n){e.error("could not print window",n)}},e.TIMEOUT)):e.error("WindowPrint is only available for the JS9 desktop app")}),e.mkPublic("WindowToPDF",function(...t){const s=e.parsePublicArgs(t),o={cmd:"pdf"};window.electron?(o.file=s.argv[0]||"js9.pdf",s.argv[1]&&(o.opts=s.argv[1]),window.setTimeout(()=>{try{window.electron.sendMsg(o)}catch(n){e.error("could not create window pdf",n)}},e.TIMEOUT)):e.error("WindowToPDF is only available for the JS9 desktop app")}),e.mkPublic("SaveScript",function(...t){const s=e.parsePublicArgs(t),o={cmd:"script"};window.electron&&window.electron.app?(o.file=s.argv[0]||"",window.setTimeout(()=>{try{window.electron.sendMsg(o)}catch(n){e.error("could not create messaging script",n)}},e.TIMEOUT)):e.error("SaveScript is only available for the JS9 desktop app")}),e.mkPublic("SaveDir",function(...t){const s=e.parsePublicArgs(t),o={cmd:"savedir"};window.electron?(void 0!==s.argv[0]?(o.dirname=s.argv[0],s.argv[1]&&(o.opts=s.argv[1])):e.error("SaveDir requires a directory name"),window.setTimeout(()=>{try{window.electron.sendMsg(o)}catch(n){e.error("could not set save directory",n)}},e.TIMEOUT)):e.error("SaveDir is only available for the JS9 desktop app")}),e.mkPublic("Quit",function(...t){const s={cmd:"quit"};window.electron?window.setTimeout(()=>{try{window.electron.sendMsg(s)}catch(o){e.error("could not quit app",o)}},e.TIMEOUT):e.error("Quit is only available for the JS9 desktop app")}),e.init=function(){let t,s,o,n,a,l;if((!window.HTMLCanvasElement||!JSON)&&e.error("your browser does not support JS9 (no HTML5 canvas and/or JSON). Please try a modern version of Firefox, Chrome, Safari, Opera, or Edge."),{}.hasOwnProperty.call(window,"JS9Prefs")&&"object"==typeof JS9Prefs&&JS9Prefs.globalOpts&&JS9Prefs.globalOpts.installDir&&(e.INSTALLDIR=JS9Prefs.globalOpts.installDir),!e.INSTALLDIR){try{$('link[href$="js9.css"]').each((c,d)=>{const h=$(d).attr("href");h&&"js9.css"===h.split("/").reverse()[0]&&(e.INSTALLDIR=h.replace(/js9\.css$/,""))})}catch{e.INSTALLDIR=""}e.INSTALLDIR&&(e.INSTALLDIR=e.cleanPath(e.INSTALLDIR))}if(e.INSTALLDIR&&"/"!==e.INSTALLDIR.slice(-1)&&(e.INSTALLDIR+="/"),e.TOROOT=e.INSTALLDIR.replace(/([^/.])+/g,".."),{}.hasOwnProperty.call(window,"JS9Inline")&&"object"==typeof JS9Inline&&(e.inline=$.extend(!0,{},JS9Inline)),"dhtml"===e.LIGHTWIN&&($("<div>").attr("id","dhtmlwindowholder").appendTo($(document.body)).append("<span style='display:none'>.</span>"),dhtmlwindow.imagefiles=e.inline?[e.inline["images/min.gif"],e.inline["images/close.gif"],e.inline["images/restore.gif"],e.inline["images/resize.gif"]]:e.allinone?[e.allinone.min,e.allinone.close,e.allinone.restore,e.allinone.resize]:[e.InstallDir("images/min.gif"),e.InstallDir("images/close.gif"),e.InstallDir("images/restore.gif"),e.InstallDir("images/resize.gif")],{}.hasOwnProperty.call(window,"Jupyter")&&$(e.lightOpts[e.LIGHTWIN].topid).arrive("input",c=>{e.jupyterFocus($(c).parent())})),e.globalOpts.plotLibrary=e.globalOpts.plotLibrary||"flot","plotly"===e.globalOpts.plotLibrary&&!{}.hasOwnProperty.call(window,"Plotly")&&(e.globalOpts.plotLibrary="flot"),{}.hasOwnProperty.call(window,"JS9Prefs")&&"object"==typeof JS9Prefs?e.mergePrefs(JS9Prefs):e.PREFSFILE&&(e.loadPrefs(e.InstallDir(e.PREFSFILE),0),e.loadPrefs(e.PREFSFILE,0)),{}.hasOwnProperty.call(e,"Regions")&&$.extend(!0,e.Regions.opts,e.regionOpts),delete e.regionOpts,{}.hasOwnProperty.call(e,"Catalogs")&&$.extend(!0,e.Catalogs.opts,e.catalogOpts),delete e.catalogOpts,{}.hasOwnProperty.call(e,"Crosshair")&&$.extend(!0,e.Crosshair.opts,e.crosshairOpts),delete e.crosshairOpts,{}.hasOwnProperty.call(e,"Grid")&&$.extend(!0,e.Grid.opts,e.gridOpts),delete e.gridOpts,{}.hasOwnProperty.call(e,"Module")&&$.extend(!0,Module,e.emscriptenOpts),delete e.emscriptenOpts,{}.hasOwnProperty.call(e,"Fabric"))for(a of($.extend(!0,e.Fabric.opts,e.fabricOpts),Object.keys(e.Fabric.opts)))fabric.Object.prototype[a]=e.Fabric.opts[a];if(delete e.fabricOpts,e.globalOpts.resize||(e.globalOpts.resizeHandle=!1),void 0!==e.analOpts.prependJS9Dir&&(e.globalOpts.prependJS9Dir=e.analOpts.prependJS9Dir,delete e.analOpts.prependJS9Dir),void 0!==e.analOpts.dataDir&&(e.globalOpts.dataDir=e.analOpts.dataDir,delete e.analOpts.dataDir),void 0!==e.globalOpts.regionsToClipboard&&void 0===e.globalOpts.regToClipboard&&(e.globalOpts.regToClipboard=e.globalOpts.regionsToClipboard,delete e.globalOpts.regionsToClipboard),void 0!==e.globalOpts.regionDisplay&&void 0===e.globalOpts.regDisplay&&(e.globalOpts.regDisplay=e.globalOpts.regionDisplay,delete e.globalOpts.regionDisplay),void 0!==e.globalOpts.regionConfigSize&&void 0===e.globalOpts.regConfigSize&&(e.globalOpts.regConfigSize=e.globalOpts.regionConfigSize,delete e.globalOpts.regionConfigSize),void 0!==e.globalOpts.regionTemplates&&void 0===e.globalOpts.regTemplates&&(e.globalOpts.regTemplates=e.globalOpts.regionTemplates,delete e.globalOpts.regionTemplates),e.BROWSER[3]&&(e.globalOpts.resizeHandle=!1),{}.hasOwnProperty.call(window,"localStorage")&&e.globalOpts.localStorage){try{t=localStorage.getItem("globals")}catch{t=null}if(t){try{e.userOpts.displays=JSON.parse(t)}catch{}e.userOpts.displays&&$.extend(!0,e.globalOpts,e.userOpts.displays)}try{t=localStorage.getItem("images")}catch{t=null}if(t){try{e.userOpts.images=JSON.parse(t)}catch{}e.userOpts.images&&$.extend(!0,e.imageOpts,e.userOpts.images)}try{t=localStorage.getItem("fits")}catch{t=null}if(t)try{e.userOpts.fits=JSON.parse(t)}catch{}try{t=localStorage.getItem("regions")}catch{t=null}if(t){try{e.userOpts.regions=JSON.parse(t)}catch{}e.userOpts.regions&&$.extend(!0,e.Regions.opts,e.userOpts.regions)}try{t=localStorage.getItem("grid")}catch{t=null}if(t){try{e.userOpts.images=JSON.parse(t)}catch{}e.userOpts.images&&$.extend(!0,e.Grid.opts,e.userOpts.images)}try{t=localStorage.getItem("catalog")}catch{t=null}if(t){try{e.userOpts.images=JSON.parse(t)}catch{}e.userOpts.images&&$.extend(!0,e.Catalogs.Opts,e.userOpts.images)}}if(e.DEBUG=e.DEBUG||e.globalOpts.debug||0,$("div.JS9").each((c,d)=>{e.checkNew(new e.Display($(d)))}),window.Worker&&!e.allinone)try{e.worker=new e.WebWorker(e.InstallDir(e.WORKERFILE))}catch{}if(e.allinone?e.initFITS():e.initEmscripten(),window.electron&&(e.globalOpts.helperType="nodejs"),e.helper=new e.Helper,window.addEventListener("message",c=>{let d,h,p=c.origin||c.originalEvent.origin;const g=c.data;if("null"===p&&(p="unknown"),e.globalOpts.postMessage){if("string"==typeof g)try{h=JSON.parse(g)}catch(v){e.error(`can't parse msg: ${g}`,v)}else"object"==typeof g?h=g:e.error("invalid msg from postMessage");e.msgHandler(h,(v,r,u,f)=>{let m;m={name:(f=f||{}).name,rtype:f.rtype,rdata:v,stdout:v,stderr:r,errcode:u},parent.postMessage({cmd:h.cmd,res:m},"*")})}else e.DEBUG&&(d=`JS9 ignoring postMessage, origin: ${p}`,d+="string"==typeof g?` data: ${g}`:"object"==typeof g?` obj: ${JSON.stringify(Object.keys(g))}`:" typeof: "+typeof g,e.log(d))},!1),{}.hasOwnProperty.call(window,"ImageFilters")&&(e.ImageFilters=ImageFilters),e.initColormaps(),e.initCommands(),e.initAnalysis(),e.RegisterPlugin(e.MouseTouch.CLASS,e.MouseTouch.NAME,e.MouseTouch.init,{menuItem:"Mouse/Touch",onplugindisplay:e.MouseTouch.init,help:"help/mousetouch.html",winTitle:"Mouse/Touch Actions",winResize:!0,winDims:[e.MouseTouch.WIDTH,e.MouseTouch.HEIGHT]}),e.RegisterPlugin(e.Regions.CLASS,e.Regions.NAME,e.Regions.init,{divArgs:["regions"],winDims:[0,0]}),e.RegisterPlugin(e.Crosshair.CLASS,e.Crosshair.NAME,e.Crosshair.init,{onmousemove:e.Crosshair.display,onkeyboardaction:e.Crosshair.keyaction,onkeyup:e.Crosshair.keyup,onimageload:e.Crosshair.create,winDims:[0,0]}),e.RegisterPlugin(e.Grid.CLASS,e.Grid.NAME,e.Grid.init,{onsetpan:e.Grid.regrid,onsetzoom:e.Grid.regrid,onsetwcssys:e.Grid.regrid,onsetwcsunits:e.Grid.regrid,onimageload:e.Grid.regrid,onupdateprefs:e.Grid.regrid,winDims:[0,0]}),e.RegisterPlugin(e.Dysel.CLASS,e.Dysel.NAME,e.Dysel.init,{onimageload:e.Dysel.imageload,onimageclose:e.Dysel.imageclose,winDims:[0,0]}),e.RegisterPlugin(e.Titlebar.CLASS,e.Titlebar.NAME,e.Titlebar.init,{onimageload:e.Titlebar.imageload,onimagedisplay:e.Titlebar.imagedisplay,onimageclose:e.Titlebar.imageclose,winDims:[0,0]}),e.instantiatePlugins(),e.plugins.sort((c,d)=>{const h=c.opts.menuItem,p=d.opts.menuItem;return h?!p||h<p?-1:h>p?1:0:1}),e.globalOpts.processQueryParams&&(s=new URL(window.location),s.searchParams)){t={},l=null;for(const[c,d]of s.searchParams)switch(c){case"url":case"file":o=d;break;case"display":n={display:d};break;case"renamedisplay":l=d.split(/[:,]/);break;default:t[c]=d}l&&(e.prerename=[...l]),o&&(n?e.Preload(o,t,n):e.Preload(o,t))}$(document).scrollTop(0),e.inited=!0,$(document).trigger("JS9:init")},e}();$(document).ready(()=>{$(document).on("JS9:ready",()=>{JS9.readied||(JS9.readied=!0,JS9.notNull(JS9.prerename)&&JS9.prerename.length&&(JS9.RenameDisplay(...JS9.prerename),delete JS9.prerename),JS9.Preload(!0))}),$(document).on("JS9:init",()=>{JS9.helper.ready&&JS9.fits.ready&&$(document).trigger("JS9:ready",{status:"OK"})}),$(document).on("astroem:ready",()=>{if(JS9.initFITS(),window.electron&&JS9.hostFS)try{JS9.vmount("/",JS9.hostFS)||delete JS9.hostFS}catch{delete JS9.hostFS}JS9.helper.ready&&JS9.inited&&$(document).trigger("JS9:ready",{status:"OK"})}),$(document).on("JS9:helperReady",()=>{JS9.fits.ready&&JS9.inited&&!JS9.readied&&$(document).trigger("JS9:ready",{status:"OK"})}),0===$('div[data-js9init="false"]').length&&JS9.init()}),function e(t,s,o){function n(c,d){if(!s[c]){if(!t[c]){var h="function"==typeof require&&require;if(!d&&h)return h(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var g=s[c]={exports:{}};t[c][0].call(g.exports,function(v){return n(t[c][1][v]||v)},g,g.exports,e,t,s,o)}return s[c].exports}for(var a="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,s){"use strict";!function(){var o=e("./xhr"),n=e("./remote-service");function c(h){var p=h[0],g=$(h).data("menu"),v=$(h).data("submenu");p.options.length=0,$.each(g,function(r,u){p.options[p.options.length]=new Option(u.text,u.value)}),void 0!==v&&($(v).data("menu",g[p.selectedIndex].subdata),c(v),h.change(function(){$(v).data("menu",g[p.selectedIndex].subdata),c(v)}))}e("./image-services"),e("./catalog-services"),JS9.RegisterPlugin("DataSources","ArchivesCatalogs",function d(){var h=this.div,p=this.winHandle;h.innerHTML=`<form class="JS9Archive-form">\n            <p>\n\t    <select class="service-menu JS9Select"></select>\n\t    <select class="server-menu JS9Select"></select>\n\t    <select class="source-menu JS9Select"></select>\n\t    <p>\n\t    <table width="98%">\n\t    <tr><td>RA:  \t</td><td>\t<input type=text name=ra\tsize=12> </td>\n\t\t<td>Dec: \t</td><td>\t<input type=text name=dec\tsize=12> </td>\n\t\t<td><input type=button value="Set RA/Dec" class="get-ra-dec JS9Button2"> </td>\n\t    <tr><td>Width: </td><td>\t<input type=text name=width\tsize=12 value=15> </td>\n\t\t<td>Height: </td><td>\t<input type=text name=height\tsize=12 value=15> </td>\n                <td>\n                    <input type=checkbox name=CORS checked>CORS\n\t\t    <input type=checkbox name=gzip> compress\n                </td>\n\t    </tr>\n\t    <tr><td>Object: </td> <td> <input type=text name=object size=12> </td>\n\t\t<td>&nbsp;</td>\n\t\t<td>&nbsp;</td>\n\t\t<td>&nbsp;</td>\n            </tr>\n            <tr>\n\t\t<td>&nbsp;</td>\n\t\t<td>&nbsp;</td>\n\t\t<td>&nbsp;</td>\n\t\t<td>&nbsp;</td>\n\t\t<td>&nbsp;</td>\n            </tr>\n            <tr>\n\t\t<td colspan="4"><span class=status></td>\n\t        <td>\n                    <input type=button value="Cancel" class="service-cancel JS9Button2" ${p?"":'style="display:none;"'}>\n                    &nbsp;\n                    <input type=button value="Get Data" class="service-go JS9RunButton">\n                </td>\n            </tr>\n\t    </table>\n\t    </form>`;var v=$(h).find(".service-menu"),r=$(h).find(".server-menu"),u=$(h).find(".source-menu");$(v).data("submenu",r),$(r).data("submenu",u);var f=this.display;$(h).find(".service-cancel").on("mouseup",function(){p&&p.close()}),$(h).find(".service-go").on("mouseup",function(){!function a(h,p){var v=$(h).find(".JS9Archive-form")[0];if(""!==v.ra.value&&""!==v.dec.value){var r=parseFloat(v.width.value),u=parseFloat(v.height.value);"-"!==v.dec.value[0]&&"+"!==v.dec.value[0]&&(v.dec.value="+"+v.dec.value),r>60&&(v.width.value="60",r=60),u>60&&(v.height.value="60",u=60);var f=$(v).find(".server-menu")[0],m=$(v).find(".source-menu")[0],w=m.options[m.selectedIndex].value,x=m.options[m.selectedIndex].innerHTML;n.Services[f.options[f.selectedIndex].value].retrieve({name:v.object.value,e:"J2000",h:u.toString(),w:r.toString(),r:v.ra.value,d:v.dec.value,c:v.gzip.checked,s:w,source:x,CORS:v.CORS.checked,display:p},function g(y){$(h).find(".status").html(y)})}}(h,f)}),$(h).find(".get-ra-dec").on("mouseup",function(){!function l(h,p){var g,v;function r(S){$(h).find(".status").html(S)}var u=$(h).find(".JS9Archive-form")[0];if(""!==u.object.value){var m=encodeURI((JS9.globalOpts.simbadProxy||"https://js9.si.edu/cgi-bin/simbad-proxy.cgi")+"?"+u.object.value);o({url:m,title:"Name",status:r},function(S,_){var C=_.responseText.trim().split(" ");":"!==C[0][1]?(u.ra.value=C[0],u.dec.value=C[1]):r("<span style='color: red;'>Object not found?</span>")})}else{var b=JS9.GetImage({display:p});("image"===(g=b.getWCSSys())||"physical"===g)&&(v=JS9.globalOpts.xeqPlugins,JS9.globalOpts.xeqPlugins=!1,b.setWCSSys("native",!1));var w=JS9.pix2wcs(b.raw.wcs,b.raw.header.NAXIS1/2,b.raw.header.NAXIS2/2).split(/ +/),A=JS9.PixToWCS(b.raw.header.NAXIS1/2+1,b.raw.header.NAXIS2/2+1,{display:b});u.ra.value=w[0]||"",u.dec.value=w[1]||"";var x=JS9.PixToWCS(1,b.raw.header.NAXIS2/2+1,{display:b}),y=JS9.PixToWCS(b.raw.header.NAXIS1+1,b.raw.header.NAXIS2/2+1,{display:b});u.width.value=Math.floor(Math.abs(60*(x.ra-y.ra))*Math.cos(A.dec/57.2958)*10)/10,x=JS9.PixToWCS(b.raw.header.NAXIS1/2+1,1,{display:b}),y=JS9.PixToWCS(b.raw.header.NAXIS1/2+1,b.raw.header.NAXIS2+1,{display:b}),u.height.value=Math.floor(10*Math.abs(60*(x.dec-y.dec)))/10,("image"===g||"physical"===g)&&(b.setWCSSys(g,!1),JS9.globalOpts.xeqPlugins=v)}}(h,f)});var m=[];$.each(n.Services,function(w,A){"image-service"===A.type&&m.push({text:A.params.text,value:A.params.value,subdata:A.params.surveys})});var b=[];$.each(n.Services,function(w,A){"catalog-service"===A.type&&b.push({text:A.params.text,value:A.params.value,subdata:A.params.surveys})}),$(v).data("menu",[{text:"Image Servers",value:"imgserv",subdata:m},{text:"Catalog Servers",value:"catserv",subdata:b}]),c(v)},{menu:"view",menuItem:"Archives & Catalogs",winTitle:"Archives & Catalogs",winDims:[610,210],help:"archive/archive.html"})}()},{"./catalog-services":3,"./image-services":5,"./remote-service":6,"./xhr":10}],2:[function(e,t,s){"use strict";var o=e("./remote-service"),l=(e("./starbase"),e("./strtod"),e("./template")),c=e("./xhr");t.exports=function h(p){o.Register(p.value,this),this.type="catalog-service",this.params=p,this.table2cat=function(g,v){var r,u,y,f=this.params.shape,m=v[this.params.xcol],b=v[this.params.ycol];switch(f){case"box":case"ellipse":y=function(L){return{width:7,height:7}};break;case"circle":y=function(L){return{radius:3.5}}}var _,C,I,M,S=[];for(r=0,u=0;r<v.data.length;r++)void 0,(_=(M=JS9.WCSToPix(15*v.data[r][m],v.data[r][b],{display:g}))?{x:M.x,y:M.y}:null)&&(C=y(g,v.data[r][1],v.data[r][1]),I={id:r.toString(),shape:f,x:_.x,y:_.y,width:C.width,height:C.height,radius:C.radius,angle:0,data:{ra:15*v.data[r][m],dec:v.data[r][b]}},S[u++]=I);return S},this.retrieve=function(g,v){this.params.calc(g),g.units=this.params.units;var r=l(this.params.url,g),f=c({url:r,title:"Catalog",status:v,CORS:g.CORS},function(m){var b,w,A;w=JS9.GetImage({display:g.display}),b=f.responseText,(A={}).units=g.units,JS9.LoadCatalog(g.name,b,A,{display:w})})}}},{"./remote-service":6,"./starbase":7,"./strtod":8,"./template":9,"./xhr":10}],3:[function(e,t,s){"use strict";e("./strtod");var n=e("./catalog-service");new n({text:"SAO",value:"saoCat",surveys:[{value:"tmc",text:"Two Mass Catalog"},{value:"gsc2",text:"Guide Star Catalog 2"}],url:"https://www.cfa.harvard.edu/catalog/scat?catalog={s}&ra={r}&dec={d}&width={w}&height={h}&system={e}&compress={c}",calc:function(c){c.c&&(c.c="gzip"),c.w=60*c.w,c.h=60*c.h,c.name=c.source+"@"+this.text},shape:"circle",xcol:"ra",ycol:"dec"}),new n({text:"VizieR",value:"vizCat",surveys:[{value:"II/246",text:"2MASS"},{value:"2MASX",text:"2MASS Extended Source"},{value:"B/DENIS",text:"DENIS 3rd Release 2005"},{value:"GLIMPSE",text:"Spitzer's GLIMPSE"},{value:"GSC2.3",text:"GSC-II Catalog, Version 2.3.2"},{value:"HIP2",text:"Hipparcos (2007)"},{value:"IRAS",text:"IRAS "},{value:"NVSS",text:"NRAO VLA Sky Survey"},{value:"SDSS-DR9",text:"SDSS Photometric Catalog"},{value:"Tycho-2",text:"Tycho-2"},{value:"UCAC4",text:"UCAC 4th Release"},{value:"USNO-A2",text:"USNO-A2"},{value:"USNO-B1",text:"USNO-B1"},{value:"WISE",text:"WISE"}],url:"https://vizier.u-strasbg.fr/viz-bin/asu-tsv?-source={s}&-out.add=_RAJ,_DEJ&-c={r}{d}&-c.bm={w}x{h}&-oc.form=s&-out.meta=h",calc:function(c){c.c&&(c.c="gzip"),c.name=c.source+"@"+this.text},shape:"box",xcol:"_RAJ2000",ycol:"_DEJ2000"})},{"./catalog-service":2,"./strtod":8}],4:[function(e,t,s){"use strict";var o=e("./remote-service"),n=e("./template"),a=e("./xhr");t.exports=function l(c){o.Register(c.value,this),this.type="image-service",this.params=c,this.retrieve=function(d,h){var p=d.display;c.calc(d);var g=n(c.url,d);a({url:g,title:"Image",status:h,type:"blob",CORS:d.CORS},function(v,r){if(void 0===c.handler){var u=new Blob([r.response]);u.name=d.name,JS9.fits.handleFITSFile(u,{display:p})}else c.handler(v,r,c,d)})}}},{"./remote-service":6,"./template":9,"./xhr":10}],5:[function(e,t,s){"use strict";var o=e("./image-service"),n=function(h){return(""!==h.name?h.source+"_"+h.name:h.source+"_"+h.r+h.d).replace(/\s+/g,"_")+".fits"};new o({text:"DSS1@SAO",value:"saoDSS",surveys:[{value:"DSS1",text:"DSS1"}],url:"https://www.cfa.harvard.edu/archive/dss?r={r}&d={d}&w={w}&h={h}&e={e}&c={c}",calc:function(h){h.c&&(h.c="gzip"),h.name=n(h)}}),new o({text:"DSS@STScI",value:"stsDSS",surveys:[{value:"poss2ukstu_ir",text:"STScI DSS2 IR"},{value:"poss2ukstu_red",text:"STScI DSS2 Red"},{value:"poss2ukstu_blue",text:"STScI DSS2 Blue"},{value:"poss1_red",text:"STScI DSS1 Red"},{value:"poss1_blue",text:"STScI DSS1 Blue"}],url:"https://stdatu.stsci.edu/cgi-bin/dss_search?r={r}&d={d}&w={w}&h={h}&e={e}&c={c}&v={s}&f=fits",calc:function(h){h.c=h.c?"gz":"none",h.name=n(h)}}),new o({text:"DSS@ESO",value:"esoDSS",surveys:[{value:"DSS2-infrared",text:"ESO DSS2 IR"},{value:"DSS2-red",text:"ESO DSS2 Red"},{value:"DSS2-blue",text:"ESO DSS2 Blue"},{value:"DSS1",text:"ESO DSS1"}],url:"https://archive.eso.org/dss/dss?ra={r}&dec={d}&equinox=J2000&x={w}&y={h}&mime-type={c}&Sky-Survey={s}",calc:function(h){h.c=h.c?"display/gz-fits":"application/x-fits",h.name=n(h)}}),new o({text:"2Mass@IPAC",value:"ipac2m",surveys:[{value:"j",text:"IPAC 2Mass J"},{value:"h",text:"IPAC 2Mass H"},{value:"k",text:"IPAC 2Mass K"}],url:"https://irsa.ipac.caltech.edu/cgi-bin/Oasis/2MASSImg/nph-2massimg?objstr={r},{d}&size={radius}&band={s}",calc:function(h){h.radius=Math.floor(60*Math.sqrt(h.w*h.w+h.h*h.h)),h.name=n(h)}})},{"./image-service":4}],6:[function(e,t,s){"use strict";s.Services={},s.Register=function(o,n){s.Services[o]=n}},{}],7:[function(e,t,s){"use strict";function o(l){return l}function n(l){var c;for(c=0;c<l.length;c++)if(null===l[c].match(/^-+$/))return 0;return c}t.exports=function a(l,c){var d,h,p;c=c||{},this.head={},this.type=[],this.data=[],l=l.replace(/\s+$/,"").split("\n");var v=0;if(c.skip)for(p=c.skip.split("");v<l.length&&(p[0]===l[v][0]||"\n"===p[1]&&""===l[v]);v++);if(void 0!==l[v]&&void 0!==l[v+1]){this.headline=l[v++].trim().split(/ *\t */),c.units&&(this.unitline=l[v++].trim().split(/ *\t */)),this.dashline=l[v++].trim().split(/ *\t */);for(var r=n(this.dashline);0===r||r!==this.headline.length;)c.units?(this.headline=this.unitline,this.unitline=this.dashline):this.headline=this.dashline,this.dashline=l[v++].trim().split(/ *\t */),r=n(this.dashline);for(d=0;d<this.headline.length;d++)this.type[d]=c.type&&c.type[this.headline[d]]?c.type[this.headline[d]]:c.type&&c.type.default?c.type.default:o;for(h=0;v<l.length&&p[0]!==l[v][0]&&("\n"!==p[1]||""!==l[v]);v++,h++)for(this.data[h]=l[v].split("\t"),d=0;d<this.data[h].length;d++)this.data[h][d]=this.type[d](this.data[h][d]);for(d=0;d<this.headline.length;d++)this[this.headline[d]]=d}}},{}],8:[function(e,t,s){"use strict";t.exports=function o(n){var l,a=n.trim().split(/[: ]/);if(3===a.length){var c=1;"-"===a[0].substr(0,1)&&(c=-1);var d=parseFloat(a[0]),h=parseFloat(a[1]),p=parseFloat(a[2]);l=c*(Math.abs(d)+h/60+p/3600)}else l=parseFloat(n);return isNaN(l)?n:l}},{}],9:[function(e,t,s){"use strict";function o(a,l){var c,d="";for(c=0;c<l;c++)d+=a;return d}t.exports=function n(a,l){return a.replace(/\{([a-zA-Z0-9_.%]*)\}/g,function(c,d){var h,p,g,v,r,u=l;for(v=(d=d.split("%")).length<=1?"%s":d[1],d=(d=d[0]).split("."),r=0;r<d.length;r++){if(!u.hasOwnProperty(d[r]))return"";u=u[d[r]]}switch(h=v.substring(v.length-1),g=0|(p=(p=v.substring(0,v.length-1)).split("."))[0],p=0|p[1],h){case"s":u=u.toString();break;case"f":u=u.toFixed(p);break;case"d":u=u.toFixed(0)}return 0!==g&&g>u.length&&(g>0?u=o(" ",g-u.length)+u:u+=o(" ",g-u.length)),u})}},{}],10:[function(e,t,s){"use strict";t.exports=function o(n,a){var l=n.status,c="",d=JS9.globalOpts.corsProxy||"https://js9.si.edu/cgi-bin/CORS-proxy.cgi";n.CORS&&(n.url=n.url.replace(/\?/g,"@"),n.url=n.url.replace(/&/g,"!"),n.url=encodeURI(n.url),n.url=d+"?Q="+n.url),JS9.DEBUG>1&&JS9.log("archive/catalog url: %s",n.url);var h=new XMLHttpRequest;return h.open("GET",n.url,!0),n.title&&(c=n.title),n.type&&(h.responseType=n.type),void 0!==l&&(h.addEventListener("progress",function(p){l(c+" progress "+p.loaded.toString())}),h.addEventListener("error",function(p){l(c+" service error")}),h.addEventListener("abort",function(p){l(c+" service aborted")})),h.onload=function(p){4===this.readyState&&(200===this.status||0===this.status)&&(void 0!==l&&l(""),a(p,this))},h.send(),h}},{}]},{},[1]),function(){function e(n,a){let l,c,d=JS9.GetImage({display:a}),h=$(n).find(".js9BinningForm")[0];!d||!d.raw||(l={xcen:0,ycen:0,xdim:0,ydim:0,bin:1,filter:"",columns:"",cubecol:""},JS9.isNumber(h.xcen.value)&&(l.xcen=parseFloat(h.xcen.value)),JS9.isNumber(h.ycen.value)&&(l.ycen=parseFloat(h.ycen.value)),c=d.maybePhysicalToImage({x:l.xcen,y:l.ycen}),c&&(l.xcen=c.x,l.ycen=c.y),JS9.isNumber(h.xdim.value)&&(l.xdim=Math.floor(parseFloat(h.xdim.value))),JS9.isNumber(h.ydim.value)&&(l.ydim=Math.floor(parseFloat(h.ydim.value))),l.bin=JS9.isNumber(h.bin.value)?parseFloat(h.bin.value):h.bin.value,JS9.isNumber(h.bitpix.value)&&(l.bitpix=parseInt(h.bitpix.value,10)),l.filter=h.filter.value,l.columns=h.columns.value,l.cubecol=h.cubecol.value,d.raw.hdu.table&&d.raw.hdu.table.columns!==l.columns&&(l.xcen=0,l.ycen=0),l.separate=$(h.separate).prop("checked"),l.cubecol&&(l.separate=!0),l.binMode=$('input[name="binmode"]:checked').val(),d.displaySection(l))}function s(n,a){let l,c,d,h,p,g;a||(a=this?this.display:JS9.displays[0]),l=JS9.GetImage({display:a}),l&&(h=$(n).find(".js9BinningForm")[0],void 0!==l.raw.hdu?(p=l.raw.hdu,p.bin=p.bin||1,p.binMode=p.binMode||JS9.globalOpts.binMode||"s",h.rebin.disabled=!1,void 0===p.table||JS9.ishealpix(l)?(p.bin=p.bin||1,g=p.bin>0?p.bin:1/Math.abs(p.bin),l.parentFile&&l.raw.header&&void 0!==l.raw.header.LTM1_1&&(g=1/Math.abs(l.raw.header.LTM1_1)),c=l.getPan(),d=l.imageToLogicalPos({x:c.ox,y:c.oy}),h.xcen.value=String(Math.floor(d.x+.5*(g-1))),h.ycen.value=String(Math.floor(d.y+.5*(g-1))),h.bin.value=String(p.bin),h.xdim.value=String(Math.floor(p.naxis1*g)),h.ydim.value=String(Math.floor(p.naxis2*g)),h.filter.value="",h.bitpix.value=l.raw.header.BITPIX,h.columns.value="",h.cubecol.value="",h.bin.disabled=!1,h.xcen.disabled=!1,h.ycen.disabled=!1,h.xdim.disabled=!1,h.ydim.disabled=!1,h.binmode.disabled=!1,h.filter.disabled=!0,h.filter.style.backgroundColor="#E0E0E0",h.bitpix.disabled=!0,h.bitpix.style.backgroundColor="#E0E0E0",h.columns.disabled=!0,h.columns.style.backgroundColor="#E0E0E0",h.cubecol.disabled=!0,h.cubecol.style.backgroundColor="#E0E0E0"):(c=l.getPan(),d=l.imageToLogicalPos({x:c.ox,y:c.oy}),h.xcen.value=String(Math.floor(d.x+.5)),h.ycen.value=String(Math.floor(d.y+.5)),h.bin.value=String(p.table.bin),h.xdim.value=String(Math.floor(p.table.xdim)),h.ydim.value=String(Math.floor(p.table.ydim)),h.filter.value=p.table.filter||"",h.bitpix.value=p.table.bitpix||JS9.globalOpts.table.bitpix,h.columns.value=p.table.columns||"",h.cubecol.value="",h.bin.disabled=!1,h.xcen.disabled=!1,h.ycen.disabled=!1,h.xdim.disabled=!1,h.ydim.disabled=!1,h.filter.disabled=!1,h.bitpix.disabled=!1,h.columns.disabled=!1,h.cubecol.disabled=!1),l.parentFile&&JS9.helper.connected&&JS9.helper.js9helper&&(h.cubecol.value="",h.cubecol.disabled=!0,h.cubecol.style.backgroundColor="#E0E0E0"),"a"===p.binMode?$('input:radio[class="avg-pixels"]').prop("checked",!0):$('input:radio[class="sum-pixels"]').prop("checked",!0)):h.rebin.disabled=!0)}function o(){let n,a,l,c,d,h=this,p="&nbsp;",g="Block",v="blocked",r="",u=this.div,f=this.display,m=this.winHandle,b=m?"":'style="display:none;"',w=JS9.GetImage({display:this.display});if(!w||w&&!w.raw.hdu)u.innerHTML='<p style="padding: 5px"><center>FITS image sections, with binning and filtering</center>';else{if("table"===w.imtab&&(g="Bin",v="binned",JS9.ishealpix(w)||(p='&nbsp;<select name="selectcube" class="js9-binning-hdulist JS9Select">')),r=`<form class="js9BinningForm js9Form">\n\t        <table style="margin:0px; cellspacing:0; border-collapse:separate; border-spacing:4px 10px;">\n\t           <tr>\t<td><input type=button class="js9-binning-full JS9Button2" value="Load full image" style="text-align:right;"></td>\n\t\t\t<td>&nbsp;</td>\n\t\t\t<td>&nbsp;</td>\n                        <td>${p}</td>\n\t\t   </tr>\n\t           <tr>\t<td>Center:</td>\n\t\t\t<td><input type=text name=xcen size=10 style="text-align:right;"></td>\n\t\t\t<td><input type=text name=ycen size=10 style="text-align:right;"></td>\n\t\t\t<td>&nbsp;center position of section</td>\n\t\t   </tr>\n\t           <tr>\t<td>Size:</td>\n\t\t\t<td><input type=text name=xdim size=10 style="text-align:right;"></td>\n\t\t\t<td><input type=text name=ydim size=10 style="text-align:right;"></td>\n\t\t\t<td>&nbsp;width, height of section</td>\n\t\t   </tr>\n                   <tr>\t<td>${g}:</td>\n\t\t\t<td><input type=text name=bin value=1 size=10 style="text-align:right;"></td>\n\t\t\t<td></td>\n\t\t\t<td>&nbsp;apply ${g.toLowerCase()} factor to ${w.imtab}</td>\n\t\t   </tr>`,"image"===w.imtab||JS9.ishealpix(w)?(r+=`\n\t           <tr>\t<td>Mode:</td>\n                        <td><input type=radio name=binmode value="s" class="sum-pixels" style="text-align:left;">sum</td>\n                        <td><input type=radio name=binmode value="a" class="avg-pixels" style="text-align:left;">average</td>\n\t\t\t<td>&nbsp;sum or avg ${v} pixels?</td>\n\t\t   </tr>`,r+='\n\t\t   <tr>\t<td>Bitpix:</td>\n\t\t\t<td colspan="2"><textarea name=bitpix rows="1" cols="22" style="padding-left:5px; text-align:left;" autocapitalize="off" autocorrect="off"></textarea></td>\n\t\t\t<td>&nbsp;image bitpix</td>\n\t\t   </tr>'):(r+='\n\t           <tr>\t<td>Mode:</td>\n                        <td><input type=checkbox name=xbinmode value="s" class="sum-pixels" style="text-align:left;" checked disabled>sum</td>\n\t\t\t<td></td>\n\t\t\t<td>&nbsp;binned tables are summed</td>\n\t\t   </tr>',r+='\n\t\t   <tr>\t<td>Bitpix:</td>\n\t\t\t<td colspan="2"><textarea name=bitpix rows="1" cols="22" style="padding-left:5px; text-align:left;" autocapitalize="off" autocorrect="off"></textarea></td>\n\t\t\t<td>&nbsp;bitpix when binning table</td>\n\t\t   </tr>'),r+=`  <tr>\t<td>Filter:</td>\n\t\t\t<td colspan="2"><textarea name=filter rows="1" cols="22" style="padding-left:5px; text-align:left;" autocapitalize="off" autocorrect="off"></textarea></td>\n\t\t\t<td>&nbsp;event/row filter when binning table</td>\n\t\t   </tr>\n\n\t\t   <tr>\t<td>BinCols:</td>\n\t\t\t<td colspan="2"><textarea name=columns rows="1" cols="22" style="padding-left:5px; text-align:left;" autocapitalize="off" autocorrect="off"></textarea></td>\n\t\t\t<td>&nbsp;alternate binning cols for table</td>\n\t\t   </tr>\n\n\t           <tr>\t<td>CubeCol:</td>\n\t\t\t<td colspan="2"><textarea name=cubecol class="js9-binning-cubecol" rows="1" cols="22" style="padding-left:5px; text-align:left;" autocapitalize="off" autocorrect="off"></textarea></td>\n\t\t\t<td>&nbsp;table&rarr;cube: col[:min:max][:binsiz]</td>\n\t\t   </tr>\n\n\t           <tr>\t<td>Separate:</td>\n                        <td><input type=checkbox name=separate class="js9-binning-sep" style="text-align:left;"></td>\n\t\t\t<td></td>\n\t\t\t<td>&nbsp;display as separate image?</td>\n\t\t   </tr>\n\t\t   <tr>\n\t\t\t<td>&nbsp;</td>\n\t\t\t<td>&nbsp;</td>\n\t\t\t<td>&nbsp;</td>\n                        <td>\n                            <input type=button name=close value="Cancel" class="js9-binning-close JS9Button2" ${b}'>\n                            &nbsp;\n\t\t\t    <input type=button name=rebin value="Get Data" class="js9-binning-rebin JS9RunButton">\n                        </td>\n\t\t   </tr>\n\t    </table>\n\t    </form>`,$(u).html(r),$(u).find(".js9-binning-full").on("click",function(){!function t(n,a,l,c){let d=JS9.GetImage({display:c}),h=$(l).find(".js9BinningForm")[0],p=d.fileDimensions();h.xcen.value=0,h.ycen.value=0,h.xdim.value=n>0?n:p.xdim,h.ydim.value=a>0?a:p.ydim,e(l,c)}(0,0,u,f)}),$(u).find(".js9-binning-rebin").on("click",function(){e(u,f)}),$(u).find(".js9-binning-close").on("click",function(){m&&m.close()}),$(u).find(".js9-binning-sep").change(function(){h.sep=$(this).prop("checked")}),$(u).find(".js9-binning-sep").prop("checked",!!h.sep),$(u).find(".js9-binning-cubecol").on("input",function(){d=!!$(this).val()||!!h.sep,$(u).find(".js9-binning-sep").prop("checked",d)}),"table"===w.imtab&&w.hdus&&w.hdus.length){for(n=0;n<w.hdus.length;n++)if("EVENTS"===w.hdus[n].name||"STDEVT"===w.hdus[n].name){l=w.hdus[n].cols;break}if(l&&l.length){for(c=$(u).find(".js9-binning-hdulist"),c.append('<option value="" disabled=disabled>List columns</option>'),n=0;n<l.length;n++)a=`${l[n].name}:${l[n].type}`,JS9.notNull(l[n].min)&&JS9.notNull(l[n].max)&&(a+=`:${l[n].min}:${l[n].max}`),c.append(`<option>${a}</option>`);c.prop("selectedIndex",0),c.on("change",function(){a=$(this).val().replace(/:.*/,""),JS9.CopyToClipboard(a,w),c.prop("selectedIndex",0)})}}JS9.globalOpts.runOnCR&&$(u).find(".js9BinningForm").data("enterfunc","rebin"),s.call(null,u,f)}}JS9.RegisterPlugin("FITS","Binning",o,{menu:"view",winTitle:"Image Sections, with Binning and Filtering",winResize:!0,menuItem:"Bin/Filter/Section",onplugindisplay:o,onimageload:o,onimagedisplay:o,onsetpan:o,onsetzoom:o,help:"fitsy/binning.html",winDims:[570,375]})}(),JS9.Blend={},JS9.Blend.CLASS="JS9",JS9.Blend.NAME="Blend",JS9.Blend.WIDTH=550,JS9.Blend.HEIGHT=270,JS9.Blend.BASE=JS9.Blend.CLASS+JS9.Blend.NAME,JS9.Blend.blendModeHTML='When <b>Image Blending</b> is turned on, the images you select below will be combined using your chosen blend mode and optional opacity. See <a href="https://www.w3.org/TR/compositing-1/" target="blank">W3C Compositing and Blending</a> for info about compositing and blending.<p> <input type="checkbox" class="blendModeCheck" id="active" name="imageBlending" value="active" onclick="javascript:JS9.Blend.xblendmode(\'%s\', this)"><b>Image Blending</b>',JS9.Blend.imageHTML="<span style='float: left'>$active &nbsp;&nbsp; $blend &nbsp;&nbsp; $opacity</span>&nbsp;&nbsp; <span id='blendFile'>$imfile</span>",JS9.Blend.activeHTML='<input class="blendActiveCheck" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Blend.xactive(\'%s\', \'%s\', this)">blend using:',JS9.Blend.blendHTML='<select class="blendModeSelect JS9Select" onchange="JS9.Blend.xblend(\'%s\', \'%s\', this)"><option selected disabled>blend mode</option><option value="normal">normal</option><option value="screen">screen</option><option value="multiply">multiply</option><option value="overlay">overlay</option><option value="darken">darken</option><option value="lighten">lighten</option><option value="color-dodge">color-dodge</option><option value="color-burn">color-burn</option><option value="hard-light">hard-light</option><option value="soft-light">soft-light</option><option value="difference">difference</option><option value="exclusion">exclusion</option><option value="hue">hue</option><option value="saturation">saturation</option><option value="color">color</option> <option value="luminosity">luminosity</option><option selected disabled>composite mode</option><option value="source-atop">source-atop</option><option value="source-in">source-in</option><option value="source-out">source-out</option><option value="source-over">source-over</option><option value="destination-atop">destination-atop</option><option value="destination-in">destination-in</option><option value="destination-out">destination-out</option><option value="destination-over">destination-over</option></select>',JS9.Blend.opacityHTML='<select class="blendOpacitySelect JS9Select" onchange="JS9.Blend.xopacity(\'%s\', \'%s\', this)"><option selected disabled>opacity</option><option value="1.00">opaque</option><option value="0.95">0.95</option><option value="0.90">0.90</option><option value="0.85">0.85</option><option value="0.80">0.80</option><option value="0.75">0.75</option><option value="0.70">0.70</option><option value="0.65">0.65</option><option value="0.60">0.60</option><option value="0.55">0.55</option><option value="0.50">0.50</option><option value="0.45">0.45</option><option value="0.40">0.40</option><option value="0.35">0.35</option><option value="0.30">0.30</option><option value="0.25">0.25</option><option value="0.20">0.20</option><option value="0.10">0.10</option><option value="0.00">transparent</option></select>',JS9.Blend.imfileHTML="<b>%s</b>",JS9.Blend.nofileHTML='<p><span id="blendNoFile">[Images will appear here as they are loaded]</span>',JS9.Blend.xactive=function(e,t,s){let o;const n=JS9.lookupImage(t,e),a=s.checked;n&&(o=n.blendImage(),o.active!==a&&n.blendImage(a))},JS9.Blend.xblend=function(e,t,s){let o,n;const a=JS9.lookupImage(t,e);s.selectedIndex>=0&&(n=s.options[s.selectedIndex].value),a&&JS9.notNull(n)&&(o=a.blendImage(),o.mode!==n&&a.blendImage(n))},JS9.Blend.xopacity=function(e,t,s){let o,n;const a=JS9.lookupImage(t,e);s.selectedIndex>=0&&(n=s.options[s.selectedIndex].value),a&&JS9.notNull(n)&&(o=a.blendImage(),n=parseFloat(n),o.opacity!==n&&a.blendImage(null,n))},JS9.Blend.xblendmode=function(e,t){const s=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));s&&JS9.BlendDisplay(t.checked,{display:s})},JS9.Blend.imid=function(e){return`${`${e.display.id}_${e.id}`.replace(/[^A-Za-z0-9_]/g,"_")}BlendImage`},JS9.Blend.dispclass=function(e){return`${JS9.Blend.BASE}_${e.display.id}`.replace(/[^A-Za-z0-9_]/g,"_")},JS9.Blend.displayBlend=function(e){let t;e&&(t=e.display,this.divjq.find(".blendModeCheck").prop("checked",t.blendMode))},JS9.Blend.imageBlend=function(e,t){let s,o,n,a,l;o=e.blendImage(),n=JS9.Blend.imid(e),o&&(a=this.divjq.find(`#${n}`),a.find(".blendActiveCheck").prop("checked",o.active),void 0!==o.mode&&(l=a.find(".blendModeSelect").val(o.mode),t&&l.change()),void 0!==o.opacity&&(s="number"==typeof o.opacity?o.opacity.toFixed(2):o.opacity,l=a.find(".blendOpacitySelect").val(s),t&&l.change()))},JS9.Blend.activeImage=function(e){let t,s;e&&(t=JS9.Blend.imid(e),s=`${JS9.Blend.dispclass(e)}_Image`,$(`.${s}`).removeClass(`${JS9.Blend.BASE}ImageActive`).addClass(`${JS9.Blend.BASE}ImageInactive`),$(`#${t}`).removeClass(`${JS9.Blend.BASE}ImageInactive`).addClass(`${JS9.Blend.BASE}ImageActive`))},JS9.Blend.addImage=function(e){let t,s,o,n,a,l;const c=[],d=`${JS9.Blend.BASE}Image`;!e||(l=e.id,a=e.display.id,s=JS9.Blend.imid(e),n=`${JS9.Blend.dispclass(e)}_Image`,c.push({name:"imid",value:l}),c.push({name:"active",value:sprintf(JS9.Blend.activeHTML,a,l)}),c.push({name:"opacity",value:sprintf(JS9.Blend.opacityHTML,a,l)}),c.push({name:"blend",value:sprintf(JS9.Blend.blendHTML,a,l)}),c.push({name:"imfile",value:sprintf(JS9.Blend.imfileHTML,l)}),this.blendDivs||this.blendImageContainer.html(""),t=JS9.Image.prototype.expandMacro.call(e,JS9.Blend.imageHTML,c),o=$("<div>").addClass(d).addClass(n).attr("id",s).prop("imid",l).html(t).appendTo(this.blendImageContainer),o.on("mousedown touchstart",()=>{e.displayImage(),JS9.Blend.activeImage.call(this,e)}),JS9.Blend.imageBlend.call(this,e,!1),JS9.Blend.displayBlend.call(this,e),this.blendDivs++,JS9.Blend.activeImage(e))},JS9.Blend.removeImage=function(e){let t;return!!e&&(t=JS9.Blend.imid(e),$(`#${t}`).remove(),this.blendDivs--,0===this.blendDivs&&this.blendImageContainer.html(JS9.Blend.nofileHTML),!0)},JS9.Blend.init=function(e,t){let s,o,n,a;for("div"===this.winType&&(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Blend.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Blend.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10)),this.divjq.html(""),this.blendDivs=0,this.divjq.addClass("JS9PluginScrolling"),this.blendContainer=$("<div>").addClass(`${JS9.Blend.BASE}Container`).attr("id",`${this.id}BlendContainer`).appendTo(this.divjq),this.blendHeader=$("<div>").addClass(`${JS9.Blend.BASE}Header`).attr("id",`${this.display.id}Header`).html(sprintf(JS9.Blend.blendModeHTML,this.display.id)).appendTo(this.blendContainer),this.blendImageContainer=$("<div>").addClass(`${JS9.Blend.BASE}ImageContainer`).attr("id",`${this.id}BlendImageContainer`).html(JS9.Blend.nofileHTML).appendTo(this.blendContainer),a=JS9.getDynamicDisplayOr(this.display),n=a.blendMode,a.blendMode=!1,s=0;s<JS9.images.length;s++)o=JS9.images[s],o.display===a&&JS9.Blend.addImage.call(this,o);a.blendMode=n,a.image&&a.image.displayImage(),this.divjq.find(".blendModeCheck").prop("checked",!!a.blendMode),this.blendImageContainer.sortable({start:(l,c)=>{this.oidx=c.item.index()},stop:(l,c)=>{const d=c.item.index();this.display.moveImageInStack(this.oidx,d),this.display.image&&this.display.image.displayImage(),delete this.oidx}})},JS9.Blend.dysel=function(){let e;const t=JS9.getDynamicDisplayOr("previous");t&&(e=t.blendMode,t.blendMode=!1,t.image&&t.image.displayImage()),JS9.Blend.init.call(this),t&&(t.blendMode=e)},JS9.Blend.displayblend=function(e){e&&JS9.Blend.displayBlend.call(this,e)},JS9.Blend.imageblend=function(e){e&&JS9.Blend.imageBlend.call(this,e,!1)},JS9.Blend.imageload=function(e){const t=JS9.getDynamicDisplayOr(this.display);e&&e.display===t&&JS9.Blend.addImage.call(this,e)},JS9.Blend.imagedisplay=function(e){JS9.Blend.activeImage.call(this,e)},JS9.Blend.imageclose=function(e){JS9.Blend.removeImage.call(this,e)},JS9.Blend.sessionload=function(e){e&&JS9.Blend.init.call(this)},JS9.RegisterPlugin(JS9.Blend.CLASS,JS9.Blend.NAME,JS9.Blend.init,{menuItem:"Blending",dynamicSelect:!0,onplugindisplay:JS9.Blend.init,ondynamicselect:JS9.Blend.dysel,ondisplayblend:JS9.Blend.displayblend,onimageblend:JS9.Blend.imageblend,onimageload:JS9.Blend.imageload,onimagedisplay:JS9.Blend.imagedisplay,onimageclose:JS9.Blend.imageclose,onsessionload:JS9.Blend.sessionload,help:"help/blend.html",winTitle:"Image Blending",winResize:!0,winDims:[JS9.Blend.WIDTH,JS9.Blend.HEIGHT]}),JS9.Blink={},JS9.Blink.CLASS="JS9",JS9.Blink.NAME="Blink",JS9.Blink.WIDTH=512,JS9.Blink.HEIGHT=270,JS9.Blink.BASE=JS9.Blink.CLASS+JS9.Blink.NAME,JS9.Blink.rate=1e3,JS9.Blink.blinkModeHTML="When <b>Blink Images</b> is turned on, selected images will be displayed at the specified blink rate. You also can blink the selected images manually. The blink sequence can be changed by moving images around in the stack. <p>$mode&nbsp;&nbsp;&nbsp;&nbsp;$rate&nbsp;&nbsp;&nbsp;&nbsp;$manual",JS9.Blink.modeHTML='<input type="checkbox" id="active" name="blinkImages" value="active" onclick="javascript:JS9.Blink.xblinkmode(\'%s\', this)"><b>Blink Images</b>',JS9.Blink.rateHTML='<select class="JS9Select" id="blinkRateSelect" onfocus="this.selectedIndex=0;" onchange="JS9.Blink.xrate(\'%s\',this)"><option selected disabled>blink rate</option><option value="0.1">0.1</option><option value="0.25">0.25</option><option value="0.5">0.5</option><option value="1.0">1.0</option><option value="2.0">2.0</option><option value="3.0">3.0</option><option value="4.0">4.0</option><option value="5.0">5.0</option><option value="6.0">6.0</option><option value="7.0">7.0</option><option value="8.0">8.0</option><option value="9.0">9.0</option><option value="10.0">10.0</option><option value="15.0">15.0</option><option value="20.0">20.0</option><option value="30.0">30.0</option></select>',JS9.Blink.manualHTML='<input type="button" class="JS9Button2" id="manual" name="manualBlink" value="blink manually" onclick="javascript:JS9.Blink.xblink1(\'%s\', this)">',JS9.Blink.imageHTML="<span style='float: left'>$active&nbsp;&nbsp;</span><span id='blinkFile'>$imfile</span>",JS9.Blink.activeHTML='<input class="blinkActiveCheck" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Blink.xactive(\'%s\', \'%s\', this)">blink',JS9.Blink.imfileHTML="<b>%s</b>",JS9.Blink.nofileHTML='<p><span id="blinkNoFile">[Images will appear here as they are loaded]</span>',JS9.Blink.start=function(e){let t,s,o=!1;const n=e.pluginInstances.JS9Blink;if(n){for(s=n.idx;!o;)t=JS9.images[n.idx],t.display===e&&t.tmp.blinkMode&&(t.displayImage("display"),o=!0),++n.idx>=JS9.images.length&&(n.idx=0),n.idx===s&&(o=!0);e.blinkMode&&(e.pluginInstances.JS9Blink.tid=window.setTimeout(()=>{JS9.Blink.start(e)},n.rate))}},JS9.Blink.stop=function(e){const t=e.pluginInstances.JS9Blink;!t||(t.tid&&(window.clearTimeout(t.tid),delete t.tid),e.blinkMode=!1,t.idx=0)},JS9.Blink.xactive=function(e,t,s){const o=JS9.lookupImage(t,e);o&&(o.tmp.blinkMode=s.checked)},JS9.Blink.xblinkmode=function(e,t){const s=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e)),o=t.checked;s&&($(".blinkActive").prop("disabled",!o),o?(s.blinkMode=!0,JS9.Blink.start(s)):JS9.Blink.stop(s))},JS9.Blink.xblink1=function(e,t){const s=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e)),o=s?s.pluginInstances.JS9Blink:null;!o||!s||(JS9.images[o.idx]===s.image&&++o.idx>=JS9.images.length&&(o.idx=0),JS9.Blink.start(s))},JS9.Blink.xrate=function(e,t){const s=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e)),o=s?s.pluginInstances.JS9Blink:null,n=Math.floor(1e3*t.options[t.selectedIndex].value);!o||!s||Number.isNaN(n)||(o.rate=n)},JS9.Blink.imid=function(e){return`${`${e.display.id}_${e.id}`.replace(/[^A-Za-z0-9_]/g,"_")}BlinkImage`},JS9.Blink.dispclass=function(e){return`${JS9.Blink.BASE}_${e.display.id}`.replace(/[^A-Za-z0-9_]/g,"_")},JS9.Blink.activeImage=function(e){let t,s;e&&(t=JS9.Blink.imid(e),s=`${JS9.Blink.dispclass(e)}_Image`,$(`.${s}`).removeClass(`${JS9.Blink.BASE}ImageActive`).addClass(`${JS9.Blink.BASE}ImageInactive`),$(`#${t}`).removeClass(`${JS9.Blink.BASE}ImageInactive`).addClass(`${JS9.Blink.BASE}ImageActive`))},JS9.Blink.addImage=function(e){let t,s,o,n,a,l;const c=[],d=`${JS9.Blink.BASE}Image`;!e||(l=e.id,a=e.display.id,s=JS9.Blink.imid(e),n=`${JS9.Blink.dispclass(e)}_Image`,c.push({name:"imid",value:e.id}),c.push({name:"active",value:sprintf(JS9.Blink.activeHTML,a,l)}),c.push({name:"imfile",value:sprintf(JS9.Blink.imfileHTML,l)}),this.blinkDivs||this.blinkImageContainer.html(""),t=e.expandMacro(JS9.Blink.imageHTML,c),o=$("<div>").addClass(d).addClass(n).attr("id",s).prop("imid",l).html(t).appendTo(this.blinkImageContainer),o.on("mousedown touchstart",()=>{e.displayImage(),JS9.Blink.activeImage.call(this,e)}),this.blinkDivs++,e.tmp.blinkMode=!1,JS9.Blink.activeImage(e))},JS9.Blink.removeImage=function(e){let t;return!!e&&(t=JS9.Blink.imid(e),$(`#${t}`).remove(),this.blinkDivs--,0===this.blinkDivs&&this.blinkImageContainer.html(JS9.Blink.nofileHTML),delete e.tmp.blinkMode,!0)},JS9.Blink.init=function(){let e,t,s,o,n;const a=[];for(void 0===this.idx&&(this.idx=0),void 0===this.rate&&(this.rate=JS9.Blink.rate),this.divjq.html(""),this.blinkDivs=0,this.divjq.addClass("JS9PluginScrolling"),this.blinkContainer=$("<div>").addClass(`${JS9.Blink.BASE}Container`).attr("id",`${this.id}BlinkContainer`).css("overflow","auto").appendTo(this.divjq),n=this.display.id,a.push({name:"mode",value:sprintf(JS9.Blink.modeHTML,n)}),a.push({name:"manual",value:sprintf(JS9.Blink.manualHTML,n)}),a.push({name:"rate",value:sprintf(JS9.Blink.rateHTML,n)}),t=JS9.Image.prototype.expandMacro.call(null,JS9.Blink.blinkModeHTML,a),this.blinkHeader=$("<div>").addClass(`${JS9.Blink.BASE}Header`).attr("id",`${n}Header`).html(t).appendTo(this.blinkContainer),this.blinkImageContainer=$("<div>").addClass(`${JS9.Blink.BASE}ImageContainer`).attr("id",`${this.id}BlinkImageContainer`).html(JS9.Blink.nofileHTML).appendTo(this.blinkContainer),o=JS9.getDynamicDisplayOr(this.display),o.blinkMode=!1,e=0;e<JS9.images.length;e++)s=JS9.images[e],s.display===o&&JS9.Blink.addImage.call(this,s);this.blinkImageContainer.sortable({start:(l,c)=>{this.oidx=c.item.index()},stop:(l,c)=>{const d=c.item.index();this.display.moveImageInStack(this.oidx,d),this.display.image&&this.display.image.displayImage(),delete this.oidx}})},JS9.Blink.dysel=function(){const e=JS9.getDynamicDisplayOr("previous");e&&JS9.Blink.stop(e),JS9.Blink.init.call(this)},JS9.Blink.imageload=function(e){const t=JS9.getDynamicDisplayOr(this.display);e&&e.display===t&&JS9.Blink.addImage.call(this,e)},JS9.Blink.imagedisplay=function(e){JS9.Blink.activeImage.call(this,e)},JS9.Blink.imageclose=function(e){JS9.Blink.removeImage.call(this,e)},JS9.RegisterPlugin(JS9.Blink.CLASS,JS9.Blink.NAME,JS9.Blink.init,{menuItem:"Blinking",dynamicSelect:!0,onplugindisplay:JS9.Blink.init,ondynamicselect:JS9.Blink.dysel,onimageload:JS9.Blink.imageload,onimagedisplay:JS9.Blink.imagedisplay,onimageclose:JS9.Blink.imageclose,help:"help/blink.html",winTitle:"Image Blinking",winResize:!0,winDims:[JS9.Blink.WIDTH,JS9.Blink.HEIGHT]}),JS9.Cmaps={},JS9.Cmaps.CLASS="JS9",JS9.Cmaps.NAME="Cmaps",JS9.Cmaps.WIDTH=600,JS9.Cmaps.HEIGHT=270,JS9.Cmaps.BASE=JS9.Cmaps.CLASS+JS9.Cmaps.NAME,JS9.Cmaps.DEFMODE="equidistant",JS9.Cmaps.DEFNMAP=3,JS9.Cmaps.DEFASSIGN=!0,JS9.Cmaps.DEFNAME="cmap",JS9.Cmaps.DEFTOL=Math.pow(8,2),JS9.Cmaps.DEFTIMEOUT=0,JS9.Cmaps.COLORCLASS="cmapsColorPicker",JS9.Cmaps.CMAPCLASS="cmapsSelect",JS9.Cmaps.CHECKCLASS="cmapsActiveCheck",JS9.Cmaps.headerHTML=`Select a color&nbsp;&nbsp;<input type="color" value="#FF0000" class="${JS9.Cmaps.COLORCLASS}">&nbsp;&nbsp;or a &nbsp;&nbsp;<select class="${JS9.Cmaps.CMAPCLASS} JS9Select" onchange="JS9.Cmaps.xCmap('%s',this)"></select>&nbsp;&nbsp;colormap to create&nbsp;&nbsp;<input type="number" onchange="JS9.Cmaps.xNslice('%s',this)" value="${JS9.Cmaps.DEFNMAP}" min="1" max="36" size="3" style="width:40px;box-sizing: border-box;">&nbsp;&nbsp;<select class="cmapsMode JS9Select" onchange="JS9.Cmaps.xMode('%s',this)">&nbsp;&nbsp;<option value="equidistant">equidistant</option><option value="analogous">analogous</option></select><p>slices of the <a href="https://en.wikipedia.org/wiki/Color_wheel" target="_blank">colorwheel</a>,&nbsp;&nbsp;the first&nbsp;&nbsp;<input type="number" onchange="JS9.Cmaps.xNmap('%s',this)" value="${JS9.Cmaps.DEFNMAP}" min="1" max="36" size="3" style="width:40px;box-sizing: border-box;">&nbsp;of which will be used to create colormaps.<p><input type="checkbox" onchange="JS9.Cmaps.xAssignCmaps('%s',this)" checked> assign the new colormaps to these images:`,JS9.Cmaps.imageHTML="<span style='float: left'>$active</span>&nbsp;&nbsp; <span style='float: right'>$imfile</span>",JS9.Cmaps.activeHTML=`<input class="${JS9.Cmaps.CHECKCLASS}" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Cmaps.xActive('%s', '%s', this)">&nbsp;`,JS9.Cmaps.imfileHTML="<b>%s</b>",JS9.Cmaps.nofileHTML='<div class="JS9cmapsNoFile">[Colormap generation options will appear here after an image is loaded]</div>',JS9.Cmaps.equidistant=function(e,t,s){let o;const n=tinycolor(e).toHsl(),a=n.h,l=360/s,c=[];for(o=0;o<t;o++)n.h=(a+o*l)%360,c.push(tinycolor(n));return c},JS9.Cmaps.mkColors=function(e,t,s,o){if(t&&s&&o)switch(e=e||"equidistant",e){case"analogous":return tinycolor(t).analogous(s,o);case"equidistant":return JS9.Cmaps.equidistant(tinycolor(t),s,o);default:return[tinycolor(t)]}},JS9.Cmaps.assignCmaps=function(e){let t,s,o=0;const a=`.${JS9.Cmaps.CHECKCLASS}`;!e.cmaps.names||!e.cmaps.names.length||(s=e.cmaps.that.cmapsImageContainer,s.length&&(t=e.cmaps.names.length,s.find(`.${JS9.Cmaps.BASE}Image`).each((l,c)=>{const d=$(c),h=d.prop("imid"),p=JS9.lookupImage(h),g=d.find(a);p&&o<t&&g.prop("checked")&&(p.setColormap(e.cmaps.names[o++]),p.displayImage())})))},JS9.Cmaps.mkCmapsFromCmap=function(e,t,s,o,n){let a,l,c,d,h,p,g,v,r;const u=[],f=[],m=[],b="rgb (%s,%s,%s)",w=x=>[x.r/255,x.g/255,x.b/255];if(t&&s&&o)switch(n=n||{},v=n.mode||JS9.Cmaps.DEFMODE,r=t.name,e.cmaps.names=[],t.type){case"lut":for(a=0;a<s;a++)e.cmaps.names[a]=`${r}_${String(a+1)}`,u[a]=[];for(a=0;a<t.colors.length;a++)for(h=sprintf(b,Math.floor(255*t.colors[a][0]+.5),Math.floor(255*t.colors[a][1]+.5),Math.floor(255*t.colors[a][2]+.5)),d=JS9.Cmaps.mkColors(v,h,s,o),l=0;l<s;l++)u[l].push(w(d[l].toRgb()));for(a=0;a<s;a++)(t=JS9.lookupColormap(e.cmaps.names[a],!1))?t.colors=u[a]:JS9.AddColormap(e.cmaps.names[a],u[a],{toplevel:!1});n.assign&&JS9.Cmaps.assignCmaps(e);break;case"sao":for(a=0;a<s;a++)e.cmaps.names[a]=`${t.name}_${String(a+1)}`,f[a]=[[],[],[]];for(a=0;a<3;a++)for(l=0;l<t.vertices[a].length;l++)p=t.vertices[a][l][0],g=JS9.Colormap.prototype.mkColorCell.call(t,p*JS9.COLORSIZE),m.push({index:p,rgb:g});for(m.sort((x,y)=>x.index>y.index?1:x.index<y.index?-1:0),a=m.length-2;a>=0;a--)m[a].index===m[a+1].index&&m.splice(a+1,1);for(a=0;a<m.length;a++)for(h=sprintf(b,m[a].rgb[0],m[a].rgb[1],m[a].rgb[2]),d=JS9.Cmaps.mkColors(v,h,s,o),l=0;l<s;l++)c=w(d[l].toRgb()),f[l][0].push([m[a].index,c[0]]),f[l][1].push([m[a].index,c[1]]),f[l][2].push([m[a].index,c[2]]);for(a=0;a<s;a++)(t=JS9.lookupColormap(e.cmaps.names[a],!1))?t.vertices=f[a]:JS9.AddColormap(e.cmaps.names[a],f[a][0],f[a][1],f[a][2],{toplevel:!1});n.assign&&JS9.Cmaps.assignCmaps(e)}},JS9.Cmaps.mkCmapsFromColor=function(e,t,s,o,n){let a,l,c,d,h,p;if(t&&s&&o){if(h=(n=n||{}).mode||"equidistant",p=e.id||JS9.Cmaps.DEFNAME,c=void 0!==n.rgbtol?n.rgbtol:e.cmaps.tol,a=tinycolor(t),l=a.toRgb(),d=Math.pow(Math.abs(l.r-e.cmaps.orgb.r),2)+Math.pow(Math.abs(l.g-e.cmaps.orgb.g),2)+Math.pow(Math.abs(l.b-e.cmaps.orgb.b),2),d<c||e.cmaps.timeOutID)return 0;e.cmaps.timeOutID=window.setTimeout(()=>{let g,v,r;for(e.cmaps.names=[],v=JS9.Cmaps.mkColors(h,a,s,o),e.cmaps.orgb.r=l.r,e.cmaps.orgb.g=l.g,e.cmaps.orgb.b=l.b,g=0;g<s;g++)if(l=v[g].toRgb(),e.cmaps.names[g]=`${p}_${String(g+1)}`,r=JS9.lookupColormap(e.cmaps.names[g],!1),r)switch(r.type){case"lut":r.type="sao",r.vertices=[[[0,0],[1,l.r/255]],[[0,0],[1,l.g/255]],[[0,0],[1,l.b/255]]];break;case"sao":r.vertices=[[[0,0],[1,l.r/255]],[[0,0],[1,l.g/255]],[[0,0],[1,l.b/255]]]}else JS9.AddColormap(e.cmaps.names[g],[[0,0],[1,l.r/255]],[[0,0],[1,l.g/255]],[[0,0],[1,l.b/255]],{toplevel:!1});n.assign&&JS9.Cmaps.assignCmaps(e),e.cmaps.timeOutID=null},JS9.Cmaps.DEFTIMEOUT)}},JS9.Cmaps.mkCmaps=function(e,t,s,o,n){let a;if(!t||!s||!o)return 0;a=JS9.lookupColormap(t,!1),a?JS9.Cmaps.mkCmapsFromCmap(e,a,s,o,n):JS9.Cmaps.mkCmapsFromColor(e,t,s,o,n)},JS9.Cmaps.xActive=function(e){const t=JS9.lookupDisplay(e);!t||t.cmaps.assign&&JS9.Cmaps.assignCmaps(t)},JS9.Cmaps.xMode=function(e,t){const s=JS9.lookupDisplay(e);!s||(s.cmaps.mode=t.options[t.selectedIndex].value,JS9.Cmaps.mkCmaps(s,s.cmaps.lastCname,s.cmaps.nmap,s.cmaps.nslice,{mode:s.cmaps.mode,assign:s.cmaps.assign,rgbtol:0}))},JS9.Cmaps.xNmap=function(e,t){const s=JS9.lookupDisplay(e);!s||(s.cmaps.nmap=parseInt(t.value,10)||1,JS9.Cmaps.mkCmaps(s,s.cmaps.lastCname,s.cmaps.nmap,s.cmaps.nslice,{mode:s.cmaps.mode,assign:s.cmaps.assign,rgbtol:0}))},JS9.Cmaps.xNslice=function(e,t){const s=JS9.lookupDisplay(e);!s||(s.cmaps.nslice=parseInt(t.value,10)||1,JS9.Cmaps.mkCmaps(s,s.cmaps.lastCname,s.cmaps.nmap,s.cmaps.nslice,{mode:s.cmaps.mode,assign:s.cmaps.assign,rgbtol:0}))},JS9.Cmaps.xCmap=function(e,t){const s=JS9.lookupDisplay(e),o=t.options[t.selectedIndex].value;!s||(JS9.Cmaps.mkCmaps(s,o,s.cmaps.nmap,s.cmaps.nslice,{mode:s.cmaps.mode,assign:s.cmaps.assign,rgbtol:0}),s.cmaps.lastCname=o)},JS9.Cmaps.xAssignCmaps=function(e,t){const s=JS9.lookupDisplay(e);!s||(s.cmaps.assign=$(t).prop("checked"),s.cmaps.assign&&JS9.Cmaps.assignCmaps(s))},JS9.Cmaps.imid=function(e){return`${`${e.display.id}_${e.id}`.replace(/[^A-Za-z0-9_]/g,"_")}CmapsImage`},JS9.Cmaps.dispclass=function(){return`${JS9.Cmaps.BASE}_${this.display.id}`.replace(/[^A-Za-z0-9_]/g,"_")},JS9.Cmaps.activeImage=function(e){let t,s;e&&(t=JS9.Cmaps.imid.call(this,e),s=`${JS9.Cmaps.dispclass.call(this)}_Image`,$(`.${s}`).removeClass(`${JS9.Cmaps.BASE}ImageActive`).addClass(`${JS9.Cmaps.BASE}ImageInactive`),$(`#${t}`).removeClass(`${JS9.Cmaps.BASE}ImageInactive`).addClass(`${JS9.Cmaps.BASE}ImageActive`))},JS9.Cmaps.addImage=function(e){let t,s,o,n,a,l;const c=[],d=`${JS9.Cmaps.BASE}Image`;!e||(l=e.id,a=this.display.id,s=JS9.Cmaps.imid.call(this,e),n=`${JS9.Cmaps.dispclass.call(this)}_Image`,c.push({name:"imid",value:l}),c.push({name:"active",value:sprintf(JS9.Cmaps.activeHTML,a,l)}),c.push({name:"imfile",value:sprintf(JS9.Cmaps.imfileHTML,l)}),t=JS9.Image.prototype.expandMacro.call(e,JS9.Cmaps.imageHTML,c),o=$("<div>").addClass(d).addClass(n).addClass(`${JS9.Cmaps.BASE}ImageInactive`).prop("id",s).prop("imid",l).html(t).appendTo(this.cmapsImageContainer),o.on("mousedown touchstart",()=>{a===e.display.id&&(e.displayImage(),JS9.Cmaps.activeImage.call(this,e))}),this.display.id===e.display.id&&JS9.Cmaps.activeImage.call(this,e))},JS9.Cmaps.removeImage=function(e){let t;return!!e&&(t=JS9.Cmaps.imid.call(this,e),$(`#${t}`).remove(),!0)},JS9.Cmaps.init=function(e,t){let s,o,n,a,l;const c=`.${JS9.Cmaps.COLORCLASS}`,d=`.${JS9.Cmaps.CMAPCLASS}`,h=this.display;if(this.divjq.addClass("JS9PluginScrolling"),"div"===this.winType&&(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Cmaps.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Cmaps.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10)),JS9.colormaps&&JS9.colormaps.length){for(h.cmaps||(h.cmaps={},h.cmaps.mode=JS9.Cmaps.DEFMODE,h.cmaps.nmap=JS9.Cmaps.DEFNMAP,h.cmaps.nslice=JS9.Cmaps.DEFNMAP,h.cmaps.assign=JS9.Cmaps.DEFASSIGN,h.cmaps.tol=JS9.Cmaps.DEFTOL,h.cmaps.lastCname=null,h.cmaps.names=[],h.cmaps.ims=[],h.cmaps.orgb={r:0,g:0,b:0},h.cmaps.that=this),this.divjq.html(""),this.cmapsContainer=$("<div>").addClass(`${JS9.Cmaps.BASE}Container`).attr("id",`${this.id}CMapsContainer`).appendTo(this.divjq),o=this.display.id,n=sprintf(JS9.Cmaps.headerHTML,o,o,o,o,o),this.cmapsHeader=$("<div>").addClass(`${JS9.Cmaps.BASE}Header`).attr("display",this.display.id).attr("id",`${this.display.id}CMapsHeader`).html(n).appendTo(this.cmapsContainer),this.cmapsImageContainer=$("<div>").addClass(`${JS9.Cmaps.BASE}ImageContainer`).attr("id",`${this.id}CmapsImageContainer`).appendTo(this.cmapsContainer),s=0;s<JS9.images.length;s++)JS9.Cmaps.addImage.call(this,JS9.images[s]);this.cmapsImageContainer.sortable({start:(p,g)=>{this.oidx=g.item.index()},stop:(p,g)=>{const v=g.item.index();this.display.moveImageInStack(this.oidx,v),this.display.image&&this.display.image.displayImage(),delete this.oidx}}),a=this.cmapsContainer.find(c),l=this.cmapsContainer.find(d),l.each(()=>{let p,g;for(p=0;p<JS9.colormaps.length;p++)g=JS9.colormaps[p].name,$(d).append($("<option>",{value:g,text:g}))}),h.cmaps.inited||((!JS9.globalOpts.internalColorPicker||!$.fn.spectrum.inputTypeColorSupport())&&(a.spectrum({showButtons:!1,showInput:!0,preferredFormat:"hex6"}),a.on("move.spectrum",(p,g)=>{const v=g.toHex();JS9.Cmaps.mkCmaps(h,v,h.cmaps.nmap,h.cmaps.nslice,{mode:h.cmaps.mode,assign:h.cmaps.assign}),h.cmaps.lastCname=v}),a.on("change",p=>{const g=tinycolor($(p.currentTarget).val()).toHex();JS9.Cmaps.mkCmaps(h,g,h.cmaps.nmap,h.cmaps.nslice,{mode:h.cmaps.mode,assign:h.cmaps.assign}),h.cmaps.lastCname=g})),a.on("input",p=>{const g=p.target.value;$(p.target).parent().attr("display")===h.id&&(JS9.Cmaps.mkCmaps(h,g,h.cmaps.nmap,h.cmaps.nslice,{mode:h.cmaps.mode,assign:h.cmaps.assign}),h.cmaps.lastCname=g)}),h.cmaps.inited=!0)}else this.divjq.html(JS9.Cmaps.nofileHTML)},JS9.Cmaps.imageload=function(e){let t,s,o;for(this.display.cmaps?JS9.Cmaps.addImage.call(this,e):JS9.Cmaps.init.call(this),t=0;t<JS9.displays.length;t++)s=JS9.displays[t],s.image&&s.id!==e.display.id&&(o=s.pluginInstances.JS9Cmaps,o&&o.isActive("onimageload")&&JS9.Cmaps.addImage.call(o,e))},JS9.Cmaps.imagedisplay=function(e){JS9.Cmaps.activeImage.call(this,e)},JS9.Cmaps.imageclose=function(e){let t,s,o;for(JS9.Cmaps.removeImage.call(this,e),t=0;t<JS9.displays.length;t++)s=JS9.displays[t],s.image&&s.id!==e.display.id&&(o=s.pluginInstances.JS9Cmaps,o&&o.isActive("onimageclose")&&JS9.Cmaps.removeImage.call(o,e))},JS9.RegisterPlugin(JS9.Cmaps.CLASS,JS9.Cmaps.NAME,JS9.Cmaps.init,{menuItem:"Colormaps",help:"help/cmaps.html",onimageload:JS9.Cmaps.imageload,onimagedisplay:JS9.Cmaps.imagedisplay,onimageclose:JS9.Cmaps.imageclose,winTitle:"Create Colormaps",winResize:!0,winDims:[JS9.Cmaps.WIDTH,JS9.Cmaps.HEIGHT]}),JS9.Colorbar={},JS9.Colorbar.CLASS="JS9",JS9.Colorbar.NAME="Colorbar",JS9.Colorbar.WIDTH=512,JS9.Colorbar.HEIGHT=40,JS9.Colorbar.BASE=JS9.Colorbar.CLASS+JS9.Colorbar.NAME,JS9.Colorbar.SCALED=!1,JS9.Colorbar.TICKS=10,JS9.Colorbar.COLORBARHEIGHT=16,JS9.Colorbar.MAXLABELSIZE=10,JS9.Colorbar.STATICSIZE=4,JS9.Colorbar.STATICPADDING=3,JS9.Colorbar.INFINITY=10,JS9.Colorbar.display=function(e){let t,s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b;const w=[],A=this.colorbarWidth,x=this.colorbarHeight,y=this.ctx.getImageData(0,0,A,x),S=y.data,_=4*A,C=new Uint8Array(S.buffer,0,_),I=(L,D,O,M)=>{this.textctx.textAlign="center",this.textctx.beginPath(),this.textctx.moveTo(L,D),this.textctx.lineWidth=1,this.textctx.lineTo(L,D+5),this.textctx.stroke(),M&&this.textctx.fillText(O,L,D+15)};if(e.staticObj){for(v=0,r=0,t=0;t<e.staticObj.colors.length;t++)f=e.staticObj.colors[t],f.min<v&&(f.max===-1/0?v-=JS9.Colorbar.INFINITY:v=f.min),f.max>r&&(f.max===1/0?r+=JS9.Colorbar.INFINITY:r=f.max);for(a=(r-v)/A,t=0,s=0;t<A;t++,s+=4)u=Math.floor(t*a),f=JS9.lookupStaticColor(e,u),S[s]=f.red,S[s+1]=f.green,S[s+2]=f.blue,S[s+3]=f.alpha}else{if(l=this.scaled?e.psColors:e.colorCells,!l||e.useOffScreenCanvas())return void JS9.Colorbar.imageclear.call(this,e);for(a=l.length/A,t=0,s=0;t<A;t++,s+=4)n=Math.floor(t*a),S[s]=l[n][0],S[s+1]=l[n][1],S[s+2]=l[n][2],S[s+3]=255}for(t=1;t<x;t++)S.set(C,t*_);if(this.ctx.putImageData(y,0,0),this.showTicks)if(this.textctx.clear(),e.staticObj&&e.staticObj.colors.length<this.ticks)for(o=JS9.floatPrecision(v,r),p=-99999,t=0;t<e.staticObj.colors.length;t++)f=e.staticObj.colors[t],m=JS9.floatFormattedString(f.min,o,0),d=Math.ceil(f.min/a)+1,h=0,Math.abs(d-p)<=JS9.Colorbar.STATICPADDING||m.length>=JS9.Colorbar.STATICSIZE&&t%2==0?b=!1:(p=d,b=!0),I(d,h,m,b);else{for(a=e.psInverse.length/this.ticks,o=JS9.floatPrecision(Math.min(e.params.scalemin,e.psInverse[0]),Math.max(e.params.scalemax,e.psInverse[e.psInverse.length-1])),s=0;s<5;s++){for(g=!0,t=0;t<this.ticks;t++)c=e.psInverse[Math.floor(t*a)],w[t]=JS9.floatFormattedString(c,o,s);for(t=1;t<this.ticks;t++)w[t-1]===w[t]&&(g=!1);if(g)break}for(t=1;t<this.ticks;t++)t>1&&w[t]===w[t-1]||(d=t/this.ticks*this.width,h=0,b=!(w[t].length>=JS9.Colorbar.MAXLABELSIZE&&t%2==0),I(d,h,w[t],b))}},JS9.Colorbar.init=function(e,t){const s=JS9.PIXEL_RATIO||1;this.showTicks=this.divjq.attr("data-showTicks"),this.showTicks=void 0===this.showTicks||"true"===this.showTicks,this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Colorbar.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=this.showTicks?t||JS9.Colorbar.HEIGHT:t||JS9.Colorbar.COLORBARHEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.colorbarWidth=this.width,this.colorbarHeight=parseInt(this.divjq.attr("data-colorbarHeight"),10),this.colorbarHeight||(this.colorbarHeight=JS9.Colorbar.COLORBARHEIGHT),this.colorbarHeight=Math.min(this.height,this.colorbarHeight),this.scaled=this.divjq.attr("data-scaled"),this.scaled=void 0===this.scaled?JS9.Colorbar.SCALED:"true"===this.scaled,this.ticks=this.divjq.attr("data-ticks"),this.ticks||(this.ticks=JS9.Colorbar.TICKS),this.divjq.html(""),this.colorbarContainer=$("<div>").addClass(`${JS9.Colorbar.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),this.colorbarjq=$("<canvas>").addClass(`${JS9.Colorbar.BASE}Canvas`).attr("id",`${this.id}Canvas`).attr("width",this.width-1).attr("height",this.colorbarHeight).appendTo(this.colorbarContainer),this.ctx=this.colorbarjq[0].getContext("2d"),this.showTicks&&(this.textjq=$("<canvas>").addClass(`${JS9.Colorbar.BASE}TextCanvas`).attr("id",`${this.id}TextCanvas`).attr("width",this.width*s).attr("height",(this.height-this.colorbarHeight)*s).css("width",`${this.width}px`).css("height",this.height-this.colorbarHeight+"px").appendTo(this.colorbarContainer),this.textctx=this.textjq[0].getContext("2d"),this.colorbarFont=this.divjq.attr("data-colorbarFont"),this.colorbarFont?this.textctx.font=this.colorbarFont:JS9.Colorbar.COLORBARFONT&&(this.textctx.font=JS9.Colorbar.COLORBARFONT),this.textctx.setTransform(s,0,0,s,0,0)),this.display.image&&JS9.Colorbar.display.call(this,this.display.image)},JS9.Colorbar.imagedisplay=function(e){e&&JS9.Colorbar.display.call(this,e)},JS9.Colorbar.imageclear=function(e){e&&e===e.display.image&&(this.ctx&&this.ctx.clear(),this.textctx&&this.textctx.clear())},JS9.Colorbar.dynamic=function(e){let t;e&&(t=e.display.pluginInstances.JS9Colorbar,t&&t.isDynamic&&JS9.Colorbar.imagedisplay.call(this,e))},JS9.RegisterPlugin(JS9.Colorbar.CLASS,JS9.Colorbar.NAME,JS9.Colorbar.init,{menuItem:"Colorbar",dynamicSelect:!0,ondynamicselect:JS9.Colorbar.dynamic,onimagedisplay:JS9.Colorbar.imagedisplay,onimageclear:JS9.Colorbar.imageclear,onimageclose:JS9.Colorbar.imageclear,help:"help/colorbar.html",winTitle:"Colorbar",winDims:[JS9.Colorbar.WIDTH,JS9.Colorbar.HEIGHT]}),JS9.Color={},JS9.Color.CLASS="JS9",JS9.Color.NAME="Color",JS9.Color.WIDTH=512,JS9.Color.HEIGHT=140,JS9.Color.BASE=JS9.Color.CLASS+JS9.Color.NAME,JS9.Color.RUNMENU=!0,JS9.Color.colorHTML="<p><div class='JS9ColorLinegroup'>$cmaps1&nbsp;&nbsp;$cmaps2&nbsp;&nbsp;$cmaps&nbsp;&nbsp;$filters</div>\n<p>\n<div class='JS9ColorLinegroup'>$conbibtn&nbsp;&nbsp;$contrast&nbsp;&nbsp;$bias</div>\n<p>\n<div class='JS9ColorLinegroup'>$run&nbsp;&nbsp;$opacity&nbsp;&nbsp;$from&nbsp;&nbsp;$opfloor&nbsp;&nbsp;$opopacity&nbsp;&nbsp;$opoverlay&nbsp;&nbsp;$opmask</div>",JS9.Color.cmaps1HTML="<select class=\"JS9Select JS9Cmaps1 JS9ColorSelect JS9ColorCol1\" name=\"cmaps1\" onchange=\"JS9.Color.xsetcolor('%s', '%s', 'top', this)\">%s</select>",JS9.Color.cmaps2HTML="<select class=\"JS9Select JS9Cmaps2 JS9ColorSelect JS9ColorCol2\" name=\"cmaps2\" onchange=\"JS9.Color.xsetcolor('%s', '%s', 'other', this)\">%s</select>",JS9.Color.cmapsHTML='<input type="button" class="JS9Button2 JS9ColorCmaps JS9ColorButton JS9ColorCol3" name="cmaps" value="Create cmaps" onclick="javascript:JS9.DisplayPlugin(\'JS9Cmaps\', {\'display\': \'%s\'})">',JS9.Color.filtersHTML='<input type="button" class="JS9Button2 JS9ColorFilters JS9ColorButton JS9ColorCol4" name="filters" value="Image filters" onclick="javascript:JS9.DisplayPlugin(\'JS9Filters\', {\'display\': \'%s\'})">',JS9.Color.conbibtnHTML='<input type="button" class="JS9Button2 JS9ColorConBiBtn JS9ColorButton JS9ColorCol1" name="conbibtn" value="Contrast/bias &rarr;" onclick="javascript:JS9.Color.xconbi(\'%s\', \'%s\', this)">',JS9.Color.contrastHTML='<input type="text" class="JS9ColorContrast JS9ColorInput JS9ColorCol2 js9Input" name="contrast" value="%s" autocapitalize="off" autocorrect="off" placeholder="contrast">',JS9.Color.biasHTML='<input type="text" class="JS9ColorBias JS9ColorInput JS9ColorCol3 js9Input" name="bias" value="%s" autocapitalize="off" autocorrect="off" placeholder="bias">',JS9.Color.runHTML='<input type="button" class="JS9Button2 JS9ColorRun JS9ColorButton JS9ColorCol1" name="run" value="Opacity &rarr;" onclick="javascript:JS9.Color.xopacity(\'%s\', \'%s\', this)">',JS9.Color.opacityHTML='<input type="text" class="JS9ColorOpacity JS9ColorInput JS9ColorCol2 js9Input" name="opacity" value="" autocapitalize="off" autocorrect="off">',JS9.Color.fromHTML='<select class="JS9Select JS9ColorFrom JS9ColorSelect JS9ColorCol3" name="from" onchange="JS9.Color.xfrom(\'%s\', \'%s\', this)">%s</select>',JS9.Color.opfloorHTML='<input type="text" class="JS9ColorOpFloor JS9ColorInput JS9ColorCol4 js9Input" name="opfloor" value="%s" autocapitalize="off" autocorrect="off">',JS9.Color.opopacityHTML="<select class=\"JS9Select JS9ColorOpOpacity JS9ColorSelect JS9ColorCol4\" name=\"opopacity\" onchange=\"JS9.Color.xsetfile('%s', '%s', 'opacity', this)\">%s</select>",JS9.Color.opoverlayHTML="<select class=\"JS9Select JS9ColorOpOverlay JS9ColorSelect JS9ColorCol4\" name=\"opoverlay\" onchange=\"JS9.Color.xsetfile('%s', '%s', 'overlay', this)\">%s</select>",JS9.Color.opmaskHTML="<select class=\"JS9Select JS9ColorOpMask JS9ColorSelect JS9ColorCol4\" name=\"opmask\" onchange=\"JS9.Color.xsetfile('%s', '%s', 'mask', this)\">%s</select>",JS9.Color.fmt=function(e,t){return(e+=.5*Math.pow(10,-(t+1))).toFixed(t)},JS9.Color.xsetcolor=function(e,t,s,o){const n=JS9.lookupImage(t,e);if(n)switch("object"==typeof o&&n.setColormap(o.value),s){case"top":"string"==typeof o&&$(".JS9Cmaps1 option").filter((a,l)=>$(l).text().trim()===o).prop("selected",!0),$(".JS9Cmaps2").prop("selectedIndex",0);break;case"other":"string"==typeof o&&$(".JS9Cmaps2 option").filter((a,l)=>$(l).text().trim()===o).prop("selected",!0),$(".JS9Cmaps1").prop("selectedIndex",0)}},JS9.Color.xconbi=function(e,t,s){let o,n,a;const l=JS9.lookupImage(t,e);l&&(a=$(s).parent(),o=a.find("[name='contrast']").val(),n=a.find("[name='bias']").val(),JS9.isNumber(o)&&JS9.isNumber(n)&&l.setColormap(parseFloat(o),parseFloat(n)))},JS9.Color.xopacity=function(e,t,s){let o,n,a,l;const c=$(s).parent(),d=c.find("[name='from']").val(),h=JS9.lookupImage(t,e);if(h){switch(l=h.display.pluginInstances.JS9Color,d){case"floor":l.lastfrom.match(/mask|global/)?o=String(h.params.flooropacity):(o=c.find("[name='opacity']").val(),void 0===o&&(o=String(h.params.flooropacity))),n=c.find("[name='opfloor']").val(),o.match(/resetall/)?h.setOpacity("resetall"):!o||o.match(/reset/)?h.setOpacity("resetfloor"):JS9.isNumber(o)&&JS9.isNumber(n)&&h.setOpacity(parseFloat(n),parseFloat(o));break;case"opacity":case"overlay":case"mask":o=c.find(`[name='op${d}']`).val(),"none"!==o&&(a={mode:d},"mask"===d&&(l.lastfrom.match(/floor|global/)?n=String(h.mask.vopacity||0):(n=c.find("[name='opacity']").val(),void 0===n&&(n=String(h.mask.vopacity||0))),o&&JS9.isNumber(n)&&(a.opacity=parseFloat(n))),h.maskImage(o,a));break;default:l.lastfrom.match(/floor|mask/)?o=String(h.getOpacity().opacity):(o=c.find("[name='opacity']").val(),void 0===o&&(o=String(h.getOpacity().opacity))),o.match(/resetall/)?h.setOpacity("resetall"):!o||o.match(/reset/)?h.setOpacity("reset"):JS9.isNumber(o)&&h.setOpacity(parseFloat(o))}JS9.Color.refrom.call(l,h),JS9.Color.reopacity.call(l,h)}},JS9.Color.xfrom=function(e,t,s){let o;const n=$(s).parent(),a=s.value,l=JS9.lookupImage(t,e);l&&(o=l.display.pluginInstances.JS9Color,JS9.Color.refrom.call(o,l),JS9.Color.reopacity.call(o,l),o.runmenu&&n.find("[name='run']").click(),o.lastfrom=a)},JS9.Color.xsetfile=function(e,t,s,o){let n,a;const l=$(o).parent(),c=JS9.lookupImage(t,e);c&&("none"===o.value?c.maskImage(!1):("mask"===(n={mode:s},s)&&(a=l.find("[name='opacity']").val(),JS9.isNumber(a)&&(n.opacity=parseFloat(a))),c.maskImage(o.value,n)))},JS9.Color.reconbi=function(){let e;const t=this.colorContainer;this.display.image&&(e=this.display.image.getColormap(),t.find("[name='contrast']").val(JS9.Color.fmt(e.contrast,4)),t.find("[name='bias']").val(JS9.Color.fmt(e.bias,4)))},JS9.Color.refrom=function(e){let t;const s=this.colorContainer;if(t=s.find("[name='from']").val()||"global",e=e||this.display.image)switch(t){case"global":s.find(".JS9ColorOpacity").css("display","block").attr("placeholder","global opacity"),s.find(".JS9ColorOpFloor").css("display","none"),s.find(".JS9ColorOpOpacity").css("display","none"),s.find(".JS9ColorOpOverlay").css("display","none"),s.find(".JS9ColorOpMask").css("display","none");break;case"floor":s.find(".JS9ColorOpacity").css("display","block").attr("placeholder","floor opacity"),s.find(".JS9ColorOpFloor").css("display","block").attr("placeholder","floor value"),s.find(".JS9ColorOpOpacity").css("display","none"),s.find(".JS9ColorOpOverlay").css("display","none"),s.find(".JS9ColorOpMask").css("display","none");break;case"opacity":s.find(".JS9ColorOpacity").css("display","none"),s.find(".JS9ColorOpFloor").css("display","none"),s.find(".JS9ColorOpOpacity").css("display","block"),s.find(".JS9ColorOpOverlay").css("display","none"),s.find(".JS9ColorOpMask").css("display","none");break;case"overlay":s.find(".JS9ColorOpacity").css("display","none"),s.find(".JS9ColorOpFloor").css("display","none"),s.find(".JS9ColorOpOpacity").css("display","none"),s.find(".JS9ColorOpOverlay").css("display","block"),s.find(".JS9ColorOpMask").css("display","none");break;case"mask":s.find(".JS9ColorOpacity").css("display","block").attr("placeholder","non-mask opacity"),s.find(".JS9ColorOpFloor").css("display","none"),s.find(".JS9ColorOpOpacity").css("display","none"),s.find(".JS9ColorOpOverlay").css("display","none"),s.find(".JS9ColorOpMask").css("display","block")}},JS9.Color.reopacity=function(e){let t,s,o,n;const a=this.colorContainer;if(t=a.find("[name='from']").val()||"global",e=e||this.display.image){switch(t){case"floor":s=e.getOpacity(),o=s.flooropacity,n=s.floorvalue,n&&(n=JS9.Color.fmt(n,4)),a.find("[name='opfloor']").val(n);break;case"opacity":case"overlay":return void(o="");case"mask":o=e.mask.vopacity||0;break;default:o=e.getOpacity().opacity}"number"==typeof o&&(o=JS9.Color.fmt(o,4)),a.find("[name='opacity']").val(o)}},JS9.Color.display=function(){let e,t=this.display.image;t&&t===this.lastimage?(e=t.display.pluginInstances.JS9Color,JS9.Color.refrom.call(e,t),JS9.Color.reopacity.call(e,t)):JS9.Color.init.call(this)},JS9.Color.close=function(){JS9.Color.init.call(this,{mode:"clear"})},JS9.Color.init=function(e){let t,s,o,n,a,l,c,d,h;const u=(f,m)=>{let b,w,A,x;for(w=`<option selected disabled>${m} files</option>\n\t       <option value="none" selected>none</option>`,b=0;b<JS9.images.length;b++)A=JS9.images[b],A!==f&&(A.raw.width!==f.raw.width||A.raw.height!==f.raw.height||(x=f.mask.active&&f.mask.im===A?"selected":"",w+=`<option value="${A.id}" ${x}>${A.id}</option>`));return w};e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Color.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Color.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.runmenu=this.divjq.attr("data-runmenu"),void 0===this.runmenu&&(this.runmenu=JS9.Color.RUNMENU),this.lastfrom="",this.divjq.html(""),this.colorContainer=$("<div>").addClass(`${JS9.Color.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),o=this.display.image,o&&"clear"!==e.mode?(a=o.id,l=o.display.id,n=[],s=sprintf(JS9.Color.cmaps1HTML,l,a,(()=>{let f,m,b="<option selected disabled>Top cmaps</option>";for(f=0;f<JS9.globalOpts.topColormaps.length;f++)m=JS9.globalOpts.topColormaps[f],b+=`<option>${m}</option>`;return b})()),n.push({name:"cmaps1",value:s}),s=sprintf(JS9.Color.cmaps2HTML,l,a,(()=>{let f,m,b="<option selected disabled>Other cmaps</option>";for(f=0;f<JS9.colormaps.length;f++)m=JS9.colormaps[f].name,JS9.globalOpts.topColormaps.includes(m)||(b+=`<option>${m}</option>`);return b})()),n.push({name:"cmaps2",value:s}),s=sprintf(JS9.Color.cmapsHTML,l),n.push({name:"cmaps",value:s}),s=sprintf(JS9.Color.filtersHTML,l),n.push({name:"filters",value:s}),s=sprintf(JS9.Color.conbibtnHTML,l,a),n.push({name:"conbibtn",value:s}),s=sprintf(JS9.Color.contrastHTML,o.getColormap().contrast),n.push({name:"contrast",value:s}),s=sprintf(JS9.Color.biasHTML,o.getColormap().bias),n.push({name:"bias",value:s}),s=sprintf(JS9.Color.runHTML,l,a),n.push({name:"run",value:s}),s=sprintf(JS9.Color.opacityHTML),n.push({name:"opacity",value:s}),s=sprintf(JS9.Color.fromHTML,l,a,(f=>{let m,b="",w="",A="",x="",y="";if(f&&f.mask.active&&f.mask.im)switch(f.mask.mode){case"mask":w="selected";break;case"opacity":b="selected";break;case"overlay":A="selected"}else f&&void 0!==f.params.flooropacity?x="selected":y="selected";return m=`<option disabled>mode:</option>\n\t       <option value="global" ${y}>default</option>\n\t       <option value="floor" ${x}>floor &le;&nbsp;&nbsp;&rarr;</option>\n\t       <option value="mask" ${w}>mask &rarr;</option>\n\t       <option value="opacity" ${b}>opacity &rarr;</option>\n\t       <option value="overlay" ${A}>overlay &rarr;</option>`,m})(o)),n.push({name:"from",value:s}),s=sprintf(JS9.Color.opfloorHTML,(f=>{let m="";return f&&(m=f.params.floorvalue||""),m})(o)),n.push({name:"opfloor",value:s}),s=sprintf(JS9.Color.opopacityHTML,l,a,u(o,"opacity")),n.push({name:"opopacity",value:s}),s=sprintf(JS9.Color.opoverlayHTML,l,a,u(o,"overlay")),n.push({name:"opoverlay",value:s}),s=sprintf(JS9.Color.opmaskHTML,l,a,u(o,"mask")),n.push({name:"opmask",value:s}),t=o.expandMacro(JS9.Color.colorHTML,n),this.lastimage=o):t="<p><center>Color parameters will appear here.</center>",this.colorContainer.html(t),o&&(JS9.globalOpts.runOnCR&&(this.colorContainer.find("[name='contrast']").data("enterfunc","conbibtn"),this.colorContainer.find("[name='bias']").data("enterfunc","conbibtn"),this.colorContainer.find("[name='opacity']").data("enterfunc","run"),this.colorContainer.find("[name='opfloor']").data("enterfunc","run")),JS9.Color.reopacity.call(this,o),JS9.Color.refrom.call(this,o),c=o.getColormap(),d=c.colormap,h=JS9.globalOpts.topColormaps.includes(d)?"top":"other",JS9.Color.xsetcolor(o.display.id,o.id,h,d))},JS9.RegisterPlugin(JS9.Color.CLASS,JS9.Color.NAME,JS9.Color.init,{menu:"color",menuItem:"Color Controls ...",onplugindisplay:JS9.Color.init,onsetcolormap:JS9.Color.init,onchangecontrastbias:JS9.Color.reconbi,onsetopacity:JS9.Color.reopacity,onimagedisplay:JS9.Color.display,onimageclose:JS9.Color.close,help:"help/colorcontrols.html",winTitle:"Color Controls",winDims:[JS9.Color.WIDTH,JS9.Color.HEIGHT]}),JS9.Console={},JS9.Console.CLASS="JS9",JS9.Console.NAME="Console",JS9.Console.WIDTH=512,JS9.Console.HEIGHT=300,JS9.Console.HTML="<table class='JS9CmdTable'><tr class='JS9Tr'><td><div id='JS9CmdPrompt' class='JS9CmdPrompt'>@@PR@@</div></td><td class='JS9CmdTd'><input type='text' class='JS9CmdIn' autocapitalize='off' autocorrect='off' autocomplete='off' value='' /></td></tr></table>",JS9.Console.init=function(e,t){this.display.conMode=2,this.hist=[],this.histpos=0,this.histtemp=0,this.consoleConjq=$("<div>").addClass("JS9ConsoleContainer").appendTo(this.divjq),"light"!==this.winType&&(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.CONWIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.CONHEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.consoleConjq.css("width",this.width).css("height",this.height)),this.consoleConjq.attr("tabindex","0"),this.consoleConjq.on("keydown",this,s=>JS9.Console.keyDownCB(s)),JS9.Console.out.call(this,"Type 'help' for a list of commands","info"),JS9.Console.inp.call(this)},JS9.Console.inp=function(){let e;return this.consoleConjq.find(".JS9CmdIn:last").attr("readonly","readonly"),this.consoleConjq.append(JS9.Console.HTML.replace(/@@PR@@/g,"js9>")),e=this.consoleConjq.find(".JS9CmdIn:last"),e.focus().attr("autocapitalize","off").attr("autocorrect","off").attr("autocomplete","off"),JS9.jupyterFocus(e.parent()),this},JS9.Console.out=function(e,t){switch(t.toLowerCase()){case"error":e=`ERROR: ${e}`,t="Error";break;case"info":t="Info";break;default:t="Out"}return $("<div>").addClass(`JS9Cmd${t}`).html(e).appendTo(this.consoleConjq),this},JS9.Console.xeq=function(){let e,t,s,o;const n=this.consoleConjq.find(".JS9CmdIn:last").val(),a=n.trim().split(/\s+/),l=[];if(!a[0])return this;for(t=a[0],e=1;e<a.length;e++)a[e].match(/^"\s*"$/)||a[e].match(/^'\s*'$/)?l.push(""):l.push(a[e]);(!this.hist.length||n!==this.hist[this.hist.length-1])&&this.hist.push(n),this.histpos=this.hist.length;try{if(s=JS9.lookupCommand(t),s)switch(s.getDisplayInfo(this.display),s.getWhich(l)){case"get":o=s.get(l)||"",JS9.Console.out.call(this,o,"ok");break;case"set":o=s.set(l),o&&JS9.Console.out.call(this,o,"ok");break;default:o=`unknown cmd type for '${t}'`,JS9.error(o)}else if(JS9.publics[t]){if(l.push({display:this.display}),o=JS9.publics[t](...l)||"","object"==typeof o)if(o instanceof JS9.Display||o instanceof JS9.Image)o="";else try{o=JSON.stringify(o)}catch{o=""}"string"==typeof o&&"OK"!==o&&(o.match(/^ERROR:/)?JS9.error(o):JS9.Console.out.call(this,o,"ok"))}else o=`unknown command '${t}'`,l.length>0&&(o=`${o} ${l}`),JS9.error(o)}catch(c){JS9.Console.out.call(this,c.message,"error")}return this},JS9.Console.keyDownCB=function(e){let t;const s=e.data,o=e.which||e.keyCode;if(!JS9.specialKey(e)){if(t=s.consoleConjq.find(".JS9CmdIn:last"),t.focus(),s.hist.length&&(38===o||40===o)){switch(s.hist[s.histpos]?s.hist[s.histpos]=t.val():s.histtemp=t.val(),o){case 38:s.histpos--,s.histpos<0&&(s.histpos=0);break;case 40:s.histpos++,s.histpos>s.hist.length&&(s.histpos=s.hist.length);break;default:JS9.error("internal keycode switch mixup")}t.val(s.hist[s.histpos]?s.hist[s.histpos]:s.histtemp)}13===o&&(JS9.globalOpts.alerts=!1,JS9.Console.xeq.call(s),JS9.globalOpts.alerts=!0,JS9.Console.inp.call(s))}},JS9.RegisterPlugin("JS9","Console",JS9.Console.init,{menuItem:"Console",help:"help/console.html",winTitle:"Console",winResize:!0,winDims:[JS9.Console.WIDTH,JS9.Console.HEIGHT]}),JS9.Cube={},JS9.Cube.CLASS="JS9",JS9.Cube.NAME="Cube",JS9.Cube.WIDTH=512,JS9.Cube.HEIGHT=240,JS9.Cube.BASE=JS9.Cube.CLASS+JS9.Cube.NAME,JS9.Cube.cubeHTML="<div class='JS9CubeLinegroup'>$header</div><p><div class='JS9CubeLinegroup'><span class='JS9CubeSpan' style='float: left'>$range&nbsp;&nbsp;$value&nbsp;&nbsp;$value2&nbsp;&nbsp;$extname</span><span class='JS9CubeSpan' style='float: right'>$order</span></div><div class='JS9CubeLinegroup'><span class='JS9CubeSpan' style='float: left'>$first&nbsp;$next&nbsp;$prev&nbsp;$last</span><span class='JS9CubeSpan' style='float: right'>$blink&nbsp;$stop&nbsp;$rate</span></div><p><div class='JS9CubeLinegroup'>$header2</div><p><div class='JS9CubeLinegroup'><span class='JS9CubeSpan' style='float: left'>$load</span></div>",JS9.Cube.headerHTML="Use the slider, text box, navigation or blink buttons to display a slice of a <b>FITS data cube</b>. Use the menu at the right to specify the slice axis.",JS9.Cube.rangeHTML='<span class="JS9CubeRangeLine">1<input type="range" min="%s" max="%s" value="%s" class="JS9CubeRange" onchange="JS9.Cube.xrange(\'%s\', \'%s\', this)">%s</span>',JS9.Cube.valueHTML='<input type="text" class="JS9CubeValue" min="%s" max="%s" value="%s" onchange="JS9.Cube.xvalue(\'%s\', \'%s\', this)" size="4">',JS9.Cube.value2HTML='<input type="text" class="JS9CubeValue2" min="%s" max="%s" value="%s" onchange="JS9.Cube.xvalue2(\'%s\', \'%s\', this)" size="8">',JS9.Cube.firstHTML='<input type="button" class="JS9CubeBtn JS9Button2" value="First" onclick="JS9.Cube.xfirst(\'%s\', \'%s\', this)">',JS9.Cube.nextHTML='<input type="button" class="JS9CubeBtn JS9Button2" value="Next" onclick="JS9.Cube.xnext(\'%s\', \'%s\', this)">',JS9.Cube.prevHTML='<input type="button" class="JS9CubeBtn JS9Button2" value="Prev" onclick="JS9.Cube.xprev(\'%s\',\'%s\', this)">',JS9.Cube.lastHTML='<input type="button" class="JS9CubeBtn JS9Button2" value="Last" onclick="JS9.Cube.xlast(\'%s\', \'%s\', this)">',JS9.Cube.blinkHTML='<input type="button" class="JS9CubeBtn JS9Button2" value="Blink" onclick="JS9.Cube.xstart(\'%s\', \'%s\', this)">',JS9.Cube.stopHTML='<input type="button" class="JS9CubeBtn JS9Button2" value="Stop" onclick="JS9.Cube.xstop(\'%s\', \'%s\', this)">',JS9.Cube.extnameHTML='<span class="JS9CubeRangeLine">%s</span>',JS9.Cube.orderHTML='<select class="JS9CubeOrder JS9Select" onchange="JS9.Cube.xorder(\'%s\', \'%s\', this)"><option value="$slice:*:*">$slice : * : *</option><option value="*:$slice:*">* : $slice : *</option><option value="*:*:$slice">* : * : $slice</option></select>',JS9.Cube.rateHTML='<select class="JS9CubeRate JS9Select" onchange="JS9.Cube.xrate(\'%s\', \'%s\', this)"><option selected disabled>Rate</option><option value=".1">0.1 sec</option><option value=".25">0.25 sec</option><option value=".5">0.5 sec</option><option value="1" default>1 sec</option><option value="2">2 sec</option><option value="5">5 sec</option></select>',JS9.Cube.header2HTML="Or load each slice separately into JS9:",JS9.Cube.loadHTML='<input type="button" class="JS9CubeBtn JS9Button2" value="Load All" onclick="JS9.Cube.loadall(\'%s\',\'%s\', this)">',JS9.Cube.pix2wcs=function(e){return(e-this.smin)*this.cdelt+this.crval},JS9.Cube.wcs2pix=function(e){return Math.floor((e-this.crval)/this.cdelt+this.smin)},JS9.Cube.doSlice=function(e,t,s){let o,n,a;const l={},c=e.display.pluginInstances[JS9.Cube.BASE];if(!e.parentFile||!c.inProcess){for(a=JS9.Cube.pix2wcs.call(c,t),o=0;o<s.length;o++)"2"===(n=s[o],n.charAt(n.length-1))?c.divjq.find(s[o]).val(a):c.divjq.find(s[o]).val(t);n=e.expandMacro(c.slice,[{name:"slice",value:t}]),c.sval=t,c.inProcess=!0,e.displaySlice(n,l,()=>{c.inProcess=!1})}},JS9.Cube.xrange=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=parseInt(s.value,10),JS9.Cube.doSlice(n,o,[".JS9CubeValue",".JS9CubeValue2"]))},JS9.Cube.xvalue=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=parseInt(s.value,10),JS9.Cube.doSlice(n,o,[".JS9CubeValue2",".JS9CubeRange"]))},JS9.Cube.xvalue2=function(e,t,s){let o,n;const a=JS9.lookupImage(t,e);a&&(n=a.display.pluginInstances[JS9.Cube.BASE],o=JS9.Cube.wcs2pix.call(n,parseInt(s.value,10)),JS9.Cube.doSlice(a,o,[".JS9CubeValue",".JS9CubeRange"]))},JS9.Cube.xfirst=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=1,JS9.Cube.doSlice(n,1,[".JS9CubeValue",".JS9CubeValue2",".JS9CubeRange"]))},JS9.Cube.xnext=function(e,t,s){let o,n,a,l;const c=JS9.lookupImage(t,e);c&&(l=c.raw.header,a=c.display.pluginInstances[JS9.Cube.BASE],n=a.sval+1,o=`NAXIS${a.sidx}`,n>l[o]&&(n=1),JS9.Cube.doSlice(c,n,[".JS9CubeValue",".JS9CubeValue2",".JS9CubeRange"]))},JS9.Cube.xprev=function(e,t,s){let o,n,a,l;const c=JS9.lookupImage(t,e);c&&(l=c.raw.header,a=c.display.pluginInstances[JS9.Cube.BASE],n=a.sval-1,n<1&&(o=`NAXIS${a.sidx}`,n=l[o]),JS9.Cube.doSlice(c,n,[".JS9CubeValue",".JS9CubeValue2",".JS9CubeRange"]))},JS9.Cube.xlast=function(e,t,s){let o,n,a,l;const c=JS9.lookupImage(t,e);c&&(l=c.raw.header,a=c.display.pluginInstances[JS9.Cube.BASE],o=`NAXIS${a.sidx}`,n=l[o],JS9.Cube.doSlice(c,n,[".JS9CubeValue",".JS9CubeValue2",".JS9CubeRange"]))},JS9.Cube.xorder=function(e,t,s){let o,n,a,l;const c=JS9.lookupImage(t,e);if(c){for(l=c.raw.header,a=c.display.pluginInstances[JS9.Cube.BASE],a.slice=s.value,n=a.slice.split(/[ ,:]/),o=0;o<n.length;o++)"*"!==n[o]&&(a.sidx=o+1,a.sval=1,a.smin=1,a.smax=l[`NAXIS${a.sidx}`]);$(".JS9CubeRange").prop("max",a.smax),JS9.Cube.doSlice(c,a.sval,[".JS9CubeValue",".JS9CubeValue2",".JS9CubeRange"])}},JS9.Cube.blink=function(e,t,s,o){let n;const a=JS9.lookupImage(t,e);if(a){if(o=o||0,n=a.display.pluginInstances[JS9.Cube.BASE],!1===n.blinkMode)return void delete n.blinkMode;JS9.Cube.xnext(e,t,s),JS9.isNull(n.blinkMode)&&(n.blinkMode=!0),JS9.Cube.tid=window.setTimeout(()=>{o&&"error"===a.status.displaySection?delete n.blinkMode:JS9.Cube.blink(e,t,s,++o)},n.rate)}},JS9.Cube.xstart=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=n.display.pluginInstances[JS9.Cube.BASE],o.blinkMode||JS9.Cube.blink(e,t,s))},JS9.Cube.xstop=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=n.display.pluginInstances[JS9.Cube.BASE],o.inProcess=!1,o.blinkMode&&(o.tid&&(window.clearTimeout(o.tid),delete o.tid),o.blinkMode=!1))},JS9.Cube.xrate=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=n.display.pluginInstances[JS9.Cube.BASE],o.rate=Math.floor(1e3*parseFloat(s.value)))},JS9.Cube.loadall=function(e,t,s){const o=JS9.lookupImage(t,e);o&&o.displaySlice("all")},JS9.Cube.display=function(){this.lastimage!==this.display.image&&JS9.Cube.init.call(this)},JS9.Cube.close=function(){JS9.Cube.init.call(this,{mode:"clear"})},JS9.Cube.init=function(e){let t,s,o,n,a,l,c,d,h;if(e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Cube.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Cube.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.cubeWidth=this.width,this.cubeHeight=parseInt(this.divjq.attr("data-cubeHeight"),10),this.cubeHeight||(this.cubeHeight=JS9.Cube.CUBEHEIGHT),o=this.display.image,o&&"clear"!==e.mode){if(d=o.raw.header,l=o.id,c=o.display.id,h=o.raw.hdu.slice,h)for(this.slice=h.replace(/[0-9][0-9]*/,"$slice"),n=h.split(/[ ,:]/),t=0;t<n.length;t++)"*"!==n[t]&&(this.sidx=t+1,this.smin=1,this.smax=d[`NAXIS${this.sidx}`],this.sval=parseInt(n[t],10));else this.slice="*:*:$slice",this.smin=1,this.smax=d.NAXIS3,this.sidx=3,this.sval=1;JS9.notNull(d[`CRPIX${this.sidx}`])&&JS9.notNull(d[`CRVAL${this.sidx}`])&&JS9.notNull(d[`CDELT${this.sidx}`])?(this.crpix=parseFloat(d[`CRPIX${this.sidx}`]),this.crval=parseFloat(d[`CRVAL${this.sidx}`]),this.cdelt=parseFloat(d[`CDELT${this.sidx}`])):(delete this.crpix,delete this.crval,delete this.cdelt),this.rate||(this.rate=1e3),JS9.notNull(this.tid)&&(window.clearTimeout(this.tid),delete this.tid),JS9.notNull(this.blinkMode)&&delete this.blinkMode,d.NAXIS>2?(a=[],a.push({name:"header",value:JS9.Cube.headerHTML}),a.push({name:"range",value:sprintf(JS9.Cube.rangeHTML,this.smin,this.smax,this.sval,c,l,this.smax)}),a.push({name:"value",value:sprintf(JS9.Cube.valueHTML,this.smin,this.smax,this.sval,c,l)}),a.push({name:"value2",value:sprintf(JS9.Cube.value2HTML,JS9.Cube.pix2wcs.call(this,this.smin),JS9.Cube.pix2wcs.call(this,this.smax),JS9.Cube.pix2wcs.call(this,this.sval),c,l)}),a.push({name:"first",value:sprintf(JS9.Cube.firstHTML,c,l)}),a.push({name:"next",value:sprintf(JS9.Cube.nextHTML,c,l)}),a.push({name:"prev",value:sprintf(JS9.Cube.prevHTML,c,l)}),a.push({name:"last",value:sprintf(JS9.Cube.lastHTML,c,l)}),a.push({name:"blink",value:sprintf(JS9.Cube.blinkHTML,c,l)}),a.push({name:"stop",value:sprintf(JS9.Cube.stopHTML,c,l)}),a.push({name:"order",value:sprintf(JS9.Cube.orderHTML,c,l)}),a.push({name:"rate",value:sprintf(JS9.Cube.rateHTML,c,l)}),a.push({name:"extname",value:sprintf(JS9.Cube.extnameHTML,d.EXTNAME||"")}),a.push({name:"header2",value:JS9.Cube.header2HTML}),a.push({name:"load",value:sprintf(JS9.Cube.loadHTML,c,l)}),s=o.expandMacro(JS9.Cube.cubeHTML,a)):s="<p><center>This image is not a FITS data cube.</center>",this.lastimage=o}else s="<p><center>FITS cube processing will appear here.</center>";this.divjq.html(""),this.cubeContainer=$("<div>").addClass(`${JS9.Cube.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),this.cubeContainer.html(s),this.divjq.find(".JS9CubeRange").prop("max",this.smax),this.divjq.find(".JS9CubeValue").prop("max",this.smax),this.divjq.find(".JS9CubeOrder").val(this.slice),this.crpix?$(".JS9CubeValue2").show():$(".JS9CubeValue2").hide()},JS9.RegisterPlugin(JS9.Cube.CLASS,JS9.Cube.NAME,JS9.Cube.init,{menuItem:"Data Cube",onplugindisplay:JS9.Cube.init,onimageload:JS9.Cube.init,onimagedisplay:JS9.Cube.display,onimageclose:JS9.Cube.close,help:"help/cube.html",winTitle:"FITS Data Cubes",winDims:[JS9.Cube.WIDTH,JS9.Cube.HEIGHT]}),JS9.Divs={},JS9.Divs.CLASS="JS9",JS9.Divs.NAME="Divs",JS9.Divs.WIDTH=400,JS9.Divs.HEIGHT=146,JS9.Divs.BASE=JS9.Divs.CLASS+JS9.Divs.NAME,JS9.Divs.headerHTML="JS9 plugin divs can be hidden or made visible below.",JS9.Divs.divHTML="<span style='float: left'>$visible&nbsp;&nbsp;</span>&nbsp;&nbsp; <span class='JS9DivsSpan'>$div&nbsp;&nbsp</span>",JS9.Divs.nodivsHTML='<p><span class="JS9NoDivs">[No JS9 divs have been created for this display]</span>',JS9.Divs.visibleHTML='<input class="JS9DivsVisibleCheck" type="checkbox" id="visible" name="visible" value="visible" onclick="javascript:JS9.Divs.xvisible(\'%s\', \'%s\', this)">visible',JS9.Divs.divNameHTML="<b>%s</b>",JS9.Divs.xvisible=function(e,t,s){let o,n;const a=JS9.lookupDisplay(e);a&&(n=a.pluginInstances[t],n&&(o=s.checked?"visible":"hidden",n.divjq.closest(".JS9PluginContainer").css("visibility",o)))},JS9.Divs.addDiv=function(e){let t,s;const o=`${JS9.Divs.BASE}Div`,n=[];!e||!this.display.pluginInstances[e]||(this.ndiv||this.divsDivContainer.html(""),n.push({name:"visible",value:sprintf(JS9.Divs.visibleHTML,this.display.id,e)}),n.push({name:"div",value:sprintf(JS9.Divs.divNameHTML,e)}),t=JS9.Image.prototype.expandMacro.call(null,JS9.Divs.divHTML,n),s=$("<div>").addClass(o).html(t).appendTo(this.divsDivContainer),s.find(".JS9DivsVisibleCheck").prop("checked","visible"===this.display.pluginInstances[e].divjq.css("visibility")),this.ndiv++)},JS9.Divs.init=function(e){let t,s;if(e=e||{},this.divjq.html(""),this.ndiv=0,this.divjq.addClass("JS9PluginScrolling"),this.divsContainer=$("<div>").addClass(`${JS9.Divs.BASE}Container`).attr("id",`${this.id}DivsContainer`).css("overflow","auto").appendTo(this.divjq),this.divsHeader=$("<div>").addClass(`${JS9.Divs.BASE}Header`).attr("id",`${this.display.id}Header`).html(JS9.Divs.headerHTML).appendTo(this.divsContainer),this.divsDivContainer=$("<div>").addClass(`${JS9.Divs.BASE}DivContainer`).attr("id",`${this.id}DivsDivContainer`).html(JS9.Divs.nodivsHTML).appendTo(this.divsContainer),"clear"!==e.mode)for(t of(s=this.display.pluginInstances||{},Object.keys(s)))"div"===s[t].winType&&JS9.Divs.addDiv.call(this,t)},JS9.RegisterPlugin(JS9.Divs.CLASS,JS9.Divs.NAME,JS9.Divs.init,{menuItem:"Show/Hide Plugins",onplugindisplay:JS9.Divs.init,help:"help/divs.html",winTitle:"Show/Hide Plugins",winResize:!0,winDims:[JS9.Divs.WIDTH,JS9.Divs.HEIGHT]}),JS9.Filters={},JS9.Filters.CLASS="JS9",JS9.Filters.NAME="Filters",JS9.Filters.WIDTH=325,JS9.Filters.HEIGHT=520,JS9.Filters.BASE=JS9.Filters.CLASS+JS9.Filters.NAME,JS9.Filters.noargfilters={edge:{def:null},invert:{def:null},luminance:{def:null},median:{def:null},sobel:{def:null}},JS9.Filters.argfilters={blur:{min:0,max:100,step:1,init:0,def:30},brighten:{min:1,max:100,step:1,init:0,def:10},darken:{min:0,max:1,step:.01,init:0,def:.66},duotone:{min:0,max:2,step:1,init:0,def:2},emboss:{min:0,max:100,step:1,init:0,def:100},gamma:{min:0,max:2,step:.01,init:0,def:.2},lighten:{min:1,max:2,step:.01,init:0,def:1.33},noise:{min:0,max:100,step:1,init:0,def:30},pixelate:{min:0,max:20,step:1,init:0,def:2},scatter:{min:0,max:10,step:1,init:0,def:5},sepia:{min:0,max:100,step:1,init:0,def:100},sharpen:{min:0,max:100,step:1,init:0,def:20},solarize:{min:0,max:100,step:1,init:0,def:50}},JS9.Filters.headerHTML='\n<center>\n<div class="JS9FiltersLineheader">\n<span class="JS9FiltersHeader">\nImage Filters:<br>\nclick for default settings or use the sliders\n</span>\n</center>\n</div>\n',JS9.Filters.noargfilterHTML='\n<span class="JS9FiltersName JS9FiltersCol1">\n<input type="button" name="%sbutton" value="%s" class="JS9Button2 JS9FiltersButton" onclick="JS9.Filters.xfilter(this, \'%s\', \'%s\', \'%s\', %s)"></span>\n',JS9.Filters.argfilterHTML='\n<span class="JS9FiltersName JS9FiltersCol1">\n<input type="button" name="%sbutton" value="%s" class="JS9Button2 JS9FiltersButton" onclick="JS9.Filters.xfilter(this, \'%s\', \'%s\', \'%s\', %s)"></span>\n<span class="JS9FiltersRange JS9FiltersCol2"><input type="range" min="%s" max="%s" step="%s" value="%s" name="%s" class="JS9FiltersRange" onchange="JS9.Filters.xgenfilter(\'%s\', \'%s\', \'%s\', this)"></span>\n<span class="JS9FiltersRangeVal">\n<input type="text" name="%sval" class="JS9FiltersValue JS9FiltersCol3" min="0" max="100" value="0" onchange="JS9.Filters.xgenval(\'%s\', \'%s\', \'%s\', this)"></span>\n',JS9.Filters.undoHTML='\n<span class="JS9FiltersUndo JS9FiltersCol1">\n<input type="button" id="undo" name="undo" value="undo" class="JS9FiltersUndoButton JS9Button2" onclick="JS9.Filters.xundo(this, \'%s\', \'%s\')"></span>\n',JS9.Filters.resetHTML='\n<span class="JS9FiltersReset JS9FiltersCol3">\n<input type="button" id="reset" name="reset" value="reset" class="JS9FiltersResetButton JS9Button2" onclick="JS9.Filters.xreset(this, \'%s\', \'%s\')"></span>\n',JS9.Filters.updateval=function(e,t,s){e&&$(e).length>0&&(t?($(e).closest(`.${JS9.Filters.BASE}Container`).find(`[name='${t}']`).prop("value",s),$(e).closest(`.${JS9.Filters.BASE}Container`).find(`[name='${t}val']`).prop("value",s),$(e).closest(`.${JS9.Filters.BASE}Container`).find("[name='undo']").prop("value",`undo ${t}`).css("width","100px")):$(e).closest(`.${JS9.Filters.BASE}Container`).find("[name='undo']").prop("value","undo").css("width","70px"))},JS9.Filters.xfilter=function(e,t,s,o,n){let a,l,c=n;const d=JS9.lookupImage(s,t);if(d){if(a=d.display.pluginInstances[JS9.Filters.BASE],a.stack=a.stack||[],a.stack.length&&a.stack[a.stack.length-1].filter===o?(d.rgb.img.data.set(a.stack[a.stack.length-1].data),a.stack[a.stack.length-1].val=n):(l=new Uint8ClampedArray(d.rgb.img.data),a.stack.push({filter:o,val:n,data:l})),JS9.notNull(n)){switch(o){case"duotone":n=0===n?"r":1===n?"g":"b";break;case"darken":n=1-n}d.filterRGBImage(o,n)}else d.filterRGBImage(o);JS9.Filters.updateval(e,o,c)}},JS9.Filters.xundo=function(e,t,s){let o,n,a,l,c;const d=JS9.lookupImage(s,t);if(d)if(n=d.display.pluginInstances[JS9.Filters.BASE],n.stack&&n.stack.length&&(a=n.stack.pop(),d.rgb.img.data.set(a.data),d.displayImage("display"),JS9.Filters.updateval(e,a.filter,0)),n.stack&&n.stack.length)for(o=0;o<n.stack.length;o++)l=n.stack[o].filter,c=n.stack[o].val,JS9.Filters.updateval(e,l,c);else JS9.Filters.updateval(e,null,null)},JS9.Filters.xreset=function(e,t,s){const o=JS9.lookupImage(s,t);o&&o.filterRGBImage("reset")},JS9.Filters.xgenfilter=function(e,t,s,o){let n;JS9.lookupImage(t,e)&&(n=parseFloat(o.value),JS9.Filters.xfilter(o,e,t,s,n),$(o).closest(`.${JS9.Filters.BASE}Container`).find(`[name='${s}val']`).prop("value",n))},JS9.Filters.xgenval=function(e,t,s,o){let n;JS9.lookupImage(t,e)&&(n=parseFloat(o.value),JS9.Filters.xfilter(o,e,t,s,n),$(o).closest(`.${JS9.Filters.BASE}Container`).find(`[name='${s}']`).prop("value",n))},JS9.Filters.reinit=function(){const e=this.display.pluginInstances[JS9.Filters.BASE];!this.inProcess&&e.stack&&e.stack.length&&(this.inProcess=!0,delete e.stack,JS9.Filters.init.call(this),this.inProcess=!1)},JS9.Filters.display=function(){let e;this.lastimage!==this.display.image&&(e=this.display.pluginInstances[JS9.Filters.BASE],this.inProcess=!0,delete e.stack,JS9.Filters.init.call(this),this.inProcess=!1)},JS9.Filters.close=function(){JS9.Filters.init.call(this,{mode:"clear"})},JS9.Filters.init=function(e){let t,s,o,n,a,l,c,d,h;if(e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Filters.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Filters.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.divjq.html(""),c=JS9.Filters.headerHTML,delete this.stack,this.filtersContainer=$("<div>").addClass(`${JS9.Filters.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),o=this.display.image,o&&"clear"!==e.mode){for(d of(a=o.id,l=o.display.id,n=[],c+="<div class='JS9FiltersLinegroup'>&nbsp;</div>",Object.keys(JS9.Filters.argfilters)))h=JS9.Filters.argfilters[d],n.push({name:d,value:sprintf(JS9.Filters.argfilterHTML,d,d,l,a,d,h.def,h.min,h.max,h.step,h.init,d,l,a,d,d,l,a,d)}),c+=`<div class='JS9FiltersLinegroup'>$${d}</div>`;for(d of Object.keys(JS9.Filters.noargfilters))n.push({name:d,value:sprintf(JS9.Filters.noargfilterHTML,d,d,l,a,d,null,d,l,a,d,d,l,a,d)}),c+=`<div class='JS9FiltersLinegroup'>$${d}</div>`;c+="<div class='JS9FiltersLinegroup'>&nbsp;</div>",c+="<div class='JS9FiltersLinegroup'>$undo $reset</div>",s=sprintf(JS9.Filters.undoHTML,l,a),n.push({name:"undo",value:s}),s=sprintf(JS9.Filters.resetHTML,l,a),n.push({name:"reset",value:s}),t=o.expandMacro(c,n),this.lastimage=o}else t="<p><center>Image filters will appear here.</center>";this.filtersContainer.html(t)},JS9.RegisterPlugin(JS9.Filters.CLASS,JS9.Filters.NAME,JS9.Filters.init,{menuItem:"Image Filters",onplugindisplay:JS9.Filters.init,onchangecontrastbias:JS9.Filters.reinit,onsetpan:JS9.Filters.reinit,onsetcolormap:JS9.Filters.reinit,onimagedisplay:JS9.Filters.display,onimageclose:JS9.Filters.close,help:"help/filters.html",winTitle:"Image Filters",winDims:[JS9.Filters.WIDTH,JS9.Filters.HEIGHT]}),JS9.Imarith={},JS9.Imarith.CLASS="JS9",JS9.Imarith.NAME="Imarith",JS9.Imarith.WIDTH=512,JS9.Imarith.HEIGHT=170,JS9.Imarith.BASE=JS9.Imarith.CLASS+JS9.Imarith.NAME,JS9.Imarith.imageHTML="<div class='JS9ImarithLinegroup'>Choose an op (add, subtract, multiply, divide, min, max) and an operand (number or image) and click Run. Reset will revert to the original data.</div><div class='JS9ImarithLinegroup'><span class='JS9ImarithSpan' style='float: left'><b>$imid</b> &nbsp;&nbsp; $op &nbsp;&nbsp; $arg1 &nbsp;&nbsp; $num</span></div><p><div class='JS9ImarithLinegroup'><span style='float: right'>$cancel $reset $run</span></div>",JS9.Imarith.opHTML='<select class=JS9ImarithOp" onchange="JS9.Imarith.xop(\'%s\', \'%s\', this)"><option value="" selected disabled>op</option><option value="add">add</option><option value="sub">sub</option><option value="mul">mul</option><option value="div">div</option><option value="min">min</option><option value="max">max</option></select>',JS9.Imarith.arg1HTML='<select class="JS9Select JS9ImarithArg1" onchange="JS9.Imarith.xarg1(\'%s\', \'%s\', this)"><option val="" selected disabled>operand</option><option value="num">number &#8594;</option>%s</select>',JS9.Imarith.numHTML='<input type="text" class="JS9ImarithNum" value="" onchange="JS9.Imarith.xnum(\'%s\', \'%s\', this)" size="10" placeholder="number">',JS9.Imarith.cancelHTML='<input type="button" class="JS9Button2 JS9ImarithBtn" value="Cancel" onclick="JS9.Imarith.xcancel(\'%s\', \'%s\', this)">',JS9.Imarith.resetHTML='<input type="button" class="JS9Button2 JS9ImarithBtn" value="Reset" onclick="JS9.Imarith.xreset(\'%s\', \'%s\', this)">',JS9.Imarith.runHTML='<input type="button" class="JS9RunButton JS9ImarithBtn" value="Run" onclick="JS9.Imarith.xrun(\'%s\', \'%s\', this)">',JS9.Imarith.xop=function(e,t,s){const o=s.options[s.selectedIndex].value,n=JS9.lookupImage(t,e);n&&o&&(n.display.pluginInstances.JS9Imarith.op=o)},JS9.Imarith.xarg1=function(e,t,s){const o=JS9.lookupImage(t,e),n=s.options[s.selectedIndex].value;o&&n&&(o.display.pluginInstances.JS9Imarith.arg1=n,"num"===n?$(".JS9ImarithNum").css("visibility","visible"):$(".JS9ImarithNum").css("visibility","hidden"))},JS9.Imarith.xnum=function(e,t,s){const o=JS9.lookupImage(t,e),n=s.value;JS9.isNumber(n)?o.display.pluginInstances.JS9Imarith.num=parseFloat(n):n&&JS9.error(`please enter a real number: ${n}`)},JS9.Imarith.xcancel=function(e,t,s){let o;const n=JS9.lookupDisplay(e);n&&(o=n.pluginInstances.JS9Imarith,o&&o.winHandle&&o.winHandle.close())},JS9.Imarith.xreset=function(e,t,s){const o=JS9.lookupImage(t,e);o&&o.imarithData("reset")},JS9.Imarith.xrun=function(e,t,s){let o,n;const a=JS9.lookupImage(t,e);a&&(n=a.display.pluginInstances.JS9Imarith,(!n.op||!n.arg1)&&JS9.error("please select an operation and an operand"),"num"===n.arg1?(void 0===n.num&&JS9.error("please enter a real number for the operand"),o=n.num):o=n.arg1,a.imarithData(n.op,o))},JS9.Imarith.display=function(){this.lastimage!==this.display.image&&JS9.Imarith.init.call(this)},JS9.Imarith.close=function(){JS9.Imarith.init.call(this,{mode:"clear"})},JS9.Imarith.init=function(e){let t,s,o,n,a,l,c,d="";if(e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Imarith.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Imarith.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.imarithWidth=this.width,this.imarithHeight=parseInt(this.divjq.attr("data-imarithHeight"),10),this.imarithHeight||(this.imarithHeight=JS9.Imarith.IMARITHHEIGHT),delete this.arg1,delete this.op,delete this.num,o=this.display.image,o&&"clear"!==e.mode){for(l=o.id,c=o.display.id,this.lastim=o.id,t=0;t<JS9.images.length;t++)n=JS9.images[t],n!==o&&(d+=`<option value="${n.id}">${n.id}</option>`);a=[],a.push({name:"images",value:d}),a.push({name:"imid",value:l}),a.push({name:"op",value:sprintf(JS9.Imarith.opHTML,c,l)}),a.push({name:"arg1",value:sprintf(JS9.Imarith.arg1HTML,c,l,d)}),a.push({name:"num",value:sprintf(JS9.Imarith.numHTML,c,l)}),a.push({name:"cancel",value:sprintf(JS9.Imarith.cancelHTML,c,l)}),a.push({name:"reset",value:sprintf(JS9.Imarith.resetHTML,c,l)}),a.push({name:"run",value:sprintf(JS9.Imarith.runHTML,c,l)}),s=JS9.Image.prototype.expandMacro.call(o,JS9.Imarith.imageHTML,a),this.lastimage=o}else s="<p><center>Image arithmetic will appear here.</center>";this.divjq.html(""),this.imarithContainer=$("<div>").addClass(`${JS9.Imarith.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),this.imarithContainer.html(s),this.imarithContainer.find(".JS9ImarithNum").css("visibility","hidden")},JS9.RegisterPlugin(JS9.Imarith.CLASS,JS9.Imarith.NAME,JS9.Imarith.init,{menuItem:"Imarith",onplugindisplay:JS9.Imarith.init,onimageload:JS9.Imarith.init,onimagedisplay:JS9.Imarith.display,onimageclose:JS9.Imarith.close,help:"help/imarith.html",winTitle:"Image Arithmetic",winDims:[JS9.Imarith.WIDTH,JS9.Imarith.HEIGHT]}),JS9.Info={},JS9.Info.CLASS="JS9",JS9.Info.NAME="Info",JS9.Info.WIDTH=325,JS9.Info.HEIGHT=250,JS9.Info.REGHEIGHT=75,JS9.Info.opts={infoURL:"./params/info.html",infoObj:{file:'<tr><td><input type="text" class="column0" value="file" readonly="readonly"></td><td colspan="2"><input type="text" name="id" class="input2" value="" readonly="readonly" onclick="this.scrollLeft=this.scrollWidth;"></td></tr>',object:'<tr><td><input type="text" class="column0" value="object" readonly="readonly"></td><td colspan="2"><input type="text" name="object" class="input2" value="" readonly="readonly"></td></tr>',wcscen:'<tr><td><input type="text" class="column0" value="center" readonly="readonly"></td><td colspan="2"><input type="text" name="wcscen" class="input2" value="" readonly="readonly"></td></tr>',wcsfov:'<tr><td><input type="text" class="column0" value="fov" readonly="readonly"></td><td colspan="2"><input type="text" name="wcsfovpix" class="input2" value="" readonly="readonly"></td></tr>',value:'<tr><td><input type="text" class="column0" value="value" readonly="readonly"></td><td colspan="2"><input type="text" name="val" class="input2" value="" readonly="readonly"></td></tr>',impos:'<tr><td><input type="text" class="column0" value="image" readonly="readonly"></td><td colspan="2"><input type="text" name="ipos" class="input2" value="" readonly="readonly"></td></tr>',disppos:'<tr><td><input type="text" class="column0" value="display" readonly="readonly"></td><td colspan="2"><input type="text" name="dpos" class="input2" value="" readonly="readonly"></td></tr>',physpos:'<tr><td><input type="text" class="column0" value="physical" readonly="readonly"></td><td colspan="2"><input type="text" name="ppos" class="input2" value="" readonly="readonly"></td></tr>',wcspos:'<tr><td><input type="text" class="column0" value="wcs" name="wcssys" readonly="readonly"></td><td colspan="2"><input type="text" name="wcspos" class="input2" value="" readonly="readonly"></td></tr>',regions:'<tr><td><input type="text" class="column0" value="regions" readonly="readonly"></td><td colspan="2"><textarea class="text2" name="regions" rows="4" value="" readonly="readonly"></textarea></td></tr>',progress:'<tr><td colspan="2"><div class="JS9Progress"><progress name="progress" class="JS9ProgressBar" value="0" max="100"></progress></div></td></tr>'}},JS9.Info.init=function(){let e,t,s,o,n;if(this.display.image&&this.display.image===this.lastimage)switch(this.display.image.callingPlugin){case"onplugindisplay":case"onimagerefresh":case"onupdateprefs":break;default:return}for(s=JS9.globalOpts.infoBox,o=JS9.Info.opts.infoObj,n='<table name="info" class="js9InfoTable">',e=0;e<s.length;e++)t=s[e],(!(t.match(/^wcs/)&&JS9.globalOpts.infoBoxResize&&this.display.image)||this.display.image.raw.wcs>0)&&(t.match(/^regions/)&&"lightwin"===JS9.globalOpts.regDisplay||t in o&&(n+=o[t]));n+="</table>",this.infoConjq&&this.infoConjq.html(""),this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Info.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Info.HEIGHT,"lightwin"!==JS9.globalOpts.regDisplay&&(this.height+=JS9.Info.REGHEIGHT)),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.infoConjq=$("<div>").addClass("JS9Container").append(n).appendTo(this.divjq),this.jq=this.infoConjq.find("[name='info']")},JS9.Info.display=function(e,t,s,o){let n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A=this;if(this.display&&(A=this.display),w=A.image,A.pluginInstances&&(r=A.pluginInstances.JS9Info),!r||"active"!==r.status||s&&o?s?(s===A?(c=A,s=null):c=s instanceof jQuery?s:"object"==typeof s?$(s):$(`#${s}`),c.length||(c=A,s=null),this.lasttarget=s):(c=A,this.lasttarget=A):c=r,"progress"!==e){if(c===r&&("regions"!==e||"lightwin"!==JS9.globalOpts.regDisplay)){switch(typeof t){case"string":m=r.jq.find(`[name='${e}']`),m.length>0?m.val(t):JS9.globalOpts.fallbackDisplay&&(c=A);break;case"object":for(u of Object.keys(t))m=r.jq.find(`[name='${u}']`),m.length>0&&(l="val"===u?t.val3:t[u],m.val(l))}if(c!==A)return A}if("regions"===e){if("lightwin"===JS9.globalOpts.regDisplay){if(b=`${A.id}_regions`,f=$(`#${b}`),!f.length||f[0].isClosed)return t?($(JS9.lightOpts[JS9.LIGHTWIN].topid).arrive(`#${b}`,{fireOnAttributesModification:!0},()=>{JS9.Info.display.call(this,e,t,s,o)}),a="Regions",w&&(a+=`: ${w.id}`),a+=" ",a+=sprintf(JS9.IDFMT,this.id),void JS9.lightWin(b,"inline","<div class='JS9Message'></div>",a,JS9.lightOpts[JS9.LIGHTWIN].regWin0)):void 0;h=f.find(".JS9Message")}else s?h=c:(h=c.regionsArea,c.infoheight=c.infoArea.height()+4,c.regheight=Math.max(2*c.infoheight+10,c.infoheight+c.regionsArea.height()+10),v=!A.image||A.image.iy>c.regheight?JS9.textColorOpts.inimage:JS9.textColorOpts.regions);d=";"}else s?h=c:(h=c.infoArea,c.infoheight=c.infoArea.height()+4,v=!A.image||A.image.iy>c.infoheight?JS9.textColorOpts.inimage:JS9.textColorOpts.info,d="");switch(typeof t){case"string":n=t;break;case"object":u=`vstr${JS9.globalOpts.valposWidth}`,n=t[u]||t.vstrmedium||t.vstr||""}return""!==d&&(p=n.split(d),p.length>2&&(g=new RegExp(d,"g"),n=n.replace(g,"<br>"))),v&&h.css("color",v),h.html(n),A}if(f=c===r?r.jq:c.divjq,f.length>0)switch(f=f.find("[name='progress']"),typeof t){case"string":case"boolean":t?("indeterminate"===t&&f.removeAttr("value"),f.parent().css("display","inline-block")):(f.parent().css("display","none"),f.attr("value",0));break;case"object":t[1]&&f.attr("max",t[1]),f.attr("value",t[0])}},JS9.Display.prototype.displayMessage=JS9.Info.display,JS9.Image.prototype.displayMessage=JS9.Info.display,JS9.Info.clear=function(e){let t=this;return this.display&&(t=this.display),e?t.displayMessage(e,""):(t.displayMessage("info",""),t.displayMessage("regions",""),t.displayMessage("progress",!1)),t},JS9.Display.prototype.clearMessage=JS9.Info.clear,JS9.Image.prototype.clearMessage=JS9.Info.clear,JS9.Info.pluginDisplay=function(e){let t;e&&e.display&&(e.tmp&&(e.tmp.info_ovalpos=e.params.valpos),e.params.valpos=!0,this.display.lasttarget&&(t=this.display,t.displayMessage("info","",t.lasttarget,!0),t.displayMessage("regions","",t.lasttarget,!0),t.displayMessage("progress",!1,t.lasttarget,!0),delete t.lasttarget))},JS9.Info.pluginClose=function(e){e&&e.display&&e.tmp&&void 0!==e.tmp.info_ovalpos&&(e.params.valpos=e.tmp.info_ovalpos)},JS9.mkPublic("DisplayMessage",function(...e){let t,s,o,n;const a=JS9.parsePublicArgs(e),l=JS9.lookupDisplay(a.display);return l||JS9.error("invalid display for display message"),s=a.argv[0],o=a.argv[1],n=a.argv[2],t=l.displayMessage(s,o,n),t===l&&(t="OK"),t}),JS9.RegisterPlugin("JS9","Info",JS9.Info.init,{menuItem:"InfoBox",help:"help/info.html",dynamicSelect:!0,onplugindisplay:JS9.Info.pluginDisplay,onpluginclose:JS9.Info.pluginClose,onimagedisplay:JS9.Info.init,onimagerefresh:JS9.Info.init,onupdateprefs:JS9.Info.init,winTitle:"Info",winResize:!0,winDims:[JS9.Info.WIDTH,JS9.Info.HEIGHT]}),JS9.Keyboard={},JS9.Keyboard.CLASS="JS9",JS9.Keyboard.NAME="Keyboard",JS9.Keyboard.WIDTH=450,JS9.Keyboard.HEIGHT=420,JS9.Keyboard.BASE=JS9.Keyboard.CLASS+JS9.Keyboard.NAME,JS9.Keyboard.actionHTML="<div class='JS9KeyboardText'><button class='JS9Button JS9KeyboardButton' type='button' value='%s'>%s</button></div><div class='JS9KeyboardAction'>%s</div>",JS9.Keyboard.actionid=function(e,t){return`${e}_${t}`.replace(/[^A-Za-z0-9_]/g,"_")},JS9.Keyboard.addAction=function(e,t,s){let o,n,a;return n=JS9.Keyboard.actionid(t,s),o=sprintf(JS9.Keyboard.actionHTML,s,t,s),a=$("<div class='JS9KeyboardItem'>").attr("id",n).html(o).appendTo(e),a.find(".JS9KeyboardButton").on("click",l=>{const c=l.currentTarget.value,d=this.display.image;d&&c&&JS9.Keyboard.Actions[c]&&JS9.Keyboard.Actions[c](d,d.ipos,l)}),a},JS9.Keyboard.arrowKey=function(e,t,s,o){let n;e.pos.x+=s.x,e.pos.y+=s.y,e.ipos=e.displayToImagePos(e.pos),{}.hasOwnProperty.call(JS9,"MouseTouch")&&(e.valpos=null,JS9.MouseTouch.Actions["display value/position"](e,e.ipos,t)),{}.hasOwnProperty.call(JS9,"Magnifier")&&!o&&JS9.Magnifier.display(e,e.ipos),JS9.globalOpts.regArrowCrosshair&&{}.hasOwnProperty.call(JS9,"Crosshair")&&(e.tmp.arrowCrosshair=!0,e.tmp.arrowCrosshairVisible=!0,o?o.pub&&(n="polygon"===o.pub.shape&&o.pub.pts&&o.pub.pts.length>1?JS9.centroidPolygon(o.pub.pts):{x:o.pub.x,y:o.pub.y},JS9.Crosshair.display(e,n,t)):JS9.Crosshair.display(e,e.ipos,t),delete e.tmp.arrowCrosshair)},JS9.Keyboard.Actions={},JS9.Keyboard.Actions["open local file"]=function(e,t,s){let o;e?o=e.display:s&&"object"==typeof s.data&&(o=s.data),o&&(window.isElectron&&"object"==typeof s.data?o.displayLoadForm():JS9.OpenFileMenu({display:o}))},JS9.Keyboard.Actions["close image"]=function(e,t,s){e&&e.closeImage()},JS9.Keyboard.Actions["new JS9 light window"]=function(e,t,s){let o,n;e?n=e.display:s&&"object"==typeof s.data&&(n=s.data),n&&(o={clone:n.id}),JS9.LoadWindow(null,o,"light")},JS9.Keyboard.Actions["copy wcs position to clipboard"]=function(e,t,s){let o,n,a;if(e&&e.raw.wcs&&t)return o=JS9.pix2wcs(e.raw.wcs,t.x,t.y).trim(),JS9.globalOpts.copyWcsPosFormat&&(n=o.split(/\s+/),a=[{name:"ra",value:n[0]},{name:"dec",value:n[1]},{name:"sys",value:n[2]}],o=e.expandMacro(JS9.globalOpts.copyWcsPosFormat,a)),JS9.CopyToClipboard(o,e),o},JS9.Keyboard.Actions["copy physical position to clipboard"]=function(e,t,s){let o,n;if(e&&t)return o=e.imageToLogicalPos(t),n=sprintf("%f %f",o.x,o.y),JS9.CopyToClipboard(n,e),n},JS9.Keyboard.Actions["copy pixel value to clipboard"]=function(e,t,s){let o,n,a;if(e&&t)return n=e.raw.data[Math.floor(t.y-.5)*e.raw.width+Math.floor(t.x-.5)],a=JS9.floatPrecision(e.params.scalemin,e.params.scalemax),o=JS9.floatFormattedString(n,a,3),JS9.CopyToClipboard(o,e),o},JS9.Keyboard.Actions["copy value and position to clipboard"]=function(e,t,s){let o,n,a;if(e&&t)return a=e.setParam("valpos",!0),o=e.updateValpos(t,!1),e.setParam("valpos",a),n=`vstr${JS9.globalOpts.valposWidth}`,o=o&&o[n]?o[n].replace(/&nbsp;/g," "):" ",JS9.CopyToClipboard(o,e),o},JS9.Keyboard.Actions["edit selected region(s)"]=function(e,t,s){let o,n;!e||(o=e.layers.regions,o&&(n=o.canvas.getActiveObject(),n&&"activeSelection"!==n.type?e.displayRegionsForm(n):e.displayRegionsForm(null,{multi:!0})))},JS9.Keyboard.Actions["add last region selected in regions menu"]=function(e,t,s){let o={ireg:!0},n=JS9.globalOpts.regMenuSelected||"circle";if(e)return o.x=t.x,o.y=t.y,e.addShapes("regions",n,o)},JS9.Keyboard.Actions["toggle selected region: source/background"]=function(e,t,s){if(e)return e.toggleRegionTags("selected","source","background")},JS9.Keyboard.Actions["toggle selected region: include/exclude"]=function(e,t,s){if(e)return e.toggleRegionTags("selected","include","exclude")},JS9.Keyboard.Actions["tag selected region as 'source'"]=function(e,t,s){if(e)return JS9.Keyboard.editregion(e,"source","background")},JS9.Keyboard.Actions["tag selected region as 'background'"]=function(e,t,s){if(e)return JS9.Keyboard.editregion(e,"background","source")},JS9.Keyboard.Actions["tag selected region as 'include'"]=function(e,t,s){if(e)return JS9.Keyboard.editregion(e,"include","exclude")},JS9.Keyboard.Actions["tag selected region as 'exclude'"]=function(e,t,s){if(e)return JS9.Keyboard.editregion(e,"exclude","include")},JS9.Keyboard.Actions["toggle full screen mode"]=function(e,t,s){let o;e?o=e.display:s&&"object"==typeof s.data&&(o=s.data),o&&(o.width===o.width0&&o.height===o.height0?o.resize("full",{center:!0}):o.resize("reset"))},JS9.Keyboard.Actions["reset zoom"]=function(e,t,s){!e||e.setZoom("1")},JS9.Keyboard.Actions["zoom in"]=function(e,t,s){!e||e.setZoom("*2")},JS9.Keyboard.Actions["zoom out"]=function(e,t,s){!e||e.setZoom("/2")},JS9.Keyboard.Actions["display next image"]=function(e,t,s){!e||e.display.nextImage(1)},JS9.Keyboard.Actions["display previous image"]=function(e,t,s){!e||e.display.nextImage(-1)},JS9.Keyboard.Actions["open a local FITS file"]=function(e,t,s){let o;e?o=e.display:s&&"object"==typeof s.data&&(o=s.data),o&&JS9.OpenFileMenu({display:o})},JS9.Keyboard.Actions["save image as a FITS file"]=function(e,t,s){!e||e.saveFITS()},JS9.Keyboard.Actions["save image as a PNG file"]=function(e,t,s){!e||e.savePNG()},JS9.Keyboard.Actions["save regions as a text file"]=function(e,t,s){!e||e.saveRegions()},JS9.Keyboard.Actions["move region/position up"]=function(e,t,s){let o,n,a,l=JS9.globalOpts.arrowIncrement;s&&s.preventDefault(),e&&(n=e.layer||"regions",o=e.display.layers[n].canvas,a=o.getActiveObject(),a&&!a.lockMovementY&&e.changeShapes(n,"selected",{deltay:l}),JS9.Keyboard.arrowKey(e,s,{x:0,y:-1*l},a),o.fire("mouse:up"),JS9.globalOpts.extendedPlugins&&e.xeqPlugins("keydown","onarrowkey",s))},JS9.Keyboard.Actions["move region/position down"]=function(e,t,s){let o,n,a,l=-JS9.globalOpts.arrowIncrement;s&&s.preventDefault(),e&&(n=e.layer||"regions",o=e.display.layers[n].canvas,a=o.getActiveObject(),a&&!a.lockMovementY&&e.changeShapes(n,"selected",{deltay:l}),JS9.Keyboard.arrowKey(e,s,{x:0,y:-1*l},a),o.fire("mouse:up"),JS9.globalOpts.extendedPlugins&&e.xeqPlugins("keydown","onarrowkey",s))},JS9.Keyboard.Actions["move region/position left"]=function(e,t,s){let o,n,a,l=-JS9.globalOpts.arrowIncrement;s&&s.preventDefault(),e&&(n=e.layer||"regions",o=e.display.layers[n].canvas,a=o.getActiveObject(),a&&!a.lockMovementX&&e.changeShapes(n,"selected",{deltax:l}),JS9.Keyboard.arrowKey(e,s,{x:l,y:0},a),o.fire("mouse:up"),JS9.globalOpts.extendedPlugins&&e.xeqPlugins("keydown","onarrowkey",s))},JS9.Keyboard.Actions["move region/position right"]=function(e,t,s){let o,n,a,l=JS9.globalOpts.arrowIncrement;s&&s.preventDefault(),e&&(n=e.layer||"regions",o=e.display.layers[n].canvas,a=o.getActiveObject(),a&&!a.lockMovementX&&e.changeShapes(n,"selected",{deltax:l}),JS9.Keyboard.arrowKey(e,s,{x:l,y:0},a),o.fire("mouse:up"),JS9.globalOpts.extendedPlugins&&e.xeqPlugins("keydown","onarrowkey",s))},JS9.Keyboard.Actions["remove selected region"]=function(e,t,s){let o,n;s&&s.preventDefault(),e&&(n=e.layer||"regions",o=e.display.layers[n].canvas,e.removeShapes(n,"selected"),e.display.clearMessage(n),o.fire("mouse:up"))},JS9.Keyboard.Actions["raise region layer to top"]=function(e,t,s){s&&s.preventDefault(),e&&e.activeShapeLayer("regions")},JS9.Keyboard.Actions["toggle active shape layers"]=function(e,t,s){s&&s.preventDefault(),e&&e.toggleShapeLayers()},JS9.Keyboard.Actions["send selected region to back"]=function(e,t,s){s&&s.preventDefault(),e&&e.changeShapes("regions","selected",{send:"back"})},JS9.Keyboard.Actions["copy region(s) to clipboard"]=function(e,t,s){let o;if(e)return o=e.listRegions(null,{mode:1}),JS9.CopyToClipboard(o,e),o},JS9.Keyboard.Actions["copy selected region(s) to clipboard"]=function(e,t,s){let o;if(e)return o=e.listRegions("selected",{mode:1}),JS9.CopyToClipboard(o,e),o},JS9.Keyboard.Actions["copy all regions to clipboard"]=function(e,t,s){let o;if(e)return o=e.listRegions("all",{mode:1}),JS9.CopyToClipboard(o,e),o},JS9.Keyboard.Actions["paste regions from local clipboard"]=function(e,t,s){return JS9.Regions.pasteFromClipboard.call(e,!1)},JS9.Keyboard.Actions["paste regions to current position"]=function(e,t,s){return JS9.Regions.pasteFromClipboard.call(e,!0)},JS9.Keyboard.Actions["undo remove of region(s)"]=function(e,t,s){e&&e.unremoveRegions()},JS9.Keyboard.Actions["select region"]=function(e,t,s){let o,n,a,l,c;if(e)for(n=e.layer||"regions",a=e.layers[n].canvas,c=a.getObjects(),o=0;o<c.length;o++)if(l=c[o],l.containsPoint(e.pos)){a.setActiveObject(l),a.renderAll();break}},JS9.Keyboard.Actions["select all regions"]=function(e,t,s){let o,n,a;!e||(o=e.layer||"regions",n=e.layers[o].canvas,a=new fabric.ActiveSelection(n.getObjects(),{canvas:n}),n.setActiveObject(a),n.renderAll())},JS9.Keyboard.Actions["unselect all regions"]=function(e,t,s){let o,n;!e||(o=e.layer||"regions",n=e.layers[o].canvas,n.getActiveObject()&&n.discardActiveObject(),n.renderAll())},JS9.Keyboard.Actions["refresh image"]=function(e,t,s){!e||(s&&s.preventDefault(),e.refreshImage())},JS9.Keyboard.Actions["display full image"]=function(e,t,s){!e||(s&&s.preventDefault(),e.displaySection("full"))},JS9.Keyboard.Actions["display selected cutouts"]=function(e,t,s){!e||(s&&s.preventDefault(),e.displaySection("selected"))},JS9.Keyboard.Actions["toggle coordinate grid"]=function(e,t,s){JS9.Grid.toggle(e)},JS9.Keyboard.Actions["toggle crosshair"]=function(e,t,s){!e||(s&&s.preventDefault(),e.params.crosshair=!e.params.crosshair,e.params.crosshair||JS9.Crosshair.hide(e))},JS9.Keyboard.Actions["toggle mouse/touch plugin"]=function(e,t,s){let o;e?o=e.display:s&&"object"==typeof s.data&&(o=s.data),o&&o.displayPlugin("JS9MouseTouch")},JS9.Keyboard.Actions["toggle keyboard actions plugin"]=function(e,t,s){let o;e?o=e.display:s&&"object"==typeof s.data&&(o=s.data),o&&o.displayPlugin("JS9Keyboard")},JS9.Keyboard.Actions["toggle preferences plugin"]=function(e,t,s){let o;e?o=e.display:s&&"object"==typeof s.data&&(o=s.data),o&&o.displayPlugin("JS9Preferences")},JS9.Keyboard.Actions["toggle shape layers plugin"]=function(e,t,s){let o;e?o=e.display:s&&"object"==typeof s.data&&(o=s.data),o&&o.displayPlugin("JS9Layers")},JS9.Keyboard.Actions["pan to mouse position"]=function(e,t,s){e&&e.setPan("mouse")},JS9.Keyboard.Actions["flip image around x axis"]=function(e){e&&e.setFlip("x")},JS9.Keyboard.Actions["flip image around y axis"]=function(e){e&&e.setFlip("y")},JS9.Keyboard.Actions["rotate image by 90 degrees"]=function(e){e&&e.setRot90(90)},JS9.Keyboard.Actions["rotate image by -90 degrees"]=function(e){e&&e.setRot90(-90)},JS9.Keyboard.getAction=function(e,t){let s;const o=JS9.eventToCharStr(t);return o&&(s=JS9.globalOpts.keyboardActions[o]),s},JS9.Keyboard.action=function(e,t,s,o){(o=o||JS9.Keyboard.getAction(e,s))&&JS9.Keyboard.Actions[o]&&(JS9.Keyboard.Actions[o](e,t,s),e&&JS9.globalOpts.extendedPlugins&&e.xeqPlugins("keydown","onkeyboardaction",s))},JS9.Keyboard.editregion=function(e,t,s){let o,n,a,l;if(a=e.getShapes("regions","selected"),a.length){for(o=0;o<a.length;o++){for(l=a[o].tags,n=0;n<l.length;n++){if(l[n]===t){t="";break}if(l[n]===s){l[n]=t,t="";break}}t&&l.push(t)}e.changeShapes("regions","selected",{tags:l})}},JS9.Keyboard.init=function(){let e,t;for(t of(this.divjq.html(""),this.divjq.addClass("JS9PluginScrolling"),this.keyboardContainer=$("<div>").addClass(`${JS9.Keyboard.BASE}Container`).attr("id",`${this.id}KeyboardContainer`).appendTo(this.divjq),e=`<div class='${JS9.Keyboard.BASE}Header'><b>Keys and their actions (or click the buttons):</b></div><p>`,this.keyboardHeadContainer=$("<div>").addClass(`${JS9.Keyboard.BASE}Container`).attr("id",`${this.id}KeyboardHeadContainer`).html(e).appendTo(this.keyboardContainer),this.keyboardActionContainer=$("<div>").addClass(`${JS9.Keyboard.BASE}ActionContainer`).attr("id",`${this.id}ActionContainer`).html("").appendTo(this.keyboardContainer),Object.keys(JS9.globalOpts.keyboardActions)))e=JS9.globalOpts.keyboardActions[t],JS9.Keyboard.addAction.call(this,this.keyboardActionContainer,t,e)},JS9.RegisterPlugin(JS9.Keyboard.CLASS,JS9.Keyboard.NAME,JS9.Keyboard.init,{menuItem:"Keyboard Actions",onplugindisplay:JS9.Keyboard.init,help:"help/keyboard.html",winTitle:"Keyboard Actions",winResize:!0,winDims:[JS9.Keyboard.WIDTH,JS9.Keyboard.HEIGHT]}),JS9.Layers={},JS9.Layers.CLASS="JS9",JS9.Layers.NAME="Layers",JS9.Layers.WIDTH=460,JS9.Layers.HEIGHT=250,JS9.Layers.BASE=JS9.Layers.CLASS+JS9.Layers.NAME,JS9.Layers.headerHTML="Shape layers can be hidden or made visible below. The topmost visible layer in the stack is <b>active</b>: it responds to mouse and touch events. Move a layer to the top of the stack to make it active.",JS9.Layers.layerHTML="<span style='float: left'>$visible&nbsp;&nbsp;$save&nbsp;&nbsp;$color</span>&nbsp;&nbsp; <span class='JS9LayersSpan'>$layer&nbsp;&nbsp</span>",JS9.Layers.nolayersHTML='<p><span class="JS9NoLayers">[Layers will appear here as they are created]</span>',JS9.Layers.visibleHTML='<input class="JS9LayersVisibleCheck" type="checkbox" id="visible" name="visible" value="visible" onclick="javascript:JS9.Layers.xvisible(\'%s\', \'%s\', \'%s\', this)">visible',JS9.Layers.saveBothHTML='<select class="JS9Select JS9LayersSaveBothSelect" onfocus="this.selectedIndex=0;" onchange="JS9.Layers.xsave(\'%s\', \'%s\', \'%s\', this)"><option selected disabled>save as ...</option><option value="catalog">catalog</option><option value="regions">regions</option><option value="svg">svg</option></select>',JS9.Layers.saveRegionsHTML='<select class="JS9Select JS9LayersSaveSelect" onfocus="this.selectedIndex=0;" onchange="JS9.Layers.xsave(\'%s\', \'%s\', \'%s\', this)"><option selected disabled>save as ...</option><option value="regions">regions</option><option value="svg">svg</option></select>',JS9.Layers.colorHTML='<select class="JS9Select JS9LayersColorSelect" onfocus="this.selectedIndex=0;" onchange="JS9.Layers.xcolor(\'%s\', \'%s\', \'%s\', this)"><option selected disabled>color ...</option><option value="black">black</option><option value="white">white</option><option value="red">red</option><option value="magenta">magenta</option><option value="orange">orange</option><option value="yellow">yellow</option><option value="blue">blue</option><option value="cyan">cyan</option><option value="green">green</option><option value="lime">lime</option><option value="indigo">indigo</option><option value="violet">violet</option></select>',JS9.Layers.layerNameHTML="<b>%s</b>",JS9.Layers.imid=function(e,t){return`${`${e.display.id}_${e.id}_${t}_`.replace(/[^A-Za-z0-9_]/g,"_")}Layer`},JS9.Layers.dispclass=function(e){return`${JS9.Layers.BASE}_${e.display.id}`.replace(/[^A-Za-z0-9_]/g,"_")},JS9.Layers.activeLayer=function(e,t){let s,o,n,a,l;if(e){if(l=t.layersLayerContainer.sortable("toArray"),1===l.length&&!l[0])return;for(s=0;s<l.length;s++)l[s]=$(`#${l[s]}`).attr("layer");o=e.activeShapeLayer(l),n=JS9.Layers.imid(e,o),a=`${JS9.Layers.dispclass(e)}_Layer`,$(`.${a}`).removeClass(`${JS9.Layers.BASE}LayerActive`).addClass(`${JS9.Layers.BASE}LayerInactive`),$(`#${n}`).removeClass(`${JS9.Layers.BASE}LayerInactive`).addClass(`${JS9.Layers.BASE}LayerActive`)}},JS9.Layers.xvisible=function(e,t,s,o){let n,a;const l=JS9.lookupImage(t,e);l&&(a=!!o.checked,l.showShapeLayer(s,a),n=l.display.pluginInstances[JS9.Layers.BASE],JS9.Layers.activeLayer(l,n,!0))},JS9.Layers.xsave=function(e,t,s,o){const n=JS9.lookupImage(t,e),a=o.options[o.selectedIndex].value;n&&("catalog"===a?n.saveCatalog(null,s):"regions"===a?n.saveRegions(null,null,s):"svg"===a&&n.saveRegions(null,null,{layer:s,type:"svg"}))},JS9.Layers.xcolor=function(e,t,s,o){const n=JS9.lookupImage(t,e),a=o.options[o.selectedIndex].value;n&&a&&(n.changeShapes(s,"all",{color:a}),o.selectedIndex=0)},JS9.Layers.addLayer=function(e,t){let s,o,n,a,l,c,d,h,p;const g=`${JS9.Layers.BASE}Layer`,v=[];!e||!t||!e.layers[t]||"main"!==e.layers[t].dlayer.dtype||(this.nlayer||this.layersLayerContainer.html(""),h=e.id,p=e.display.id,l=parseInt(e.display.layers[t].divjq.css("z-index"),10),n=JS9.Layers.imid(e,t),d=`${JS9.Layers.dispclass(e)}_Layer`,v.push({name:"imid",value:h}),v.push({name:"visible",value:sprintf(JS9.Layers.visibleHTML,p,h,t)}),v.push(e.layers[t].catalog?{name:"save",value:sprintf(JS9.Layers.saveBothHTML,p,h,t)}:{name:"save",value:sprintf(JS9.Layers.saveRegionsHTML,p,h,t)}),v.push({name:"color",value:sprintf(JS9.Layers.colorHTML,p,h,t)}),s=JS9.DEBUG>1?`${t} layer [zindex: ${l}]`:`${t} layer`,v.push({name:"layer",value:sprintf(JS9.Layers.layerNameHTML,s)}),o=JS9.Image.prototype.expandMacro.call(e,JS9.Layers.layerHTML,v),a=$("<div>").addClass(g).addClass(d).attr("id",n).attr("layer",t).prop("imid",h).html(o),this.nlayer?(this.layersLayerContainer.find(`.${g}`).each((r,u)=>{let f,m;const b=$(u);c||(f=b.attr("layer"),f&&(m=parseInt(e.display.layers[f].divjq.css("z-index"),10),Math.abs(l)>Math.abs(m)&&(a.insertBefore(b),c=!0)))}),c||a.appendTo(this.layersLayerContainer)):a.appendTo(this.layersLayerContainer),a.find(".JS9LayersVisibleCheck").prop("checked",!!e.layers[t].show),this.nlayer++)},JS9.Layers.display=function(){this.lastimage!==this.display.image&&JS9.Layers.init.call(this)},JS9.Layers.close=function(){JS9.Layers.init.call(this,{mode:"clear"})},JS9.Layers.init=function(e){let t,s;if(e=e||{},this.divjq.html(""),this.nlayer=0,this.divjq.addClass("JS9PluginScrolling"),this.layersContainer=$("<div>").addClass(`${JS9.Layers.BASE}Container`).attr("id",`${this.id}LayersContainer`).css("overflow","auto").appendTo(this.divjq),this.layersHeader=$("<div>").addClass(`${JS9.Layers.BASE}Header`).attr("id",`${this.display.id}Header`).html(JS9.Layers.headerHTML).appendTo(this.layersContainer),this.layersLayerContainer=$("<div>").addClass(`${JS9.Layers.BASE}LayerContainer`).attr("id",`${this.id}LayersLayerContainer`).html(JS9.Layers.nolayersHTML).appendTo(this.layersContainer),"clear"!==e.mode){if(this.display.image){for(t of(s=this.display.image,Object.keys(s.layers)))"crosshair"===t||"grid"===t||JS9.Layers.addLayer.call(this,s,t);this.lastimage=s}this.layersLayerContainer.sortable({start:(o,n)=>{},stop:(o,n)=>{JS9.Layers.activeLayer(s,this)}}),JS9.Layers.activeLayer(s,this)}},JS9.RegisterPlugin(JS9.Layers.CLASS,JS9.Layers.NAME,JS9.Layers.init,{menuItem:"Shape Layers",onplugindisplay:JS9.Layers.init,onshapelayercreate:JS9.Layers.init,onshapelayershow:JS9.Layers.init,onshapelayeractive:JS9.Layers.init,onshapelayerhide:JS9.Layers.init,onimageload:JS9.Layers.init,onimagedisplay:JS9.Layers.display,onimageclose:JS9.Layers.close,help:"help/layers.html",winTitle:"Shape Layers",winResize:!0,winDims:[JS9.Layers.WIDTH,JS9.Layers.HEIGHT]}),JS9.Magnifier={},JS9.Magnifier.CLASS="JS9",JS9.Magnifier.NAME="Magnifier",JS9.Magnifier.WIDTH=JS9.WIDTH/2,JS9.Magnifier.HEIGHT=JS9.HEIGHT/2,JS9.Magnifier.SWIDTH=250,JS9.Magnifier.SHEIGHT=250,JS9.Magnifier.opts={originX:"left",originY:"top",hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,selectable:!1,zoom:4,canvas:{selection:!1},tagcolors:{defcolor:"#00FF00"}},JS9.Magnifier.bcall=function(...e){let t,s,[o,n,a]=e;if("zoomMagnifier"===(t=$(o).closest("div[class^=JS9PluginToolbar]").data("displayid"),t?s=JS9.getImage(t):JS9.error(`can't find display for cmd: ${n}`),s||JS9.error(`can't find image for cmd: ${n}`),n)){e.length<3&&JS9.error(`missing arg(s) for cmd: ${n}`);try{JS9.Magnifier.zoom(s,a)}catch(l){JS9.error("error calling zoomMagnifier()",l)}}},JS9.Magnifier.HTML=`<span><button type='button' class='JS9Button' onClick='JS9.Magnifier.bcall(this, "zoomMagnifier", "x2"); return false'>x2</button><button type='button' class='JS9Button' onClick='JS9.Magnifier.bcall(this, "zoomMagnifier", "/2"); return false'>/2</button><button type='button' class='JS9Button' onClick='JS9.Magnifier.bcall(this, "zoomMagnifier", "${JS9.Magnifier.opts.zoom}"); return false'>${JS9.Magnifier.opts.zoom}</button></span>`,JS9.Magnifier.init=function(e,t){this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Magnifier.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Magnifier.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.canvas=document.createElement("canvas"),this.canvasjq=$(this.canvas),this.canvasjq.addClass("JS9Magnifier"),this.canvasjq.css("z-index",JS9.ZINDEX),this.canvasjq.attr("width",this.width),this.canvasjq.attr("height",this.height),this.context=this.canvas.getContext("2d"),JS9.ANTIALIAS||(this.context.imageSmoothingEnabled=!1),this.containerjq=$("<div>").addClass("JS9Container").append(this.canvasjq).appendTo(this.divjq),this.display.newShapeLayer("magnifier",JS9.Magnifier.opts,this.divjq)},JS9.Magnifier.display=function(e,t){let s,o,n,a,l,c,d,h,p,g,v,r,u;!e||!e.display.pluginInstances.JS9Magnifier||"active"!==e.display.pluginInstances.JS9Magnifier.status||e.clickState>0||e.clickState<-1||(e.magnifier||(e.magnifier={zoom:JS9.Magnifier.opts.zoom,posx:0,posy:0}),n=e.display.pluginInstances.JS9Magnifier,l=e.display.canvas,a=e.magnifier.zoom,h=Math.floor(n.width/a),p=Math.floor(n.height/a),t?(s=e.imageToDisplayPos(t),c=s.x-h/2,d=s.y-p/2,e.magnifier.posx=c,e.magnifier.posy=d):(c=e.magnifier.posx,d=e.magnifier.posy),g=0,v=0,r=n.canvas.width,u=n.canvas.height,c<0&&(h+=c,g-=c*a,r+=c*a,c=0),o=c+h-l.width,o>0&&(h-=o,r=h*a),d<0&&(p+=d,v-=d*a,u+=d*a,d=0),o=d+p-l.height,o>0&&(p-=o,u=p*a),n.context.clear(),n.context.drawImage(l,c,d,h,p,g,v,r,u),JS9.globalOpts.magnifierRegions&&e.display.layers&&e.display.layers.regions&&(l=e.display.layers.regions.canvas.getElement(),c*=fabric.devicePixelRatio,d*=fabric.devicePixelRatio,h*=fabric.devicePixelRatio,p*=fabric.devicePixelRatio,n.context.drawImage(l,c,d,h,p,g,v,r,u)),e.magnifier.boxid||(e.magnifier.boxid=e.addShapes("magnifier","box"),$(n.canvas).css("background-color","black")),e.magnifier.ozoom!==a&&(e.changeShapes("magnifier",e.magnifier.boxid,{left:n.width/2-1,top:n.height/2-1,width:a,height:a}),e.magnifier.ozoom=e.magnifier.zoom))},JS9.Magnifier.display2=function(e,t){window.setTimeout(()=>{JS9.Magnifier.display(e,t)},0)},JS9.Magnifier.zoom=function(e,t){let s,o,n;if(e&&e.magnifier){switch(s=e.magnifier,o=s.zoom,t.charAt(0)){case"x":case"*":n=o*parseFloat(t.slice(1));break;case"/":n=o/parseFloat(t.slice(1));break;default:n=parseFloat(t)}(!n||n<1)&&(n=1),s.ozoom=s.zoom,s.zoom=n,JS9.Magnifier.display(e)}},JS9.Magnifier.clear=function(e){const t=e.display.pluginInstances.JS9Magnifier;return t&&e===e.display.image&&(t.context.clear(),e.removeShapes("magnifier","all"),e.magnifier.boxid=null,e.magnifier.ozoom=0,$(t.canvas).css("background-color","#E9E9E9")),e},JS9.RegisterPlugin(JS9.Magnifier.CLASS,JS9.Magnifier.NAME,JS9.Magnifier.init,{menuItem:"Magnifier",help:"help/magnifier.html",dynamicSelect:!0,toolbarSeparate:!1,toolbarHTML:JS9.Magnifier.HTML,onplugindisplay:JS9.Magnifier.display,onregionsmove:JS9.Magnifier.display,onregionschange:JS9.Magnifier.display2,onmousemove:JS9.Magnifier.display,onimagedisplay:JS9.Magnifier.display,onimageclose:JS9.Magnifier.clear,onimageclear:JS9.Magnifier.clear,winTitle:"Magnifier",winDims:[JS9.Magnifier.WIDTH,JS9.Magnifier.HEIGHT],divArgs:[JS9.Magnifier.SWIDTH,JS9.Magnifier.SHEIGHT]}),JS9.Mef={},JS9.Mef.CLASS="JS9",JS9.Mef.NAME="Mef",JS9.Mef.WIDTH=800,JS9.Mef.HEIGHT=240,JS9.Mef.BASE=JS9.Mef.CLASS+JS9.Mef.NAME,JS9.Mef.xseparate=function(e,t){const s=JS9.lookupDisplay(e);s&&(s.pluginInstances[JS9.Mef.BASE].separate=t.checked)},JS9.Mef.xall=function(e,t){const s=JS9.lookupDisplay(e);s&&s.image&&(s.pluginInstances[JS9.Mef.BASE].separate=!0,s.image.displayExtension("all"))},JS9.Mef.imid=function(e,t,s){let o=`${e.display.id}_${e.id}`;return s&&(o=o.replace(/\[[a-zA-Z0-9][a-zA-Z0-9_]*\]/g,"")),`${o.replace(/[^A-Za-z0-9_]/g,"_")}_MefExtension_${t}`},JS9.Mef.activeExtension=function(e,t){let s,o;e&&(o=`${e.display.id}_${JS9.Mef.BASE}`,$(`.${o}Extension`).removeClass(`${JS9.Mef.BASE}ExtensionActive`).addClass(`${JS9.Mef.BASE}ExtensionInactive`),s=JS9.Mef.imid(e,t,!0),$(`.${s}`).removeClass(`${JS9.Mef.BASE}ExtensionInactive`).addClass(`${JS9.Mef.BASE}ExtensionActive`))},JS9.Mef.display=function(){this.lastimage!==this.display.image&&JS9.Mef.init.call(this)},JS9.Mef.close=function(){JS9.Mef.init.call(this,{mode:"clear"})},JS9.Mef.init=function(e){let t,s,o,n,a,l,c,d,h,p;const g=(v,r,u)=>{let f,m,b="",w=!0;switch(v.type){case"image":v.naxes.length<2&&(w=!1);break;case"table":case"ascii":for(m=0;m<v.cols.length;m++)f=v.cols[m],("X"===f.name||"x"===f.name)&&(b+="x"),("Y"===f.name||"y"===f.name)&&(b+="y");"xy"!==b&&"yx"!==b&&(w=!1)}h=w?`<pre>&nbsp;&nbsp;${r}</pre>`:`<pre>&nbsp;&nbsp;<span class='JS9MefStrike'><span>${r}</span></span></pre>`,o=JS9.Mef.imid(s,u),n=JS9.Mef.imid(s,u,!0),p=`${s.display.id}_${JS9.Mef.BASE}`,d=$("<div>").addClass(n).addClass(`${p}Extension`).addClass(`${JS9.Mef.BASE}Extension`).addClass(`${JS9.Mef.BASE}ExtensionInactive`).attr("id",o).html(h).appendTo(this.mefContainer),w&&d.on("mousedown touchstart",()=>{s.displayExtension(v.hdu,{separate:this.separate}),JS9.Mef.activeExtension(s,v.hdu)})};if(e=e||{},this.divjq.addClass("JS9PluginScrolling"),this.divjq.html(""),this.mefContainer=$("<div>").addClass(`${JS9.Mef.BASE}Container`).attr("id",`${this.id}MefContainer`).appendTo(this.divjq),void 0===this.separate&&(this.separate=!1),s=this.display.image,s&&"clear"!==e.mode)if(s.hdus){for(this.lastimage=s,l=`<div class='${JS9.Mef.BASE}Header'><span><b>Click on a FITS HDU extension to display it:</b></span>`,c=JS9.Mef.imid(s,"Separate"),l+=`&nbsp;&nbsp;<span><input type="checkbox" id="${c}" name="separate" value="separate" onclick="javascript:JS9.Mef.xseparate('${this.display.id}', this)"><b>&nbsp;as a separate image</b></span><span style="float: right"><input type="button" class="JS9Button2" id="${c}" name="all" value="Display all images" onclick="javascript:JS9.Mef.xall('${this.display.id}', this)"></span></div>`,this.mefContainer.html(l),t=0;t<s.hdus.length;t++)a=s.hdus[t],l=JS9.hdus2Str([a]).trim(),g(a,l,t);$(`#${c}`).prop("checked",this.separate),void 0!==s.raw.hdu.fits.extnum&&JS9.Mef.activeExtension(s,s.raw.hdu.fits.extnum)}else this.mefContainer.html("<p><center>No FITS HDU extensions are present in this image.</center>");else this.mefContainer.html("<p><center>FITS HDU extensions will be displayed here.</center>")},JS9.RegisterPlugin(JS9.Mef.CLASS,JS9.Mef.NAME,JS9.Mef.init,{menuItem:"Extensions",help:"help/mef.html",onplugindisplay:JS9.Mef.init,onimageload:JS9.Mef.init,onimagedisplay:JS9.Mef.display,onimageclose:JS9.Mef.close,winTitle:"Multi-Extension FITS",winResize:!0,winDims:[JS9.Mef.WIDTH,JS9.Mef.HEIGHT]}),JS9.Menubar={},JS9.Menubar.CLASS="JS9",JS9.Menubar.NAME="Menubar",JS9.Menubar.WIDTH=JS9.WIDTH||512,JS9.Menubar.HEIGHT="auto",JS9.Menubar.buttonOptsArr=[{name:"file",label:"File"},{name:"edit",label:"Edit"},{name:"view",label:"View"},{name:"zoom",label:"Zoom"},{name:"scale",label:"Scale"},{name:"color",label:"Color"},{name:"region",label:"Regions"},{name:"wcs",label:"WCS"},{name:"analysis",label:"Analysis"},{name:"help",label:"Help"}],JS9.Menubar.keyMap={"open ...":"open local file","open local ...":"open local file","toggle: src/bkgd":"toggle selected region: source/background","crosshair for this image":"toggle crosshair","toggle: incl/excl":"toggle selected region: include/exclude","full image":"display full image","selected cutouts":"display selected cutouts","refreshed image":"refresh image","light window":"new JS9 light window","active shape layers":"toggle active shape layers","Keyboard Actions":"toggle keyboard actions plugin","Mouse/Touch":"toggle mouse/touch plugin",Preferences:"toggle preferences plugin","Shape Layers":"toggle shape layers plugin",copy:"copy region(s) to clipboard",edit:"edit selected region(s)","paste to current pos":"paste regions to current position","paste to original pos":"paste regions from local clipboard","undo remove":"undo remove of region(s)","to back":"send selected region to back","copy wcs pos":"copy wcs position to clipboard","copy value/pos":"copy value and position to clipboard","zoom 1":"reset zoom","zoom in":"zoom in","zoom out":"zoom out"},JS9.menuButtonOptsArr&&(JS9.Menubar.buttonOptsArr=JS9.menuButtonOptsArr),JS9.Menubar.EMPTYIMG="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODYuMTIgMTcxLjkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPmVtcHR5PC90aXRsZT48cmVjdCBjbGFzcz0iY2xzLTEiIHdpZHRoPSIxODYuMTIiIGhlaWdodD0iMTcxLjkyIi8+PC9zdmc+",JS9.Menubar.missing={},JS9.Menubar.menuImage=function(e){let t=e.split("/").reverse()[0];return JS9.Menubar.missing[e]||JS9.Menubar.missing[t]?JS9.Menubar.EMPTYIMG:JS9.inline&&JS9.inline[e]?JS9.inline[e]:JS9.allinone?JS9.Menubar.EMPTYIMG:"/"!==e.charAt(0)?JS9.InstallDir(e):e},JS9.Menubar.getDisplays=function(e,t){let s,o,n,a;const l=[];if(e=e||"any",t=t||"",this.id.search(JS9.SUPERMENU)>=0&&!t.match(/^super_/)){if("all"!==e&&this.selectedDisplay){if($.inArray(this.selectedDisplay,JS9.displays)>=0)return[this.selectedDisplay];this.selectedDislay=null}if(o=this.divjq.data("displays")||"*",n=o.split(","),"*"===n[0])for(s=0;s<JS9.displays.length;s++)l.push(JS9.displays[s]);else for(s=0;s<n.length;s++)a=JS9.lookupDisplay(n[s]),a&&l.push(a)}else"*"===this.divjq.data("js9id")&&l.push(JS9.getDynamicDisplayOr(JS9.displays[0]));return l.length||l.push(this.display),l},JS9.Menubar.onclick=function(e){let t,s,o;for("string"==typeof e&&"all"!==e&&(e=JS9.lookupDisplay(e)),t=0;t<JS9.supermenus.length;t++)o=JS9.supermenus[t],s=JS9.Menubar.getDisplays.call(o,"all"),($.inArray(e,s)>=0||"all"===e)&&(JS9.bugs.webkit_resize?$(".JS9").find(".JS9Image").removeClass("JS9Highlight"):$(".JS9").removeClass("JS9Highlight"),e===o.selectedDisplay||"all"===e?o.selectedDisplay=null:(o.selectedDisplay=e,JS9.bugs.webkit_resize?$(e.divjq).find(".JS9Image").addClass("JS9Highlight"):$(e.divjq).addClass("JS9Highlight")))},JS9.Menubar.reset=function(e){JS9.Menubar.rkeyMap=null},JS9.Menubar.createMenus=function(){const e=(l,c,d)=>{let h;!{}.hasOwnProperty.call(window,"Jupyter")?l.$menu.position({my:"left top",at:JS9.globalOpts.menuPosition||"left bottom",of:l.$trigger,collision:"fit"}):(h=l.$trigger.offset(),l.$menu.css({left:h.left+20,top:h.top+10}))},t=()=>{const l=this.display;JS9.bugs.hide_menu&&l.image&&l.image.displayImage("rgb")},s=(l,c)=>{let d,h,p,g={name:l};const v=JS9.globalOpts.keyboardActions||{},r=JS9.Menubar.keyMap[l];if(!JS9.Menubar.rkeyMap){for(d of(JS9.Menubar.rkeyMap={},Object.keys(v)))JS9.Menubar.rkeyMap[v[d]]=d;JS9.Menubar.keyActions=$.extend(!0,{},v)}if(JS9.notNull(r)&&JS9.Menubar.rkeyMap)d=JS9.Menubar.rkeyMap[r],d&&(h=`<span>${l}<span class="JS9MenubarKeyAction">&nbsp;&nbsp;&nbsp;&nbsp;${d}</span></span>`,g={name:h,isHtmlName:!0});else if(c&&JS9.Menubar.rkeyMap)for(p of Object.keys(JS9.Menubar.rkeyMap))p===c&&(d=JS9.Menubar.rkeyMap[p],d&&(h=`<span>${l}<span class="JS9MenubarKeyAction">&nbsp;&nbsp;&nbsp;&nbsp;${d}</span></span>`,g={name:h,isHtmlName:!0}));return g},o=l=>{const c=l.data;l.preventDefault(),$(`#${c.name}UserMenu${this.id}`).contextMenu()},n=l=>{!l||!l.name||!l.title||!l.options||$.contextMenu({selector:`#${l.name}UserMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let c,d,h,p;const g={};for(c=0;c<l.options.length;c++)d=l.options[c],p=s(d.name,d.shortcut),d.image?(h=`<div class='JS9MenubarUserImage' name='${d.name}'><img src='${d.image}' name='${l.name}_${d.name}' alt='${d.name}' class='JS9MenubarUserImage JS9MenubarUserImageOption' >&nbsp;&nbsp;${p.name}</div>`,g[d.name]={name:h,isHtmlName:!0}):g[d.name]=p;return{callback:(v,r)=>{JS9.Menubar.getDisplays.call(this).forEach(u=>{let f,m,b,w;const A=u;for(f=0;f<l.options.length;f++)if(d=l.options[f],v===d.name&&(!1===d.requireImage||A.image))if("function"==typeof JS9.publics[d.cmd]){if(b="function"==typeof d.args?d.args(A,A.image):JSON.parse(JSON.stringify(d.args||[])),b.push({display:A}),JS9.publics[d.cmd](...b),!1!==d.updateTitle)if(d.image&&l.updateTitle&&l.updateTitle.match(/(both|image)/))"both"===l.updateTitle?w=`<div style='white-space:nowrap;'><img src='${d.image}' name='${l.name}' alt='${d.name}' class='JS9MenubarUserImage JS9MenubarUserImageTitle' >&nbsp;&nbsp;${d.name}</div>`:"image"===l.updateTitle&&(w=`<div style='white-space:nowrap;'><img src='${d.image}' name='${l.name}' alt='${d.name}' class='JS9MenubarUserImage JS9MenubarUserImageTitle' ></div>`),$(r.selector).html(w);else if("function"==typeof l.updateTitle){try{m=l.updateTitle(A.image,l.name,d.name)}catch{m=d.name||l.name}$(r.selector).text(m)}else l.updateTitle&&d.name&&$(r.selector).text(d.name)}else JS9.error(`unknown func for user menubar: ${d.cmd}`)})},items:g}}})};$(`#fileMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#fileMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#fileMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,itemClickEvent:JS9.globalOpts.menuClickEvent||"click",build:()=>{let l,c,d,h,p,g,v,r,u,f,m,b,w,A="",x=0;const y={},S=JS9.Menubar.getDisplays.call(this)[0],_=S.image,C=JS9.images.length;for(l=0,r=0;l<C;l++)d=JS9.images[l],d.display===S&&r++;for((!r||r>=JS9.globalOpts.imagesFileSubmenu)&&(y.filetitle={name:"Files and Displays:",disabled:!0}),r&&r<JS9.globalOpts.imagesFileSubmenu?(y.imagestitle={name:"Images:",disabled:!0},u=y):r&&(y.images={name:"images ...",items:{imagestitle:{name:"display this image:",disabled:!0}}},u=y.images.items),l=0;l<C;l++)d=JS9.images[l],d.display===S&&(h=d.id,S.rgb.active&&(d===S.rgb.rim&&(h+=" (red)"),d===S.rgb.gim&&(h+=" (green)"),d===S.rgb.bim&&(h+=" (blue)")),u[h]=s(h),S.image&&S.image.id===d.id&&(u[h].icon=JS9.globalOpts.menuSelected));if(r&&r<JS9.globalOpts.imagesFileSubmenu&&(y["sep"+x++]="------",y.filetitle={name:"Files and Displays:",disabled:!0}),window.electron?y.openboth=s("open ..."):(y.openlocal=s("open local ..."),y.openremote=s("open remote ..."),y.openremote.disabled=!!{}.hasOwnProperty.call(window,"Jupyter")),y.disps={name:"display ...",items:{dispstitle:{name:"display:",disabled:!0}}},y.disps.items.header=s("FITS header"),y.disps.items.hdus=s("FITS HDUs"),_||(y.disps.items.header.disabled=!0),(!_||!_.hdus)&&(y.disps.items.hdus.disabled=!0),y.disps.items.refresh=s("refreshed image"),y.disps.items.full=s("full image"),y.disps.items.cutout=s("selected cutouts"),y.disps.items.pageid=s("page id"),(!_||!_.raw||!_.raw.hdu||!_.raw.hdu.fits)&&(y.disps.items.refresh.disabled=!0,y.disps.items.full.disabled=!0,y.disps.items.cutout.disabled=!0),y.moveto={name:"move ...",items:{movetotitle:{name:"move to this display:",disabled:!0}}},_){for(y.moveto.disabled=!1,l=0;l<JS9.displays.length;l++)$(`#${JS9.displays[l].id}`).length>0&&S!==JS9.displays[l]&&(p=`moveto_${JS9.displays[l].id}`,y.moveto.items[p]=s(JS9.displays[l].id));y.moveto.items.moveto_newdisp=s("a new display")}else y.moveto.disabled=!0;if(y.separates={name:"separate ...",items:{}},JS9.images.length||(y.separates.disabled=!0),y.separates.items.separate=s("separate these images"),_||(y.separates.items.separate.disabled=!0),y.separates.items.gather=s("gather all images here"),_&&1===JS9.images.length&&(y.separates.items.gather.disabled=!0),y.saveas={name:"save ...",items:{saveastitle:{name:"save all data as:",disabled:!0},savefitsentire:s("FITS"),saveastitle2:{name:"save displayed data as:",disabled:!0},savefits:s("FITS"),savejpeg:s("JPEG"),savepng:s("PNG"),saveastitle3:{name:"save memory file as:",disabled:!0},savefitsvirtual:s("FITS")}},_?_.raw.hdu&&_.raw.hdu.fits&&_.raw.hdu.fits.vfile||(y.saveas.items.savefitsvirtual.disabled=!0):y.saveas.disabled=!0,y.closes={name:"close ...",items:{closestitle:{name:"close:",disabled:!0}}},_||(y.closes.disabled=!0),y.closes.items.close=s("this image"),y.closes.items.closeall=s("all images"),y.closes.items.free=s("this image's memory"),y.closes.items.removeproxy=s("proxy file"),_&&_.raw&&_.raw.hdu&&_.raw.hdu.fits||(y.closes.items.free.disabled=!0),(!_||!_.proxyFile)&&(y.closes.items.removeproxy.disabled=!0),y.catalogs={name:"catalog ...",items:{}},_||(y.catalogs.disabled=!0),y.catalogs.items.loadcatalog=s("load ..."),y.catalogs.items.savecatalog=s("save active"),y.createmosaic={name:"mosaic ...",items:{createmosaictitle:{name:"create a mosaic using:",disabled:!0},mosaiccurrent:s("images in the current file"),mosaicdisplay:s("images in this display")}},_||(y.createmosaic.disabled=!0),y.sessions={name:"session ...",items:{}},y.sessions.items.loadsession=s("load ..."),y.sessions.items.savesession={name:"save ...",items:{savesessiontitle:{name:"include these images:",disabled:!0},savecurrent:s("the current image"),savedisplay:s("all images in this display")}},y.windows={name:"window ...",items:{windowstitle:{name:"create a new:",disabled:!0}}},y.windows.items.lite=s("light window"),y.windows.items.xnew=s("separate window"),window.electron&&(y.windows.items.xnew.disabled=!0),window.electron&&(y.electronHelper=s("connect to JS9 helper"),JS9.helper.connected&&(y.electronHelper.disabled=!0)),this.issuper){for(g=JS9.Menubar.getDisplays.call(this,"all"),y.supermenu={name:"supermenu ...",items:{supertitle:{name:"target this display:",disabled:!0}}},l=0,c=0;l<g.length;l++)v=g[l],h=v.id,y.supermenu.items[`super_${h}`]=s(h),this.selectedDisplay===v&&(y.supermenu.items[`super_${h}`].icon=JS9.globalOpts.menuSelected,c++);h="all displays",y.supermenu.items.super_all=s(h),c||(y.supermenu.items.super_all.icon=JS9.globalOpts.menuSelected)}for(f=S.divjq.closest(".JS9GridContainer"),(!_||S.winid||f.length>0&&f.find(".JS9GridItem").length>1)&&(y.removedisplay=s("remove this display")),y["sep"+x++]="------",y.print=s("print ..."),_||(y.print.disabled=!0),window.electron&&(y.windowPrint=s("print window ..."),y.windowPDF=s("save window to pdf"),window.electron.app&&(y.saveScript=s("export messaging script"))),l=0;l<JS9.plugins.length;l++)m=JS9.plugins[l],b=m.name,m.opts.menuItem&&"file"===m.opts.menu&&(w=S.pluginInstances[b],(!w||w.winHandle)&&(m.xclass!==A&&(y["sep"+x]="------",x+=1),A=m.xclass,y[b]=s(m.opts.menuItem),w&&"active"===w.status&&(y[b].icon=JS9.globalOpts.menuSelected)));return{callback:(I,L)=>{let D;JS9.Menubar.getDisplays.call(this,"any",I).forEach(O=>{let M,E,R,H,N,B;const P=O;if(!($.inArray(P,JS9.displays)<0))switch(P&&(B=P.image),I){case"refresh":B&&B.raw.hdu&&B.raw.hdu.fits&&B.refreshImage();break;case"full":B&&B.raw.hdu&&B.raw.hdu.fits&&B.displaySection("full");break;case"cutout":B&&B.raw.hdu&&B.raw.hdu.fits&&B.displaySection("selected");break;case"free":B&&B.raw.hdu&&B.raw.hdu.fits&&JS9.cleanupFITSFile(B.raw.hdu.fits,!0);break;case"close":B&&B.closeImage();break;case"closeall":P&&JS9.CloseDisplay(P.id);break;case"removeproxy":B&&B.removeProxyFile();break;case"removedisplay":P&&JS9.RemoveDisplay(P.id);break;case"savecurrent":P&&B&&JS9.SaveSession({mode:"image"},{display:P});break;case"savedisplay":P&&JS9.SaveSession({mode:"display"},{display:P});break;case"loadsession":P&&JS9.OpenSessionMenu({display:P});break;case"loadcatalog":P&&JS9.OpenCatalogsMenu({display:P});break;case"savecatalog":B&&B.saveCatalog();break;case"mosaiccurrent":P&&B&&JS9.CreateMosaic("current",{display:P});break;case"mosaicdisplay":P&&JS9.CreateMosaic("all",{display:P});break;case"header":B&&(B.raw.header?B.displayAnalysis("text",JS9.raw2FITS(B.raw,{addcr:!0}),{title:`FITS Header: ${B.id}`}):JS9.error(`no FITS header for ${B.id}`));break;case"hdus":B&&(B.hdus?B.displayAnalysis("text",JS9.hdus2Str(B.hdus),{title:`FITS HDUs: ${B.id}`,winformat:"width=800px,height=200px,resize=1,scrolling=1"}):JS9.error(`no FITS header for ${B.id}`));break;case"lite":JS9.LoadWindow(null,{clone:P.id},"light");break;case"xnew":JS9.LoadWindow(null,null,"new");break;case"electronHelper":if(window.electron)try{window.electron.sendMsg("startHelper")}catch{}break;case"pageid":E=`<center><p>pageid: ${JS9.helper.pageid||"none"}</center>`,R="JS9 page id",R+=sprintf(JS9.IDFMT,P.id),JS9.lightWin(`fileid${JS9.uniqueID()}`,"inline",E,R,JS9.lightOpts[JS9.LIGHTWIN].lineWin);break;case"openboth":P&&P.displayLoadForm();break;case"openlocal":P&&JS9.OpenFileMenu({display:P});break;case"openremote":P&&P.displayLoadForm({remote:!0});break;case"savefits":case"savefitsvirtual":case"savefitsentire":B&&(E=B.id.replace(/\.png/i,".fits").replace(/\[.*\]/,"").replace(/\.gz$/i,"").replace(/\.bz2$/i,"").replace(/\s+/g,"_"),"savefits"===I?B.saveFITS(E,"display"):"savefitsvirtual"===I?B.raw.hdu&&B.raw.hdu.fits&&B.raw.hdu.fits.vfile?(E=B.raw.hdu.fits.vfile.replace(/^bz::/,"").replace(/^gz::/,""),B.saveFITS(E,"virtual")):JS9.error("no memory file available"):B.saveFITS(E));break;case"savepng":B&&(E=B.id.replace(/\.fit[s]?/i,".png").replace(/\[.*\]/,"").replace(/\.gz$/i,"").replace(/\.bz2$/i,"").replace(/\s+/g,"_"),B.savePNG(E));break;case"savejpeg":B&&(E=B.id.replace(/\.fit[s]?/i,".jpeg").replace(/\.png$/i,".jpeg").replace(/\.gz$/i,"").replace(/\[.*\]/,""),B.saveJPEG(E));break;case"print":B&&B.print();break;case"windowPrint":window.electron&&JS9.WindowPrint();break;case"windowPDF":window.electron&&JS9.WindowToPDF();break;case"saveScript":window.electron&&window.electron.app&&JS9.SaveScript();break;case"separate":P&&P.separate();break;case"gather":P&&(this.id.search(JS9.SUPERMENU)>=0&&!this.selectedDisplay&&JS9.error("gather requires a selected display"),P.gather());break;default:if(I.match(/^super_/))return N=I.replace(/^super_/,""),void JS9.Menubar.onclick.call(this,N);if(I.match(/^moveto_/))return N=I.replace(/^moveto_/,""),void("newdisp"===N?P.separate({images:[B],firstinplace:!1}):B.moveToDisplay(N));for(M=0;M<JS9.plugins.length;M++)if(D=JS9.plugins[M],D.name===I)return void P.displayPlugin(D);for(M=0;M<JS9.images.length;M++)if(B=JS9.images[M],H=I.replace(/ *\((red|green|blue)\)/,""),P.id===B.display.id&&B.id===H){B.displayImage("all"),B.refreshLayers(),P.clearMessage();break}}})},items:y}}}),$(`#editMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#editMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#editMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l=0;const c={edittitle1:{name:"Regions:",disabled:!0}};return c.configReg=s("edit"),c.copyReg=s("copy"),c.pastePos=s("paste to current pos"),c.pasteReg=s("paste to original pos"),c.undoRemove=s("undo remove"),c["sep"+l++]="------",c.edittitle2={name:"Position/Value:",disabled:!0},c.copyWCSPos=s("copy wcs pos"),c.copyValPos=s("copy value/pos"),{callback:d=>{JS9.Menubar.getDisplays.call(this).forEach(h=>{let p,g,v;const u=h.image;if(!($.inArray(h,JS9.displays)<0))switch(d){case"configReg":u&&(g=u.layers.regions,g&&(v=g.canvas.getActiveObject(),v&&"activeSelection"!==v.type?u.displayRegionsForm(v):u.displayRegionsForm(null,{multi:!0})));break;case"copyReg":u&&(p=u.listRegions(null,{mode:1}),JS9.CopyToClipboard(p));break;case"pasteReg":u&&JS9.Regions.pasteFromClipboard.call(u);break;case"pastePos":u&&JS9.Regions.pasteFromClipboard.call(u,!0);break;case"undoRemove":u&&u.unremoveRegions();break;case"copyWCSPos":({}).hasOwnProperty.call(JS9,"Keyboard")&&JS9.Keyboard.Actions["copy wcs position to clipboard"](u,u.ipos);break;case"copyValPos":({}).hasOwnProperty.call(JS9,"Keyboard")&&JS9.Keyboard.Actions["copy value and position to clipboard"](u,u.ipos)}})},items:c}}}),$(`#viewMacMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#viewMacMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#viewMacMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c;const d={edittitle1:{name:"View:",disabled:!0}};for(l=0;l<this.macmenus.length;l++)c=this.macmenus[l],d[c.name]={name:`${c.title} ...`};return{callback:h=>{$(`#${h}Menu${this.id}`).contextMenu()},items:d}}}),$(`#viewMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#viewMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#viewMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h,p,g="",v=0;const r={},u=JS9.Menubar.getDisplays.call(this)[0],f=u.image,w=(x,y)=>{let S,_,C;if(delete u.tmp.editingMenu,y.resize)switch(C=y.resize.split(/[\s,/]+/),C.length){case 0:break;case 1:f?(S=f.wcs2imlen(C[0]),x.resize(S,S)):JS9.isNumber(C[0])&&(S=parseInt(C[0],10),x.resize(S,S));break;default:f&&f.wcs?(S=f.wcs2imlen(C[0]),_=f.wcs2imlen(C[1]),x.resize(S,_)):JS9.isNumber(C[0])&&JS9.isNumber(C[1])&&(S=parseInt(C[0],10),_=parseInt(C[1],10),x.resize(S,_))}};for(r["sep"+v++]={name:"Plugins:"},r["sep"+(v-1)].disabled=!0,l=0;l<JS9.plugins.length;l++)d=JS9.plugins[l],h=d.name,d.opts.menuItem&&"view"===d.opts.menu&&(p=u.pluginInstances[h],(!p||p.winHandle)&&(d.xclass!==g&&(v+=1),g=d.xclass,r[h]=s(d.opts.menuItem),p&&"active"===p.status&&(r[h].icon=JS9.globalOpts.menuSelected)));if(r["sep"+v++]="------",r.vdispstitle={name:"Display Options:",disabled:!0},r.vdisps={name:"show ...",items:{vdispstitle:{name:"show options:",disabled:!0}}},r.vdisps.items.valpos={name:"value/position ...",items:{valpostitle:{name:"value/pos options:",disabled:!0},valpos:s("update value/pos"),valposcolor:{events:{keyup:x=>{JS9.Menubar.getDisplays.call(this).forEach(y=>{const S=$.contextMenu.getInputValues(x.data),_=x.which||x.keyCode,C=y;if(!($.inArray(C,JS9.displays)<0))switch(_){case 9:case 13:((x,y)=>{delete u.tmp.editingMenu,y.valposcolor&&(JS9.textColorOpts.info=y.valposcolor,x&&x.image&&x.image.updateValpos(x.image.ipos,!0))})(C,S);break;default:C.tmp.editingMenu=!0}})}},name:"value/pos color:",type:"text"},valposdisp:s("also show display coords")}},{}.hasOwnProperty.call(JS9,"Info")?u.image&&(u.image.params.valpos&&(r.vdisps.items.valpos.icon=JS9.globalOpts.menuSelected,r.vdisps.items.valpos.items.valpos.icon=JS9.globalOpts.menuSelected),JS9.globalOpts.valposDCoords&&(r.vdisps.items.valpos.items.valposdisp.icon=JS9.globalOpts.menuSelected)):r.vdisps.items.valpos.disabled=!0,r.vdisps.items.toggleLayers=s("active shape layers"),f&&!f.toggleLayers&&(r.vdisps.items.toggleLayers.icon=JS9.globalOpts.menuSelected),r.vdisps.items.xhair=s("crosshair for this image"),{}.hasOwnProperty.call(JS9,"Crosshair")&&f?f&&f.params.crosshair&&(r.vdisps.items.xhair.icon=JS9.globalOpts.menuSelected):r.vdisps.items.xhair.disabled=!0,r.vdisps.items.xhairwcs=s("match wcs crosshairs"),{}.hasOwnProperty.call(JS9,"Crosshair")?JS9.globalOpts.wcsCrosshair&&(r.vdisps.items.xhairwcs.icon=JS9.globalOpts.menuSelected):r.vdisps.items.xhairwcs.disabled=!0,r.vdisps.items.toolbar=s("toolbar tooltips"),{}.hasOwnProperty.call(JS9,"Toolbar")?JS9.GetToolbar("showTooltips")&&(r.vdisps.items.toolbar.icon=JS9.globalOpts.menuSelected):r.vdisps.items.toolbar.disabled=!0,JS9.allinone||(r.vdisps.items.logo=s("js9 logo"),JS9.globalOpts.logoDisplay&&(r.vdisps.items.logo.icon=JS9.globalOpts.menuSelected)),r.vdisps.items.inherit=s("new images inherit current params"),u.image&&u.image.params.inherit&&(r.vdisps.items.inherit.icon=JS9.globalOpts.menuSelected),r.vdisps.items.rawlayer={name:"raw data sources ...",items:{}},f&&f.raws.length>1){for(r.vdisps.items.rawlayer.items.whichrawtitle={name:"current raw data:"},l=0;l<f.raws.length;l++)c=`rawlayer_${f.raws[l].id}`,r.vdisps.items.rawlayer.items[c]={name:f.raws[l].id},f.raw===f.raws[l]&&(r.vdisps.items.rawlayer.items[c].icon=JS9.globalOpts.menuSelected);r.vdisps.items.rawlayer.items["sep"+v++]="------",r.vdisps.items.rawlayer.items.rawlayer_remove=s("remove")}else r.vdisps.items.rawlayer.disabled=!0;return r.resizes={name:"resize ...",items:{resizestitle:{name:"resize the display:",disabled:!0}}},r.resizes.items.resize={events:{keyup:x=>{JS9.Menubar.getDisplays.call(this).forEach(y=>{const S=$.contextMenu.getInputValues(x.data),_=x.which||x.keyCode,C=y;if(!($.inArray(C,JS9.displays)<0))switch(_){case 9:case 13:w(C,S);break;default:C.tmp.editingMenu=!0}})}},name:"change width/height:",type:"text"},r.resizes.items.imagesize=s("set to image size"),r.resizes.items.fullsize=s("set size to full window"),r.resizes.items.resetsize=s("reset to original size"),JS9.globalOpts.resize?f||(r.resizes.items.imagesize.disabled=!0):(r.resizes.items.resize.disabled=!0,r.resizes.items.fullsize.disabled=!0,r.resizes.items.imagesize.disabled=!0,r.resizes.items.resetsize.disabled=!0),{callback:x=>{JS9.Menubar.getDisplays.call(this).forEach(y=>{let S,_,C;const I=y,L=I.image;if(!($.inArray(I,JS9.displays)<0))switch(x){case"valpos":L&&L.toggleValpos();break;case"valposdisp":JS9.globalOpts.valposDCoords=!JS9.globalOpts.valposDCoords;break;case"xhair":L&&L.toggleCrosshair();break;case"xhairwcs":L&&L.toggleWCSCrosshair();break;case"toolbar":C=!JS9.GetToolbar("showTooltips"),JS9.SetToolbar("showTooltips",C);break;case"logo":for(JS9.globalOpts.logoDisplay=!JS9.globalOpts.logoDisplay,C=JS9.globalOpts.logoDisplay?"block":"none",S=0;S<JS9.displays.length;S++)JS9.displays[S].iconjq.css("display",C);break;case"toggleLayers":L&&L.toggleShapeLayers();break;case"inherit":L&&(L.params.inherit=!L.params.inherit);break;case"fullsize":I.resize("full",{center:!0});break;case"imagesize":I.resize("image");break;case"resetsize":I.resize("reset");break;default:for(S=0;S<JS9.plugins.length;S++)if(_=JS9.plugins[S],_.name===x)return void I.displayPlugin(_);if(f&&x.match(/^rawlayer_/))if(C=x.replace(/^rawlayer_/,""),"remove"===C){if(f.raw.id!==JS9.RAWID0)for(l=0;l<f.raws.length;l++)f.raw===f.raws[l]&&f.rawDataLayer(f.raw.id,"remove")}else f.rawDataLayer(C)}})},events:{show:x=>{const y=this.display,S={};y&&(S.resize=sprintf("%d %d",y.width,y.height),S.valposcolor=JS9.textColorOpts.info,$.contextMenu.setInputValues(x,S),JS9.jupyterFocus(".context-menu-item"))},hide:x=>{let y;const S=this.display;S&&S.tmp.editingMenu&&(y=$.contextMenu.getInputValues(x),w(S,y))}},items:r}}}),$(`#zoomMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#zoomMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#zoomMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h,p,g,v,r,u,f,m="",b=0;const w=JS9.Menubar.getDisplays.call(this)[0],A=w.image,x=(I,L)=>{delete w.tmp.editingMenu,Number.isNaN(L.zoom)||I.setZoom(L.zoom)},y=(I,L)=>{delete w.tmp.editingMenu2,Number.isNaN(L.rotate)||I.setRotate(L.rotate)},S=I=>{JS9.Menubar.getDisplays.call(this).forEach(L=>{const D=$.contextMenu.getInputValues(I.data),O=I.which||I.keyCode,M=L,E=M.image;if(!($.inArray(M,JS9.displays)<0))switch(O){case 9:case 13:E&&x(E,D);break;default:M.tmp.editingMenu=!0}})},_=I=>{JS9.Menubar.getDisplays.call(this).forEach(L=>{const D=$.contextMenu.getInputValues(I.data),O=I.which||I.keyCode,M=L,E=M.image;if(!($.inArray(M,JS9.displays)<0))switch(O){case 9:case 13:E&&y(E,D);break;default:M.tmp.editingMenu2=!0}})},C={zoomtitle:{name:"Zoom Factors:",disabled:!0}};for(l=JS9.imageOpts.topZooms;l>=1;l--)c=Math.pow(2,-l),d=Math.pow(2,l),h=`zoom${c}`,p=`zoom 1/${d}`,C[h]=s(p),A&&A.rgb.sect.zoom===c&&(C[h].icon=JS9.globalOpts.menuSelected);for(l=0;l<=JS9.imageOpts.topZooms;l++)c=Math.pow(2,l),h=`zoom${c}`,p=`zoom ${c}`,C[h]=s(p),A&&A.rgb.sect.zoom===c&&(C[h].icon=JS9.globalOpts.menuSelected);for(C.morezooms={name:"more zooms ...",items:{morezoomstitle:{name:"Zoom Factors:",disabled:!0}}},l=JS9.imageOpts.zooms;l>JS9.imageOpts.topZooms;l--)c=Math.pow(2,-l),d=Math.pow(2,l),h=`zoom${c}`,p=`zoom 1/${d}`,C.morezooms.items[h]=s(p),A&&A.rgb.sect.zoom===c&&(C.morezooms.items[h].icon=JS9.globalOpts.menuSelected);for(l=JS9.imageOpts.topZooms+1;l<=JS9.imageOpts.zooms;l++)c=Math.pow(2,l),h=`zoom${c}`,p=`zoom ${c}`,C.morezooms.items[h]=s(p),A&&A.rgb.sect.zoom===c&&(C.morezooms.items[h].icon=JS9.globalOpts.menuSelected);for(C.zoom={events:{keyup:S},name:"numeric zoom:",type:"text"},C["sep"+b++]="------",C.zoomiotitle={name:"Zoom In/Out:",disabled:!0},C.zoomIn=s("zoom in"),C.zoomOut=s("zoom out"),C.zoomToFit=s("zoom to fit"),C["sep"+b++]="------",C.panzoomtitle={name:"Pand and Zoom:",disabled:!0},C.center=s("pan to center"),C.alignpanzoom={name:"align pan/zoom ...",items:{alignpanzoomtitle:{name:"to this image:",disabled:!0}}},l=0,g=0;l<JS9.images.length;l++)if(JS9.images[l].raw.wcs){if(A===JS9.images[l]&&this.id.search(JS9.SUPERMENU)<0)continue;v=`alignpanzoom_${JS9.images[l].id}`,C.alignpanzoom.items[v]={name:JS9.images[l].id},g++}for(0===g?C.alignpanzoom.items.notasks={name:"[none]",disabled:!0,events:{keyup(){}}}:C.alignpanzoom.disabled=!1,C.reset=s("reset pan/zoom"),C.pantoclick={name:"(pan to mouse: Meta-click)",disabled:!0},C["sep"+b++]="------",C.fliptitle={name:"Flip:",disabled:!0},C.flipX=s("x axis"),A&&A.raw&&A.raw.hdu&&A.raw.hdu.fits||(C.flipX.disabled=!0),C.flipY=s("y axis"),A&&A.raw&&A.raw.hdu&&A.raw.hdu.fits||(C.flipY.disabled=!0),C["sep"+b++]="------",C.rot90title={name:"Rotate:",disabled:!0},C.rot90_90=s("90 left"),A&&A.raw&&A.raw.hdu&&A.raw.hdu.fits||(C.rot90_90.disabled=!0),C.rot90_270=s("90 right"),A&&A.raw&&A.raw.hdu&&A.raw.hdu.fits||(C.rot90_270.disabled=!0),C.rotate={events:{keyup:_},name:"rotation angle:",type:"text"},C["sep"+b++]="------",C.northisup=s("align: north is up"),(!A||!A.raw||!A.raw.hdu||!A.raw.hdu.fits||!A.raw.wcs||A.raw.wcs<=0)&&(C.northisup.disabled=!0),C.resetall=s("reset flip/rot90/rotate"),C["sep"+b++]="------",l=0;l<JS9.plugins.length;l++)r=JS9.plugins[l],u=r.name,r.opts.menuItem&&"zoom"===r.opts.menu&&(f=w.pluginInstances[u],(!f||f.winHandle)&&(r.xclass!==m&&(b+=1),m=r.xclass,C[u]=s(r.opts.menuItem),f&&"active"===f.status&&(C[u].icon=JS9.globalOpts.menuSelected)));return{callback:I=>{let L,D;JS9.Menubar.getDisplays.call(this).forEach(O=>{const M=O,E=M.image;if(!($.inArray(M,JS9.displays)<0)&&E)switch(I){case"zoomIn":E.setZoom("x2");break;case"zoomOut":E.setZoom("/2");break;case"zoomToFit":E.setZoom("tofit");break;case"center":E.setPan();break;case"reset":E.setZoom("1"),E.setPan();break;case"flipX":E.setFlip("x");break;case"flipY":E.setFlip("y");break;case"rot90_90":E.setRot90(90);break;case"rot90_270":E.setRot90(-90);break;case"northisup":E.setRot90("reset"),E.setRotate("northisup");break;case"resetall":E.setFlip("reset"),E.setRot90("reset"),E.setRotate("reset");break;default:for(L=0;L<JS9.plugins.length;L++)if(D=JS9.plugins[L],D.name===I)return void M.displayPlugin(D);I.match(/^zoom/)?E.setZoom(I.slice(4)):I.match(/^alignpanzoom_/)&&E.alignPanZoom(I.slice(13))}})},events:{show:I=>{const D=this.display.image,O={};D&&(O.zoom=JS9.floatToString(D.rgb.sect.zoom),O.rotate=JS9.floatToString(D.params.rotate||0)),$.contextMenu.setInputValues(I,O),JS9.jupyterFocus(".context-menu-item")},hide:I=>{let L;const D=this.display,O=D.image;O&&(D.tmp.editingMenu&&(L=$.contextMenu.getInputValues(I),x(O,L)),D.tmp.editingMenu2&&(L=$.contextMenu.getInputValues(I),y(O,L)))}},items:C}}}),$(`#scaleMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#scaleMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#scaleMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h,p,g,v="",r=0;const u={},f=JS9.Menubar.getDisplays.call(this)[0],m=(w,A)=>{let x=w.params.scalemin,y=w.params.scalemax;delete f.tmp.editingMenu,JS9.isNumber(A.scalemin)&&(x=parseFloat(A.scalemin)),JS9.isNumber(A.scalemax)&&(y=parseFloat(A.scalemax)),w.setScale(x,y),w.displayImage("colors")},b=w=>{JS9.Menubar.getDisplays.call(this).forEach(A=>{const x=$.contextMenu.getInputValues(w.data),y=w.which||w.keyCode,S=A,_=S.image;if(!($.inArray(S,JS9.displays)<0))switch(y){case 9:case 13:_&&m(_,x);break;default:S.tmp.editingMenu=!0}})};for(u.scaletitle={name:"Scaling Algorithms:",disabled:!0},l=0;l<JS9.scales.length;l++)c=JS9.scales[l],d=c,u[c]=s(d),f.image&&f.image.params.scale===c&&(u[c].icon=JS9.globalOpts.menuSelected);for(u["sep"+r++]="------",u.dlims={name:"data limits ...",items:{title:{name:"set data limits to:",disabled:!0},dataminmax:{name:"data min/max"},zscale:{name:"zscale z1/z2"},zmax:{name:"zscale z1/data max"}}},u.scalemin={events:{keyup:b},name:"low:",type:"text"},u.scalemax={events:{keyup:b},name:"high:",type:"text"},u["sep"+r++]="------",l=0;l<JS9.plugins.length;l++)h=JS9.plugins[l],p=h.name,h.opts.menuItem&&"scale"===h.opts.menu&&(g=f.pluginInstances[p],(!g||g.winHandle)&&(h.xclass!==v&&(r+=1),v=h.xclass,u[p]=s(h.opts.menuItem),g&&"active"===g.status&&(u[p].icon=JS9.globalOpts.menuSelected)));return{callback:w=>{let A,x;JS9.Menubar.getDisplays.call(this).forEach(y=>{const S=y,_=S.image;if(!($.inArray(S,JS9.displays)<0)&&_){for(A=0;A<JS9.plugins.length;A++)if(x=JS9.plugins[A],x.name===w)return void S.displayPlugin(x);_.setScale(w)}})},events:{show:w=>{const x=this.display.image,y={};x&&(y.scalemin=JS9.floatToString(x.params.scalemin),y.scalemax=JS9.floatToString(x.params.scalemax)),$.contextMenu.setInputValues(w,y),JS9.jupyterFocus(".context-menu-item")},hide:w=>{let A;const x=this.display,y=x.image;y&&x.tmp.editingMenu&&(A=$.contextMenu.getInputValues(w),m(y,A))}},items:u}}}),$(`#colorMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#colorMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#colorMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h,p,g,v,r,u="",f=0;const m={},b=JS9.Menubar.getDisplays.call(this)[0],w=(x,y)=>{delete b.tmp.editingMenu,y.contrast&&!Number.isNaN(y.contrast)&&(x.params.contrast=parseFloat(y.contrast)),y.bias&&!Number.isNaN(y.bias)&&(x.params.bias=parseFloat(y.bias)),y.opacity.match(/reset/)||""===y.opacity.trim()?x.setOpacity("reset"):Number.isNaN(y.opacity)||x.setOpacity(parseFloat(y.opacity)),x.displayImage("colors")},A=x=>{JS9.Menubar.getDisplays.call(this).forEach(y=>{const S=$.contextMenu.getInputValues(x.data),_=x.which||x.keyCode,C=y,I=C.image;if(!($.inArray(C,JS9.displays)<0))switch(_){case 9:case 13:w(I,S);break;default:C.tmp.editingMenu=!0}})};for(m.cmaptitle={name:"Colormaps:",disabled:!0},l=0;l<JS9.globalOpts.topColormaps.length;l++)c=JS9.globalOpts.topColormaps[l],d=c,JS9.globalOpts.menuImages?(p=JS9.Menubar.menuImage(`images/voyager/color_${d}.png`),h=`<div class='JS9MenubarImage' name='${d}'><img src='${p}' name='color_${d}' class='JS9MenubarImage JS9MenubarImageOption' onerror='JS9.Menubar.missing["color_${d}.png"]=true; this.src="${JS9.Menubar.EMPTYIMG}"' >&nbsp;&nbsp;${d}</div>`,m[c]={name:h,isHtmlName:!0}):m[c]=s(d),b.image&&b.image.cmapObj.name===c&&(m[c].icon=JS9.globalOpts.menuSelected);for(m.morecmaps={name:"more colormaps ...",items:{morecmapstitle:{name:"Colormaps:",disabled:!0}}},l=0;l<JS9.colormaps.length;l++)c=JS9.colormaps[l].name,JS9.globalOpts.topColormaps.includes(c)||(d=c,JS9.globalOpts.menuImages?(p=JS9.Menubar.menuImage(`images/voyager/color_${d}.png`),h=`<div class='JS9MenubarImage' name='${d}'><img src='${p}' name='color_${d}' class='JS9MenubarImage JS9MenubarImageOption' onerror='JS9.Menubar.missing["color_${d}.png"]=true; this.src="${JS9.Menubar.EMPTYIMG}"' >&nbsp;&nbsp;${d}</div>`,m.morecmaps.items[c]={name:h,isHtmlName:!0}):m.morecmaps.items[c]=s(d),b.image&&b.image.cmapObj.name===c&&(m.morecmaps.items[c].icon=JS9.globalOpts.menuSelected));for(m["sep"+f++]="------",m.imfilter=s("image filters ..."),m["sep"+f++]="------",m.contrast={events:{keyup:A},name:"contrast:",type:"text"},m.bias={events:{keyup:A},name:"bias:",type:"text"},m.reset=s("reset contrast & bias"),m["sep"+f++]="------",m.opacity={events:{keyup:A},name:"opacity:",type:"text"},m["sep"+f++]="------",m.loadcmap=s("load ..."),m.savecmap=s("save"),m["sep"+f++]="------",m.invert=s("invert"),b.image&&b.image.params.invert&&(m.invert.icon=JS9.globalOpts.menuSelected),m.rgb=s("rgb mode"),b.rgb.active&&(m.rgb.icon=JS9.globalOpts.menuSelected),b.image&&b.image.offscreen&&!b.image.rgbFile&&(m.overlay=s("image overlay"),b.image.params.overlay&&(m.overlay.icon=JS9.globalOpts.menuSelected)),m["sep"+f++]="------",l=0;l<JS9.plugins.length;l++)g=JS9.plugins[l],v=g.name,g.opts.menuItem&&"color"===g.opts.menu&&(r=b.pluginInstances[v],(!r||r.winHandle)&&(g.xclass!==u&&(f+=1),u=g.xclass,m[v]=s(g.opts.menuItem),r&&"active"===r.status&&(m[v].icon=JS9.globalOpts.menuSelected)));return{callback:x=>{let y,S;JS9.Menubar.getDisplays.call(this).forEach(_=>{const C=_,I=C.image;if(!($.inArray(C,JS9.displays)<0))switch(x){case"loadcmap":JS9.OpenColormapMenu({display:C});break;case"savecmap":JS9.SaveColormap({display:C});break;case"imfilter":JS9.DisplayPlugin("JS9Filters",{display:C});break;default:for(y=0;y<JS9.plugins.length;y++)if(S=JS9.plugins[y],S.name===x)return void C.displayPlugin(S);I&&I.setColormap(x)}})},events:{show:x=>{const S=this.display.image,_={};S&&(_.contrast=JS9.floatToString(S.params.contrast),_.bias=JS9.floatToString(S.params.bias),_.opacity=JS9.floatToString(S.params.opacity),_.sigma=JS9.floatToString(S.params.sigma)),$.contextMenu.setInputValues(x,_),JS9.jupyterFocus(".context-menu-item")},hide:x=>{let y;const S=this.display,_=S.image;_&&S.tmp.editingMenu&&(y=$.contextMenu.getInputValues(x),w(_,y))}},items:m}}}),$(`#regionMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#regionMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#regionMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h,p;const v=JS9.Menubar.getDisplays.call(this)[0].image,r={},u=(m,b)=>{switch(m){case"color":if("#"!==b.charAt(0)&&JS9.colorToHex(b)===b)return null;break;case"strokeWidth":if(!JS9.isNumber(b))return null;b=parseFloat(b);break;case"strokeDashArray":if(!((b=b.split(/[\s,]+/))&&b.length&&(b.length<2&&(b[1]="0"),JS9.isNumber(b[0])&&JS9.isNumber(b[1]))))return null;b[0]=parseFloat(b[0]),b[1]=parseFloat(b[1])}return b};if(r.regiontitle={name:"Regions:",disabled:!0},JS9.globalOpts.menuImages)for(l=0;l<JS9.regions.length;l++)d=JS9.regions[l],h=JS9.Menubar.menuImage(`images/voyager/regions_${d}.svg`),r[d]={name:`<div class='JS9MenubarImage' name='${d}'><img src='${h}' name='regions_${d}' class='JS9MenubarImage JS9MenubarImageOption' onerror='JS9.Menubar.missing["regions_${d}.svg"]=true; this.src="${JS9.Menubar.EMPTYIMG}"' >&nbsp;&nbsp;${d}</div>`,isHtmlName:!0};else for(l=0;l<JS9.regions.length;l++)d=JS9.regions[l],r[d]=s(d);for(p of(r.sep1="------",r.createRegions=s("menu adds region @ center"),JS9.globalOpts.regMenuCreate&&(r.createRegions.icon=JS9.globalOpts.menuSelected),Object.keys(JS9.globalOpts.keyboardActions)))"add last region selected in regions menu"===JS9.globalOpts.keyboardActions[p]&&(r.notCreateRegions={name:`('${p}' adds region @ mouse)`,disabled:!0});if(r.sep1a="------",r.listRegions=s("list"),r.loadRegions=s("load ..."),r.saveRegions=s("save ..."),r.copyto={name:"copy to ...",items:{copytotitle:{name:"choose image:",disabled:!0}}},r.removeRegions=s("remove"),r.sep2="------",r.selectRegions=s("select all"),r.unselectRegions=s("unselect all"),r.selectedRegions=s("selected ..."),r.sep3="------",r.onchange={name:"onchange ...",items:{listonchange:s("list on change"),xeqonchange:s("xeq on change")}},v&&v.params.listonchange&&(r.onchange.items.listonchange.icon=JS9.globalOpts.menuSelected),v&&v.params.xeqonchange&&(r.onchange.items.xeqonchange.icon=JS9.globalOpts.menuSelected),v&&JS9.images.length>1){for(l=0;l<JS9.images.length;l++)v!==JS9.images[l]&&(c=`copyto_${JS9.images[l].id}`,r.copyto.items[c]=s(JS9.images[l].id));r.copyto.items.copyto_all=s("all images"),r.copyto.disabled=!1}else r.copyto.disabled=!0;return{}.hasOwnProperty.call(JS9,"Info")||(r.listRegions.disabled=!0),{callback:m=>{JS9.Menubar.getDisplays.call(this).forEach(b=>{let w,A,x,y;const S=b,_=S.image;if(!($.inArray(S,JS9.displays)<0)&&_)switch(m){case"loadRegions":JS9.OpenRegionsMenu({display:S});break;case"listRegions":_.listRegions(null,{mode:2});break;case"createRegions":JS9.globalOpts.regMenuCreate=!JS9.globalOpts.regMenuCreate;break;case"removeRegions":_.removeShapes("regions",null),S.clearMessage("regions");break;case"saveRegions":A=_.layers.regions,A&&(x=A.canvas.getActiveObject(),y={type:"save"},_.displayRegionsForm(x&&"activeSelection"!==x.type?x:null,y));break;case"selectRegions":({}).hasOwnProperty.call(JS9,"Keyboard")&&JS9.Keyboard.Actions["select all regions"](_,_.ipos);break;case"unselectRegions":({}).hasOwnProperty.call(JS9,"Keyboard")&&JS9.Keyboard.Actions["unselect all regions"](_,_.ipos);break;case"selectedRegions":A=_.layers.regions,A&&(x=A.canvas.getActiveObject(),x&&"activeSelection"!==x.type?_.displayRegionsForm(x):_.displayRegionsForm(null,{multi:!0}));break;case"xeqonchange":_.params.xeqonchange=!_.params.xeqonchange;break;case"listonchange":_.params.listonchange=!_.params.listonchange;break;default:if(m.match(/^copyto_/))return w=m.replace(/^copyto_/,""),void _.copyRegions(w);JS9.globalOpts.regMenuSelected=m,JS9.globalOpts.regMenuCreate&&_.addShapes("regions",m,{ireg:!0})}})},events:{show:m=>{$.contextMenu.setInputValues(m,{color:""}),JS9.jupyterFocus(".context-menu-item")},hide:m=>{let b;const A=this.display.image;A&&(b=$.contextMenu.getInputValues(m),((m,b,w)=>{let A,x;const y={};if(b=b||{},w)A=w.substring(3),x=b[w],A&&x&&m.tmp[`editingReg${w}`]&&(delete m.tmp[`editingReg${w}`],x=u(A,x),x&&(y[A]=x,m.changeShapes("regions","selected",y)));else{for(w of Object.keys(b))A=w.substring(3),x=b[w],A&&x&&m.tmp[`editingReg${w}`]&&(delete m.tmp[`editingReg${w}`],x=u(A,x),x&&(y[A]=x));Object.keys(y).length&&m.changeShapes("regions","selected",y)}})(A,b))}},items:r}}}),$(`#wcsMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#wcsMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#wcsMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h,p,g,v,r=0,u=0,f=0;const m={},b=JS9.Menubar.getDisplays.call(this)[0],w=b.image,A=(y,S)=>{delete b.tmp.editingMenu,JS9.isNumber(S.rot)&&y.rotateData(parseFloat(S.rot))};for(m.wcssystitle={name:"WCS Systems:",disabled:!0},g=!w||w&&w.validWCS()?JS9.wcssyss:["image","physical"],l=0;l<g.length;l++)c=g[l],d=c,m[c]=s(d),w&&w.params.wcssys===c&&(m[c].icon=JS9.globalOpts.menuSelected,f++);for(f||(c=!w||w&&w.validWCS()?"native":"image",m[c].icon=JS9.globalOpts.menuSelected),m["sep"+r++]="------",m.wcsutitle={name:"WCS Units:",disabled:!0},v=!w||w&&w.validWCS()?JS9.wcsunitss:["pixels"],l=0;l<v.length;l++)c=v[l],d=c,m[c]=s(d),w&&w.params.wcsunits===c&&(m[c].icon=JS9.globalOpts.menuSelected);if(m["sep"+r++]="------",m.altwcs={name:"alternate wcs",items:{altwcstitle:{name:"choose a wcs:",disabled:!0}}},w&&w.raw&&w.raw.altwcs){for(h of(p=w.raw.altwcs,Object.keys(p)))c=`altwcs_${h}`,d=p[h].header.WCSNAME?`${p[h].header.WCSNAME}    (${h})`:h,m.altwcs.items[c]=s(d),w.raw.wcs===p[h].wcs&&(m.altwcs.items[c].icon=JS9.globalOpts.menuSelected),u++;u<2&&(m.altwcs.disabled=!0,m.altwcs.items.notasks={name:"[none]",disabled:!0,events:{keyup(){}}})}else m.altwcs.disabled=!0;for(m["sep"+r++]="------",m.reproject={name:"wcs reproject ...",items:{reprojtitle:{name:"this image, using the wcs from:",disabled:!0}}},l=0,u=0;l<JS9.images.length;l++)if(JS9.images[l].raw.wcs){if(w===JS9.images[l]&&this.id.search(JS9.SUPERMENU)<0)continue;c=`reproject_${JS9.images[l].id}`,m.reproject.items[c]={name:JS9.images[l].id},u++}return 0===u?m.reproject.items.notasks={name:"[none]",disabled:!0,events:{keyup(){}}}:(m.reproject.disabled=!1,m.reproject.items["sep"+r++]="------",m.reproject.items.reproject_all={name:"all images in this display, using this wcs"},m.reproject.items["sep"+r++]="------",m.reproject.items.reproject_wcsalign={name:"display wcs-aligned"},w&&w.params.wcsalign&&(m.reproject.items.reproject_wcsalign.icon=JS9.globalOpts.menuSelected)),m.reproject.items["sep"+r++]="------",m.reproject.items.rotatetitle={name:"by rotating this image:",disabled:!0},m.reproject.items.reproject_northup={name:"so north is up"},m.reproject.items.rot={events:{keyup:y=>{JS9.Menubar.getDisplays.call(this).forEach(S=>{const _=$.contextMenu.getInputValues(y.data),C=y.which||y.keyCode,I=S,L=I.image;if(!($.inArray(I,JS9.displays)<0))switch(C){case 9:case 13:L&&A(L,_);break;default:I.tmp.editingMenu=!0}})}},name:"by this angle in deg:",type:"text"},w&&w.raw&&w.raw.header&&w.raw.wcsinfo||(m.reproject.disabled=!0),m.reproject.items["sep"+r++]="------",m.reproject.items.reproject_revert={name:"revert"},{callback:y=>{JS9.Menubar.getDisplays.call(this).forEach(S=>{let _,C;const I=new RegExp(y),D=S.image;if(!($.inArray(S,JS9.displays)<0)&&D){if(y.match(/^altwcs_/))return C=y.replace(/^altwcs_/,""),void D.setWCS(C);if(y.match(/^reproject_/)){if("reproject_wcsalign"===y)D.params.wcsalign=!D.params.wcsalign,D.displayImage("display");else if("reproject_northup"===y)D.rotateData("northisup");else if("reproject_revert"===y){if(D.raw.id!==JS9.RAWID0)for(l=0;l<D.raws.length;l++)D.raw===D.raws[l]&&D.rawDataLayer(D.raw.id,"remove")}else"reproject_all"===y?D.reprojectData("all"):(_=y.replace(/^reproject_/,""),D.reprojectData(_));return}JS9.wcssyss.join("@").search(I)>=0?(D.setWCSSys(y),D.updateShapes("regions","all","wcs")):JS9.wcsunitss.join("@").search(I)>=0?(D.setWCSUnits(y),D.updateShapes("regions","all","wcs")):JS9.error(`unknown wcs sys/units: ${y}`)}})},events:{show:y=>{const C={};this.display.image&&(C.rot="",$.contextMenu.setInputValues(y,C),JS9.jupyterFocus(".context-menu-item"))},hide:y=>{let S;const _=this.display,C=_.image;C&&(S=$.contextMenu.getInputValues(y),_.tmp.editingMenu&&A(C,S))}},items:m}}}),$(`#analysisMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#analysisMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#analysisMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h,p,g,v,r,u="",f=0,m=0;const b={},w=JS9.Menubar.getDisplays.call(this)[0],A=w.image,x=(S,_)=>{delete w.tmp.editingMenu,_.sigma=_.sigma||"0","none"===_.sigma&&(_.sigma="0");try{S.params.sigma=parseFloat(_.sigma)}catch{S.params.sigma=0}S.gaussBlurData(S.params.sigma)},y=S=>{JS9.Menubar.getDisplays.call(this).forEach(_=>{const C=$.contextMenu.getInputValues(S.data),I=S.which||S.keyCode,L=_,D=L.image;if(!($.inArray(L,JS9.displays)<0))switch(I){case 9:case 13:x(D,C);break;default:L.tmp.editingMenu=!0}})};for(l=0;l<JS9.plugins.length;l++)g=JS9.plugins[l],r=g.name,g.opts.menuItem&&"analysis"===g.opts.menu&&(v=w.pluginInstances[r],(!v||v.winHandle)&&(g.xclass!==u&&(f>0&&(b["sep"+f++]="------"),b["sep"+f++]={name:`${g.xclass} Plugins:`},b["sep"+(f-1)].disabled=!0),u=g.xclass,b[r]={name:g.opts.menuItem},v&&"active"===v.status&&(b[r].icon=JS9.globalOpts.menuSelected),f++));if(!JS9.allinone){if(f>0&&(b["sep"+f++]="------"),b.localtitle={name:"Client-side Analysis:",disabled:!0},b.grid=s("Coordinate Grid"),!A||!A.raw.wcs||A.raw.wcs<=0?b.grid.disabled=!0:A.displayCoordGrid()&&(b.grid.icon=JS9.globalOpts.menuSelected),b.regcnts=s("Counts in Regions"),b.radprof=s("Radial Profile"),JS9.globalOpts.internalRegcnts&&A&&A.raw&&A.raw.hdu&&A.raw.hdu.vfile||(b.regcnts.disabled=!0,b.radprof.disabled=!0),A&&A.raw&&3===A.raw.header.NAXIS&&(b.cnts3d=s("3D Counts in Regions"),b.plot3d=s("3D Plot using Regions"),(!JS9.globalOpts.internalRegcnts||!A.raw.hdu||!A.raw.hdu.vfile)&&(b.cnts3d.disabled=!0,b.plot3d.disabled=!0)),b.sigma={events:{keyup:y},name:"Blur, equivalent sigma:",type:"text"},b["sep"+f++]="------",b.remotetitle={name:"Server-side Analysis:",disabled:!0},A&&A.analysisPackages)for(h=A.analysisPackages,c=0;c<h.length;c++)for(p=h[c],l=0;l<p.length;l++)if(A.validateAnalysis(p[l])){if(p[l].rtype&&p[l].rtype.match(/^---/)){b["sep"+f++]="------",b[p[l].name]={name:`${p[l].title}:`,disabled:!0};continue}d=p[l].title,p[l].purl&&(d+=" ..."),b[p[l].name]={name:d},m++}m||(b.notasks={name:"[none]",disabled:!0,events:{keyup(){}}},JS9.globalOpts.loadProxy&&A&&A.raw&&A.raw.hdu&&A.raw.hdu.vfile&&(b.upload={name:"upload FITS to make tasks available"},(!JS9.helper.connected||"nodejs"!==JS9.helper.type&&"socket.io"!==JS9.helper.type)&&(b.upload.disabled=!0))),b["sep"+f++]="------",b.sconfig={name:"server-side params ...",items:{}},b.sconfig.items.dpath=s("set data analysis path ..."),!1===JS9.globalOpts.dataPathModify&&(b.sconfig.items.dpath.disabled=!0),b.sconfig.items.fpath=s("set this image file's path ..."),(!A||document.domain&&"localhost"!==document.domain)&&(b.sconfig.items.fpath.disabled=!0)}return{callback:S=>{JS9.Menubar.getDisplays.call(this).forEach(_=>{let C,I,L,D,O;const M=_,E=M.image;if(!($.inArray(M,JS9.displays)<0)){for(D=0;D<JS9.plugins.length;D++)if(O=JS9.plugins[D],O.name===S)return void M.displayPlugin(O);if(E)switch(S){case"regcnts":JS9.CountsInRegions("$sregions","$bregions",{lightwin:!0},{display:M.id});break;case"radprof":JS9.RadialProfile("$sregions","$bregions",{display:M.id});break;case"cnts3d":I=JS9.globalOpts.plot3d.cube,JS9.CountsInRegions("$sregions","$bregions",{lightwin:!0,cmdswitches:`-c ${I}`},{display:M.id});break;case"plot3d":JS9.Plot3D("$sregions","$bregions",null,{display:M.id});break;case"dpath":$(JS9.lightOpts[JS9.LIGHTWIN].topid).arrive("#dataPathForm",{onceOnly:!0},()=>{$("#dataPath").val(JS9.globalOpts.dataPath)}),L=E.displayAnalysis("textline",JS9.InstallDir(JS9.analOpts.dpathURL),{title:"Data path for analysis"}),$(L).data("dispid",M.id),$(L).data("imid",E.id);break;case"fpath":$(JS9.lightOpts[JS9.LIGHTWIN].topid).arrive("#filePathForm",{onceOnly:!0},()=>{$("#filePath").val(E.file)}),L=E.displayAnalysis("textline",JS9.InstallDir(JS9.analOpts.fpathURL),{title:"File path for this image"}),$(L).data("dispid",M.id),$(L).data("imid",E.id);break;case"grid":E.displayCoordGrid(!E.displayCoordGrid());break;case"upload":E.uploadFITSFile();break;default:return C=E.lookupAnalysis(S),void(C&&(C.purl?(L=E.displayAnalysis("params",JS9.InstallDir(C.purl),{title:`${C.title}: ${E.fitsFile}`,winformat:C.pwin}),$(L).data("dispid",M.id).data("aname",C.name)):E.runAnalysis(C.name)))}}})},events:{show:S=>{const C=this.display.image,I={};C&&(I.sigma=JS9.floatToString(C.params.sigma)),$.contextMenu.setInputValues(S,I),JS9.jupyterFocus(".context-menu-item")},hide:S=>{let _;const C=this.display,I=C.image;I&&C.tmp.editingMenu&&(_=$.contextMenu.getInputValues(S),x(I,_))}},items:b}}}),$(`#helpMenu${this.id}`).on("mousedown",l=>{l.preventDefault(),$(`#helpMenu${this.id}`).contextMenu()}),$.contextMenu({selector:`#helpMenu${this.id}`,zIndex:JS9.MENUZINDEX,events:{hide:t},position:e,build:()=>{let l,c,d,h=1,p="";const g={js9help:{name:"General help ...",items:{helptitle:{name:"General help:",disabled:!0}}}};for(c of Object.keys(JS9.helpOpts))d=JS9.helpOpts[c],"JS9Help"===d.heading&&(p=d.type,g.js9help.items[c]={name:d.title});for(c of(g["sep"+h++]="------",g.pluginhelp={name:"JS9 plugins ...",items:{helptitle:{name:"JS9 plugins:",disabled:!0}}},Object.keys(JS9.helpOpts)))d=JS9.helpOpts[c],"JS9"===d.heading&&(p=d.type,g.pluginhelp.items[c]={name:d.title.replace(/ \.\.\./,"")});for(c of Object.keys(JS9.helpOpts))d=JS9.helpOpts[c],"JS9Help"!==d.heading&&"JS9"!==d.heading&&(""!==p&&d.type!==p&&(g["sep"+h++]="------",d.heading&&(l=`${d.heading} plugins`,g["sep"+h++]={name:`${l} ...`,items:{title:{name:`${l}:`,disabled:!0}}})),p=d.type,g["sep"+(h-1)].items[c]={name:d.title});return g["sep"+h++]="------",g.about=s("About"),{callback:v=>{"about"===v?alert(JS9.ABOUT):JS9.DisplayHelp(v)},items:g}}}),(()=>{let l,c;if(JS9.globalOpts.userMenuBar)for(l=0;l<JS9.globalOpts.userMenuBar.length;l++)c=JS9.globalOpts.userMenuBar[l],c&&c.name&&c.title&&($(`#${c.name}UserMenu${this.id}`).on("mousedown",c,o),n(c))})()},JS9.Menubar.init=function(e,t){let s,o,n,a,l,c,d;for(this.issuper=this.id.search(JS9.SUPERMENU)>=0,this.issuper&&JS9.supermenus.push(this),this.style=this.divjq.attr("data-style")||JS9.globalOpts.menubarStyle||"classic",this.style=this.style.toLowerCase(),this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Menubar.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.buttonClass=this.divjq.attr("data-buttonClass")||"JS9Button",this.containerClass="JS9MenubarContainer",this.buttonClass.match(/-flat/)?this.containerClass+="-flat":this.buttonClass.match(/-border/)&&(this.containerClass+="-border"),this.backgroundColor=this.divjq.attr("data-backgroundColor"),this.height||(this.height=t||JS9.MENUHEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.usermenus="true"===this.divjq.attr("data-usermenus")||JS9.globalOpts.userMenus,d="<span id='JS9Menus_@@ID@@'>",o=0;o<JS9.globalOpts.menuBar.length;o++)for(c=JS9.globalOpts.menuBar[o],s=0;s<JS9.Menubar.buttonOptsArr.length;s++)if(a=JS9.Menubar.buttonOptsArr[s].name,c===a){if(l=JS9.Menubar.buttonOptsArr[s].label,JS9.allinone&&"help"===a)break;if("#"===a[0])"classic"===this.syle&&(a=a.slice(1),"#"!==a[1]&&(d+=`<button type='button' id='${a}Menu@@ID@@' class='${this.buttonClass}' disabled='disabled'>${l} </button>`));else if("classic"===this.style)d+=`<button type='button' id='${a}Menu@@ID@@' class='${this.buttonClass}'>${l}</button>`;else switch(a){case"file":case"edit":d+=`<button type='button' id='${a}Menu@@ID@@' class='${this.buttonClass}'>${l}</button>`;break;case"help":d+=`<span style='float:right'><button type='button' id='${a}Menu@@ID@@' class='${this.buttonClass}'>${l}</button></span>`;break;default:this.macmenus||(d+=`<span style='position:relative;'><button type='button' id='viewMacMenu@@ID@@' class='${this.buttonClass}'>View</button>`,this.macmenus=[]),"View"===l&&(l="Plugins"),d+=`<button type='button' id='${a}Menu@@ID@@' class='${this.buttonClass}' style='position:absolute;top:0px;left:0px;visibility:hidden;zindex:-1'></button>`,this.macmenus.push({name:a,title:l})}break}if(this.macmenus&&(d+="</span>"),this.usermenus&&JS9.globalOpts.userMenuBar)for(d+=JS9.globalOpts.userMenuDivider||"",o=0;o<JS9.globalOpts.userMenuBar.length;o++)c=JS9.globalOpts.userMenuBar[o],c&&c.name&&c.title&&c.options&&(n=c.imageTitle?`<div class='JS9MenubarUserImage'><img src='${c.imageTitle}' name='${c.name}' alt='${c.title}' class='JS9MenubarUserImage JS9MenubarUserImageTitle' ></div>`:c.title,d+=`<button type='button' id='${c.name}UserMenu@@ID@@' class='${this.buttonClass}'>${n}</button>`);d+="<button type='button' id='hiddenRegionMenu@@ID@@'class='JS9Button' style='display:none'>R</button>",d+="<button type='button' id='hiddenAnchorMenu@@ID@@'class='JS9Button' style='display:none'>R</button>",d+="</span>",this.display.menubar=this,this.html=d.replace(/@@ID@@/g,this.id),this.menuConjq=$("<div>").addClass(this.containerClass).attr("width",this.width).attr("height",this.height).html(this.html).appendTo(this.divjq),this.backgroundColor&&this.menuConjq.css("background",this.backgroundColor),JS9.Menubar.createMenus.call(this)},JS9.RegisterPlugin("JS9","Menubar",JS9.Menubar.init,{onupdateprefs:JS9.Menubar.reset,dynamicSelect:!0,winDims:[JS9.Menubar.WIDTH,JS9.Menubar.HEIGHT]}),JS9.Panner={},JS9.Panner.CLASS="JS9",JS9.Panner.NAME="Panner",JS9.Panner.WIDTH=320,JS9.Panner.HEIGHT=320,JS9.Panner.SWIDTH=250,JS9.Panner.SHEIGHT=250,JS9.Panner.VSIZE=30,JS9.Panner.NORTH={color:"#00FF00",text:"N",fontSize:12,fontFamily:"Helvetica",strokeWidth:1,strokeDashArray:[2,1]},JS9.Panner.EAST={color:"#FFFF00",text:"E",fontSize:12,fontFamily:"Helvetica",strokeWidth:1,strokeDashArray:[2,1]},JS9.Panner.opts={hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,zoom:4,canvas:{selection:!0},tagcolors:{defcolor:"#00FF00"}},JS9.Panner.bcall=function(...e){let t,s,o,[n,a,l]=e;switch(t=$(n).closest("div[class^=JS9PluginToolbar]").data("displayid"),t?(o=JS9.getImage(JS9.getDynamicDisplayOr(t)),s=o.display.pluginInstances.JS9Panner):JS9.error(`can't find display for cmd: ${a}`),o||JS9.error(`can't find image for cmd: ${a}`),a){case"zoomPanner":e.length<3&&JS9.error(`missing arg(s) for cmd: ${a}`);try{JS9.Panner.zoom.call(s,o,l)}catch(c){JS9.error("error calling zoomPanner()",c)}break;case"panImage":try{o.setPan()}catch(c){JS9.error("error calling setPan()",c)}}},JS9.Panner.HTML="<span><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"zoomPanner\", \"x2\"); return false'>x2</button><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"zoomPanner\", \"/2\"); return false'>/2</button><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"zoomPanner\", \"1\"); return false'>z1</button><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"panImage\"); return false'>center</button></span>",JS9.Panner.init=function(e,t){this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Panner.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Panner.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.canvas=document.createElement("canvas"),this.canvasjq=$(this.canvas),this.canvasjq.addClass("JS9Panner"),this.canvasjq.css("z-index",JS9.ZINDEX),this.canvasjq.attr("width",this.width),this.canvasjq.attr("height",this.height),this.context=this.canvas.getContext("2d"),JS9.ANTIALIAS||(this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.msImageSmoothingEnabled=!1),this.containerjq=$("<div>").addClass("JS9Container").append(this.canvasjq).appendTo(this.divjq),this.display.image&&JS9.Panner.disp.call(this,this.display.image)},JS9.Panner.create=function(e){let t,s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y;if(!e||!e.raw||!e.useOffScreenCanvas()&&!e.colorData||!e.display.pluginInstances.JS9Panner)return null;if(e.panner||(e.panner={}),e.panner.zoom||(e.panner.zoom=1),t=e.display.pluginInstances.JS9Panner,s=e.panner,o=e.rgb.sect,m=Math.min(e.raw.width,t.width),b=Math.min(e.raw.height,t.height),s.xblock=e.raw.width/m,s.yblock=e.raw.height/b,s.xblock>s.yblock?(b=Math.floor(b/s.xblock*s.yblock+.5),s.yblock=s.xblock):s.yblock>s.xblock&&(m=Math.floor(m/s.yblock*s.xblock+.5),s.xblock=s.yblock),n=e.display.context.createImageData(m,b),1===s.zoom?(c=s.xblock,d=s.yblock,a=0,l=0):(c=s.xblock/s.zoom,d=s.yblock/s.zoom,a=Math.max(0,(o.x0+o.x1-m*c)/2),l=Math.max(0,(o.y0+o.y1-b*d)/2)),s.x0=a,s.y0=l,s.img=n,s.ix=0,s.iy=0,e.useOffScreenCanvas())for(p=0;p<b;p++)for(v=Math.floor(l+p*d)*e.offscreen.img.width,r=p*m,h=0;h<m;h++)g=Math.floor(a+h*c),u=4*(g+v),f=4*(r+h),n.data[f]=e.offscreen.img.data[u],n.data[f+1]=e.offscreen.img.data[u+1],n.data[f+2]=e.offscreen.img.data[u+2],n.data[f+3]=255;else for(p=0;p<b;p++)for(v=Math.floor(l+(b-p-1)*d)*e.raw.width,r=p*m,h=0;h<m;h++)g=Math.floor(a+h*c),u=e.colorData[g+v],f=4*(r+h),e.psColors[u]&&(n.data[f]=e.psColors[u][0],n.data[f+1]=e.psColors[u][1],n.data[f+2]=e.psColors[u][2],n.data[f+3]=255);return this.display.layers.panner?(this.display.image&&this.isDynamic&&(e.display.layers.panner||(e.display.layers.panner=this.display.layers.panner),this.display.image.layers.panner&&!e.layers.panner&&(e.layers.panner=this.display.image.layers.panner)),e):(y=this.display.newShapeLayer("panner",JS9.Panner.opts,this.divjq),y.canvas.on("object:modified",S=>{let _,C,I;if(C=JS9.getDynamicDisplayOr(this.display),_=C&&C.image?C.image:this.display.image,_){I=_.display.pluginInstances.JS9Panner,w=S.target.getCenterPoint(),"x"===_.params.flip?w.x=I.width-w.x:"y"===_.params.flip?w.y=I.height-w.y:"xy"===_.params.flip&&(w.x=I.width-w.x,w.y=I.height-w.y),_.params.rot90&&(w=JS9.rotatePoint(w,_.params.rot90,{x:I.width/2,y:I.height/2})),_.params.rotate&&(w=JS9.rotatePoint(w,_.params.rotate,{x:I.width/2,y:I.height/2})),A=(w.x-_.panner.ix)*_.panner.xblock/_.panner.zoom+_.panner.x0,x=(y.canvas.height-(w.y+_.panner.iy))*_.panner.yblock/_.panner.zoom+_.panner.y0;try{I.status="inactive",_.setPan(A,x)}catch(L){JS9.log("couldn't pan image",L)}finally{I.status="active"}}}),e)},JS9.Panner.disp=function(e){let t,s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x,y,S,_,C,I,L,D,O,M;if(e&&e.display.pluginInstances.JS9Panner&&"active"===e.display.pluginInstances.JS9Panner.status&&JS9.Panner.create.call(this,e)&&(I=e.raw.wcsinfo||{cdelt1:1,cdelt2:1,crot:0},s=e.panner,t=e.display.pluginInstances.JS9Panner,o=e.rgb.sect,g=t.width/2,v=t.height/2,M=t.context,s.img)){if(s.img.width<t.width&&(s.ix=Math.floor((t.width-s.img.width)/2)),s.img.height<t.height&&(s.iy=Math.floor((t.height-s.img.height)/2)),JS9.Panner.clear.call(this,e),M.save(),e.params.transform&&(O=e.params.transform,L=t.width/2,D=t.height/2,M.translate(L,D),M.transform(O[0][0],O[0][1],O[1][0],O[1][1],O[2][0],O[2][1]),M.translate(-L,-D)),M.drawImage(((R,H)=>{let N,B,P=R.display.pluginInstances.JS9Panner;return P.offscreenRGB||(B=document.createElement("canvas"),N=B.getContext("2d"),JS9.ANTIALIAS||(N.imageSmoothingEnabled=!1),P.offscreenRGB={canvas:B,context:N}),P.offscreenRGB.canvas.width=H.width,P.offscreenRGB.canvas.height=H.height,P.offscreenRGB.context.putImageData(H,0,0),P.offscreenRGB.canvas})(e,s.img),s.ix,s.iy),M.restore(),n=s.zoom/s.xblock,a=s.zoom/s.yblock,h=e.display.width*n/o.zoom,p=e.display.height*a/o.zoom,c=(o.x0-s.x0)*n+s.ix,d=t.height-((o.y1-s.y0)*a+s.iy),e.display.width!==o.width&&(c-=(e.display.width-o.width)*n/o.zoom/2),e.display.height!==o.height&&(d-=(e.display.height-o.height)*a/o.zoom/2),c+=h/2,d+=p/2,"x"===e.params.flip?c=t.width-c:"y"===e.params.flip?d=t.height-d:"xy"===e.params.flip&&(c=t.width-c,d=t.height-d),e.params.rot90&&(r=JS9.rotatePoint({x:c,y:d},-e.params.rot90,{x:t.width/2,y:t.height/2}),c=r.x,d=r.y),e.params.rotate&&(r=JS9.rotatePoint({x:c,y:d},-e.params.rotate,{x:t.width/2,y:t.height/2}),c=r.x,d=r.y),h>=t.width&&(c=t.width/2,h=t.width+10),p>=t.height&&(d=t.height/2,p=t.height+10),l={left:c,top:d,width:h,height:p},e.panner.boxid?e.changeShapes("panner",e.panner.boxid,l):e.panner.boxid=e.addShapes("panner","box",l),e.panner.northid&&(e.removeShapes("panner",e.panner.northid),e.removeShapes("panner",e.panner.northidt)),e.panner.eastid&&(e.removeShapes("panner",e.panner.eastid),e.removeShapes("panner",e.panner.eastidt)),!JS9.globalOpts.pannerDirections||!e.raw.wcs||e.raw.wcs<=0)return e;switch(m=e.getNorthIsUp(),S=m.angle,JS9.notNull(e.params.rot90)&&(S-=e.params.rot90),JS9.notNull(e.params.rotate)&&(S-=e.params.rotate),_=m.xflip?-1:1,C=m.yflip?-1:1,e.params.flip){case"x":_*=-1;break;case"y":C*=-1;break;case"xy":_*=-1,C*=-1}return u={x:g,y:v},f=I.cdelt2>=0?{x:g,y:v-JS9.Panner.VSIZE*C}:{x:g,y:v+JS9.Panner.VSIZE*C},f=JS9.rotatePoint(f,S,u),m={color:JS9.Panner.NORTH.color,strokeWidth:JS9.Panner.NORTH.strokeWidth,strokeDashArray:JS9.Panner.NORTH.strokeDashArray,points:[u,f],changeable:!1,originX:"left",originY:"top",noLeftTop:!0},e.panner.northid=e.addShapes("panner","line",m),b={color:JS9.Panner.NORTH.color,text:JS9.Panner.NORTH.text,fontSize:JS9.Panner.NORTH.fontSize,fontFamily:JS9.Panner.NORTH.fontFamily,changeable:!1,left:f.x,top:f.y},e.panner.northidt=e.addShapes("panner","text",b),w={x:g,y:v},A=I.cdelt1<0?{x:g-JS9.Panner.VSIZE*_,y:v}:{x:g+JS9.Panner.VSIZE*_,y:v},A=JS9.rotatePoint(A,S,w),x={color:JS9.Panner.EAST.color,strokeWidth:JS9.Panner.EAST.strokeWidth,strokeDashArray:JS9.Panner.EAST.strokeDashArray,changeable:!1,points:[w,A],originX:"left",originY:"top",noLeftTop:!0},e.panner.eastid=e.addShapes("panner","line",x),y={color:JS9.Panner.EAST.color,text:JS9.Panner.EAST.text,fontSize:JS9.Panner.EAST.fontSize,fontFamily:JS9.Panner.EAST.fontFamily,changeable:!1,left:A.x,top:A.y},e.panner.eastidt=e.addShapes("panner","text",y),e}},JS9.Panner.zoom=function(e,t){let s,o,n;if(e&&e.panner&&e.display.pluginInstances.JS9Panner){switch(s=e.panner,o=s.zoom,t.charAt(0)){case"*":case"x":case"X":n=Math.min(Math.min(this.width,this.height),o*parseFloat(t.slice(1)));break;case"/":n=Math.max(1,o/parseFloat(t.slice(1)));break;default:n=parseFloat(t)}return(!n||n<1)&&(n=1),s.zoom=n,JS9.Panner.disp.call(this,e),e}},JS9.Panner.dysel=function(e){let t;e&&(t=e.display.pluginInstances.JS9Panner,t&&t.isDynamic&&JS9.Panner.disp.call(this,e))},JS9.Panner.clear=function(e){let t,s;if(e)return s=JS9.getDynamicDisplayOr(this.display),t=e.display.pluginInstances.JS9Panner,t&&e.display===s&&(t.context.clear(),e.removeShapes("panner","all"),e.panner.boxid=null),e},JS9.RegisterPlugin(JS9.Panner.CLASS,JS9.Panner.NAME,JS9.Panner.init,{menuItem:"Panner",help:"help/panner.html",dynamicSelect:!0,toolbarSeparate:!1,toolbarHTML:JS9.Panner.HTML,ondynamicselect:JS9.Panner.dysel,onplugindisplay:JS9.Panner.disp,onimagedisplay:JS9.Panner.disp,onimageclose:JS9.Panner.clear,onimageclear:JS9.Panner.clear,onupdateprefs:JS9.Panner.disp,onsetwcssys:JS9.Panner.disp,winTitle:"Panner",winDims:[JS9.Panner.WIDTH,JS9.Panner.HEIGHT],divArgs:[JS9.Panner.SWIDTH,JS9.Panner.SHEIGHT]}),JS9.PanZoom={},JS9.PanZoom.CLASS="JS9",JS9.PanZoom.NAME="PanZoom",JS9.PanZoom.WIDTH=530,JS9.PanZoom.HEIGHT=110,JS9.PanZoom.BASE=JS9.PanZoom.CLASS+JS9.PanZoom.NAME,JS9.PanZoom.panzoomHTML="<p><div class='JS9PanZoomLinegroup'>$pan&nbsp;&nbsp;$zoom&nbsp;&nbsp;$flip&nbsp;&nbsp;$rot90&nbsp;&nbsp;$rotate</div><p><div class='JS9PanZoomLinegroup'>$panto $pos1 $pos2 $wcssys $wcsunits</div>",JS9.PanZoom.panHTML='<select class="JS9Select JS9PanZoomSelect JS9PanZoomCol1" name="pan" onchange="JS9.PanZoom.xsetpan(\'%s\', \'%s\', this)">%s</select>',JS9.PanZoom.zoomHTML='<select class="JS9Select JS9PanZoomSelect JS9PanZoomCol2" name="zoom" onchange="JS9.PanZoom.xsetzoom(\'%s\', \'%s\', this)">%s</select>',JS9.PanZoom.flipHTML='<select class="JS9Select JS9PanZoomSelect JS9PanZoomCol3" name="flip" onchange="JS9.PanZoom.xsetflip(\'%s\', \'%s\', this)">%s</select>',JS9.PanZoom.rot90HTML='<select class="JS9Select JS9PanZoomSelect JS9PanZoomCol4" name="rot90" onchange="JS9.PanZoom.xsetrot90(\'%s\', \'%s\', this)">%s</select>',JS9.PanZoom.rotateHTML='<input type="text" class="JS9PanZoomInput JS9PanZoomCol5 js9Input" name="rotate" autocapitalize="off" autocorrect="off" onkeydown="JS9.PanZoom.xsetrot(\'%s\', \'%s\', this, event)" value="%s" placeholder="angle or reset">',JS9.PanZoom.pantoHTML='<input type="button" class="JS9Button2 JS9PanZoomButton JS9PanZoomCol1" name="panto" value="Pan to &rarr;" onclick="javascript:JS9.PanZoom.xpanto(\'%s\', \'%s\', this)">',JS9.PanZoom.pos1HTML='<input type="text" class="JS9PanZoomInput JS9PanZoomCol2 js9Input" name="pos1" value="%s" autocapitalize="off" autocorrect="off" placeholder="x position">',JS9.PanZoom.pos2HTML='<input type="text" class="JS9PanZoomInput JS9PanZoomCol3 js9Input" name="pos2" value="%s" autocapitalize="off" autocorrect="off" placeholder="y position">',JS9.PanZoom.sysHTML='<select class="JS9Select JS9PanZoomSelect JS9PanZoomCol4" name="wcssys" onchange="JS9.PanZoom.xsetwcssys(\'%s\', \'%s\', this)">%s</select>',JS9.PanZoom.unitsHTML='<select class="JS9Select JS9PanZoomSelect JS9PanZoomCol5" name="wcsunits" onchange="JS9.PanZoom.xsetwcsunits(\'%s\', \'%s\', this)">%s</select>',JS9.PanZoom.xsetpan=function(e,t,s){const o=JS9.lookupImage(t,e);o&&"center"===s.value&&o.setPan()},JS9.PanZoom.xsetzoom=function(e,t,s){let o,n,a,l;const c=JS9.lookupImage(t,e);if(c)switch(s.value){case"in":case"out":case"to fit":l=c.parseZoom(s.value),JS9.isNumber(l)&&c.setZoom(l);break;default:o=s.value.split(/\s+/),2===o.length&&(n=o[1].split("/"),a=1===n.length?parseFloat(n[0]):1/parseFloat(n[1]),c.setZoom(a))}},JS9.PanZoom.xsetflip=function(e,t,s){const o=JS9.lookupImage(t,e);if(o)switch(s.value){case"x axis":o.setFlip("x");break;case"y axis":o.setFlip("y");break;case"reset":o.setFlip("reset")}},JS9.PanZoom.xsetrot90=function(e,t,s){const o=JS9.lookupImage(t,e);if(o)switch(s.value){case"90 left":o.setRot90(90);break;case"90 right":o.setRot90(-90);break;case"reset rotate":o.setRot90("reset"),o.setRotate("reset");break;case"align: north is up":o.setRot90("reset"),o.setRotate("northisup");break;case"reset flip/rot90/rotate":o.setFlip("reset"),o.setRot90("reset"),o.setRotate("reset")}return!1},JS9.PanZoom.xsetrot=function(e,t,s,o){let n,a;const l=JS9.lookupImage(t,e);if(l){if(13!==o.keyCode)return;if(n=$(s).val().trim(),n){if("reset"===n)return l.setRotate("reset"),void l.setRot90("reset");a=l.display.pluginInstances.JS9PanZoom,a&&(a.rot=n),l.setRotate(n),a&&a.divjq.find('input[name="rotate"]').focus().caretToEnd()}}},JS9.PanZoom.xpanto=function(e,t,s){let o,n,a,l,c,d,h,p,g;const v=JS9.lookupImage(t,e);if(v&&(p=$(s).parent(),h=p.find("[name='wcssys']").val(),c=p.find("[name='pos1']").val(),d=p.find("[name='pos2']").val(),c&&d&&h)){switch(o=v.getWCSSys(),v.setWCSSys(h),a=JS9.saostrtod(c),JS9.isHMS(h)&&(a*=15),l=JS9.saostrtod(d),h){case"image":break;case"physical":g=v.logicalToImagePos({x:a,y:l}),a=g.x,l=g.y;break;default:v.validWCS()&&(n=JS9.wcs2pix(v.raw.wcs,a,l).trim().split(/\s+/),a=parseFloat(n[0]),l=parseFloat(n[1]))}v.setPan(a,l),v.setWCSSys(o)}},JS9.PanZoom.xsetwcssys=function(e,t,s){let o,n,a,l,c;const d=s.value,h=JS9.lookupImage(t,e);h&&(o=h.getWCSSys(),n=h.getWCSUnits(),h.setWCSSys(d),h.tmp.wcssysPanZoom=d,l=JS9.PanZoom.getPos(h,"x"),c=JS9.PanZoom.getPos(h,"y"),a=$(s).parent(),a.find("[name='pos1']").val(l),a.find("[name='pos2']").val(c),h.getWCSUnits()!==(h.tmp.wcsunitsPanZoom||n)&&JS9.PanZoom.xsetwcsunits(e,t,{value:h.getWCSUnits()}),h.setWCSSys(o),h.setWCSUnits(n))},JS9.PanZoom.xsetwcsunits=function(e,t,s){let o,n,a,l,c;const d=s.value,h=JS9.lookupImage(t,e);h&&(n=h.getWCSUnits(),o=h.getWCSSys(),h.setWCSUnits(d),h.tmp.wcsunitsPanZoom=d,l=JS9.PanZoom.getPos(h,"x"),c=JS9.PanZoom.getPos(h,"y"),a=$(s).parent(),a.find("[name='pos1']").val(l),a.find("[name='pos2']").val(c),h.getWCSSys()!==(h.tmp.wcssysPanZoom||o)&&JS9.PanZoom.xsetwcssys(e,t,{value:h.getWCSSys()}),h.setWCSSys(o),h.setWCSUnits(n))},JS9.PanZoom.getPos=function(e,t){let s,o,n,a,l,c,d,h;if(e){switch(a=e.getPan(),l=e.getWCSSys(),c=e.getWCSUnits(),d=e.tmp.wcssysPanZoom||l,h=e.tmp.wcsunitsPanZoom||c,l!==d&&e.setWCSSys(d),c!==h&&e.setWCSUnits(h),d){case"image":o=String(a[t]);break;case"physical":n=e.imageToLogicalPos(a),o=String(n[t]);break;default:e.validWCS()?(s=JS9.pix2wcs(e.raw.wcs,a.x,a.y).trim().split(/\s+/),o="x"===t?s[0]:s[1]):o=String(a[t])}l!==d&&e.setWCSSys(l),c!==h&&e.setWCSUnits(c)}return o},JS9.PanZoom.reinit=function(){this.inProcess||(this.inProcess=!0,JS9.PanZoom.init.call(this),this.inProcess=!1)},JS9.PanZoom.display=function(){this.lastimage!==this.display.image&&(this.inProcess=!0,JS9.PanZoom.init.call(this),this.inProcess=!1)},JS9.PanZoom.close=function(){JS9.PanZoom.init.call(this,{mode:"clear"})},JS9.PanZoom.init=function(e){let t,s,o,n,a,l;const u=(f,m)=>JS9.PanZoom.getPos(f,m);e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.PanZoom.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.PanZoom.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.divjq.html(""),this.lastTextWidth=0,this.panzoomContainer=$("<div>").addClass(`${JS9.PanZoom.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),o=this.display.image,o&&"clear"!==e.mode?(a=o.id,l=o.display.id,n=[],s=sprintf(JS9.PanZoom.panHTML,l,a,(()=>{let f="<option selected disabled>Pan</option>";return f+="<option>center</option>","<option selected disabled>Pan</option><option>center</option>"})()),n.push({name:"pan",value:s}),s=sprintf(JS9.PanZoom.zoomHTML,l,a,(()=>{let f,m,b,w="<option selected disabled>Zoom</option>";for(w+="<option>in</option>",w+="<option>out</option>",w+="<option>to fit</option>",w+="<option disabled>\u2500\u2500\u2500\u2500\u2500</option>",f=JS9.imageOpts.zooms;f>0;f--)m=Math.pow(2,f),b=`zoom 1/${m}`,w+=`<option>${b}</option>`;for(f=0;f<=JS9.imageOpts.zooms;f++)m=Math.pow(2,f),b=`zoom ${m}`,w+=`<option>${b}</option>`;return w})()),n.push({name:"zoom",value:s}),s=sprintf(JS9.PanZoom.flipHTML,l,a,(()=>{let f="<option selected disabled>Flip</option>";return f+="<option>x axis</option>",f+="<option>y axis</option>",f+="<option>reset</option>","<option selected disabled>Flip</option><option>x axis</option><option>y axis</option><option>reset</option>"})()),n.push({name:"flip",value:s}),s=sprintf(JS9.PanZoom.rot90HTML,l,a,(()=>{let f="<option selected disabled>Rotate</option>";return f+="<option>90 left</option>",f+="<option>90 right</option>",f+="<option>reset rotate</option>",f+="<option disabled>\u2500\u2500\u2500\u2500\u2500</option>",f+="<option>align: north is up</option>",f+="<option>reset flip/rot90/rotate</option>","<option selected disabled>Rotate</option><option>90 left</option><option>90 right</option><option>reset rotate</option><option disabled>\u2500\u2500\u2500\u2500\u2500</option><option>align: north is up</option><option>reset flip/rot90/rotate</option>"})()),n.push({name:"rot90",value:s}),s=sprintf(JS9.PanZoom.rotateHTML,l,a,(f=>{let m=0;return f&&(m=JS9.globalOpts.rotateRelative&&this.rot&&"reset"!==this.rot?this.rot:f.getRotate()||"0"),m})(o)),n.push({name:"rotate",value:s}),s=sprintf(JS9.PanZoom.pantoHTML,l,a),n.push({name:"panto",value:s}),s=sprintf(JS9.PanZoom.pos1HTML,u(o,"x")),n.push({name:"pos1",value:s}),s=sprintf(JS9.PanZoom.pos2HTML,u(o,"y")),n.push({name:"pos2",value:s}),s=sprintf(JS9.PanZoom.sysHTML,l,a,(f=>{let m,b,w,A="<option selected disabled>WCS Systems</option>";if(f)for(w=f.tmp.wcssysPanZoom||f.getWCSSys(),b=f.validWCS()?JS9.wcssyss:["image","physical"],m=0;m<b.length;m++)A+=w===b[m]?`<option selected>${b[m]}</option>`:`<option>${b[m]}</option>`;return A})(o)),n.push({name:"wcssys",value:s}),s=sprintf(JS9.PanZoom.unitsHTML,l,a,(f=>{let m,b,w,A="<option selected disabled>WCS Units</option>";if(f)for(w=f.tmp.wcsunitsPanZoom||f.getWCSUnits(),b=f.validWCS()?["degrees","sexagesimal","pixels"]:["pixels"],m=0;m<b.length;m++)A+=w===b[m]?`<option selected>${b[m]}</option>`:`<option>${b[m]}</option>`;return A})(o)),n.push({name:"wcsunits",value:s}),t=o.expandMacro(JS9.PanZoom.panzoomHTML,n),this.lastimage=o):t="<p><center>Pan/Zoom parameters will appear here.</center>",this.panzoomContainer.html(t),o&&JS9.globalOpts.runOnCR&&(this.panzoomContainer.find("[name='pos1']").data("enterfunc","panto"),this.panzoomContainer.find("[name='pos2']").data("enterfunc","panto"))},JS9.RegisterPlugin(JS9.PanZoom.CLASS,JS9.PanZoom.NAME,JS9.PanZoom.init,{menu:"zoom",menuItem:"Pan/Zoom Controls ...",onplugindisplay:JS9.PanZoom.init,onsetpan:JS9.PanZoom.reinit,onsetzoom:JS9.PanZoom.reinit,onsetwcssys:JS9.PanZoom.reinit,onsetwcsunits:JS9.PanZoom.reinit,onimagedisplay:JS9.PanZoom.display,onimageclose:JS9.PanZoom.close,help:"help/zoomcontrols.html",winTitle:"Pan/Zoom Controls",winDims:[JS9.PanZoom.WIDTH,JS9.PanZoom.HEIGHT]}),JS9.Prefs={},JS9.Prefs.CLASS="JS9",JS9.Prefs.NAME="Preferences",JS9.Prefs.WIDTH=800,JS9.Prefs.HEIGHT=400,JS9.Prefs.imagesSchema={title:"Image Preferences",description:"Preferences for each displayed image",properties:{colormap:{type:"string",helper:"default color map"},contrast:{type:"number",helper:"default color contrast"},bias:{type:"number",helper:"default color bias"},scale:{type:"string",helper:"default scale algorithm"},scaleclipping:{type:"string",helper:"'dataminmax' or 'zscale'"},zscalecontrast:{type:"number",helper:"default from ds9"},zscalesamples:{type:"number",helper:"default from ds9"},zscaleline:{type:"number",helper:"default from ds9"},exp:{type:"number",helper:"default exp value for scaling"},wcssys:{type:"string",helper:"current WCS system"},wcsunits:{type:"string",helper:"current WCS units"},lcs:{type:"string",helper:"default logical coordinate system"},opacity:{type:"number",helper:"opacity for images (0.0 to 1.0)"},zoom:{type:"number",helper:"default zoom factor"},zooms:{type:"number",helper:"how many zooms in each direction?"},nancolor:{type:"string",helper:"6-digit #hex color for NaN values"},overlay:{type:"boolean",helper:"display png/jpeg overlay?"},listonchange:{type:"boolean",helper:"list after a region change?"},whichonchange:{type:"string",helper:"list 'all' or 'selected'?"},valpos:{type:"boolean",helper:"display value/position?"},inherit:{type:"boolean",helper:"new images inherit current params?"},invert:{type:"boolean",helper:"by default, invert colormap?"},disable:{type:"mobject",helper:"array of core funcs to disable"}}},JS9.Prefs.regionsSchema={title:"Region Preferences",description:"Preferences for each displayed region",type:"object",properties:{iradius:{type:"number",helper:"annulus: initial inner radius"},oradius:{type:"number",helper:"annulus: initial outer radius"},nannuli:{type:"number",helper:"annulus: initial number of annuli"},width:{type:"number",helper:"box: initial width"},height:{type:"number",helper:"box: initial height"},radius:{type:"number",helper:"circle: initial radius"},r1:{type:"number",helper:"ellipse: initial radius1"},r2:{type:"number",helper:"ellipse: initial radius2"},angle:{type:"number",helper:"box, ellipse: initial angle in degrees"},polypoints:{type:"mobject",helper:"polygon: x,y relative positions"},linepoints:{type:"mobject",helper:"line: x,y relative positions"},ptshape:{type:"string",helper:"point shape: box, circle, ellipse"},ptsize:{type:"number",helper:"point: size"},tags:{type:"string",helper:"initial tags for a region"},strokeWidth:{type:"number",helper:"region stroke width"},fontFamily:{type:"string",helper:"region font"},fontSize:{type:"string",helper:"region font size"},fontStyle:{type:"string",helper:"region font style"},fontWeight:{type:"string",helper:"region font weight"},textAlign:{type:"string",helper:"text alignment"}}},JS9.Prefs.gridSchema={title:"Grid Preferences",description:"Preferences for wcs coordinate grids",type:"object",properties:{strokeWidth:{type:"number",helper:"grid stroke width"},lineColor:{type:"string",helper:"color of grid lines"},raLines:{type:"number",helper:"approx. number of RA grid lines"},raAngle:{type:"number",helper:"rotation for RA label"},raSkip:{type:"number",helper:"number of RA lines to skip"},decLines:{type:"number",helper:"approx. number of Dec grid lines"},decAngle:{type:"number",helper:"rotation for Dec label"},decSkip:{type:"number",helper:"number of Dec lines to skip"},labelColor:{type:"string",helper:"color of text labels"},labelFontFamily:{type:"string",helper:"label font"},labelFontSize:{type:"string",helper:"label font size"},labelFontStyle:{type:"string",helper:"label font style"},labelFontWeight:{type:"string",helper:"label font weight"},labelRAOffx:{type:"number",helper:"x offset of RA labels"},labelRAOffy:{type:"number",helper:"y offset of RA labels"},labelDecOffx:{type:"number",helper:"x offset of Dec labels"},labelDecOffy:{type:"number",helper:"y offset of Dec labels"},degPrec:{type:"number",helper:"precision for degree labels"},sexaPrec:{type:"number",helper:"precision for sexagesimal labels"},reduceDims:{type:"boolean",helper:"reduce lines of smaller image dim?"},stride:{type:"number",helper:"fineness of grid lines"},margin:{type:"number",helper:"edge margin for displaying a grid line"},labelMargin:{type:"number",helper:"edge margin for displaying a label"},cover:{type:"string",helper:"grid lines cover: display or image"}}},JS9.Prefs.fitsSchema={title:"FITS Preferences",description:"Preferences for processing FITS files",properties:{extlist:{type:"string",helper:"default binary table extensions"},xdim:{type:"string",helper:"x dim of image section from table"},ydim:{type:"string",helper:"y dim of image section from table"},bin:{type:"string",helper:"bin factor for tables"},ixdim:{type:"string",helper:"x dim of image section from image"},iydim:{type:"string",helper:"y dim of image section from table"},ibin:{type:"string",helper:"bin factor for images"},binMode:{type:"string",helper:"'s' for summing, 'a' for averaging"},clear:{type:"string",helper:"clear image's virtual file memory"}}},JS9.Prefs.catalogsSchema={title:"Catalogs Preferences",description:"Preferences for loading tab-delimited catalogs",properties:{ras:{type:"mobject",helper:"RA patterns to look for in table"},decs:{type:"mobject",helper:"Dec patterns to look for in table"},wcssys:{type:"string",helper:"wcs system of catalog"},shape:{type:"string",helper:"shape of objects"},color:{type:"string",helper:"color of objects"},width:{type:"number",helper:"width of box objects"},height:{type:"number",helper:"height of box objects"},radius:{type:"number",helper:"radius of circle objects"},r1:{type:"number",helper:"r1 of ellipse objects"},r2:{type:"number",helper:"r2 of ellipse objects"},tooltip:{type:"string",helper:"tooltip format for objects"},skip:{type:"string",helper:"comment character in table"}}},JS9.Prefs.globalsSchema={title:"Global Preferences",description:"Global preferences for all JS9 displays",properties:{topColormaps:{type:"mobject",helper:"array of top-level colormaps"},infoBox:{type:"mobject",helper:"array of infoBox items to display"},statusBar:{type:"string",helper:"format of statusbar display"},toolBar:{type:"mobject",helper:"array of toolbar tools to display"},separate:{type:"mobject",helper:"options when separating images"},mouseActions:{type:"mobject",helper:"array of mouse actions"},touchActions:{type:"mobject",helper:"array of touch actions"},keyboardActions:{type:"mobject",helper:"object containing keyboard actions"},centerDivs:{type:"mobject",helper:"divs used when centering"},resizeDivs:{type:"mobject",helper:"divs used when resizing"},plot3d:{type:"mobject",helper:"options for 3D data cube plot"},syncOps:{type:"mobject",helper:"ops to sync between images"},wcsUnits:{type:"mobject",helper:"default units for WCS systems"},copyWcsPosFormat:{type:"string",helper:"format string using: $ra $dec $sys"},fallbackDisplay:{type:"string",helper:"can messages fallback to display win?"},lightWinClose:{type:"string",helper:"ask,close,move when closing lightwin"},fits2fits:{type:"string",helper:"make rep file?: true,false,size>N"},dynamicSelect:{type:"string",helper:"select display: click, move, false"},panRefreshLimit:{type:"number",helper:"# of shapes to minimze refresh during pan"},regDisplay:{type:"string",helper:"show regions in 'lightwin' or 'display'"},regMenuCreate:{type:"boolean",helper:"region menu selections create regions?"},regSyncTextColor:{type:"boolean",helper:"sync region text color with main color?"},regToClipboard:{type:"boolean",helper:"region mods to pseudo-clipboard?"},regListDCoords:{type:"boolean",helper:"list regions preserving dcoords? "},metaClickPan:{type:"boolean",helper:"meta-click pans to mouse position?"},mousetouchZoom:{type:"boolean",helper:"scroll/pinch to zoom?"},mousetouchLimit:{type:"boolean",helper:"limit zoom-out to the size of the image?"},clickToFocus:{type:"boolean",helper:"click display to focus?"},valposDCoords:{type:"boolean",helper:"valpos shows display coords?"},toolbarTooltips:{type:"boolean",helper:"show tooltips in Toolbar plugin?"},updateTitlebar:{type:"boolean",helper:"update titlebar with image id?"},logoDisplay:{type:"boolean",helper:"show JS9 logo?"},reloadRefresh:{type:"boolean",helper:"does a reload refresh the data?"},reloadRefreshReg:{type:"boolean",helper:"reloading regions file removes prev?"},syncReciprocate:{type:"boolean",helper:"reciprocal image sync'ing?"},syncWCS:{type:"boolean",helper:"sync using wcs (e.g. pan)?"},nextImageMask:{type:"boolean",helper:"nextImage() show image masks?"},panWithinDisplay:{type:"boolean",helper:"keep panned image within the display?"},pannerDirections:{type:"boolean",helper:"show direction vectors in panner?"},magnifierRegions:{type:"boolean",helper:"show regions in magnifier?"},xeqPlugins:{type:"boolean",helper:"execute plugin callbacks?"},extendedPlugins:{type:"boolean",helper:"execute extended plugins?"},intensivePlugins:{type:"boolean",helper:"execute intensive plugins?"},svgBorder:{type:"boolean",helper:"add border when exporting SVG?"}}},JS9.Prefs.favoritesSchema={title:"Favorites Preferences",description:"Favorites for all JS9 displays",properties:{scales:{type:"mobject",helper:"array of favorite scales"},colormaps:{type:"mobject",helper:"array of favorite colormaps"},regions:{type:"mobject",helper:"array of favorite regions"},wcs:{type:"mobject",helper:"array of favorite wcs systems"}}},JS9.Prefs.desktopSchema={title:"Desktop App Preferences",description:"Desktop app preferences will take effect on restart",properties:{webpage:{type:"string",helper:"web page to display"},width:{type:"number",helper:"width of desktop window"},height:{type:"number",helper:"height of desktop window"},hostfs:{type:"boolean",helper:"utilize host file system?"},debug:{type:"boolean",helper:"display Chrome debugger at startup?"}}},JS9.Prefs.sources=[{name:"globals",schema:JS9.Prefs.globalsSchema},{name:"images",schema:JS9.Prefs.imagesSchema},{name:"fits",schema:JS9.Prefs.fitsSchema},{name:"regions",schema:JS9.Prefs.regionsSchema},{name:"grid",schema:JS9.Prefs.gridSchema},{name:"catalogs",schema:JS9.Prefs.catalogsSchema},{name:"favorites",schema:JS9.Prefs.favoritesSchema},{name:"desktop",schema:JS9.Prefs.desktopSchema}],JS9.Prefs.init=function(){let e,t,s,o,n,a,l,c,d,h,p;for(a=JS9.Prefs.sources,d=`${this.id}prefsTabs`,h="<div style='padding: 8px'>",h+=`<div id='${d}' class='indentmenu'>\n`,h+="<ul>",e=0;e<a.length;e++)l=a[e],("desktop"!==l.name||JS9.cmdlineOpts)&&(c=this.id+JS9.Prefs.CLASS+JS9.Prefs.NAME+l.name,h+=`  <li><a href='#' rel='${c}Div'>${l.name}</a></li>\n`);for(h+="</ul>",h+="<br style='clear:left'></div></div><p>\n",e=0;e<a.length;e++)if(l=a[e],"desktop"!==l.name||JS9.cmdlineOpts){switch(c=this.id+JS9.Prefs.CLASS+JS9.Prefs.NAME+l.name,l.name){case"images":l.data=JS9.imageOpts;break;case"regions":l.data=JS9.Regions.opts;break;case"grid":l.data=JS9.Grid.opts;break;case"fits":l.data={extlist:JS9.fits.options.extlist,xdim:JS9.fits.options.table.xdim,ydim:JS9.fits.options.table.ydim,bin:JS9.fits.options.table.bin,ixdim:JS9.fits.options.image.xdim,iydim:JS9.fits.options.image.ydim,ibin:JS9.fits.options.image.bin,binMode:JS9.globalOpts.binMode,clear:JS9.globalOpts.clearImageMemory};break;case"catalogs":l.data=JS9.globalOpts.catalogs;break;case"globals":l.data=JS9.globalOpts;break;case"favorites":l.data=JS9.favorites;break;case"desktop":l.data=JS9.cmdlineOpts;break;default:JS9.error(`unknown source for preferences: ${l.name}`)}for(o of(h+=`<div id='${c}Div' class='tabcontent'>`,h+=`<form id='${c}Form' class='js9AnalysisForm' style='overflow: hidden'>`,h+=`<center><b>${l.schema.description}</b></center><p>`,n=l.schema.properties||{},Object.keys(n)))"boolean"===(s=n[o],p=s.prompt||`${o}:`,s.type)?(t=l.data[o]?"checked":"",h+=`<div class='linegroup'><span class='column_R1'><b>${p}</b></span><span class='column_R2'><input type='checkbox' name='${o}' value='true' ${t}></span><span class='column_R4L'>${s.helper}</span></div>`):(t="object"==typeof l.data[o]?"mobject"===s.type?JSON.stringify(l.data[o],null,2):JSON.stringify(l.data[o]):JS9.isNull(l.data[o])?"":l.data[o],h+="mobject"===s.type?`<div class='linegroup' style='height:64px'><span class='column_R1'><b>${p}</b></span><span class='column_R2l'><textarea name='${o}' class='text_R' rows='5' style='overflow-x: hidden; resize: none'>${t}</textarea></span><span class='column_R4L'>${s.helper}</span></div>`:`<div class='linegroup'><span class='column_R1'><b>${p}</b></span><span class='column_R2l'><input type='text' name='${o}' class='text_R' value='${t}'></span><span class='column_R4L'>${s.helper}</span></div>`);JS9.cmdlineOpts||(h+=`<input id='${this.id}_applyPrefs' name='Apply' type='button' class='button' value='Apply' onclick='JS9.Prefs.applyForm.call(this);' style='margin: 8px'>`),{}.hasOwnProperty.call(window,"localStorage")&&JS9.globalOpts.localStorage&&(h+=`<input id='${this.id}_savePrefs' name='Save' type='button' class='button' value='Save' onclick='JS9.Prefs.saveForm.call(this)' style='margin: 8px'>`,h+=`<input id='${this.id}_showPrefs' name='Show' type='button' class='button' value='Show Saved' onclick='JS9.Prefs.showForm.call(this)' style='margin: 8px'>`,h+="<input id='delete' name='Delete' type='button' class='button' value='Delete Saved' onclick='JS9.Prefs.deleteForm.call(this)' style='margin: 8px'>"),"light"===this.winType&&(h+=`<input id='${this.id}_closePrefs' name='Close' type='button' class='button' value='Close' onclick='const form = $(this).closest("form"); const winid = form.data("winid"); winid.close(); return false;' style='float: right; margin: 8px'>`),h+="</form>",h+="</div>"}for(this.divjq.addClass("JS9PluginScrolling"),this.divjq.html(h),e=0;e<a.length;e++)l=a[e],c=this.id+JS9.Prefs.CLASS+JS9.Prefs.NAME+l.name,$(`#${c}Form`).data("display",this.display),$(`#${c}Form`).data("source",l),"light"===this.winType&&$(`#${c}Form`).data("winid",this.winHandle);this.tabs=new ddtabcontent(d),this.tabs.setpersist(!1),this.tabs.setselectedClassTarget("link"),this.tabs.init()},JS9.Prefs.applyForm=function(){let e,t;const s=$(this).closest("form"),o=s.data("display"),n=s.data("source"),a=s.data("winid");return e=s.serializeArray(),t=e.concat($(`#${s.attr("id")} input[type=checkbox]:not(:checked)`).map((l,c)=>({name:c.name,value:"false"})).get()),JS9.Prefs.processForm(n,t,o,a),!1},JS9.Prefs.saveForm=function(){let e,t;const o=$(this).closest("form").data("source"),n={cmd:"desktop",mode:"save"},a={};if(JS9.Prefs.applyForm.call(this),"desktop"===o.name)return window.electron?window.setTimeout(()=>{try{n.cmdlineOpts=JS9.cmdlineOpts,window.electron.sendMsg(n)}catch(l){JS9.error("could not save desktop form",l)}},JS9.TIMEOUT):JS9.error("desktop save is only available for the JS9 desktop app"),!1;try{for(t of(e=o.schema.properties||{},Object.keys(e)))a[t]=o.data[t];localStorage.setItem(o.name,JSON.stringify(a,null,2)),JS9.userOpts[o.name]=localStorage.getItem(o.name)}catch{JS9.error(`could not save prefs: ${o.name}`)}return!1},JS9.Prefs.showForm=function(){let e,t;const o=$(this).closest("form").data("source");if("desktop"===o.name)JS9.cmdlineOpts?(e=JSON.stringify(JS9.cmdlineOpts,null,4),t=`<pre>${e}</pre>`):t=`<p><center>No saved prefs: ${o.name}</center>`;else{try{e=localStorage.getItem(o.name)}catch{}t=e&&"null"!==e?`<pre>${e}</pre>`:`<p><center>No saved prefs: ${o.name}</center>`}return JS9.lightWin(`savedPrefs${JS9.uniqueID()}`,"inline",t,`Saved prefs: ${o.name}`,JS9.lightOpts[JS9.LIGHTWIN].textWin),!1},JS9.Prefs.deleteForm=function(){const t=$(this).closest("form").data("source"),s={cmd:"desktop",mode:"remove"};if("desktop"===t.name)return window.electron?window.setTimeout(()=>{try{window.electron.sendMsg(s)}catch(o){JS9.error("could not save desktop form",o)}},JS9.TIMEOUT):JS9.error("desktop save is only available for the JS9 desktop app"),!1;try{localStorage.removeItem(t.name),delete JS9.userOpts[t.name]}catch{}return!1},JS9.Prefs.processForm=function(e,t,s,o){let n,a,l,c,d,h,p;const g=t.length;switch(e.name){case"images":h=JS9.imageOpts;break;case"regions":h=JS9.Regions.opts;break;case"grid":h=JS9.Grid.opts;break;case"fits":h=JS9.fits.options;break;case"catalogs":h=JS9.globalOpts.catalogs;break;case"globals":h=JS9.globalOpts;break;case"favorites":h=JS9.favorites;break;case"desktop":h=JS9.cmdlineOpts;break;default:JS9.error(`unknown source for preferences: ${e.name}`)}for(n=0;n<g;n++){switch(c=t[n].name,d=t[n].value,"true"===d&&(d=!0),"false"===d&&(d=!1),typeof h[c]){case"boolean":default:break;case"number":d=parseFloat(d);break;case"object":try{d=JSON.parse(d)}catch(v){JS9.error(`invalid JSON (see jsonlint.com): ${d}`,v)}}if(h[c]!==d&&String(h[c]).trim()!==String(d).trim())switch(e.name){case"images":h[c]=d,s&&s.image&&("disable"===c?s.image.params.disable=d:s.image.setParam(c,d));break;case"regions":for(h[c]=d,a=0;a<JS9.displays.length;a++)p=JS9.displays[a].layers.regions,p&&(p.opts[c]=d);break;case"fits":switch(c){case"xdim":h.table.xdim=Math.floor(parseFloat(d));break;case"ydim":h.table.ydim=Math.floor(parseFloat(d));break;case"bin":h.table.bin=Math.floor(parseFloat(d));break;case"ixdim":h.image.xdim=Math.floor(parseFloat(d));break;case"iydim":h.image.ydim=Math.floor(parseFloat(d));break;case"ibin":h.image.bin=Math.floor(parseFloat(d));break;case"binMode":JS9.globalOpts.binMode=d;break;case"clear":JS9.globalOpts.clearImageMemory=d;break;default:h[c]=d}e.data[c]=d;break;case"catalogs":h[c]="skip"===c?`${d}\n`:d;break;case"globals":switch(c){case"toolBar":h[c]=d,JS9.SetToolbar("init");break;case"toolbarTooltips":case"separate":default:h[c]=d;break;case"logoDisplay":for(h[c]=d,JS9.SetToolbar("init"),l=d?"block":"none",a=0;a<JS9.displays.length;a++)JS9.displays[a].iconjq.css("display",l)}break;default:h[c]=d}}if(JS9.globalOpts.extendedPlugins)for(a=0;a<JS9.displays.length;a++)JS9.displays[a].image&&JS9.displays[a].image.xeqPlugins("image","onupdateprefs")},JS9.RegisterPlugin(JS9.Prefs.CLASS,JS9.Prefs.NAME,JS9.Prefs.init,{menu:"file",menuItem:"Preferences",help:"help/prefs.html",winTitle:"User Preferences",winResize:!0,winDims:[JS9.Prefs.WIDTH,JS9.Prefs.HEIGHT]}),JS9.ScaleLimits={},JS9.ScaleLimits.CLASS="JS9",JS9.ScaleLimits.NAME="Scale",JS9.ScaleLimits.WIDTH=512,JS9.ScaleLimits.HEIGHT=400,JS9.ScaleLimits.WIDTHOFFSET=40,JS9.ScaleLimits.HEIGHTOFFSET=210,JS9.ScaleLimits.BASE=JS9.ScaleLimits.CLASS+JS9.ScaleLimits.NAME,JS9.ScaleLimits.XSCALE="linear",JS9.ScaleLimits.YSCALE="log",JS9.ScaleLimits.NDIST=512,JS9.ScaleLimits.TIMEOUT=250,JS9.ScaleLimits.CARET=4,JS9.ScaleLimits.XTEXTHEIGHT=14,JS9.ScaleLimits.XTEXTFONT="Ariel",JS9.ScaleLimits.XTEXTCOLOR="black",JS9.ScaleLimits.XTEXTFRAC=.75,JS9.ScaleLimits.YTEXTFRAC=.15,JS9.ScaleLimits.PLOTCOLOR="#030AE4",JS9.ScaleLimits.XLOCOLOR="#FF0000",JS9.ScaleLimits.XHICOLOR="#00FF00",JS9.ScaleLimits.AXISFONT={size:12,family:"Ariel",color:"black"},JS9.ScaleLimits.AXISFANCY=!0,JS9.ScaleLimits.dataOpts={bars:{show:!0,align:"center",barWidth:.1},clickable:!0,hoverable:!0,data:[]},JS9.ScaleLimits.plotOpts={selection:{mode:"x"},grid:{hoverable:!0}},JS9.ScaleLimits.scalelimsHTML="<div class='JS9ScaleLinegroup'>$header</div><div class='JS9ScaleLinegroup'>$scales&nbsp;&nbsp;$limits&nbsp;&nbsp;$axes</div><p><div class='JS9ScaleLinegroup'>$plot</div><p><div class='JS9ScaleLinegroup'><span class='JS9ScaleSpan' style='float: left'>&nbsp;&nbsp;$lo&nbsp;&nbsp;&nbsp;&nbsp;$hi</span></div>",JS9.ScaleLimits.headerHTML="Set clipping limits via the Data Limits menu, or by selecting part of the Pixel Distribution plot, or by changing the Low and/or High limit.",JS9.ScaleLimits.scalesHTML="<select class=\"JS9Select JS9ScaleSelect\" onchange=\"JS9.ScaleLimits.xsetscale('%s', '%s', this)\">%s</select>",JS9.ScaleLimits.limitsHTML='<select class="JS9Select JS9ScaleSelect" onchange="JS9.ScaleLimits.xsetlims(\'%s\', \'%s\', this)"><option selected disabled>Data Limits</option><option value="dataminmax">data min/max</option><option value="zscale_z1_z2">zscale z1/z2</option><option value="zscale_z1_datamax">zscale z1/max</option></select>',JS9.ScaleLimits.axesHTML='<select class="JS9Select JS9ScaleSelect" onchange="JS9.ScaleLimits.xaxes(\'%s\', \'%s\', this)"><option selected disabled>Plot Axes</option><option disabled>x axis:</option><option value="xlinear">linear</option><option value="xlog">log</option><option disabled>y axis:</option><option value="ylinear">linear</option><option value="ylog">log</option></select>',JS9.ScaleLimits.plotHTML='<div><center>Pixel Distribution: %s</center></div><div class="JS9ScalePlot" style="width:%spx;height:%spx"></div>',JS9.ScaleLimits.loHTML='Low:&nbsp;&nbsp;<input type="text" class="JS9ScaleValue" value=\'%s\' onchange="JS9.ScaleLimits.xsetlo(\'%s\', \'%s\', this)" size="16">',JS9.ScaleLimits.hiHTML='High:&nbsp;&nbsp;<input type="text" class="JS9ScaleValue" value=\'%s\' onchange="JS9.ScaleLimits.xsethi(\'%s\', \'%s\', this)" size="16">',JS9.ScaleLimits.xsetscale=function(e,t,s){const o=JS9.lookupImage(t,e);o&&o.setScale(s.value)},JS9.ScaleLimits.xsetlo=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=parseFloat(s.value),n.setScale(o,n.params.scalemax))},JS9.ScaleLimits.xsethi=function(e,t,s){let o;const n=JS9.lookupImage(t,e);n&&(o=parseFloat(s.value),n.setScale(n.params.scalemin,o))},JS9.ScaleLimits.xsetlims=function(e,t,s){const o=JS9.lookupImage(t,e);if(o)switch(s.value){case"dataminmax":o.setScale("dataminmax",o.raw.dmin,o.raw.dmax);break;case"zscale_z1_z2":o.setScale("zscale",o.params.z1,o.params.z2);break;case"zscale_z1_datamax":o.setScale("zmax",o.params.z1,o.raw.dmax)}},JS9.ScaleLimits.log10=function(e){return e<=0?null:Math.log(e)/Math.LN10},JS9.ScaleLimits.xaxes=function(e,t,s){let o;const n=JS9.lookupImage(t,e);if(n){if(o=n.display.pluginInstances[JS9.ScaleLimits.BASE],!o||!o.plot)return;switch(s.value){case"xlinear":o.xscale="linear",JS9.ScaleLimits.doplot.call(o,n);break;case"xlog":o.xscale="log",JS9.ScaleLimits.doplot.call(o,n);break;case"ylinear":o.yscale="linear",JS9.ScaleLimits.doplot.call(o,n);break;case"ylog":o.yscale="log",JS9.ScaleLimits.doplot.call(o,n)}}$(s).val("Plot Axes").prop("selected",!0)},JS9.ScaleLimits.getPixelDist=function(e,t){let s,o;const n=[],a=e.raw.dmin,l=e.raw.dmax-e.raw.dmin,c=e.raw.width*e.raw.height;for(s=0;s<t;s++)n[s]=0;for(s=0;s<c;s++)o=Math.floor((e.raw.data[s]-a)/l*t+.5),o>=0&&o<t&&(n[o]+=1);return n},JS9.ScaleLimits.to10E=function(e){return JS9.ScaleLimits.AXISFANCY&&e>=0&&e<=9?`10${["\u2070","\xb9","\xb2","\xb3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"][e]}`:`10E${String(e)}`},JS9.ScaleLimits.doplot=function(e){let t,s,o,n,a,l,c,d,h,p,g;const v=e.raw.dmin,r=e.raw.dmax-e.raw.dmin,u=$.extend(!0,{},JS9.ScaleLimits.dataOpts),f=$.extend(!0,{},JS9.ScaleLimits.plotOpts),b=(w,A,x)=>{const y=w.getCanvas().getContext("2d"),S=JS9.ScaleLimits.CARET,_=w.pointOffset({x:A,y:0});y.beginPath(),y.moveTo(_.left,_.top),y.lineTo(_.left-S,_.top-2*S),y.lineTo(_.left+S,_.top-2*S),y.lineTo(_.left,_.top),y.fillStyle=x,y.fill()};for(this.plotComplete=!1,this.plotColor&&(u.color=this.plotColor),c=JS9.ScaleLimits.getPixelDist(e,this.ndist),t=0;t<this.ndist;t++)u.data[t]=[t,c[t]];if(f.xaxis=f.xaxis||{},f.xaxis.font=JS9.ScaleLimits.AXISFONT,"linear"===this.xscale)for(f.xaxis.transform=null,f.xaxis.ticks=[],g=(w=>{let A;return A=w<10?1:w<50?5:w<250?10:w<500?50:w<2500?100:w<5e3?500:w<25e3?1e3:w<5e4?5e3:w<25e4?1e4:w<5e5?5e4:w<25e5?1e5:w<5e6?5e5:w<25e6?1e6:1e7,A})(r),p=Math.floor(r/g+.5)+1,t=0;t<p;t++)s=t*g,o=String(s),f.xaxis.ticks[t]=[(s-v)*this.ndist/r,o];else if("log"===this.xscale)for(f.xaxis.transform=JS9.ScaleLimits.log10,f.xaxis.min=1,f.xaxis.ticks=[],p=JS9.ScaleLimits.log10(this.ndist)+1,t=0;t<p;t++)s=Math.floor((Math.pow(10,t)-v)*this.ndist/r),f.xaxis.ticks[t]=[s,JS9.ScaleLimits.to10E(t)];if(a=(e.params.scalemin-v)/r*this.ndist,l=(e.params.scalemax-v)/r*this.ndist,f.yaxis=f.yaxis||{},f.yaxis.font=JS9.ScaleLimits.AXISFONT,"linear"===this.yscale)f.yaxis.transform=null,f.yaxis.ticks=null;else if("log"===this.yscale){for(f.yaxis.transform=JS9.ScaleLimits.log10,f.yaxis.min=1,f.yaxis.ticks=[],t=0;t<this.ndist;t++)(void 0===d||c[t]<d)&&(d=c[t]),(void 0===h||c[t]>h)&&(h=c[t]);for(p=JS9.ScaleLimits.log10(h-d+1),t=0;t<p;t++)f.yaxis.ticks[t]=[Math.pow(10,t),JS9.ScaleLimits.to10E(t)]}n=this.divjq.find(".JS9ScalePlot"),this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null),n.off("plotselected"),n.on("plotselected",(w,A)=>{let x=A.xaxis.from,y=A.xaxis.to;"log"===this.xscale&&(x=Math.pow(10,x),y=Math.pow(10,y)),x=x*r/this.ndist+v,y=y*r/this.ndist+v,e.setScale("user",x,y)}),n.off("plothover"),n.on("plothover",(w,A)=>{let x,y,S,_,C,I,L,D,O=A.x;!this.plot||!this.plotComplete||("log"===this.xscale&&(O=Math.pow(10,O)),D=O*r/this.ndist+v,Number.isFinite(D)&&(S=JS9.floatToString(D),x=this.plot.getCanvas().getContext("2d"),x.save(),x.textBaseline="top",x.font=`${JS9.ScaleLimits.XTEXTHEIGHT}px ${JS9.ScaleLimits.XTEXTFONT}`,x.fillStyle=JS9.ScaleLimits.XTEXTCOLOR||"black",y=x.measureText(S),I=Math.max(this.lastTextWidth,y.width+2),L=JS9.ScaleLimits.XTEXTHEIGHT+2,_=this.plotWidth*JS9.ScaleLimits.XTEXTFRAC,C=this.plotHeight*JS9.ScaleLimits.YTEXTFRAC,x.clearRect(_,C,I,L),x.fillText(S,_,C),x.restore(),this.lastTextWidth=I))}),this.timeout=window.setTimeout(()=>{this.plot=$.plot(n,[u],f),this.timeout=null,b(this.plot,a,this.xlocolor),b(this.plot,l,this.xhicolor),this.plotComplete=!0},JS9.ScaleLimits.TIMEOUT)},JS9.ScaleLimits.display=function(){this.lastimage!==this.display.image&&JS9.ScaleLimits.init.call(this)},JS9.ScaleLimits.close=function(){JS9.ScaleLimits.init.call(this,{mode:"clear"})},JS9.ScaleLimits.init=function(e){let t,s,o,n,a;e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.ScaleLimits.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.ScaleLimits.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.plotWidth=this.plotWidth||this.divjq.attr("data-plotWidth"),this.plotWidth||(this.plotWidth=this.width-JS9.ScaleLimits.WIDTHOFFSET),this.plotHeight=this.plotHeight||this.divjq.attr("data-plotHeight"),this.plotHeight||(this.plotHeight=this.height-JS9.ScaleLimits.HEIGHTOFFSET),this.xscale=this.xscale||this.divjq.attr("data-xscale"),this.xscale||(this.xscale=JS9.ScaleLimits.XSCALE),this.yscale=this.yscale||this.divjq.attr("data-yscale"),this.yscale||(this.yscale=JS9.ScaleLimits.YSCALE),this.plotColor=this.plotColor||this.divjq.attr("data-plotColor"),this.plotColor||(this.plotColor=JS9.ScaleLimits.PLOTCOLOR),this.xlocolor=this.xlocolor||this.divjq.attr("data-xlocolor"),this.xlocolor||(this.xlocolor=JS9.ScaleLimits.XLOCOLOR),this.xhicolor=this.xhicolor||this.divjq.attr("data-xhicolor"),this.xhicolor||(this.xhicolor=JS9.ScaleLimits.XHICOLOR),this.ndist=this.divjq.attr("data-ndist"),this.ndist||(this.ndist=JS9.ScaleLimits.NDIST),this.divjq.html(""),this.lastTextWidth=0,this.scalelimsContainer=$("<div>").addClass(`${JS9.ScaleLimits.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),s=this.display.image,s&&"clear"!==e.mode?(n=s.id,a=s.display.id,o=[],o.push({name:"header",value:JS9.ScaleLimits.headerHTML}),o.push({name:"scales",value:sprintf(JS9.ScaleLimits.scalesHTML,a,n,(()=>{let c,d="<option selected disabled>Scales</option>";for(c=0;c<JS9.scales.length;c++)d+=`<option>${JS9.scales[c]}</option>`;return d})())}),o.push({name:"limits",value:sprintf(JS9.ScaleLimits.limitsHTML,a,n)}),o.push({name:"axes",value:sprintf(JS9.ScaleLimits.axesHTML,a,n)}),o.push({name:"plot",value:sprintf(JS9.ScaleLimits.plotHTML,n,this.plotWidth,this.plotHeight)}),o.push({name:"lo",value:sprintf(JS9.ScaleLimits.loHTML,JS9.floatToString(s.params.scalemin),a,n)}),o.push({name:"hi",value:sprintf(JS9.ScaleLimits.hiHTML,JS9.floatToString(s.params.scalemax),a,n)}),t=s.expandMacro(JS9.ScaleLimits.scalelimsHTML,o),this.lastimage=s):t="<p><center>Scale parameters will appear here.</center>",this.scalelimsContainer.html(t),s&&JS9.ScaleLimits.doplot.call(this,s)},JS9.RegisterPlugin(JS9.ScaleLimits.CLASS,JS9.ScaleLimits.NAME,JS9.ScaleLimits.init,{menu:"scale",menuItem:"Scale Controls ...",onplugindisplay:JS9.ScaleLimits.init,onsetscale:JS9.ScaleLimits.init,onimagedisplay:JS9.ScaleLimits.display,onimageclose:JS9.ScaleLimits.close,help:"help/scalecontrols.html",winTitle:"Scale Controls",winDims:[JS9.ScaleLimits.WIDTH,JS9.ScaleLimits.HEIGHT]}),JS9.Separate={},JS9.Separate.CLASS="JS9",JS9.Separate.NAME="Separate",JS9.Separate.WIDTH=512,JS9.Separate.HEIGHT=336,JS9.Separate.BASE=JS9.Separate.CLASS+JS9.Separate.NAME,JS9.Separate.topHTML="$separate<p>$gather",JS9.Separate.separateHTML='<b>separate selected</b> images or <b>separate all</b> images into different displays. The topmost (selected) image remains in place, and the presence or absence of its menubar, toolbar, and colorbar will be replicated in the new displays:<p><div><input type="button" class="separateButton1 JS9Button2" name="separate" value="separate selected" onclick="javascript:JS9.Separate.separate.call(this, \'%s\', \'selected\');">;<input type="button" class="separateButton2 JS9Button2" name="separate" value="separate all" onclick="javascript:JS9.Separate.separate.call(this, \'%s\', \'all\');"><span style=\'float: right\'><select class="separateLayoutSelect JS9Select" onchange="JS9.Separate.xlayout.call(this, \'%s\')"><option selected disabled>layout</option><option value="auto">auto</option><option value="horizontal">horizontal</option><option value="vertical">vertical</option></select></span></div><p>',JS9.Separate.gatherHTML='<b>gather selected</b> images or  <b>gather all</b> images into this display:<p><div><input type="button" class="separateButton1 JS9Button2" name="gather" value="gather selected" onclick="javascript:JS9.Separate.gather.call(this, \'%s\', \'selected\');"><input type="button" class="separateButton2 JS9Button2" name="gather" value="gather all" onclick="javascript:JS9.Separate.gather.call(this, \'%s\', \'all\');"></div><p>',JS9.Separate.imageHTML="<span style='float: left'>$active&nbsp;&nbsp;</span><span id='separateFile'>$imfile</span>",JS9.Separate.activeHTML='<input class="separateActiveCheck" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Separate.xactive.call(this, \'%s\')">select',JS9.Separate.imfileHTML="<b>%s</b>",JS9.Separate.nofileHTML='<p><span id="NoFile">[Images will appear here as they are loaded]</span>',JS9.Separate.xactive=function(e){const t=JS9.lookupImage(e);t&&(t.tmp.separateMode=this.checked)},JS9.Separate.xlayout=function(e){let t;const s=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));!s||(t=s.pluginInstances.JS9Separate,t&&this.selectedIndex>=0&&(t.separateLayout=this.options[this.selectedIndex].value))},JS9.Separate.separate=function(e,t){let s,o,n,a;const l={},c=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));if(c){if("selected"===(n=c.pluginInstances.JS9Separate,n&&n.separateLayout&&(l.layout=n.separateLayout),t)){for(a=[],s=0;s<JS9.images.length;s++)o=JS9.images[s],o.tmp.separateMode&&a.push(o);if(!a.length)return;l.images=a}c.separate(l)}},JS9.Separate.gather=function(e,t){let s,o,n;const a={},l=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));if(l){switch(t){case"all":l.gather();break;case"selected":for(n=[],s=0;s<JS9.images.length;s++)o=JS9.images[s],o.tmp.separateMode&&n.push(o);if(!n.length)return;a.images=n}l.gather(a)}},JS9.Separate.imid=function(e){return`${`${e.display.id}_${e.id}`.replace(/[^A-Za-z0-9_]/g,"_")}SeparateImage`},JS9.Separate.dispclass=function(e){return`${JS9.Separate.BASE}_${e.display.id}`.replace(/[^A-Za-z0-9_]/g,"_")},JS9.Separate.activeImage=function(e){let t,s;e&&(t=JS9.Separate.imid(e),s=`${JS9.Separate.dispclass(e)}_Image`,$(`.${s}`).removeClass(`${JS9.Separate.BASE}ImageActive`).addClass(`${JS9.Separate.BASE}ImageInactive`),$(`#${t}`).removeClass(`${JS9.Separate.BASE}ImageInactive`).addClass(`${JS9.Separate.BASE}ImageActive`))},JS9.Separate.addImage=function(e){let t,s,o,n,a;const l=[],c=`${JS9.Separate.BASE}Image`;!e||(a=e.id,s=JS9.Separate.imid(e),n=`${JS9.Separate.dispclass(e)}_Image`,l.push({name:"imid",value:e.id}),l.push({name:"active",value:sprintf(JS9.Separate.activeHTML,a)}),l.push({name:"imfile",value:sprintf(JS9.Separate.imfileHTML,a)}),this.separateDivs||this.separateImageContainer.html(""),t=JS9.Image.prototype.expandMacro.call(e,JS9.Separate.imageHTML,l),o=$("<div>").addClass(c).addClass(n).attr("id",s).prop("imid",a).html(t).appendTo(this.separateImageContainer),o.on("mousedown touchstart",()=>{e.displayImage(),JS9.Separate.activeImage(e)}),this.separateDivs++,o.find(".separateActiveCheck").prop("checked",!0===e.tmp.separateMode),JS9.Separate.activeImage(e))},JS9.Separate.removeImage=function(e){let t;return!!e&&(t=JS9.Separate.imid(e),$(`#${t}`).remove(),this.separateDivs--,0===this.separateDivs&&this.separateImageContainer.html(JS9.Separate.nofileHTML),delete e.tmp.separateMode,!0)},JS9.Separate.init=function(){let e,t,s,o,n;const a=[];for(this.divjq.html(""),this.separateDivs=0,this.divjq.addClass("JS9PluginScrolling"),this.separateContainer=$("<div>").addClass(`${JS9.Separate.BASE}Container`).attr("id",`${this.id}SeparateContainer`).css("overflow","auto").appendTo(this.divjq),n=this.display.id,a.push({name:"separate",value:sprintf(JS9.Separate.separateHTML,n,n,n)}),a.push({name:"gather",value:sprintf(JS9.Separate.gatherHTML,n,n)}),t=JS9.Image.prototype.expandMacro.call(null,JS9.Separate.topHTML,a),this.separateHeader=$("<div>").addClass(`${JS9.Separate.BASE}Header`).attr("id",`${n}Header`).html(t).appendTo(this.separateContainer),this.separateImageContainer=$("<div>").addClass(`${JS9.Separate.BASE}ImageContainer`).attr("id",`${this.id}SeparateImageContainer`).html(JS9.Separate.nofileHTML).appendTo(this.separateContainer),o=JS9.getDynamicDisplayOr(this.display),e=0;e<JS9.images.length;e++)s=JS9.images[e],s.display===o&&JS9.Separate.addImage.call(this,s);this.separateImageContainer.sortable({start:(l,c)=>{this.oidx=c.item.index()},stop:(l,c)=>{const d=c.item.index();this.display.moveImageInStack(this.oidx,d),this.display.image&&this.display.image.displayImage(),delete this.oidx}})},JS9.Separate.imageload=function(e){const t=JS9.getDynamicDisplayOr(this.display);e&&e.display===t&&JS9.Separate.addImage.call(this,e)},JS9.Separate.imagedisplay=function(e){JS9.Separate.activeImage.call(this,e)},JS9.Separate.imageclose=function(e){JS9.Separate.removeImage.call(this,e)},JS9.Separate.reinit=function(e){e&&JS9.Separate.init.call(this)},JS9.RegisterPlugin(JS9.Separate.CLASS,JS9.Separate.NAME,JS9.Separate.init,{menuItem:"Separate/Gather",dynamicSelect:!0,onplugindisplay:JS9.Separate.init,ondynamicselect:JS9.Separate.reinit,ongatherdisplay:JS9.Separate.reinit,onimageload:JS9.Separate.imageload,onimagedisplay:JS9.Separate.imagedisplay,onimageclose:JS9.Separate.imageclose,help:"help/separate.html",winTitle:"Separate/Gather Images",winResize:!0,winDims:[JS9.Separate.WIDTH,JS9.Separate.HEIGHT]}),JS9.Statusbar={},JS9.Statusbar.CLASS="JS9",JS9.Statusbar.NAME="Statusbar",JS9.Statusbar.WIDTH=512,JS9.Statusbar.HEIGHT=32,JS9.Statusbar.COLORWIDTH=120,JS9.Statusbar.COLORHEIGHT=14,JS9.Statusbar.BASE=JS9.Statusbar.CLASS+JS9.Statusbar.NAME,JS9.Statusbar.mover=function(e){$(e).removeClass("JS9StatusbarItemNoHighlight JS9StatusbarItemHighlight2"),$(e).addClass("JS9StatusbarItemHighlight")},JS9.Statusbar.mout=function(e){$(e).removeClass("JS9StatusbarItemHighlight JS9StatusbarItemHighlight2"),$(e).addClass("JS9StatusbarItemNoHighlight")},JS9.Statusbar.mdown=function(e){$(e).removeClass("JS9StatusbarItemNoHighlight JS9StatusbarItemHighlight"),$(e).addClass("JS9StatusbarItemHighlight2")},JS9.Statusbar.mup=function(e,t){let s,o;if($(e).removeClass("JS9StatusbarItemNoHighlight JS9StatusbarItemHighlight2"),$(e).addClass("JS9StatusbarItemHighlight"),s=$(e).attr("name"),s&&(o=s.match(/file|image|edit|view|zoom|rot|flip|scale|color|regions|wcs|analysis|mag/i)),o&&o[0])switch(o[0]){case"file":case"image":JS9.DisplayPlugin("FITSBinning",{display:t});break;case"edit":case"view":case"regions":case"wcs":case"analysis":break;case"flip":case"rot":case"mag":case"zoom":JS9.DisplayPlugin("JS9PanZoom",{display:t});break;case"scale":JS9.DisplayPlugin("JS9Scale",{display:t});break;case"color":JS9.DisplayPlugin("JS9Color",{display:t})}},JS9.Statusbar.display=function(e,t){let s,o,n,a,l,c,d,h,p,g="",v=/;/;if(t=t||{},e&&JS9.globalOpts.statusBar)if(p=JS9.globalOpts.statusBar,h=e.display.pluginInstances.JS9Colorbar,h&&h.isActive()&&!this.mycolorbar&&(p=p.replace(/\$colorbar;? */,"")),o=p.replace(/\(/g," __OP__ ").replace(/\)/g," __CP__ ").replace(/\[/g," __OB__ ").replace(/\]/g," __CB__ "),o=e.expandMacro(o).replace(/ __OP__ /g,"(").replace(/ __CP__ /g,")").replace(/ __OB__ /g,"[").replace(/ __CB__ /g,"]"),this.statusBar!==p||t.reinit){for(a=p.split(v),l=o.split(v),s=0;s<l.length;s++)n=`<div name='__dummy__' class='JS9StatusbarItem JS9StatusbarItemNoHighlight' onmousedown='JS9.Statusbar.mdown(this)' onmouseup='JS9.Statusbar.mup(this, "${this.display.id}")' onmouseover='JS9.Statusbar.mover(this)' onmouseout='JS9.Statusbar.mout(this)'>${l[s]}</div>`.replace(/\$img\(([^()]+)\)/g,"<img src='$1' name='$1' class='JS9StatusbarImageItem JS9StatusbarItemNoHighlight'>").replace(/\$colorbar/g,`<div name='JS9Colorbar' id='${this.id.replace(/Statusbar/,"Colorbar")}' class='JS9Colorbar JS9StatusbarPluginItem' data-width="${this.colorwidth}px" data-height="${this.colorheight}px" data-colorbarHeight="${this.colorheight}px" data-showTicks="false" ></div>`).replace(/__dummy__/,a[s].replace(/\s+/,"_")),g+=n;this.statusContainer.html(g),p.match(/\$colorbar/)&&(JS9.AddDivs({display:e}),this.mycolorbar=this.display.pluginInstances.JS9Colorbar,d=JS9.globalOpts.resizeDivs.indexOf("JS9Colorbar"),d>=0&&JS9.globalOpts.resizeDivs.splice(d,1)),this.statusBar=p}else for(c=this.divjq.find(".JS9StatusbarItem"),l=o.split(v),s=0;s<c.length;s++)l[s].match(/\$colorbar/)?this.mycolorbar&&this.isDynamic&&JS9.Colorbar.display.call(this.mycolorbar,e):l[s].match(/\$img/)?(n=l[s].match(/\$img\((.*)\)/),n&&n[1]&&("/"!==n[1].charAt(0)&&(n[1]=JS9.InstallDir(n[1])),$(c[s]).find("img").attr("src",n[1]))):$(c[s]).html(l[s]);else if(this.statusBar)for(l=this.statusBar.split(v),c=this.divjq.find(".JS9StatusbarItem"),s=0;s<c.length;s++)l[s].match(/\$colorbar/)||$(c[s]).html("")},JS9.Statusbar.init=function(e,t){this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Statusbar.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Statusbar.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.colorwidth=parseInt(this.divjq.attr("data-colorbarWidth"),10)||JS9.Statusbar.COLORWIDTH+Math.max(this.display.width-512,0),this.colorheight=parseInt(this.divjq.attr("data-colorbarHeight"),10)||JS9.Statusbar.COLORHEIGHT,this.divjq.html(""),this.statusContainer=$("<div>").addClass(`${JS9.Statusbar.BASE}Container`).attr("id",`${this.id}Container`).attr("width",this.width).attr("height",this.height).appendTo(this.divjq),this.display.image&&JS9.Statusbar.display.call(this,this.display.image)},JS9.Statusbar.imagedisplay=function(e){e&&JS9.Statusbar.display.call(this,e)},JS9.Statusbar.imageclear=function(e){JS9.Statusbar.display.call(this,null)},JS9.Statusbar.dynamic=function(e){let t;e&&(t=e.display.pluginInstances.JS9Statusbar,t&&t.isDynamic&&JS9.Statusbar.imagedisplay.call(this,e))},JS9.RegisterPlugin(JS9.Statusbar.CLASS,JS9.Statusbar.NAME,JS9.Statusbar.init,{menuItem:"Statusbar",dynamicSelect:!0,ondynamicselect:JS9.Statusbar.dynamic,onimagedisplay:JS9.Statusbar.imagedisplay,onimageclear:JS9.Statusbar.imageclear,onimageclose:JS9.Statusbar.imageclear,onsetwcssys:JS9.Statusbar.imagedisplay,onsetwcsunits:JS9.Statusbar.imagedisplay,help:"help/statusbar.html",winTitle:"Statusbar",winDims:[JS9.Statusbar.WIDTH,JS9.Statusbar.HEIGHT]}),JS9.Sync={},JS9.Sync.CLASS="JS9",JS9.Sync.NAME="Sync",JS9.Sync.getOps=function(e){let t,s,o;const n=[];if(e=e||JS9.globalOpts.syncOps,!$.isArray(e))try{e=JSON.parse(e)}catch{e=[e]}for(t=0,s=0;t<e.length;t++)"wcs"===(o=e[t],o)?(n[s++]="wcssys",n[s++]="wcunits"):n[s++]=o;return n},JS9.Sync.getIms=function(e){let t,s,o;const n=[];if(e=e||JS9.images,!$.isArray(e))try{e=JSON.parse(e)}catch{e=[e]}for(t=0,s=0;t<e.length;t++)o="string"==typeof e[t]?JS9.lookupImage(e[t]):e[t],o&&(o.id!==this.id||o.display.id!==this.display.id)&&(n[s++]=o);return n},JS9.Sync.sync=function(...e){let t,s,o,n,a,l,c,[d,h,p]=e;const g=[];if(this.syncs=this.syncs||{active:!0},p=p||{reciprocate:JS9.globalOpts.syncReciprocate},"string"==typeof p)try{p=JSON.parse(p)}catch(v){JS9.error(`can't parse sync opts: ${p}`,v)}if(1!==e.length||"boolean"!=typeof d)if(a=JS9.Sync.getOps.call(this,d),l=JS9.Sync.getIms.call(this,h),c=l.length,p.reverse)for(delete p.reverse,t=0;t<c;t++)JS9.Sync.sync.call(l[t],a,[this]);else{for(t=0;t<a.length;t++)for(o=a[t],this.syncs[o]=this.syncs[o]||[],h=this.syncs[o],s=0;s<c;s++)n=l[s],$.inArray(n,h)<0&&(h.push(n),g.push({im:this,xim:n,xop:o,xarg:null}));if(p.reciprocate){for(JS9.Sync.reciprocating=!0,p.reciprocate=!1,t=0,n=this;t<c;t++)l.push(n),n=l.shift(),JS9.Sync.sync.call(n,a,l,p);delete JS9.Sync.reciprocating}this.tmp.syncwcs=JS9.notNull(p.syncwcs)?p.syncwcs:JS9.globalOpts.syncWCS,JS9.Sync.reciprocating||(JS9.Sync.xeqSync.call(this,g),JS9.Sync.ready=!0)}else this.syncs.active=d},JS9.Sync.unsync=function(e,t,s){let o,n,a,l,c,d,h;if(this.syncs){if(s=s||{reciprocate:JS9.globalOpts.syncReciprocate},l=JS9.Sync.getOps.call(this,e),c=JS9.Sync.getIms.call(this,t),d=c.length,s.reverse){for(delete s.reverse,o=0;o<d;o++)JS9.Sync.unsync.call(c[o],l,[this]);return}for(n of Object.keys(this.syncs))if(!(l&&$.inArray(n,l)<0))if(c){for(a=this.syncs[n],o=a.length-1;o>=0;o--)$.inArray(a[o],c)>=0&&a.splice(o,1);a.length||delete this.syncs[n]}else delete this.syncs[n];if(Object.keys(this.syncs).length||delete this.syncs,s.reciprocate){for(JS9.Sync.reciprocating=!0,s.reciprocate=!1,o=0,h=this;o<d;o++)c.push(h),h=c.shift(),JS9.Sync.unsync.call(h,l,c,s);delete JS9.Sync.reciprocating}}},JS9.Sync.xeqSync=function(e){let t,s,o,n,a,l,c,d,h,p,g,v,r,u,f,m,b,w,A,x={};const y=JS9.globalOpts.xeqPlugins,S=`${this.id}_${this.display.id}`,C=I=>{let L,D,O=0,M=0,E="";for(D=I.split(""),L=0;L<D.length;L++)switch(D[L]){case"x":O++;break;case"y":M++}return O%2==1&&(E+="x"),M%2==1&&(E+="y"),E||""};if(!this.tmp.syncRunning){this.tmp.syncRunning=!0;try{for(t=0;t<e.length;t++)n=e[t],"regions"===n.xop&&(e.splice(t,1),e.unshift(n));for(t=0;t<e.length;t++){if(n=e[t],c=n.xim,c.syncs){if(c.tmp.syncRunning)continue;c.tmp.syncRunning=!0,c!==c.display.image&&(x[c.display.id]||(x[c.display.id]=c.display.image))}try{switch(n.xop){case"alignment":c.alignPanZoom(this);break;case"colormap":c.setColormap(this.params.colormap);break;case"contrastbias":c.setColormap(this.params.contrast,this.params.bias);break;case"flip":this.params.flip!=c.params.flip&&(A=C(this.params.flip+c.params.flip),c.setFlip(A));break;case"pan":a=this.getPan(),this.tmp.syncwcs&&this.validWCS()?(l=JS9.pix2wcs(this.raw.wcs,a.ox,a.oy),c.setPan({wcs:l})):c.setPan(a.ox,a.oy);break;case"regions":if(w=[],d=null,n.xarg)w.push(n.xarg);else for(m||(m=this.getShapes("regions","all")),d=c.getShapes("regions","all"),s=0;s<m.length;s++){for(m[s].mode="add",o=0;o<d.length;o++)if(L=m[s],(I=d[o]).data&&I.data.syncid&&L.data&&L.data.syncid&&I.data.syncid===L.data.syncid){m[s].mode="update";break}w.push(m[s])}for(s=0;s<w.length;s++)switch(u=$.extend(!0,{},w[s]),f=u.data&&u.data.syncid?u.data.syncid:`${S}_${u.id}`,u.mode){case"add":r={doexport:!1,syncid:f},JS9.globalOpts.xeqPlugins=!1,this.changeShapes("regions",u.id,{data:r}),JS9.globalOpts.xeqPlugins=y,b=this.listRegions(u.id,{mode:1}),c.addShapes("regions",b,{data:r});break;case"remove":for(d||(d=c.getShapes("regions","all")),o=0;o<d.length;o++)h=d[o],p=h.data,p&&p.syncid&&p.syncid===f&&c.removeShapes("regions",f);break;case"move":case"update":for(delete u.sizeScale,this.raw.wcsinfo&&c.raw.wcsinfo&&(c.raw.wcsinfo.cdelt1&&(u.sizeScale=this.raw.wcsinfo.cdelt1/c.raw.wcsinfo.cdelt1),c.raw.wcsinfo.crot&&("box"===u.shape||"ellipse"===u.shape||"text"===u.shape&&!u.parent)&&(u.angle+=c.raw.wcsinfo.crot)),d||(d=c.getShapes("regions","all")),o=0;o<d.length;o++)h=d[o],p=h.data,p&&p.syncid&&p.syncid===f&&c.changeShapes("regions",f,u)}break;case"rot90":if(this.params.rot90!=c.params.rot90)switch(v=this.params.rot90-c.params.rot90||0,v){case 90:case-270:c.setRot90(90);break;case-90:case 270:c.setRot90(-90)}break;case"rotate":this.params.rotate!=c.params.rotate&&(v=this.params.rotate-c.params.rotate||0,c.setRotate(v));break;case"scale":c.setScale(this.params.scale);break;case"wcssys":c.setWCSSys(this.params.wcssys);break;case"wcsunits":c.setWCSUnits(this.params.wcsunits);break;case"zoom":c.setZoom(this.params.zoom)}}catch{}finally{delete c.tmp.syncRunning}}for(g of Object.keys(x))x[g].displayImage()}catch{}finally{this.displayImage(),delete this.tmp.syncRunning}}var I,L},JS9.Sync.maybeSync=function(e,t){let s,o,n,a,l;if(JS9.Sync.ready&&this.syncs&&!this.tmp.syncRunning&&($.isArray(e)||(e=[e]),this.syncs.active))for(o=0;o<e.length;o++)if(a=e[o],$.isArray(this.syncs[a])&&this.syncs[a].length){for(n=this.syncs[a],l=[],s=0;s<n.length;s++)l.push({xim:n[s],xop:a,xarg:t});JS9.Sync.xeqSync.call(this,l)}},JS9.Sync.init=function(){return this},JS9.Sync.setcolormap=function(e){!e||JS9.Sync.maybeSync.call(e,"colormap")},JS9.Sync.changecontrastbias=function(e){!e||JS9.Sync.maybeSync.call(e,"contrastbias")},JS9.Sync.setflip=function(e){!e||JS9.Sync.maybeSync.call(e,["flip","alignment"])},JS9.Sync.setpan=function(e){!e||JS9.Sync.maybeSync.call(e,["pan","alignment"])},JS9.Sync.setrot90=function(e){!e||JS9.Sync.maybeSync.call(e,["rot90","alignment"])},JS9.Sync.setrotate=function(e){!e||JS9.Sync.maybeSync.call(e,["rotate","alignment"])},JS9.Sync.regionschange=function(e,t){if(e)switch(t.mode){case"select":case"unselect":break;default:JS9.Sync.maybeSync.call(e,"regions",t)}},JS9.Sync.setscale=function(e){!e||JS9.Sync.maybeSync.call(e,"scale")},JS9.Sync.setwcssys=function(e){!e||JS9.Sync.maybeSync.call(e,"wcssys")},JS9.Sync.setwcsunits=function(e){!e||JS9.Sync.maybeSync.call(e,"wcsunits")},JS9.Sync.setzoom=function(e){!e||JS9.Sync.maybeSync.call(e,["zoom","alignment"])},JS9.Sync.loadimage=function(e){let t,s;if(e)for(t=0;t<JS9.displays.length;t++)s=JS9.displays[t].pluginInstances.JS9SyncUI,s&&s.isActive()&&JS9.SyncUI.init.call(s)},JS9.Sync.closeimage=function(e){let t,s;if(e){for(t=0;t<JS9.images.length;t++)JS9.Sync.unsync.call(JS9.images[t],null,[e]);for(t=0;t<JS9.displays.length;t++)s=JS9.displays[t].pluginInstances.JS9SyncUI,s&&s.isActive()&&JS9.SyncUI.init.call(s)}},JS9.Image.prototype.syncImages=JS9.Sync.sync,JS9.mkPublic("SyncImages","syncImages"),JS9.Image.prototype.unsyncImages=JS9.Sync.unsync,JS9.mkPublic("UnsyncImages","unsyncImages"),JS9.RegisterPlugin(JS9.Sync.CLASS,JS9.Sync.NAME,JS9.Sync.init,{onsetcolormap:JS9.Sync.setcolormap,onsetflip:JS9.Sync.setflip,onsetpan:JS9.Sync.setpan,onregionschange:JS9.Sync.regionschange,onsetrot90:JS9.Sync.setrot90,onsetrotate:JS9.Sync.setrotate,onsetscale:JS9.Sync.setscale,onsetwcssys:JS9.Sync.setwcssys,onsetwcsunits:JS9.Sync.setwcsunits,onsetzoom:JS9.Sync.setzoom,onchangecontrastbias:JS9.Sync.changecontrastbias,onimageload:JS9.Sync.loadimage,onimageclose:JS9.Sync.closeimage,winDims:[0,0]}),JS9.SyncUI={},JS9.SyncUI.CLASS="JS9",JS9.SyncUI.NAME="SyncUI",JS9.SyncUI.WIDTH=512,JS9.SyncUI.HEIGHT=430,JS9.SyncUI.BASE=JS9.SyncUI.CLASS+JS9.SyncUI.NAME,JS9.SyncUI.HEADER="<div class='JS9SyncUIText'><br><b>%s:</b></div>",JS9.SyncUI.NCOL=3,JS9.SyncUI.COLWIDTH=175,JS9.SyncUI.headerHTML="Synchronize two or more images, so that when an operation is performed on one image, it also is performed on the other(s). Or sync once only.",JS9.SyncUI.opHTML="$opactive&nbsp;&nbsp;$opname",JS9.SyncUI.opactiveHTML='<input class="JS9SyncUIOpCheck" type="checkbox" name="%s" value="active"">',JS9.SyncUI.opnameHTML="<b>%s</b>",JS9.SyncUI.imageHTML="$imactive&nbsp;&nbsp;$imfile",JS9.SyncUI.imactiveHTML='<input class="JS9SyncUIImCheck" type="checkbox" name="%s" value="active">',JS9.SyncUI.imfileHTML="<b>%s</b>",JS9.SyncUI.nofileHTML='<p><span class="JS9SyncUINoFile">[Images will appear here as they are loaded]</span>',JS9.SyncUI.optsHTML='<div class="JS9SyncUIOptsRow">$reciprocate&nbsp;&nbsp;$syncwcs</div>',JS9.SyncUI.reciprocalHTML='<span class="JS9SyncUIOpts" style="position:absolute; left:%spx; top:0px"><input class="JS9SyncUIOptsCheck" type="checkbox" name="%s" value="active" onchange="javascript:JS9.SyncUI.xrecip(\'%s\', this)">&nbsp;&nbsp;<b>%s</b></span>',JS9.SyncUI.syncwcsHTML='<span class="JS9SyncUIOpts" style="position:absolute; left:%spx; top:0px"><input class="JS9SyncUIOptsCheck" type="checkbox" name="%s" value="active" onchange="javascript:JS9.SyncUI.xsyncwcs(\'%s\', this)">&nbsp;&nbsp;<b>%s</b></span>',JS9.SyncUI.footerHTML='<div class="JS9SyncUIButtons" <p><span style="float:right;">$cancel&nbsp;&nbsp;$sync&nbsp;&nbsp;&nbsp;&nbsp;$once&nbsp;&nbsp;&nbsp;&nbsp;$unsync</span></div>',JS9.SyncUI.cancelHTML='<span class="JS9SyncUIButton"><input type="button" class="JS9Button2 JS9SyncUIButton" id="active" name="sync" value="Cancel" onclick="javascript:JS9.SyncUI.xcancel(\'%s\', this)" %s></span>',JS9.SyncUI.syncHTML='<span class="JS9SyncUIButton"><input type="button" class="JS9RunButton JS9SyncUIButton" id="active" name="sync" value="Sync Repeatedly" onclick="javascript:JS9.SyncUI.xsync(\'%s\', this)"></span>',JS9.SyncUI.onceHTML='<span class="JS9SyncUIButton"><input type="button" class="JS9RunButton JS9SyncUIButton" id="active" name="once" value="Sync Once" onclick="javascript:JS9.SyncUI.xonce(\'%s\', this)"></span>',JS9.SyncUI.unsyncHTML='<span class="JS9SyncUIButton"><input type="button" class="JS9RunButton JS9SyncUIButton" id="active" name="unsync" value="Unsync" onclick="javascript:JS9.SyncUI.xunsync(\'%s\', this)"></span>',JS9.SyncUI.getImsOpsOpts=function(e){const t=e.closest(".JS9SyncUIContainer"),s=[],o=[],n={};return t.length&&(t.find(".JS9SyncUIImCheck").each((a,l)=>{let c=$(l).prop("name");$(l).prop("checked")&&o.push(c)}),t.find(".JS9SyncUIOpCheck").each((a,l)=>{let c=$(l).prop("name");$(l).prop("checked")&&s.push(c)}),t.find(".JS9SyncUIOptsCheck").each((a,l)=>{let c=$(l).prop("name"),d=$(l).prop("checked");n[c]=d})),{ims:o,ops:s,opts:n}},JS9.SyncUI.xcancel=function(e,t){let s;const o=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));o&&(s=o.pluginInstances.JS9SyncUI,s&&s.winHandle&&s.winHandle.close())},JS9.SyncUI.xsync=function(e,t){let s;const o=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));if(o.image){s=o.image;const{ims:n,ops:a,opts:l}=JS9.SyncUI.getImsOpsOpts($(t));n.length&&a.length&&s.syncImages(a,n,l),JS9.SyncUI.setCheckboxes(s)}},JS9.SyncUI.xonce=function(e,t){let s;const o=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));if(o.image){s=o.image;const{ims:n,ops:a}=JS9.SyncUI.getImsOpsOpts($(t));n.length&&a.length&&(s.copyParams(a,n),JS9.SyncUI.setCheckboxes(s))}},JS9.SyncUI.xunsync=function(e,t){let s;const o=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));if(o.image){s=o.image;const{ims:n,ops:a,opts:l}=JS9.SyncUI.getImsOpsOpts($(t));n.length&&a.length&&s.unsyncImages(a,n,l),JS9.SyncUI.setCheckboxes(s)}},JS9.SyncUI.xrecip=function(e,t){let s;const o=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));o&&(s=o.pluginInstances.JS9SyncUI,s.syncReciprocate=$(t).is(":checked"))},JS9.SyncUI.xsyncwcs=function(e,t){let s;const o=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));o&&(s=o.pluginInstances.JS9SyncUI,s.syncWCS=$(t).is(":checked"))},JS9.SyncUI.imid=function(e){return`${`${e.display.id}_${e.id}`.replace(/[^A-Za-z0-9_]/g,"_")}SyncImage`},JS9.SyncUI.setCheckboxes=function(e){let t,s,o,n,a,l;if(e){if(l=e.display.pluginInstances.JS9SyncUI,l.syncContainer.find(".JS9SyncUIOpCheck").prop("checked",!1),l.syncContainer.find(".JS9SyncUIImCheck").prop("checked",!1),l.syncContainer.find(".JS9SyncUIOptsCheck").prop("checked",!1),a=JS9.globalOpts.syncOps,e.syncs)for(t=0;t<a.length;t++)if(n=a[t],$.isArray(e.syncs[n]))for(l.syncContainer.find(".JS9SyncUIOpCheck").filter(`[name='${n}']`).prop("checked",!0),s=0;s<e.syncs[n].length;s++)JS9.isImage(e.syncs[n][s])&&(o=e.syncs[n][s].id.replace(/\[.*\]/,""),l.syncContainer.find(".JS9SyncUIImCheck").filter(`[name^='${o}']`).prop("checked",!0));l.syncContainer.find(".JS9SyncUIOptsCheck").filter('[name="reciprocate"]').prop("checked",l.syncReciprocate),l.syncContainer.find(".JS9SyncUIOptsCheck").filter('[name="syncwcs"]').prop("checked",l.syncWCS)}},JS9.SyncUI.addOp=function(e,t){let s,o,n,a;const l=[],c=`${JS9.SyncUI.BASE}Op`;switch(e){case"contrastbias":a="contrast/bias";break;case"wcs":a="wcs sys/units";break;default:a=e}return l.push({name:"op",value:e}),l.push({name:"opactive",value:sprintf(JS9.SyncUI.opactiveHTML,e)}),l.push({name:"opname",value:sprintf(JS9.SyncUI.opnameHTML,a)}),s=JS9.Image.prototype.expandMacro.call(null,JS9.SyncUI.opHTML,l),this.syncOpDivs++,o=t*JS9.SyncUI.COLWIDTH,n=0,`<span class="JS9SyncUIOp" style="position:absolute; left:${o}px; top:0px" id="${c}">${s}</span>`},JS9.SyncUI.addImage=function(e){let t,s,o;const n=[],a=`${JS9.SyncUI.BASE}ImageRow`;if(e)return o=e.id,s=JS9.SyncUI.imid(e),n.push({name:"imid",value:e.id}),n.push({name:"imactive",value:sprintf(JS9.SyncUI.imactiveHTML,o)}),n.push({name:"imfile",value:sprintf(JS9.SyncUI.imfileHTML,o)}),t=e.expandMacro(JS9.SyncUI.imageHTML,n),this.syncImageDivs++,`<div class="${a}" id="${s}">${t}</div>`},JS9.SyncUI.removeImage=function(e){let t;return!!e&&(t=JS9.SyncUI.imid(e),$(`#${t}`).remove(),this.syncImageDivs--,this.syncImageDivs||this.syncImageContainer.html(""),!0)},JS9.SyncUI.init=function(){let e,t,s,o,n,a,l,c,d,h,p,g,v;if(this.divjq&&this.divjq.is(":visible")){for(this.divjq.html(""),this.syncOpDivs=0,this.syncImageDivs=0,this.divjq.addClass("JS9PluginScrolling"),JS9.isNull(this.syncReciprocate)&&(this.syncReciprocate=JS9.globalOpts.syncReciprocate),JS9.isNull(this.syncWCS)&&(this.syncWCS=JS9.globalOpts.syncWCS),a=this.display.id,this.display.image?(this.lastim=this.display.image,l=sprintf(JS9.SyncUI.HEADER,`Images that can be synced with ${this.lastim.id}`)):(this.lastim=null,l=sprintf(JS9.SyncUI.HEADER,"Images that can be synced")),this.syncContainer=$("<div>").addClass(`${JS9.SyncUI.BASE}Container`).attr("id",`${this.id}SyncContainer`).css("overflow","auto").appendTo(this.divjq),s=JS9.Image.prototype.expandMacro.call(null,JS9.SyncUI.headerHTML),this.syncHeader=$("<div>").addClass(`${JS9.SyncUI.BASE}Header`).attr("id",`${a}Header`).html(s).appendTo(this.syncContainer),this.syncImageContainer=$("<div>").addClass(`${JS9.SyncUI.BASE}ImageContainer`).attr("id",`${this.id}SyncImageContainer`).html(l).appendTo(this.syncContainer),v="",e=0;e<JS9.images.length;e++)o=JS9.images[e],o!==this.display.image&&"closing"!==o.getStatus("close")&&(v+=JS9.SyncUI.addImage.call(this,o));for(v=v||JS9.SyncUI.nofileHTML,this.syncImageContainer.append(v),this.syncOpContainer=$("<div>").addClass(`${JS9.SyncUI.BASE}OpContainer`).attr("id",`${this.id}SyncOpContainer`).html(sprintf(JS9.SyncUI.HEADER,"Operations that can be synced")).appendTo(this.syncContainer),g=JS9.globalOpts.syncOps,h=Math.floor((g.length+JS9.SyncUI.NCOL-1)/JS9.SyncUI.NCOL),t=0;t<h;t++){for(v=`<div class="${JS9.SyncUI.BASE}OpRow" id="${this.id}SyncOpRow">`,e=0;e<JS9.SyncUI.NCOL;e++)p=e*h+t,g[p]&&(n=g[p],v+=JS9.SyncUI.addOp.call(this,n,e));v+="</div>",this.syncOpContainer.append(v)}c=sprintf(JS9.SyncUI.HEADER,"Sync options"),this.syncOptsContainer=$("<div>").addClass(`${JS9.SyncUI.BASE}OptsContainer`).attr("id",`${this.id}SyncOptsContainer`).html(c).appendTo(this.syncContainer),d=[],d.push({name:"reciprocate",value:sprintf(JS9.SyncUI.reciprocalHTML,0*JS9.SyncUI.COLWIDTH,"reciprocate",a,"reciprocal sync")}),d.push({name:"syncwcs",value:sprintf(JS9.SyncUI.syncwcsHTML,1*JS9.SyncUI.COLWIDTH,"syncwcs",a,"sync using wcs")}),s=JS9.Image.prototype.expandMacro.call(null,JS9.SyncUI.optsHTML,d),this.syncOpts=$("<div>").attr("id",`${a}Opts`).html(s).appendTo(this.syncOptsContainer),d=[],d.push({name:"cancel",value:sprintf(JS9.SyncUI.cancelHTML,a,this.winHandle?"":'style="display:none;"')}),d.push({name:"sync",value:sprintf(JS9.SyncUI.syncHTML,a)}),d.push({name:"once",value:sprintf(JS9.SyncUI.onceHTML,a)}),d.push({name:"unsync",value:sprintf(JS9.SyncUI.unsyncHTML,a)}),s=JS9.Image.prototype.expandMacro.call(null,JS9.SyncUI.footerHTML,d),this.syncFooter=$("<div>").addClass(`${JS9.SyncUI.BASE}Footer`).attr("id",`${a}Footer`).html(s).appendTo(this.syncContainer),this.display.image&&JS9.SyncUI.setCheckboxes(this.display.image)}},JS9.SyncUI.reinit=function(e){JS9.SyncUI.init.call(this)},JS9.SyncUI.imageload=function(e){!e||JS9.SyncUI.init.call(this)},JS9.SyncUI.imagedisplay=function(e){e&&e!==this.lastim&&JS9.SyncUI.init.call(this)},JS9.SyncUI.imageclose=function(e){let t;if(e){for(t=0;t<JS9.images.length;t++)JS9.SyncUI.unsync.call(JS9.images[t],null,[e]);JS9.SyncUI.init.call(this)}},JS9.RegisterPlugin(JS9.SyncUI.CLASS,JS9.SyncUI.NAME,JS9.SyncUI.init,{menuItem:"Sync Images",onplugindisplay:JS9.SyncUI.reinit,onimagedisplay:JS9.SyncUI.imagedisplay,onimageload:JS9.SyncUI.imageload,onimageclose:JS9.SyncUI.imageclose,help:"help/syncui.html",winTitle:"Sync Images",winDims:[JS9.SyncUI.WIDTH,JS9.SyncUI.HEIGHT]}),JS9.Toolbar={},JS9.Toolbar.CLASS="JS9",JS9.Toolbar.NAME="Toolbar",JS9.Toolbar.WIDTH=512,JS9.Toolbar.HEIGHT=36,JS9.Toolbar.BASE=JS9.Toolbar.CLASS+JS9.Toolbar.NAME,JS9.Toolbar.IMAGEWIDTH=24,JS9.Toolbar.IMAGEHEIGHT=24,JS9.Toolbar.TOOLBARHEIGHT=36,JS9.Toolbar.TOOLTIPX=30,JS9.Toolbar.TOOLTIPY=50,JS9.Toolbar.TOOLTIPLX=30,JS9.Toolbar.TOOLTIPLY=82,JS9.Toolbar.tools=[{name:"linear",tip:"linear scale",cmd:"SetScale",args:["linear"]},{name:"log",tip:"log scale",cmd:"SetScale",args:["log"]},{name:"histeq",tip:"histogram equalization",cmd:"SetScale",args:["histeq"]},{name:"power",tip:"power scale",cmd:"SetScale",args:["power"]},{name:"sqrt",tip:"square root scale",cmd:"SetScale",args:["sqrt"]},{name:"asinh",tip:"asinh scale",cmd:"SetScale",args:["asinh"]},{name:"sinh",tip:"sinh scale",cmd:"SetScale",args:["sinh"]},{name:"squared",tip:"squared scale",cmd:"SetScale",args:["squared"]},{name:"annulus",tip:"annulus region",image:"images/voyager/regions_annulus.svg",cmd:"AddRegions",args:["annulus"]},{name:"box",tip:"box region",image:"images/voyager/regions_box.svg",cmd:"AddRegions",args:["box"]},{name:"circle",tip:"circle region",image:"images/voyager/regions_circle.svg",cmd:"AddRegions",args:["circle"]},{name:"ellipse",tip:"ellipse region",image:"images/voyager/regions_ellipse.svg",cmd:"AddRegions",args:["ellipse"]},{name:"line",tip:"line region",image:"images/voyager/regions_line.svg",cmd:"AddRegions",args:["line"]},{name:"polygon",tip:"polygon region",image:"images/voyager/regions_polygon.svg",cmd:"AddRegions",args:["polygon"]},{name:"text",tip:"text region",image:"images/voyager/regions_text.svg",cmd:"AddRegions",args:["text"]},{name:"inc/excl",tip:"toggle selected region incl/excl",cmd:"ToggleRegionTags",args:["selected","include","exclude"]},{name:"src/bkg",tip:"toggle selected region src/bkg",cmd:"ToggleRegionTags",args:["selected","source","background"]},{name:"remove",tip:"remove selected region",cmd:"RemoveRegions",args:["selected"]},{name:"zoom+",image:"images/voyager/zoom_in.svg",tip:"zoom in",cmd:"SetZoom",args:["x2"]},{name:"zoom-",image:"images/voyager/zoom_out.svg",tip:"zoom out",cmd:"SetZoom",args:["/2"]},{name:"zoom1",tip:"zoom 1",image:"images/voyager/zoom_1.svg",cmd:"SetZoom",args:[1]},{name:"zoomtofit",tip:"zoom to fit",image:"images/voyager/zoom_tofit.svg",cmd:"SetZoom",args:["toFit"]},{name:"open",tip:"open local file dialog box",cmd:"OpenFileMenu",args:[]},{name:"infobox",tip:"toggle infobox display",cmd:"DisplayPlugin",args:["JS9Info"]},{name:"magnifier",tip:"toggle magnifier display",cmd:"DisplayPlugin",args:["JS9Magnifier"]},{name:"panner",tip:"toggle panner display",cmd:"DisplayPlugin",args:["JS9Panner"]},{name:"prefs",tip:"toggle preferences display",cmd:"DisplayPlugin",args:["JS9Preferences"]}],JS9.Toolbar.tooltip=function(e,t,s){let o,n,a,l;t?(l=$(s.currentTarget).position(),this.tooltip.html(t),"light"===this.winType?(o=l.left+JS9.Toolbar.TOOLTIPLX,n=l.top-JS9.Toolbar.TOOLTIPLY):(o=l.left+JS9.Toolbar.TOOLTIPX,n=l.top-JS9.Toolbar.TOOLTIPY),a=this.tooltip.width(),o+a+20>this.width&&(o=l.left-a-20),this.tooltip.css({left:o,top:n,display:"inline-block"})):this.tooltip.html("").css({left:-9999,display:"none"})},JS9.Toolbar.addTool=function(e){let t,s,o;return e?"$break"!==e?((!e.name||!e.cmd)&&JS9.error(`invalid input to JS9.toolbar: ${JSON.stringify(e)}`),t=$("<div>").addClass(`${JS9.Toolbar.BASE}ButtonDiv`).appendTo(this.activeToolbar),e.image?(o=e.image,JS9.inline&&JS9.inline[o]?o=JS9.inline[o]:"/"!==o.charAt(0)&&(o=JS9.InstallDir(o)),s=$("<input>").addClass(`${JS9.Toolbar.BASE}ImageButton`).attr("type","image").attr("src",o).attr("width",JS9.Toolbar.IMAGEWIDTH).attr("height",JS9.Toolbar.IMAGEHEIGHT).attr("alt",e.name).appendTo(t)):s=$("<input>").addClass(`${JS9.Toolbar.BASE}ButtonButton`).attr("type","button").attr("value",e.name).appendTo(t),s.on("click",()=>{let n;const a=this.display;"function"==typeof JS9.publics[e.cmd]?(n=JSON.parse(JSON.stringify(e.args||[])),n.push({display:a}),JS9.publics[e.cmd](...n)):JS9.error(`unknown JS9 func for toolbar: ${e.cmd}`)}),JS9.globalOpts.toolbarTooltips&&(s.on("mouseover",n=>{JS9.Toolbar.tooltip.call(this,e,e.tip||e.name,n)}),s.on("mouseout",n=>{JS9.Toolbar.tooltip.call(this,e,null,n)})),e.btn=s,e):void $("<hr>").appendTo(this.activeToolbar):JS9.Toolbar.tools},JS9.Toolbar.init=function(e,t){let s,o,n,a;for(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Toolbar.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Toolbar.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.divjq.html(""),this.toolbarContainer=$("<div>").addClass(`${JS9.Toolbar.BASE}Container`).attr("id",`${this.id}Container`).appendTo(this.divjq),this.activeToolbar=$("<div>").addClass(`${JS9.Toolbar.BASE}Div`).attr("id",`${this.id}Toolbar`).css("width",this.width).css("height",this.height).css("min-height",JS9.Toolbar.TOOLBARHEIGHT).appendTo(this.toolbarContainer),this.tooltip=$("<div>").attr("id",`tooltip_${this.id}`).addClass("JS9ToolbarTooltip").appendTo(this.divjq),o=0;o<JS9.globalOpts.toolBar.length;o++)for(a=JS9.globalOpts.toolBar[o],s=0;s<JS9.Toolbar.tools.length;s++)n=JS9.Toolbar.tools[s],a===n.name&&JS9.Toolbar.addTool.call(this,n);for(JS9.Toolbar.addTool.call(this,"$break"),s=0;s<JS9.Toolbar.tools.length;s++)n=JS9.Toolbar.tools[s],$.inArray(n.name,JS9.globalOpts.toolBar)<0&&JS9.Toolbar.addTool.call(this,n);return JS9.Toolbar.tools},JS9.mkPublic("GetToolbar",function(...e){let t;return t=JS9.parsePublicArgs(e).argv[0],"showTooltips"===t?JS9.globalOpts.toolbarTooltips:JS9.Toolbar.tools}),JS9.mkPublic("SetToolbar",function(...e){let t,s,o;const n=JS9.parsePublicArgs(e),a=()=>{let l,c,d;for(l=0;l<JS9.displays.length;l++)c=JS9.displays[l],d=c.pluginInstances.JS9Toolbar,d&&JS9.Toolbar.init.call(d)};if(s=n.argv[0],o=n.argv[1],s){if("init"===s)return void a();if("showTooltips"===s)return JS9.globalOpts.toolbarTooltips=!!o,void a();if("string"==typeof s){try{s=JSON.parse(s)}catch(l){JS9.error(`can't parse json for SetToolBar: ${s}`,l)}JS9.Toolbar.tools.push(s),a()}else if($.isArray(s)){for(t=0;t<s.length;t++)JS9.Toolbar.tools.push(s[t]);a()}else"object"==typeof s&&(JS9.Toolbar.tools.push(s),a());return null}}),JS9.RegisterPlugin(JS9.Toolbar.CLASS,JS9.Toolbar.NAME,JS9.Toolbar.init,{menuItem:"Toolbar",help:"help/toolbar.html",winTitle:"Toolbar",winDims:[JS9.Toolbar.WIDTH,JS9.Toolbar.HEIGHT]}),require=function e(t,s,o){function n(c,d){if(!s[c]){if(!t[c]){var h="function"==typeof require&&require;if(!d&&h)return h(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var g=s[c]={exports:{}};t[c][0].call(g.exports,function(v){return n(t[c][1][v]||v)},g,g.exports,e,t,s,o)}return s[c].exports}for(var a="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({"./imexam":[function(e,t,s){"use strict";var o=e("typed-array-function");(o=(o=o.extend(o,e("typed-array-ops"))).extend(o,e("typed-numeric-uncmin"))).rotate=e("typed-array-rotate"),o.mask=e("./mask.js");var n=e("./template"),a=o;o.zeros=function(p,g){var v,r=1,u=[];for(void 0===g&&(g=Float32Array),v=0;v<p.length;++v)u.push(Math.floor(p[v])),r*=u[v];return o.ndarray(new g(r),u)},o.fill=a(function(h,p){p.apply(void 0,[])}),s.fixupDiv=function(h){if("div"===h.winType){h.outerdivjq.find(".drag-handle").html(h.plugin.opts.winTitle);var p=h.outerdivjq.find(".JS9PluginToolbar-div");p.css("cursor","default"),p.css("right",0)}};var l={};function d(h){switch(h.shape){case"annulus":h.width=2*h.radii[h.radii.length-1],h.height=2*h.radii[h.radii.length-1];break;case"circle":h.width=2*h.radius,h.height=2*h.radius;break;case"ellipse":h.width=2*h.r1,h.height=2*h.r2;break;case"polygon":case"line":var p,g=0,v=0,r=1e6,u=0,f=1e6,m=0;for(p=0;p<h.pts.length;p++)g+=h.pts[p].x,v+=h.pts[p].y,h.pts[p].x>u&&(u=h.pts[p].x),h.pts[p].x<r&&(r=h.pts[p].x),h.pts[p].y>m&&(m=h.pts[p].y),h.pts[p].y<f&&(f=h.pts[p].y);h.x=g/h.pts.length,h.y=v/h.pts.length,"line"===h.shape&&2===h.pts.length?(h.width=Math.sqrt((h.pts[0].x-h.pts[1].x)*(h.pts[0].x-h.pts[1].x)+(h.pts[0].y-h.pts[1].y)*(h.pts[0].y-h.pts[1].y)),h.height=JS9.globalOpts.imexamLineHeight||1,h.angle=Math.atan2(h.pts[1].y-h.pts[0].y,h.pts[1].x-h.pts[0].x),h.angle=180*h.angle/Math.PI):(h.width=u-r,h.height=m-f);break;case"text":h.width=10,h.height=10}return l.mksection(h.x,h.y,h.width,h.height)}o.maxvalue=o.sup,o.minvalue=o.inf,o.size=function(h){var p,g=1;for(p=0;p<h.length;p++)g*=h[p];return g},o.reshape=function(h,p){if(h.size!==o.size(p))throw new Error("sizes not equil "+h.size+" != ",+o.size(p));return o.ndarray(h.data,p)},o.section=function(h,p){var g=p[0][0],v=p[0][1],r=p[1][0],u=p[1][1];return h.lo(r,g).hi(u-r,v-g)},o.print=function(h,p,g){var v,r,u;if(void 0===p&&(p=7),void 0===g&&(g=3),1===h.shape.length){for(u="",v=0;v<h.shape[0];++v)u+=h.get(v).toFixed(g)+" ";console.log(u)}else{for(r=h.shape[0]-1;r>=0;--r){for(u="",v=0;v<h.shape[1];++v)u+=h.get(r,v).toFixed(g)+" ";console.log(u)}console.log("\n")}},o._hist=a(function(h,p,g,v){var r=Math.floor((v-g)/p),u=new Int32Array(r+1);return isNaN(h)||u[0|Math.max(0,Math.min(r,Math.round((h-g)/p)))]++,u}),o.hist=function(h,p,g,v){var u,r={};return void 0===g&&(g=o.minvalue(h)),void 0===v&&(v=o.maxvalue(h)),void 0===p&&(p=Math.max(1,(v-g)/250)),r.raw=h,r.min=g,r.max=v,r.width=p,u=o._hist(h,p,g,v),r.data=o.ndarray(u,[u.length]),r},o.proj=function(h,p){var g,v,r={};r.n=h.shape[1===p?0:1],r.x=h.shape[p],r.sum=[],r.avg=[],r.med=[];var u=o.assign(o.zeros(h.shape),h);for(v=0;v<r.n;v++)g=o.section(u,0===p?[[v,v+1],[0,r.x]]:[[0,r.x],[v,v+1]]),r.sum[v]=o.sum(g),r.avg[v]=o.sum(g)/r.n,r.med[v]=o.median(g);return r},o.qcenter=a(function(h){var r,p=[],g=[],v=Number.MIN_VALUE;p[0]++,p[1]++,g[0]--,g[1]--;var m=+h[-1][-1]+h[-1][0]+h[-1][1]+h[0][-1]+h[0][0]+h[0][1]+h[1][-1]+h[1][0]+h[1][1];return v<m&&(v=m,r=[0,0]),r}),o._imcnts=a({consider:{c:!1}},function(h,p,g){h[g]+=p}),o.imcnts=function(h,p,g){var v={};return v.cnts=o.ndarray(o._imcnts(new Float32Array(g),h,p)),v.area=o.hist(p,1,0,g-1).data,v},o._centroid=a(function(h,p,g){var v=0,r=0,u=0,f=0,m=0;h>0&&0<p*p+g*g&&(v+=h,r+=0*h,f+=0*h*0,u+=0*h,m+=0*h*0);var x={};return x.sum=v,x.cenx=r/v,x.ceny=u/v,x.rmom=(f-r*r/v+m-u*u/v)/v,x.fwhm=x.rmom<=0?-1:2.354*Math.sqrt(x.rmom)/Math.sqrt(2),x}),o.centroid=function(h){return o._centroid(h,h.shape[0],h.shape[1])},o.flatten=function(){var p,g,v,h=0;for(p=0;p<arguments.length;p++)h+=arguments[p].size;var r=o.zeros([h]),u=0;for(g=0;g<arguments.length;g++)o.assign(o.ndarray(r.data,(v=arguments[g]).shape,void 0,u),v),u+=v.size;return r},o.median=function(h){var p=o.assign(o.zeros(h.shape),h);return Array.prototype.sort.call(p.data,function(v,r){return v-r}),p.data[Math.round((p.size-1)/2)]},o.rms=a(function(h){var p=0,g=0;isNaN(h)||(p+=h,g+=h*h);var v=p/h.size;return Math.sqrt((g-2*v*p+h.size*v*v)/(h.size-1))}),o.rmsClipped=a(function(h,p,g){var v=0,r=0,u=0;!isNaN(h)&&(null===p||h>p)&&(null===g||h<g)&&(v++,r+=h,u+=h*h);var f=r/v;return Math.sqrt((u-2*f*r+v*f*f)/(v-1))}),o.meanClipped=a(function(h,p,g){var v=0,r=0;return!isNaN(h)&&(null===p||h>p)&&(null===g||h<g)&&(v++,r+=h),r/v}),l.backgr=function(h,p){var g={},v=o.flatten(o.section(h,[[0,p],[0,h.shape[1]]]),o.section(h,[[h.shape[0]-p,h.shape[0]],[0,h.shape[1]]]),o.section(h,[[p,h.shape[0]-p],[0,p]]),o.section(h,[[p,h.shape[0]-p],[h.shape[1]-p,h.shape[1]]]));return g.noise=o.rms(v),g.value=o.median(v),g},l.mksection=function(h,p,g,v){return[[Math.floor(h-g/2),Math.floor(h+g/2)],[Math.floor(p-v/2),Math.floor(p+v/2)]]},l._rproj=a(function(h,p,g,v,r){var u=new Float32Array(r),f=new Float32Array(r),m=Math.sqrt(v*v),b=0,x=Math.sqrt((0-g)*(0-g)+(0-p)*(0-p));return x<=m&&!isNaN(h)&&(u[b]=x,f[b]=h,b++),{rad:u.subarray(0,b),val:f.subarray(0,b),n:b}}),l.rproj=function(h,p){var g=(h.shape[0]/2+h.shape[1]/2)/2,v=l._rproj(h,p[1],p[0],g,h.size);return function c(h,p){var g;(g=Array.prototype.map.call(h,function(v,r){return[v,r,p[r]]})).sort(function(v,r){return v[0]-r[0]}),g.map(function(v,r){h[r]=v[0],p[r]=v[2]})}(v.rad,v.val),{radi:o.ndarray(v.rad,[v.rad.length]),data:o.ndarray(v.val,[v.rad.length]),radius:g}},l._encen=a(function(h,p,g,v){var b,r=new Float32Array(v),u=0,m=0,x=0-p,y=0-g,S=x*x+y*y;for(h>0&&S<v*v&&(r[Math.round(Math.sqrt(S))]+=h,u+=h),b=0;b<v;b++)r[b]=(m+=r[b])/u;return r}),l.encen=function(h,p){var g=Math.floor((h.shape[0]/2+h.shape[1]/2)/2),v=l._encen(h,p[1],p[0],g);return o.ndarray(v,[v.length])},o.indexof=function(h,p){var g;for(g=0;g<h.shape[0]&&!(p<h.get(g));g++);return 0===g?0:g===h.shape[0]?h.shape[0]:g+(p-h.get(g))/(h.get(g)-h.get(g-1))},o.gauss1d=function(h,p){var g=o.zeros(h.shape),v=p[0],u=p[1],f=p[2];return o.fill(g,function(m){var b=h.data[m]-0;return v*Math.pow(2.71828,-b*b/(2*u*u))+f}),g},o.gsfit1d=function(h,p,g){return a.uncmin(function(r){var u=o.gauss1d(h,r);o.sub(u,u,p),o.mul(u,u,u),o.fill(u,function(m){return u.get(m)/(h.get(m)*h.get(m))});var f=o.sum(u);return Math.sqrt(f/h.shape[0])},g,1e-6).solution},s.getRegionData=function(h,p){var r,g=d(p),v=o.ndarray(h.raw.data,[h.raw.height,h.raw.width]);return p.angle&&0!==p.angle?(r=o.zeros([p.height,p.width]),o.rotate(r,v,p.angle/57.29577951,p.y,p.x)):r=o.section(v,g),r},s.convolve1d=a(function(h,p,g){var v,r,u,f=Math.round(h.shape[0]/2);for(v=0;v<p.shape[0];v++)for(r=0;r<h.shape[0];r++)(u=v+r-f)>=0&&u<p.shape[0]&&(g[v]+=h[r]*p[u])}),s.convolve2dSep=function(h,p,g){var v,r,u,f,m,b=p.shape[1],w=p.shape[0],A=h.shape[0],x=Math.floor(A/2);for(r=0;r<w;r++)for(v=0;v<b;v++)for(g[r][v]=0,u=0;u<A;u++)(f=v+u-x)>0&&f<b&&(g[r][v]+=p[r][f]*h[u]);for(v=0;v<b;v++)for(r=0;r<w;r++)for(u=0;u<A;u++)(m=r+u-x)>0&&m<w&&(g[r][v]+=p[r+u][v]*h[u])},s.reg2section=d,s.template=n,s.ndops=o,s.typed=o,s.imops=l},{"./mask.js":1,"./template":12,"typed-array-function":4,"typed-array-ops":5,"typed-array-rotate":8,"typed-numeric-uncmin":10}],1:[function(e,t,s){"use strict";!function(){var o=e("./raster");function n(a,l){var c;for(c=0;c<a.tags.length;c++)if(a.tags[c]===l)return!0;return!1}s.hasTag=n,s.listRegions=function(a){var l,c,d,h=1,p=[];for(l=0;l<a.length;l++)if("annulus"===(d=a[l]).shape)for(c=0;c<d.radii.length;c++)0!==d.radii[c]&&(p[h-1]=$.extend($.extend({},d),{regno:h++,shape:"circle",radius:d.radii[c]}));else p[h-1]=$.extend({regno:h++},d);return p},s.drawRegions=function(a,l,c){var d,h,p,g=["include","exclude"];for(h=0;h<2;h++)for(p=a.length-1;p>=0;p--)if(n(d=a[p],g[h]))switch(d.shape){case"polygon":o.drawPolygon(l,c,d.pts,d.regno);break;case"circle":o.drawCircle(l,c,d.x,d.y,d.radius,d.regno);break;case"box":o.drawBox(l,c,d.x,d.y,d.width,d.height,d.angle,d.regno);break;case"ellipse":o.drawEllipse(l,c,d.x,d.y,d.r1,d.r2,d.angle,d.regno)}}}()},{"./raster":11}],2:[function(e,t,s){"use strict";var o=e("iota-array"),n=["concat","join","slice","toString","indexOf","lastIndexOf","forEach","every","some","filter","map","reduce","reduceRight"];function a(g,v){return g[0]-v[0]}function l(){var r,g=this.stride,v=new Array(g.length);for(r=0;r<v.length;++r)v[r]=[Math.abs(g[r]),r];v.sort(a);var u=new Array(v.length);for(r=0;r<u.length;++r)u[r]=v[r][1];return u}function c(g,v){var r=["View",v,"d",g].join("");v<0&&(r="View_Nil"+g);var u="generic"===g;if(-1===v){var f="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+g+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(f)()}if(0===v)return f="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+g+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}",new Function("TrivialArray",f)(h[g][0]);f=["'use strict'"];var m=o(v),b=m.map(function(R){return"i"+R}),w="this.offset+"+m.map(function(R){return["this._stride",R,"*i",R].join("")}).join("+");f.push("function "+r+"(a,"+m.map(function(R){return"b"+R}).join(",")+","+m.map(function(R){return"c"+R}).join(",")+",d){this.data=a");for(var A=0;A<v;++A)f.push("this._shape"+A+"=b"+A+"|0");for(A=0;A<v;++A)f.push("this._stride"+A+"=c"+A+"|0");f.push("this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+g+"'","proto.dimension="+v);var S={stride:"VStride"+v+"d"+g,shape:"VShape"+v+"d"+g};for(var _ in S){var C=S[_];f.push("function "+C+"(v) {this._v=v} var aproto="+C+".prototype","aproto.length="+v);var I=[];for(A=0;A<v;++A)I.push(["this._v._",_,A].join(""));for(f.push("aproto.toJSON=function "+C+"_toJSON(){return ["+I.join(",")+"]}","aproto.valueOf=aproto.toString=function "+C+"_toString(){return ["+I.join(",")+"].join()}"),A=0;A<v;++A)f.push(["Object.defineProperty(aproto,",A,",{get:function(){return this._v._",_,A,"},set:function(v){return this._v._",_,A,"=v|0},enumerable:true})"].join(""));for(A=0;A<n.length;++A)n[A]in Array.prototype&&f.push(["aproto.",n[A],"=Array.prototype.",n[A]].join(""));for(f.push(["Object.defineProperty(proto,'",_,"',{get:function ",C,"_get(){return new ",C,"(this)},set: function ",C,"_set(v){"].join("")),A=0;A<v;++A)f.push(["this._",_,A,"=v[",A,"]|0"].join(""));f.push("return v}})")}f.push(["Object.defineProperty(proto,'size',{get:function ",r,"_size(){return ",m.map(function(R){return["this._shape",R].join("")}).join("*"),"}})"].join("")),1===v?f.push("proto.order=[0]"):(f.push("Object.defineProperty(proto,'order',{get:"),v<4?(f.push(["function ",r,"_order(){"].join("")),2===v?f.push("return (Math.abs(this._stride0)>Math.abs(this._stride1))?[1,0]:[0,1]}})"):3===v&&f.push("var s0=Math.abs(this._stride0),s1=Math.abs(this._stride1),s2=Math.abs(this._stride2);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):f.push("ORDER})")),f.push(["proto.set=function ",r,"_set(",b.join(","),",v){"].join("")),f.push(u?["return this.data.set(",w,",v)}"].join(""):["return this.data[",w,"]=v}"].join("")),f.push(["proto.get=function ",r,"_get(",b.join(","),"){"].join("")),f.push(u?["return this.data.get(",w,")}"].join(""):["return this.data[",w,"]}"].join("")),f.push(["proto.index=function ",r,"_index(",b.join(),"){return ",w,"}"].join("")),f.push(["proto.hi=function ",r,"_hi(",b.join(","),"){return new ",r,"(this.data,",m.map(function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this._shape",R,":i",R,"|0"].join("")}).join(","),",",m.map(function(R){return"this._stride"+R}).join(","),",this.offset)}"].join(""));var L=m.map(function(R){return"a"+R+"=this._shape"+R}),D=m.map(function(R){return"c"+R+"=this._stride"+R});for(f.push(["proto.lo=function ",r,"_lo(",b.join(","),"){var b=this.offset,d=0,",L.join(","),",",D.join(",")].join("")),A=0;A<v;++A)f.push(["if(typeof i",A,"==='number'&&i",A,">=0){d=i",A,"|0;b+=c",A,"*d;a",A,"-=d}"].join(""));for(f.push(["return new ",r,"(this.data,",m.map(function(R){return"a"+R}).join(","),",",m.map(function(R){return"c"+R}).join(","),",b)}"].join("")),f.push(["proto.step=function ",r,"_step(",b.join(","),"){var ",m.map(function(R){return"a"+R+"=this._shape"+R}).join(","),",",m.map(function(R){return"b"+R+"=this._stride"+R}).join(","),",c=this.offset,d=0,ceil=Math.ceil"].join("")),A=0;A<v;++A)f.push(["if(typeof i",A,"==='number'){d=i",A,"|0;if(d<0){c+=b",A,"*(a",A,"-1);a",A,"=ceil(-a",A,"/d)}else{a",A,"=ceil(a",A,"/d)}b",A,"*=d}"].join(""));f.push(["return new ",r,"(this.data,",m.map(function(R){return"a"+R}).join(","),",",m.map(function(R){return"b"+R}).join(","),",c)}"].join(""));var O=new Array(v),M=new Array(v);for(A=0;A<v;++A)O[A]=["a[i",A,"]"].join(""),M[A]=["b[i",A,"]"].join("");for(f.push(["proto.transpose=function ",r,"_transpose(",b,"){",b.map(function(R,H){return R+"=("+R+"===undefined?"+H+":"+R+"|0)"}).join(";"),";var a=this.shape,b=this.stride;return new ",r,"(this.data,",O.join(","),",",M.join(","),",this.offset)}"].join("")),f.push(["proto.pick=function ",r,"_pick(",b,"){var a=[],b=[],c=this.offset"].join("")),A=0;A<v;++A)f.push(["if(typeof i",A,"==='number'&&i",A,">=0){c=(c+this._stride",A,"*i",A,")|0}else{a.push(this._shape",A,");b.push(this._stride",A,")}"].join(""));return f.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),f.push(["return function construct_",r,"(data,shape,stride,offset){return new ",r,"(data,",m.map(function(R){return"shape["+R+"]"}).join(","),",",m.map(function(R){return"stride["+R+"]"}).join(","),",offset)}"].join("")),new Function("CTOR_LIST","ORDER",f.join("\n"))(h[g],l)}var h={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],generic:[]};t.exports=function p(g,v,r,u){if(void 0===g)return(0,h.array[0])([]);"number"==typeof g&&(g=[g]),void 0===v&&(v=[g.length]);var f=v.length;if(void 0===r){r=new Array(f);for(var m=f-1,b=1;m>=0;--m)r[m]=b,b*=v[m]}if(void 0===u)for(u=0,m=0;m<f;++m)r[m]<0&&(u-=(v[m]-1)*r[m]);for(var w=function d(g){return g instanceof Float64Array?"float64":g instanceof Float32Array?"float32":g instanceof Int32Array?"int32":g instanceof Uint32Array?"uint32":g instanceof Uint8Array?"uint8":g instanceof Uint16Array?"uint16":g instanceof Int16Array?"int16":g instanceof Int8Array?"int8":g instanceof Uint8ClampedArray?"uint8_clamped":g instanceof Array?"array":"generic"}(g),A=h[w];A.length<=f+1;)A.push(c(w,A.length-1));return(0,A[f+1])(g,v,r,u)}},{"iota-array":3}],3:[function(e,t,s){"use strict";t.exports=function o(n){for(var a=new Array(n),l=0;l<n;++l)a[l]=l;return a}},{}],4:[function(e,t,s){"use strict";!function(){var o=e("ndarray-nobuffer"),n={int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,float32:Float32Array,float64:Float64Array};function a(A){if(A.shape)return A.shape;for(var x=[];"object"==typeof A;)x.push(A.length),A=A[0];return x}function l(A,x,y){void 0===x&&(x=0),void 0===y&&(y=0);var C,S=A[y],_=[];if(y===A.length-1){for(C=S-2;C>=0;C-=2)_[C+1]=x,_[C]=x;return-1===C&&(_[0]=x),_}for(C=S-1;C>=0;C--)_[C]=l(A,x,y+1);return _}function c(A,x){if(x<1)return"";for(var y="";x>0;)1&x&&(y+=A),x>>=1,A+=A;return y}function d(A,x){for(var _,C,I,D,y="",S=-1,L=0;L<A.length&&(_=A.match(/[a-zA-Z_][a-zA-Z0-9_]*/));){for(y+=A.substr(L,_.index),C=[],L=_.index+_[0].length,D=!0;D&&L<A.length;){for(;" "===A[L];)L++;switch(A[L]){case"[":for(S=1,I=L+1,L++;S;)"]"===A[L]&&(1===S&&C.push(A.substring(I,L)),S--),"["===A[L]&&S++,L++;break;case".":for(I=L,L++;" "===A[L];)L++;for(;null!==A[L].match(/[ a-zA-Z0-9_]/);)L++;C.push(A.substring(I,L));break;default:D=!1}}y+=x(_[0],C),A=A.substr(L),L=0}return y+A.substr(L)}function h(){var x,y,S,_,I,A=arguments,C={};if(void 0===this.cache){_="string"==typeof this.func?this.func:this.func.toString(),this.text=_;var L=_.match(/function [A-Za-z0-9_]*\(([^()]*)\)[^{]*\{([\S\s]*)\}[\S\s]*/);S=L[1].split(",").map(function(Q){return Q.trim()}),this.args=S,this.prep="",this.post="",(I=L[2].split(/\/\/ ----+/)).length>1?(this.prep=I[0],this.post=I[2],this.body=I[1]):this.body=I[0],(""===this.post||void 0===this.post)&&(this.post="\nreturn "+S[0]+";")}S=this.args,_=this.text;var D=this.opts;void 0===D&&(D={});var E,O="",M=0;for(x=0;x<S.length;x++)null!=A[x]&&"object"==typeof A[x]&&(void 0===D.consider||"object"==typeof D.consider&&!1!==D.consider[S[x]])?(C[S[x]]=A[x],A[x].shape||(A[x].shape=a(A[x])),M=Math.max(A[x].shape.length,M),O+=A[x].data?" "+A[x].dtype+" "+A[x].offset+"  "+A[x].stride:" O"):O+=" X";if(O=M+O,this.cache&&(E=this.cache[O]))return E;var R=this.prep,H=this.post,N=[],B=["iW","iV","iU","iZ","iY","iX"],P=!1;function z(Q){return d(Q,function(de,xe){var ce,he,Pe;for("index"===de&&(P=!0),ce=0;ce<xe.length;ce++)xe[ce]=z(xe[ce]);var Y,ie,be,ke,Se=C[de];if(void 0!==Se&&"object"==typeof Se)if(xe.length>=1&&".length"===xe[xe.length-1].trim()&&(xe[0]=".shape",xe[1]=xe.length-1,xe.length=2),xe.length>=1&&"."===xe[0][0])Pe=xe.length>=2&&".shape"===xe[0].trim()?Se.data?de+".shape["+xe[1]+"]":de+c("[0]",xe[1])+".length":de+xe[0].trim();else{Se.data?(Y=Se.dimension,0!==xe.length&&xe.length<Se.dimension?(de+=".data.subarray",be="()",ke=xe.length):(de+=".data",be="[]",ke=Se.dimension),ie=" + "):(Y=Se.shape.length,ie="][",he="",be="[]");var Ee=B.slice(6-Y);if(!(void 0!==D.loops&&!0!==D.loops||0!==xe.length&&Y!==xe.length))for(x=0;x<Y;x++)void 0===xe[x]&&(xe[x]=Ee[x]),void 0===N[x]&&(N[x]=0),N[x]=Math.max(N[x],Se.shape[x]);if(Se.data){for(x=0;x<ke;x++)1!==Se.stride[x]&&(xe[x]="("+xe[x]+")*"+Se.stride[x]);he=0!==Se.offset?Se.offset+" + ":""}Pe=xe.length?de+be[0]+he+xe.join(ie)+be[1]+" ":de}else{for(Pe=de,x=0;x<xe.length;x++)Pe+="."===xe[x][0]?xe[x].trim():"["+xe[x].trim()+"]";Pe+=" "}return Pe})}I=z(I=this.body);var J=B.slice(6-N.length),q=B.slice(6-N.length).reverse();N.reverse();var G="\n",ee="\n",le="",te="";if(void 0===D.loops||!0===D.loops){for(G+="\tvar index = ["+l([N.length],0).join(",")+"];\n",G+="\tvar start = ["+l([N.length],0).join(",")+"];\n",G+="\tvar   end = ["+l([N.length],0).join(",")+"];\n\n",x=0;x<N.length;x++)for(y=0;y<S.length;y++)if(C[S[y]]&&void 0!==A[y]&&"object"==typeof A[y]){G+="\tend["+x+"] = "+S[y]+".shape["+x+"];\n";break}for(G+="\n",x=0;x<N.length;x++)ee+="\tvar "+J[x]+"start = start["+x+"];\n",ee+="\tvar   "+J[x]+"end =   end["+x+"];\n";for(ee+="\n",x=0;x<N.length;x++)P&&(le="index["+(N.length-x-1)+"] = 0;\n",te="\tindex["+(N.length-x-1)+"]++\n"),I=le+"for ( var "+q[x]+" = "+q[x]+"start; "+q[x]+" < "+q[x]+"end; "+q[x]+"++ ) {\n\t"+I+"\n"+te+"\n    }"}return E="// Array optimized funciton\n",E+="// "+O+"\n",E+="return function ("+S.join(",")+") {\n'use strict';\n\n"+G+R+ee+I+H+"\n}",g.debug&&console.log(E),void 0===this.cache&&(this.cache={}),E=new Function(E)(),this.cache[O]=E,E}function p(){var A=h.apply(this,arguments),x=A.apply(g,arguments);return x}function g(A,x){void 0===x&&(x=A,A=void 0);var y={func:x,opts:A},S=p.bind(y);return S.baked=h.bind(y),S}var v=g(function(A){return 1*A});t.exports=g,t.exports.ndarray=o,t.exports.section=function w(A,x){var y=x[0][0],S=x[0][1],_=x[1][0],C=x[1][1];return A.lo(_,y).hi(C-_,S-y)},t.exports.extend=function m(A){var x,y;for(x=1;x<arguments.length;x++)for(y in arguments[x])arguments[x].hasOwnProperty(y)&&(A[y]=arguments[x][y]);return A},t.exports.array=function r(A,x,y){var S,_,C;if("number"!=typeof y&&(y=0),x&&x.dtype&&(x=x.dtype),"string"==typeof x&&(x=n[x]),"function"==typeof x)for(C=v(A),S=o(new x(C),A),_=0;_<C;_++)S.data[_]=y;else S=l(A,y);return S.shape=A,S},t.exports.clone=function u(A){return g.assign(g.array(g.dim(A),A),A)},t.exports.print=function b(A,x,y){var S,_,C;if(void 0===x&&(x=7),void 0===y&&(y=3),1===A.shape.length){for(C="",S=0;S<A.shape[0];++S)C+=A.get(S).toFixed(y)+" ";console.log(C)}else{for(_=A.shape[0]-1;_>=0;--_){for(C="",S=0;S<A.shape[1];++S)C+=A.get(_,S).toFixed(y)+" ";console.log(C)}console.log("\n")}},t.exports.iota=function f(A,x){void 0===x&&(x=A,A=0);var y,S=[];for(y=0;y<x;y++)S[y]=A,A+=1;return S},t.exports.rep=l,t.exports.dim=a,t.exports.epsilon=2220446049250313e-31}()},{"ndarray-nobuffer":2}],5:[function(e,t,s){"use strict";!function(){var o,l,c,n=e("typed-array-function"),a={};function d(w){var A,x;return function(S,_,C){return void 0===C&&(A=n.dim(S),x=n.dim(_),C=_,S=n.array(A.length>x.length?A:x,_=S)),w(S,_,C)}}function h(w){return function(A,x){return void 0===x&&(A=n.array(n.dim(x=A),x)),w(A,x)}}function p(w){return function(A,x,y){return void 0===y?d(w.baked(A,x,y)):w.baked(A,x,y)}}function g(w){return function(A,x){return void 0===x?h(w.baked(A,x)):w.baked(A,x)}}t.exports=a;var v={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};for(l in v)v.hasOwnProperty(l)&&(a[l+"3"]=n("function (a, b, c)    {            a = b "+(c=v[l])+" c; }"),a[l+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = b "+c+" c; } }"),a[l+"eq"]=n("function (a, b   )    {            a "+c+"= b;    }  "),a[l+"eq_mask"]=n("function (a, b   , m) { if ( m ) { a "+c+"= b;    } }"),a[l]=d(a[l+"3"]),a[l].baked=p(a[l+"3"]),a[l+"s"]=a[l],a[l+"seq"]=a[l+"eq"]);var r={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};for(l in r)r.hasOwnProperty(l)&&(a[l+"3"]=n("function (a, b, c)    {            a = b "+(c=r[l])+" c; }"),a[l+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = b "+c+" c; } }"),a[l+"eq"]=n("function (a, b   )    {            a = a "+c+" b; }  "),a[l+"eq_mask"]=n("function (a, b   , m) { if ( m ) { a = a "+c+" b; } }"),a[l]=d(a[l+"3"]),a[l].baked=p(a[l+"3"]),a[l+"s"]=a[l],a[l+"seq"]=a[l+"eq"]);var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};for(l in u)u.hasOwnProperty(l)&&(a[l+"2"]=n("function (a, b   )    {            a = "+(c=u[l])+" b; }"),a[l+"_mask"]=n("function (a, b   , m) { if ( m ) { a = "+c+" b; } }"),a[l+"eq"]=n("function (a      )    {            a = "+c+" a; }"),a[l+"eq_mask"]=n("function (a      , m) { if ( m ) { a = "+c+" a; } }"),a[l]=h(a[l+"2"]),a[l].baked=g(a[l+"2"]));var f=["Math.abs","Math.exp","Math.floor","Math.log","Math.round","Math.sqrt","Math.acos","Math.asin","Math.atan","Math.ceil","Math.cos","Math.sin","Math.tan","isFinite","isNaN"];for(o=0;o<f.length;o++)l=(c=f[o]).split("."),a[(l=2==l.length?l[1]:l[0])+"2"]=n("function (a, b   )    {            a = "+c+"(b); }"),a[l+"_mask"]=n("function (a, b   , m) { if ( m ) { a = "+c+"(b); } }"),a[l+"eq"]=n("function (a      )    {            a = "+c+"(a); }"),a[l+"eq_mask"]=n("function (a      , m) { if ( m ) { a = "+c+"(a); } }"),a[l]=h(a[l+"2"]),a[l].baked=g(a[l+"2"]);var m=["max","min"];for(o=0;o<m.length;o++)l=c=m[o],a[l+"3"]=n("function (a, b, c)    {            a = Math."+c+"(b, c); }"),a[l+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = Math."+c+"(b, c); } }"),a[l]=d(a[l+"3"]),a[l].baked=p(a[l+"3"]),a[l+"s"]=a[l],a[l+"seq"]=a[l];var b=["atan2","pow"];for(o=0;o<b.length;o++)l=c=b[o],a[l+"3"]=n("function (a, b, c)    {            a = Math."+c+"(b, c); }"),a[l+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = Math."+c+"(b, c); } }"),a[l]=d(a[l+"3"]),a[l].baked=p(a[l+"3"]),a[l+"s"]=a[l],a[l+"seq"]=a[l];a.assign=n(function(w,A){}),a.equals=n(function(w,A){if(w!==A)return!1}),a.any=n(function(w){if(w)return!0}),a.all=n(function(w){if(!w)return!1}),a.random=n(function(w){Math.random()}),a.sum=n(function(w){return 0+w}),a.prod=n(function(w){return 1*w}),a.inf=n(function(w){var A=1/0;return w<A&&(A=w),A}),a.sup=n(function(w){var A=-1/0;return w>A&&(A=w),A}),a.norm2Squared=n(function(w){return 0+w*w}),a.norm2=function(w){return Math.sqrt(a.norm2Squared(w))}}()},{"typed-array-function":4}],6:[function(e,t,s){"use strict";function o(d,h){var p=Math.floor(h),g=h-p,r=0<=p+1&&p+1<d.shape[0];return(1-g)*(0<=p&&p<d.shape[0]?+d.get(p):0)+g*(r?+d.get(p+1):0)}function n(d,h,p){var g=Math.floor(h),v=h-g,r=0<=g&&g<d.shape[0],u=0<=g+1&&g+1<d.shape[0],f=Math.floor(p),m=p-f,b=0<=f&&f<d.shape[1],w=0<=f+1&&f+1<d.shape[1],A=r&&b?d.get(g,f):0,x=r&&w?d.get(g,f+1):0;return(1-m)*((1-v)*A+v*(u&&b?d.get(g+1,f):0))+m*((1-v)*x+v*(u&&w?d.get(g+1,f+1):0))}function a(d,h,p,g){var v=Math.floor(h),r=h-v,u=0<=v&&v<d.shape[0],f=0<=v+1&&v+1<d.shape[0],m=Math.floor(p),b=p-m,w=0<=m&&m<d.shape[1],A=0<=m+1&&m+1<d.shape[1],x=Math.floor(g),y=g-x,S=0<=x&&x<d.shape[2],_=0<=x+1&&x+1<d.shape[2],C=u&&w&&S?d.get(v,m,x):0,I=u&&A&&S?d.get(v,m+1,x):0,L=f&&w&&S?d.get(v+1,m,x):0,D=f&&A&&S?d.get(v+1,m+1,x):0,O=u&&w&&_?d.get(v,m,x+1):0,M=u&&A&&_?d.get(v,m+1,x+1):0;return(1-y)*((1-b)*((1-r)*C+r*L)+b*((1-r)*I+r*D))+y*((1-b)*((1-r)*O+r*(f&&w&&_?d.get(v+1,m,x+1):0))+b*((1-r)*M+r*(f&&A&&_?d.get(v+1,m+1,x+1):0)))}function l(d){var u,f,h=0|d.shape.length,p=new Array(h),g=new Array(h),v=new Array(h),r=new Array(h);for(u=0;u<h;++u)f=+arguments[u+1],p[u]=Math.floor(f),g[u]=f-p[u],v[u]=0<=p[u]&&p[u]<d.shape[u],r[u]=0<=p[u]+1&&p[u]+1<d.shape[u];var b,w,A,m=0;e:for(u=0;u<1<<h;++u){for(w=1,A=d.offset,b=0;b<h;++b)if(u&1<<b){if(!r[b])continue e;w*=g[b],A+=d.stride[b]*(p[b]+1)}else{if(!v[b])continue e;w*=1-g[b],A+=d.stride[b]*p[b]}m+=w*d.data[A]}return m}t.exports=function c(d,h,p,g){switch(d.shape.length){case 0:return 0;case 1:return o(d,h);case 2:return n(d,h,p);case 3:return a(d,h,p,g);default:return l.apply(void 0,arguments)}},t.exports.d1=o,t.exports.d2=n,t.exports.d3=a},{}],7:[function(e,t,s){"use strict";var o=e("ndarray-linear-interpolate"),n=e("typed-array-function"),a=n(function(h,p,g){var v=h.shape.slice(0);p(v,[0,0,0]),h=g.apply(void 0,v)}),l=n(function(h,p,g,v){var r=[0],u=v;p(r,[0]),g(u,r[0])}),c=n(function(h,p,g,v){var r=[0,0],u=v;p(r,[0,0]),g(u,r[0],r[1])}),d=n(function(h,p,g,v){var r=[0,0,0],u=v;p(r,[0,0,0]),g(u,r[0],r[1],r[2])});t.exports=function(p,g,v){switch(g.shape.length){case 1:l(p,v,o.d1,g);break;case 2:c(p,v,o.d2,g);break;case 3:d(p,v,o.d3,g);break;default:a(p,v,o.bind(void 0,g))}return p}},{"ndarray-linear-interpolate":6,"typed-array-function":4}],8:[function(e,t,s){"use strict";var o=e("typed-array-warp");t.exports=function n(a,l,c,d,h,p,g){var v=Math.cos(c),r=Math.sin(-c),u=(d=d||l.shape[0]/2)-v*(p=p||a.shape[0]/2)+r*(g=g||a.shape[1]/2),f=(h=h||l.shape[1]/2)-r*p-v*g;return o(a,l,function(m,b){m[0]=v*b[0]-r*b[1]+u,m[1]=r*b[0]+v*b[1]+f}),a}},{"typed-array-warp":7}],9:[function(e,t,s){"use strict";var o=e("typed-array-function"),n=o;o.dot=function(l,c){var d=n.dim,h=d(l),p=d(c);switch(1e3*d(l).length+d(c).length){case 2002:return n.dotMM(n.array([h[0],p[1]],l.dtype),l,c);case 2001:return n.dotMV(l,c);case 1002:return n.dotVM(l,c);case 1001:return n.dotVV(l,c);case 1e3:return n.mulVS(l,c);case 1:return n.mulSV(l,c);case 0:return l*c;default:throw new Error("numeric.dot only works on vectors and matrices")}},n.dotVV=function(l,c){var d,p,h=l.length,g=l[h-1]*c[h-1];for(d=h-2;d>=1;d-=2)g+=l[d]*c[d]+l[p=d-1]*c[p];return 0===d&&(g+=l[0]*c[0]),g},n.dotMV=function(l,c){var d,h=l.length,p=this.array([h],l.dtype),g=this.dotVV;for(d=h-1;d>=0;d--)p[d]=g(l[d],c);return p},n.dotVM=function(l,c){var d,h,p,g,v,r,u;for(p=l.length,v=n.array([g=c[0].length],l.dtype),h=g-1;h>=0;h--){for(r=l[p-1]*c[p-1][h],d=p-2;d>=1;d-=2)r+=l[d]*c[d][h]+l[u=d-1]*c[u][h];0===d&&(r+=l[0]*c[0][h]),v[h]=r}return v},n.dotMM=function(l,c,d){var h,p,g,r,u,f,m,v=l.shape[1],w=d.length;for(h=c.length-1;h>=0;h--)for(r=l[h],u=c[h],g=v-1;g>=0;g--){for(f=u[w-1]*d[w-1][g],p=w-2;p>=1;p-=2)f+=u[p]*d[p][g]+u[m=p-1]*d[m][g];0===p&&(f+=u[0]*d[0][g]),r[g]=f}},n.diag=function(l){var c,d,h,v,p=l.length,g=this.array([p,p],l.dtype);for(c=p-1;c>=0;c--){for(v=g[c],d=c+2,h=p-1;h>=d;h-=2)v[h]=0,v[h-1]=0;for(h>c&&(v[h]=0),v[c]=l[c],h=c-1;h>=1;h-=2)v[h]=0,v[h-1]=0;0===h&&(v[0]=0)}return g},n.identity=function(l,c){return this.diag(this.array([l],c,1))},n.tensorXX=function(l,c,d){var g,v,r,u,p=d.length;for(v=c.length-1;v>=0;v--){for(g=l[v],u=c[v],r=p-1;r>=3;--r)g[r]=u*d[r],g[--r]=u*d[r],g[--r]=u*d[r],g[--r]=u*d[r];for(;r>=0;)g[r]=u*d[r],--r}},n.tensorXX=o({loops:!1},n.tensorXX),n.tensor=function(l,c){if("number"==typeof l||"number"==typeof c)return n.mul(l,c);var d=n.dim(l),h=n.dim(c);if(1!==d.length||1!==h.length)throw new Error("numeric: tensor product is only defined for vectors");return n.tensorXX(n.array([d[0],h[0]],l.dtype),l,c)},n.dotVV=o({loops:!1},n.dotVV),n.dotVM=o({loops:!1},n.dotVM),n.dotMV=o({loops:!1},n.dotMV),n.dotMM=o({loops:!1},n.dotMM),n.diag=o({loops:!1},n.diag)},{"typed-array-function":4}],10:[function(e,t,s){var o=e("typed-array-function");o=(o=o.extend(o,e("typed-array-ops"))).extend(o,e("typed-matrix-ops")),s.gradient=function(a,l){var c=l.length,d=a(l);if(isNaN(d))throw new Error("gradient: f(x) is a NaN!");var h,g,v,x,y,S,C,I,L,p=o.clone(l),r=Array(c),m=Math.max,w=Math.abs,A=Math.min,_=0;for(h=0;h<c;h++)for(var D=m(1e-6*d,1e-8);;){if(++_>20)throw new Error("Numerical gradient fails");if(p[h]=l[h]+D,g=a(p),p[h]=l[h]-D,v=a(p),p[h]=l[h],isNaN(g)||isNaN(v))D/=16;else{if(r[h]=(g-v)/(2*D),x=l[h]-D,y=l[h],S=l[h]+D,C=(g-d)/D,I=(d-v)/D,L=m(w(r[h]),w(d),w(g),w(v),w(x),w(y),w(S),1e-8),!(A(m(w(C-r[h]),w(I-r[h]),w(C-I))/L,D/L)>.001))break;D/=16}}return r},s.uncmin=function(a,l,c,d,h,p,g){var v=s.gradient;typeof g>"u"&&(g={}),typeof c>"u"&&(c=1e-8),typeof d>"u"&&(d=function(ce){return v(a,ce)}),typeof h>"u"&&(h=1e3);var f,m,r=(l=o.clone(l)).length,u=a(l);if(isNaN(u))throw new Error("uncmin: f(x0) is a NaN!");var b=Math.max,w=o.norm2;c=b(c,o.epsilon);var A,x,y,B,P,z,J,G,le,te,S=g.Hinv||o.identity(r),_=o.dot,C=o.sub,I=o.add,L=o.tensor,D=o.div,O=o.mul,M=o.all,E=o.isFinite,R=o.neg,H=0,xe="";for(x=d(l);H<h;){if("function"==typeof p&&p(H,l,u,x,S)){xe="Callback returned true";break}if(!M(E(x))){xe="Gradient has Infinity or NaN";break}if(!M(E(A=R(_(S,x))))){xe="Search direction has Infinity or NaN";break}if((te=w(A))<c){xe="Newton step smaller than tol";break}for(le=1,m=_(x,A),P=l;H<h&&!(le*te<c)&&(P=I(l,B=O(A,le)),(f=a(P))-u>=.1*le*m||isNaN(f));)le*=.5,++H;if(le*te<c){xe="Line search step size smaller than tol";break}if(H===h){xe="maxit reached during line search";break}G=_(z=C(y=d(P),x),B),J=_(S,z),S=C(I(S,O((G+_(z,J))/(G*G),L(B,B))),D(I(L(J,B),L(B,J)),G)),l=P,u=f,x=y,++H}return{solution:l,f:u,gradient:x,invHessian:S,iterations:H,message:xe}}},{"typed-array-function":4,"typed-array-ops":5,"typed-matrix-ops":9}],11:[function(e,t,s){"use strict";!function(){function o(p,g,v,r,u,f,m){v<0&&(v=0),r>g&&(r=g);var w,b=v+u*g;switch(m){case void 0:case"set":for(w=v;w<r;w++)p[b++]=f;break;case"add":for(w=v;w<r;w++)p[b++]+=f}}function n(p,g,v,r,u,f){var m,b,w;g>r&&(b=g,g=r,r=b,m=p,p=v,v=m),g=Math.floor(g)+1,m=p;var A=(v-p)/((r=Math.floor(r))-g),x=Math.round(g-u);for(b=g;b<=r;b++)w=Math.floor(m)+1,f[x].minx>w&&(f[x].minx=w),f[x].maxx<w&&(f[x].maxx=w),m+=A,x++}function a(p,g,v,r,u){var f,m=v[0].y-1,b=v[0].y-1;for(f=1;f<v.length;f++)v[f].y-1<m&&(m=v[f].y-1),v[f].y-1>b&&(b=v[f].y-1);var w=b-m,A=[];for(f=0;f<=w+1;f++)A.push({minx:1e6,maxx:-1e6});for(f=0;f<v.length-1;f++)n(v[f].x-1,v[f].y-1,v[f+1].x-1,v[f+1].y-1,m,A);for(n(v[f].x-1,v[f].y-1,v[0].x-1,v[0].y-1,m,A),f=0;f<A.length;f++)o(p,g,Math.floor(A[f].minx),Math.floor(A[f].maxx),Math.floor(f+m),r,u)}function c(p,g,v){var f,m=[];g=function l(p){return p*(Math.PI/180)}(g);var b=Math.sin(g),w=Math.cos(g);for(f=0;f<p.length;f++)m.push({x:v.x+((p[f].x-v.x)*w-(p[f].y-v.y)*b),y:v.y+((p[f].x-v.x)*b+(p[f].y-v.y)*w)});return m}function d(p,g,v,r){var u,f,m,b=[];for(m=0;m<2*Math.PI;m+=.01)u=p+v*Math.cos(m),f=g+r*Math.sin(m),b.push({x:u,y:f});return b}s.drawPolygon=function(p,g,v,r,u){a(p,g,v,r,u)},s.drawCircle=function(p,g,v,r,u,f,m){a(p,g,d(v,r,u,u),f,m)},s.drawEllipse=function(p,g,v,r,u,f,m,b,w){a(p,g,c(d(v,r,u,f),m,{x:v,y:r}),b,w)},s.drawBox=function(p,g,v,r,u,f,m,b,w){a(p,g,c(function h(p,g,v,r){return[{x:p-v/2,y:g-r/2},{x:p-v/2,y:g+r/2},{x:p+v/2,y:g+r/2},{x:p+v/2,y:g-r/2}]}(v,r,u,f),m,{x:v,y:r}),b,w)}}()},{}],12:[function(e,t,s){"use strict";function o(a,l){var c,d="";for(c=0;c<l;c++)d+=a;return d}t.exports=function n(a,l){return a.replace(/\{([a-zA-Z0-9_.%]*)\}/g,function(c,d){var h,p,g,v,r,u=l;for(v=(d=d.split("%")).length<=1?"%s":d[1],d=(d=d[0]).split("."),r=0;r<d.length;r++){if(!u.hasOwnProperty(d[r]))return"";u=u[d[r]]}switch(h=v.substring(v.length-1),g=0|(p=(p=v.substring(0,v.length-1)).split("."))[0],p=0|p[1],h){case"s":u=u.toString();break;case"f":u=u.toFixed(p);break;case"d":u=u.toFixed(0)}return 0!==g&&g>u.length&&(g>0?u=o(" ",g-u.length)+u:u+=o(" ",g-u.length)),u})}},{}]},{},[]),function(){var e=require("./imexam");JS9.RegisterPlugin("ImExam","EncEnergy",function o(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see encircled energy<br>")},{menu:"analysis",menuItem:"Encircled Energy",winTitle:"Encircled Energy",help:"imexam/imexam.html#enener",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function s(n,a){var l=this.div,c=e.getRegionData(n,a),d=e.imops.backgr(c,4).value,h=e.ndops.assign(e.ndops.zeros(c.shape),c);e.ndops.subs(h,c,d);var p=e.ndops.qcenter(h),g=e.ndops.centroid(h,p),v=e.imops.encen(h,[g.ceny,g.cenx]),r={};r.ee80=e.ndops.indexof(v,.8),r.ee50=e.ndops.indexof(v,.5);var f,u=[];for(f=0;f<v.shape[0];f++)u[f]=[f,v.get(f)];$(l).empty(),$.plot(l,[u],{selection:{mode:"xy"}}),$(l).append(e.template(" \t\t\t\t\t\t    \t<div style='position:absolute;right: 10px;bottom:50px'>\t\t        <table>\t\t\t\t\t\t\t\t\t    <tr><td>ee50</td><td align=right>{ee50%.2f}</td><tr>\t\t    <tr><td>ee80</td><td align=right>{ee80%.2f}</td><tr>\t        </table>\t\t\t\t\t\t\t\t</div>",r))},winDims:[250,250]})}(),function(){var e=require("./imexam");function t(a,l,c){var d,h=new RegExp(c,"g"),p="";for(d=0;d<l;d++)p+=a.replace(h,d);return p}function o(a,l){var p,g,c=e.ndops.ndarray(a.raw.data,[a.raw.height,a.raw.width]),d=0,h=0,v=$(this.div).find(".pxtabl")[0];for(v["cell"+h+"."+d].value="col\\row",h=0,d=1;d<10;d++)v["cell"+h+"."+d].value=(p=l.x+d-5)>0&&p<=a.raw.width?p.toFixed(0):"";for(d=0,h=1;h<10;h++)v["cell"+(10-h)+"."+d].value=(g=l.y+h-5)>0&&g<=a.raw.height?g.toFixed(0):"";for(h=1;h<10;h++)for(d=1;d<10;d++)g=l.y+h-5-.5|0,v["cell"+(10-h)+"."+d].value=(p=l.x+d-5-.5|0)>=0&&p<a.raw.width&&g>=0&&g<a.raw.height?c.get(g,p).toPrecision(4):""}JS9.RegisterPlugin("ImExam","PxTabl",function n(){e.fixupDiv(this),$(this.div).html("<form class=pxtabl>"+function s(a,l){var c="<table cellpadding=0 cellspacing=0>";return(c+=t("<tr>"+t("<td ><input class='col%x row%y' type=entry size=6 name=cell%y.%x value=0></td>",a,"%x")+"</tr>\n",l,"%y"))+"</table>"}(10,10)+"</form>"),$(this.div).find(".row5").css("background","lightblue"),$(this.div).find(".col5").css("background","lightblue"),$(this.div).find(":input").css("font-size","11")},{menu:"view",menuItem:"Pixel Table",winTitle:"Pixel Table",winResize:!0,toolbarSeparate:!0,onmousemove:o,onarrowkey:o,winDims:[625,240]})}(),function(){var e=require("./imexam");JS9.RegisterPlugin("ImExam","RadialProj",function o(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see radial projection<br>")},{menu:"analysis",menuItem:"Radial Proj",winTitle:"Radial Proj",help:"imexam/imexam.html#r_proj",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function s(n,a){var l=this.div,c=e.getRegionData(n,a),d=e.ndops.maxvalue(c),h=e.imops.backgr(c,4).value,p=e.ndops.assign(e.ndops.zeros(c.shape),c);e.ndops.subs(p,c,h);var w,g=e.ndops.qcenter(p),v=e.ndops.centroid(p,g),r=e.imops.rproj(c,[v.ceny,v.cenx]),u=e.ndops.gsfit1d(r.radi,r.data,[d,v.fwhm/2.355,h]),f={a:u[0],b:0,c:u[1],d:u[2]},m=[],b=[];for(w=0;w<r.radi.shape[0];w++)m[w]=[r.radi.get(w),r.data.get(w)];for(r.samp=e.ndops.zeros([l.offsetWidth/2]),e.ndops.fill(r.samp,function(x){return r.radius*x/(l.offsetWidth/2)}),r.modl=e.ndops.gauss1d(r.samp,u),w=0;w<r.modl.shape[0];w++)b[w]=[r.samp.get(w),r.modl.get(w)];$(l).empty(),$.plot(l,[{data:m,points:{radius:1,show:!0}},{data:b}],{zoomStack:!0,selection:{mode:"xy"}}),$(l).append(e.template("<div style='position:absolute;right: 10px;top:30px'>                     <table>                                     <tr><td>peak        </td><td align=right>{a%.2f}</td><tr>                                     <tr><td>sigma       </td><td align=right>{c%.2f}</td><tr>                                     <tr><td>bias        </td><td align=right>{d%.2f}</td><tr>                     </table>                     </div>",f))},winDims:[250,250]})}(),function(){var e=require("./imexam");function s(a,l,c){var p=l.getAxes(),g=p.xaxis.options.min,v=p.xaxis.options.max,u=$(a).data("hist").raw,f=e.ndops.rmsClipped(u,g,v),m=e.ndops.meanClipped(u,g,v);$(a).find(".annotation").empty(),$(a).append(e.template("<div class='annotation' style='position:absolute;right: 10px;top:30px'>                     <table>                                     <tr><td>rms        </td><td align=right>{rms%.2f}</td><tr>                                     <tr><td>mean       </td><td align=right>{mean%.2f}</td><tr>                     </table>                     </div>",{rms:f,mean:m}))}JS9.RegisterPlugin("ImExam","Histogram",function n(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see histogram<br>")},{menu:"analysis",menuItem:"Histogram",winTitle:"Histogram",help:"imexam/imexam.html#rghist",dynamicSelect:!0,toolbarSeparate:!0,toolbarHTML:" ",onregionschange:function o(a,l){var c=this.div,d=e.getRegionData(a,l),h=e.ndops.hist(d);h.sum=e.ndops.sum(h.data),$(c).data("hist",h);var r,u,p=0,g=.001*h.sum,v=0;$(c).empty();var f=[];for(r=0;r<h.data.shape[0];r++)(p+=h.data.get(r))>g&&p<h.sum-g&&(u=h.data.get(r),f[v]=[r*h.width+h.min,u],v++);s(c,$.plot(c,[f],{zoomStack:!0,zoomFunc:s,selection:{mode:"x"}}))},winDims:[250,250]})}(),function(){var e=require("./imexam");function s(a,l){var c=e.reg2section(l),d=e.getRegionData(a,l),h=e.ndops.assign(e.ndops.zeros(d.shape),d),p=e.ndops.assign(e.ndops.zeros(d.shape),d),g={};return a&&l?(g.reg=l,g.min=e.ndops.minvalue(d),g.max=e.ndops.maxvalue(d),g.bkgd=e.imops.backgr(d,4),e.ndops.subs(h,d,g.bkgd.value),g.bscnts=e.ndops.centroid(h,e.ndops.qcenter(h)),g.bscnts.cenx+=c[0][0],g.bscnts.ceny+=c[1][0],g.totcnts=e.ndops.centroid(p,e.ndops.qcenter(p)),g.totcnts.cenx+=c[0][0],g.totcnts.ceny+=c[1][0],g):null}JS9.Image.prototype.getRegionStats=function(a){return s(this,a)},JS9.mkPublic("GetRegionStats","getRegionStats"),JS9.RegisterPlugin("ImExam","RegionStats",function n(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see stats<br>")},{menu:"analysis",winTitle:"Region Stats",menuItem:"Region Stats",help:"imexam/imexam.html#rgstat",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function o(a,l){$(this.div).html(e.template("                                                                                        <table width=100% style='padding-right: 6px; padding-left: 0px'>                                            <tr><td align=right>position x</td> <td align=right>{reg.x%.2f}              </td>                      <td align=right>y</td>              <td align=right>{reg.y%.2f}             </td></tr>                  <tr><td align=right>box width</td>      <td align=right>{reg.width%.2f}         </td>                   <td align=right>height</td>         <td align=right>{reg.height%.2f}        </td></tr>                  <tr><td align=right>min</td>        <td align=right>{min%.2f}               </td>                       <td align=right>max</td>            <td align=right>{max%.2f}               </td></tr>                  <tr><td align=right>totcounts</td>     <td align=right colspan=3>{totcnts.sum%.2f}</tr>               <tr><td align=right>bscounts</td>     <td align=right colspan=3>{bscnts.sum%.2f}</tr>                 <tr><td align=right>bkgd</td>     <td align=right>{bkgd.value%.2f}      </td>                         <td align=right>noise</td>          <td align=right>{bkgd.noise%.2f}      </td></tr>                  <tr><td align=right>centroid x</td> <td align=right>{bscnts.cenx%.2f}     </td>                       <td align=right>y</td>              <td align=right>{bscnts.ceny%.2f}     </td></tr>                  <tr><td align=right>FWHM</td>       <td align=right>{bscnts.fwhm%.2f}     </td>                       <td align=right></td>            <td align=right>{bscnts.rms%.2f}      </td></tr>                 </table>",s(a,l)))},winDims:[250,250]})}(),function(){"use strict";var e=require("./imexam"),t="                                \t\t\t<div style='float:right; margin:10px'>                   <select class='proj_menu JS9Select'>\t                        <option>sum</option>                                    <option>avg</option>                                    <option>med</option>            \t\t </select>\t\t\t\t\t\t</div>";function s(n,a){var l,c,d,h;void 0===n?(l=a.div,c=a.proj,d=a.menu,h=a.chek):(l=this.div,d=this.outerdivjq.find(".proj_menu")[0],h=this.outerdivjq.find(".proj_chek")[0],c=e.ndops.proj(e.getRegionData(n,a),this.plugin.opts.xyproj),$(d).change(function(u){s(void 0,{div:l,proj:c,menu:d,chek:h})}),$(h).change(function(u){s(void 0,{div:l,proj:c,menu:d,chek:h})}));var g,v,p=[],r=d.options[d.selectedIndex].value;for($(l).empty(),"sum"===r&&(g=c.sum),"avg"===r&&(g=c.avg),"med"===r&&(g=c.med),v=0;v<g.length;v++)p[v]=[v,g[v]];$.plot(l,[p],{zoomStack:!0,selection:{mode:"xy"}})}function o(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see projection<br>")}JS9.RegisterPlugin("ImExam","XProj",o,{menu:"analysis",menuItem:"X Projection",winTitle:"X Projection",help:"imexam/imexam.html#xyproj",dynamicSelect:!0,toolbarSeparate:!0,toolbarHTML:t,onregionschange:s,winDims:[250,250],xyproj:0}),JS9.RegisterPlugin("ImExam","YProj",o,{menu:"analysis",menuItem:"Y Projection",winTitle:"Y Projection",help:"imexam/imexam.html#xyproj",dynamicSelect:!0,toolbarSeparate:!0,toolbarHTML:t,onregionschange:s,winDims:[250,250],xyproj:1})}(),function e(t,s,o){function n(c,d){if(!s[c]){if(!t[c]){var h="function"==typeof require&&require;if(!d&&h)return h(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var g=s[c]={exports:{}};t[c][0].call(g.exports,function(v){return n(t[c][1][v]||v)},g,g.exports,e,t,s,o)}return s[c].exports}for(var a="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,s){!function(){"use strict";var o=e("./imexam");e("./JSSurfacePlot-V1.7/javascript/SurfacePlot"),e("./JSSurfacePlot-V1.7/javascript/ColourGradient"),JS9.RegisterPlugin("ImExam","3dPlot",function l(){o.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see 3d plot<br>")},{menu:"analysis",menuItem:"3dPlot",winTitle:"3dPlot",help:"imexam/imexam.html#3dplot",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function a(c,d){!function n(c,d){var h=o.ndops.zeros(d.shape),p=o.ndops.minvalue(d),v=o.ndops.maxvalue(d)-p,r=$(c).data("surfplot");h.getNumberOfRows=function(){return this.shape[1]},h.getNumberOfColumns=function(){return this.shape[0]},h.getFormattedValue=function(B,P){return this.get(P,B).toString()},void 0===r&&(c.innerHTML="",r=new greg.ross.visualisation.SurfacePlot(c),$(c).data("surfplot",r));var E,R,H,C=[],I=h.getNumberOfRows(),L=h.getNumberOfColumns(),D=0,O=c.offsetHeight,M=c.offsetWidth;for(E=0;E<I;E++)for(R=0;R<L;R++)H=d.get(R,E),h.set(R,E,(H-p)/(2.25*v)),void 0!==H&&(C[D]="x:"+E+", y:"+R+" = "+H.toFixed(2)),D++;r.draw(h,{xPos:0,yPos:0,width:M,height:O,colourGradient:[{red:0,green:0,blue:255},{red:0,green:255,blue:255},{red:0,green:255,blue:0},{red:255,green:255,blue:0},{red:255,green:0,blue:0}],fillPolygons:!0,tooltips:C,xTitle:"X",yTitle:"Y",zTitle:"Z",restrictXRotation:!1})}(this.div,o.getRegionData(c,d))},winDims:[250,250]})}()},{"./JSSurfacePlot-V1.7/javascript/ColourGradient":2,"./JSSurfacePlot-V1.7/javascript/SurfacePlot":3,"./imexam":void 0}],2:[function(e,t,s){greg.ross.visualisation.ColourGradient=function(o,n,a){function d(p){return p.red*p.red+p.green*p.green+p.blue*p.blue}function h(p,g,v){return g==v?0:(p-g)/(v-g)}this.getColour=function(p){return isNaN(p)||p<o||p>n||1==a.length?{red:a[0].red,green:a[0].green,blue:a[0].blue}:function c(p){var m,b,w,g=a.length,v=1/(g-1),r=p/v,u=(r=parseInt(r+""),a[r=r>=g-1?g-2:r]),f=a[r+1];d(u)>d(f)?(m=f,b=u):(m=u,b=f);var A=[(w=m==f?1-h(p,r*v,(r+1)*v):h(p,r*v,(r+1)*v))*(b.red-m.red),w*(b.green-m.green),w*(b.blue-m.blue)],x=m.red+A[0],y=m.green+A[1],S=m.blue+A[2];return{red:x=parseInt(x),green:y=parseInt(y),blue:S=parseInt(S)}}(h(p,o,n))}}},{}],3:[function(e,t,s){function n(a,l){return Math.sqrt((a.x-l.x)*(a.x-l.x)+(a.y-l.y)*(a.y-l.y))}(function o(a){for(var l=a.split("."),c=window,d=l.length,h=0;h<d;h++)typeof c[l[h]]>"u"&&(c[l[h]]=new Object),c=c[l[h]]})("greg.ross.visualisation"),greg.ross.visualisation.SurfacePlot=function(a){this.containerElement=a},greg.ross.visualisation.SurfacePlot.prototype.draw=function(a,l){null==this.surfacePlot&&(this.surfacePlot=new greg.ross.visualisation.JSSurfacePlot(l.xPos,l.yPos,l.width,l.height,l.colourGradient,this.containerElement,l.tooltips,l.fillPolygons,l.xTitle,l.yTitle,l.zTitle,l.restrictXRotation)),this.surfacePlot.redraw(a)},greg.ross.visualisation.JSSurfacePlot=function(a,l,c,d,R,p,g,v,r,u,f,m){var w,b=function oe(){var Te=0,_e="surfacePlot";do{Te++}while(document.getElementById(_e+Te));return _e+Te}(),A=null,x=greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE,y=greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,S=greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE;this.data=null;var D,O,M,E,H,_=!1,C=!0,I=null,B=!1,P=!1,z=null,J=null,q=new greg.ross.visualisation.Point(0,0),G=null,ee=null,le=new greg.ross.visualisation.Point(0,0),te=new greg.ross.visualisation.Point(0,0),Q=null,Y=(new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!1));function be(){Y.hide()}function Ee(Te){A.clearRect(0,0,w.width,w.height),A.fillStyle="#000",A.fillRect(0,0,w.width,w.height),this.data=Te;var Be=c-40;M.init(),M.rotate(S,0,y),M.scale(x),M.translate(Be/2+20,Be/3*2+20,0),E=new greg.ross.visualisation.Point3D(Be/2+20,Be/2+20,-1e3);var zt=function W(){var Te=new greg.ross.visualisation.Point3D(-.5,.5,0),_e=new greg.ross.visualisation.Point3D(.5,.5,0),Oe=new greg.ross.visualisation.Point3D(-.5,-.5,0),ze=new greg.ross.visualisation.Point3D(-.5,.5,1),Be=M.ChangeObjectPoint(Te),Qe=M.ChangeObjectPoint(_e),lt=M.ChangeObjectPoint(Oe),wt=M.ChangeObjectPoint(ze),ut=new Array,Dt=new greg.ross.visualisation.Polygon(E,!0);Dt.addPoint(Be),Dt.addPoint(Qe),Dt.calculateCentroid(),Dt.calculateDistance(),ut[ut.length]=Dt;var Lt=new greg.ross.visualisation.Polygon(E,!0);Lt.addPoint(Be),Lt.addPoint(lt),Lt.calculateCentroid(),Lt.calculateDistance(),ut[ut.length]=Lt;var Tt=new greg.ross.visualisation.Polygon(E,!0);return Tt.addPoint(Be),Tt.addPoint(wt),Tt.calculateCentroid(),Tt.calculateDistance(),ut[ut.length]=Tt,ut}(),kt=function K(Te){var _e,Oe,ze=new Array,Be=0;for(_e=0;_e<D-1;_e++)for(Oe=0;Oe<O-1;Oe++){var Qe=new greg.ross.visualisation.Polygon(E,!1),lt=M.ChangeObjectPoint(Te[Oe+_e*O]),wt=M.ChangeObjectPoint(Te[Oe+_e*O+O]),ut=M.ChangeObjectPoint(Te[Oe+_e*O+O+1]),Dt=M.ChangeObjectPoint(Te[Oe+_e*O+1]);Qe.addPoint(lt),Qe.addPoint(wt),Qe.addPoint(ut),Qe.addPoint(Dt),Qe.calculateCentroid(),Qe.calculateDistance(),ze[Be]=Qe,Be++}return ze}(I);for(i=0;i<zt.length;i++)kt[kt.length]=zt[i];for(kt.sort(greg.ross.visualisation.PolygonComaparator),A.lineWidth=1,A.strokeStyle="#888",A.lineJoin="round",i=0;i<kt.length;i++){var At=kt[i];if(At.isAnAxis()){var pt=At.getPoint(0),ft=At.getPoint(1);A.beginPath(),A.moveTo(pt.ax,pt.ay),A.lineTo(ft.ax,ft.ay),A.stroke()}else{pt=At.getPoint(0),ft=At.getPoint(1);var Nt=At.getPoint(2),Ft=At.getPoint(3),Rt=H.getColour((1*pt.lz+1*ft.lz+1*Nt.lz+1*Ft.lz)/4);A.fillStyle="rgb("+Rt.red+","+Rt.green+","+Rt.blue+")",A.beginPath(),A.moveTo(pt.ax,pt.ay),A.lineTo(ft.ax,ft.ay),A.lineTo(Nt.ax,Nt.ay),A.lineTo(Ft.ax,Ft.ay),A.lineTo(pt.ax,pt.ay),v?A.fill():A.stroke()}}A.stroke(),pe()&&function $e(Te){var _e=new greg.ross.visualisation.Point3D(0,.5,0),Oe=new greg.ross.visualisation.Point3D(-.5,0,0),ze=new greg.ross.visualisation.Point3D(-.5,.5,.5),Be=M.ChangeObjectPoint(_e),Qe=M.ChangeObjectPoint(Oe),lt=M.ChangeObjectPoint(ze),wt=Te[0],ut=Te[1],Dt=Te[2];A.fillStyle="#fff",wt.distanceFromCamera>ut.distanceFromCamera&&A.fillText(r,Be.ax,Be.ay),wt.distanceFromCamera<ut.distanceFromCamera&&A.fillText(u,Qe.ax,Qe.ay),wt.distanceFromCamera<Dt.distanceFromCamera&&A.fillText(f,lt.ax,lt.ay)}(zt)}function pe(){return _||(_=!0,C=!!document.createElement("canvas").getContext),C}function we(Te){!function Ne(Te){if(parseInt(navigator.appVersion)>3){var Oe="Netscape"==navigator.appName?Te:event;if("Netscape"==navigator.appName&&4==parseInt(navigator.appVersion)?"1"==(Te.modifiers+32).toString(2).substring(3,6).charAt(0):Oe.shiftKey)return!0}return!1}(Te)?(B=!0,le=He(Te)):(P=!0,te=He(Te))}function me(Te){B?G=q:P&&(ee=q),B=!1,P=!1}function De(Te){var _e=He(Te);if(B)be(),function Je(Te){q=new greg.ross.visualisation.Point(greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE),null==G&&(G=new greg.ross.visualisation.Point(greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE)),null!=le&&(q=new greg.ross.visualisation.Point(G.x+(le.x-Te.x),G.y+(le.y-Te.y))),y=q.x%360,S=q.y%360,m&&(S<0?S=0:S>90&&(S=90)),Q=null,Ee(data)}(_e);else if(P)be(),function st(Te){q=new greg.ross.visualisation.Point(0,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR),null==ee&&(ee=new greg.ross.visualisation.Point(0,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR)),null!=te&&(q=new greg.ross.visualisation.Point(ee.x+(te.x-Te.x),ee.y+(te.y-Te.y))),(x=q.y*greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR)<greg.ross.visualisation.JSSurfacePlot.MIN_SCALE?x=greg.ross.visualisation.JSSurfacePlot.MIN_SCALE+1:x>greg.ross.visualisation.JSSurfacePlot.MAX_SCALE&&(x=greg.ross.visualisation.JSSurfacePlot.MAX_SCALE-1),q.y=x/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR,Q=null,Ee(data)}(_e);else{Q=null;for(var Oe=Number.MAX_VALUE,ze=0;ze<I.length;ze++){var Be=I[ze],Qe=n({x:Be.ax,y:Be.ay},_e);Qe<Oe&&(Oe=Qe,Q=ze)}if(Oe>16)return void be();!function ke(Te){new greg.ross.visualisation.Point(Te.x,Te.y),Y.show(g[Q],200)}(_e)}return!1}function He(Te){if(function ve(){var Te=-1;if("Microsoft Internet Explorer"==navigator.appName){var _e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(_e)&&(Te=parseFloat(RegExp.$1))}return Te}()>-1)if(1==(Te=window.event).srcElement.getAttribute("Stroked")){if(null==z||null==J)return}else z=Te.offsetX,J=Te.offsetY;else Te.layerX||0==Te.layerX?(z=Te.layerX,J=Te.layerY):Te.offsetX||0==Te.offsetX?(z=Te.offsetX,J=Te.offsetY):(Te.touches[0].pageX||0==Te.touches[0].pageX)&&(z=Te.touches[0].pageX,J=Te.touches[0].pageY);return new greg.ross.visualisation.Point(z,J)}this.redraw=function(Te){D=1*Te.getNumberOfRows(),O=1*Te.getNumberOfColumns();for(var _e=Number.MAX_VALUE,Oe=Number.MIN_VALUE,pt=0;pt<D;pt++)for(var ft=0;ft<O;ft++){var ze=1*Te.getFormattedValue(pt,ft);ze<_e&&(_e=ze),ze>Oe&&(Oe=ze)}H=new greg.ross.visualisation.ColourGradient(_e,Oe,R||[{red:0,green:0,blue:255},{red:0,green:255,blue:255},{red:0,green:255,blue:0},{red:255,green:255,blue:0},{red:255,green:0,blue:0}]);var kt,At,Tt=1/(D-1),zt=1/(O-1);I=new Array;var Ft=0;for(pt=0,kt=-.5;pt<D;pt++,kt+=Tt)for(ft=0,At=.5;ft<O;ft++,At-=zt)I[Ft]=new greg.ross.visualisation.Point3D(kt,At,Te.getFormattedValue(pt,ft)),Ft++;Ee(Te)},function ie(){M=new greg.ross.visualisation.Th3dtran,function se(){this.targetDiv=document.createElement("div"),this.targetDiv.id=b,this.targetDiv.className="surfaceplot",this.targetDiv.style.background="#ffffff",this.targetDiv.style.position="absolute",p?(this.targetDiv.style.position="relative",p.appendChild(this.targetDiv)):document.body.appendChild(this.targetDiv),this.targetDiv.style.left=a+"px",this.targetDiv.style.top=l+"px"}(),targetDiv&&function Ae(){w=document.createElement("canvas"),pe()||(G_vmlCanvasManager.initElement(w),w.style.width=c,w.style.height=d),w.className="surfacePlotCanvas",w.setAttribute("width",c),w.setAttribute("height",d),w.style.left="0px",w.style.top="0px",targetDiv.appendChild(w),(A=w.getContext("2d")).font="bold 18px sans-serif",A.clearRect(0,0,w.width,w.height),A.fillStyle="#000",A.fillRect(0,0,w.width,w.height),A.beginPath(),A.rect(0,0,w.width,w.height),A.strokeStyle="#888",A.stroke(),w.onmousemove=De,w.onmouseout=be,w.onmousedown=we,w.onmouseup=me,w.addEventListener("touchstart",we,!1),w.addEventListener("touchmove",De,!1),w.addEventListener("touchend",me,!1),w.addEventListener("touchcancel",be,!1)}()}()},greg.ross.visualisation.Matrix3d=function(){this.matrix=new Array,this.numRows=4,this.numCols=4,this.init=function(){this.matrix=new Array;for(var a=0;a<this.numRows;a++)this.matrix[a]=new Array},this.getMatrix=function(){return this.matrix},this.matrixReset=function(){for(var a=0;a<this.numRows;a++)for(var l=0;l<this.numCols;l++)this.matrix[a][l]=0},this.matrixIdentity=function(){this.matrixReset(),this.matrix[0][0]=this.matrix[1][1]=this.matrix[2][2]=this.matrix[3][3]=1},this.matrixCopy=function(a){var c,d,l=new greg.ross.visualisation.Matrix3d;for(c=0;c<this.numRows;c++)for(d=0;d<this.numCols;d++)l.getMatrix()[c][d]=this.matrix[c][0]*a.getMatrix()[0][d]+this.matrix[c][1]*a.getMatrix()[1][d]+this.matrix[c][2]*a.getMatrix()[2][d]+this.matrix[c][3]*a.getMatrix()[3][d];for(c=0;c<this.numRows;c++)this.matrix[c][0]=l.getMatrix()[c][0],this.matrix[c][1]=l.getMatrix()[c][1],this.matrix[c][2]=l.getMatrix()[c][2],this.matrix[c][3]=l.getMatrix()[c][3]},this.matrixMult=function(a,l){var d,h,c=new greg.ross.visualisation.Matrix3d;for(d=0;d<this.numRows;d++)for(h=0;h<this.numCols;h++)c.getMatrix()[d][h]=l.getMatrix()[d][0]*a.getMatrix()[0][h]+l.getMatrix()[d][1]*a.getMatrix()[1][h]+l.getMatrix()[d][2]*a.getMatrix()[2][h]+l.getMatrix()[d][3]*a.getMatrix()[3][h];for(d=0;d<this.numRows;d++)a.getMatrix()[d][0]=c.getMatrix()[d][0],a.getMatrix()[d][1]=c.getMatrix()[d][1],a.getMatrix()[d][2]=c.getMatrix()[d][2],a.getMatrix()[d][3]=c.getMatrix()[d][3]},this.init()},greg.ross.visualisation.Point3D=function(a,l,c){this.displayValue="",this.initPoint=function(){this.lx=this.ly=this.lz=this.ax=this.ay=this.az=this.at=this.wx=this.wy=this.wz=0,this.lt=this.wt=1},this.init=function(g,v,r){this.initPoint(),this.lx=g,this.ly=v,this.lz=r,this.ax=this.lx,this.ay=this.ly,this.az=this.lz},this.init(a,l,c)},greg.ross.visualisation.Polygon=function(a,l){this.points=new Array,this.cameraPosition=a,this.isAxis=l,this.centroid=null,this.distanceFromCamera=null,this.isAnAxis=function(){return this.isAxis},this.addPoint=function(c){this.points[this.points.length]=c},this.distance=function(){return this.distance2(this.cameraPosition,this.centroid)},this.calculateDistance=function(){this.distanceFromCamera=this.distance()},this.calculateCentroid=function(){for(var c=0,d=0,h=0,p=1*this.points.length,g=0;g<p;g++)c+=this.points[g].ax,d+=this.points[g].ay,h+=this.points[g].az;c/=p,d/=p,h/=p,this.centroid=new greg.ross.visualisation.Point3D(c,d,h)},this.distance2=function(c,d){return(c.ax-d.ax)*(c.ax-d.ax)+(c.ay-d.ay)*(c.ay-d.ay)+(c.az-d.az)*(c.az-d.az)},this.getPoint=function(c){return this.points[c]}},greg.ross.visualisation.PolygonComaparator=function(a,l){var c=a.distanceFromCamera-l.distanceFromCamera;return 0==c?0:c<0?-1:c>0?1:0},greg.ross.visualisation.Th3dtran=function(){this.local=!0,this.init=function(){this.matrix=new greg.ross.visualisation.Matrix3d,this.rMat=new greg.ross.visualisation.Matrix3d,this.rMatrix=new greg.ross.visualisation.Matrix3d,this.objectMatrix=new greg.ross.visualisation.Matrix3d,this.initMatrix()},this.initMatrix=function(){this.matrix.matrixIdentity(),this.objectMatrix.matrixIdentity()},this.translate=function(a,l,c){this.rMat.matrixIdentity(),this.rMat.getMatrix()[3][0]=a,this.rMat.getMatrix()[3][1]=l,this.rMat.getMatrix()[3][2]=c,this.local?this.objectMatrix.matrixCopy(this.rMat):this.matrix.matrixCopy(this.rMat)},this.rotate=function(a,l,c){var d=a*(Math.PI/180),h=l*(Math.PI/180),p=c*(Math.PI/180);this.rMatrix.matrixIdentity(),this.rMat.matrixIdentity(),this.rMat.getMatrix()[1][1]=Math.cos(d),this.rMat.getMatrix()[1][2]=Math.sin(d),this.rMat.getMatrix()[2][1]=-Math.sin(d),this.rMat.getMatrix()[2][2]=Math.cos(d),this.rMatrix.matrixMult(this.rMatrix,this.rMat),this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=Math.cos(h),this.rMat.getMatrix()[0][2]=-Math.sin(h),this.rMat.getMatrix()[2][0]=Math.sin(h),this.rMat.getMatrix()[2][2]=Math.cos(h),this.rMat.matrixMult(this.rMatrix,this.rMat),this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=Math.cos(p),this.rMat.getMatrix()[0][1]=Math.sin(p),this.rMat.getMatrix()[1][0]=-Math.sin(p),this.rMat.getMatrix()[1][1]=Math.cos(p),this.rMat.matrixMult(this.rMatrix,this.rMat),this.local?this.objectMatrix.matrixCopy(this.rMatrix):this.matrix.matrixCopy(this.rMatrix)},this.scale=function(a){this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=a,this.rMat.getMatrix()[1][1]=a,this.rMat.getMatrix()[2][2]=a,this.local?this.objectMatrix.matrixCopy(this.rMat):this.matrix.matrixCopy(this.rMat)},this.changeLocalObject=function(a){return a.wx=a.ax*this.matrix.getMatrix()[0][0]+a.ay*this.matrix.getMatrix()[1][0]+a.az*this.matrix.getMatrix()[2][0]+this.matrix.getMatrix()[3][0],a.wy=a.ax*this.matrix.getMatrix()[0][1]+a.ay*this.matrix.getMatrix()[1][1]+a.az*this.matrix.getMatrix()[2][1]+this.matrix.getMatrix()[3][1],a.wz=a.ax*this.matrix.getMatrix()[0][2]+a.ay*this.matrix.getMatrix()[1][2]+a.az*this.matrix.getMatrix()[2][2]+this.matrix.getMatrix()[3][2],a},this.ChangeObjectPoint=function(a){return a.ax=a.lx*this.objectMatrix.getMatrix()[0][0]+a.ly*this.objectMatrix.getMatrix()[1][0]+a.lz*this.objectMatrix.getMatrix()[2][0]+this.objectMatrix.getMatrix()[3][0],a.ay=a.lx*this.objectMatrix.getMatrix()[0][1]+a.ly*this.objectMatrix.getMatrix()[1][1]+a.lz*this.objectMatrix.getMatrix()[2][1]+this.objectMatrix.getMatrix()[3][1],a.az=a.lx*this.objectMatrix.getMatrix()[0][2]+a.ly*this.objectMatrix.getMatrix()[1][2]+a.lz*this.objectMatrix.getMatrix()[2][2]+this.objectMatrix.getMatrix()[3][2],a},this.init()},greg.ross.visualisation.Point=function(a,l){this.x=a,this.y=l},greg.ross.visualisation.Tooltip=function(a){var r,u,f,m,b,v=0,w=!!document.all;function A(x){if(95!=v&&1==x||0!=v&&-1==x){var S=10;95-v<10&&1==x?S=95-v:v<10&&-1==x&&(S=v),r.style.opacity=.01*(v+=S*x),r.style.filter="alpha(opacity="+v+")"}else clearInterval(r.timer),-1==x&&(r.style.display="none")}this.show=function(x,y){null==r&&((r=document.createElement("div")).style.color="#fff",r.style.position="absolute",r.style.display="block",(u=document.createElement("div")).style.display="block",u.style.height="5px",u.style.marginleft="5px",u.style.overflow="hidden",f=document.createElement("div"),m=document.createElement("div"),r.appendChild(u),r.appendChild(f),r.appendChild(m),document.body.appendChild(r),w?r.style.opacity=1:(r.style.opacity=0,r.style.filter="alpha(opacity=0)")),a||(document.onmousemove=this.pos),r.style.display="block",f.innerHTML='<span style="font-weight:bold; font-family: arial;">'+x+"</span>",r.style.width=y?y+"px":"auto",!y&&w&&(u.style.display="none",m.style.display="none",r.style.width=r.offsetWidth,u.style.display="block",m.style.display="block"),r.offsetWidth>300&&(r.style.width="300px"),b=parseInt(r.offsetHeight)+3,w||(clearInterval(r.timer),r.timer=setInterval(function(){A(1)},20))},this.setPos=function(x){r.style.top=x.y+"px",r.style.left=x.x+"px"},this.pos=function(x){var y=w?event.clientY+document.documentElement.scrollTop:x.pageY,S=w?event.clientX+document.documentElement.scrollLeft:x.pageX;r.style.top=y-b+"px",r.style.left=S+3+"px"},this.hide=function(){null!=r&&(w?r.style.display="none":(clearInterval(r.timer),r.timer=setInterval(function(){A(-1)},20)))}},greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE=47,greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE=47,greg.ross.visualisation.JSSurfacePlot.DATA_DOT_SIZE=3,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE=350,greg.ross.visualisation.JSSurfacePlot.MIN_SCALE=50,greg.ross.visualisation.JSSurfacePlot.MAX_SCALE=1100,greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR=1.4},{}]},{},[1]),function e(t,s,o){function n(c,d){if(!s[c]){if(!t[c]){var h="function"==typeof require&&require;if(!d&&h)return h(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var g=s[c]={exports:{}};t[c][0].call(g.exports,function(v){return n(t[c][1][v]||v)},g,g.exports,e,t,s,o)}return s[c].exports}for(var a="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,s){!function(){"use strict";var o=e("./imexam");s.bin1d=o.typed(function(a,l){var c=o.typed.clone(a.shape).map(function(p){return p/l+.5|0}),d=o.typed.array(a.type,c);return d[0/l|0]+=a,d});var n=o.typed(function(a,l,c){return l[0/c|0][0/c|0]+=a,l});s.bin2d=function(a,l){var c=o.typed.clone(a.shape).map(function(h){return h/l+.5|0}),d=o.typed.array(c,a);return n(a,d,l)},s.smooth_gaussian2d=function(a,l){var r,u,f,c=o.typed.array(a.shape,"float32"),d=o.typed.array(a.shape,"float32"),p=l,v=[];for(r=0;r<10;r++)v[r]=1*Math.pow(2.71828,-r*r/(2*p*p))+0;for(r=0;r<v.length&&!(v[r]<.001);r++);v.length=r-1;var m=o.typed.clone(v);for(v=v.reverse(),r=1;r<m.length;r++)v[v.length]=m[r];v.shape[0]=v.length,v=o.typed.div(v,o.typed.sum(v));var b=a.shape[1],w=a.shape[0],A=v.shape[0];for(u=0;u<w;u++)for(r=0;r<b;r++)for(f=-A/2|0;f<A/2|0;f++)r+f>=0&&r+f<w&&(c.data[u*b+r]+=v[f+A/2|0]*a.data[u*b+r+f]);for(u=0;u<w;u++)for(r=0;r<b;r++)for(f=-A/2|0;f<A/2|0;f++)u+f>=0&&u+f<w&&(d.data[u*b+r]+=v[f+A/2|0]*c.data[(u+f)*b+r]);return d}}()},{"./imexam":void 0}],2:[function(e,t,s){var o=function(){var a=function(h,p){var g=h.x-p.x,v=h.y-p.y;return g*g+v*v<1e-20},l=function(h){for(var g,p=h.head;p;)g=p.next,p.next=p.prev,p.prev=g,p=g;g=h.head,h.head=h.tail,h.tail=g},c=function(h){this.count=0,this.level=h,this.s=null,this.count=0};c.prototype.remove_seq=function(h){h.prev?h.prev.next=h.next:this.s=h.next,h.next&&(h.next.prev=h.prev),--this.count},c.prototype.addSegment=function(h,p){var g,v=this.s,r=null,u=null,f=!1,m=!1;if(this.count++>1e5)throw new Error("Too many calls to coutour AddSegment");for(;v&&(null==r&&(a(h,v.head.p)?(r=v,f=!0):a(h,v.tail.p)&&(r=v)),null==u&&(a(p,v.head.p)?(u=v,m=!0):a(p,v.tail.p)&&(u=v)),null==u||null==r);)v=v.next;switch((null!=r?1:0)|(null!=u?2:0)){case 0:var w={p:h,prev:null},A={p,next:null};w.next=A,A.prev=w,r={head:w,tail:A,next:this.s,prev:null,closed:!1},this.s&&(this.s.prev=r),this.s=r,++this.count;break;case 1:g={p},f?(g.next=r.head,g.prev=null,r.head.prev=g,r.head=g):(g.next=null,g.prev=r.tail,r.tail.next=g,r.tail=g);break;case 2:g={p:h},m?(g.next=u.head,g.prev=null,u.head.prev=g,u.head=g):(g.next=null,g.prev=u.tail,u.tail.next=g,u.tail=g);break;case 3:if(r===u){r.head.prev=g={p:r.tail.p,next:r.head,prev:null},r.head=g,r.closed=!0;break}switch((f?1:0)|(m?2:0)){case 0:l(r);case 1:u.tail.next=r.head,r.head.prev=u.tail,u.tail=r.tail,this.remove_seq(r);break;case 3:l(r);case 2:r.tail.next=u.head,u.head.prev=r.tail,r.tail=u.tail,this.remove_seq(u)}}};var d=function(h){if(h)this.drawContour=h;else{var p=this;p.contours={},this.drawContour=function(g,v,r,u,f,m){var b=p.contours[m];b||(b=p.contours[m]=new c(f)),b.addSegment({x:v,y:g},{x:u,y:r})},this.contourList=function(){var g=[],v=p.contours;for(var r in v)for(var u=v[r].s,f=v[r].level;u;){var m=u.head,b=[];for(b.level=f,b.k=r;m&&m.p;)b.push(m.p),m=m.next;g.push(b),u=u.next}return g.sort(function(w,A){return A.k-w.k}),g}}this.h=new Array(5),this.sh=new Array(5),this.xh=new Array(5),this.yh=new Array(5)};return d.prototype.contour=function(h,p,g,v,r,u,f,m,b){var w=this.h,A=this.sh,x=this.xh,y=this.yh,S=this.drawContour;this.contours={};for(var I,D,O,M,E,_=function(de,xe){return(w[xe]*x[de]-w[de]*x[xe])/(w[xe]-w[de])},C=function(de,xe){return(w[xe]*y[de]-w[de]*y[xe])/(w[xe]-w[de])},R=0,H=0,N=0,B=0,P=[0,1,1,0],z=[0,0,1,1],J=[[[0,0,8],[0,2,5],[7,6,9]],[[0,3,4],[1,3,1],[4,3,0]],[[9,6,7],[5,2,0],[8,0,0]]],q=r-1;q>=v;q--)for(var G=p;G<=g-1;G++){var ee,le;if(ee=Math.min(h.get(G,q),h.get(G,q+1)),le=Math.min(h.get(G+1,q),h.get(G+1,q+1)),M=Math.min(ee,le),ee=Math.max(h.get(G,q),h.get(G,q+1)),le=Math.max(h.get(G+1,q),h.get(G+1,q+1)),(E=Math.max(ee,le))>=b[0]&&M<=b[m-1])for(var te=0;te<m;te++)if(b[te]>=M&&b[te]<=E){for(var Q=4;Q>=0;Q--)Q>0?(w[Q]=h.get(G+P[Q-1],q+z[Q-1])-b[te],x[Q]=u[G+P[Q-1]],y[Q]=f[q+z[Q-1]]):(w[0]=.25*(w[1]+w[2]+w[3]+w[4]),x[0]=.5*(u[G]+u[G+1]),y[0]=.5*(f[q]+f[q+1])),A[Q]=w[Q]>0?1:w[Q]<0?-1:0;for(Q=1;Q<=4;Q++)if(0!=(O=J[A[I=Q]+1][A[0]+1][A[D=4!=Q?Q+1:1]+1])){switch(O){case 1:R=x[I],N=y[I],H=x[0],B=y[0];break;case 2:R=x[0],N=y[0],H=x[D],B=y[D];break;case 3:R=x[D],N=y[D],H=x[I],B=y[I];break;case 4:R=x[I],N=y[I],H=_(0,D),B=C(0,D);break;case 5:R=x[0],N=y[0],H=_(D,I),B=C(D,I);break;case 6:R=x[D],N=y[D],H=_(I,0),B=C(I,0);break;case 7:R=_(I,0),N=C(I,0),H=_(0,D),B=C(0,D);break;case 8:R=_(0,D),N=C(0,D),H=_(D,I),B=C(D,I);break;case 9:R=_(D,I),N=C(D,I),H=_(I,0),B=C(I,0)}S(R,N,H,B,b[te],te)}}}},d}();typeof s<"u"&&(s.Conrec=o)},{}],3:[function(e,t,s){"use strict";!function(){function h(p,g,v,r,u,f,m,b,w){for(var C,I,L,D,O,M,E,A=r,x=u,y=f,S=1,_=A<0||A>=p-1||x<0&&x>=g-1;!_;){if(C=0,I=m[x*p+A],L=m[x*p+A+1],D=m[(x+1)*p+A+1],O=m[(x+1)*p+A],S)switch(S=0,f){case 0:M=(v-I)/(L-I)+A,E=x;break;case 1:M=A+1,E=(v-L)/(D-L)+x;break;case 2:M=(v-D)/(O-D)+A,E=x+1;break;case 3:M=A,E=(v-I)/(O-I)+x}else{0==f&&(b[x*p+A]=1);do{switch(4==++f&&(f=0),f){case 0:I>=v&&v>L&&(C=1,M=(v-I)/(L-I)+A,E=x,x--);break;case 1:L>=v&&v>D&&(C=1,M=A+1,E=(v-L)/(D-L)+x,A++);break;case 2:D>=v&&v>O&&(C=1,M=(v-O)/(D-O)+A,E=x+1,x++);break;case 3:O>=v&&v>I&&(C=1,M=A,E=(v-I)/(O-I)+x,A--)}}while(!C);4==++f&&(f=0),4==++f&&(f=0),A==r&&x==u&&f==y&&(_=1),(A<0||A>=p-1||x<0||x>=g-1)&&(_=1)}w(M+.5,E+.5,v),_&&w(0,0,void 0)}}t.exports=function d(p,g,v,r,u){var f,m,w,A,b=new Uint8Array(g*v);for(f=0;f<p.length;f++){for(m=p[f],w=0;w<g*v;w++)b[w]=0;for(A=0,w=0;w<g-1;w++)r[A*g+w]<m&&m<=r[A*g+w+1]&&h(g,v,m,w,A,0,r,b,u);for(A=0;A<v-1;A++)r[A*g+w]<m&&m<=r[(A+1)*g+w]&&h(g,v,m,w-1,A,1,r,b,u);for(w--;w>=0;w--)r[A*g+w+1]<m&&m<=r[A*g+w]&&h(g,v,m,w,A-1,2,r,b,u);for(w=0,A--;A>=0;A--)r[(A+1)*g+w]<m&&m<=r[A*g+w]&&h(g,v,m,w,A,3,r,b,u);for(A=1;A<v-1;A++)for(w=0;w<g-1;w++)!b[A*g+w]&&r[A*g+w]<m&&m<=r[A*g+w+1]&&h(g,v,m,w,A,0,r,b,u)}}}()},{}],4:[function(e,t,s){!function(){"use strict";var o=e("./imexam"),n=e("./conrec"),a=e("./contfv"),l=e("./bin");function d(g,v){var r=JS9.GetImage({display:v});if(r){var u=$(g).find(".contour-form")[0],f=o.ndops.ndarray(r.raw.data,[r.raw.width,r.raw.height]);u.min.value=o.ndops.minvalue(f).toFixed(2),u.max.value=o.ndops.maxvalue(f).toFixed(2)}}function h(g,v){var r;if(JS9.GetImage({display:v})){var f=$(g).find(".contour-form")[0],m=Number(f.nlevel.value),b=o.ndops.ndarray(o.ndops.iota(1,m)),w=Number(f.min.value),A=Number(f.max.value);o.ndops.divs(b,b,m+1),o.ndops.muls(b,b,A-w),o.ndops.adds(b,b,w);var x=[];for(r=0;r<b.shape[0];r++)x.push(b.data[r].toFixed(2));f.level.value=x.join("\n")}}JS9.RegisterPlugin("ImExam","Contours",function p(){var g=JS9.GetImage({display:this.display}),v=this.div;v.innerHTML='<form class="contour-form js9Form">\t\t\t\t\t\t\t\t    <table style="border-collapse: separate; border-spacing: 10px 5px;"><tr>\t<td>Num:</td>\t\t\t\t<td><input type=text name=nlevel value=5 size="10" style="text-align:right;"></td>\t\t\t\t\t\t\t<td><input type=button value="Draw contours" class="drw-contour JS9Button2"></td></tr>\t\t           <tr>\t<td>Min:</td>\t\t\t\t\t\t\t\t\t\t\t\t<td><input type=text name=min size="10" style="text-align:right;"></td>\t\t\t\t\t\t\t\t<td><input type=button value="Reset min/max" class="get-min-max JS9Button2"></td></tr>\t\t           <tr>\t<td>Max:</td>\t\t\t\t\t\t\t\t\t\t\t\t<td><input type=text name=max size="10" style="text-align:right;"></td></tr>\t\t\t\t\t           <tr>\t<td valign=top>Levels:</td>\t\t\t\t\t\t\t\t    \t\t<td rowspan=5><textarea rows=12 cols="10" name=level class="contour-levels" style="text-align:right;">\t\t\t\t    </textarea>\t\t\t\t\t\t\t\t\t\t\t\t<td valign=top><input type=button value="Make levels" class="make-levels JS9Button2"></td>\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t   <tr><td></td><td valign=top>\t\t\t\t\t\t\t\t\t\t\t\tBinning:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\t\t\t\t\t\t\t\t<select id=binning name=binpix class=JS9Select>\t\t\t\t\t\t\t\t<option>none</option>\t\t\t\t\t\t\t\t\t\t\t<option>2</option>\t\t\t\t\t\t\t\t\t\t\t<option>3</option>\t\t\t\t\t\t\t\t\t\t\t<option>4</option>\t\t\t\t\t\t\t\t\t\t\t<option>5</option>\t\t\t\t\t\t\t\t\t\t\t<option>6</option>\t\t\t\t\t\t\t\t\t\t\t<option>7</option>\t\t\t\t\t\t\t\t\t\t\t<option>8</option>\t\t\t\t\t\t\t\t\t\t\t</select>\t\t\t\t\t\t\t\t\t\t\t\tpix\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t   <tr><td></td><td valign=top>\t\t\t\t\t\t\t\t\t\t\t\tSmoothing:&nbsp;\t\t\t\t\t\t\t\t\t\t\t<select id=smooth name=smopix class=JS9Select>\t\t\t\t\t\t\t\t<option>none</option>\t\t\t\t\t\t\t\t\t\t\t<option value=0.75 selected>3</option>\t\t\t\t\t\t\t\t\t<option value=1.00>5</option>\t\t\t\t\t\t\t\t\t\t<option value=1.25>7</option>\t\t\t\t\t\t\t\t\t\t</select>\t\t\t\t\t\t\t\t\t\t\t\tpix\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t   <tr><td></td><td valign=top>\t\t\t\t\t\t\t\t\t\t\t\tQuality:&nbsp;\t\t\t\t\t\t\t\t\t\t\t\t<input type=radio name=quality value=faster checked>faster\t\t\t\t\t\t<input type=radio name=quality value=better>better\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t    </table>\t\t\t\t\t\t\t\t\t\t\t\t    <p>\t\t\t\t\t\t\t\t\t\t\t\t\t    </form>';var r=this.display;$(v).find(".drw-contour").on("mouseup",function(){!function c(g,v){var r=JS9.GetImage({display:v}),u=$(g).find(".contour-form")[0],f=o.ndops.ndarray(r.raw.data,[r.raw.height,r.raw.width]),m=u.level.value,b=$(u).find("#binning").val(),w=$(u).find("#smooth").val(),A=$(u).find("input[type=radio]:checked").val();"none"===b?b=1:f=l.bin2d(f,parseInt(b));var y,x=JSON.parse("["+m.trim().split(/\s+/).join(",")+"]").map(function(S){return S*b*b});"none"!==w&&(f=l.smooth_gaussian2d(f,parseFloat(w))),JS9.waiting(!0),setTimeout(function(){try{if("better"===A){var S=new n.Conrec;try{var _=o.ndops.iota(0,f.shape[0]-1).map(function(L){return L*b+(b-1)/2+1}),C=o.ndops.iota(0,f.shape[1]-1).map(function(L){return L*b+(b-1)/2+1});S.contour(f,0,f.shape[0]-1,0,f.shape[1]-1,_,C,x.length,x)}catch{return void alert("Too many coutour segments: Check your coutour levels.\n\nAre you trying to coutour the background levels of an image?")}y=S.contourList().map(function(L){return{shape:"polygon",pts:L}})}else{var I=[];(y=[]).push({shape:"polygon",pts:I}),a(x,f.shape[0],f.shape[1],f.data,function(L,D,O){void 0===O?y.push({shape:"polygon",pts:I=[]}):I.push({x:L*b+.5,y:D*b+.5})}),y.length=y.length-1}JS9.NewShapeLayer("contour",JS9.Catalogs.opts,{display:r}),JS9.RemoveShapes("contour",{display:r}),JS9.AddShapes("contour",y,{color:"yellow"},{display:r})}finally{JS9.waiting(!1)}},200)}(v,r)}),$(v).find(".get-min-max").on("mouseup",function(){d(v,r)}),$(v).find(".make-levels").on("mouseup",function(){h(v,r)}),void 0!==g&&(d(v,r),h(v,r)),o.fixupDiv(this)},{menu:"view",winTitle:"Contours",menuItem:"Contours",help:"imexam/contours.html",toolbarSeparate:!0,winDims:[400,300]})}()},{"./bin":1,"./conrec":2,"./contfv":3,"./imexam":void 0}]},{},[4]);